var hy=Object.defineProperty;var cy=(l,e,t)=>e in l?hy(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var Cd=(l,e,t)=>(cy(l,typeof e!="symbol"?e+"":e,t),t);import{j as uy,N as Yc,W as dy,y as Is,T as vt,D as Ui,g as zt,I as li,X as Tt,A as yi,o as je,c as ii,q as si,B as Be,Y as Fs,b as $e,V as We,Z as Mo,J as ir,_ as Lg,x as Kc,w as dr,$ as Lt,P as ei,a0 as $t,n as Ft,a1 as py,a2 as Td,a3 as Dd,v as va,a4 as Ds,p as hs,R as In,E as Mr,d as Nr,a5 as cs,a6 as gy,f as Zs,a7 as Hs,t as ns,a as Vs,a8 as Rt,l as En,r as Xs,F as Hi,a9 as vs,aa as lc,ab as fy,G as Nt,e as jc,ac as qc,h as io,ad as my,ae as yy,M as Ea,S as Id,O as ot,af as by,ag as vy,ah as ka}from"./UnivariatePolynomial-B7u1WGdr.js";import{az as ti,l as _i,aA as _y,S as yt,aB as Xc,aC as Bt,ac as xr,aD as Ai,aE as Aa,av as Ly,L as xd,aF as ta,aG as hc,aH as No,aI as wr}from"./patternBoards-DsO5TEFU.js";/*!
 * jQuery JavaScript Library v2.1.0
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2014 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2014-01-23T21:10Z
 */(function(l){(function(e,t){self.$=e.document?t(e,!0):function(i){if(!i.document)throw new Error("jQuery requires a self with a document");return t(i)}})(typeof self<"u"?self:uy,function(e,t){var i=[],n=i.slice,r=i.concat,h=i.push,p=i.indexOf,S={},C=S.toString,B=S.hasOwnProperty,U="".trim,k={},Q=e.document,X="2.1.0",g=function(u,m){return new g.fn.init(u,m)},Z=/^-ms-/,ce=/-([\da-z])/gi,ye=function(u,m){return m.toUpperCase()};g.fn=g.prototype={jquery:X,constructor:g,selector:"",length:0,toArray:function(){return n.call(this)},get:function(u){return u!=null?u<0?this[u+this.length]:this[u]:n.call(this)},pushStack:function(u){var m=g.merge(this.constructor(),u);return m.prevObject=this,m.context=this.context,m},each:function(u,m){return g.each(this,u,m)},map:function(u){return this.pushStack(g.map(this,function(m,v){return u.call(m,v,m)}))},slice:function(){return this.pushStack(n.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(u){var m=this.length,v=+u+(u<0?m:0);return this.pushStack(v>=0&&v<m?[this[v]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:h,sort:i.sort,splice:i.splice},g.extend=g.fn.extend=function(){var u,m,v,w,A,R,W=arguments[0]||{},te=1,ge=arguments.length,Pe=!1;for(typeof W=="boolean"&&(Pe=W,W=arguments[te]||{},te++),typeof W!="object"&&!g.isFunction(W)&&(W={}),te===ge&&(W=this,te--);te<ge;te++)if((u=arguments[te])!=null)for(m in u)v=W[m],w=u[m],W!==w&&(Pe&&w&&(g.isPlainObject(w)||(A=g.isArray(w)))?(A?(A=!1,R=v&&g.isArray(v)?v:[]):R=v&&g.isPlainObject(v)?v:{},W[m]=g.extend(Pe,R,w)):w!==void 0&&(W[m]=w));return W},g.extend({expando:"jQuery"+(X+Math.random()).replace(/\D/g,""),isReady:!0,error:function(u){throw new Error(u)},noop:function(){},isFunction:function(u){return g.type(u)==="function"},isArray:Array.isArray,isWindow:function(u){return u!=null&&u===u.window},isNumeric:function(u){return u-parseFloat(u)>=0},isPlainObject:function(u){if(g.type(u)!=="object"||u.nodeType||g.isWindow(u))return!1;try{if(u.constructor&&!B.call(u.constructor.prototype,"isPrototypeOf"))return!1}catch{return!1}return!0},isEmptyObject:function(u){var m;for(m in u)return!1;return!0},type:function(u){return u==null?u+"":typeof u=="object"||typeof u=="function"?S[C.call(u)]||"object":typeof u},globalEval:function(u){var m,v=eval;u=g.trim(u),u&&(u.indexOf("use strict")===1?(m=Q.createElement("script"),m.text=u,Q.head.appendChild(m).parentNode.removeChild(m)):v(u))},camelCase:function(u){return u.replace(Z,"ms-").replace(ce,ye)},nodeName:function(u,m){return u.nodeName&&u.nodeName.toLowerCase()===m.toLowerCase()},each:function(u,m,v){var w,A=0,R=u.length,W=Oe(u);if(v){if(W)for(;A<R&&(w=m.apply(u[A],v),w!==!1);A++);else for(A in u)if(w=m.apply(u[A],v),w===!1)break}else if(W)for(;A<R&&(w=m.call(u[A],A,u[A]),w!==!1);A++);else for(A in u)if(w=m.call(u[A],A,u[A]),w===!1)break;return u},trim:function(u){return u==null?"":U.call(u)},makeArray:function(u,m){var v=m||[];return u!=null&&(Oe(Object(u))?g.merge(v,typeof u=="string"?[u]:u):h.call(v,u)),v},inArray:function(u,m,v){return m==null?-1:p.call(m,u,v)},merge:function(u,m){for(var v=+m.length,w=0,A=u.length;w<v;w++)u[A++]=m[w];return u.length=A,u},grep:function(u,m,v){for(var w,A=[],R=0,W=u.length,te=!v;R<W;R++)w=!m(u[R],R),w!==te&&A.push(u[R]);return A},map:function(u,m,v){var w,A=0,R=u.length,W=Oe(u),te=[];if(W)for(;A<R;A++)w=m(u[A],A,v),w!=null&&te.push(w);else for(A in u)w=m(u[A],A,v),w!=null&&te.push(w);return r.apply([],te)},guid:1,proxy:function(u,m){var v,w,A;if(typeof m=="string"&&(v=u[m],m=u,u=v),!!g.isFunction(u))return w=n.call(arguments,2),A=function(){return u.apply(m||this,w.concat(n.call(arguments)))},A.guid=u.guid=u.guid||g.guid++,A},now:Date.now,support:k}),g.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(u,m){S["[object "+m+"]"]=m.toLowerCase()});function Oe(u){var m=u.length,v=g.type(u);return v==="function"||g.isWindow(u)?!1:u.nodeType===1&&m?!0:v==="array"||m===0||typeof m=="number"&&m>0&&m-1 in u}var de=function(u){var m,v,w,A,R,W,te,ge,Pe,_e,Ee,ke,qe,pt,Mt,di,an,Yt="sizzle"+-new Date,ds=u.document,gt=0,Gr=0,Kt=dh(),Di=dh(),Bn=dh(),Ta=function(Y,ae){return Y===ae&&(Pe=!0),0},ps="undefined",zr=1<<31,mr={}.hasOwnProperty,as=[],Fn=as.pop,Es=as.push,Hn=as.push,_d=as.slice,yr=as.indexOf||function(Y){for(var ae=0,ue=this.length;ae<ue;ae++)if(this[ae]===Y)return ae;return-1},hh="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ri="[\\x20\\t\\r\\n\\f]",Wr="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",Ld=Wr.replace("w","w#"),Pd="\\["+ri+"*("+Wr+")"+ri+"*(?:([*^$|!~]?=)"+ri+`*(?:(['"])((?:\\\\.|[^\\\\])*?)\\3|(`+Ld+")|)|)"+ri+"*\\]",ch=":("+Wr+`)(?:\\(((['"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|`+Pd.replace(3,8)+")*)|.*)\\)|)",qo=new RegExp("^"+ri+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ri+"+$","g"),qm=new RegExp("^"+ri+"*,"+ri+"*"),Xm=new RegExp("^"+ri+"*([>+~]|"+ri+")"+ri+"*"),Zm=new RegExp("="+ri+`*([^\\]'"]*?)`+ri+"*\\]","g"),Qm=new RegExp(ch),Jm=new RegExp("^"+Ld+"$"),Xo={ID:new RegExp("^#("+Wr+")"),CLASS:new RegExp("^\\.("+Wr+")"),TAG:new RegExp("^("+Wr.replace("w","w*")+")"),ATTR:new RegExp("^"+Pd),PSEUDO:new RegExp("^"+ch),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ri+"*(even|odd|(([+-]|)(\\d*)n|)"+ri+"*(?:([+-]|)"+ri+"*(\\d+)|))"+ri+"*\\)|)","i"),bool:new RegExp("^(?:"+hh+")$","i"),needsContext:new RegExp("^"+ri+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ri+"*((?:-\\d)?\\d*)"+ri+"*\\)|)(?=[^-]|$)","i")},ey=/^(?:input|select|textarea|button)$/i,ty=/^h\d$/i,Da=/^[^{]+\{\s*\[native \w/,iy=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,uh=/[+~]/,sy=/'|\\/g,Vn=new RegExp("\\\\([\\da-f]{1,6}"+ri+"?|("+ri+")|.)","ig"),Gn=function(Y,ae,ue){var we="0x"+ae-65536;return we!==we||ue?ae:we<0?String.fromCharCode(we+65536):String.fromCharCode(we>>10|55296,we&1023|56320)};try{Hn.apply(as=_d.call(ds.childNodes),ds.childNodes),as[ds.childNodes.length].nodeType}catch{Hn={apply:as.length?function(ae,ue){Es.apply(ae,_d.call(ue))}:function(ae,ue){for(var we=ae.length,ve=0;ae[we++]=ue[ve++];);ae.length=we-1}}}function bi(Y,ae,ue,we){var ve,Ie,xe,Ye,st,bt,mt,lt,ui,Et;if((ae?ae.ownerDocument||ae:ds)!==Ee&&_e(ae),ae=ae||Ee,ue=ue||[],!Y||typeof Y!="string")return ue;if((Ye=ae.nodeType)!==1&&Ye!==9)return[];if(qe&&!we){if(ve=iy.exec(Y))if(xe=ve[1]){if(Ye===9)if(Ie=ae.getElementById(xe),Ie&&Ie.parentNode){if(Ie.id===xe)return ue.push(Ie),ue}else return ue;else if(ae.ownerDocument&&(Ie=ae.ownerDocument.getElementById(xe))&&an(ae,Ie)&&Ie.id===xe)return ue.push(Ie),ue}else{if(ve[2])return Hn.apply(ue,ae.getElementsByTagName(Y)),ue;if((xe=ve[3])&&v.getElementsByClassName&&ae.getElementsByClassName)return Hn.apply(ue,ae.getElementsByClassName(xe)),ue}if(v.qsa&&(!pt||!pt.test(Y))){if(lt=mt=Yt,ui=ae,Et=Ye===9&&Y,Ye===1&&ae.nodeName.toLowerCase()!=="object"){for(bt=Zo(Y),(mt=ae.getAttribute("id"))?lt=mt.replace(sy,"\\$&"):ae.setAttribute("id",lt),lt="[id='"+lt+"'] ",st=bt.length;st--;)bt[st]=lt+Qo(bt[st]);ui=uh.test(Y)&&gh(ae.parentNode)||ae,Et=bt.join(",")}if(Et)try{return Hn.apply(ue,ui.querySelectorAll(Et)),ue}catch{}finally{mt||ae.removeAttribute("id")}}}return ly(Y.replace(qo,"$1"),ae,ue,we)}function dh(){var Y=[];function ae(ue,we){return Y.push(ue+" ")>w.cacheLength&&delete ae[Y.shift()],ae[ue+" "]=we}return ae}function $s(Y){return Y[Yt]=!0,Y}function Us(Y){var ae=Ee.createElement("div");try{return!!Y(ae)}catch{return!1}finally{ae.parentNode&&ae.parentNode.removeChild(ae),ae=null}}function ph(Y,ae){for(var ue=Y.split("|"),we=Y.length;we--;)w.attrHandle[ue[we]]=ae}function Sd(Y,ae){var ue=ae&&Y,we=ue&&Y.nodeType===1&&ae.nodeType===1&&(~ae.sourceIndex||zr)-(~Y.sourceIndex||zr);if(we)return we;if(ue){for(;ue=ue.nextSibling;)if(ue===ae)return-1}return Y?1:-1}function ny(Y){return function(ae){var ue=ae.nodeName.toLowerCase();return ue==="input"&&ae.type===Y}}function ry(Y){return function(ae){var ue=ae.nodeName.toLowerCase();return(ue==="input"||ue==="button")&&ae.type===Y}}function br(Y){return $s(function(ae){return ae=+ae,$s(function(ue,we){for(var ve,Ie=Y([],ue.length,ae),xe=Ie.length;xe--;)ue[ve=Ie[xe]]&&(ue[ve]=!(we[ve]=ue[ve]))})})}function gh(Y){return Y&&typeof Y.getElementsByTagName!==ps&&Y}v=bi.support={},R=bi.isXML=function(Y){var ae=Y&&(Y.ownerDocument||Y).documentElement;return ae?ae.nodeName!=="HTML":!1},_e=bi.setDocument=function(Y){var ae,ue=Y?Y.ownerDocument||Y:ds,we=ue.defaultView;return ue===Ee||ue.nodeType!==9||!ue.documentElement?Ee:(Ee=ue,ke=ue.documentElement,qe=!R(ue),we&&we!==we.top&&(we.addEventListener?we.addEventListener("unload",function(){_e()},!1):we.attachEvent&&we.attachEvent("onunload",function(){_e()})),v.attributes=Us(function(ve){return ve.className="i",!ve.getAttribute("className")}),v.getElementsByTagName=Us(function(ve){return ve.appendChild(ue.createComment("")),!ve.getElementsByTagName("*").length}),v.getElementsByClassName=Da.test(ue.getElementsByClassName)&&Us(function(ve){return ve.innerHTML="<div class='a'></div><div class='a i'></div>",ve.firstChild.className="i",ve.getElementsByClassName("i").length===2}),v.getById=Us(function(ve){return ke.appendChild(ve).id=Yt,!ue.getElementsByName||!ue.getElementsByName(Yt).length}),v.getById?(w.find.ID=function(ve,Ie){if(typeof Ie.getElementById!==ps&&qe){var xe=Ie.getElementById(ve);return xe&&xe.parentNode?[xe]:[]}},w.filter.ID=function(ve){var Ie=ve.replace(Vn,Gn);return function(xe){return xe.getAttribute("id")===Ie}}):(delete w.find.ID,w.filter.ID=function(ve){var Ie=ve.replace(Vn,Gn);return function(xe){var Ye=typeof xe.getAttributeNode!==ps&&xe.getAttributeNode("id");return Ye&&Ye.value===Ie}}),w.find.TAG=v.getElementsByTagName?function(ve,Ie){if(typeof Ie.getElementsByTagName!==ps)return Ie.getElementsByTagName(ve)}:function(ve,Ie){var xe,Ye=[],st=0,bt=Ie.getElementsByTagName(ve);if(ve==="*"){for(;xe=bt[st++];)xe.nodeType===1&&Ye.push(xe);return Ye}return bt},w.find.CLASS=v.getElementsByClassName&&function(ve,Ie){if(typeof Ie.getElementsByClassName!==ps&&qe)return Ie.getElementsByClassName(ve)},Mt=[],pt=[],(v.qsa=Da.test(ue.querySelectorAll))&&(Us(function(ve){ve.innerHTML="<select t=''><option selected=''></option></select>",ve.querySelectorAll("[t^='']").length&&pt.push("[*^$]="+ri+`*(?:''|"")`),ve.querySelectorAll("[selected]").length||pt.push("\\["+ri+"*(?:value|"+hh+")"),ve.querySelectorAll(":checked").length||pt.push(":checked")}),Us(function(ve){var Ie=ue.createElement("input");Ie.setAttribute("type","hidden"),ve.appendChild(Ie).setAttribute("name","D"),ve.querySelectorAll("[name=d]").length&&pt.push("name"+ri+"*[*^$|!~]?="),ve.querySelectorAll(":enabled").length||pt.push(":enabled",":disabled"),ve.querySelectorAll("*,:x"),pt.push(",.*:")})),(v.matchesSelector=Da.test(di=ke.webkitMatchesSelector||ke.mozMatchesSelector||ke.oMatchesSelector||ke.msMatchesSelector))&&Us(function(ve){v.disconnectedMatch=di.call(ve,"div"),di.call(ve,"[s!='']:x"),Mt.push("!=",ch)}),pt=pt.length&&new RegExp(pt.join("|")),Mt=Mt.length&&new RegExp(Mt.join("|")),ae=Da.test(ke.compareDocumentPosition),an=ae||Da.test(ke.contains)?function(ve,Ie){var xe=ve.nodeType===9?ve.documentElement:ve,Ye=Ie&&Ie.parentNode;return ve===Ye||!!(Ye&&Ye.nodeType===1&&(xe.contains?xe.contains(Ye):ve.compareDocumentPosition&&ve.compareDocumentPosition(Ye)&16))}:function(ve,Ie){if(Ie){for(;Ie=Ie.parentNode;)if(Ie===ve)return!0}return!1},Ta=ae?function(ve,Ie){if(ve===Ie)return Pe=!0,0;var xe=!ve.compareDocumentPosition-!Ie.compareDocumentPosition;return xe||(xe=(ve.ownerDocument||ve)===(Ie.ownerDocument||Ie)?ve.compareDocumentPosition(Ie):1,xe&1||!v.sortDetached&&Ie.compareDocumentPosition(ve)===xe?ve===ue||ve.ownerDocument===ds&&an(ds,ve)?-1:Ie===ue||Ie.ownerDocument===ds&&an(ds,Ie)?1:ge?yr.call(ge,ve)-yr.call(ge,Ie):0:xe&4?-1:1)}:function(ve,Ie){if(ve===Ie)return Pe=!0,0;var xe,Ye=0,st=ve.parentNode,bt=Ie.parentNode,mt=[ve],lt=[Ie];if(!st||!bt)return ve===ue?-1:Ie===ue?1:st?-1:bt?1:ge?yr.call(ge,ve)-yr.call(ge,Ie):0;if(st===bt)return Sd(ve,Ie);for(xe=ve;xe=xe.parentNode;)mt.unshift(xe);for(xe=Ie;xe=xe.parentNode;)lt.unshift(xe);for(;mt[Ye]===lt[Ye];)Ye++;return Ye?Sd(mt[Ye],lt[Ye]):mt[Ye]===ds?-1:lt[Ye]===ds?1:0},ue)},bi.matches=function(Y,ae){return bi(Y,null,null,ae)},bi.matchesSelector=function(Y,ae){if((Y.ownerDocument||Y)!==Ee&&_e(Y),ae=ae.replace(Zm,"='$1']"),v.matchesSelector&&qe&&(!Mt||!Mt.test(ae))&&(!pt||!pt.test(ae)))try{var ue=di.call(Y,ae);if(ue||v.disconnectedMatch||Y.document&&Y.document.nodeType!==11)return ue}catch{}return bi(ae,Ee,null,[Y]).length>0},bi.contains=function(Y,ae){return(Y.ownerDocument||Y)!==Ee&&_e(Y),an(Y,ae)},bi.attr=function(Y,ae){(Y.ownerDocument||Y)!==Ee&&_e(Y);var ue=w.attrHandle[ae.toLowerCase()],we=ue&&mr.call(w.attrHandle,ae.toLowerCase())?ue(Y,ae,!qe):void 0;return we!==void 0?we:v.attributes||!qe?Y.getAttribute(ae):(we=Y.getAttributeNode(ae))&&we.specified?we.value:null},bi.error=function(Y){throw new Error("Syntax error, unrecognized expression: "+Y)},bi.uniqueSort=function(Y){var ae,ue=[],we=0,ve=0;if(Pe=!v.detectDuplicates,ge=!v.sortStable&&Y.slice(0),Y.sort(Ta),Pe){for(;ae=Y[ve++];)ae===Y[ve]&&(we=ue.push(ve));for(;we--;)Y.splice(ue[we],1)}return ge=null,Y},A=bi.getText=function(Y){var ae,ue="",we=0,ve=Y.nodeType;if(ve){if(ve===1||ve===9||ve===11){if(typeof Y.textContent=="string")return Y.textContent;for(Y=Y.firstChild;Y;Y=Y.nextSibling)ue+=A(Y)}else if(ve===3||ve===4)return Y.nodeValue}else for(;ae=Y[we++];)ue+=A(ae);return ue},w=bi.selectors={cacheLength:50,createPseudo:$s,match:Xo,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(Y){return Y[1]=Y[1].replace(Vn,Gn),Y[3]=(Y[4]||Y[5]||"").replace(Vn,Gn),Y[2]==="~="&&(Y[3]=" "+Y[3]+" "),Y.slice(0,4)},CHILD:function(Y){return Y[1]=Y[1].toLowerCase(),Y[1].slice(0,3)==="nth"?(Y[3]||bi.error(Y[0]),Y[4]=+(Y[4]?Y[5]+(Y[6]||1):2*(Y[3]==="even"||Y[3]==="odd")),Y[5]=+(Y[7]+Y[8]||Y[3]==="odd")):Y[3]&&bi.error(Y[0]),Y},PSEUDO:function(Y){var ae,ue=!Y[5]&&Y[2];return Xo.CHILD.test(Y[0])?null:(Y[3]&&Y[4]!==void 0?Y[2]=Y[4]:ue&&Qm.test(ue)&&(ae=Zo(ue,!0))&&(ae=ue.indexOf(")",ue.length-ae)-ue.length)&&(Y[0]=Y[0].slice(0,ae),Y[2]=ue.slice(0,ae)),Y.slice(0,3))}},filter:{TAG:function(Y){var ae=Y.replace(Vn,Gn).toLowerCase();return Y==="*"?function(){return!0}:function(ue){return ue.nodeName&&ue.nodeName.toLowerCase()===ae}},CLASS:function(Y){var ae=Kt[Y+" "];return ae||(ae=new RegExp("(^|"+ri+")"+Y+"("+ri+"|$)"))&&Kt(Y,function(ue){return ae.test(typeof ue.className=="string"&&ue.className||typeof ue.getAttribute!==ps&&ue.getAttribute("class")||"")})},ATTR:function(Y,ae,ue){return function(we){var ve=bi.attr(we,Y);return ve==null?ae==="!=":ae?(ve+="",ae==="="?ve===ue:ae==="!="?ve!==ue:ae==="^="?ue&&ve.indexOf(ue)===0:ae==="*="?ue&&ve.indexOf(ue)>-1:ae==="$="?ue&&ve.slice(-ue.length)===ue:ae==="~="?(" "+ve+" ").indexOf(ue)>-1:ae==="|="?ve===ue||ve.slice(0,ue.length+1)===ue+"-":!1):!0}},CHILD:function(Y,ae,ue,we,ve){var Ie=Y.slice(0,3)!=="nth",xe=Y.slice(-4)!=="last",Ye=ae==="of-type";return we===1&&ve===0?function(st){return!!st.parentNode}:function(st,bt,mt){var lt,ui,Et,ai,Zi,Qi,Ss=Ie!==xe?"nextSibling":"previousSibling",pi=st.parentNode,Ia=Ye&&st.nodeName.toLowerCase(),xa=!mt&&!Ye;if(pi){if(Ie){for(;Ss;){for(Et=st;Et=Et[Ss];)if(Ye?Et.nodeName.toLowerCase()===Ia:Et.nodeType===1)return!1;Qi=Ss=Y==="only"&&!Qi&&"nextSibling"}return!0}if(Qi=[xe?pi.firstChild:pi.lastChild],xe&&xa){for(ui=pi[Yt]||(pi[Yt]={}),lt=ui[Y]||[],Zi=lt[0]===gt&&lt[1],ai=lt[0]===gt&&lt[2],Et=Zi&&pi.childNodes[Zi];Et=++Zi&&Et&&Et[Ss]||(ai=Zi=0)||Qi.pop();)if(Et.nodeType===1&&++ai&&Et===st){ui[Y]=[gt,Zi,ai];break}}else if(xa&&(lt=(st[Yt]||(st[Yt]={}))[Y])&&lt[0]===gt)ai=lt[1];else for(;(Et=++Zi&&Et&&Et[Ss]||(ai=Zi=0)||Qi.pop())&&!((Ye?Et.nodeName.toLowerCase()===Ia:Et.nodeType===1)&&++ai&&(xa&&((Et[Yt]||(Et[Yt]={}))[Y]=[gt,ai]),Et===st)););return ai-=ve,ai===we||ai%we===0&&ai/we>=0}}},PSEUDO:function(Y,ae){var ue,we=w.pseudos[Y]||w.setFilters[Y.toLowerCase()]||bi.error("unsupported pseudo: "+Y);return we[Yt]?we(ae):we.length>1?(ue=[Y,Y,"",ae],w.setFilters.hasOwnProperty(Y.toLowerCase())?$s(function(ve,Ie){for(var xe,Ye=we(ve,ae),st=Ye.length;st--;)xe=yr.call(ve,Ye[st]),ve[xe]=!(Ie[xe]=Ye[st])}):function(ve){return we(ve,0,ue)}):we}},pseudos:{not:$s(function(Y){var ae=[],ue=[],we=W(Y.replace(qo,"$1"));return we[Yt]?$s(function(ve,Ie,xe,Ye){for(var st,bt=we(ve,null,Ye,[]),mt=ve.length;mt--;)(st=bt[mt])&&(ve[mt]=!(Ie[mt]=st))}):function(ve,Ie,xe){return ae[0]=ve,we(ae,null,xe,ue),!ue.pop()}}),has:$s(function(Y){return function(ae){return bi(Y,ae).length>0}}),contains:$s(function(Y){return function(ae){return(ae.textContent||ae.innerText||A(ae)).indexOf(Y)>-1}}),lang:$s(function(Y){return Jm.test(Y||"")||bi.error("unsupported lang: "+Y),Y=Y.replace(Vn,Gn).toLowerCase(),function(ae){var ue;do if(ue=qe?ae.lang:ae.getAttribute("xml:lang")||ae.getAttribute("lang"))return ue=ue.toLowerCase(),ue===Y||ue.indexOf(Y+"-")===0;while((ae=ae.parentNode)&&ae.nodeType===1);return!1}}),target:function(Y){var ae=u.location&&u.location.hash;return ae&&ae.slice(1)===Y.id},root:function(Y){return Y===ke},focus:function(Y){return Y===Ee.activeElement&&(!Ee.hasFocus||Ee.hasFocus())&&!!(Y.type||Y.href||~Y.tabIndex)},enabled:function(Y){return Y.disabled===!1},disabled:function(Y){return Y.disabled===!0},checked:function(Y){var ae=Y.nodeName.toLowerCase();return ae==="input"&&!!Y.checked||ae==="option"&&!!Y.selected},selected:function(Y){return Y.parentNode&&Y.parentNode.selectedIndex,Y.selected===!0},empty:function(Y){for(Y=Y.firstChild;Y;Y=Y.nextSibling)if(Y.nodeType<6)return!1;return!0},parent:function(Y){return!w.pseudos.empty(Y)},header:function(Y){return ty.test(Y.nodeName)},input:function(Y){return ey.test(Y.nodeName)},button:function(Y){var ae=Y.nodeName.toLowerCase();return ae==="input"&&Y.type==="button"||ae==="button"},text:function(Y){var ae;return Y.nodeName.toLowerCase()==="input"&&Y.type==="text"&&((ae=Y.getAttribute("type"))==null||ae.toLowerCase()==="text")},first:br(function(){return[0]}),last:br(function(Y,ae){return[ae-1]}),eq:br(function(Y,ae,ue){return[ue<0?ue+ae:ue]}),even:br(function(Y,ae){for(var ue=0;ue<ae;ue+=2)Y.push(ue);return Y}),odd:br(function(Y,ae){for(var ue=1;ue<ae;ue+=2)Y.push(ue);return Y}),lt:br(function(Y,ae,ue){for(var we=ue<0?ue+ae:ue;--we>=0;)Y.push(we);return Y}),gt:br(function(Y,ae,ue){for(var we=ue<0?ue+ae:ue;++we<ae;)Y.push(we);return Y})}},w.pseudos.nth=w.pseudos.eq;for(m in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})w.pseudos[m]=ny(m);for(m in{submit:!0,reset:!0})w.pseudos[m]=ry(m);function wd(){}wd.prototype=w.filters=w.pseudos,w.setFilters=new wd;function Zo(Y,ae){var ue,we,ve,Ie,xe,Ye,st,bt=Di[Y+" "];if(bt)return ae?0:bt.slice(0);for(xe=Y,Ye=[],st=w.preFilter;xe;){(!ue||(we=qm.exec(xe)))&&(we&&(xe=xe.slice(we[0].length)||xe),Ye.push(ve=[])),ue=!1,(we=Xm.exec(xe))&&(ue=we.shift(),ve.push({value:ue,type:we[0].replace(qo," ")}),xe=xe.slice(ue.length));for(Ie in w.filter)(we=Xo[Ie].exec(xe))&&(!st[Ie]||(we=st[Ie](we)))&&(ue=we.shift(),ve.push({value:ue,type:Ie,matches:we}),xe=xe.slice(ue.length));if(!ue)break}return ae?xe.length:xe?bi.error(Y):Di(Y,Ye).slice(0)}function Qo(Y){for(var ae=0,ue=Y.length,we="";ae<ue;ae++)we+=Y[ae].value;return we}function fh(Y,ae,ue){var we=ae.dir,ve=ue&&we==="parentNode",Ie=Gr++;return ae.first?function(xe,Ye,st){for(;xe=xe[we];)if(xe.nodeType===1||ve)return Y(xe,Ye,st)}:function(xe,Ye,st){var bt,mt,lt=[gt,Ie];if(st){for(;xe=xe[we];)if((xe.nodeType===1||ve)&&Y(xe,Ye,st))return!0}else for(;xe=xe[we];)if(xe.nodeType===1||ve){if(mt=xe[Yt]||(xe[Yt]={}),(bt=mt[we])&&bt[0]===gt&&bt[1]===Ie)return lt[2]=bt[2];if(mt[we]=lt,lt[2]=Y(xe,Ye,st))return!0}}}function mh(Y){return Y.length>1?function(ae,ue,we){for(var ve=Y.length;ve--;)if(!Y[ve](ae,ue,we))return!1;return!0}:Y[0]}function Jo(Y,ae,ue,we,ve){for(var Ie,xe=[],Ye=0,st=Y.length,bt=ae!=null;Ye<st;Ye++)(Ie=Y[Ye])&&(!ue||ue(Ie,we,ve))&&(xe.push(Ie),bt&&ae.push(Ye));return xe}function yh(Y,ae,ue,we,ve,Ie){return we&&!we[Yt]&&(we=yh(we)),ve&&!ve[Yt]&&(ve=yh(ve,Ie)),$s(function(xe,Ye,st,bt){var mt,lt,ui,Et=[],ai=[],Zi=Ye.length,Qi=xe||oy(ae||"*",st.nodeType?[st]:st,[]),Ss=Y&&(xe||!ae)?Jo(Qi,Et,Y,st,bt):Qi,pi=ue?ve||(xe?Y:Zi||we)?[]:Ye:Ss;if(ue&&ue(Ss,pi,st,bt),we)for(mt=Jo(pi,ai),we(mt,[],st,bt),lt=mt.length;lt--;)(ui=mt[lt])&&(pi[ai[lt]]=!(Ss[ai[lt]]=ui));if(xe){if(ve||Y){if(ve){for(mt=[],lt=pi.length;lt--;)(ui=pi[lt])&&mt.push(Ss[lt]=ui);ve(null,pi=[],mt,bt)}for(lt=pi.length;lt--;)(ui=pi[lt])&&(mt=ve?yr.call(xe,ui):Et[lt])>-1&&(xe[mt]=!(Ye[mt]=ui))}}else pi=Jo(pi===Ye?pi.splice(Zi,pi.length):pi),ve?ve(null,Ye,pi,bt):Hn.apply(Ye,pi)})}function bh(Y){for(var ae,ue,we,ve=Y.length,Ie=w.relative[Y[0].type],xe=Ie||w.relative[" "],Ye=Ie?1:0,st=fh(function(lt){return lt===ae},xe,!0),bt=fh(function(lt){return yr.call(ae,lt)>-1},xe,!0),mt=[function(lt,ui,Et){return!Ie&&(Et||ui!==te)||((ae=ui).nodeType?st(lt,ui,Et):bt(lt,ui,Et))}];Ye<ve;Ye++)if(ue=w.relative[Y[Ye].type])mt=[fh(mh(mt),ue)];else{if(ue=w.filter[Y[Ye].type].apply(null,Y[Ye].matches),ue[Yt]){for(we=++Ye;we<ve&&!w.relative[Y[we].type];we++);return yh(Ye>1&&mh(mt),Ye>1&&Qo(Y.slice(0,Ye-1).concat({value:Y[Ye-2].type===" "?"*":""})).replace(qo,"$1"),ue,Ye<we&&bh(Y.slice(Ye,we)),we<ve&&bh(Y=Y.slice(we)),we<ve&&Qo(Y))}mt.push(ue)}return mh(mt)}function ay(Y,ae){var ue=ae.length>0,we=Y.length>0,ve=function(Ie,xe,Ye,st,bt){var mt,lt,ui,Et=0,ai="0",Zi=Ie&&[],Qi=[],Ss=te,pi=Ie||we&&w.find.TAG("*",bt),Ia=gt+=Ss==null?1:Math.random()||.1,xa=pi.length;for(bt&&(te=xe!==Ee&&xe);ai!==xa&&(mt=pi[ai])!=null;ai++){if(we&&mt){for(lt=0;ui=Y[lt++];)if(ui(mt,xe,Ye)){st.push(mt);break}bt&&(gt=Ia)}ue&&((mt=!ui&&mt)&&Et--,Ie&&Zi.push(mt))}if(Et+=ai,ue&&ai!==Et){for(lt=0;ui=ae[lt++];)ui(Zi,Qi,xe,Ye);if(Ie){if(Et>0)for(;ai--;)Zi[ai]||Qi[ai]||(Qi[ai]=Fn.call(st));Qi=Jo(Qi)}Hn.apply(st,Qi),bt&&!Ie&&Qi.length>0&&Et+ae.length>1&&bi.uniqueSort(st)}return bt&&(gt=Ia,te=Ss),Zi};return ue?$s(ve):ve}W=bi.compile=function(Y,ae){var ue,we=[],ve=[],Ie=Bn[Y+" "];if(!Ie){for(ae||(ae=Zo(Y)),ue=ae.length;ue--;)Ie=bh(ae[ue]),Ie[Yt]?we.push(Ie):ve.push(Ie);Ie=Bn(Y,ay(ve,we))}return Ie};function oy(Y,ae,ue){for(var we=0,ve=ae.length;we<ve;we++)bi(Y,ae[we],ue);return ue}function ly(Y,ae,ue,we){var ve,Ie,xe,Ye,st,bt=Zo(Y);if(!we&&bt.length===1){if(Ie=bt[0]=bt[0].slice(0),Ie.length>2&&(xe=Ie[0]).type==="ID"&&v.getById&&ae.nodeType===9&&qe&&w.relative[Ie[1].type]){if(ae=(w.find.ID(xe.matches[0].replace(Vn,Gn),ae)||[])[0],!ae)return ue;Y=Y.slice(Ie.shift().value.length)}for(ve=Xo.needsContext.test(Y)?0:Ie.length;ve--&&(xe=Ie[ve],!w.relative[Ye=xe.type]);)if((st=w.find[Ye])&&(we=st(xe.matches[0].replace(Vn,Gn),uh.test(Ie[0].type)&&gh(ae.parentNode)||ae))){if(Ie.splice(ve,1),Y=we.length&&Qo(Ie),!Y)return Hn.apply(ue,we),ue;break}}return W(Y,bt)(we,ae,!qe,ue,uh.test(Y)&&gh(ae.parentNode)||ae),ue}return v.sortStable=Yt.split("").sort(Ta).join("")===Yt,v.detectDuplicates=!!Pe,_e(),v.sortDetached=Us(function(Y){return Y.compareDocumentPosition(Ee.createElement("div"))&1}),Us(function(Y){return Y.innerHTML="<a href='#'></a>",Y.firstChild.getAttribute("href")==="#"})||ph("type|href|height|width",function(Y,ae,ue){if(!ue)return Y.getAttribute(ae,ae.toLowerCase()==="type"?1:2)}),(!v.attributes||!Us(function(Y){return Y.innerHTML="<input/>",Y.firstChild.setAttribute("value",""),Y.firstChild.getAttribute("value")===""}))&&ph("value",function(Y,ae,ue){if(!ue&&Y.nodeName.toLowerCase()==="input")return Y.defaultValue}),Us(function(Y){return Y.getAttribute("disabled")==null})||ph(hh,function(Y,ae,ue){var we;if(!ue)return Y[ae]===!0?ae.toLowerCase():(we=Y.getAttributeNode(ae))&&we.specified?we.value:null}),bi}(e);g.find=de,g.expr=de.selectors,g.expr[":"]=g.expr.pseudos,g.unique=de.uniqueSort,g.text=de.getText,g.isXMLDoc=de.isXML,g.contains=de.contains;var se=g.expr.match.needsContext,fe=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,Fe=/^.[^:#\[\.,]*$/;function Se(u,m,v){if(g.isFunction(m))return g.grep(u,function(w,A){return!!m.call(w,A,w)!==v});if(m.nodeType)return g.grep(u,function(w){return w===m!==v});if(typeof m=="string"){if(Fe.test(m))return g.filter(m,u,v);m=g.filter(m,u)}return g.grep(u,function(w){return p.call(m,w)>=0!==v})}g.filter=function(u,m,v){var w=m[0];return v&&(u=":not("+u+")"),m.length===1&&w.nodeType===1?g.find.matchesSelector(w,u)?[w]:[]:g.find.matches(u,g.grep(m,function(A){return A.nodeType===1}))},g.fn.extend({find:function(u){var m,v=this.length,w=[],A=this;if(typeof u!="string")return this.pushStack(g(u).filter(function(){for(m=0;m<v;m++)if(g.contains(A[m],this))return!0}));for(m=0;m<v;m++)g.find(u,A[m],w);return w=this.pushStack(v>1?g.unique(w):w),w.selector=this.selector?this.selector+" "+u:u,w},filter:function(u){return this.pushStack(Se(this,u||[],!1))},not:function(u){return this.pushStack(Se(this,u||[],!0))},is:function(u){return!!Se(this,typeof u=="string"&&se.test(u)?g(u):u||[],!1).length}});var ze,Re=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,Ke=g.fn.init=function(u,m){var v,w;if(!u)return this;if(typeof u=="string")if(u[0]==="<"&&u[u.length-1]===">"&&u.length>=3?v=[null,u,null]:v=Re.exec(u),v&&(v[1]||!m))if(v[1]){if(m=m instanceof g?m[0]:m,g.merge(this,g.parseHTML(v[1],m&&m.nodeType?m.ownerDocument||m:Q,!0)),fe.test(v[1])&&g.isPlainObject(m))for(v in m)g.isFunction(this[v])?this[v](m[v]):this.attr(v,m[v]);return this}else return w=Q.getElementById(v[2]),w&&w.parentNode&&(this.length=1,this[0]=w),this.context=Q,this.selector=u,this;else return!m||m.jquery?(m||ze).find(u):this.constructor(m).find(u);else{if(u.nodeType)return this.context=this[0]=u,this.length=1,this;if(g.isFunction(u))return typeof ze.ready<"u"?ze.ready(u):u(g)}return u.selector!==void 0&&(this.selector=u.selector,this.context=u.context),g.makeArray(u,this)};Ke.prototype=g.fn,ze=g(Q);var Ze=/^(?:parents|prev(?:Until|All))/,Te={children:!0,contents:!0,next:!0,prev:!0};g.extend({dir:function(u,m,v){for(var w=[],A=v!==void 0;(u=u[m])&&u.nodeType!==9;)if(u.nodeType===1){if(A&&g(u).is(v))break;w.push(u)}return w},sibling:function(u,m){for(var v=[];u;u=u.nextSibling)u.nodeType===1&&u!==m&&v.push(u);return v}}),g.fn.extend({has:function(u){var m=g(u,this),v=m.length;return this.filter(function(){for(var w=0;w<v;w++)if(g.contains(this,m[w]))return!0})},closest:function(u,m){for(var v,w=0,A=this.length,R=[],W=se.test(u)||typeof u!="string"?g(u,m||this.context):0;w<A;w++)for(v=this[w];v&&v!==m;v=v.parentNode)if(v.nodeType<11&&(W?W.index(v)>-1:v.nodeType===1&&g.find.matchesSelector(v,u))){R.push(v);break}return this.pushStack(R.length>1?g.unique(R):R)},index:function(u){return u?typeof u=="string"?p.call(g(u),this[0]):p.call(this,u.jquery?u[0]:u):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(u,m){return this.pushStack(g.unique(g.merge(this.get(),g(u,m))))},addBack:function(u){return this.add(u==null?this.prevObject:this.prevObject.filter(u))}});function ft(u,m){for(;(u=u[m])&&u.nodeType!==1;);return u}g.each({parent:function(u){var m=u.parentNode;return m&&m.nodeType!==11?m:null},parents:function(u){return g.dir(u,"parentNode")},parentsUntil:function(u,m,v){return g.dir(u,"parentNode",v)},next:function(u){return ft(u,"nextSibling")},prev:function(u){return ft(u,"previousSibling")},nextAll:function(u){return g.dir(u,"nextSibling")},prevAll:function(u){return g.dir(u,"previousSibling")},nextUntil:function(u,m,v){return g.dir(u,"nextSibling",v)},prevUntil:function(u,m,v){return g.dir(u,"previousSibling",v)},siblings:function(u){return g.sibling((u.parentNode||{}).firstChild,u)},children:function(u){return g.sibling(u.firstChild)},contents:function(u){return u.contentDocument||g.merge([],u.childNodes)}},function(u,m){g.fn[u]=function(v,w){var A=g.map(this,m,v);return u.slice(-5)!=="Until"&&(w=v),w&&typeof w=="string"&&(A=g.filter(w,A)),this.length>1&&(Te[u]||g.unique(A),Ze.test(u)&&A.reverse()),this.pushStack(A)}});var Ce=/\S+/g,De={};function Ve(u){var m=De[u]={};return g.each(u.match(Ce)||[],function(v,w){m[w]=!0}),m}g.Callbacks=function(u){u=typeof u=="string"?De[u]||Ve(u):g.extend({},u);var m,v,w,A,R,W,te=[],ge=!u.once&&[],Pe=function(Ee){for(m=u.memory&&Ee,v=!0,W=A||0,A=0,R=te.length,w=!0;te&&W<R;W++)if(te[W].apply(Ee[0],Ee[1])===!1&&u.stopOnFalse){m=!1;break}w=!1,te&&(ge?ge.length&&Pe(ge.shift()):m?te=[]:_e.disable())},_e={add:function(){if(te){var Ee=te.length;(function ke(qe){g.each(qe,function(pt,Mt){var di=g.type(Mt);di==="function"?(!u.unique||!_e.has(Mt))&&te.push(Mt):Mt&&Mt.length&&di!=="string"&&ke(Mt)})})(arguments),w?R=te.length:m&&(A=Ee,Pe(m))}return this},remove:function(){return te&&g.each(arguments,function(Ee,ke){for(var qe;(qe=g.inArray(ke,te,qe))>-1;)te.splice(qe,1),w&&(qe<=R&&R--,qe<=W&&W--)}),this},has:function(Ee){return Ee?g.inArray(Ee,te)>-1:!!(te&&te.length)},empty:function(){return te=[],R=0,this},disable:function(){return te=ge=m=void 0,this},disabled:function(){return!te},lock:function(){return ge=void 0,m||_e.disable(),this},locked:function(){return!ge},fireWith:function(Ee,ke){return te&&(!v||ge)&&(ke=ke||[],ke=[Ee,ke.slice?ke.slice():ke],w?ge.push(ke):Pe(ke)),this},fire:function(){return _e.fireWith(this,arguments),this},fired:function(){return!!v}};return _e},g.extend({Deferred:function(u){var m=[["resolve","done",g.Callbacks("once memory"),"resolved"],["reject","fail",g.Callbacks("once memory"),"rejected"],["notify","progress",g.Callbacks("memory")]],v="pending",w={state:function(){return v},always:function(){return A.done(arguments).fail(arguments),this},then:function(){var R=arguments;return g.Deferred(function(W){g.each(m,function(te,ge){var Pe=g.isFunction(R[te])&&R[te];A[ge[1]](function(){var _e=Pe&&Pe.apply(this,arguments);_e&&g.isFunction(_e.promise)?_e.promise().done(W.resolve).fail(W.reject).progress(W.notify):W[ge[0]+"With"](this===w?W.promise():this,Pe?[_e]:arguments)})}),R=null}).promise()},promise:function(R){return R!=null?g.extend(R,w):w}},A={};return w.pipe=w.then,g.each(m,function(R,W){var te=W[2],ge=W[3];w[W[1]]=te.add,ge&&te.add(function(){v=ge},m[R^1][2].disable,m[2][2].lock),A[W[0]]=function(){return A[W[0]+"With"](this===A?w:this,arguments),this},A[W[0]+"With"]=te.fireWith}),w.promise(A),u&&u.call(A,A),A},when:function(u){var m=0,v=n.call(arguments),w=v.length,A=w!==1||u&&g.isFunction(u.promise)?w:0,R=A===1?u:g.Deferred(),W=function(_e,Ee,ke){return function(qe){Ee[_e]=this,ke[_e]=arguments.length>1?n.call(arguments):qe,ke===te?R.notifyWith(Ee,ke):--A||R.resolveWith(Ee,ke)}},te,ge,Pe;if(w>1)for(te=new Array(w),ge=new Array(w),Pe=new Array(w);m<w;m++)v[m]&&g.isFunction(v[m].promise)?v[m].promise().done(W(m,Pe,v)).fail(R.reject).progress(W(m,ge,te)):--A;return A||R.resolveWith(Pe,v),R.promise()}});var Ae;g.fn.ready=function(u){return g.ready.promise().done(u),this},g.extend({isReady:!1,readyWait:1,holdReady:function(u){u?g.readyWait++:g.ready(!0)},ready:function(u){(u===!0?--g.readyWait:g.isReady)||(g.isReady=!0,!(u!==!0&&--g.readyWait>0)&&(Ae.resolveWith(Q,[g]),g.fn.trigger&&g(Q).trigger("ready").off("ready")))}});function Xe(){Q.removeEventListener("DOMContentLoaded",Xe,!1),e.removeEventListener("load",Xe,!1),g.ready()}g.ready.promise=function(u){return Ae||(Ae=g.Deferred(),Q.readyState==="complete"?setTimeout(g.ready):(Q.addEventListener("DOMContentLoaded",Xe,!1),e.addEventListener("load",Xe,!1))),Ae.promise(u)},g.ready.promise();var zi=g.access=function(u,m,v,w,A,R,W){var te=0,ge=u.length,Pe=v==null;if(g.type(v)==="object"){A=!0;for(te in v)g.access(u,m,te,v[te],!0,R,W)}else if(w!==void 0&&(A=!0,g.isFunction(w)||(W=!0),Pe&&(W?(m.call(u,w),m=null):(Pe=m,m=function(_e,Ee,ke){return Pe.call(g(_e),ke)})),m))for(;te<ge;te++)m(u[te],v,W?w:w.call(u[te],te,m(u[te],v)));return A?u:Pe?m.call(u):ge?m(u[0],v):R};g.acceptData=function(u){return u.nodeType===1||u.nodeType===9||!+u.nodeType};function Ki(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=g.expando+Math.random()}Ki.uid=1,Ki.accepts=g.acceptData,Ki.prototype={key:function(u){if(!Ki.accepts(u))return 0;var m={},v=u[this.expando];if(!v){v=Ki.uid++;try{m[this.expando]={value:v},Object.defineProperties(u,m)}catch{m[this.expando]=v,g.extend(u,m)}}return this.cache[v]||(this.cache[v]={}),v},set:function(u,m,v){var w,A=this.key(u),R=this.cache[A];if(typeof m=="string")R[m]=v;else if(g.isEmptyObject(R))g.extend(this.cache[A],m);else for(w in m)R[w]=m[w];return R},get:function(u,m){var v=this.cache[this.key(u)];return m===void 0?v:v[m]},access:function(u,m,v){var w;return m===void 0||m&&typeof m=="string"&&v===void 0?(w=this.get(u,m),w!==void 0?w:this.get(u,g.camelCase(m))):(this.set(u,m,v),v!==void 0?v:m)},remove:function(u,m){var v,w,A,R=this.key(u),W=this.cache[R];if(m===void 0)this.cache[R]={};else for(g.isArray(m)?w=m.concat(m.map(g.camelCase)):(A=g.camelCase(m),m in W?w=[m,A]:(w=A,w=w in W?[w]:w.match(Ce)||[])),v=w.length;v--;)delete W[w[v]]},hasData:function(u){return!g.isEmptyObject(this.cache[u[this.expando]]||{})},discard:function(u){u[this.expando]&&delete this.cache[u[this.expando]]}};var rt=new Ki,Li=new Ki,Qt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Ri=/([A-Z])/g;function us(u,m,v){var w;if(v===void 0&&u.nodeType===1)if(w="data-"+m.replace(Ri,"-$1").toLowerCase(),v=u.getAttribute(w),typeof v=="string"){try{v=v==="true"?!0:v==="false"?!1:v==="null"?null:+v+""===v?+v:Qt.test(v)?g.parseJSON(v):v}catch{}Li.set(u,m,v)}else v=void 0;return v}g.extend({hasData:function(u){return Li.hasData(u)||rt.hasData(u)},data:function(u,m,v){return Li.access(u,m,v)},removeData:function(u,m){Li.remove(u,m)},_data:function(u,m,v){return rt.access(u,m,v)},_removeData:function(u,m){rt.remove(u,m)}}),g.fn.extend({data:function(u,m){var v,w,A,R=this[0],W=R&&R.attributes;if(u===void 0){if(this.length&&(A=Li.get(R),R.nodeType===1&&!rt.get(R,"hasDataAttrs"))){for(v=W.length;v--;)w=W[v].name,w.indexOf("data-")===0&&(w=g.camelCase(w.slice(5)),us(R,w,A[w]));rt.set(R,"hasDataAttrs",!0)}return A}return typeof u=="object"?this.each(function(){Li.set(this,u)}):zi(this,function(te){var ge,Pe=g.camelCase(u);if(R&&te===void 0)return ge=Li.get(R,u),ge!==void 0||(ge=Li.get(R,Pe),ge!==void 0)||(ge=us(R,Pe,void 0),ge!==void 0)?ge:void 0;this.each(function(){var _e=Li.get(this,Pe);Li.set(this,Pe,te),u.indexOf("-")!==-1&&_e!==void 0&&Li.set(this,u,te)})},null,m,arguments.length>1,null,!0)},removeData:function(u){return this.each(function(){Li.remove(this,u)})}}),g.extend({queue:function(u,m,v){var w;if(u)return m=(m||"fx")+"queue",w=rt.get(u,m),v&&(!w||g.isArray(v)?w=rt.access(u,m,g.makeArray(v)):w.push(v)),w||[]},dequeue:function(u,m){m=m||"fx";var v=g.queue(u,m),w=v.length,A=v.shift(),R=g._queueHooks(u,m),W=function(){g.dequeue(u,m)};A==="inprogress"&&(A=v.shift(),w--),A&&(m==="fx"&&v.unshift("inprogress"),delete R.stop,A.call(u,W,R)),!w&&R&&R.empty.fire()},_queueHooks:function(u,m){var v=m+"queueHooks";return rt.get(u,v)||rt.access(u,v,{empty:g.Callbacks("once memory").add(function(){rt.remove(u,[m+"queue",v])})})}}),g.fn.extend({queue:function(u,m){var v=2;return typeof u!="string"&&(m=u,u="fx",v--),arguments.length<v?g.queue(this[0],u):m===void 0?this:this.each(function(){var w=g.queue(this,u,m);g._queueHooks(this,u),u==="fx"&&w[0]!=="inprogress"&&g.dequeue(this,u)})},dequeue:function(u){return this.each(function(){g.dequeue(this,u)})},clearQueue:function(u){return this.queue(u||"fx",[])},promise:function(u,m){var v,w=1,A=g.Deferred(),R=this,W=this.length,te=function(){--w||A.resolveWith(R,[R])};for(typeof u!="string"&&(m=u,u=void 0),u=u||"fx";W--;)v=rt.get(R[W],u+"queueHooks"),v&&v.empty&&(w++,v.empty.add(te));return te(),A.promise(m)}});var sn=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Vt=["Top","Right","Bottom","Left"],hi=function(u,m){return u=m||u,g.css(u,"display")==="none"||!g.contains(u.ownerDocument,u)},ni=/^(?:checkbox|radio)$/i;(function(){var u=Q.createDocumentFragment(),m=u.appendChild(Q.createElement("div"));m.innerHTML="<input type='radio' checked='checked' name='t'/>",k.checkClone=m.cloneNode(!0).cloneNode(!0).lastChild.checked,m.innerHTML="<textarea>x</textarea>",k.noCloneChecked=!!m.cloneNode(!0).lastChild.defaultValue})();var vn="undefined";k.focusinBubbles="onfocusin"in e;var nn=/^key/,wa=/^(?:mouse|contextmenu)|click/,pr=/^(?:focusinfocus|focusoutblur)$/,$o=/^([^.]*)(?:\.(.+)|)$/;function Hr(){return!0}function Rn(){return!1}function Uo(){try{return Q.activeElement}catch{}}g.event={global:{},add:function(u,m,v,w,A){var R,W,te,ge,Pe,_e,Ee,ke,qe,pt,Mt,di=rt.get(u);if(di)for(v.handler&&(R=v,v=R.handler,A=R.selector),v.guid||(v.guid=g.guid++),(ge=di.events)||(ge=di.events={}),(W=di.handle)||(W=di.handle=function(an){return typeof g!==vn&&g.event.triggered!==an.type?g.event.dispatch.apply(u,arguments):void 0}),m=(m||"").match(Ce)||[""],Pe=m.length;Pe--;)te=$o.exec(m[Pe])||[],qe=Mt=te[1],pt=(te[2]||"").split(".").sort(),qe&&(Ee=g.event.special[qe]||{},qe=(A?Ee.delegateType:Ee.bindType)||qe,Ee=g.event.special[qe]||{},_e=g.extend({type:qe,origType:Mt,data:w,handler:v,guid:v.guid,selector:A,needsContext:A&&g.expr.match.needsContext.test(A),namespace:pt.join(".")},R),(ke=ge[qe])||(ke=ge[qe]=[],ke.delegateCount=0,(!Ee.setup||Ee.setup.call(u,w,pt,W)===!1)&&u.addEventListener&&u.addEventListener(qe,W,!1)),Ee.add&&(Ee.add.call(u,_e),_e.handler.guid||(_e.handler.guid=v.guid)),A?ke.splice(ke.delegateCount++,0,_e):ke.push(_e),g.event.global[qe]=!0)},remove:function(u,m,v,w,A){var R,W,te,ge,Pe,_e,Ee,ke,qe,pt,Mt,di=rt.hasData(u)&&rt.get(u);if(!(!di||!(ge=di.events))){for(m=(m||"").match(Ce)||[""],Pe=m.length;Pe--;){if(te=$o.exec(m[Pe])||[],qe=Mt=te[1],pt=(te[2]||"").split(".").sort(),!qe){for(qe in ge)g.event.remove(u,qe+m[Pe],v,w,!0);continue}for(Ee=g.event.special[qe]||{},qe=(w?Ee.delegateType:Ee.bindType)||qe,ke=ge[qe]||[],te=te[2]&&new RegExp("(^|\\.)"+pt.join("\\.(?:.*\\.|)")+"(\\.|$)"),W=R=ke.length;R--;)_e=ke[R],(A||Mt===_e.origType)&&(!v||v.guid===_e.guid)&&(!te||te.test(_e.namespace))&&(!w||w===_e.selector||w==="**"&&_e.selector)&&(ke.splice(R,1),_e.selector&&ke.delegateCount--,Ee.remove&&Ee.remove.call(u,_e));W&&!ke.length&&((!Ee.teardown||Ee.teardown.call(u,pt,di.handle)===!1)&&g.removeEvent(u,qe,di.handle),delete ge[qe])}g.isEmptyObject(ge)&&(delete di.handle,rt.remove(u,"events"))}},trigger:function(u,m,v,w){var A,R,W,te,ge,Pe,_e,Ee=[v||Q],ke=B.call(u,"type")?u.type:u,qe=B.call(u,"namespace")?u.namespace.split("."):[];if(R=W=v=v||Q,!(v.nodeType===3||v.nodeType===8)&&!pr.test(ke+g.event.triggered)&&(ke.indexOf(".")>=0&&(qe=ke.split("."),ke=qe.shift(),qe.sort()),ge=ke.indexOf(":")<0&&"on"+ke,u=u[g.expando]?u:new g.Event(ke,typeof u=="object"&&u),u.isTrigger=w?2:3,u.namespace=qe.join("."),u.namespace_re=u.namespace?new RegExp("(^|\\.)"+qe.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,u.result=void 0,u.target||(u.target=v),m=m==null?[u]:g.makeArray(m,[u]),_e=g.event.special[ke]||{},!(!w&&_e.trigger&&_e.trigger.apply(v,m)===!1))){if(!w&&!_e.noBubble&&!g.isWindow(v)){for(te=_e.delegateType||ke,pr.test(te+ke)||(R=R.parentNode);R;R=R.parentNode)Ee.push(R),W=R;W===(v.ownerDocument||Q)&&Ee.push(W.defaultView||W.parentWindow||e)}for(A=0;(R=Ee[A++])&&!u.isPropagationStopped();)u.type=A>1?te:_e.bindType||ke,Pe=(rt.get(R,"events")||{})[u.type]&&rt.get(R,"handle"),Pe&&Pe.apply(R,m),Pe=ge&&R[ge],Pe&&Pe.apply&&g.acceptData(R)&&(u.result=Pe.apply(R,m),u.result===!1&&u.preventDefault());return u.type=ke,!w&&!u.isDefaultPrevented()&&(!_e._default||_e._default.apply(Ee.pop(),m)===!1)&&g.acceptData(v)&&ge&&g.isFunction(v[ke])&&!g.isWindow(v)&&(W=v[ge],W&&(v[ge]=null),g.event.triggered=ke,v[ke](),g.event.triggered=void 0,W&&(v[ge]=W)),u.result}},dispatch:function(u){u=g.event.fix(u);var m,v,w,A,R,W=[],te=n.call(arguments),ge=(rt.get(this,"events")||{})[u.type]||[],Pe=g.event.special[u.type]||{};if(te[0]=u,u.delegateTarget=this,!(Pe.preDispatch&&Pe.preDispatch.call(this,u)===!1)){for(W=g.event.handlers.call(this,u,ge),m=0;(A=W[m++])&&!u.isPropagationStopped();)for(u.currentTarget=A.elem,v=0;(R=A.handlers[v++])&&!u.isImmediatePropagationStopped();)(!u.namespace_re||u.namespace_re.test(R.namespace))&&(u.handleObj=R,u.data=R.data,w=((g.event.special[R.origType]||{}).handle||R.handler).apply(A.elem,te),w!==void 0&&(u.result=w)===!1&&(u.preventDefault(),u.stopPropagation()));return Pe.postDispatch&&Pe.postDispatch.call(this,u),u.result}},handlers:function(u,m){var v,w,A,R,W=[],te=m.delegateCount,ge=u.target;if(te&&ge.nodeType&&(!u.button||u.type!=="click")){for(;ge!==this;ge=ge.parentNode||this)if(ge.disabled!==!0||u.type!=="click"){for(w=[],v=0;v<te;v++)R=m[v],A=R.selector+" ",w[A]===void 0&&(w[A]=R.needsContext?g(A,this).index(ge)>=0:g.find(A,this,null,[ge]).length),w[A]&&w.push(R);w.length&&W.push({elem:ge,handlers:w})}}return te<m.length&&W.push({elem:this,handlers:m.slice(te)}),W},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(u,m){return u.which==null&&(u.which=m.charCode!=null?m.charCode:m.keyCode),u}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(u,m){var v,w,A,R=m.button;return u.pageX==null&&m.clientX!=null&&(v=u.target.ownerDocument||Q,w=v.documentElement,A=v.body,u.pageX=m.clientX+(w&&w.scrollLeft||A&&A.scrollLeft||0)-(w&&w.clientLeft||A&&A.clientLeft||0),u.pageY=m.clientY+(w&&w.scrollTop||A&&A.scrollTop||0)-(w&&w.clientTop||A&&A.clientTop||0)),!u.which&&R!==void 0&&(u.which=R&1?1:R&2?3:R&4?2:0),u}},fix:function(u){if(u[g.expando])return u;var m,v,w,A=u.type,R=u,W=this.fixHooks[A];for(W||(this.fixHooks[A]=W=wa.test(A)?this.mouseHooks:nn.test(A)?this.keyHooks:{}),w=W.props?this.props.concat(W.props):this.props,u=new g.Event(R),m=w.length;m--;)v=w[m],u[v]=R[v];return u.target||(u.target=Q),u.target.nodeType===3&&(u.target=u.target.parentNode),W.filter?W.filter(u,R):u},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==Uo()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===Uo()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if(this.type==="checkbox"&&this.click&&g.nodeName(this,"input"))return this.click(),!1},_default:function(u){return g.nodeName(u.target,"a")}},beforeunload:{postDispatch:function(u){u.result!==void 0&&(u.originalEvent.returnValue=u.result)}}},simulate:function(u,m,v,w){var A=g.extend(new g.Event,v,{type:u,isSimulated:!0,originalEvent:{}});w?g.event.trigger(A,null,m):g.event.dispatch.call(m,A),A.isDefaultPrevented()&&v.preventDefault()}},g.removeEvent=function(u,m,v){u.removeEventListener&&u.removeEventListener(m,v,!1)},g.Event=function(u,m){if(!(this instanceof g.Event))return new g.Event(u,m);u&&u.type?(this.originalEvent=u,this.type=u.type,this.isDefaultPrevented=u.defaultPrevented||u.defaultPrevented===void 0&&u.getPreventDefault&&u.getPreventDefault()?Hr:Rn):this.type=u,m&&g.extend(this,m),this.timeStamp=u&&u.timeStamp||g.now(),this[g.expando]=!0},g.Event.prototype={isDefaultPrevented:Rn,isPropagationStopped:Rn,isImmediatePropagationStopped:Rn,preventDefault:function(){var u=this.originalEvent;this.isDefaultPrevented=Hr,u&&u.preventDefault&&u.preventDefault()},stopPropagation:function(){var u=this.originalEvent;this.isPropagationStopped=Hr,u&&u.stopPropagation&&u.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=Hr,this.stopPropagation()}},g.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(u,m){g.event.special[u]={delegateType:m,bindType:m,handle:function(v){var w,A=this,R=v.relatedTarget,W=v.handleObj;return(!R||R!==A&&!g.contains(A,R))&&(v.type=W.origType,w=W.handler.apply(this,arguments),v.type=m),w}}}),k.focusinBubbles||g.each({focus:"focusin",blur:"focusout"},function(u,m){var v=function(w){g.event.simulate(m,w.target,g.event.fix(w),!0)};g.event.special[m]={setup:function(){var w=this.ownerDocument||this,A=rt.access(w,m);A||w.addEventListener(u,v,!0),rt.access(w,m,(A||0)+1)},teardown:function(){var w=this.ownerDocument||this,A=rt.access(w,m)-1;A?rt.access(w,m,A):(w.removeEventListener(u,v,!0),rt.remove(w,m))}}}),g.fn.extend({on:function(u,m,v,w,A){var R,W;if(typeof u=="object"){typeof m!="string"&&(v=v||m,m=void 0);for(W in u)this.on(W,m,v,u[W],A);return this}if(v==null&&w==null?(w=m,v=m=void 0):w==null&&(typeof m=="string"?(w=v,v=void 0):(w=v,v=m,m=void 0)),w===!1)w=Rn;else if(!w)return this;return A===1&&(R=w,w=function(te){return g().off(te),R.apply(this,arguments)},w.guid=R.guid||(R.guid=g.guid++)),this.each(function(){g.event.add(this,u,w,v,m)})},one:function(u,m,v,w){return this.on(u,m,v,w,1)},off:function(u,m,v){var w,A;if(u&&u.preventDefault&&u.handleObj)return w=u.handleObj,g(u.delegateTarget).off(w.namespace?w.origType+"."+w.namespace:w.origType,w.selector,w.handler),this;if(typeof u=="object"){for(A in u)this.off(A,m,u[A]);return this}return(m===!1||typeof m=="function")&&(v=m,m=void 0),v===!1&&(v=Rn),this.each(function(){g.event.remove(this,u,v,m)})},trigger:function(u,m){return this.each(function(){g.event.trigger(u,m,this)})},triggerHandler:function(u,m){var v=this[0];if(v)return g.event.trigger(u,m,v,!0)}});var Ci=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Vr=/<([\w:]+)/,Pi=/<|&#?\w+;/,Yo=/<(?:script|style|link)/i,kt=/checked\s*(?:[^=]|=\s*.checked.)/i,s=/^$|\/(?:java|ecma)script/i,a=/^true\/(.*)/,o=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,c={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};c.optgroup=c.option,c.tbody=c.tfoot=c.colgroup=c.caption=c.thead,c.th=c.td;function d(u,m){return g.nodeName(u,"table")&&g.nodeName(m.nodeType!==11?m:m.firstChild,"tr")?u.getElementsByTagName("tbody")[0]||u.appendChild(u.ownerDocument.createElement("tbody")):u}function f(u){return u.type=(u.getAttribute("type")!==null)+"/"+u.type,u}function b(u){var m=a.exec(u.type);return m?u.type=m[1]:u.removeAttribute("type"),u}function y(u,m){for(var v=0,w=u.length;v<w;v++)rt.set(u[v],"globalEval",!m||rt.get(m[v],"globalEval"))}function L(u,m){var v,w,A,R,W,te,ge,Pe;if(m.nodeType===1){if(rt.hasData(u)&&(R=rt.access(u),W=rt.set(m,R),Pe=R.events,Pe)){delete W.handle,W.events={};for(A in Pe)for(v=0,w=Pe[A].length;v<w;v++)g.event.add(m,A,Pe[A][v])}Li.hasData(u)&&(te=Li.access(u),ge=g.extend({},te),Li.set(m,ge))}}function P(u,m){var v=u.getElementsByTagName?u.getElementsByTagName(m||"*"):u.querySelectorAll?u.querySelectorAll(m||"*"):[];return m===void 0||m&&g.nodeName(u,m)?g.merge([u],v):v}function x(u,m){var v=m.nodeName.toLowerCase();v==="input"&&ni.test(u.type)?m.checked=u.checked:(v==="input"||v==="textarea")&&(m.defaultValue=u.defaultValue)}g.extend({clone:function(u,m,v){var w,A,R,W,te=u.cloneNode(!0),ge=g.contains(u.ownerDocument,u);if(!k.noCloneChecked&&(u.nodeType===1||u.nodeType===11)&&!g.isXMLDoc(u))for(W=P(te),R=P(u),w=0,A=R.length;w<A;w++)x(R[w],W[w]);if(m)if(v)for(R=R||P(u),W=W||P(te),w=0,A=R.length;w<A;w++)L(R[w],W[w]);else L(u,te);return W=P(te,"script"),W.length>0&&y(W,!ge&&P(u,"script")),te},buildFragment:function(u,m,v,w){for(var A,R,W,te,ge,Pe,_e=m.createDocumentFragment(),Ee=[],ke=0,qe=u.length;ke<qe;ke++)if(A=u[ke],A||A===0)if(g.type(A)==="object")g.merge(Ee,A.nodeType?[A]:A);else if(!Pi.test(A))Ee.push(m.createTextNode(A));else{for(R=R||_e.appendChild(m.createElement("div")),W=(Vr.exec(A)||["",""])[1].toLowerCase(),te=c[W]||c._default,R.innerHTML=te[1]+A.replace(Ci,"<$1></$2>")+te[2],Pe=te[0];Pe--;)R=R.lastChild;g.merge(Ee,R.childNodes),R=_e.firstChild,R.textContent=""}for(_e.textContent="",ke=0;A=Ee[ke++];)if(!(w&&g.inArray(A,w)!==-1)&&(ge=g.contains(A.ownerDocument,A),R=P(_e.appendChild(A),"script"),ge&&y(R),v))for(Pe=0;A=R[Pe++];)s.test(A.type||"")&&v.push(A);return _e},cleanData:function(u){for(var m,v,w,A,R,W,te=g.event.special,ge=0;(v=u[ge])!==void 0;ge++){if(g.acceptData(v)&&(R=v[rt.expando],R&&(m=rt.cache[R]))){if(w=Object.keys(m.events||{}),w.length)for(W=0;(A=w[W])!==void 0;W++)te[A]?g.event.remove(v,A):g.removeEvent(v,A,m.handle);rt.cache[R]&&delete rt.cache[R]}delete Li.cache[v[Li.expando]]}}}),g.fn.extend({text:function(u){return zi(this,function(m){return m===void 0?g.text(this):this.empty().each(function(){(this.nodeType===1||this.nodeType===11||this.nodeType===9)&&(this.textContent=m)})},null,u,arguments.length)},append:function(){return this.domManip(arguments,function(u){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var m=d(this,u);m.appendChild(u)}})},prepend:function(){return this.domManip(arguments,function(u){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var m=d(this,u);m.insertBefore(u,m.firstChild)}})},before:function(){return this.domManip(arguments,function(u){this.parentNode&&this.parentNode.insertBefore(u,this)})},after:function(){return this.domManip(arguments,function(u){this.parentNode&&this.parentNode.insertBefore(u,this.nextSibling)})},remove:function(u,m){for(var v,w=u?g.filter(u,this):this,A=0;(v=w[A])!=null;A++)!m&&v.nodeType===1&&g.cleanData(P(v)),v.parentNode&&(m&&g.contains(v.ownerDocument,v)&&y(P(v,"script")),v.parentNode.removeChild(v));return this},empty:function(){for(var u,m=0;(u=this[m])!=null;m++)u.nodeType===1&&(g.cleanData(P(u,!1)),u.textContent="");return this},clone:function(u,m){return u=u??!1,m=m??u,this.map(function(){return g.clone(this,u,m)})},html:function(u){return zi(this,function(m){var v=this[0]||{},w=0,A=this.length;if(m===void 0&&v.nodeType===1)return v.innerHTML;if(typeof m=="string"&&!Yo.test(m)&&!c[(Vr.exec(m)||["",""])[1].toLowerCase()]){m=m.replace(Ci,"<$1></$2>");try{for(;w<A;w++)v=this[w]||{},v.nodeType===1&&(g.cleanData(P(v,!1)),v.innerHTML=m);v=0}catch{}}v&&this.empty().append(m)},null,u,arguments.length)},replaceWith:function(){var u=arguments[0];return this.domManip(arguments,function(m){u=this.parentNode,g.cleanData(P(this)),u&&u.replaceChild(m,this)}),u&&(u.length||u.nodeType)?this:this.remove()},detach:function(u){return this.remove(u,!0)},domManip:function(u,m){u=r.apply([],u);var v,w,A,R,W,te,ge=0,Pe=this.length,_e=this,Ee=Pe-1,ke=u[0],qe=g.isFunction(ke);if(qe||Pe>1&&typeof ke=="string"&&!k.checkClone&&kt.test(ke))return this.each(function(pt){var Mt=_e.eq(pt);qe&&(u[0]=ke.call(this,pt,Mt.html())),Mt.domManip(u,m)});if(Pe&&(v=g.buildFragment(u,this[0].ownerDocument,!1,this),w=v.firstChild,v.childNodes.length===1&&(v=w),w)){for(A=g.map(P(v,"script"),f),R=A.length;ge<Pe;ge++)W=v,ge!==Ee&&(W=g.clone(W,!0,!0),R&&g.merge(A,P(W,"script"))),m.call(this[ge],W,ge);if(R)for(te=A[A.length-1].ownerDocument,g.map(A,b),ge=0;ge<R;ge++)W=A[ge],s.test(W.type||"")&&!rt.access(W,"globalEval")&&g.contains(te,W)&&(W.src?g._evalUrl&&g._evalUrl(W.src):g.globalEval(W.textContent.replace(o,"")))}return this}}),g.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(u,m){g.fn[u]=function(v){for(var w,A=[],R=g(v),W=R.length-1,te=0;te<=W;te++)w=te===W?this:this.clone(!0),g(R[te])[m](w),h.apply(A,w.get());return this.pushStack(A)}});var E,I={};function T(u,m){var v=g(m.createElement(u)).appendTo(m.body),w=e.getDefaultComputedStyle?e.getDefaultComputedStyle(v[0]).display:g.css(v[0],"display");return v.detach(),w}function M(u){var m=Q,v=I[u];return v||(v=T(u,m),(v==="none"||!v)&&(E=(E||g("<iframe frameborder='0' width='0' height='0'/>")).appendTo(m.documentElement),m=E[0].contentDocument,m.write(),m.close(),v=T(u,m),E.detach()),I[u]=v),v}var V=/^margin/,z=new RegExp("^("+sn+")(?!px)[a-z%]+$","i"),N=function(u){return u.ownerDocument.defaultView.getComputedStyle(u,null)};function F(u,m,v){var w,A,R,W,te=u.style;return v=v||N(u),v&&(W=v.getPropertyValue(m)||v[m]),v&&(W===""&&!g.contains(u.ownerDocument,u)&&(W=g.style(u,m)),z.test(W)&&V.test(m)&&(w=te.width,A=te.minWidth,R=te.maxWidth,te.minWidth=te.maxWidth=te.width=W,W=v.width,te.width=w,te.minWidth=A,te.maxWidth=R)),W!==void 0?W+"":W}function D(u,m){return{get:function(){if(u()){delete this.get;return}return(this.get=m).apply(this,arguments)}}}(function(){var u,m,v="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",w=Q.documentElement,A=Q.createElement("div"),R=Q.createElement("div");R.style.backgroundClip="content-box",R.cloneNode(!0).style.backgroundClip="",k.clearCloneStyle=R.style.backgroundClip==="content-box",A.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",A.appendChild(R);function W(){R.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",w.appendChild(A);var te=e.getComputedStyle(R,null);u=te.top!=="1%",m=te.width==="4px",w.removeChild(A)}e.getComputedStyle&&g.extend(k,{pixelPosition:function(){return W(),u},boxSizingReliable:function(){return m==null&&W(),m},reliableMarginRight:function(){var te,ge=R.appendChild(Q.createElement("div"));return ge.style.cssText=R.style.cssText=v,ge.style.marginRight=ge.style.width="0",R.style.width="1px",w.appendChild(A),te=!parseFloat(e.getComputedStyle(ge,null).marginRight),w.removeChild(A),R.innerHTML="",te}})})(),g.swap=function(u,m,v,w){var A,R,W={};for(R in m)W[R]=u.style[R],u.style[R]=m[R];A=v.apply(u,w||[]);for(R in m)u.style[R]=W[R];return A};var O=/^(none|table(?!-c[ea]).+)/,H=new RegExp("^("+sn+")(.*)$","i"),G=new RegExp("^([+-])=("+sn+")","i"),K={position:"absolute",visibility:"hidden",display:"block"},j={letterSpacing:0,fontWeight:400},J=["Webkit","O","Moz","ms"];function ee(u,m){if(m in u)return m;for(var v=m[0].toUpperCase()+m.slice(1),w=m,A=J.length;A--;)if(m=J[A]+v,m in u)return m;return w}function re(u,m,v){var w=H.exec(m);return w?Math.max(0,w[1]-(v||0))+(w[2]||"px"):m}function ie(u,m,v,w,A){for(var R=v===(w?"border":"content")?4:m==="width"?1:0,W=0;R<4;R+=2)v==="margin"&&(W+=g.css(u,v+Vt[R],!0,A)),w?(v==="content"&&(W-=g.css(u,"padding"+Vt[R],!0,A)),v!=="margin"&&(W-=g.css(u,"border"+Vt[R]+"Width",!0,A))):(W+=g.css(u,"padding"+Vt[R],!0,A),v!=="padding"&&(W+=g.css(u,"border"+Vt[R]+"Width",!0,A)));return W}function oe(u,m,v){var w=!0,A=m==="width"?u.offsetWidth:u.offsetHeight,R=N(u),W=g.css(u,"boxSizing",!1,R)==="border-box";if(A<=0||A==null){if(A=F(u,m,R),(A<0||A==null)&&(A=u.style[m]),z.test(A))return A;w=W&&(k.boxSizingReliable()||A===u.style[m]),A=parseFloat(A)||0}return A+ie(u,m,v||(W?"border":"content"),w,R)+"px"}function le(u,m){for(var v,w,A,R=[],W=0,te=u.length;W<te;W++)w=u[W],w.style&&(R[W]=rt.get(w,"olddisplay"),v=w.style.display,m?(!R[W]&&v==="none"&&(w.style.display=""),w.style.display===""&&hi(w)&&(R[W]=rt.access(w,"olddisplay",M(w.nodeName)))):R[W]||(A=hi(w),(v&&v!=="none"||!A)&&rt.set(w,"olddisplay",A?v:g.css(w,"display"))));for(W=0;W<te;W++)w=u[W],w.style&&(!m||w.style.display==="none"||w.style.display==="")&&(w.style.display=m?R[W]||"":"none");return u}g.extend({cssHooks:{opacity:{get:function(u,m){if(m){var v=F(u,"opacity");return v===""?"1":v}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(u,m,v,w){if(!(!u||u.nodeType===3||u.nodeType===8||!u.style)){var A,R,W,te=g.camelCase(m),ge=u.style;if(m=g.cssProps[te]||(g.cssProps[te]=ee(ge,te)),W=g.cssHooks[m]||g.cssHooks[te],v!==void 0){if(R=typeof v,R==="string"&&(A=G.exec(v))&&(v=(A[1]+1)*A[2]+parseFloat(g.css(u,m)),R="number"),v==null||v!==v)return;R==="number"&&!g.cssNumber[te]&&(v+="px"),!k.clearCloneStyle&&v===""&&m.indexOf("background")===0&&(ge[m]="inherit"),(!W||!("set"in W)||(v=W.set(u,v,w))!==void 0)&&(ge[m]="",ge[m]=v)}else return W&&"get"in W&&(A=W.get(u,!1,w))!==void 0?A:ge[m]}},css:function(u,m,v,w){var A,R,W,te=g.camelCase(m);return m=g.cssProps[te]||(g.cssProps[te]=ee(u.style,te)),W=g.cssHooks[m]||g.cssHooks[te],W&&"get"in W&&(A=W.get(u,!0,v)),A===void 0&&(A=F(u,m,w)),A==="normal"&&m in j&&(A=j[m]),v===""||v?(R=parseFloat(A),v===!0||g.isNumeric(R)?R||0:A):A}}),g.each(["height","width"],function(u,m){g.cssHooks[m]={get:function(v,w,A){if(w)return v.offsetWidth===0&&O.test(g.css(v,"display"))?g.swap(v,K,function(){return oe(v,m,A)}):oe(v,m,A)},set:function(v,w,A){var R=A&&N(v);return re(v,w,A?ie(v,m,A,g.css(v,"boxSizing",!1,R)==="border-box",R):0)}}}),g.cssHooks.marginRight=D(k.reliableMarginRight,function(u,m){if(m)return g.swap(u,{display:"inline-block"},F,[u,"marginRight"])}),g.each({margin:"",padding:"",border:"Width"},function(u,m){g.cssHooks[u+m]={expand:function(v){for(var w=0,A={},R=typeof v=="string"?v.split(" "):[v];w<4;w++)A[u+Vt[w]+m]=R[w]||R[w-2]||R[0];return A}},V.test(u)||(g.cssHooks[u+m].set=re)}),g.fn.extend({css:function(u,m){return zi(this,function(v,w,A){var R,W,te={},ge=0;if(g.isArray(w)){for(R=N(v),W=w.length;ge<W;ge++)te[w[ge]]=g.css(v,w[ge],!1,R);return te}return A!==void 0?g.style(v,w,A):g.css(v,w)},u,m,arguments.length>1)},show:function(){return le(this,!0)},hide:function(){return le(this)},toggle:function(u){return typeof u=="boolean"?u?this.show():this.hide():this.each(function(){hi(this)?g(this).show():g(this).hide()})}});function pe(u,m,v,w,A){return new pe.prototype.init(u,m,v,w,A)}g.Tween=pe,pe.prototype={constructor:pe,init:function(u,m,v,w,A,R){this.elem=u,this.prop=v,this.easing=A||"swing",this.options=m,this.start=this.now=this.cur(),this.end=w,this.unit=R||(g.cssNumber[v]?"":"px")},cur:function(){var u=pe.propHooks[this.prop];return u&&u.get?u.get(this):pe.propHooks._default.get(this)},run:function(u){var m,v=pe.propHooks[this.prop];return this.options.duration?this.pos=m=g.easing[this.easing](u,this.options.duration*u,0,1,this.options.duration):this.pos=m=u,this.now=(this.end-this.start)*m+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),v&&v.set?v.set(this):pe.propHooks._default.set(this),this}},pe.prototype.init.prototype=pe.prototype,pe.propHooks={_default:{get:function(u){var m;return u.elem[u.prop]!=null&&(!u.elem.style||u.elem.style[u.prop]==null)?u.elem[u.prop]:(m=g.css(u.elem,u.prop,""),!m||m==="auto"?0:m)},set:function(u){g.fx.step[u.prop]?g.fx.step[u.prop](u):u.elem.style&&(u.elem.style[g.cssProps[u.prop]]!=null||g.cssHooks[u.prop])?g.style(u.elem,u.prop,u.now+u.unit):u.elem[u.prop]=u.now}}},pe.propHooks.scrollTop=pe.propHooks.scrollLeft={set:function(u){u.elem.nodeType&&u.elem.parentNode&&(u.elem[u.prop]=u.now)}},g.easing={linear:function(u){return u},swing:function(u){return .5-Math.cos(u*Math.PI)/2}},g.fx=pe.prototype.init,g.fx.step={};var be,Le,Ne=/^(?:toggle|show|hide)$/,He=new RegExp("^(?:([+-])=|)("+sn+")([a-z%]*)$","i"),Ue=/queueHooks$/,nt=[at],et={"*":[function(u,m){var v=this.createTween(u,m),w=v.cur(),A=He.exec(m),R=A&&A[3]||(g.cssNumber[u]?"":"px"),W=(g.cssNumber[u]||R!=="px"&&+w)&&He.exec(g.css(v.elem,u)),te=1,ge=20;if(W&&W[3]!==R){R=R||W[3],A=A||[],W=+w||1;do te=te||".5",W=W/te,g.style(v.elem,u,W+R);while(te!==(te=v.cur()/w)&&te!==1&&--ge)}return A&&(W=v.start=+W||+w||0,v.unit=R,v.end=A[1]?W+(A[1]+1)*A[2]:+A[2]),v}]};function tt(){return setTimeout(function(){be=void 0}),be=g.now()}function Je(u,m){var v,w=0,A={height:u};for(m=m?1:0;w<4;w+=2-m)v=Vt[w],A["margin"+v]=A["padding"+v]=u;return m&&(A.opacity=A.width=u),A}function ct(u,m,v){for(var w,A=(et[m]||[]).concat(et["*"]),R=0,W=A.length;R<W;R++)if(w=A[R].call(v,m,u))return w}function at(u,m,v){var w,A,R,W,te,ge,Pe,_e=this,Ee={},ke=u.style,qe=u.nodeType&&hi(u),pt=rt.get(u,"fxshow");v.queue||(te=g._queueHooks(u,"fx"),te.unqueued==null&&(te.unqueued=0,ge=te.empty.fire,te.empty.fire=function(){te.unqueued||ge()}),te.unqueued++,_e.always(function(){_e.always(function(){te.unqueued--,g.queue(u,"fx").length||te.empty.fire()})})),u.nodeType===1&&("height"in m||"width"in m)&&(v.overflow=[ke.overflow,ke.overflowX,ke.overflowY],Pe=g.css(u,"display"),Pe==="none"&&(Pe=M(u.nodeName)),Pe==="inline"&&g.css(u,"float")==="none"&&(ke.display="inline-block")),v.overflow&&(ke.overflow="hidden",_e.always(function(){ke.overflow=v.overflow[0],ke.overflowX=v.overflow[1],ke.overflowY=v.overflow[2]}));for(w in m)if(A=m[w],Ne.exec(A)){if(delete m[w],R=R||A==="toggle",A===(qe?"hide":"show"))if(A==="show"&&pt&&pt[w]!==void 0)qe=!0;else continue;Ee[w]=pt&&pt[w]||g.style(u,w)}if(!g.isEmptyObject(Ee)){pt?"hidden"in pt&&(qe=pt.hidden):pt=rt.access(u,"fxshow",{}),R&&(pt.hidden=!qe),qe?g(u).show():_e.done(function(){g(u).hide()}),_e.done(function(){var Mt;rt.remove(u,"fxshow");for(Mt in Ee)g.style(u,Mt,Ee[Mt])});for(w in Ee)W=ct(qe?pt[w]:0,w,_e),w in pt||(pt[w]=W.start,qe&&(W.end=W.start,W.start=w==="width"||w==="height"?1:0))}}function Ut(u,m){var v,w,A,R,W;for(v in u)if(w=g.camelCase(v),A=m[w],R=u[v],g.isArray(R)&&(A=R[1],R=u[v]=R[0]),v!==w&&(u[w]=R,delete u[v]),W=g.cssHooks[w],W&&"expand"in W){R=W.expand(R),delete u[w];for(v in R)v in u||(u[v]=R[v],m[v]=A)}else m[w]=A}function Pt(u,m,v){var w,A,R=0,W=nt.length,te=g.Deferred().always(function(){delete ge.elem}),ge=function(){if(A)return!1;for(var Ee=be||tt(),ke=Math.max(0,Pe.startTime+Pe.duration-Ee),qe=ke/Pe.duration||0,pt=1-qe,Mt=0,di=Pe.tweens.length;Mt<di;Mt++)Pe.tweens[Mt].run(pt);return te.notifyWith(u,[Pe,pt,ke]),pt<1&&di?ke:(te.resolveWith(u,[Pe]),!1)},Pe=te.promise({elem:u,props:g.extend({},m),opts:g.extend(!0,{specialEasing:{}},v),originalProperties:m,originalOptions:v,startTime:be||tt(),duration:v.duration,tweens:[],createTween:function(Ee,ke){var qe=g.Tween(u,Pe.opts,Ee,ke,Pe.opts.specialEasing[Ee]||Pe.opts.easing);return Pe.tweens.push(qe),qe},stop:function(Ee){var ke=0,qe=Ee?Pe.tweens.length:0;if(A)return this;for(A=!0;ke<qe;ke++)Pe.tweens[ke].run(1);return Ee?te.resolveWith(u,[Pe,Ee]):te.rejectWith(u,[Pe,Ee]),this}}),_e=Pe.props;for(Ut(_e,Pe.opts.specialEasing);R<W;R++)if(w=nt[R].call(Pe,u,_e,Pe.opts),w)return w;return g.map(_e,ct,Pe),g.isFunction(Pe.opts.start)&&Pe.opts.start.call(u,Pe),g.fx.timer(g.extend(ge,{elem:u,anim:Pe,queue:Pe.opts.queue})),Pe.progress(Pe.opts.progress).done(Pe.opts.done,Pe.opts.complete).fail(Pe.opts.fail).always(Pe.opts.always)}g.Animation=g.extend(Pt,{tweener:function(u,m){g.isFunction(u)?(m=u,u=["*"]):u=u.split(" ");for(var v,w=0,A=u.length;w<A;w++)v=u[w],et[v]=et[v]||[],et[v].unshift(m)},prefilter:function(u,m){m?nt.unshift(u):nt.push(u)}}),g.speed=function(u,m,v){var w=u&&typeof u=="object"?g.extend({},u):{complete:v||!v&&m||g.isFunction(u)&&u,duration:u,easing:v&&m||m&&!g.isFunction(m)&&m};return w.duration=g.fx.off?0:typeof w.duration=="number"?w.duration:w.duration in g.fx.speeds?g.fx.speeds[w.duration]:g.fx.speeds._default,(w.queue==null||w.queue===!0)&&(w.queue="fx"),w.old=w.complete,w.complete=function(){g.isFunction(w.old)&&w.old.call(this),w.queue&&g.dequeue(this,w.queue)},w},g.fn.extend({fadeTo:function(u,m,v,w){return this.filter(hi).css("opacity",0).show().end().animate({opacity:m},u,v,w)},animate:function(u,m,v,w){var A=g.isEmptyObject(u),R=g.speed(m,v,w),W=function(){var te=Pt(this,g.extend({},u),R);(A||rt.get(this,"finish"))&&te.stop(!0)};return W.finish=W,A||R.queue===!1?this.each(W):this.queue(R.queue,W)},stop:function(u,m,v){var w=function(A){var R=A.stop;delete A.stop,R(v)};return typeof u!="string"&&(v=m,m=u,u=void 0),m&&u!==!1&&this.queue(u||"fx",[]),this.each(function(){var A=!0,R=u!=null&&u+"queueHooks",W=g.timers,te=rt.get(this);if(R)te[R]&&te[R].stop&&w(te[R]);else for(R in te)te[R]&&te[R].stop&&Ue.test(R)&&w(te[R]);for(R=W.length;R--;)W[R].elem===this&&(u==null||W[R].queue===u)&&(W[R].anim.stop(v),A=!1,W.splice(R,1));(A||!v)&&g.dequeue(this,u)})},finish:function(u){return u!==!1&&(u=u||"fx"),this.each(function(){var m,v=rt.get(this),w=v[u+"queue"],A=v[u+"queueHooks"],R=g.timers,W=w?w.length:0;for(v.finish=!0,g.queue(this,u,[]),A&&A.stop&&A.stop.call(this,!0),m=R.length;m--;)R[m].elem===this&&R[m].queue===u&&(R[m].anim.stop(!0),R.splice(m,1));for(m=0;m<W;m++)w[m]&&w[m].finish&&w[m].finish.call(this);delete v.finish})}}),g.each(["toggle","show","hide"],function(u,m){var v=g.fn[m];g.fn[m]=function(w,A,R){return w==null||typeof w=="boolean"?v.apply(this,arguments):this.animate(Je(m,!0),w,A,R)}}),g.each({slideDown:Je("show"),slideUp:Je("hide"),slideToggle:Je("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(u,m){g.fn[u]=function(v,w,A){return this.animate(m,v,w,A)}}),g.timers=[],g.fx.tick=function(){var u,m=0,v=g.timers;for(be=g.now();m<v.length;m++)u=v[m],!u()&&v[m]===u&&v.splice(m--,1);v.length||g.fx.stop(),be=void 0},g.fx.timer=function(u){g.timers.push(u),u()?g.fx.start():g.timers.pop()},g.fx.interval=13,g.fx.start=function(){Le||(Le=setInterval(g.fx.tick,g.fx.interval))},g.fx.stop=function(){clearInterval(Le),Le=null},g.fx.speeds={slow:600,fast:200,_default:400},g.fn.delay=function(u,m){return u=g.fx&&g.fx.speeds[u]||u,m=m||"fx",this.queue(m,function(v,w){var A=setTimeout(v,u);w.stop=function(){clearTimeout(A)}})},function(){var u=Q.createElement("input"),m=Q.createElement("select"),v=m.appendChild(Q.createElement("option"));u.type="checkbox",k.checkOn=u.value!=="",k.optSelected=v.selected,m.disabled=!0,k.optDisabled=!v.disabled,u=Q.createElement("input"),u.value="t",u.type="radio",k.radioValue=u.value==="t"}();var At,Ot,_t=g.expr.attrHandle;g.fn.extend({attr:function(u,m){return zi(this,g.attr,u,m,arguments.length>1)},removeAttr:function(u){return this.each(function(){g.removeAttr(this,u)})}}),g.extend({attr:function(u,m,v){var w,A,R=u.nodeType;if(!(!u||R===3||R===8||R===2)){if(typeof u.getAttribute===vn)return g.prop(u,m,v);if((R!==1||!g.isXMLDoc(u))&&(m=m.toLowerCase(),w=g.attrHooks[m]||(g.expr.match.bool.test(m)?Ot:At)),v!==void 0)if(v===null)g.removeAttr(u,m);else return w&&"set"in w&&(A=w.set(u,v,m))!==void 0?A:(u.setAttribute(m,v+""),v);else return w&&"get"in w&&(A=w.get(u,m))!==null?A:(A=g.find.attr(u,m),A??void 0)}},removeAttr:function(u,m){var v,w,A=0,R=m&&m.match(Ce);if(R&&u.nodeType===1)for(;v=R[A++];)w=g.propFix[v]||v,g.expr.match.bool.test(v)&&(u[w]=!1),u.removeAttribute(v)},attrHooks:{type:{set:function(u,m){if(!k.radioValue&&m==="radio"&&g.nodeName(u,"input")){var v=u.value;return u.setAttribute("type",m),v&&(u.value=v),m}}}}}),Ot={set:function(u,m,v){return m===!1?g.removeAttr(u,v):u.setAttribute(v,v),v}},g.each(g.expr.match.bool.source.match(/\w+/g),function(u,m){var v=_t[m]||g.find.attr;_t[m]=function(w,A,R){var W,te;return R||(te=_t[A],_t[A]=W,W=v(w,A,R)!=null?A.toLowerCase():null,_t[A]=te),W}});var Wi=/^(?:input|select|textarea|button)$/i;g.fn.extend({prop:function(u,m){return zi(this,g.prop,u,m,arguments.length>1)},removeProp:function(u){return this.each(function(){delete this[g.propFix[u]||u]})}}),g.extend({propFix:{for:"htmlFor",class:"className"},prop:function(u,m,v){var w,A,R,W=u.nodeType;if(!(!u||W===3||W===8||W===2))return R=W!==1||!g.isXMLDoc(u),R&&(m=g.propFix[m]||m,A=g.propHooks[m]),v!==void 0?A&&"set"in A&&(w=A.set(u,v,m))!==void 0?w:u[m]=v:A&&"get"in A&&(w=A.get(u,m))!==null?w:u[m]},propHooks:{tabIndex:{get:function(u){return u.hasAttribute("tabindex")||Wi.test(u.nodeName)||u.href?u.tabIndex:-1}}}}),k.optSelected||(g.propHooks.selected={get:function(u){var m=u.parentNode;return m&&m.parentNode&&m.parentNode.selectedIndex,null}}),g.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){g.propFix[this.toLowerCase()]=this});var Oi=/[\t\r\n\f]/g;g.fn.extend({addClass:function(u){var m,v,w,A,R,W,te=typeof u=="string"&&u,ge=0,Pe=this.length;if(g.isFunction(u))return this.each(function(_e){g(this).addClass(u.call(this,_e,this.className))});if(te){for(m=(u||"").match(Ce)||[];ge<Pe;ge++)if(v=this[ge],w=v.nodeType===1&&(v.className?(" "+v.className+" ").replace(Oi," "):" "),w){for(R=0;A=m[R++];)w.indexOf(" "+A+" ")<0&&(w+=A+" ");W=g.trim(w),v.className!==W&&(v.className=W)}}return this},removeClass:function(u){var m,v,w,A,R,W,te=arguments.length===0||typeof u=="string"&&u,ge=0,Pe=this.length;if(g.isFunction(u))return this.each(function(_e){g(this).removeClass(u.call(this,_e,this.className))});if(te){for(m=(u||"").match(Ce)||[];ge<Pe;ge++)if(v=this[ge],w=v.nodeType===1&&(v.className?(" "+v.className+" ").replace(Oi," "):""),w){for(R=0;A=m[R++];)for(;w.indexOf(" "+A+" ")>=0;)w=w.replace(" "+A+" "," ");W=u?g.trim(w):"",v.className!==W&&(v.className=W)}}return this},toggleClass:function(u,m){var v=typeof u;return typeof m=="boolean"&&v==="string"?m?this.addClass(u):this.removeClass(u):g.isFunction(u)?this.each(function(w){g(this).toggleClass(u.call(this,w,this.className,m),m)}):this.each(function(){if(v==="string")for(var w,A=0,R=g(this),W=u.match(Ce)||[];w=W[A++];)R.hasClass(w)?R.removeClass(w):R.addClass(w);else(v===vn||v==="boolean")&&(this.className&&rt.set(this,"__className__",this.className),this.className=this.className||u===!1?"":rt.get(this,"__className__")||"")})},hasClass:function(u){for(var m=" "+u+" ",v=0,w=this.length;v<w;v++)if(this[v].nodeType===1&&(" "+this[v].className+" ").replace(Oi," ").indexOf(m)>=0)return!0;return!1}});var Xi=/\r/g;g.fn.extend({val:function(u){var m,v,w,A=this[0];return arguments.length?(w=g.isFunction(u),this.each(function(R){var W;this.nodeType===1&&(w?W=u.call(this,R,g(this).val()):W=u,W==null?W="":typeof W=="number"?W+="":g.isArray(W)&&(W=g.map(W,function(te){return te==null?"":te+""})),m=g.valHooks[this.type]||g.valHooks[this.nodeName.toLowerCase()],(!m||!("set"in m)||m.set(this,W,"value")===void 0)&&(this.value=W))})):A?(m=g.valHooks[A.type]||g.valHooks[A.nodeName.toLowerCase()],m&&"get"in m&&(v=m.get(A,"value"))!==void 0?v:(v=A.value,typeof v=="string"?v.replace(Xi,""):v??"")):void 0}}),g.extend({valHooks:{select:{get:function(u){for(var m,v,w=u.options,A=u.selectedIndex,R=u.type==="select-one"||A<0,W=R?null:[],te=R?A+1:w.length,ge=A<0?te:R?A:0;ge<te;ge++)if(v=w[ge],(v.selected||ge===A)&&(k.optDisabled?!v.disabled:v.getAttribute("disabled")===null)&&(!v.parentNode.disabled||!g.nodeName(v.parentNode,"optgroup"))){if(m=g(v).val(),R)return m;W.push(m)}return W},set:function(u,m){for(var v,w,A=u.options,R=g.makeArray(m),W=A.length;W--;)w=A[W],(w.selected=g.inArray(g(w).val(),R)>=0)&&(v=!0);return v||(u.selectedIndex=-1),R}}}}),g.each(["radio","checkbox"],function(){g.valHooks[this]={set:function(u,m){if(g.isArray(m))return u.checked=g.inArray(g(u).val(),m)>=0}},k.checkOn||(g.valHooks[this].get=function(u){return u.getAttribute("value")===null?"on":u.value})}),g.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(u,m){g.fn[m]=function(v,w){return arguments.length>0?this.on(m,null,v,w):this.trigger(m)}}),g.fn.extend({hover:function(u,m){return this.mouseenter(u).mouseleave(m||u)},bind:function(u,m,v){return this.on(u,null,m,v)},unbind:function(u,m){return this.off(u,null,m)},delegate:function(u,m,v,w){return this.on(m,u,v,w)},undelegate:function(u,m,v){return arguments.length===1?this.off(u,"**"):this.off(m,u||"**",v)}});var Ti=g.now(),Xt=/\?/;g.parseJSON=function(u){return JSON.parse(u+"")},g.parseXML=function(u){var m,v;if(!u||typeof u!="string")return null;try{v=new DOMParser,m=v.parseFromString(u,"text/xml")}catch{m=void 0}return(!m||m.getElementsByTagName("parsererror").length)&&g.error("Invalid XML: "+u),m};var ci,Mi,$i=/#.*$/,zs=/([?&])_=[^&]*/,gr=/^(.*?):[ \t]*([^\r\n]*)$/mg,rn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,_n=/^(?:GET|HEAD)$/,Ls=/^\/\//,Ps=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,fr={},Ws={},Ko="*/".concat("*");try{Mi=location.href}catch{Mi=Q.createElement("a"),Mi.href="",Mi=Mi.href}ci=Ps.exec(Mi.toLowerCase())||[];function pd(u){return function(m,v){typeof m!="string"&&(v=m,m="*");var w,A=0,R=m.toLowerCase().match(Ce)||[];if(g.isFunction(v))for(;w=R[A++];)w[0]==="+"?(w=w.slice(1)||"*",(u[w]=u[w]||[]).unshift(v)):(u[w]=u[w]||[]).push(v)}}function gd(u,m,v,w){var A={},R=u===Ws;function W(te){var ge;return A[te]=!0,g.each(u[te]||[],function(Pe,_e){var Ee=_e(m,v,w);if(typeof Ee=="string"&&!R&&!A[Ee])return m.dataTypes.unshift(Ee),W(Ee),!1;if(R)return!(ge=Ee)}),ge}return W(m.dataTypes[0])||!A["*"]&&W("*")}function ah(u,m){var v,w,A=g.ajaxSettings.flatOptions||{};for(v in m)m[v]!==void 0&&((A[v]?u:w||(w={}))[v]=m[v]);return w&&g.extend(!0,u,w),u}function Hm(u,m,v){for(var w,A,R,W,te=u.contents,ge=u.dataTypes;ge[0]==="*";)ge.shift(),w===void 0&&(w=u.mimeType||m.getResponseHeader("Content-Type"));if(w){for(A in te)if(te[A]&&te[A].test(w)){ge.unshift(A);break}}if(ge[0]in v)R=ge[0];else{for(A in v){if(!ge[0]||u.converters[A+" "+ge[0]]){R=A;break}W||(W=A)}R=R||W}if(R)return R!==ge[0]&&ge.unshift(R),v[R]}function Vm(u,m,v,w){var A,R,W,te,ge,Pe={},_e=u.dataTypes.slice();if(_e[1])for(W in u.converters)Pe[W.toLowerCase()]=u.converters[W];for(R=_e.shift();R;)if(u.responseFields[R]&&(v[u.responseFields[R]]=m),!ge&&w&&u.dataFilter&&(m=u.dataFilter(m,u.dataType)),ge=R,R=_e.shift(),R){if(R==="*")R=ge;else if(ge!=="*"&&ge!==R){if(W=Pe[ge+" "+R]||Pe["* "+R],!W){for(A in Pe)if(te=A.split(" "),te[1]===R&&(W=Pe[ge+" "+te[0]]||Pe["* "+te[0]],W)){W===!0?W=Pe[A]:Pe[A]!==!0&&(R=te[0],_e.unshift(te[1]));break}}if(W!==!0)if(W&&u.throws)m=W(m);else try{m=W(m)}catch(Ee){return{state:"parsererror",error:W?Ee:"No conversion from "+ge+" to "+R}}}}return{state:"success",data:m}}g.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Mi,type:"GET",isLocal:rn.test(ci[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ko,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":g.parseJSON,"text xml":g.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(u,m){return m?ah(ah(u,g.ajaxSettings),m):ah(g.ajaxSettings,u)},ajaxPrefilter:pd(fr),ajaxTransport:pd(Ws),ajax:function(u,m){typeof u=="object"&&(m=u,u=void 0),m=m||{};var v,w,A,R,W,te,ge,Pe,_e=g.ajaxSetup({},m),Ee=_e.context||_e,ke=_e.context&&(Ee.nodeType||Ee.jquery)?g(Ee):g.event,qe=g.Deferred(),pt=g.Callbacks("once memory"),Mt=_e.statusCode||{},di={},an={},Yt=0,ds="canceled",gt={readyState:0,getResponseHeader:function(Kt){var Di;if(Yt===2){if(!R)for(R={};Di=gr.exec(A);)R[Di[1].toLowerCase()]=Di[2];Di=R[Kt.toLowerCase()]}return Di??null},getAllResponseHeaders:function(){return Yt===2?A:null},setRequestHeader:function(Kt,Di){var Bn=Kt.toLowerCase();return Yt||(Kt=an[Bn]=an[Bn]||Kt,di[Kt]=Di),this},overrideMimeType:function(Kt){return Yt||(_e.mimeType=Kt),this},statusCode:function(Kt){var Di;if(Kt)if(Yt<2)for(Di in Kt)Mt[Di]=[Mt[Di],Kt[Di]];else gt.always(Kt[gt.status]);return this},abort:function(Kt){var Di=Kt||ds;return v&&v.abort(Di),Gr(0,Di),this}};if(qe.promise(gt).complete=pt.add,gt.success=gt.done,gt.error=gt.fail,_e.url=((u||_e.url||Mi)+"").replace($i,"").replace(Ls,ci[1]+"//"),_e.type=m.method||m.type||_e.method||_e.type,_e.dataTypes=g.trim(_e.dataType||"*").toLowerCase().match(Ce)||[""],_e.crossDomain==null&&(te=Ps.exec(_e.url.toLowerCase()),_e.crossDomain=!!(te&&(te[1]!==ci[1]||te[2]!==ci[2]||(te[3]||(te[1]==="http:"?"80":"443"))!==(ci[3]||(ci[1]==="http:"?"80":"443"))))),_e.data&&_e.processData&&typeof _e.data!="string"&&(_e.data=g.param(_e.data,_e.traditional)),gd(fr,_e,m,gt),Yt===2)return gt;ge=_e.global,ge&&g.active++===0&&g.event.trigger("ajaxStart"),_e.type=_e.type.toUpperCase(),_e.hasContent=!_n.test(_e.type),w=_e.url,_e.hasContent||(_e.data&&(w=_e.url+=(Xt.test(w)?"&":"?")+_e.data,delete _e.data),_e.cache===!1&&(_e.url=zs.test(w)?w.replace(zs,"$1_="+Ti++):w+(Xt.test(w)?"&":"?")+"_="+Ti++)),_e.ifModified&&(g.lastModified[w]&&gt.setRequestHeader("If-Modified-Since",g.lastModified[w]),g.etag[w]&&gt.setRequestHeader("If-None-Match",g.etag[w])),(_e.data&&_e.hasContent&&_e.contentType!==!1||m.contentType)&&gt.setRequestHeader("Content-Type",_e.contentType),gt.setRequestHeader("Accept",_e.dataTypes[0]&&_e.accepts[_e.dataTypes[0]]?_e.accepts[_e.dataTypes[0]]+(_e.dataTypes[0]!=="*"?", "+Ko+"; q=0.01":""):_e.accepts["*"]);for(Pe in _e.headers)gt.setRequestHeader(Pe,_e.headers[Pe]);if(_e.beforeSend&&(_e.beforeSend.call(Ee,gt,_e)===!1||Yt===2))return gt.abort();ds="abort";for(Pe in{success:1,error:1,complete:1})gt[Pe](_e[Pe]);if(v=gd(Ws,_e,m,gt),!v)Gr(-1,"No Transport");else{gt.readyState=1,ge&&ke.trigger("ajaxSend",[gt,_e]),_e.async&&_e.timeout>0&&(W=setTimeout(function(){gt.abort("timeout")},_e.timeout));try{Yt=1,v.send(di,Gr)}catch(Kt){if(Yt<2)Gr(-1,Kt);else throw Kt}}function Gr(Kt,Di,Bn,Ta){var ps,zr,mr,as,Fn,Es=Di;Yt!==2&&(Yt=2,W&&clearTimeout(W),v=void 0,A=Ta||"",gt.readyState=Kt>0?4:0,ps=Kt>=200&&Kt<300||Kt===304,Bn&&(as=Hm(_e,gt,Bn)),as=Vm(_e,as,gt,ps),ps?(_e.ifModified&&(Fn=gt.getResponseHeader("Last-Modified"),Fn&&(g.lastModified[w]=Fn),Fn=gt.getResponseHeader("etag"),Fn&&(g.etag[w]=Fn)),Kt===204||_e.type==="HEAD"?Es="nocontent":Kt===304?Es="notmodified":(Es=as.state,zr=as.data,mr=as.error,ps=!mr)):(mr=Es,(Kt||!Es)&&(Es="error",Kt<0&&(Kt=0))),gt.status=Kt,gt.statusText=(Di||Es)+"",ps?qe.resolveWith(Ee,[zr,Es,gt]):qe.rejectWith(Ee,[gt,Es,mr]),gt.statusCode(Mt),Mt=void 0,ge&&ke.trigger(ps?"ajaxSuccess":"ajaxError",[gt,_e,ps?zr:mr]),pt.fireWith(Ee,[gt,Es]),ge&&(ke.trigger("ajaxComplete",[gt,_e]),--g.active||g.event.trigger("ajaxStop")))}return gt},getJSON:function(u,m,v){return g.get(u,m,v,"json")},getScript:function(u,m){return g.get(u,void 0,m,"script")}}),g.each(["get","post"],function(u,m){g[m]=function(v,w,A,R){return g.isFunction(w)&&(R=R||A,A=w,w=void 0),g.ajax({url:v,type:m,dataType:R,data:w,success:A})}}),g.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(u,m){g.fn[m]=function(v){return this.on(m,v)}}),g._evalUrl=function(u){return g.ajax({url:u,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})},g.fn.extend({wrapAll:function(u){var m;return g.isFunction(u)?this.each(function(v){g(this).wrapAll(u.call(this,v))}):(this[0]&&(m=g(u,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&m.insertBefore(this[0]),m.map(function(){for(var v=this;v.firstElementChild;)v=v.firstElementChild;return v}).append(this)),this)},wrapInner:function(u){return g.isFunction(u)?this.each(function(m){g(this).wrapInner(u.call(this,m))}):this.each(function(){var m=g(this),v=m.contents();v.length?v.wrapAll(u):m.append(u)})},wrap:function(u){var m=g.isFunction(u);return this.each(function(v){g(this).wrapAll(m?u.call(this,v):u)})},unwrap:function(){return this.parent().each(function(){g.nodeName(this,"body")||g(this).replaceWith(this.childNodes)}).end()}}),g.expr.filters.hidden=function(u){return u.offsetWidth<=0&&u.offsetHeight<=0},g.expr.filters.visible=function(u){return!g.expr.filters.hidden(u)};var Gm=/%20/g,zm=/\[\]$/,fd=/\r?\n/g,Wm=/^(?:submit|button|image|reset|file)$/i,$m=/^(?:input|select|textarea|keygen)/i;function oh(u,m,v,w){var A;if(g.isArray(m))g.each(m,function(R,W){v||zm.test(u)?w(u,W):oh(u+"["+(typeof W=="object"?R:"")+"]",W,v,w)});else if(!v&&g.type(m)==="object")for(A in m)oh(u+"["+A+"]",m[A],v,w);else w(u,m)}g.param=function(u,m){var v,w=[],A=function(R,W){W=g.isFunction(W)?W():W??"",w[w.length]=encodeURIComponent(R)+"="+encodeURIComponent(W)};if(m===void 0&&(m=g.ajaxSettings&&g.ajaxSettings.traditional),g.isArray(u)||u.jquery&&!g.isPlainObject(u))g.each(u,function(){A(this.name,this.value)});else for(v in u)oh(v,u[v],m,A);return w.join("&").replace(Gm,"+")},g.fn.extend({serialize:function(){return g.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var u=g.prop(this,"elements");return u?g.makeArray(u):this}).filter(function(){var u=this.type;return this.name&&!g(this).is(":disabled")&&$m.test(this.nodeName)&&!Wm.test(u)&&(this.checked||!ni.test(u))}).map(function(u,m){var v=g(this).val();return v==null?null:g.isArray(v)?g.map(v,function(w){return{name:m.name,value:w.replace(fd,`\r
`)}}):{name:m.name,value:v.replace(fd,`\r
`)}}).get()}}),g.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch{}};var Um=0,jo={},Ym={0:200,1223:204},Ca=g.ajaxSettings.xhr();e.ActiveXObject&&g(e).on("unload",function(){for(var u in jo)jo[u]()}),k.cors=!!Ca&&"withCredentials"in Ca,k.ajax=Ca=!!Ca,g.ajaxTransport(function(u){var m;if(k.cors||Ca&&!u.crossDomain)return{send:function(v,w){var A,R=u.xhr(),W=++Um;if(R.open(u.type,u.url,u.async,u.username,u.password),u.xhrFields)for(A in u.xhrFields)R[A]=u.xhrFields[A];u.mimeType&&R.overrideMimeType&&R.overrideMimeType(u.mimeType),!u.crossDomain&&!v["X-Requested-With"]&&(v["X-Requested-With"]="XMLHttpRequest");for(A in v)R.setRequestHeader(A,v[A]);m=function(te){return function(){m&&(delete jo[W],m=R.onload=R.onerror=null,te==="abort"?R.abort():te==="error"?w(R.status,R.statusText):w(Ym[R.status]||R.status,R.statusText,typeof R.responseText=="string"?{text:R.responseText}:void 0,R.getAllResponseHeaders()))}},R.onload=m(),R.onerror=m("error"),m=jo[W]=m("abort"),R.send(u.hasContent&&u.data||null)},abort:function(){m&&m()}}}),g.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(u){return g.globalEval(u),u}}}),g.ajaxPrefilter("script",function(u){u.cache===void 0&&(u.cache=!1),u.crossDomain&&(u.type="GET")}),g.ajaxTransport("script",function(u){if(u.crossDomain){var m,v;return{send:function(w,A){m=g("<script>").prop({async:!0,charset:u.scriptCharset,src:u.url}).on("load error",v=function(R){m.remove(),v=null,R&&A(R.type==="error"?404:200,R.type)}),Q.head.appendChild(m[0])},abort:function(){v&&v()}}}});var md=[],lh=/(=)\?(?=&|$)|\?\?/;g.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var u=md.pop()||g.expando+"_"+Ti++;return this[u]=!0,u}}),g.ajaxPrefilter("json jsonp",function(u,m,v){var w,A,R,W=u.jsonp!==!1&&(lh.test(u.url)?"url":typeof u.data=="string"&&!(u.contentType||"").indexOf("application/x-www-form-urlencoded")&&lh.test(u.data)&&"data");if(W||u.dataTypes[0]==="jsonp")return w=u.jsonpCallback=g.isFunction(u.jsonpCallback)?u.jsonpCallback():u.jsonpCallback,W?u[W]=u[W].replace(lh,"$1"+w):u.jsonp!==!1&&(u.url+=(Xt.test(u.url)?"&":"?")+u.jsonp+"="+w),u.converters["script json"]=function(){return R||g.error(w+" was not called"),R[0]},u.dataTypes[0]="json",A=e[w],e[w]=function(){R=arguments},v.always(function(){e[w]=A,u[w]&&(u.jsonpCallback=m.jsonpCallback,md.push(w)),R&&g.isFunction(A)&&A(R[0]),R=A=void 0}),"script"}),g.parseHTML=function(u,m,v){if(!u||typeof u!="string")return null;typeof m=="boolean"&&(v=m,m=!1),m=m||Q;var w=fe.exec(u),A=!v&&[];return w?[m.createElement(w[1])]:(w=g.buildFragment([u],m,A),A&&A.length&&g(A).remove(),g.merge([],w.childNodes))};var yd=g.fn.load;g.fn.load=function(u,m,v){if(typeof u!="string"&&yd)return yd.apply(this,arguments);var w,A,R,W=this,te=u.indexOf(" ");return te>=0&&(w=u.slice(te),u=u.slice(0,te)),g.isFunction(m)?(v=m,m=void 0):m&&typeof m=="object"&&(A="POST"),W.length>0&&g.ajax({url:u,type:A,dataType:"html",data:m}).done(function(ge){R=arguments,W.html(w?g("<div>").append(g.parseHTML(ge)).find(w):ge)}).complete(v&&function(ge,Pe){W.each(v,R||[ge.responseText,Pe,ge])}),this},g.expr.filters.animated=function(u){return g.grep(g.timers,function(m){return u===m.elem}).length};var bd=e.document.documentElement;function vd(u){return g.isWindow(u)?u:u.nodeType===9&&u.defaultView}g.offset={setOffset:function(u,m,v){var w,A,R,W,te,ge,Pe,_e=g.css(u,"position"),Ee=g(u),ke={};_e==="static"&&(u.style.position="relative"),te=Ee.offset(),R=g.css(u,"top"),ge=g.css(u,"left"),Pe=(_e==="absolute"||_e==="fixed")&&(R+ge).indexOf("auto")>-1,Pe?(w=Ee.position(),W=w.top,A=w.left):(W=parseFloat(R)||0,A=parseFloat(ge)||0),g.isFunction(m)&&(m=m.call(u,v,te)),m.top!=null&&(ke.top=m.top-te.top+W),m.left!=null&&(ke.left=m.left-te.left+A),"using"in m?m.using.call(u,ke):Ee.css(ke)}},g.fn.extend({offset:function(u){if(arguments.length)return u===void 0?this:this.each(function(W){g.offset.setOffset(this,u,W)});var m,v,w=this[0],A={top:0,left:0},R=w&&w.ownerDocument;if(R)return m=R.documentElement,g.contains(m,w)?(typeof w.getBoundingClientRect!==vn&&(A=w.getBoundingClientRect()),v=vd(R),{top:A.top+v.pageYOffset-m.clientTop,left:A.left+v.pageXOffset-m.clientLeft}):A},position:function(){if(this[0]){var u,m,v=this[0],w={top:0,left:0};return g.css(v,"position")==="fixed"?m=v.getBoundingClientRect():(u=this.offsetParent(),m=this.offset(),g.nodeName(u[0],"html")||(w=u.offset()),w.top+=g.css(u[0],"borderTopWidth",!0),w.left+=g.css(u[0],"borderLeftWidth",!0)),{top:m.top-w.top-g.css(v,"marginTop",!0),left:m.left-w.left-g.css(v,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var u=this.offsetParent||bd;u&&!g.nodeName(u,"html")&&g.css(u,"position")==="static";)u=u.offsetParent;return u||bd})}}),g.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(u,m){var v=m==="pageYOffset";g.fn[u]=function(w){return zi(this,function(A,R,W){var te=vd(A);if(W===void 0)return te?te[m]:A[R];te?te.scrollTo(v?e.pageXOffset:W,v?W:e.pageYOffset):A[R]=W},u,w,arguments.length,null)}}),g.each(["top","left"],function(u,m){g.cssHooks[m]=D(k.pixelPosition,function(v,w){if(w)return w=F(v,m),z.test(w)?g(v).position()[m]+"px":w})}),g.each({Height:"height",Width:"width"},function(u,m){g.each({padding:"inner"+u,content:m,"":"outer"+u},function(v,w){g.fn[w]=function(A,R){var W=arguments.length&&(v||typeof A!="boolean"),te=v||(A===!0||R===!0?"margin":"border");return zi(this,function(ge,Pe,_e){var Ee;return g.isWindow(ge)?ge.document.documentElement["client"+u]:ge.nodeType===9?(Ee=ge.documentElement,Math.max(ge.body["scroll"+u],Ee["scroll"+u],ge.body["offset"+u],Ee["offset"+u],Ee["client"+u])):_e===void 0?g.css(ge,Pe,te):g.style(ge,Pe,_e,te)},m,W?A:void 0,W,null)}})}),g.fn.size=function(){return this.length},g.fn.andSelf=g.fn.addBack;var Km=e.jQuery,jm=e.$;return g.noConflict=function(u){return e.$===g&&(e.$=jm),u&&e.jQuery===g&&(e.jQuery=Km),g},typeof t===vn&&(e.jQuery=e.$=g),g})})();var Py={exports:{}};/*!
 * Paper.js v0.12.17 - The Swiss Army Knife of Vector Graphics Scripting.
 * http://paperjs.org/
 *
 * Copyright (c) 2011 - 2020, Jrg Lehni & Jonathan Puckey
 * http://juerglehni.com/ & https://puckey.studio/
 *
 * Distributed under the MIT license. See LICENSE file for details.
 *
 * All rights reserved.
 *
 * Date: Thu Nov 3 21:15:36 2022 +0100
 *
 ***
 *
 * Straps.js - Class inheritance library with support for bean-style accessors
 *
 * Copyright (c) 2006 - 2020 Jrg Lehni
 * http://juerglehni.com/
 *
 * Distributed under the MIT license.
 *
 ***
 *
 * Acorn.js
 * https://marijnhaverbeke.nl/acorn/
 *
 * Acorn is a tiny, fast JavaScript parser written in JavaScript,
 * created by Marijn Haverbeke and released under an MIT license.
 *
 */(function(l){(function(e,t){var i=e.document,n=new function(){var s=/^(statics|enumerable|beans|preserve)$/,a=[],o=a.slice,c=Object.create,d=Object.getOwnPropertyDescriptor,f=Object.defineProperty,b=a.forEach||function(I,T){for(var M=0,V=this.length;M<V;M++)I.call(T,this[M],M,this)},y=function(I,T){for(var M in this)this.hasOwnProperty(M)&&I.call(T,this[M],M,this)},L=Object.assign||function(I){for(var T=1,M=arguments.length;T<M;T++){var V=arguments[T];for(var z in V)V.hasOwnProperty(z)&&(I[z]=V[z])}return I},P=function(I,T,M){if(I){var V=d(I,"length");(V&&typeof V.value=="number"?b:y).call(I,T,M=M||I)}return M};function x(I,T,M,V,z){var N={};function F(K,j){j=j||(j=d(T,K))&&(j.get?j:j.value),typeof j=="string"&&j[0]==="#"&&(j=I[j.substring(1)]||j);var J=typeof j=="function",ee=j,re=z||J&&!j.base?j&&j.get?K in I:I[K]:null,ie;(!z||!re)&&(J&&re&&(j.base=re),J&&V!==!1&&(ie=K.match(/^([gs]et|is)(([A-Z])(.*))$/))&&(N[ie[3].toLowerCase()+ie[4]]=ie[2]),(!ee||J||!ee.get||typeof ee.get!="function"||!E.isPlainObject(ee))&&(ee={value:ee,writable:!0}),(d(I,K)||{configurable:!0}).configurable&&(ee.configurable=!0,ee.enumerable=M??!ie),f(I,K,ee))}if(T){for(var D in T)T.hasOwnProperty(D)&&!s.test(D)&&F(D);for(var D in N){var O=N[D],H=I["set"+O],G=I["get"+O]||H&&I["is"+O];G&&(V===!0||G.length===0)&&F(D,{get:G,set:H})}}return I}function E(){for(var I=0,T=arguments.length;I<T;I++){var M=arguments[I];M&&L(this,M)}return this}return x(E,{inject:function(I){if(I){var T=I.statics===!0?I:I.statics,M=I.beans,V=I.preserve;T!==I&&x(this.prototype,I,I.enumerable,M,V),x(this,T,null,M,V)}for(var z=1,N=arguments.length;z<N;z++)this.inject(arguments[z]);return this},extend:function(){for(var I=this,T,M,V=0,z,N=arguments.length;V<N&&!(T&&M);V++)z=arguments[V],T=T||z.initialize,M=M||z.prototype;return T=T||function(){I.apply(this,arguments)},M=T.prototype=M||c(this.prototype),f(M,"constructor",{value:T,writable:!0,configurable:!0}),x(T,this),arguments.length&&this.inject.apply(T,arguments),T.base=I,T}}).inject({enumerable:!1,initialize:E,set:E,inject:function(){for(var I=0,T=arguments.length;I<T;I++){var M=arguments[I];M&&x(this,M,M.enumerable,M.beans,M.preserve)}return this},extend:function(){var I=c(this);return I.inject.apply(I,arguments)},each:function(I,T){return P(this,I,T)},clone:function(){return new this.constructor(this)},statics:{set:L,each:P,create:c,define:f,describe:d,clone:function(I){return L(new I.constructor,I)},isPlainObject:function(I){var T=I!=null&&I.constructor;return T&&(T===Object||T===E||T.name==="Object")},pick:function(I,T){return I!==t?I:T},slice:function(I,T,M){return o.call(I,T,M)}}})};e.paper=n,n.inject({enumerable:!1,toString:function(){return this._id!=null?(this._class||"Object")+(this._name?" '"+this._name+"'":" @"+this._id):"{ "+n.each(this,function(s,a){if(!/^_/.test(a)){var o=typeof s;this.push(a+": "+(o==="number"?C.instance.number(s):o==="string"?"'"+s+"'":s))}},[]).join(", ")+" }"},getClassName:function(){return this._class||""},importJSON:function(s){return n.importJSON(s,this)},exportJSON:function(s){return n.exportJSON(this,s)},toJSON:function(){return n.serialize(this)},set:function(s,a){return s&&n.filter(this,s,a,this._prioritize),this}},{beans:!1,statics:{exports:{},extend:function s(){var a=s.base.apply(this,arguments),o=a.prototype._class;return o&&!n.exports[o]&&(n.exports[o]=a),a},equals:function(s,a){if(s===a)return!0;if(s&&s.equals)return s.equals(a);if(a&&a.equals)return a.equals(s);if(s&&a&&typeof s=="object"&&typeof a=="object"){if(Array.isArray(s)&&Array.isArray(a)){var o=s.length;if(o!==a.length)return!1;for(;o--;)if(!n.equals(s[o],a[o]))return!1}else{var c=Object.keys(s),o=c.length;if(o!==Object.keys(a).length)return!1;for(;o--;){var d=c[o];if(!(a.hasOwnProperty(d)&&n.equals(s[d],a[d])))return!1}}return!0}return!1},read:function(s,a,o,c){if(this===n){var d=this.peek(s,a);return s.__index++,d}var f=this.prototype,b=f._readIndex,y=a||b&&s.__index||0,L=s.length,P=s[y];if(c=c||L-y,P instanceof this||o&&o.readNull&&P==null&&c<=1)return b&&(s.__index=y+1),P&&o&&o.clone?P.clone():P;if(P=n.create(f),b&&(P.__read=!0),P=P.initialize.apply(P,y>0||y+c<L?n.slice(s,y,y+c):s)||P,b){s.__index=y+P.__read;var x=P.__filtered;x&&(s.__filtered=x,P.__filtered=t),P.__read=t}return P},peek:function(s,a){return s[s.__index=a||s.__index||0]},remain:function(s){return s.length-(s.__index||0)},readList:function(s,a,o,c){for(var d=[],f,b=a||0,y=c?b+c:s.length,L=b;L<y;L++)d.push(Array.isArray(f=s[L])?this.read(f,0,o):this.read(s,L,o,1));return d},readNamed:function(s,a,o,c,d){var f=this.getNamed(s,a),b=f!==t;if(b){var y=s.__filtered;if(!y){var L=this.getSource(s);y=s.__filtered=n.create(L),y.__unfiltered=L}y[a]=t}return this.read(b?[f]:s,o,c,d)},readSupported:function(s,a){var o=this.getSource(s),c=this,d=!1;return o&&Object.keys(o).forEach(function(f){if(f in a){var b=c.readNamed(s,f);b!==t&&(a[f]=b),d=!0}}),d},getSource:function(s){var a=s.__source;if(a===t){var o=s.length===1&&s[0];a=s.__source=o&&n.isPlainObject(o)?o:null}return a},getNamed:function(s,a){var o=this.getSource(s);if(o)return a?o[a]:s.__filtered||o},hasNamed:function(s,a){return!!this.getNamed(s,a)},filter:function(s,a,o,c){var d;function f(x){if(!(o&&x in o)&&!(d&&x in d)){var E=a[x];E!==t&&(s[x]=E)}}if(c){for(var b={},y=0,L,P=c.length;y<P;y++)(L=c[y])in a&&(f(L),b[L]=!0);d=b}return Object.keys(a.__unfiltered||a).forEach(f),s},isPlainValue:function(s,a){return n.isPlainObject(s)||Array.isArray(s)||a&&typeof s=="string"},serialize:function(s,a,o,c){a=a||{};var d=!c,f;if(d&&(a.formatter=new C(a.precision),c={length:0,definitions:{},references:{},add:function(E,I){var T="#"+E._id,M=this.references[T];if(!M){this.length++;var V=I.call(E),z=E._class;z&&V[0]!==z&&V.unshift(z),this.definitions[T]=V,M=this.references[T]=[T]}return M}}),s&&s._serialize){f=s._serialize(a,c);var b=s._class;b&&!s._compactSerialize&&(d||!o)&&f[0]!==b&&f.unshift(b)}else if(Array.isArray(s)){f=[];for(var y=0,L=s.length;y<L;y++)f[y]=n.serialize(s[y],a,o,c)}else if(n.isPlainObject(s)){f={};for(var P=Object.keys(s),y=0,L=P.length;y<L;y++){var x=P[y];f[x]=n.serialize(s[x],a,o,c)}}else typeof s=="number"?f=a.formatter.number(s,a.precision):f=s;return d&&c.length>0?[["dictionary",c.definitions],f]:f},deserialize:function(s,a,o,c,d){var f=s,b=!o,y=b&&s&&s.length&&s[0][0]==="dictionary";if(o=o||{},Array.isArray(s)){var L=s[0],P=L==="dictionary";if(s.length==1&&/^#/.test(L))return o.dictionary[L];L=n.exports[L],f=[];for(var x=L?1:0,E=s.length;x<E;x++)f.push(n.deserialize(s[x],a,o,P,y));if(L){var I=f;a?f=a(L,I,b||d):f=new L(I)}}else if(n.isPlainObject(s)){f={},c&&(o.dictionary=f);for(var T in s)f[T]=n.deserialize(s[T],a,o)}return y?f[1]:f},exportJSON:function(s,a){var o=n.serialize(s,a);return a&&a.asString==!1?o:JSON.stringify(o)},importJSON:function(s,a){return n.deserialize(typeof s=="string"?JSON.parse(s):s,function(o,c,d){var f=d&&a&&a.constructor===o,b=f?a:n.create(o.prototype);if(c.length===1&&b instanceof se&&(f||!(b instanceof Fe))){var y=c[0];n.isPlainObject(y)&&(y.insert=!1,f&&(c=c.concat([se.INSERT])))}return(f?b.set:o).apply(b,c),f&&(a=null),b})},push:function(s,a){var o=a.length;if(o<4096)s.push.apply(s,a);else{var c=s.length;s.length+=o;for(var d=0;d<o;d++)s[c+d]=a[d]}return s},splice:function(s,a,o,c){var d=a&&a.length,f=o===t;o=f?s.length:o,o>s.length&&(o=s.length);for(var b=0;b<d;b++)a[b]._index=o+b;if(f)return n.push(s,a),[];var y=[o,c];a&&n.push(y,a);for(var L=s.splice.apply(s,y),b=0,P=L.length;b<P;b++)L[b]._index=t;for(var b=o+d,P=s.length;b<P;b++)s[b]._index=b;return L},capitalize:function(s){return s.replace(/\b[a-z]/g,function(a){return a.toUpperCase()})},camelize:function(s){return s.replace(/-(.)/g,function(a,o){return o.toUpperCase()})},hyphenate:function(s){return s.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}});var r={on:function(s,a){if(typeof s!="string")n.each(s,function(f,b){this.on(b,f)},this);else{var o=this._eventTypes,c=o&&o[s],d=this._callbacks=this._callbacks||{};d=d[s]=d[s]||[],d.indexOf(a)===-1&&(d.push(a),c&&c.install&&d.length===1&&c.install.call(this,s))}return this},off:function(s,a){if(typeof s!="string"){n.each(s,function(b,y){this.off(y,b)},this);return}var o=this._eventTypes,c=o&&o[s],d=this._callbacks&&this._callbacks[s],f;return d&&(!a||(f=d.indexOf(a))!==-1&&d.length===1?(c&&c.uninstall&&c.uninstall.call(this,s),delete this._callbacks[s]):f!==-1&&d.splice(f,1)),this},once:function(s,a){return this.on(s,function o(){a.apply(this,arguments),this.off(s,o)})},emit:function(s,a){var o=this._callbacks&&this._callbacks[s];if(!o)return!1;var c=n.slice(arguments,1),d=a&&a.target&&!a.currentTarget;o=o.slice(),d&&(a.currentTarget=this);for(var f=0,b=o.length;f<b;f++)if(o[f].apply(this,c)==!1){a&&a.stop&&a.stop();break}return d&&delete a.currentTarget,!0},responds:function(s){return!!(this._callbacks&&this._callbacks[s])},attach:"#on",detach:"#off",fire:"#emit",_installEvents:function(s){var a=this._eventTypes,o=this._callbacks,c=s?"install":"uninstall";if(a){for(var d in o)if(o[d].length>0){var f=a[d],b=f&&f[c];b&&b.call(this,d)}}},statics:{inject:function s(a){var o=a._events;if(o){var c={};n.each(o,function(d,f){var b=typeof d=="string",y=b?d:f,L=n.capitalize(y),P=y.substring(2).toLowerCase();c[P]=b?{}:d,y="_"+y,a["get"+L]=function(){return this[y]},a["set"+L]=function(x){var E=this[y];E&&this.off(P,E),x&&this.on(P,x),this[y]=x}}),a._eventTypes=c}return s.base.apply(this,arguments)}}},h=n.extend({_class:"PaperScope",initialize:function s(){kt=this,this.settings=new n({applyMatrix:!0,insertItems:!0,handleSize:4,hitTolerance:0}),this.project=null,this.projects=[],this.tools=[],this._id=s._id++,s._scopes[this._id]=this;var a=s.prototype;if(!this.support){var o=Ci.getContext(1,1)||{};a.support={nativeDash:"setLineDash"in o||"mozDash"in o,nativeBlendModes:Vr.nativeModes},Ci.release(o)}if(!this.agent){var c=e.navigator.userAgent.toLowerCase(),d=(/(darwin|win|mac|linux|freebsd|sunos)/.exec(c)||[])[0],f=d==="darwin"?"mac":d,b=a.agent=a.browser={platform:f};f&&(b[f]=!0),c.replace(/(opera|chrome|safari|webkit|firefox|msie|trident|atom|node|jsdom)\/?\s*([.\d]+)(?:.*version\/([.\d]+))?(?:.*rv\:v?([.\d]+))?/g,function(y,L,P,x,E){if(!b.chrome){var I=L==="opera"?x:/^(node|trident)$/.test(L)?E:P;b.version=I,b.versionNumber=parseFloat(I),L={trident:"msie",jsdom:"node"}[L]||L,b.name=L,b[L]=!0}}),b.chrome&&delete b.webkit,b.atom&&delete b.chrome}},version:"0.12.17",getView:function(){var s=this.project;return s&&s._view},getPaper:function(){return this},execute:function(s,a){},install:function(s){var a=this;n.each(["project","view","tool"],function(c){n.define(s,c,{configurable:!0,get:function(){return a[c]}})});for(var o in this)!/^_/.test(o)&&this[o]&&(s[o]=this[o])},setup:function(s){return kt=this,this.project=new de(s),this},createCanvas:function(s,a){return Ci.getCanvas(s,a)},activate:function(){kt=this},clear:function(){for(var s=this.projects,a=this.tools,o=s.length-1;o>=0;o--)s[o].remove();for(var o=a.length-1;o>=0;o--)a[o].remove()},remove:function(){this.clear(),delete h._scopes[this._id]},statics:new function(){function s(a){return a+="Attribute",function(o,c){return o[a](c)||o[a]("data-paper-"+c)}}return{_scopes:{},_id:0,get:function(a){return this._scopes[a]||null},getAttribute:s("get"),hasAttribute:s("has")}}}),p=n.extend(r,{initialize:function(s){this._scope=kt,this._index=this._scope[this._list].push(this)-1,(s||!this._scope[this._reference])&&this.activate()},activate:function(){if(!this._scope)return!1;var s=this._scope[this._reference];return s&&s!==this&&s.emit("deactivate"),this._scope[this._reference]=this,this.emit("activate",s),!0},isActive:function(){return this._scope[this._reference]===this},remove:function(){return this._index==null?!1:(n.splice(this._scope[this._list],null,this._index,1),this._scope[this._reference]==this&&(this._scope[this._reference]=null),this._scope=null,!0)},getView:function(){return this._scope.getView()}}),S={findItemBoundsCollisions:function(s,a,o){function c(b){for(var y=new Array(b.length),L=0;L<b.length;L++){var P=b[L].getBounds();y[L]=[P.left,P.top,P.right,P.bottom]}return y}var d=c(s),f=!a||a===s?d:c(a);return this.findBoundsCollisions(d,f,o||0)},findCurveBoundsCollisions:function(s,a,o,c){function d(I){for(var T=Math.min,M=Math.max,V=new Array(I.length),z=0;z<I.length;z++){var N=I[z];V[z]=[T(N[0],N[2],N[4],N[6]),T(N[1],N[3],N[5],N[7]),M(N[0],N[2],N[4],N[6]),M(N[1],N[3],N[5],N[7])]}return V}var f=d(s),b=!a||a===s?f:d(a);if(c){for(var y=this.findBoundsCollisions(f,b,o||0,!1,!0),L=this.findBoundsCollisions(f,b,o||0,!0,!0),P=[],x=0,E=y.length;x<E;x++)P[x]={hor:y[x],ver:L[x]};return P}return this.findBoundsCollisions(f,b,o||0)},findBoundsCollisions:function(s,a,o,c,d){var f=!a||s===a,b=f?s:s.concat(a),y=s.length,L=b.length;function P(He,Ue,nt){for(var et=0,tt=He.length;et<tt;){var Je=tt+et>>>1;b[He[Je]][Ue]<nt?et=Je+1:tt=Je}return et-1}for(var x=c?1:0,E=x+2,I=c?0:1,T=I+2,M=new Array(L),V=0;V<L;V++)M[V]=V;M.sort(function(He,Ue){return b[He][x]-b[Ue][x]});for(var z=[],N=new Array(y),V=0;V<L;V++){var F=M[V],D=b[F],O=f?F:F-y,H=F<y,G=f||!H,K=H?[]:null;if(z.length){var j=P(z,E,D[x]-o)+1;if(z.splice(0,j),f&&d){K=K.concat(z);for(var J=0;J<z.length;J++){var ee=z[J];N[ee].push(O)}}else for(var re=D[T],ie=D[I],J=0;J<z.length;J++){var ee=z[J],oe=b[ee],le=ee<y,pe=f||ee>=y;(d||(H&&pe||G&&le)&&re>=oe[I]-o&&ie<=oe[T]+o)&&(H&&pe&&K.push(f?ee:ee-y),G&&le&&N[ee].push(O))}}if(H&&(s===a&&K.push(F),N[F]=K),z.length){var be=D[E],Le=P(z,E,be);z.splice(Le+1,0,F)}else z.push(F)}for(var V=0;V<N.length;V++){var Ne=N[V];Ne&&Ne.sort(function(Ue,nt){return Ue-nt})}return N}},C=n.extend({initialize:function(s){this.precision=n.pick(s,5),this.multiplier=Math.pow(10,this.precision)},number:function(s){return this.precision<16?Math.round(s*this.multiplier)/this.multiplier:s},pair:function(s,a,o){return this.number(s)+(o||",")+this.number(a)},point:function(s,a){return this.number(s.x)+(a||",")+this.number(s.y)},size:function(s,a){return this.number(s.width)+(a||",")+this.number(s.height)},rectangle:function(s,a){return this.point(s,a)+(a||",")+this.size(s,a)}});C.instance=new C;var B=new function(){var s=[[.5773502691896257],[0,.7745966692414834],[.33998104358485626,.8611363115940526],[0,.5384693101056831,.906179845938664],[.2386191860831969,.6612093864662645,.932469514203152],[0,.4058451513773972,.7415311855993945,.9491079123427585],[.1834346424956498,.525532409916329,.7966664774136267,.9602898564975363],[0,.3242534234038089,.6133714327005904,.8360311073266358,.9681602395076261],[.14887433898163122,.4333953941292472,.6794095682990244,.8650633666889845,.9739065285171717],[0,.26954315595234496,.5190961292068118,.7301520055740494,.8870625997680953,.978228658146057],[.1252334085114689,.3678314989981802,.5873179542866175,.7699026741943047,.9041172563704749,.9815606342467192],[0,.2304583159551348,.44849275103644687,.6423493394403402,.8015780907333099,.9175983992229779,.9841830547185881],[.10805494870734367,.31911236892788974,.5152486363581541,.6872929048116855,.827201315069765,.9284348836635735,.9862838086968123],[0,.20119409399743451,.3941513470775634,.5709721726085388,.7244177313601701,.8482065834104272,.937273392400706,.9879925180204854],[.09501250983763744,.2816035507792589,.45801677765722737,.6178762444026438,.755404408355003,.8656312023878318,.9445750230732326,.9894009349916499]],a=[[1],[.8888888888888888,.5555555555555556],[.6521451548625461,.34785484513745385],[.5688888888888889,.47862867049936647,.23692688505618908],[.46791393457269104,.3607615730481386,.17132449237917036],[.4179591836734694,.3818300505051189,.27970539148927664,.1294849661688697],[.362683783378362,.31370664587788727,.22238103445337448,.10122853629037626],[.3302393550012598,.31234707704000286,.26061069640293544,.1806481606948574,.08127438836157441],[.29552422471475287,.26926671930999635,.21908636251598204,.1494513491505806,.06667134430868814],[.2729250867779006,.26280454451024665,.23319376459199048,.18629021092773426,.1255803694649046,.05566856711617366],[.24914704581340277,.2334925365383548,.20316742672306592,.16007832854334622,.10693932599531843,.04717533638651183],[.2325515532308739,.22628318026289723,.2078160475368885,.17814598076194574,.13887351021978725,.09212149983772845,.04048400476531588],[.2152638534631578,.2051984637212956,.18553839747793782,.15720316715819355,.12151857068790319,.08015808715976021,.03511946033175186],[.2025782419255613,.19843148532711158,.1861610000155622,.16626920581699392,.13957067792615432,.10715922046717194,.07036604748810812,.03075324199611727],[.1894506104550685,.18260341504492358,.16915651939500254,.14959598881657674,.12462897125553388,.09515851168249279,.062253523938647894,.027152459411754096]],o=Math.abs,c=Math.sqrt,d=Math.pow,f=Math.log2||function(E){return Math.log(E)*Math.LOG2E},b=1e-12,y=112e-18;function L(E,I,T){return E<I?I:E>T?T:E}function P(E,I,T){function M(j){var J=j*134217729,ee=j-J,re=ee+J,ie=j-re;return[re,ie]}var V=I*I-E*T,z=I*I+E*T;if(o(V)*3<z){var N=M(E),F=M(I),D=M(T),O=I*I,H=F[0]*F[0]-O+2*F[0]*F[1]+F[1]*F[1],G=E*T,K=N[0]*D[0]-G+N[0]*D[1]+N[1]*D[0]+N[1]*D[1];V=O-G+(H-K)}return V}function x(){var E=Math.max.apply(Math,arguments);return E&&(E<1e-8||E>1e8)?d(2,-Math.round(f(E))):0}return{EPSILON:b,MACHINE_EPSILON:y,CURVETIME_EPSILON:1e-8,GEOMETRIC_EPSILON:1e-7,TRIGONOMETRIC_EPSILON:1e-8,ANGULAR_EPSILON:1e-5,KAPPA:4*(c(2)-1)/3,isZero:function(E){return E>=-b&&E<=b},isMachineZero:function(E){return E>=-y&&E<=y},clamp:L,integrate:function(E,I,T,M){for(var V=s[M-2],z=a[M-2],N=(T-I)*.5,F=N+I,D=0,O=M+1>>1,H=M&1?z[D++]*E(F):0;D<O;){var G=N*V[D];H+=z[D++]*(E(F+G)+E(F-G))}return N*H},findRoot:function(E,I,T,M,V,z,N){for(var F=0;F<z;F++){var D=E(T),O=D/I(T),H=T-O;if(o(O)<N){T=H;break}D>0?(V=T,T=H<=M?(M+V)*.5:H):(M=T,T=H>=V?(M+V)*.5:H)}return L(T,M,V)},solveQuadratic:function(E,I,T,M,V,z){var N,F=1/0;if(o(E)<b){if(o(I)<b)return o(T)<b?-1:0;N=-T/I}else{I*=-.5;var D=P(E,I,T);if(D&&o(D)<y){var O=x(o(E),o(I),o(T));O&&(E*=O,I*=O,T*=O,D=P(E,I,T))}if(D>=-y){var H=D<0?0:c(D),G=I+(I<0?-H:H);G===0?(N=T/E,F=-N):(N=G/E,F=T/G)}}var K=0,j=V==null,J=V-b,ee=z+b;return isFinite(N)&&(j||N>J&&N<ee)&&(M[K++]=j?N:L(N,V,z)),F!==N&&isFinite(F)&&(j||F>J&&F<ee)&&(M[K++]=j?F:L(F,V,z)),K},solveCubic:function(E,I,T,M,V,z,N){var F=x(o(E),o(I),o(T),o(M)),D,O,H,G,K;F&&(E*=F,I*=F,T*=F,M*=F);function j(Le){D=Le;var Ne=E*D;O=Ne+I,H=O*D+T,G=(Ne+O)*D+H,K=H*D+M}if(o(E)<b)E=I,O=T,H=M,D=1/0;else if(o(M)<b)O=I,H=T,D=0;else{j(-(I/E)/3);var J=K/E,ee=d(o(J),1/3),re=J<0?-1:1,ie=-G/E,oe=ie>0?1.324717957244746*Math.max(ee,c(ie)):ee,le=D-re*oe;if(le!==D){do j(le),le=G===0?D:D-K/G/(1+y);while(re*le>re*D);o(E)*D*D>o(M/D)&&(H=-M/D,O=(H-T)/D)}}var pe=B.solveQuadratic(E,O,H,V,z,N),be=z==null;return isFinite(D)&&(pe===0||pe>0&&D!==V[0]&&D!==V[1])&&(be||D>z-b&&D<N+b)&&(V[pe++]=be?D:L(D,z,N)),pe}}},U={_id:1,_pools:{},get:function(s){if(s){var a=this._pools[s];return a||(a=this._pools[s]={_id:1}),a._id++}else return this._id++}},k=n.extend({_class:"Point",_readIndex:!0,initialize:function(a,o){var c=typeof a,d=this.__read,f=0;if(c==="number"){var b=typeof o=="number";this._set(a,b?o:a),d&&(f=b?2:1)}else if(c==="undefined"||a===null)this._set(0,0),d&&(f=a===null?1:0);else{var y=c==="string"?a.split(/[\s,]+/)||[]:a;f=1,Array.isArray(y)?this._set(+y[0],+(y.length>1?y[1]:y[0])):"x"in y?this._set(y.x||0,y.y||0):"width"in y?this._set(y.width||0,y.height||0):"angle"in y?(this._set(y.length||0,0),this.setAngle(y.angle||0)):(this._set(0,0),f=0)}return d&&(this.__read=f),this},set:"#initialize",_set:function(s,a){return this.x=s,this.y=a,this},equals:function(s){return this===s||s&&(this.x===s.x&&this.y===s.y||Array.isArray(s)&&this.x===s[0]&&this.y===s[1])||!1},clone:function(){return new k(this.x,this.y)},toString:function(){var s=C.instance;return"{ x: "+s.number(this.x)+", y: "+s.number(this.y)+" }"},_serialize:function(s){var a=s.formatter;return[a.number(this.x),a.number(this.y)]},getLength:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},setLength:function(s){if(this.isZero()){var a=this._angle||0;this._set(Math.cos(a)*s,Math.sin(a)*s)}else{var o=s/this.getLength();B.isZero(o)&&this.getAngle(),this._set(this.x*o,this.y*o)}},getAngle:function(){return this.getAngleInRadians.apply(this,arguments)*180/Math.PI},setAngle:function(s){this.setAngleInRadians.call(this,s*Math.PI/180)},getAngleInDegrees:"#getAngle",setAngleInDegrees:"#setAngle",getAngleInRadians:function(){if(arguments.length){var s=k.read(arguments),a=this.getLength()*s.getLength();if(B.isZero(a))return NaN;var o=this.dot(s)/a;return Math.acos(o<-1?-1:o>1?1:o)}else return this.isZero()?this._angle||0:this._angle=Math.atan2(this.y,this.x)},setAngleInRadians:function(s){if(this._angle=s,!this.isZero()){var a=this.getLength();this._set(Math.cos(s)*a,Math.sin(s)*a)}},getQuadrant:function(){return this.x>=0?this.y>=0?1:4:this.y>=0?2:3}},{beans:!1,getDirectedAngle:function(){var s=k.read(arguments);return Math.atan2(this.cross(s),this.dot(s))*180/Math.PI},getDistance:function(){var s=arguments,a=k.read(s),o=a.x-this.x,c=a.y-this.y,d=o*o+c*c,f=n.read(s);return f?d:Math.sqrt(d)},normalize:function(s){s===t&&(s=1);var a=this.getLength(),o=a!==0?s/a:0,c=new k(this.x*o,this.y*o);return o>=0&&(c._angle=this._angle),c},rotate:function(s,a){if(s===0)return this.clone();s=s*Math.PI/180;var o=a?this.subtract(a):this,c=Math.sin(s),d=Math.cos(s);return o=new k(o.x*d-o.y*c,o.x*c+o.y*d),a?o.add(a):o},transform:function(s){return s?s._transformPoint(this):this},add:function(){var s=k.read(arguments);return new k(this.x+s.x,this.y+s.y)},subtract:function(){var s=k.read(arguments);return new k(this.x-s.x,this.y-s.y)},multiply:function(){var s=k.read(arguments);return new k(this.x*s.x,this.y*s.y)},divide:function(){var s=k.read(arguments);return new k(this.x/s.x,this.y/s.y)},modulo:function(){var s=k.read(arguments);return new k(this.x%s.x,this.y%s.y)},negate:function(){return new k(-this.x,-this.y)},isInside:function(){return Z.read(arguments).contains(this)},isClose:function(){var s=arguments,a=k.read(s),o=n.read(s);return this.getDistance(a)<=o},isCollinear:function(){var s=k.read(arguments);return k.isCollinear(this.x,this.y,s.x,s.y)},isColinear:"#isCollinear",isOrthogonal:function(){var s=k.read(arguments);return k.isOrthogonal(this.x,this.y,s.x,s.y)},isZero:function(){var s=B.isZero;return s(this.x)&&s(this.y)},isNaN:function(){return isNaN(this.x)||isNaN(this.y)},isInQuadrant:function(s){return this.x*(s>1&&s<4?-1:1)>=0&&this.y*(s>2?-1:1)>=0},dot:function(){var s=k.read(arguments);return this.x*s.x+this.y*s.y},cross:function(){var s=k.read(arguments);return this.x*s.y-this.y*s.x},project:function(){var s=k.read(arguments),a=s.isZero()?0:this.dot(s)/s.dot(s);return new k(s.x*a,s.y*a)},statics:{min:function(){var s=arguments,a=k.read(s),o=k.read(s);return new k(Math.min(a.x,o.x),Math.min(a.y,o.y))},max:function(){var s=arguments,a=k.read(s),o=k.read(s);return new k(Math.max(a.x,o.x),Math.max(a.y,o.y))},random:function(){return new k(Math.random(),Math.random())},isCollinear:function(s,a,o,c){return Math.abs(s*c-a*o)<=Math.sqrt((s*s+a*a)*(o*o+c*c))*1e-8},isOrthogonal:function(s,a,o,c){return Math.abs(s*o+a*c)<=Math.sqrt((s*s+a*a)*(o*o+c*c))*1e-8}}},n.each(["round","ceil","floor","abs"],function(s){var a=Math[s];this[s]=function(){return new k(a(this.x),a(this.y))}},{})),Q=k.extend({initialize:function(a,o,c,d){this._x=a,this._y=o,this._owner=c,this._setter=d},_set:function(s,a,o){return this._x=s,this._y=a,o||this._owner[this._setter](this),this},getX:function(){return this._x},setX:function(s){this._x=s,this._owner[this._setter](this)},getY:function(){return this._y},setY:function(s){this._y=s,this._owner[this._setter](this)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(s){this._owner._changeSelection(this._getSelection(),s)},_getSelection:function(){return this._setter==="setPosition"?4:0}}),X=n.extend({_class:"Size",_readIndex:!0,initialize:function(a,o){var c=typeof a,d=this.__read,f=0;if(c==="number"){var b=typeof o=="number";this._set(a,b?o:a),d&&(f=b?2:1)}else if(c==="undefined"||a===null)this._set(0,0),d&&(f=a===null?1:0);else{var y=c==="string"?a.split(/[\s,]+/)||[]:a;f=1,Array.isArray(y)?this._set(+y[0],+(y.length>1?y[1]:y[0])):"width"in y?this._set(y.width||0,y.height||0):"x"in y?this._set(y.x||0,y.y||0):(this._set(0,0),f=0)}return d&&(this.__read=f),this},set:"#initialize",_set:function(s,a){return this.width=s,this.height=a,this},equals:function(s){return s===this||s&&(this.width===s.width&&this.height===s.height||Array.isArray(s)&&this.width===s[0]&&this.height===s[1])||!1},clone:function(){return new X(this.width,this.height)},toString:function(){var s=C.instance;return"{ width: "+s.number(this.width)+", height: "+s.number(this.height)+" }"},_serialize:function(s){var a=s.formatter;return[a.number(this.width),a.number(this.height)]},add:function(){var s=X.read(arguments);return new X(this.width+s.width,this.height+s.height)},subtract:function(){var s=X.read(arguments);return new X(this.width-s.width,this.height-s.height)},multiply:function(){var s=X.read(arguments);return new X(this.width*s.width,this.height*s.height)},divide:function(){var s=X.read(arguments);return new X(this.width/s.width,this.height/s.height)},modulo:function(){var s=X.read(arguments);return new X(this.width%s.width,this.height%s.height)},negate:function(){return new X(-this.width,-this.height)},isZero:function(){var s=B.isZero;return s(this.width)&&s(this.height)},isNaN:function(){return isNaN(this.width)||isNaN(this.height)},statics:{min:function(s,a){return new X(Math.min(s.width,a.width),Math.min(s.height,a.height))},max:function(s,a){return new X(Math.max(s.width,a.width),Math.max(s.height,a.height))},random:function(){return new X(Math.random(),Math.random())}}},n.each(["round","ceil","floor","abs"],function(s){var a=Math[s];this[s]=function(){return new X(a(this.width),a(this.height))}},{})),g=X.extend({initialize:function(a,o,c,d){this._width=a,this._height=o,this._owner=c,this._setter=d},_set:function(s,a,o){return this._width=s,this._height=a,o||this._owner[this._setter](this),this},getWidth:function(){return this._width},setWidth:function(s){this._width=s,this._owner[this._setter](this)},getHeight:function(){return this._height},setHeight:function(s){this._height=s,this._owner[this._setter](this)}}),Z=n.extend({_class:"Rectangle",_readIndex:!0,beans:!0,initialize:function(a,o,c,d){var f=arguments,b=typeof a,y;if(b==="number"?(this._set(a,o,c,d),y=4):b==="undefined"||a===null?(this._set(0,0,0,0),y=a===null?1:0):f.length===1&&(Array.isArray(a)?(this._set.apply(this,a),y=1):a.x!==t||a.width!==t?(this._set(a.x||0,a.y||0,a.width||0,a.height||0),y=1):a.from===t&&a.to===t&&(this._set(0,0,0,0),n.readSupported(f,this)&&(y=1))),y===t){var L=k.readNamed(f,"from"),P=n.peek(f),x=L.x,E=L.y,I,T;if(P&&P.x!==t||n.hasNamed(f,"to")){var M=k.readNamed(f,"to");I=M.x-x,T=M.y-E,I<0&&(x=M.x,I=-I),T<0&&(E=M.y,T=-T)}else{var V=X.read(f);I=V.width,T=V.height}this._set(x,E,I,T),y=f.__index}var z=f.__filtered;return z&&(this.__filtered=z),this.__read&&(this.__read=y),this},set:"#initialize",_set:function(s,a,o,c){return this.x=s,this.y=a,this.width=o,this.height=c,this},clone:function(){return new Z(this.x,this.y,this.width,this.height)},equals:function(s){var a=n.isPlainValue(s)?Z.read(arguments):s;return a===this||a&&this.x===a.x&&this.y===a.y&&this.width===a.width&&this.height===a.height||!1},toString:function(){var s=C.instance;return"{ x: "+s.number(this.x)+", y: "+s.number(this.y)+", width: "+s.number(this.width)+", height: "+s.number(this.height)+" }"},_serialize:function(s){var a=s.formatter;return[a.number(this.x),a.number(this.y),a.number(this.width),a.number(this.height)]},getPoint:function(s){var a=s?k:Q;return new a(this.x,this.y,this,"setPoint")},setPoint:function(){var s=k.read(arguments);this.x=s.x,this.y=s.y},getSize:function(s){var a=s?X:g;return new a(this.width,this.height,this,"setSize")},_fw:1,_fh:1,setSize:function(){var s=X.read(arguments),a=this._sx,o=this._sy,c=s.width,d=s.height;a&&(this.x+=(this.width-c)*a),o&&(this.y+=(this.height-d)*o),this.width=c,this.height=d,this._fw=this._fh=1},getLeft:function(){return this.x},setLeft:function(s){if(!this._fw){var a=s-this.x;this.width-=this._sx===.5?a*2:a}this.x=s,this._sx=this._fw=0},getTop:function(){return this.y},setTop:function(s){if(!this._fh){var a=s-this.y;this.height-=this._sy===.5?a*2:a}this.y=s,this._sy=this._fh=0},getRight:function(){return this.x+this.width},setRight:function(s){if(!this._fw){var a=s-this.x;this.width=this._sx===.5?a*2:a}this.x=s-this.width,this._sx=1,this._fw=0},getBottom:function(){return this.y+this.height},setBottom:function(s){if(!this._fh){var a=s-this.y;this.height=this._sy===.5?a*2:a}this.y=s-this.height,this._sy=1,this._fh=0},getCenterX:function(){return this.x+this.width/2},setCenterX:function(s){this._fw||this._sx===.5?this.x=s-this.width/2:(this._sx&&(this.x+=(s-this.x)*2*this._sx),this.width=(s-this.x)*2),this._sx=.5,this._fw=0},getCenterY:function(){return this.y+this.height/2},setCenterY:function(s){this._fh||this._sy===.5?this.y=s-this.height/2:(this._sy&&(this.y+=(s-this.y)*2*this._sy),this.height=(s-this.y)*2),this._sy=.5,this._fh=0},getCenter:function(s){var a=s?k:Q;return new a(this.getCenterX(),this.getCenterY(),this,"setCenter")},setCenter:function(){var s=k.read(arguments);return this.setCenterX(s.x),this.setCenterY(s.y),this},getArea:function(){return this.width*this.height},isEmpty:function(){return this.width===0||this.height===0},contains:function(s){return s&&s.width!==t||(Array.isArray(s)?s:arguments).length===4?this._containsRectangle(Z.read(arguments)):this._containsPoint(k.read(arguments))},_containsPoint:function(s){var a=s.x,o=s.y;return a>=this.x&&o>=this.y&&a<=this.x+this.width&&o<=this.y+this.height},_containsRectangle:function(s){var a=s.x,o=s.y;return a>=this.x&&o>=this.y&&a+s.width<=this.x+this.width&&o+s.height<=this.y+this.height},intersects:function(){var s=Z.read(arguments),a=n.read(arguments)||0;return s.x+s.width>this.x-a&&s.y+s.height>this.y-a&&s.x<this.x+this.width+a&&s.y<this.y+this.height+a},intersect:function(){var s=Z.read(arguments),a=Math.max(this.x,s.x),o=Math.max(this.y,s.y),c=Math.min(this.x+this.width,s.x+s.width),d=Math.min(this.y+this.height,s.y+s.height);return new Z(a,o,c-a,d-o)},unite:function(){var s=Z.read(arguments),a=Math.min(this.x,s.x),o=Math.min(this.y,s.y),c=Math.max(this.x+this.width,s.x+s.width),d=Math.max(this.y+this.height,s.y+s.height);return new Z(a,o,c-a,d-o)},include:function(){var s=k.read(arguments),a=Math.min(this.x,s.x),o=Math.min(this.y,s.y),c=Math.max(this.x+this.width,s.x),d=Math.max(this.y+this.height,s.y);return new Z(a,o,c-a,d-o)},expand:function(){var s=X.read(arguments),a=s.width,o=s.height;return new Z(this.x-a/2,this.y-o/2,this.width+a,this.height+o)},scale:function(s,a){return this.expand(this.width*s-this.width,this.height*(a===t?s:a)-this.height)}},n.each([["Top","Left"],["Top","Right"],["Bottom","Left"],["Bottom","Right"],["Left","Center"],["Top","Center"],["Right","Center"],["Bottom","Center"]],function(s,a){var o=s.join(""),c=/^[RL]/.test(o);a>=4&&(s[1]+=c?"Y":"X");var d=s[c?0:1],f=s[c?1:0],b="get"+d,y="get"+f,L="set"+d,P="set"+f,x="get"+o,E="set"+o;this[x]=function(I){var T=I?k:Q;return new T(this[b](),this[y](),this,E)},this[E]=function(){var I=k.read(arguments);this[L](I.x),this[P](I.y)}},{beans:!0})),ce=Z.extend({initialize:function(a,o,c,d,f,b){this._set(a,o,c,d,!0),this._owner=f,this._setter=b},_set:function(s,a,o,c,d){return this._x=s,this._y=a,this._width=o,this._height=c,d||this._owner[this._setter](this),this}},new function(){var s=Z.prototype;return n.each(["x","y","width","height"],function(a){var o=n.capitalize(a),c="_"+a;this["get"+o]=function(){return this[c]},this["set"+o]=function(d){this[c]=d,this._dontNotify||this._owner[this._setter](this)}},n.each(["Point","Size","Center","Left","Top","Right","Bottom","CenterX","CenterY","TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],function(a){var o="set"+a;this[o]=function(){this._dontNotify=!0,s[o].apply(this,arguments),this._dontNotify=!1,this._owner[this._setter](this)}},{isSelected:function(){return!!(this._owner._selection&2)},setSelected:function(a){var o=this._owner;o._changeSelection&&o._changeSelection(2,a)}}))}),ye=n.extend({_class:"Matrix",initialize:function s(a,o){var c=arguments,d=c.length,f=!0;if(d>=6?this._set.apply(this,c):d===1||d===2?a instanceof s?this._set(a._a,a._b,a._c,a._d,a._tx,a._ty,o):Array.isArray(a)?this._set.apply(this,o?a.concat([o]):a):f=!1:d?f=!1:this.reset(),!f)throw new Error("Unsupported matrix parameters");return this},set:"#initialize",_set:function(s,a,o,c,d,f,b){return this._a=s,this._b=a,this._c=o,this._d=c,this._tx=d,this._ty=f,b||this._changed(),this},_serialize:function(s,a){return n.serialize(this.getValues(),s,!0,a)},_changed:function(){var s=this._owner;s&&(s._applyMatrix?s.transform(null,!0):s._changed(25))},clone:function(){return new ye(this._a,this._b,this._c,this._d,this._tx,this._ty)},equals:function(s){return s===this||s&&this._a===s._a&&this._b===s._b&&this._c===s._c&&this._d===s._d&&this._tx===s._tx&&this._ty===s._ty},toString:function(){var s=C.instance;return"[["+[s.number(this._a),s.number(this._c),s.number(this._tx)].join(", ")+"], ["+[s.number(this._b),s.number(this._d),s.number(this._ty)].join(", ")+"]]"},reset:function(s){return this._a=this._d=1,this._b=this._c=this._tx=this._ty=0,s||this._changed(),this},apply:function(s,a){var o=this._owner;return o?(o.transform(null,n.pick(s,!0),a),this.isIdentity()):!1},translate:function(){var s=k.read(arguments),a=s.x,o=s.y;return this._tx+=a*this._a+o*this._c,this._ty+=a*this._b+o*this._d,this._changed(),this},scale:function(){var s=arguments,a=k.read(s),o=k.read(s,0,{readNull:!0});return o&&this.translate(o),this._a*=a.x,this._b*=a.x,this._c*=a.y,this._d*=a.y,o&&this.translate(o.negate()),this._changed(),this},rotate:function(s){s*=Math.PI/180;var a=k.read(arguments,1),o=a.x,c=a.y,d=Math.cos(s),f=Math.sin(s),b=o-o*d+c*f,y=c-o*f-c*d,L=this._a,P=this._b,x=this._c,E=this._d;return this._a=d*L+f*x,this._b=d*P+f*E,this._c=-f*L+d*x,this._d=-f*P+d*E,this._tx+=b*L+y*x,this._ty+=b*P+y*E,this._changed(),this},shear:function(){var s=arguments,a=k.read(s),o=k.read(s,0,{readNull:!0});o&&this.translate(o);var c=this._a,d=this._b;return this._a+=a.y*this._c,this._b+=a.y*this._d,this._c+=a.x*c,this._d+=a.x*d,o&&this.translate(o.negate()),this._changed(),this},skew:function(){var s=arguments,a=k.read(s),o=k.read(s,0,{readNull:!0}),c=Math.PI/180,d=new k(Math.tan(a.x*c),Math.tan(a.y*c));return this.shear(d,o)},append:function(s,a){if(s){var o=this._a,c=this._b,d=this._c,f=this._d,b=s._a,y=s._c,L=s._b,P=s._d,x=s._tx,E=s._ty;this._a=b*o+L*d,this._c=y*o+P*d,this._b=b*c+L*f,this._d=y*c+P*f,this._tx+=x*o+E*d,this._ty+=x*c+E*f,a||this._changed()}return this},prepend:function(s,a){if(s){var o=this._a,c=this._b,d=this._c,f=this._d,b=this._tx,y=this._ty,L=s._a,P=s._c,x=s._b,E=s._d,I=s._tx,T=s._ty;this._a=L*o+P*c,this._c=L*d+P*f,this._b=x*o+E*c,this._d=x*d+E*f,this._tx=L*b+P*y+I,this._ty=x*b+E*y+T,a||this._changed()}return this},appended:function(s){return this.clone().append(s)},prepended:function(s){return this.clone().prepend(s)},invert:function(){var s=this._a,a=this._b,o=this._c,c=this._d,d=this._tx,f=this._ty,b=s*c-a*o,y=null;return b&&!isNaN(b)&&isFinite(d)&&isFinite(f)&&(this._a=c/b,this._b=-a/b,this._c=-o/b,this._d=s/b,this._tx=(o*f-c*d)/b,this._ty=(a*d-s*f)/b,y=this),y},inverted:function(){return this.clone().invert()},concatenate:"#append",preConcatenate:"#prepend",chain:"#appended",_shiftless:function(){return new ye(this._a,this._b,this._c,this._d,0,0)},_orNullIfIdentity:function(){return this.isIdentity()?null:this},isIdentity:function(){return this._a===1&&this._b===0&&this._c===0&&this._d===1&&this._tx===0&&this._ty===0},isInvertible:function(){var s=this._a*this._d-this._c*this._b;return s&&!isNaN(s)&&isFinite(this._tx)&&isFinite(this._ty)},isSingular:function(){return!this.isInvertible()},transform:function(s,a,o){return arguments.length<3?this._transformPoint(k.read(arguments)):this._transformCoordinates(s,a,o)},_transformPoint:function(s,a,o){var c=s.x,d=s.y;return a||(a=new k),a._set(c*this._a+d*this._c+this._tx,c*this._b+d*this._d+this._ty,o)},_transformCoordinates:function(s,a,o){for(var c=0,d=2*o;c<d;c+=2){var f=s[c],b=s[c+1];a[c]=f*this._a+b*this._c+this._tx,a[c+1]=f*this._b+b*this._d+this._ty}return a},_transformCorners:function(s){var a=s.x,o=s.y,c=a+s.width,d=o+s.height,f=[a,o,c,o,c,d,a,d];return this._transformCoordinates(f,f,4)},_transformBounds:function(s,a,o){for(var c=this._transformCorners(s),d=c.slice(0,2),f=d.slice(),b=2;b<8;b++){var y=c[b],L=b&1;y<d[L]?d[L]=y:y>f[L]&&(f[L]=y)}return a||(a=new Z),a._set(d[0],d[1],f[0]-d[0],f[1]-d[1],o)},inverseTransform:function(){return this._inverseTransform(k.read(arguments))},_inverseTransform:function(s,a,o){var c=this._a,d=this._b,f=this._c,b=this._d,y=this._tx,L=this._ty,P=c*b-d*f,x=null;if(P&&!isNaN(P)&&isFinite(y)&&isFinite(L)){var E=s.x-this._tx,I=s.y-this._ty;a||(a=new k),x=a._set((E*b-I*f)/P,(I*c-E*d)/P,o)}return x},decompose:function(){var s=this._a,a=this._b,o=this._c,c=this._d,d=s*c-a*o,f=Math.sqrt,b=Math.atan2,y=180/Math.PI,L,P,x;if(s!==0||a!==0){var E=f(s*s+a*a);L=Math.acos(s/E)*(a>0?1:-1),P=[E,d/E],x=[b(s*o+a*c,E*E),0]}else if(o!==0||c!==0){var I=f(o*o+c*c);L=Math.asin(o/I)*(c>0?1:-1),P=[d/I,I],x=[0,b(s*o+a*c,I*I)]}else L=0,x=P=[0,0];return{translation:this.getTranslation(),rotation:L*y,scaling:new k(P),skewing:new k(x[0]*y,x[1]*y)}},getValues:function(){return[this._a,this._b,this._c,this._d,this._tx,this._ty]},getTranslation:function(){return new k(this._tx,this._ty)},getScaling:function(){return this.decompose().scaling},getRotation:function(){return this.decompose().rotation},applyToContext:function(s){this.isIdentity()||s.transform(this._a,this._b,this._c,this._d,this._tx,this._ty)}},n.each(["a","b","c","d","tx","ty"],function(s){var a=n.capitalize(s),o="_"+s;this["get"+a]=function(){return this[o]},this["set"+a]=function(c){this[o]=c,this._changed()}},{})),Oe=n.extend({_class:"Line",initialize:function(a,o,c,d,f){var b=!1;arguments.length>=4?(this._px=a,this._py=o,this._vx=c,this._vy=d,b=f):(this._px=a.x,this._py=a.y,this._vx=o.x,this._vy=o.y,b=c),b||(this._vx-=this._px,this._vy-=this._py)},getPoint:function(){return new k(this._px,this._py)},getVector:function(){return new k(this._vx,this._vy)},getLength:function(){return this.getVector().getLength()},intersect:function(s,a){return Oe.intersect(this._px,this._py,this._vx,this._vy,s._px,s._py,s._vx,s._vy,!0,a)},getSide:function(s,a){return Oe.getSide(this._px,this._py,this._vx,this._vy,s.x,s.y,!0,a)},getDistance:function(s){return Math.abs(this.getSignedDistance(s))},getSignedDistance:function(s){return Oe.getSignedDistance(this._px,this._py,this._vx,this._vy,s.x,s.y,!0)},isCollinear:function(s){return k.isCollinear(this._vx,this._vy,s._vx,s._vy)},isOrthogonal:function(s){return k.isOrthogonal(this._vx,this._vy,s._vx,s._vy)},statics:{intersect:function(s,a,o,c,d,f,b,y,L,P){L||(o-=s,c-=a,b-=d,y-=f);var x=o*y-c*b;if(!B.isMachineZero(x)){var E=s-d,I=a-f,T=(b*I-y*E)/x,M=(o*I-c*E)/x,V=1e-12,z=-V,N=1+V;if(P||z<T&&T<N&&z<M&&M<N)return P||(T=T<=0?0:T>=1?1:T),new k(s+T*o,a+T*c)}},getSide:function(s,a,o,c,d,f,b,y){b||(o-=s,c-=a);var L=d-s,P=f-a,x=L*c-P*o;return!y&&B.isMachineZero(x)&&(x=(L*o+L*o)/(o*o+c*c),x>=0&&x<=1&&(x=0)),x<0?-1:x>0?1:0},getSignedDistance:function(s,a,o,c,d,f,b){return b||(o-=s,c-=a),o===0?c>0?d-s:s-d:c===0?o<0?f-a:a-f:((d-s)*c-(f-a)*o)/(c>o?c*Math.sqrt(1+o*o/(c*c)):o*Math.sqrt(1+c*c/(o*o)))},getDistance:function(s,a,o,c,d,f,b){return Math.abs(Oe.getSignedDistance(s,a,o,c,d,f,b))}}}),de=p.extend({_class:"Project",_list:"projects",_reference:"project",_compactSerialize:!0,initialize:function(a){p.call(this,!0),this._children=[],this._namedChildren={},this._activeLayer=null,this._currentStyle=new sn(null,null,this),this._view=ni.create(this,a||Ci.getCanvas(1,1)),this._selectionItems={},this._selectionCount=0,this._updateVersion=0},_serialize:function(s,a){return n.serialize(this._children,s,!0,a)},_changed:function(s,a){if(s&1){var o=this._view;o&&(o._needsUpdate=!0,!o._requested&&o._autoUpdate&&o.requestUpdate())}var c=this._changes;if(c&&a){var d=this._changesById,f=a._id,b=d[f];b?b.flags|=s:c.push(d[f]={item:a,flags:s})}},clear:function(){for(var s=this._children,a=s.length-1;a>=0;a--)s[a].remove()},isEmpty:function(){return!this._children.length},remove:function s(){return s.base.call(this)?(this._view&&this._view.remove(),!0):!1},getView:function(){return this._view},getCurrentStyle:function(){return this._currentStyle},setCurrentStyle:function(s){this._currentStyle.set(s)},getIndex:function(){return this._index},getOptions:function(){return this._scope.settings},getLayers:function(){return this._children},getActiveLayer:function(){return this._activeLayer||new Fe({project:this,insert:!0})},getSymbolDefinitions:function(){var s=[],a={};return this.getItems({class:Re,match:function(o){var c=o._definition,d=c._id;return a[d]||(a[d]=!0,s.push(c)),!1}}),s},getSymbols:"getSymbolDefinitions",getSelectedItems:function(){var s=this._selectionItems,a=[];for(var o in s){var c=s[o],d=c._selection;d&1&&c.isInserted()?a.push(c):d||this._updateSelection(c)}return a},_updateSelection:function(s){var a=s._id,o=this._selectionItems;s._selection?o[a]!==s&&(this._selectionCount++,o[a]=s):o[a]===s&&(this._selectionCount--,delete o[a])},selectAll:function(){for(var s=this._children,a=0,o=s.length;a<o;a++)s[a].setFullySelected(!0)},deselectAll:function(){var s=this._selectionItems;for(var a in s)s[a].setFullySelected(!1)},addLayer:function(s){return this.insertLayer(t,s)},insertLayer:function(s,a){if(a instanceof Fe){a._remove(!1,!0),n.splice(this._children,[a],s,0),a._setProject(this,!0);var o=a._name;o&&a.setName(o),this._changes&&a._changed(5),this._activeLayer||(this._activeLayer=a)}else a=null;return a},_insertItem:function(s,a,o){return a=this.insertLayer(s,a)||(this._activeLayer||this._insertItem(t,new Fe(se.NO_INSERT),!0)).insertChild(s,a),o&&a.activate&&a.activate(),a},getItems:function(s){return se._getItems(this,s)},getItem:function(s){return se._getItems(this,s,null,null,!0)[0]||null},importJSON:function(s){this.activate();var a=this._activeLayer;return n.importJSON(s,a&&a.isEmpty()&&a)},removeOn:function(s){var a=this._removeSets;if(a){s==="mouseup"&&(a.mousedrag=null);var o=a[s];if(o){for(var c in o){var d=o[c];for(var f in a){var b=a[f];b&&b!=o&&delete b[d._id]}d.remove()}a[s]=null}}},draw:function(s,a,o){this._updateVersion++,s.save(),a.applyToContext(s);for(var c=this._children,d=new n({offset:new k(0,0),pixelRatio:o,viewMatrix:a.isIdentity()?null:a,matrices:[new ye],updateMatrix:!0}),f=0,b=c.length;f<b;f++)c[f].draw(s,d);if(s.restore(),this._selectionCount>0){s.save(),s.strokeWidth=1;var y=this._selectionItems,L=this._scope.settings.handleSize,P=this._updateVersion;for(var x in y)y[x]._drawSelection(s,a,L,y,P);s.restore()}}}),se=n.extend(r,{statics:{extend:function s(a){return a._serializeFields&&(a._serializeFields=n.set({},this.prototype._serializeFields,a._serializeFields)),s.base.apply(this,arguments)},INSERT:{insert:!0},NO_INSERT:{insert:!1}},_class:"Item",_name:null,_applyMatrix:!0,_canApplyMatrix:!0,_canScaleStroke:!1,_pivot:null,_visible:!0,_blendMode:"normal",_opacity:1,_locked:!1,_guide:!1,_clipMask:!1,_selection:0,_selectBounds:!0,_selectChildren:!1,_serializeFields:{name:null,applyMatrix:null,matrix:new ye,pivot:null,visible:!0,blendMode:"normal",opacity:1,locked:!1,guide:!1,clipMask:!1,selected:!1,data:{}},_prioritize:["applyMatrix"]},new function(){var s=["onMouseDown","onMouseUp","onMouseDrag","onClick","onDoubleClick","onMouseMove","onMouseEnter","onMouseLeave"];return n.each(s,function(a){this._events[a]={install:function(o){this.getView()._countItemEvent(o,1)},uninstall:function(o){this.getView()._countItemEvent(o,-1)}}},{_events:{onFrame:{install:function(){this.getView()._animateItem(this,!0)},uninstall:function(){this.getView()._animateItem(this,!1)}},onLoad:{},onError:{}},statics:{_itemHandlers:s}})},{initialize:function(){},_initialize:function(s,a){var o=s&&n.isPlainObject(s),c=o&&s.internal===!0,d=this._matrix=new ye,f=o&&s.project||kt.project,b=kt.settings;return this._id=c?null:U.get(),this._parent=this._index=null,this._applyMatrix=this._canApplyMatrix&&b.applyMatrix,a&&d.translate(a),d._owner=this,this._style=new sn(f._currentStyle,this,f),c||o&&s.insert==!1||!b.insertItems&&!(o&&s.insert==!0)?this._setProject(f):(o&&s.parent||f)._insertItem(t,this,!0),o&&s!==se.NO_INSERT&&s!==se.INSERT&&this.set(s,{internal:!0,insert:!0,project:!0,parent:!0}),o},_serialize:function(s,a){var o={},c=this;function d(f){for(var b in f){var y=c[b];n.equals(y,b==="leading"?f.fontSize*1.2:f[b])||(o[b]=n.serialize(y,s,b!=="data",a))}}return d(this._serializeFields),this instanceof fe||d(this._style._defaults),[this._class,o]},_changed:function(s){var a=this._symbol,o=this._parent||a,c=this._project;s&8&&(this._bounds=this._position=this._decomposed=t),s&16&&(this._globalMatrix=t),o&&s&72&&se._clearBoundsCache(o),s&2&&se._clearBoundsCache(this),c&&c._changed(s,this),a&&a._changed(s)},getId:function(){return this._id},getName:function(){return this._name},setName:function(s){if(this._name&&this._removeNamed(),s===+s+"")throw new Error("Names consisting only of numbers are not supported.");var a=this._getOwner();if(s&&a){var o=a._children,c=a._namedChildren;(c[s]=c[s]||[]).push(this),s in o||(o[s]=this)}this._name=s||t,this._changed(256)},getStyle:function(){return this._style},setStyle:function(s){this.getStyle().set(s)}},n.each(["locked","visible","blendMode","opacity","guide"],function(s){var a=n.capitalize(s),o="_"+s,c={locked:256,visible:265};this["get"+a]=function(){return this[o]},this["set"+a]=function(d){d!=this[o]&&(this[o]=d,this._changed(c[s]||257))}},{}),{beans:!0,getSelection:function(){return this._selection},setSelection:function(s){if(s!==this._selection){this._selection=s;var a=this._project;a&&(a._updateSelection(this),this._changed(257))}},_changeSelection:function(s,a){var o=this._selection;this.setSelection(a?o|s:o&~s)},isSelected:function(){if(this._selectChildren){for(var s=this._children,a=0,o=s.length;a<o;a++)if(s[a].isSelected())return!0}return!!(this._selection&1)},setSelected:function(s){if(this._selectChildren)for(var a=this._children,o=0,c=a.length;o<c;o++)a[o].setSelected(s);this._changeSelection(1,s)},isFullySelected:function(){var s=this._children,a=!!(this._selection&1);if(s&&a){for(var o=0,c=s.length;o<c;o++)if(!s[o].isFullySelected())return!1;return!0}return a},setFullySelected:function(s){var a=this._children;if(a)for(var o=0,c=a.length;o<c;o++)a[o].setFullySelected(s);this._changeSelection(1,s)},isClipMask:function(){return this._clipMask},setClipMask:function(s){this._clipMask!=(s=!!s)&&(this._clipMask=s,s&&(this.setFillColor(null),this.setStrokeColor(null)),this._changed(257),this._parent&&this._parent._changed(2048))},getData:function(){return this._data||(this._data={}),this._data},setData:function(s){this._data=s},getPosition:function(s){var a=s?k:Q,o=this._position||(this._position=this._getPositionFromBounds());return new a(o.x,o.y,this,"setPosition")},setPosition:function(){this.translate(k.read(arguments).subtract(this.getPosition(!0)))},_getPositionFromBounds:function(s){return this._pivot?this._matrix._transformPoint(this._pivot):(s||this.getBounds()).getCenter(!0)},getPivot:function(){var s=this._pivot;return s?new Q(s.x,s.y,this,"setPivot"):null},setPivot:function(){this._pivot=k.read(arguments,0,{clone:!0,readNull:!0}),this._position=t}},n.each({getStrokeBounds:{stroke:!0},getHandleBounds:{handle:!0},getInternalBounds:{internal:!0}},function(s,a){this[a]=function(o){return this.getBounds(o,s)}},{beans:!0,getBounds:function(s,a){var o=a||s instanceof ye,c=n.set({},o?a:s,this._boundsOptions);(!c.stroke||this.getStrokeScaling())&&(c.cacheItem=this);var d=this._getCachedBounds(o&&s,c).rect;return arguments.length?d:new ce(d.x,d.y,d.width,d.height,this,"setBounds")},setBounds:function(){var s=Z.read(arguments),a=this.getBounds(),o=this._matrix,c=new ye,d=s.getCenter();c.translate(d),(s.width!=a.width||s.height!=a.height)&&(o.isInvertible()||(o.set(o._backup||new ye().translate(o.getTranslation())),a=this.getBounds()),c.scale(a.width!==0?s.width/a.width:0,a.height!==0?s.height/a.height:0)),d=a.getCenter(),c.translate(-d.x,-d.y),this.transform(c)},_getBounds:function(s,a){var o=this._children;return!o||!o.length?new Z:(se._updateBoundsCache(this,a.cacheItem),se._getBounds(o,s,a))},_getBoundsCacheKey:function(s,a){return[s.stroke?1:0,s.handle?1:0,a?1:0].join("")},_getCachedBounds:function(s,a,o){s=s&&s._orNullIfIdentity();var c=a.internal&&!o,d=a.cacheItem,f=c?null:this._matrix._orNullIfIdentity(),b=d&&(!s||s.equals(f))&&this._getBoundsCacheKey(a,c),y=this._bounds;if(se._updateBoundsCache(this._parent||this._symbol,d),b&&y&&b in y){var L=y[b];return{rect:L.rect.clone(),nonscaling:L.nonscaling}}var P=this._getBounds(s||f,a),x=P.rect||P,E=this._style,I=P.nonscaling||E.hasStroke()&&!E.getStrokeScaling();if(b){y||(this._bounds=y={});var L=y[b]={rect:x.clone(),nonscaling:I,internal:c}}return{rect:x,nonscaling:I}},_getStrokeMatrix:function(s,a){var o=this.getStrokeScaling()?null:a&&a.internal?this:this._parent||this._symbol&&this._symbol._item,c=o?o.getViewMatrix().invert():s;return c&&c._shiftless()},statics:{_updateBoundsCache:function(s,a){if(s&&a){var o=a._id,c=s._boundsCache=s._boundsCache||{ids:{},list:[]};c.ids[o]||(c.list.push(a),c.ids[o]=a)}},_clearBoundsCache:function(s){var a=s._boundsCache;if(a){s._bounds=s._position=s._boundsCache=t;for(var o=0,c=a.list,d=c.length;o<d;o++){var f=c[o];f!==s&&(f._bounds=f._position=t,f._boundsCache&&se._clearBoundsCache(f))}}},_getBounds:function(s,a,o){var c=1/0,d=-c,f=c,b=d,y=!1;o=o||{};for(var L=0,P=s.length;L<P;L++){var x=s[L];if(x._visible&&!x.isEmpty(!0)){var E=x._getCachedBounds(a&&a.appended(x._matrix),o,!0),I=E.rect;c=Math.min(I.x,c),f=Math.min(I.y,f),d=Math.max(I.x+I.width,d),b=Math.max(I.y+I.height,b),E.nonscaling&&(y=!0)}}return{rect:isFinite(c)?new Z(c,f,d-c,b-f):new Z,nonscaling:y}}}}),{beans:!0,_decompose:function(){return this._applyMatrix?null:this._decomposed||(this._decomposed=this._matrix.decompose())},getRotation:function(){var s=this._decompose();return s?s.rotation:0},setRotation:function(s){var a=this.getRotation();if(a!=null&&s!=null){var o=this._decomposed;this.rotate(s-a),o&&(o.rotation=s,this._decomposed=o)}},getScaling:function(){var s=this._decompose(),a=s&&s.scaling;return new Q(a?a.x:1,a?a.y:1,this,"setScaling")},setScaling:function(){var s=this.getScaling(),a=k.read(arguments,0,{clone:!0,readNull:!0});if(s&&a&&!s.equals(a)){var o=this.getRotation(),c=this._decomposed,d=new ye,f=B.isZero;if(f(s.x)||f(s.y))d.translate(c.translation),o&&d.rotate(o),d.scale(a.x,a.y),this._matrix.set(d);else{var b=this.getPosition(!0);d.translate(b),o&&d.rotate(o),d.scale(a.x/s.x,a.y/s.y),o&&d.rotate(-o),d.translate(b.negate()),this.transform(d)}c&&(c.scaling=a,this._decomposed=c)}},getMatrix:function(){return this._matrix},setMatrix:function(){var s=this._matrix;s.set.apply(s,arguments)},getGlobalMatrix:function(s){var a=this._globalMatrix;if(a)for(var o=this._parent,c=[];o;){if(!o._globalMatrix){a=null;for(var d=0,f=c.length;d<f;d++)c[d]._globalMatrix=null;break}c.push(o),o=o._parent}if(!a){a=this._globalMatrix=this._matrix.clone();var o=this._parent;o&&a.prepend(o.getGlobalMatrix(!0))}return s?a:a.clone()},getViewMatrix:function(){return this.getGlobalMatrix().prepend(this.getView()._matrix)},getApplyMatrix:function(){return this._applyMatrix},setApplyMatrix:function(s){(this._applyMatrix=this._canApplyMatrix&&!!s)&&this.transform(null,!0)},getTransformContent:"#getApplyMatrix",setTransformContent:"#setApplyMatrix"},{getProject:function(){return this._project},_setProject:function(s,a){if(this._project!==s){this._project&&this._installEvents(!1),this._project=s;for(var o=this._children,c=0,d=o&&o.length;c<d;c++)o[c]._setProject(s);a=!0}a&&this._installEvents(!0)},getView:function(){return this._project._view},_installEvents:function s(a){s.base.call(this,a);for(var o=this._children,c=0,d=o&&o.length;c<d;c++)o[c]._installEvents(a)},getLayer:function(){for(var s=this;s=s._parent;)if(s instanceof Fe)return s;return null},getParent:function(){return this._parent},setParent:function(s){return s.addChild(this)},_getOwner:"#getParent",getChildren:function(){return this._children},setChildren:function(s){this.removeChildren(),this.addChildren(s)},getFirstChild:function(){return this._children&&this._children[0]||null},getLastChild:function(){return this._children&&this._children[this._children.length-1]||null},getNextSibling:function(){var s=this._getOwner();return s&&s._children[this._index+1]||null},getPreviousSibling:function(){var s=this._getOwner();return s&&s._children[this._index-1]||null},getIndex:function(){return this._index},equals:function(s){return s===this||s&&this._class===s._class&&this._style.equals(s._style)&&this._matrix.equals(s._matrix)&&this._locked===s._locked&&this._visible===s._visible&&this._blendMode===s._blendMode&&this._opacity===s._opacity&&this._clipMask===s._clipMask&&this._guide===s._guide&&this._equals(s)||!1},_equals:function(s){return n.equals(this._children,s._children)},clone:function(s){var a=new this.constructor(se.NO_INSERT),o=this._children,c=n.pick(s?s.insert:t,s===t||s===!0),d=n.pick(s?s.deep:t,!0);o&&a.copyAttributes(this),(!o||d)&&a.copyContent(this),o||a.copyAttributes(this),c&&a.insertAbove(this);var f=this._name,b=this._parent;if(f&&b){for(var o=b._children,y=f,L=1;o[f];)f=y+" "+L++;f!==y&&a.setName(f)}return a},copyContent:function(s){for(var a=s._children,o=0,c=a&&a.length;o<c;o++)this.addChild(a[o].clone(!1),!0)},copyAttributes:function(s,a){this.setStyle(s._style);for(var o=["_locked","_visible","_blendMode","_opacity","_clipMask","_guide"],c=0,d=o.length;c<d;c++){var f=o[c];s.hasOwnProperty(f)&&(this[f]=s[f])}a||this._matrix.set(s._matrix,!0),this.setApplyMatrix(s._applyMatrix),this.setPivot(s._pivot),this.setSelection(s._selection);var b=s._data,y=s._name;this._data=b?n.clone(b):null,y&&this.setName(y)},rasterize:function(s,a){var o,c,d;n.isPlainObject(s)?(o=s.resolution,c=s.insert,d=s.raster):(o=s,c=a),d||(d=new ze(se.NO_INSERT));var f=this.getStrokeBounds(),b=(o||this.getView().getResolution())/72,y=f.getTopLeft().floor(),L=f.getBottomRight().ceil(),P=new X(L.subtract(y)),x=P.multiply(b);if(d.setSize(x,!0),!x.isZero()){var E=d.getContext(!0),I=new ye().scale(b).translate(y.negate());E.save(),I.applyToContext(E),this.draw(E,new n({matrices:[I]})),E.restore()}return d._matrix.set(new ye().translate(y.add(P.divide(2))).scale(1/b)),(c===t||c)&&d.insertAbove(this),d},contains:function(){var s=this._matrix;return s.isInvertible()&&!!this._contains(s._inverseTransform(k.read(arguments)))},_contains:function(s){var a=this._children;if(a){for(var o=a.length-1;o>=0;o--)if(a[o].contains(s))return!0;return!1}return s.isInside(this.getInternalBounds())},isInside:function(){return Z.read(arguments).contains(this.getBounds())},_asPathItem:function(){return new Ae.Rectangle({rectangle:this.getInternalBounds(),matrix:this._matrix,insert:!1})},intersects:function(s,a){return s instanceof se?this._asPathItem().getIntersections(s._asPathItem(),null,a,!0).length>0:!1}},new function(){function s(){var c=arguments;return this._hitTest(k.read(c),Ze.getOptions(c))}function a(){var c=arguments,d=k.read(c),f=Ze.getOptions(c),b=[];return this._hitTest(d,new n({all:b},f)),b}function o(c,d,f,b){var y=this._children;if(y)for(var L=y.length-1;L>=0;L--){var P=y[L],x=P!==b&&P._hitTest(c,d,f);if(x&&!d.all)return x}return null}return de.inject({hitTest:s,hitTestAll:a,_hitTest:o}),{hitTest:s,hitTestAll:a,_hitTestChildren:o}},{_hitTest:function(s,a,o){if(this._locked||!this._visible||this._guide&&!a.guides||this.isEmpty())return null;var c=this._matrix,d=o?o.appended(c):this.getGlobalMatrix().prepend(this.getView()._matrix),f=Math.max(a.tolerance,1e-12),b=a._tolerancePadding=new X(Ae._getStrokePadding(f,c._shiftless().invert()));if(s=c._inverseTransform(s),!s||!this._children&&!this.getBounds({internal:!0,stroke:!0,handle:!0}).expand(b.multiply(2))._containsPoint(s))return null;var y=!(a.guides&&!this._guide||a.selected&&!this.isSelected()||a.type&&a.type!==n.hyphenate(this._class)||a.class&&!(this instanceof a.class)),L=a.match,P=this,x,E;function I(D){return D&&L&&!L(D)&&(D=null),D&&a.all&&a.all.push(D),D}function T(D,O){var H=O?x["get"+O]():P.getPosition();if(s.subtract(H).divide(b).length<=1)return new Ze(D,P,{name:O?n.hyphenate(O):D,point:H})}var M=a.position,V=a.center,z=a.bounds;if(y&&this._parent&&(M||V||z)){if((V||z)&&(x=this.getInternalBounds()),E=M&&T("position")||V&&T("center","Center"),!E&&z)for(var N=["TopLeft","TopRight","BottomLeft","BottomRight","LeftCenter","TopCenter","RightCenter","BottomCenter"],F=0;F<8&&!E;F++)E=T("bounds",N[F]);E=I(E)}return E||(E=this._hitTestChildren(s,a,d)||y&&I(this._hitTestSelf(s,a,d,this.getStrokeScaling()?null:d._shiftless().invert()))||null),E&&E.point&&(E.point=c.transform(E.point)),E},_hitTestSelf:function(s,a){if(a.fill&&this.hasFill()&&this._contains(s))return new Ze("fill",this)},matches:function(s,a){function o(b,y){for(var L in b)if(b.hasOwnProperty(L)){var P=b[L],x=y[L];if(n.isPlainObject(P)&&n.isPlainObject(x)){if(!o(P,x))return!1}else if(!n.equals(P,x))return!1}return!0}var c=typeof s;if(c==="object"){for(var d in s)if(s.hasOwnProperty(d)&&!this.matches(d,s[d]))return!1;return!0}else{if(c==="function")return s(this);if(s==="match")return a(this);var f=/^(empty|editable)$/.test(s)?this["is"+n.capitalize(s)]():s==="type"?n.hyphenate(this._class):this[s];if(s==="class"){if(typeof a=="function")return this instanceof a;f=this._class}if(typeof a=="function")return!!a(f);if(a){if(a.test)return a.test(f);if(n.isPlainObject(a))return o(a,f)}return n.equals(f,a)}},getItems:function(s){return se._getItems(this,s,this._matrix)},getItem:function(s){return se._getItems(this,s,this._matrix,null,!0)[0]||null},statics:{_getItems:function s(a,o,c,d,f){if(!d){var b=typeof o=="object"&&o,y=b&&b.overlapping,L=b&&b.inside,P=y||L,I=P&&Z.read([P]);d={items:[],recursive:b&&b.recursive!==!1,inside:!!L,overlapping:!!y,rect:I,path:y&&new Ae.Rectangle({rectangle:I,insert:!1})},b&&(o=n.filter({},o,{recursive:!0,inside:!0,overlapping:!0}))}var x=a._children,E=d.items,I=d.rect;c=I&&(c||new ye);for(var T=0,M=x&&x.length;T<M;T++){var V=x[T],z=c&&c.appended(V._matrix),N=!0;if(I){var P=V.getBounds(z);if(!I.intersects(P))continue;I.contains(P)||d.overlapping&&(P.contains(I)||d.path.intersects(V,z))||(N=!1)}if(N&&V.matches(o)&&(E.push(V),f)||(d.recursive!==!1&&s(V,o,z,d,f),f&&E.length>0))break}return E}}},{importJSON:function(s){var a=n.importJSON(s,this);return a!==this?this.addChild(a):a},addChild:function(s){return this.insertChild(t,s)},insertChild:function(s,a){var o=a?this.insertChildren(s,[a]):null;return o&&o[0]},addChildren:function(s){return this.insertChildren(this._children.length,s)},insertChildren:function(s,a){var o=this._children;if(o&&a&&a.length>0){a=n.slice(a);for(var c={},d=a.length-1;d>=0;d--){var f=a[d],b=f&&f._id;!f||c[b]?a.splice(d,1):(f._remove(!1,!0),c[b]=!0)}n.splice(o,a,s,0);for(var y=this._project,L=y._changes,d=0,P=a.length;d<P;d++){var f=a[d],x=f._name;f._parent=this,f._setProject(y,!0),x&&f.setName(x),L&&f._changed(5)}this._changed(11)}else a=null;return a},_insertItem:"#insertChild",_insertAt:function(s,a){var o=s&&s._getOwner(),c=s!==this&&o?this:null;return c&&(c._remove(!1,!0),o._insertItem(s._index+a,c)),c},insertAbove:function(s){return this._insertAt(s,1)},insertBelow:function(s){return this._insertAt(s,0)},sendToBack:function(){var s=this._getOwner();return s?s._insertItem(0,this):null},bringToFront:function(){var s=this._getOwner();return s?s._insertItem(t,this):null},appendTop:"#addChild",appendBottom:function(s){return this.insertChild(0,s)},moveAbove:"#insertAbove",moveBelow:"#insertBelow",addTo:function(s){return s._insertItem(t,this)},copyTo:function(s){return this.clone(!1).addTo(s)},reduce:function(s){var a=this._children;if(a&&a.length===1){var o=a[0].reduce(s);return this._parent?(o.insertAbove(this),this.remove()):o.remove(),o}return this},_removeNamed:function(){var s=this._getOwner();if(s){var a=s._children,o=s._namedChildren,c=this._name,d=o[c],f=d?d.indexOf(this):-1;f!==-1&&(a[c]==this&&delete a[c],d.splice(f,1),d.length?a[c]=d[0]:delete o[c])}},_remove:function(s,a){var o=this._getOwner(),c=this._project,d=this._index;return this._style&&this._style._dispose(),o?(this._name&&this._removeNamed(),d!=null&&(c._activeLayer===this&&(c._activeLayer=this.getNextSibling()||this.getPreviousSibling()),n.splice(o._children,null,d,1)),this._installEvents(!1),s&&c._changes&&this._changed(5),a&&o._changed(11,this),this._parent=null,!0):!1},remove:function(){return this._remove(!0,!0)},replaceWith:function(s){var a=s&&s.insertBelow(this);return a&&this.remove(),a},removeChildren:function(s,a){if(!this._children)return null;s=s||0,a=n.pick(a,this._children.length);for(var o=n.splice(this._children,null,s,a-s),c=o.length-1;c>=0;c--)o[c]._remove(!0,!1);return o.length>0&&this._changed(11),o},clear:"#removeChildren",reverseChildren:function(){if(this._children){this._children.reverse();for(var s=0,a=this._children.length;s<a;s++)this._children[s]._index=s;this._changed(11)}},isEmpty:function(s){var a=this._children,o=a?a.length:0;if(s){for(var c=0;c<o;c++)if(!a[c].isEmpty(s))return!1;return!0}return!o},isEditable:function(){for(var s=this;s;){if(!s._visible||s._locked)return!1;s=s._parent}return!0},hasFill:function(){return this.getStyle().hasFill()},hasStroke:function(){return this.getStyle().hasStroke()},hasShadow:function(){return this.getStyle().hasShadow()},_getOrder:function(s){function a(b){var y=[];do y.unshift(b);while(b=b._parent);return y}for(var o=a(this),c=a(s),d=0,f=Math.min(o.length,c.length);d<f;d++)if(o[d]!=c[d])return o[d]._index<c[d]._index?1:-1;return 0},hasChildren:function(){return this._children&&this._children.length>0},isInserted:function(){return this._parent?this._parent.isInserted():!1},isAbove:function(s){return this._getOrder(s)===-1},isBelow:function(s){return this._getOrder(s)===1},isParent:function(s){return this._parent===s},isChild:function(s){return s&&s._parent===this},isDescendant:function(s){for(var a=this;a=a._parent;)if(a===s)return!0;return!1},isAncestor:function(s){return s?s.isDescendant(this):!1},isSibling:function(s){return this._parent===s._parent},isGroupedWith:function(s){for(var a=this._parent;a;){if(a._parent&&/^(Group|Layer|CompoundPath)$/.test(a._class)&&s.isDescendant(a))return!0;a=a._parent}return!1}},n.each(["rotate","scale","shear","skew"],function(s){var a=s==="rotate";this[s]=function(){var o=arguments,c=(a?n:k).read(o),d=k.read(o,0,{readNull:!0});return this.transform(new ye()[s](c,d||this.getPosition(!0)))}},{translate:function(){var s=new ye;return this.transform(s.translate.apply(s,arguments))},transform:function(s,a,o){var c=this._matrix,d=s&&!s.isIdentity(),f=o&&this._canApplyMatrix||this._applyMatrix&&(d||!c.isIdentity()||a&&this._children);if(!d&&!f)return this;if(d){!s.isInvertible()&&c.isInvertible()&&(c._backup=c.getValues()),c.prepend(s,!0);var b=this._style,y=b.getFillColor(!0),L=b.getStrokeColor(!0);y&&y.transform(s),L&&L.transform(s)}if(f&&(f=this._transformContent(c,a,o))){var P=this._pivot;P&&c._transformPoint(P,P,!0),c.reset(!0),o&&this._canApplyMatrix&&(this._applyMatrix=!0)}var x=this._bounds,E=this._position;(d||f)&&this._changed(25);var I=d&&x&&s.decompose();if(I&&I.skewing.isZero()&&I.rotation%90===0){for(var T in x){var M=x[T];if(M.nonscaling)delete x[T];else if(f||!M.internal){var V=M.rect;s._transformBounds(V,V)}}this._bounds=x;var z=x[this._getBoundsCacheKey(this._boundsOptions||{})];z&&(this._position=this._getPositionFromBounds(z.rect))}else d&&E&&this._pivot&&(this._position=s._transformPoint(E,E));return this},_transformContent:function(s,a,o){var c=this._children;if(c){for(var d=0,f=c.length;d<f;d++)c[d].transform(s,a,o);return!0}},globalToLocal:function(){return this.getGlobalMatrix(!0)._inverseTransform(k.read(arguments))},localToGlobal:function(){return this.getGlobalMatrix(!0)._transformPoint(k.read(arguments))},parentToLocal:function(){return this._matrix._inverseTransform(k.read(arguments))},localToParent:function(){return this._matrix._transformPoint(k.read(arguments))},fitBounds:function(s,a){s=Z.read(arguments);var o=this.getBounds(),c=o.height/o.width,d=s.height/s.width,f=(a?c>d:c<d)?s.width/o.width:s.height/o.height,b=new Z(new k,new X(o.width*f,o.height*f));b.setCenter(s.getCenter()),this.setBounds(b)}}),{_setStyles:function(s,a,o){var c=this._style,d=this._matrix;if(c.hasFill()&&(s.fillStyle=c.getFillColor().toCanvasStyle(s,d)),c.hasStroke()){s.strokeStyle=c.getStrokeColor().toCanvasStyle(s,d),s.lineWidth=c.getStrokeWidth();var f=c.getStrokeJoin(),b=c.getStrokeCap(),y=c.getMiterLimit();if(f&&(s.lineJoin=f),b&&(s.lineCap=b),y&&(s.miterLimit=y),kt.support.nativeDash){var L=c.getDashArray(),P=c.getDashOffset();L&&L.length&&("setLineDash"in s?(s.setLineDash(L),s.lineDashOffset=P):(s.mozDash=L,s.mozDashOffset=P))}}if(c.hasShadow()){var x=a.pixelRatio||1,E=o._shiftless().prepend(new ye().scale(x,x)),I=E.transform(new k(c.getShadowBlur(),0)),T=E.transform(this.getShadowOffset());s.shadowColor=c.getShadowColor().toCanvasStyle(s),s.shadowBlur=I.getLength(),s.shadowOffsetX=T.x,s.shadowOffsetY=T.y}},draw:function(s,a,o){if(this._updateVersion=this._project._updateVersion,!(!this._visible||this._opacity===0)){var c=a.matrices,d=a.viewMatrix,f=this._matrix,b=c[c.length-1].appended(f);if(b.isInvertible()){d=d?d.appended(b):b,c.push(b),a.updateMatrix&&(this._globalMatrix=b);var y=this._blendMode,L=B.clamp(this._opacity,0,1),P=y==="normal",x=Vr.nativeModes[y],E=P&&L===1||a.dontStart||a.clip||(x||P&&L<1)&&this._canComposite(),I=a.pixelRatio||1,T,M,V;if(!E){var z=this.getStrokeBounds(d);if(!z.width||!z.height){c.pop();return}V=a.offset,M=a.offset=z.getTopLeft().floor(),T=s,s=Ci.getContext(z.getSize().ceil().add(1).multiply(I)),I!==1&&s.scale(I,I)}s.save();var N=o?o.appended(f):this._canScaleStroke&&!this.getStrokeScaling(!0)&&d,F=!E&&a.clipItem,D=!N||F;if(E?(s.globalAlpha=L,x&&(s.globalCompositeOperation=y)):D&&s.translate(-M.x,-M.y),D&&(E?f:d).applyToContext(s),F&&a.clipItem.draw(s,a.extend({clip:!0})),N){s.setTransform(I,0,0,I,0,0);var O=a.offset;O&&s.translate(-O.x,-O.y)}this._draw(s,a,d,N),s.restore(),c.pop(),a.clip&&!a.dontFinish&&s.clip(this.getFillRule()),E||(Vr.process(y,s,T,L,M.subtract(V).multiply(I)),Ci.release(s),a.offset=V)}}},_isUpdated:function(s){var a=this._parent;if(a instanceof Xe)return a._isUpdated(s);var o=this._updateVersion===s;return!o&&a&&a._visible&&a._isUpdated(s)&&(this._updateVersion=s,o=!0),o},_drawSelection:function(s,a,o,c,d){var f=this._selection,b=f&1,y=f&2||b&&this._selectBounds,L=f&4;if(this._drawSelected||(b=!1),(b||y||L)&&this._isUpdated(d)){var P,x=this.getSelectedColor(!0)||(P=this.getLayer())&&P.getSelectedColor(!0),E=a.appended(this.getGlobalMatrix(!0)),I=o/2;if(s.strokeStyle=s.fillStyle=x?x.toCanvasStyle(s):"#009dec",b&&this._drawSelected(s,E,c),L){var T=this.getPosition(!0),M=this._parent,V=M?M.localToGlobal(T):T,z=V.x,N=V.y;s.beginPath(),s.arc(z,N,I,0,Math.PI*2,!0),s.stroke();for(var F=[[0,-1],[1,0],[0,1],[-1,0]],D=I,O=o+1,H=0;H<4;H++){var G=F[H],K=G[0],j=G[1];s.moveTo(z+K*D,N+j*D),s.lineTo(z+K*O,N+j*O),s.stroke()}}if(y){var J=E._transformCorners(this.getInternalBounds());s.beginPath();for(var H=0;H<8;H++)s[H?"lineTo":"moveTo"](J[H],J[++H]);s.closePath(),s.stroke();for(var H=0;H<8;H++)s.fillRect(J[H]-I,J[++H]-I,o,o)}}},_canComposite:function(){return!1}},n.each(["down","drag","up","move"],function(s){this["removeOn"+n.capitalize(s)]=function(){var a={};return a[s]=!0,this.removeOn(a)}},{removeOn:function(s){for(var a in s)if(s[a]){var o="mouse"+a,c=this._project,d=c._removeSets=c._removeSets||{};d[o]=d[o]||{},d[o][this._id]=this}return this}}),{tween:function(s,a,o){o||(o=a,a=s,s=null,o||(o=a,a=null));var c=o&&o.easing,d=o&&o.start,f=o!=null&&(typeof o=="number"?o:o.duration),b=new Rn(this,s,a,f,c,d);function y(L){b._handleFrame(L.time*1e3),b.running||this.off("frame",y)}return f&&this.on("frame",y),b},tweenTo:function(s,a){return this.tween(null,s,a)},tweenFrom:function(s,a){return this.tween(s,null,a)}}),fe=se.extend({_class:"Group",_selectBounds:!1,_selectChildren:!0,_serializeFields:{children:[]},initialize:function(a){this._children=[],this._namedChildren={},this._initialize(a)||this.addChildren(Array.isArray(a)?a:arguments)},_changed:function s(a){s.base.call(this,a),a&2050&&(this._clipItem=t)},_getClipItem:function(){var s=this._clipItem;if(s===t){s=null;for(var a=this._children,o=0,c=a.length;o<c;o++)if(a[o]._clipMask){s=a[o];break}this._clipItem=s}return s},isClipped:function(){return!!this._getClipItem()},setClipped:function(s){var a=this.getFirstChild();a&&a.setClipMask(s)},_getBounds:function s(a,o){var c=this._getClipItem();return c?c._getCachedBounds(c._matrix.prepended(a),n.set({},o,{stroke:!1})):s.base.call(this,a,o)},_hitTestChildren:function s(a,o,c){var d=this._getClipItem();return(!d||d.contains(a))&&s.base.call(this,a,o,c,d)},_draw:function(s,a){var o=a.clip,c=!o&&this._getClipItem();a=a.extend({clipItem:c,clip:!1}),o?(s.beginPath(),a.dontStart=a.dontFinish=!0):c&&c.draw(s,a.extend({clip:!0}));for(var d=this._children,f=0,b=d.length;f<b;f++){var y=d[f];y!==c&&y.draw(s,a)}}}),Fe=fe.extend({_class:"Layer",initialize:function(){fe.apply(this,arguments)},_getOwner:function(){return this._parent||this._index!=null&&this._project},isInserted:function s(){return this._parent?s.base.call(this):this._index!=null},activate:function(){this._project._activeLayer=this},_hitTestSelf:function(){}}),Se=se.extend({_class:"Shape",_applyMatrix:!1,_canApplyMatrix:!1,_canScaleStroke:!0,_serializeFields:{type:null,size:null,radius:null},initialize:function(a,o){this._initialize(a,o)},_equals:function(s){return this._type===s._type&&this._size.equals(s._size)&&n.equals(this._radius,s._radius)},copyContent:function(s){this.setType(s._type),this.setSize(s._size),this.setRadius(s._radius)},getType:function(){return this._type},setType:function(s){this._type=s},getShape:"#getType",setShape:"#setType",getSize:function(){var s=this._size;return new g(s.width,s.height,this,"setSize")},setSize:function(){var s=X.read(arguments);if(!this._size)this._size=s.clone();else if(!this._size.equals(s)){var a=this._type,o=s.width,c=s.height;a==="rectangle"?this._radius.set(X.min(this._radius,s.divide(2).abs())):a==="circle"?(o=c=(o+c)/2,this._radius=o/2):a==="ellipse"&&this._radius._set(o/2,c/2),this._size._set(o,c),this._changed(9)}},getRadius:function(){var s=this._radius;return this._type==="circle"?s:new g(s.width,s.height,this,"setRadius")},setRadius:function(s){var a=this._type;if(a==="circle"){if(s===this._radius)return;var o=s*2;this._radius=s,this._size._set(o,o)}else if(s=X.read(arguments),!this._radius)this._radius=s.clone();else{if(this._radius.equals(s))return;if(this._radius.set(s),a==="rectangle"){var o=X.max(this._size,s.multiply(2));this._size.set(o)}else a==="ellipse"&&this._size._set(s.width*2,s.height*2)}this._changed(9)},isEmpty:function(){return!1},toPath:function(s){var a=new Ae[n.capitalize(this._type)]({center:new k,size:this._size,radius:this._radius,insert:!1});return a.copyAttributes(this),kt.settings.applyMatrix&&a.setApplyMatrix(!0),(s===t||s)&&a.insertAbove(this),a},toShape:"#clone",_asPathItem:function(){return this.toPath(!1)},_draw:function(s,a,o,c){var d=this._style,f=d.hasFill(),b=d.hasStroke(),y=a.dontFinish||a.clip,L=!c;if(f||b||y){var P=this._type,x=this._radius,E=P==="circle";if(a.dontStart||s.beginPath(),L&&E)s.arc(0,0,x,0,Math.PI*2,!0);else{var I=E?x:x.width,T=E?x:x.height,M=this._size,V=M.width,z=M.height;if(L&&P==="rectangle"&&I===0&&T===0)s.rect(-V/2,-z/2,V,z);else{var N=V/2,F=z/2,D=1-.5522847498307936,O=I*D,H=T*D,G=[-N,-F+T,-N,-F+H,-N+O,-F,-N+I,-F,N-I,-F,N-O,-F,N,-F+H,N,-F+T,N,F-T,N,F-H,N-O,F,N-I,F,-N+I,F,-N+O,F,-N,F-H,-N,F-T];c&&c.transform(G,G,32),s.moveTo(G[0],G[1]),s.bezierCurveTo(G[2],G[3],G[4],G[5],G[6],G[7]),N!==I&&s.lineTo(G[8],G[9]),s.bezierCurveTo(G[10],G[11],G[12],G[13],G[14],G[15]),F!==T&&s.lineTo(G[16],G[17]),s.bezierCurveTo(G[18],G[19],G[20],G[21],G[22],G[23]),N!==I&&s.lineTo(G[24],G[25]),s.bezierCurveTo(G[26],G[27],G[28],G[29],G[30],G[31])}}s.closePath()}!y&&(f||b)&&(this._setStyles(s,a,o),f&&(s.fill(d.getFillRule()),s.shadowColor="rgba(0,0,0,0)"),b&&s.stroke())},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_getBounds:function(s,a){var o=new Z(this._size).setCenter(0,0),c=this._style,d=a.stroke&&c.hasStroke()&&c.getStrokeWidth();return s&&(o=s._transformBounds(o)),d?o.expand(Ae._getStrokePadding(d,this._getStrokeMatrix(s,a))):o}},new function(){function s(o,c,d){var f=o._radius;if(!f.isZero())for(var b=o._size.divide(2),y=1;y<=4;y++){var L=new k(y>1&&y<4?-1:1,y>2?-1:1),P=L.multiply(b),x=P.subtract(L.multiply(f)),E=new Z(d?P.add(L.multiply(d)):P,x);if(E.contains(c))return{point:x,quadrant:y}}}function a(o,c,d,f){var b=o.divide(c);return(!f||b.isInQuadrant(f))&&b.subtract(b.normalize()).multiply(c).divide(d).length<=1}return{_contains:function o(c){if(this._type==="rectangle"){var d=s(this,c);return d?c.subtract(d.point).divide(this._radius).getLength()<=1:o.base.call(this,c)}else return c.divide(this.size).getLength()<=.5},_hitTestSelf:function o(c,d,f,b){var y=!1,L=this._style,P=d.stroke&&L.hasStroke(),x=d.fill&&L.hasFill();if(P||x){var E=this._type,I=this._radius,T=P?L.getStrokeWidth()/2:0,M=d._tolerancePadding.add(Ae._getStrokePadding(T,!L.getStrokeScaling()&&b));if(E==="rectangle"){var V=M.multiply(2),z=s(this,c,V);if(z)y=a(c.subtract(z.point),I,M,z.quadrant);else{var N=new Z(this._size).setCenter(0,0),F=N.expand(V),D=N.expand(V.negate());y=F._containsPoint(c)&&!D._containsPoint(c)}}else y=a(c,I,M)}return y?new Ze(P?"stroke":"fill",this):o.base.apply(this,arguments)}}},{statics:new function(){function s(a,o,c,d,f){var b=n.create(Se.prototype);return b._type=a,b._size=c,b._radius=d,b._initialize(n.getNamed(f),o),b}return{Circle:function(){var a=arguments,o=k.readNamed(a,"center"),c=n.readNamed(a,"radius");return s("circle",o,new X(c*2),c,a)},Rectangle:function(){var a=arguments,o=Z.readNamed(a,"rectangle"),c=X.min(X.readNamed(a,"radius"),o.getSize(!0).divide(2));return s("rectangle",o.getCenter(!0),o.getSize(!0),c,a)},Ellipse:function(){var a=arguments,o=Se._readEllipse(a),c=o.radius;return s("ellipse",o.center,c.multiply(2),c,a)},_readEllipse:function(a){var o,c;if(n.hasNamed(a,"radius"))o=k.readNamed(a,"center"),c=X.readNamed(a,"radius");else{var d=Z.readNamed(a,"rectangle");o=d.getCenter(!0),c=d.getSize(!0).divide(2)}return{center:o,radius:c}}}}}),ze=se.extend({_class:"Raster",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!1,handle:!1},_serializeFields:{crossOrigin:null,source:null},_prioritize:["crossOrigin"],_smoothing:"low",beans:!0,initialize:function(a,o){if(!this._initialize(a,o!==t&&k.read(arguments))){var c,d=typeof a,f=d==="string"?i.getElementById(a):d==="object"?a:null;if(f&&f!==se.NO_INSERT){if(f.getContext||f.naturalHeight!=null)c=f;else if(f){var b=X.read(arguments);b.isZero()||(c=Ci.getCanvas(b))}}c?this.setImage(c):this.setSource(a)}this._size||(this._size=new X,this._loaded=!1)},_equals:function(s){return this.getSource()===s.getSource()},copyContent:function(s){var a=s._image,o=s._canvas;if(a)this._setImage(a);else if(o){var c=Ci.getCanvas(s._size);c.getContext("2d").drawImage(o,0,0),this._setImage(c)}this._crossOrigin=s._crossOrigin},getSize:function(){var s=this._size;return new g(s?s.width:0,s?s.height:0,this,"setSize")},setSize:function(s,a){var o=X.read(arguments);if(o.equals(this._size))a&&this.clear();else if(o.width>0&&o.height>0){var c=!a&&this.getElement();this._setImage(Ci.getCanvas(o)),c&&this.getContext(!0).drawImage(c,0,0,o.width,o.height)}else this._canvas&&Ci.release(this._canvas),this._size=o.clone()},getWidth:function(){return this._size?this._size.width:0},setWidth:function(s){this.setSize(s,this.getHeight())},getHeight:function(){return this._size?this._size.height:0},setHeight:function(s){this.setSize(this.getWidth(),s)},getLoaded:function(){return this._loaded},isEmpty:function(){var s=this._size;return!s||s.width===0&&s.height===0},getResolution:function(){var s=this._matrix,a=new k(0,0).transform(s),o=new k(1,0).transform(s).subtract(a),c=new k(0,1).transform(s).subtract(a);return new X(72/o.getLength(),72/c.getLength())},getPpi:"#getResolution",getImage:function(){return this._image},setImage:function(s){var a=this;function o(c){var d=a.getView(),f=c&&c.type||"load";d&&a.responds(f)&&(kt=d._scope,a.emit(f,new nn(c)))}this._setImage(s),this._loaded?setTimeout(o,0):s&&hi.add(s,{load:function(c){a._setImage(s),o(c)},error:o})},_setImage:function(s){this._canvas&&Ci.release(this._canvas),s&&s.getContext?(this._image=null,this._canvas=s,this._loaded=!0):(this._image=s,this._canvas=null,this._loaded=!!(s&&s.src&&s.complete)),this._size=new X(s?s.naturalWidth||s.width:0,s?s.naturalHeight||s.height:0),this._context=null,this._changed(1033)},getCanvas:function(){if(!this._canvas){var s=Ci.getContext(this._size);try{this._image&&s.drawImage(this._image,0,0),this._canvas=s.canvas}catch{Ci.release(s)}}return this._canvas},setCanvas:"#setImage",getContext:function(s){return this._context||(this._context=this.getCanvas().getContext("2d")),s&&(this._image=null,this._changed(1025)),this._context},setContext:function(s){this._context=s},getSource:function(){var s=this._image;return s&&s.src||this.toDataURL()},setSource:function(s){var a=new e.Image,o=this._crossOrigin;o&&(a.crossOrigin=o),s&&(a.src=s),this.setImage(a)},getCrossOrigin:function(){var s=this._image;return s&&s.crossOrigin||this._crossOrigin||""},setCrossOrigin:function(s){this._crossOrigin=s;var a=this._image;a&&(a.crossOrigin=s)},getSmoothing:function(){return this._smoothing},setSmoothing:function(s){this._smoothing=typeof s=="string"?s:s?"low":"off",this._changed(257)},getElement:function(){return this._canvas||this._loaded&&this._image}},{beans:!1,getSubCanvas:function(){var s=Z.read(arguments),a=Ci.getContext(s.getSize());return a.drawImage(this.getCanvas(),s.x,s.y,s.width,s.height,0,0,s.width,s.height),a.canvas},getSubRaster:function(){var s=Z.read(arguments),a=new ze(se.NO_INSERT);return a._setImage(this.getSubCanvas(s)),a.translate(s.getCenter().subtract(this.getSize().divide(2))),a._matrix.prepend(this._matrix),a.insertAbove(this),a},toDataURL:function(){var s=this._image,a=s&&s.src;if(/^data:/.test(a))return a;var o=this.getCanvas();return o?o.toDataURL.apply(o,arguments):null},drawImage:function(s){var a=k.read(arguments,1);this.getContext(!0).drawImage(s,a.x,a.y)},getAverageColor:function(s){var a,o;if(s?s instanceof Ve?(o=s,a=s.getBounds()):typeof s=="object"&&("width"in s?a=new Z(s):"x"in s&&(a=new Z(s.x-.5,s.y-.5,1,1))):a=this.getBounds(),!a)return null;var c=32,d=Math.min(a.width,c),f=Math.min(a.height,c),b=ze._sampleContext;b?b.clearRect(0,0,c+1,c+1):b=ze._sampleContext=Ci.getContext(new X(c)),b.save();var y=new ye().scale(d/a.width,f/a.height).translate(-a.x,-a.y);y.applyToContext(b),o&&o.draw(b,new n({clip:!0,matrices:[y]})),this._matrix.applyToContext(b);var L=this.getElement(),P=this._size;L&&b.drawImage(L,-P.width/2,-P.height/2),b.restore();for(var x=b.getImageData(.5,.5,Math.ceil(d),Math.ceil(f)).data,E=[0,0,0],I=0,T=0,M=x.length;T<M;T+=4){var V=x[T+3];I+=V,V/=255,E[0]+=x[T]*V,E[1]+=x[T+1]*V,E[2]+=x[T+2]*V}for(var T=0;T<3;T++)E[T]/=I;return I?Qt.read(E):null},getPixel:function(){var s=k.read(arguments),a=this.getContext().getImageData(s.x,s.y,1,1).data;return new Qt("rgb",[a[0]/255,a[1]/255,a[2]/255],a[3]/255)},setPixel:function(){var s=arguments,a=k.read(s),o=Qt.read(s),c=o._convert("rgb"),d=o._alpha,f=this.getContext(!0),b=f.createImageData(1,1),y=b.data;y[0]=c[0]*255,y[1]=c[1]*255,y[2]=c[2]*255,y[3]=d!=null?d*255:255,f.putImageData(b,a.x,a.y)},clear:function(){var s=this._size;this.getContext(!0).clearRect(0,0,s.width+1,s.height+1)},createImageData:function(){var s=X.read(arguments);return this.getContext().createImageData(s.width,s.height)},getImageData:function(){var s=Z.read(arguments);return s.isEmpty()&&(s=new Z(this._size)),this.getContext().getImageData(s.x,s.y,s.width,s.height)},putImageData:function(s){var a=k.read(arguments,1);this.getContext(!0).putImageData(s,a.x,a.y)},setImageData:function(s){this.setSize(s),this.getContext(!0).putImageData(s,0,0)},_getBounds:function(s,a){var o=new Z(this._size).setCenter(0,0);return s?s._transformBounds(o):o},_hitTestSelf:function(s){if(this._contains(s)){var a=this;return new Ze("pixel",a,{offset:s.add(a._size.divide(2)).round(),color:{get:function(){return a.getPixel(this.offset)}}})}},_draw:function(s,a,o){var c=this.getElement();if(c&&c.width>0&&c.height>0){s.globalAlpha=B.clamp(this._opacity,0,1),this._setStyles(s,a,o);var d=this._smoothing,f=d==="off";Vt.setPrefixed(s,f?"imageSmoothingEnabled":"imageSmoothingQuality",f?!1:d),s.drawImage(c,-this._size.width/2,-this._size.height/2)}},_canComposite:function(){return!0}}),Re=se.extend({_class:"SymbolItem",_applyMatrix:!1,_canApplyMatrix:!1,_boundsOptions:{stroke:!0},_serializeFields:{symbol:null},initialize:function(a,o){this._initialize(a,o!==t&&k.read(arguments,1))||this.setDefinition(a instanceof Ke?a:new Ke(a))},_equals:function(s){return this._definition===s._definition},copyContent:function(s){this.setDefinition(s._definition)},getDefinition:function(){return this._definition},setDefinition:function(s){this._definition=s,this._changed(9)},getSymbol:"#getDefinition",setSymbol:"#setDefinition",isEmpty:function(){return this._definition._item.isEmpty()},_getBounds:function(s,a){var o=this._definition._item;return o._getCachedBounds(o._matrix.prepended(s),a)},_hitTestSelf:function(s,a,o){var c=a.extend({all:!1}),d=this._definition._item._hitTest(s,c,o);return d&&(d.item=this),d},_draw:function(s,a){this._definition._item.draw(s,a)}}),Ke=n.extend({_class:"SymbolDefinition",initialize:function(a,o){this._id=U.get(),this.project=kt.project,a&&this.setItem(a,o)},_serialize:function(s,a){return a.add(this,function(){return n.serialize([this._class,this._item],s,!1,a)})},_changed:function(s){s&8&&se._clearBoundsCache(this),s&1&&this.project._changed(s)},getItem:function(){return this._item},setItem:function(s,a){s._symbol&&(s=s.clone()),this._item&&(this._item._symbol=null),this._item=s,s.remove(),s.setSelected(!1),a||s.setPosition(new k),s._symbol=this,this._changed(9)},getDefinition:"#getItem",setDefinition:"#setItem",place:function(s){return new Re(this,s)},clone:function(){return new Ke(this._item.clone(!1))},equals:function(s){return s===this||s&&this._item.equals(s._item)||!1}}),Ze=n.extend({_class:"HitResult",initialize:function(a,o,c){this.type=a,this.item=o,c&&this.inject(c)},statics:{getOptions:function(s){var a=s&&n.read(s);return new n({type:null,tolerance:kt.settings.hitTolerance,fill:!a,stroke:!a,segments:!a,handles:!1,ends:!1,position:!1,center:!1,bounds:!1,guides:!1,selected:!1},a)}}}),Te=n.extend({_class:"Segment",beans:!0,_selection:0,initialize:function(a,o,c,d,f,b){var y=arguments.length,L,P,x,E;y>0&&(a==null||typeof a=="object"?y===1&&a&&"point"in a?(L=a.point,P=a.handleIn,x=a.handleOut,E=a.selection):(L=a,P=o,x=c,E=d):(L=[a,o],P=c!==t?[c,d]:null,x=f!==t?[f,b]:null)),new ft(L,this,"_point"),new ft(P,this,"_handleIn"),new ft(x,this,"_handleOut"),E&&this.setSelection(E)},_serialize:function(s,a){var o=this._point,c=this._selection,d=c||this.hasHandles()?[o,this._handleIn,this._handleOut]:o;return c&&d.push(c),n.serialize(d,s,!0,a)},_changed:function(s){var a=this._path;if(a){var o=a._curves,c=this._index,d;o&&((!s||s===this._point||s===this._handleIn)&&(d=c>0?o[c-1]:a._closed?o[o.length-1]:null)&&d._changed(),(!s||s===this._point||s===this._handleOut)&&(d=o[c])&&d._changed()),a._changed(41)}},getPoint:function(){return this._point},setPoint:function(){this._point.set(k.read(arguments))},getHandleIn:function(){return this._handleIn},setHandleIn:function(){this._handleIn.set(k.read(arguments))},getHandleOut:function(){return this._handleOut},setHandleOut:function(){this._handleOut.set(k.read(arguments))},hasHandles:function(){return!this._handleIn.isZero()||!this._handleOut.isZero()},isSmooth:function(){var s=this._handleIn,a=this._handleOut;return!s.isZero()&&!a.isZero()&&s.isCollinear(a)},clearHandles:function(){this._handleIn._set(0,0),this._handleOut._set(0,0)},getSelection:function(){return this._selection},setSelection:function(s){var a=this._selection,o=this._path;this._selection=s=s||0,o&&s!==a&&(o._updateSelection(this,a,s),o._changed(257))},_changeSelection:function(s,a){var o=this._selection;this.setSelection(a?o|s:o&~s)},isSelected:function(){return!!(this._selection&7)},setSelected:function(s){this._changeSelection(7,s)},getIndex:function(){return this._index!==t?this._index:null},getPath:function(){return this._path||null},getCurve:function(){var s=this._path,a=this._index;return s?(a>0&&!s._closed&&a===s._segments.length-1&&a--,s.getCurves()[a]||null):null},getLocation:function(){var s=this.getCurve();return s?new De(s,this===s._segment1?0:1):null},getNext:function(){var s=this._path&&this._path._segments;return s&&(s[this._index+1]||this._path._closed&&s[0])||null},smooth:function(s,a,o){var c=s||{},d=c.type,f=c.factor,b=this.getPrevious(),y=this.getNext(),L=(b||this)._point,P=this._point,x=(y||this)._point,E=L.getDistance(P),I=P.getDistance(x);if(!d||d==="catmull-rom"){var T=f===t?.5:f,M=Math.pow(E,T),V=M*M,z=Math.pow(I,T),N=z*z;if(!a&&b){var F=2*N+3*z*M+V,D=3*z*(z+M);this.setHandleIn(D!==0?new k((N*L._x+F*P._x-V*x._x)/D-P._x,(N*L._y+F*P._y-V*x._y)/D-P._y):new k)}if(!o&&y){var F=2*V+3*M*z+N,D=3*M*(M+z);this.setHandleOut(D!==0?new k((V*x._x+F*P._x-N*L._x)/D-P._x,(V*x._y+F*P._y-N*L._y)/D-P._y):new k)}}else if(d==="geometric"){if(b&&y){var O=L.subtract(x),H=f===t?.4:f,G=H*E/(E+I);a||this.setHandleIn(O.multiply(G)),o||this.setHandleOut(O.multiply(G-H))}}else throw new Error("Smoothing method '"+d+"' not supported.")},getPrevious:function(){var s=this._path&&this._path._segments;return s&&(s[this._index-1]||this._path._closed&&s[s.length-1])||null},isFirst:function(){return!this._index},isLast:function(){var s=this._path;return s&&this._index===s._segments.length-1||!1},reverse:function(){var s=this._handleIn,a=this._handleOut,o=s.clone();s.set(a),a.set(o)},reversed:function(){return new Te(this._point,this._handleOut,this._handleIn)},remove:function(){return this._path?!!this._path.removeSegment(this._index):!1},clone:function(){return new Te(this._point,this._handleIn,this._handleOut)},equals:function(s){return s===this||s&&this._class===s._class&&this._point.equals(s._point)&&this._handleIn.equals(s._handleIn)&&this._handleOut.equals(s._handleOut)||!1},toString:function(){var s=["point: "+this._point];return this._handleIn.isZero()||s.push("handleIn: "+this._handleIn),this._handleOut.isZero()||s.push("handleOut: "+this._handleOut),"{ "+s.join(", ")+" }"},transform:function(s){this._transformCoordinates(s,new Array(6),!0),this._changed()},interpolate:function(s,a,o){var c=1-o,d=o,f=s._point,b=a._point,y=s._handleIn,L=a._handleIn,P=a._handleOut,x=s._handleOut;this._point._set(c*f._x+d*b._x,c*f._y+d*b._y,!0),this._handleIn._set(c*y._x+d*L._x,c*y._y+d*L._y,!0),this._handleOut._set(c*x._x+d*P._x,c*x._y+d*P._y,!0),this._changed()},_transformCoordinates:function(s,a,o){var c=this._point,d=!o||!this._handleIn.isZero()?this._handleIn:null,f=!o||!this._handleOut.isZero()?this._handleOut:null,b=c._x,y=c._y,L=2;return a[0]=b,a[1]=y,d&&(a[L++]=d._x+b,a[L++]=d._y+y),f&&(a[L++]=f._x+b,a[L++]=f._y+y),s&&(s._transformCoordinates(a,a,L/2),b=a[0],y=a[1],o?(c._x=b,c._y=y,L=2,d&&(d._x=a[L++]-b,d._y=a[L++]-y),f&&(f._x=a[L++]-b,f._y=a[L++]-y)):(d||(a[L++]=b,a[L++]=y),f||(a[L++]=b,a[L++]=y))),a}}),ft=k.extend({initialize:function(a,o,c){var d,f,b;if(!a)d=f=0;else if((d=a[0])!==t)f=a[1];else{var y=a;(d=y.x)===t&&(y=k.read(arguments),d=y.x),f=y.y,b=y.selected}this._x=d,this._y=f,this._owner=o,o[c]=this,b&&this.setSelected(!0)},_set:function(s,a){return this._x=s,this._y=a,this._owner._changed(this),this},getX:function(){return this._x},setX:function(s){this._x=s,this._owner._changed(this)},getY:function(){return this._y},setY:function(s){this._y=s,this._owner._changed(this)},isZero:function(){var s=B.isZero;return s(this._x)&&s(this._y)},isSelected:function(){return!!(this._owner._selection&this._getSelection())},setSelected:function(s){this._owner._changeSelection(this._getSelection(),s)},_getSelection:function(){var s=this._owner;return this===s._point?1:this===s._handleIn?2:this===s._handleOut?4:0}}),Ce=n.extend({_class:"Curve",beans:!0,initialize:function(a,o,c,d,f,b,y,L){var P=arguments.length,x,E,I,T,M,V;P===3?(this._path=a,x=o,E=c):P?P===1?"segment1"in a?(x=new Te(a.segment1),E=new Te(a.segment2)):"point1"in a?(I=a.point1,M=a.handle1,V=a.handle2,T=a.point2):Array.isArray(a)&&(I=[a[0],a[1]],T=[a[6],a[7]],M=[a[2]-a[0],a[3]-a[1]],V=[a[4]-a[6],a[5]-a[7]]):P===2?(x=new Te(a),E=new Te(o)):P===4?(I=a,M=o,V=c,T=d):P===8&&(I=[a,o],T=[y,L],M=[c-a,d-o],V=[f-y,b-L]):(x=new Te,E=new Te),this._segment1=x||new Te(I,null,M),this._segment2=E||new Te(T,V,null)},_serialize:function(s,a){return n.serialize(this.hasHandles()?[this.getPoint1(),this.getHandle1(),this.getHandle2(),this.getPoint2()]:[this.getPoint1(),this.getPoint2()],s,!0,a)},_changed:function(){this._length=this._bounds=t},clone:function(){return new Ce(this._segment1,this._segment2)},toString:function(){var s=["point1: "+this._segment1._point];return this._segment1._handleOut.isZero()||s.push("handle1: "+this._segment1._handleOut),this._segment2._handleIn.isZero()||s.push("handle2: "+this._segment2._handleIn),s.push("point2: "+this._segment2._point),"{ "+s.join(", ")+" }"},classify:function(){return Ce.classify(this.getValues())},remove:function(){var s=!1;if(this._path){var a=this._segment2,o=a._handleOut;s=a.remove(),s&&this._segment1._handleOut.set(o)}return s},getPoint1:function(){return this._segment1._point},setPoint1:function(){this._segment1._point.set(k.read(arguments))},getPoint2:function(){return this._segment2._point},setPoint2:function(){this._segment2._point.set(k.read(arguments))},getHandle1:function(){return this._segment1._handleOut},setHandle1:function(){this._segment1._handleOut.set(k.read(arguments))},getHandle2:function(){return this._segment2._handleIn},setHandle2:function(){this._segment2._handleIn.set(k.read(arguments))},getSegment1:function(){return this._segment1},getSegment2:function(){return this._segment2},getPath:function(){return this._path},getIndex:function(){return this._segment1._index},getNext:function(){var s=this._path&&this._path._curves;return s&&(s[this._segment1._index+1]||this._path._closed&&s[0])||null},getPrevious:function(){var s=this._path&&this._path._curves;return s&&(s[this._segment1._index-1]||this._path._closed&&s[s.length-1])||null},isFirst:function(){return!this._segment1._index},isLast:function(){var s=this._path;return s&&this._segment1._index===s._curves.length-1||!1},isSelected:function(){return this.getPoint1().isSelected()&&this.getHandle1().isSelected()&&this.getHandle2().isSelected()&&this.getPoint2().isSelected()},setSelected:function(s){this.getPoint1().setSelected(s),this.getHandle1().setSelected(s),this.getHandle2().setSelected(s),this.getPoint2().setSelected(s)},getValues:function(s){return Ce.getValues(this._segment1,this._segment2,s)},getPoints:function(){for(var s=this.getValues(),a=[],o=0;o<8;o+=2)a.push(new k(s[o],s[o+1]));return a}},{getLength:function(){return this._length==null&&(this._length=Ce.getLength(this.getValues(),0,1)),this._length},getArea:function(){return Ce.getArea(this.getValues())},getLine:function(){return new Oe(this._segment1._point,this._segment2._point)},getPart:function(s,a){return new Ce(Ce.getPart(this.getValues(),s,a))},getPartLength:function(s,a){return Ce.getLength(this.getValues(),s,a)},divideAt:function(s){return this.divideAtTime(s&&s.curve===this?s.time:this.getTimeAt(s))},divideAtTime:function(s,a){var o=1e-8,c=1-o,d=null;if(s>=o&&s<=c){var f=Ce.subdivide(this.getValues(),s),b=f[0],y=f[1],L=a||this.hasHandles(),P=this._segment1,x=this._segment2,E=this._path;L&&(P._handleOut._set(b[2]-b[0],b[3]-b[1]),x._handleIn._set(y[4]-y[6],y[5]-y[7]));var I=b[6],T=b[7],M=new Te(new k(I,T),L&&new k(b[4]-I,b[5]-T),L&&new k(y[2]-I,y[3]-T));E?(E.insert(P._index+1,M),d=this.getNext()):(this._segment2=M,this._changed(),d=new Ce(M,x))}return d},splitAt:function(s){var a=this._path;return a?a.splitAt(s):null},splitAtTime:function(s){return this.splitAt(this.getLocationAtTime(s))},divide:function(s,a){return this.divideAtTime(s===t?.5:a?s:this.getTimeAt(s))},split:function(s,a){return this.splitAtTime(s===t?.5:a?s:this.getTimeAt(s))},reversed:function(){return new Ce(this._segment2.reversed(),this._segment1.reversed())},clearHandles:function(){this._segment1._handleOut._set(0,0),this._segment2._handleIn._set(0,0)},statics:{getValues:function(s,a,o,c){var d=s._point,f=s._handleOut,b=a._handleIn,y=a._point,L=d.x,P=d.y,x=y.x,E=y.y,I=c?[L,P,L,P,x,E,x,E]:[L,P,L+f._x,P+f._y,x+b._x,E+b._y,x,E];return o&&o._transformCoordinates(I,I,4),I},subdivide:function(s,a){var o=s[0],c=s[1],d=s[2],f=s[3],b=s[4],y=s[5],L=s[6],P=s[7];a===t&&(a=.5);var x=1-a,E=x*o+a*d,I=x*c+a*f,T=x*d+a*b,M=x*f+a*y,V=x*b+a*L,z=x*y+a*P,N=x*E+a*T,F=x*I+a*M,D=x*T+a*V,O=x*M+a*z,H=x*N+a*D,G=x*F+a*O;return[[o,c,E,I,N,F,H,G],[H,G,D,O,V,z,L,P]]},getMonoCurves:function(s,a){var o=[],c=a?0:1,d=s[c+0],f=s[c+2],b=s[c+4],y=s[c+6];if(d>=f==f>=b&&f>=b==b>=y||Ce.isStraight(s))o.push(s);else{var L=3*(f-b)-d+y,P=2*(d+b)-4*f,x=f-d,E=1e-8,I=1-E,T=[],M=B.solveQuadratic(L,P,x,T,E,I);if(!M)o.push(s);else{T.sort();var V=T[0],z=Ce.subdivide(s,V);o.push(z[0]),M>1&&(V=(T[1]-V)/(1-V),z=Ce.subdivide(z[1],V),o.push(z[0])),o.push(z[1])}}return o},solveCubic:function(s,a,o,c,d,f){var b=s[a],y=s[a+2],L=s[a+4],P=s[a+6],x=0;if(!(b<o&&P<o&&y<o&&L<o||b>o&&P>o&&y>o&&L>o)){var E=3*(y-b),I=3*(L-y)-E,T=P-b-E-I;x=B.solveCubic(T,I,E,b-o,c,d,f)}return x},getTimeOf:function(s,a){var o=new k(s[0],s[1]),c=new k(s[6],s[7]),d=1e-12,f=1e-7,b=a.isClose(o,d)?0:a.isClose(c,d)?1:null;if(b===null)for(var y=[a.x,a.y],L=[],P=0;P<2;P++)for(var x=Ce.solveCubic(s,P,y[P],L,0,1),E=0;E<x;E++){var I=L[E];if(a.isClose(Ce.getPoint(s,I),f))return I}return a.isClose(o,f)?0:a.isClose(c,f)?1:null},getNearestTime:function(s,a){if(Ce.isStraight(s)){var o=s[0],c=s[1],d=s[6],f=s[7],b=d-o,y=f-c,L=b*b+y*y;if(L===0)return 0;var P=((a.x-o)*b+(a.y-c)*y)/L;return P<1e-12?0:P>.999999999999?1:Ce.getTimeOf(s,new k(o+P*b,c+P*y))}var x=100,E=1/0,I=0;function T(z){if(z>=0&&z<=1){var N=a.getDistance(Ce.getPoint(s,z),!0);if(N<E)return E=N,I=z,!0}}for(var M=0;M<=x;M++)T(M/x);for(var V=1/(x*2);V>1e-8;)!T(I-V)&&!T(I+V)&&(V/=2);return I},getPart:function(s,a,o){var c=a>o;if(c){var d=a;a=o,o=d}return a>0&&(s=Ce.subdivide(s,a)[1]),o<1&&(s=Ce.subdivide(s,(o-a)/(1-a))[0]),c?[s[6],s[7],s[4],s[5],s[2],s[3],s[0],s[1]]:s},isFlatEnough:function(s,a){var o=s[0],c=s[1],d=s[2],f=s[3],b=s[4],y=s[5],L=s[6],P=s[7],x=3*d-2*o-L,E=3*f-2*c-P,I=3*b-2*L-o,T=3*y-2*P-c;return Math.max(x*x,I*I)+Math.max(E*E,T*T)<=16*a*a},getArea:function(s){var a=s[0],o=s[1],c=s[2],d=s[3],f=s[4],b=s[5],y=s[6],L=s[7];return 3*((L-o)*(c+f)-(y-a)*(d+b)+d*(a-f)-c*(o-b)+L*(f+a/3)-y*(b+o/3))/20},getBounds:function(s){for(var a=s.slice(0,2),o=a.slice(),c=[0,0],d=0;d<2;d++)Ce._addBounds(s[d],s[d+2],s[d+4],s[d+6],d,0,a,o,c);return new Z(a[0],a[1],o[0]-a[0],o[1]-a[1])},_addBounds:function(s,a,o,c,d,f,b,y,L){function P(H,G){var K=H-G,j=H+G;K<b[d]&&(b[d]=K),j>y[d]&&(y[d]=j)}f/=2;var x=b[d]+f,E=y[d]-f;if(s<x||a<x||o<x||c<x||s>E||a>E||o>E||c>E)if(a<s!=a<c&&o<s!=o<c)P(s,0),P(c,0);else{var I=3*(a-o)-s+c,T=2*(s+o)-4*a,M=a-s,V=B.solveQuadratic(I,T,M,L),z=1e-8,N=1-z;P(c,0);for(var F=0;F<V;F++){var D=L[F],O=1-D;z<=D&&D<=N&&P(O*O*O*s+3*O*O*D*a+3*O*D*D*o+D*D*D*c,f)}}}}},n.each(["getBounds","getStrokeBounds","getHandleBounds"],function(s){this[s]=function(){this._bounds||(this._bounds={});var a=this._bounds[s];return a||(a=this._bounds[s]=Ae[s]([this._segment1,this._segment2],!1,this._path)),a.clone()}},{}),n.each({isStraight:function(s,a,o,c){if(a.isZero()&&o.isZero())return!0;var d=c.subtract(s);if(d.isZero())return!1;if(d.isCollinear(a)&&d.isCollinear(o)){var f=new Oe(s,c),b=1e-7;if(f.getDistance(s.add(a))<b&&f.getDistance(c.add(o))<b){var y=d.dot(d),L=d.dot(a)/y,P=d.dot(o)/y;return L>=0&&L<=1&&P<=0&&P>=-1}}return!1},isLinear:function(s,a,o,c){var d=c.subtract(s).divide(3);return a.equals(d)&&o.negate().equals(d)}},function(s,a){this[a]=function(o){var c=this._segment1,d=this._segment2;return s(c._point,c._handleOut,d._handleIn,d._point,o)},this.statics[a]=function(o,c){var d=o[0],f=o[1],b=o[6],y=o[7];return s(new k(d,f),new k(o[2]-d,o[3]-f),new k(o[4]-b,o[5]-y),new k(b,y),c)}},{statics:{},hasHandles:function(){return!this._segment1._handleOut.isZero()||!this._segment2._handleIn.isZero()},hasLength:function(s){return(!this.getPoint1().equals(this.getPoint2())||this.hasHandles())&&this.getLength()>(s||0)},isCollinear:function(s){return s&&this.isStraight()&&s.isStraight()&&this.getLine().isCollinear(s.getLine())},isHorizontal:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).y)<1e-8},isVertical:function(){return this.isStraight()&&Math.abs(this.getTangentAtTime(.5).x)<1e-8}}),{beans:!1,getLocationAt:function(s,a){return this.getLocationAtTime(a?s:this.getTimeAt(s))},getLocationAtTime:function(s){return s!=null&&s>=0&&s<=1?new De(this,s):null},getTimeAt:function(s,a){return Ce.getTimeAt(this.getValues(),s,a)},getParameterAt:"#getTimeAt",getTimesWithTangent:function(){var s=k.read(arguments);return s.isZero()?[]:Ce.getTimesWithTangent(this.getValues(),s)},getOffsetAtTime:function(s){return this.getPartLength(0,s)},getLocationOf:function(){return this.getLocationAtTime(this.getTimeOf(k.read(arguments)))},getOffsetOf:function(){var s=this.getLocationOf.apply(this,arguments);return s?s.getOffset():null},getTimeOf:function(){return Ce.getTimeOf(this.getValues(),k.read(arguments))},getParameterOf:"#getTimeOf",getNearestLocation:function(){var s=k.read(arguments),a=this.getValues(),o=Ce.getNearestTime(a,s),c=Ce.getPoint(a,o);return new De(this,o,c,null,s.getDistance(c))},getNearestPoint:function(){var s=this.getNearestLocation.apply(this,arguments);return s&&s.getPoint()}},new function(){var s=["getPoint","getTangent","getNormal","getWeightedTangent","getWeightedNormal","getCurvature"];return n.each(s,function(a){this[a+"At"]=function(o,c){var d=this.getValues();return Ce[a](d,c?o:Ce.getTimeAt(d,o))},this[a+"AtTime"]=function(o){return Ce[a](this.getValues(),o)}},{statics:{_evaluateMethods:s}})},new function(){function s(c){var d=c[0],f=c[1],b=c[2],y=c[3],L=c[4],P=c[5],x=c[6],E=c[7],I=9*(b-L)+3*(x-d),T=6*(d+L)-12*b,M=3*(b-d),V=9*(y-P)+3*(E-f),z=6*(f+P)-12*y,N=3*(y-f);return function(F){var D=(I*F+T)*F+M,O=(V*F+z)*F+N;return Math.sqrt(D*D+O*O)}}function a(c,d){return Math.max(2,Math.min(16,Math.ceil(Math.abs(d-c)*32)))}function o(c,d,f,b){if(d==null||d<0||d>1)return null;var y=c[0],L=c[1],P=c[2],x=c[3],E=c[4],I=c[5],T=c[6],M=c[7],V=B.isZero;V(P-y)&&V(x-L)&&(P=y,x=L),V(E-T)&&V(I-M)&&(E=T,I=M);var z=3*(P-y),N=3*(E-P)-z,F=T-y-z-N,D=3*(x-L),O=3*(I-x)-D,H=M-L-D-O,G,K;if(f===0)G=d===0?y:d===1?T:((F*d+N)*d+z)*d+y,K=d===0?L:d===1?M:((H*d+O)*d+D)*d+L;else{var j=1e-8,J=1-j;if(d<j?(G=z,K=D):d>J?(G=3*(T-E),K=3*(M-I)):(G=(3*F*d+2*N)*d+z,K=(3*H*d+2*O)*d+D),b){G===0&&K===0&&(d<j||d>J)&&(G=E-P,K=I-x);var ee=Math.sqrt(G*G+K*K);ee&&(G/=ee,K/=ee)}if(f===3){var E=6*F*d+2*N,I=6*H*d+2*O,re=Math.pow(G*G+K*K,3/2);G=re!==0?(G*I-K*E)/re:0,K=0}}return f===2?new k(K,-G):new k(G,K)}return{statics:{classify:function(c){var d=c[0],f=c[1],b=c[2],y=c[3],L=c[4],P=c[5],x=c[6],E=c[7],I=d*(E-P)+f*(L-x)+x*P-E*L,T=b*(f-E)+y*(x-d)+d*E-f*x,M=L*(y-f)+P*(d-b)+b*f-y*d,V=3*M,z=V-T,N=z-T+I,F=Math.sqrt(N*N+z*z+V*V),D=F!==0?1/F:0,O=B.isZero,H="serpentine";N*=D,z*=D,V*=D;function G(ee,re,ie){var oe=re!==t,le=oe&&re>0&&re<1,pe=oe&&ie>0&&ie<1;return oe&&(!(le||pe)||ee==="loop"&&!(le&&pe))&&(ee="arch",le=pe=!1),{type:ee,roots:le||pe?le&&pe?re<ie?[re,ie]:[ie,re]:[le?re:ie]:null}}if(O(N))return O(z)?G(O(V)?"line":"quadratic"):G(H,V/(3*z));var K=3*z*z-4*N*V;if(O(K))return G("cusp",z/(2*N));var j=K>0?Math.sqrt(K/3):Math.sqrt(-K),J=2*N;return G(K>0?H:"loop",(z+j)/J,(z-j)/J)},getLength:function(c,d,f,b){if(d===t&&(d=0),f===t&&(f=1),Ce.isStraight(c)){var y=c;f<1&&(y=Ce.subdivide(y,f)[0],d/=f),d>0&&(y=Ce.subdivide(y,d)[1]);var L=y[6]-y[0],P=y[7]-y[1];return Math.sqrt(L*L+P*P)}return B.integrate(b||s(c),d,f,a(d,f))},getTimeAt:function(c,d,f){if(f===t&&(f=d<0?1:0),d===0)return f;var b=Math.abs,y=1e-12,L=d>0,P=L?f:0,x=L?1:f,E=s(c),I=Ce.getLength(c,P,x,E),T=b(d)-I;if(b(T)<y)return L?x:P;if(T>y)return null;var M=d/I,V=0;function z(N){return V+=B.integrate(E,f,N,a(f,N)),f=N,V-d}return B.findRoot(z,E,f+M,P,x,32,1e-12)},getPoint:function(c,d){return o(c,d,0,!1)},getTangent:function(c,d){return o(c,d,1,!0)},getWeightedTangent:function(c,d){return o(c,d,1,!1)},getNormal:function(c,d){return o(c,d,2,!0)},getWeightedNormal:function(c,d){return o(c,d,2,!1)},getCurvature:function(c,d){return o(c,d,3,!1).x},getPeaks:function(c){var d=c[0],f=c[1],b=c[2],y=c[3],L=c[4],P=c[5],x=c[6],E=c[7],I=-d+3*b-3*L+x,T=3*d-6*b+3*L,M=-3*d+3*b,V=-f+3*y-3*P+E,z=3*f-6*y+3*P,N=-3*f+3*y,F=1e-8,D=1-F,O=[];return B.solveCubic(9*(I*I+V*V),9*(I*T+z*V),2*(T*T+z*z)+3*(M*I+N*V),M*T+z*N,O,F,D),O.sort()}}}},new function(){function s(T,M,V,z,N,F,D){var O=!D&&V.getPrevious()===N,H=!D&&V!==N&&V.getNext()===N,G=1e-8,K=1-G;if(z!==null&&z>=(O?G:0)&&z<=(H?K:1)&&F!==null&&F>=(H?G:0)&&F<=(O?K:1)){var j=new De(V,z,null,D),J=new De(N,F,null,D);j._intersection=J,J._intersection=j,(!M||M(j))&&De.insert(T,j,!0)}}function a(T,M,V,z,N,F,D,O,H,G,K,j,J){if(++H>=4096||++O>=40)return H;var ee=1e-9,re=M[0],ie=M[1],oe=M[6],le=M[7],pe=Oe.getSignedDistance,be=pe(re,ie,oe,le,M[2],M[3]),Le=pe(re,ie,oe,le,M[4],M[5]),Ne=be*Le>0?3/4:4/9,He=Ne*Math.min(0,be,Le),Ue=Ne*Math.max(0,be,Le),nt=pe(re,ie,oe,le,T[0],T[1]),et=pe(re,ie,oe,le,T[2],T[3]),tt=pe(re,ie,oe,le,T[4],T[5]),Je=pe(re,ie,oe,le,T[6],T[7]),ct=o(nt,et,tt,Je),at=ct[0],Ut=ct[1],Pt,At;if(be===0&&Le===0&&nt===0&&et===0&&tt===0&&Je===0||(Pt=c(at,Ut,He,Ue))==null||(At=c(at.reverse(),Ut.reverse(),He,Ue))==null)return H;var Ot=G+(K-G)*Pt,_t=G+(K-G)*At;if(Math.max(J-j,_t-Ot)<ee){var Wi=(Ot+_t)/2,Oi=(j+J)/2;s(N,F,D?z:V,D?Oi:Wi,D?V:z,D?Wi:Oi)}else{T=Ce.getPart(T,Pt,At);var Xi=J-j;if(At-Pt>.8)if(_t-Ot>Xi){var Ti=Ce.subdivide(T,.5),Wi=(Ot+_t)/2;H=a(M,Ti[0],z,V,N,F,!D,O,H,j,J,Ot,Wi),H=a(M,Ti[1],z,V,N,F,!D,O,H,j,J,Wi,_t)}else{var Ti=Ce.subdivide(M,.5),Oi=(j+J)/2;H=a(Ti[0],T,z,V,N,F,!D,O,H,j,Oi,Ot,_t),H=a(Ti[1],T,z,V,N,F,!D,O,H,Oi,J,Ot,_t)}else Xi===0||Xi>=ee?H=a(M,T,z,V,N,F,!D,O,H,j,J,Ot,_t):H=a(T,M,V,z,N,F,D,O,H,Ot,_t,j,J)}return H}function o(T,M,V,z){var N=[0,T],F=[1/3,M],D=[2/3,V],O=[1,z],H=M-(2*T+z)/3,G=V-(T+2*z)/3,K;if(H*G<0)K=[[N,F,O],[N,D,O]];else{var j=H/G;K=[j>=2?[N,F,O]:j<=.5?[N,D,O]:[N,F,D,O],[N,O]]}return(H||G)<0?K.reverse():K}function c(T,M,V,z){return T[0][1]<V?d(T,!0,V):M[0][1]>z?d(M,!1,z):T[0][0]}function d(T,M,V){for(var z=T[0][0],N=T[0][1],F=1,D=T.length;F<D;F++){var O=T[F][0],H=T[F][1];if(M?H>=V:H<=V)return H===V?O:z+(V-N)*(O-z)/(H-N);z=O,N=H}return null}function f(T,M,V,z,N){var F=B.isZero;if(F(z)&&F(N)){var D=Ce.getTimeOf(T,new k(M,V));return D===null?[]:[D]}for(var O=Math.atan2(-N,z),H=Math.sin(O),G=Math.cos(O),K=[],j=[],J=0;J<8;J+=2){var ee=T[J]-M,re=T[J+1]-V;K.push(ee*G-re*H,ee*H+re*G)}return Ce.solveCubic(K,1,0,j,0,1),j}function b(T,M,V,z,N,F,D){for(var O=M[0],H=M[1],G=M[6],K=M[7],j=f(T,O,H,G-O,K-H),J=0,ee=j.length;J<ee;J++){var re=j[J],ie=Ce.getPoint(T,re),oe=Ce.getTimeOf(M,ie);oe!==null&&s(N,F,D?z:V,D?oe:re,D?V:z,D?re:oe)}}function y(T,M,V,z,N,F){var D=Oe.intersect(T[0],T[1],T[6],T[7],M[0],M[1],M[6],M[7]);D&&s(N,F,V,Ce.getTimeOf(T,D),z,Ce.getTimeOf(M,D))}function L(T,M,V,z,N,F){var D=1e-12,O=Math.min,H=Math.max;if(H(T[0],T[2],T[4],T[6])+D>O(M[0],M[2],M[4],M[6])&&O(T[0],T[2],T[4],T[6])-D<H(M[0],M[2],M[4],M[6])&&H(T[1],T[3],T[5],T[7])+D>O(M[1],M[3],M[5],M[7])&&O(T[1],T[3],T[5],T[7])-D<H(M[1],M[3],M[5],M[7])){var G=E(T,M);if(G)for(var K=0;K<2;K++){var j=G[K];s(N,F,V,j[0],z,j[1],!0)}else{var J=Ce.isStraight(T),ee=Ce.isStraight(M),re=J&&ee,ie=J&&!ee,oe=N.length;if((re?y:J||ee?b:a)(ie?M:T,ie?T:M,ie?z:V,ie?V:z,N,F,ie,0,0,0,1,0,1),!re||N.length===oe)for(var K=0;K<4;K++){var le=K>>1,pe=K&1,be=le*6,Le=pe*6,Ne=new k(T[be],T[be+1]),He=new k(M[Le],M[Le+1]);Ne.isClose(He,D)&&s(N,F,V,le,z,pe)}}}return N}function P(T,M,V,z){var N=Ce.classify(T);if(N.type==="loop"){var F=N.roots;s(V,z,M,F[0],M,F[1])}return V}function x(T,M,V,z,N,F){var D=1e-7,O=!M;O&&(M=T);for(var H=T.length,G=M.length,K=new Array(H),j=O?K:new Array(G),J=[],ee=0;ee<H;ee++)K[ee]=T[ee].getValues(z);if(!O)for(var ee=0;ee<G;ee++)j[ee]=M[ee].getValues(N);for(var re=S.findCurveBoundsCollisions(K,j,D),ie=0;ie<H;ie++){var oe=T[ie],le=K[ie];O&&P(le,oe,J,V);var pe=re[ie];if(pe)for(var be=0;be<pe.length;be++){if(F&&J.length)return J;var Le=pe[be];if(!O||Le>ie){var Ne=M[Le],He=j[Le];L(le,He,oe,Ne,J,V)}}}return J}function E(T,M){function V(Je){var ct=Je[6]-Je[0],at=Je[7]-Je[1];return ct*ct+at*at}var z=Math.abs,N=Oe.getDistance,F=1e-8,D=1e-7,O=Ce.isStraight(T),H=Ce.isStraight(M),G=O&&H,K=V(T)<V(M),j=K?M:T,J=K?T:M,ee=j[0],re=j[1],ie=j[6]-ee,oe=j[7]-re;if(N(ee,re,ie,oe,J[0],J[1],!0)<D&&N(ee,re,ie,oe,J[6],J[7],!0)<D)!G&&N(ee,re,ie,oe,j[2],j[3],!0)<D&&N(ee,re,ie,oe,j[4],j[5],!0)<D&&N(ee,re,ie,oe,J[2],J[3],!0)<D&&N(ee,re,ie,oe,J[4],J[5],!0)<D&&(O=H=G=!0);else if(G)return null;if(O^H)return null;for(var le=[T,M],pe=[],be=0;be<4&&pe.length<2;be++){var Le=be&1,Ne=Le^1,He=be>>1,Ue=Ce.getTimeOf(le[Le],new k(le[Ne][He?6:0],le[Ne][He?7:1]));if(Ue!=null){var nt=Le?[He,Ue]:[Ue,He];(!pe.length||z(nt[0]-pe[0][0])>F&&z(nt[1]-pe[0][1])>F)&&pe.push(nt)}if(be>2&&!pe.length)break}if(pe.length!==2)pe=null;else if(!G){var et=Ce.getPart(T,pe[0][0],pe[1][0]),tt=Ce.getPart(M,pe[0][1],pe[1][1]);(z(tt[2]-et[2])>D||z(tt[3]-et[3])>D||z(tt[4]-et[4])>D||z(tt[5]-et[5])>D)&&(pe=null)}return pe}function I(T,M){var V=T[0],z=T[1],N=T[2],F=T[3],D=T[4],O=T[5],H=T[6],G=T[7],K=M.normalize(),j=K.x,J=K.y,ee=3*H-9*D+9*N-3*V,re=3*G-9*O+9*F-3*z,ie=6*D-12*N+6*V,oe=6*O-12*F+6*z,le=3*N-3*V,pe=3*F-3*z,be=2*ee*J-2*re*j,Le=[];if(Math.abs(be)<B.CURVETIME_EPSILON){var Ne=ee*pe-re*le,be=ee*oe-re*ie;if(be!=0){var He=-Ne/be;He>=0&&He<=1&&Le.push(He)}}else{var Ue=(ie*ie-4*ee*le)*J*J+(-2*ie*oe+4*re*le+4*ee*pe)*j*J+(oe*oe-4*re*pe)*j*j,nt=ie*J-oe*j;if(Ue>=0&&be!=0){var et=Math.sqrt(Ue),tt=-(nt+et)/be,Je=(-nt+et)/be;tt>=0&&tt<=1&&Le.push(tt),Je>=0&&Je<=1&&Le.push(Je)}}return Le}return{getIntersections:function(T){var M=this.getValues(),V=T&&T!==this&&T.getValues();return V?L(M,V,this,T,[]):P(M,this,[])},statics:{getOverlaps:E,getIntersections:x,getCurveLineIntersections:f,getTimesWithTangent:I}}}),De=n.extend({_class:"CurveLocation",initialize:function(a,o,c,d,f){if(o>=.99999999){var b=a.getNext();b&&(o=0,a=b)}this._setCurve(a),this._time=o,this._point=c||a.getPointAtTime(o),this._overlap=d,this._distance=f,this._intersection=this._next=this._previous=null},_setPath:function(s){this._path=s,this._version=s?s._version:0},_setCurve:function(s){this._setPath(s._path),this._curve=s,this._segment=null,this._segment1=s._segment1,this._segment2=s._segment2},_setSegment:function(s){var a=s.getCurve();a?this._setCurve(a):(this._setPath(s._path),this._segment1=s,this._segment2=null),this._segment=s,this._time=s===this._segment1?0:1,this._point=s._point.clone()},getSegment:function(){var s=this._segment;if(!s){var a=this.getCurve(),o=this.getTime();o===0?s=a._segment1:o===1?s=a._segment2:o!=null&&(s=a.getPartLength(0,o)<a.getPartLength(o,1)?a._segment1:a._segment2),this._segment=s}return s},getCurve:function(){var s=this._path,a=this;s&&s._version!==this._version&&(this._time=this._offset=this._curveOffset=this._curve=null);function o(c){var d=c&&c.getCurve();if(d&&(a._time=d.getTimeOf(a._point))!=null)return a._setCurve(d),d}return this._curve||o(this._segment)||o(this._segment1)||o(this._segment2.getPrevious())},getPath:function(){var s=this.getCurve();return s&&s._path},getIndex:function(){var s=this.getCurve();return s&&s.getIndex()},getTime:function(){var s=this.getCurve(),a=this._time;return s&&a==null?this._time=s.getTimeOf(this._point):a},getParameter:"#getTime",getPoint:function(){return this._point},getOffset:function(){var s=this._offset;if(s==null){s=0;var a=this.getPath(),o=this.getIndex();if(a&&o!=null)for(var c=a.getCurves(),d=0;d<o;d++)s+=c[d].getLength();this._offset=s+=this.getCurveOffset()}return s},getCurveOffset:function(){var s=this._curveOffset;if(s==null){var a=this.getCurve(),o=this.getTime();this._curveOffset=s=o!=null&&a&&a.getPartLength(0,o)}return s},getIntersection:function(){return this._intersection},getDistance:function(){return this._distance},divide:function(){var s=this.getCurve(),a=s&&s.divideAtTime(this.getTime());return a&&this._setSegment(a._segment1),a},split:function(){var s=this.getCurve(),a=s._path,o=s&&s.splitAtTime(this.getTime());return o&&this._setSegment(a.getLastSegment()),o},equals:function(s,a){var o=this===s;if(!o&&s instanceof De){var c=this.getCurve(),d=s.getCurve(),f=c._path,b=d._path;if(f===b){var y=Math.abs,L=1e-7,P=y(this.getOffset()-s.getOffset()),x=!a&&this._intersection,E=!a&&s._intersection;o=(P<L||f&&y(f.getLength()-P)<L)&&(!x&&!E||x&&E&&x.equals(E,!0))}}return o},toString:function(){var s=[],a=this.getPoint(),o=C.instance;a&&s.push("point: "+a);var c=this.getIndex();c!=null&&s.push("index: "+c);var d=this.getTime();return d!=null&&s.push("time: "+o.number(d)),this._distance!=null&&s.push("distance: "+o.number(this._distance)),"{ "+s.join(", ")+" }"},isTouching:function(){var s=this._intersection;if(s&&this.getTangent().isCollinear(s.getTangent())){var a=this.getCurve(),o=s.getCurve();return!(a.isStraight()&&o.isStraight()&&a.getLine().intersect(o.getLine()))}return!1},isCrossing:function(){var s=this._intersection;if(!s)return!1;var a=this.getTime(),o=s.getTime(),c=1e-8,d=1-c,f=a>=c&&a<=d,b=o>=c&&o<=d;if(f&&b)return!this.isTouching();var y=this.getCurve(),L=y&&a<c?y.getPrevious():y,P=s.getCurve(),x=P&&o<c?P.getPrevious():P;if(a>d&&(y=y.getNext()),o>d&&(P=P.getNext()),!L||!y||!x||!P)return!1;var E=[];function I(j,J){var ee=j.getValues(),re=Ce.classify(ee).roots||Ce.getPeaks(ee),ie=re.length,oe=Ce.getLength(ee,J&&ie?re[ie-1]:0,!J&&ie?re[0]:1);E.push(ie?oe:oe/32)}function T(j,J,ee){return J<ee?j>J&&j<ee:j>J||j<ee}f||(I(L,!0),I(y,!1)),b||(I(x,!0),I(P,!1));var M=this.getPoint(),V=Math.min.apply(Math,E),z=f?y.getTangentAtTime(a):y.getPointAt(V).subtract(M),N=f?z.negate():L.getPointAt(-V).subtract(M),F=b?P.getTangentAtTime(o):P.getPointAt(V).subtract(M),D=b?F.negate():x.getPointAt(-V).subtract(M),O=N.getAngle(),H=z.getAngle(),G=D.getAngle(),K=F.getAngle();return!!(f?T(O,G,K)^T(H,G,K)&&T(O,K,G)^T(H,K,G):T(G,O,H)^T(K,O,H)&&T(G,H,O)^T(K,H,O))},hasOverlap:function(){return!!this._overlap}},n.each(Ce._evaluateMethods,function(s){var a=s+"At";this[s]=function(){var o=this.getCurve(),c=this.getTime();return c!=null&&o&&o[a](c,!0)}},{preserve:!0}),new function(){function s(a,o,c){var d=a.length,f=0,b=d-1;function y(M,V){for(var z=M+V;z>=-1&&z<=d;z+=V){var N=a[(z%d+d)%d];if(!o.getPoint().isClose(N.getPoint(),1e-7))break;if(o.equals(N))return N}return null}for(;f<=b;){var L=f+b>>>1,P=a[L],x;if(c&&(x=o.equals(P)?P:y(L,-1)||y(L,1)))return o._overlap&&(x._overlap=x._intersection._overlap=!0),x;var E=o.getPath(),I=P.getPath(),T=E!==I?E._id-I._id:o.getIndex()+o.getTime()-(P.getIndex()+P.getTime());T<0?b=L-1:f=L+1}return a.splice(f,0,o),o}return{statics:{insert:s,expand:function(a){for(var o=a.slice(),c=a.length-1;c>=0;c--)s(o,a[c]._intersection,!1);return o}}}}),Ve=se.extend({_class:"PathItem",_selectBounds:!1,_canScaleStroke:!0,beans:!0,initialize:function(){},statics:{create:function(s){var a,o,c;if(n.isPlainObject(s)?(o=s.segments,a=s.pathData):Array.isArray(s)?o=s:typeof s=="string"&&(a=s),o){var d=o[0];c=d&&Array.isArray(d[0])}else a&&(c=(a.match(/m/gi)||[]).length>1||/z\s*\S+/i.test(a));var f=c?Xe:Ae;return new f(s)}},_asPathItem:function(){return this},isClockwise:function(){return this.getArea()>=0},setClockwise:function(s){this.isClockwise()!=(s=!!s)&&this.reverse()},setPathData:function(s){var a=s&&s.match(/[mlhvcsqtaz][^mlhvcsqtaz]*/ig),o,c=!1,d,f,b=new k,y=new k;function L(D,O){var H=+o[D];return c&&(H+=b[O]),H}function P(D){return new k(L(D,"x"),L(D+1,"y"))}this.clear();for(var x=0,E=a&&a.length;x<E;x++){var I=a[x],T=I[0],M=T.toLowerCase();o=I.match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g);var V=o&&o.length;switch(c=T===M,d==="z"&&!/[mz]/.test(M)&&this.moveTo(b),M){case"m":case"l":for(var z=M==="m",N=0;N<V;N+=2)this[z?"moveTo":"lineTo"](b=P(N)),z&&(y=b,z=!1);f=b;break;case"h":case"v":var F=M==="h"?"x":"y";b=b.clone();for(var N=0;N<V;N++)b[F]=L(N,F),this.lineTo(b);f=b;break;case"c":for(var N=0;N<V;N+=6)this.cubicCurveTo(P(N),f=P(N+2),b=P(N+4));break;case"s":for(var N=0;N<V;N+=4)this.cubicCurveTo(/[cs]/.test(d)?b.multiply(2).subtract(f):b,f=P(N),b=P(N+2)),d=M;break;case"q":for(var N=0;N<V;N+=4)this.quadraticCurveTo(f=P(N),b=P(N+2));break;case"t":for(var N=0;N<V;N+=2)this.quadraticCurveTo(f=/[qt]/.test(d)?b.multiply(2).subtract(f):b,b=P(N)),d=M;break;case"a":for(var N=0;N<V;N+=7)this.arcTo(b=P(N+5),new X(+o[N],+o[N+1]),+o[N+2],+o[N+4],+o[N+3]);break;case"z":this.closePath(1e-12),b=y;break}d=M}},_canComposite:function(){return!(this.hasFill()&&this.hasStroke())},_contains:function(s){var a=s.isInside(this.getBounds({internal:!0,handle:!0}))?this._getWinding(s):{};return a.onPath||!!(this.getFillRule()==="evenodd"?a.windingL&1||a.windingR&1:a.winding)},getIntersections:function(s,a,o,c){var d=this===s||!s,f=this._matrix._orNullIfIdentity(),b=d?f:(o||s._matrix)._orNullIfIdentity();return d||this.getBounds(f).intersects(s.getBounds(b),1e-12)?Ce.getIntersections(this.getCurves(),!d&&s.getCurves(),a,f,b,c):[]},getCrossings:function(s){return this.getIntersections(s,function(a){return a.isCrossing()})},getNearestLocation:function(){for(var s=k.read(arguments),a=this.getCurves(),o=1/0,c=null,d=0,f=a.length;d<f;d++){var b=a[d].getNearestLocation(s);b._distance<o&&(o=b._distance,c=b)}return c},getNearestPoint:function(){var s=this.getNearestLocation.apply(this,arguments);return s&&s.getPoint()},interpolate:function(s,a,o){var c=!this._children,d=c?"_segments":"_children",f=s[d],b=a[d],y=this[d];if(!f||!b||f.length!==b.length)throw new Error("Invalid operands in interpolate() call: "+s+", "+a);var L=y.length,P=b.length;if(L<P)for(var x=c?Te:Ae,E=L;E<P;E++)this.add(new x);else L>P&&this[c?"removeSegments":"removeChildren"](P,L);for(var E=0;E<P;E++)y[E].interpolate(f[E],b[E],o);c&&(this.setClosed(s._closed),this._changed(9))},compare:function(s){var a=!1;if(s){var o=this._children||[this],c=s._children?s._children.slice():[s],d=o.length,f=c.length,b=[],y=0;a=!0;for(var L=S.findItemBoundsCollisions(o,c,B.GEOMETRIC_EPSILON),P=d-1;P>=0&&a;P--){var x=o[P];a=!1;var E=L[P];if(E)for(var I=E.length-1;I>=0&&!a;I--)x.compare(c[E[I]])&&(b[E[I]]||(b[E[I]]=!0,y++),a=!0)}a=a&&y===f}return a}}),Ae=Ve.extend({_class:"Path",_serializeFields:{segments:[],closed:!1},initialize:function(a){this._closed=!1,this._segments=[],this._version=0;var o=arguments,c=Array.isArray(a)?typeof a[0]=="object"?a:o:a&&a.size===t&&(a.x!==t||a.point!==t)?o:null;c&&c.length>0?this.setSegments(c):(this._curves=t,this._segmentSelection=0,!c&&typeof a=="string"&&(this.setPathData(a),a=null)),this._initialize(!c&&a)},_equals:function(s){return this._closed===s._closed&&n.equals(this._segments,s._segments)},copyContent:function(s){this.setSegments(s._segments),this._closed=s._closed},_changed:function s(a){if(s.base.call(this,a),a&8){if(this._length=this._area=t,a&32)this._version++;else if(this._curves)for(var o=0,c=this._curves.length;o<c;o++)this._curves[o]._changed()}else a&64&&(this._bounds=t)},getStyle:function(){var s=this._parent;return(s instanceof Xe?s:this)._style},getSegments:function(){return this._segments},setSegments:function(s){var a=this.isFullySelected(),o=s&&s.length;if(this._segments.length=0,this._segmentSelection=0,this._curves=t,o){var c=s[o-1];typeof c=="boolean"&&(this.setClosed(c),o--),this._add(Te.readList(s,0,{},o))}a&&this.setFullySelected(!0)},getFirstSegment:function(){return this._segments[0]},getLastSegment:function(){return this._segments[this._segments.length-1]},getCurves:function(){var s=this._curves,a=this._segments;if(!s){var o=this._countCurves();s=this._curves=new Array(o);for(var c=0;c<o;c++)s[c]=new Ce(this,a[c],a[c+1]||a[0])}return s},getFirstCurve:function(){return this.getCurves()[0]},getLastCurve:function(){var s=this.getCurves();return s[s.length-1]},isClosed:function(){return this._closed},setClosed:function(s){if(this._closed!=(s=!!s)){if(this._closed=s,this._curves){var a=this._curves.length=this._countCurves();s&&(this._curves[a-1]=new Ce(this,this._segments[a-1],this._segments[0]))}this._changed(41)}}},{beans:!0,getPathData:function(s,a){var o=this._segments,c=o.length,d=new C(a),f=new Array(6),b=!0,y,L,P,x,E,I,T,M,V=[];function z(F,D){if(F._transformCoordinates(s,f),y=f[0],L=f[1],b)V.push("M"+d.pair(y,L)),b=!1;else if(E=f[2],I=f[3],E===y&&I===L&&T===P&&M===x){if(!D){var O=y-P,H=L-x;V.push(O===0?"v"+d.number(H):H===0?"h"+d.number(O):"l"+d.pair(O,H))}}else V.push("c"+d.pair(T-P,M-x)+" "+d.pair(E-P,I-x)+" "+d.pair(y-P,L-x));P=y,x=L,T=f[4],M=f[5]}if(!c)return"";for(var N=0;N<c;N++)z(o[N]);return this._closed&&c>0&&(z(o[0],!0),V.push("z")),V.join("")},isEmpty:function(){return!this._segments.length},_transformContent:function(s){for(var a=this._segments,o=new Array(6),c=0,d=a.length;c<d;c++)a[c]._transformCoordinates(s,o,!0);return!0},_add:function(s,b){for(var o=this._segments,c=this._curves,d=s.length,f=b==null,b=f?o.length:b,y=0;y<d;y++){var L=s[y];L._path&&(L=s[y]=L.clone()),L._path=this,L._index=b+y,L._selection&&this._updateSelection(L,0,L._selection)}if(f)n.push(o,s);else{o.splice.apply(o,[b,0].concat(s));for(var y=b+d,P=o.length;y<P;y++)o[y]._index=y}if(c){var x=this._countCurves(),E=b>0&&b+d-1===x?b-1:b,I=E,T=Math.min(E+d,x);s._curves&&(c.splice.apply(c,[E,0].concat(s._curves)),I+=s._curves.length);for(var y=I;y<T;y++)c.splice(y,0,new Ce(this,null,null));this._adjustCurves(E,T)}return this._changed(41),s},_adjustCurves:function(s,a){for(var o=this._segments,c=this._curves,d,f=s;f<a;f++)d=c[f],d._path=this,d._segment1=o[f],d._segment2=o[f+1]||o[0],d._changed();(d=c[this._closed&&!s?o.length-1:s-1])&&(d._segment2=o[s]||o[0],d._changed()),(d=c[a])&&(d._segment1=o[a],d._changed())},_countCurves:function(){var s=this._segments.length;return!this._closed&&s>0?s-1:s},add:function(s){var a=arguments;return a.length>1&&typeof s!="number"?this._add(Te.readList(a)):this._add([Te.read(a)])[0]},insert:function(s,a){var o=arguments;return o.length>2&&typeof a!="number"?this._add(Te.readList(o,1),s):this._add([Te.read(o,1)],s)[0]},addSegment:function(){return this._add([Te.read(arguments)])[0]},insertSegment:function(s){return this._add([Te.read(arguments,1)],s)[0]},addSegments:function(s){return this._add(Te.readList(s))},insertSegments:function(s,a){return this._add(Te.readList(a),s)},removeSegment:function(s){return this.removeSegments(s,s+1)[0]||null},removeSegments:function(s,a,o){s=s||0,a=n.pick(a,this._segments.length);var c=this._segments,d=this._curves,f=c.length,b=c.splice(s,a-s),y=b.length;if(!y)return b;for(var L=0;L<y;L++){var P=b[L];P._selection&&this._updateSelection(P,P._selection,0),P._index=P._path=null}for(var L=s,x=c.length;L<x;L++)c[L]._index=L;if(d){for(var E=s>0&&a===f+(this._closed?1:0)?s-1:s,d=d.splice(E,y),L=d.length-1;L>=0;L--)d[L]._path=null;o&&(b._curves=d.slice(1)),this._adjustCurves(E,E)}return this._changed(41),b},clear:"#removeSegments",hasHandles:function(){for(var s=this._segments,a=0,o=s.length;a<o;a++)if(s[a].hasHandles())return!0;return!1},clearHandles:function(){for(var s=this._segments,a=0,o=s.length;a<o;a++)s[a].clearHandles()},getLength:function(){if(this._length==null){for(var s=this.getCurves(),a=0,o=0,c=s.length;o<c;o++)a+=s[o].getLength();this._length=a}return this._length},getArea:function(){var s=this._area;if(s==null){var a=this._segments,o=this._closed;s=0;for(var c=0,d=a.length;c<d;c++){var f=c+1===d;s+=Ce.getArea(Ce.getValues(a[c],a[f?0:c+1],null,f&&!o))}this._area=s}return s},isFullySelected:function(){var s=this._segments.length;return this.isSelected()&&s>0&&this._segmentSelection===s*7},setFullySelected:function(s){s&&this._selectSegments(!0),this.setSelected(s)},setSelection:function s(a){a&1||this._selectSegments(!1),s.base.call(this,a)},_selectSegments:function(s){var a=this._segments,o=a.length,c=s?7:0;this._segmentSelection=c*o;for(var d=0;d<o;d++)a[d]._selection=c},_updateSelection:function(s,a,o){s._selection=o;var c=this._segmentSelection+=o-a;c>0&&this.setSelected(!0)},divideAt:function(s){var a=this.getLocationAt(s),o;return a&&(o=a.getCurve().divideAt(a.getCurveOffset()))?o._segment1:null},splitAt:function(s){var a=this.getLocationAt(s),o=a&&a.index,c=a&&a.time,d=1e-8,f=1-d;c>f&&(o++,c=0);var b=this.getCurves();if(o>=0&&o<b.length){c>=d&&b[o++].divideAtTime(c);var y=this.removeSegments(o,this._segments.length,!0),L;return this._closed?(this.setClosed(!1),L=this):(L=new Ae(se.NO_INSERT),L.insertAbove(this),L.copyAttributes(this)),L._add(y,0),this.addSegment(y[0]),L}return null},split:function(s,a){var o,c=a===t?s:(o=this.getCurves()[s])&&o.getLocationAtTime(a);return c!=null?this.splitAt(c):null},join:function(s,a){var o=a||0;if(s&&s!==this){var c=s._segments,d=this.getLastSegment(),f=s.getLastSegment();if(!f)return this;d&&d._point.isClose(f._point,o)&&s.reverse();var b=s.getFirstSegment();if(d&&d._point.isClose(b._point,o))d.setHandleOut(b._handleOut),this._add(c.slice(1));else{var y=this.getFirstSegment();y&&y._point.isClose(b._point,o)&&s.reverse(),f=s.getLastSegment(),y&&y._point.isClose(f._point,o)?(y.setHandleIn(f._handleIn),this._add(c.slice(0,c.length-1),0)):this._add(c.slice())}s._closed&&this._add([c[0]]),s.remove()}var L=this.getFirstSegment(),P=this.getLastSegment();return L!==P&&L._point.isClose(P._point,o)&&(L.setHandleIn(P._handleIn),P.remove(),this.setClosed(!0)),this},reduce:function(s){for(var a=this.getCurves(),o=s&&s.simplify,c=o?1e-7:0,d=a.length-1;d>=0;d--){var f=a[d];!f.hasHandles()&&(!f.hasLength(c)||o&&f.isCollinear(f.getNext()))&&f.remove()}return this},reverse:function(){this._segments.reverse();for(var s=0,a=this._segments.length;s<a;s++){var o=this._segments[s],c=o._handleIn;o._handleIn=o._handleOut,o._handleOut=c,o._index=s}this._curves=null,this._changed(9)},flatten:function(s){for(var a=new zi(this,s||.25,256,!0),o=a.parts,c=o.length,d=[],f=0;f<c;f++)d.push(new Te(o[f].curve.slice(0,2)));!this._closed&&c>0&&d.push(new Te(o[c-1].curve.slice(6))),this.setSegments(d)},simplify:function(s){var a=new Ki(this).fit(s||2.5);return a&&this.setSegments(a),!!a},smooth:function(s){var a=this,o=s||{},c=o.type||"asymmetric",d=this._segments,f=d.length,b=this._closed;function y(at,Ut){var Pt=at&&at.index;if(Pt!=null){var At=at.path;if(At&&At!==a)throw new Error(at._class+" "+Pt+" of "+At+" is not part of "+a);Ut&&at instanceof Ce&&Pt++}else Pt=typeof at=="number"?at:Ut;return Math.min(Pt<0&&b?Pt%f:Pt<0?Pt+f:Pt,f-1)}var L=b&&o.from===t&&o.to===t,P=y(o.from,0),x=y(o.to,f-1);if(P>x)if(b)P-=f;else{var E=P;P=x,x=E}if(/^(?:asymmetric|continuous)$/.test(c)){var I=c==="asymmetric",T=Math.min,M=x-P+1,V=M-1,z=L?T(M,4):1,N=z,F=z,D=[];if(b||(N=T(1,P),F=T(1,f-x-1)),V+=N+F,V<=1)return;for(var O=0,H=P-N;O<=V;O++,H++)D[O]=d[(H<0?H+f:H)%f]._point;for(var G=D[0]._x+2*D[1]._x,K=D[0]._y+2*D[1]._y,j=2,J=V-1,ee=[G],re=[K],ie=[j],oe=[],le=[],O=1;O<V;O++){var pe=O<J,be=pe||I?1:2,Le=pe?4:I?2:7,Ne=pe?4:I?3:8,He=pe?2:I?0:1,Ue=be/j;j=ie[O]=Le-Ue,G=ee[O]=Ne*D[O]._x+He*D[O+1]._x-Ue*G,K=re[O]=Ne*D[O]._y+He*D[O+1]._y-Ue*K}oe[J]=ee[J]/ie[J],le[J]=re[J]/ie[J];for(var O=V-2;O>=0;O--)oe[O]=(ee[O]-oe[O+1])/ie[O],le[O]=(re[O]-le[O+1])/ie[O];oe[V]=(3*D[V]._x-oe[J])/2,le[V]=(3*D[V]._y-le[J])/2;for(var O=N,nt=V-F,H=P;O<=nt;O++,H++){var et=d[H<0?H+f:H],tt=et._point,Je=oe[O]-tt._x,ct=le[O]-tt._y;(L||O<nt)&&et.setHandleOut(Je,ct),(L||O>N)&&et.setHandleIn(-Je,-ct)}}else for(var O=P;O<=x;O++)d[O<0?O+f:O].smooth(o,!L&&O===P,!L&&O===x)},toShape:function(s){if(!this._closed)return null;var a=this._segments,o,c,d,f;function b(I,T){var M=a[I],V=M.getNext(),z=a[T],N=z.getNext();return M._handleOut.isZero()&&V._handleIn.isZero()&&z._handleOut.isZero()&&N._handleIn.isZero()&&V._point.subtract(M._point).isCollinear(N._point.subtract(z._point))}function y(I){var T=a[I],M=T.getPrevious(),V=T.getNext();return M._handleOut.isZero()&&T._handleIn.isZero()&&T._handleOut.isZero()&&V._handleIn.isZero()&&T._point.subtract(M._point).isOrthogonal(V._point.subtract(T._point))}function L(I){var T=a[I],M=T.getNext(),V=T._handleOut,z=M._handleIn,N=.5522847498307936;if(V.isOrthogonal(z)){var F=T._point,D=M._point,O=new Oe(F,V,!0).intersect(new Oe(D,z,!0),!0);return O&&B.isZero(V.getLength()/O.subtract(F).getLength()-N)&&B.isZero(z.getLength()/O.subtract(D).getLength()-N)}return!1}function P(I,T){return a[I]._point.getDistance(a[T]._point)}if(!this.hasHandles()&&a.length===4&&b(0,2)&&b(1,3)&&y(1)?(o=Se.Rectangle,c=new X(P(0,3),P(0,1)),f=a[1]._point.add(a[2]._point).divide(2)):a.length===8&&L(0)&&L(2)&&L(4)&&L(6)&&b(1,5)&&b(3,7)?(o=Se.Rectangle,c=new X(P(1,6),P(0,3)),d=c.subtract(new X(P(0,7),P(1,2))).divide(2),f=a[3]._point.add(a[4]._point).divide(2)):a.length===4&&L(0)&&L(1)&&L(2)&&L(3)&&(B.isZero(P(0,2)-P(1,3))?(o=Se.Circle,d=P(0,2)/2):(o=Se.Ellipse,d=new X(P(2,0)/2,P(3,1)/2)),f=a[1]._point),o){var x=this.getPosition(!0),E=new o({center:x,size:c,radius:d,insert:!1});return E.copyAttributes(this,!0),E._matrix.prepend(this._matrix),E.rotate(f.subtract(x).getAngle()+90),(s===t||s)&&E.insertAbove(this),E}return null},toPath:"#clone",compare:function s(a){if(!a||a instanceof Xe)return s.base.call(this,a);var o=this.getCurves(),c=a.getCurves(),d=o.length,f=c.length;if(!d||!f)return d==f;for(var b=o[0].getValues(),y=[],L=0,P,x=0,E,I=0;I<f;I++){var z=c[I].getValues();y.push(z);var T=Ce.getOverlaps(b,z);if(T){P=!I&&T[0][0]>0?f-1:I,E=T[0][1];break}}for(var M=Math.abs,V=1e-8,z=y[P],N;b&&z;){var T=Ce.getOverlaps(b,z);if(T){var F=T[0][0];if(M(F-x)<V){x=T[1][0],x===1&&(b=++L<d?o[L].getValues():null,x=0);var D=T[0][1];if(M(D-E)<V){if(N||(N=[P,D]),E=T[1][1],E===1&&(++P>=f&&(P=0),z=y[P]||c[P].getValues(),E=0),!b)return N[0]===P&&N[1]===E;continue}}}break}return!1},_hitTestSelf:function(s,a,o,c){var d=this,f=this.getStyle(),b=this._segments,y=b.length,L=this._closed,P=a._tolerancePadding,x=P,E,I,T,M,V,z,N=a.stroke&&f.hasStroke(),F=a.fill&&f.hasFill(),D=a.curves,O=N?f.getStrokeWidth()/2:F&&a.tolerance>0||D?0:null;O!==null&&(O>0?(E=f.getStrokeJoin(),I=f.getStrokeCap(),T=f.getMiterLimit(),x=x.add(Ae._getStrokePadding(O,c))):E=I="round");function H(oe,le){return s.subtract(oe).divide(le).length<=1}function G(oe,le,pe){if(!a.selected||le.isSelected()){var be=oe._point;if(le!==be&&(le=le.add(be)),H(le,x))return new Ze(pe,d,{segment:oe,point:le})}}function K(oe,le){return(le||a.segments)&&G(oe,oe._point,"segment")||!le&&a.handles&&(G(oe,oe._handleIn,"handle-in")||G(oe,oe._handleOut,"handle-out"))}function j(oe){M.add(oe)}function J(oe){var le=L||oe._index>0&&oe._index<y-1;if((le?E:I)==="round")return H(oe._point,x);if(M=new Ae({internal:!0,closed:!0}),le?oe.isSmooth()||Ae._addBevelJoin(oe,E,O,T,null,c,j,!0):I==="square"&&Ae._addSquareCap(oe,I,O,null,c,j,!0),!M.isEmpty()){var pe;return M.contains(s)||(pe=M.getNearestLocation(s))&&H(pe.getPoint(),P)}}if(a.ends&&!a.segments&&!L){if(z=K(b[0],!0)||K(b[y-1],!0))return z}else if(a.segments||a.handles){for(var ee=0;ee<y;ee++)if(z=K(b[ee]))return z}if(O!==null){if(V=this.getNearestLocation(s),V){var re=V.getTime();re===0||re===1&&y>1?J(V.getSegment())||(V=null):H(V.getPoint(),x)||(V=null)}if(!V&&E==="miter"&&y>1)for(var ee=0;ee<y;ee++){var ie=b[ee];if(s.getDistance(ie._point)<=T*O&&J(ie)){V=ie.getLocation();break}}}return!V&&F&&this._contains(s)||V&&!N&&!D?new Ze("fill",this):V?new Ze(N?"stroke":"curve",this,{location:V,point:V.getPoint()}):null}},n.each(Ce._evaluateMethods,function(s){this[s+"At"]=function(a){var o=this.getLocationAt(a);return o&&o[s]()}},{beans:!1,getLocationOf:function(){for(var s=k.read(arguments),a=this.getCurves(),o=0,c=a.length;o<c;o++){var d=a[o].getLocationOf(s);if(d)return d}return null},getOffsetOf:function(){var s=this.getLocationOf.apply(this,arguments);return s?s.getOffset():null},getLocationAt:function(s){if(typeof s=="number"){for(var a=this.getCurves(),o=0,c=0,d=a.length;c<d;c++){var f=o,b=a[c];if(o+=b.getLength(),o>s)return b.getLocationAt(s-f)}if(a.length>0&&s<=this.getLength())return new De(a[a.length-1],1)}else if(s&&s.getPath&&s.getPath()===this)return s;return null},getOffsetsWithTangent:function(){var s=k.read(arguments);if(s.isZero())return[];for(var a=[],o=0,c=this.getCurves(),d=0,f=c.length;d<f;d++){for(var b=c[d],y=b.getTimesWithTangent(s),L=0,P=y.length;L<P;L++){var x=o+b.getOffsetAtTime(y[L]);a.indexOf(x)<0&&a.push(x)}o+=b.length}return a}}),new function(){function s(o,c,d,f){if(f<=0)return;var b=f/2,y=f-2,L=b-1,P=new Array(6),x,E;function I(F){var D=P[F],O=P[F+1];(x!=D||E!=O)&&(o.beginPath(),o.moveTo(x,E),o.lineTo(D,O),o.stroke(),o.beginPath(),o.arc(D,O,b,0,Math.PI*2,!0),o.fill())}for(var T=0,M=c.length;T<M;T++){var V=c[T],z=V._selection;if(V._transformCoordinates(d,P),x=P[0],E=P[1],z&2&&I(2),z&4&&I(4),o.fillRect(x-b,E-b,f,f),y>0&&!(z&1)){var N=o.fillStyle;o.fillStyle="#ffffff",o.fillRect(x-L,E-L,y,y),o.fillStyle=N}}}function a(o,c,d){var f=c._segments,b=f.length,y=new Array(6),L=!0,P,x,E,I,T,M,V,z;function N(D){if(d)D._transformCoordinates(d,y),P=y[0],x=y[1];else{var O=D._point;P=O._x,x=O._y}if(L)o.moveTo(P,x),L=!1;else{if(d)T=y[2],M=y[3];else{var H=D._handleIn;T=P+H._x,M=x+H._y}T===P&&M===x&&V===E&&z===I?o.lineTo(P,x):o.bezierCurveTo(V,z,T,M,P,x)}if(E=P,I=x,d)V=y[4],z=y[5];else{var H=D._handleOut;V=E+H._x,z=I+H._y}}for(var F=0;F<b;F++)N(f[F]);c._closed&&b>0&&N(f[0])}return{_draw:function(o,c,d,f){var b=c.dontStart,y=c.dontFinish||c.clip,L=this.getStyle(),P=L.hasFill(),x=L.hasStroke(),E=L.getDashArray(),I=!kt.support.nativeDash&&x&&E&&E.length;b||o.beginPath(),(P||x&&!I||y)&&(a(o,this,f),this._closed&&o.closePath());function T(D){return E[(D%I+I)%I]}if(!y&&(P||x)&&(this._setStyles(o,c,d),P&&(o.fill(L.getFillRule()),o.shadowColor="rgba(0,0,0,0)"),x)){if(I){b||o.beginPath();for(var M=new zi(this,.25,32,!1,f),V=M.length,z=-L.getDashOffset(),N,F=0;z>0;)z-=T(F--)+T(F--);for(;z<V;)N=z+T(F++),(z>0||N>0)&&M.drawPart(o,Math.max(z,0),Math.max(N,0)),z=N+T(F++)}o.stroke()}},_drawSelected:function(o,c){o.beginPath(),a(o,this,c),o.stroke(),s(o,this._segments,c,kt.settings.handleSize)}}},new function(){function s(a){var o=a._segments;if(!o.length)throw new Error("Use a moveTo() command first");return o[o.length-1]}return{moveTo:function(){var a=this._segments;a.length===1&&this.removeSegment(0),a.length||this._add([new Te(k.read(arguments))])},moveBy:function(){throw new Error("moveBy() is unsupported on Path items.")},lineTo:function(){this._add([new Te(k.read(arguments))])},cubicCurveTo:function(){var a=arguments,o=k.read(a),c=k.read(a),d=k.read(a),f=s(this);f.setHandleOut(o.subtract(f._point)),this._add([new Te(d,c.subtract(d))])},quadraticCurveTo:function(){var a=arguments,o=k.read(a),c=k.read(a),d=s(this)._point;this.cubicCurveTo(o.add(d.subtract(o).multiply(1/3)),o.add(c.subtract(o).multiply(1/3)),c)},curveTo:function(){var a=arguments,o=k.read(a),c=k.read(a),d=n.pick(n.read(a),.5),f=1-d,b=s(this)._point,y=o.subtract(b.multiply(f*f)).subtract(c.multiply(d*d)).divide(2*d*f);if(y.isNaN())throw new Error("Cannot put a curve through points with parameter = "+d);this.quadraticCurveTo(y,c)},arcTo:function(){var a=arguments,o=Math.abs,c=Math.sqrt,d=s(this),f=d._point,b=k.read(a),y,L=n.peek(a),P=n.pick(L,!0),x,E,I,T;if(typeof P=="boolean")var M=f.add(b).divide(2),y=M.add(M.subtract(f).rotate(P?-90:90));else if(n.remain(a)<=2)y=b,b=k.read(a);else if(!f.equals(b)){var V=X.read(a),z=B.isZero;if(z(V.width)||z(V.height))return this.lineTo(b);var N=n.read(a),P=!!n.read(a),F=!!n.read(a),M=f.add(b).divide(2),D=f.subtract(M).rotate(-N),O=D.x,H=D.y,G=o(V.width),K=o(V.height),j=G*G,J=K*K,ee=O*O,re=H*H,ie=c(ee/j+re/J);if(ie>1&&(G*=ie,K*=ie,j=G*G,J=K*K),ie=(j*J-j*re-J*ee)/(j*re+J*ee),o(ie)<1e-12&&(ie=0),ie<0)throw new Error("Cannot create an arc with the given arguments");x=new k(G*H/K,-K*O/G).multiply((F===P?-1:1)*c(ie)).rotate(N).add(M),T=new ye().translate(x).rotate(N).scale(G,K),I=T._inverseTransform(f),E=I.getDirectedAngle(T._inverseTransform(b)),!P&&E>0?E-=360:P&&E<0&&(E+=360)}if(y){var oe=new Oe(f.add(y).divide(2),y.subtract(f).rotate(90),!0),le=new Oe(y.add(b).divide(2),b.subtract(y).rotate(90),!0),pe=new Oe(f,b),be=pe.getSide(y);if(x=oe.intersect(le,!0),!x){if(!be)return this.lineTo(b);throw new Error("Cannot create an arc with the given arguments")}I=f.subtract(x),E=I.getDirectedAngle(b.subtract(x));var Le=pe.getSide(x,!0);Le===0?E=be*o(E):be===Le&&(E+=E<0?360:-360)}if(E){for(var Ne=1e-5,He=o(E),Ue=He>=360?4:Math.ceil((He-Ne)/90),nt=E/Ue,et=nt*Math.PI/360,tt=4/3*Math.sin(et)/(1+Math.cos(et)),Je=[],ct=0;ct<=Ue;ct++){var D=b,at=null;if(ct<Ue&&(at=I.rotate(90).multiply(tt),T?(D=T._transformPoint(I),at=T._transformPoint(I.add(at)).subtract(D)):D=x.add(I)),!ct)d.setHandleOut(at);else{var Ut=I.rotate(-90).multiply(tt);T&&(Ut=T._transformPoint(I.add(Ut)).subtract(D)),Je.push(new Te(D,Ut,at))}I=I.rotate(nt)}this._add(Je)}},lineBy:function(){var a=k.read(arguments),o=s(this)._point;this.lineTo(o.add(a))},curveBy:function(){var a=arguments,o=k.read(a),c=k.read(a),d=n.read(a),f=s(this)._point;this.curveTo(f.add(o),f.add(c),d)},cubicCurveBy:function(){var a=arguments,o=k.read(a),c=k.read(a),d=k.read(a),f=s(this)._point;this.cubicCurveTo(f.add(o),f.add(c),f.add(d))},quadraticCurveBy:function(){var a=arguments,o=k.read(a),c=k.read(a),d=s(this)._point;this.quadraticCurveTo(d.add(o),d.add(c))},arcBy:function(){var a=arguments,o=s(this)._point,c=o.add(k.read(a)),d=n.pick(n.peek(a),!0);typeof d=="boolean"?this.arcTo(c,d):this.arcTo(c,o.add(k.read(a)))},closePath:function(a){this.setClosed(!0),this.join(this,a)}}},{_getBounds:function(s,a){var o=a.handle?"getHandleBounds":a.stroke?"getStrokeBounds":"getBounds";return Ae[o](this._segments,this._closed,this,s,a)},statics:{getBounds:function(s,a,o,c,d,f){var b=s[0];if(!b)return new Z;var y=new Array(6),L=b._transformCoordinates(c,new Array(6)),P=L.slice(0,2),x=P.slice(),E=new Array(2);function I(V){V._transformCoordinates(c,y);for(var z=0;z<2;z++)Ce._addBounds(L[z],L[z+4],y[z+2],y[z],z,f?f[z]:0,P,x,E);var N=L;L=y,y=N}for(var T=1,M=s.length;T<M;T++)I(s[T]);return a&&I(b),new Z(P[0],P[1],x[0]-P[0],x[1]-P[1])},getStrokeBounds:function(s,a,o,c,d){var f=o.getStyle(),b=f.hasStroke(),y=f.getStrokeWidth(),L=b&&o._getStrokeMatrix(c,d),P=b&&Ae._getStrokePadding(y,L),x=Ae.getBounds(s,a,o,c,d,P);if(!b)return x;var E=y/2,I=f.getStrokeJoin(),T=f.getStrokeCap(),M=f.getMiterLimit(),V=new Z(new X(P));function z(G){x=x.include(G)}function N(G){x=x.unite(V.setCenter(G._point.transform(c)))}function F(G,K){K==="round"||G.isSmooth()?N(G):Ae._addBevelJoin(G,K,E,M,c,L,z)}function D(G,K){K==="round"?N(G):Ae._addSquareCap(G,K,E,c,L,z)}var O=s.length-(a?0:1);if(O>0){for(var H=1;H<O;H++)F(s[H],I);a?F(s[0],I):(D(s[0],T),D(s[s.length-1],T))}return x},_getStrokePadding:function(s,a){if(!a)return[s,s];var o=new k(s,0).transform(a),c=new k(0,s).transform(a),d=o.getAngleInRadians(),f=o.getLength(),b=c.getLength(),y=Math.sin(d),L=Math.cos(d),P=Math.tan(d),x=Math.atan2(b*P,f),E=Math.atan2(b,P*f);return[Math.abs(f*Math.cos(x)*L+b*Math.sin(x)*y),Math.abs(b*Math.sin(E)*L+f*Math.cos(E)*y)]},_addBevelJoin:function(s,a,o,c,d,f,b,y){var L=s.getCurve(),P=L.getPrevious(),x=L.getPoint1().transform(d),E=P.getNormalAtTime(1).multiply(o).transform(f),I=L.getNormalAtTime(0).multiply(o).transform(f),T=E.getDirectedAngle(I);if((T<0||T>=180)&&(E=E.negate(),I=I.negate()),y&&b(x),b(x.add(E)),a==="miter"){var M=new Oe(x.add(E),new k(-E.y,E.x),!0).intersect(new Oe(x.add(I),new k(-I.y,I.x),!0),!0);M&&x.getDistance(M)<=c*o&&b(M)}b(x.add(I))},_addSquareCap:function(s,a,o,c,d,f,b){var y=s._point.transform(c),L=s.getLocation(),P=L.getNormal().multiply(L.getTime()===0?o:-o).transform(d);a==="square"&&(b&&(f(y.subtract(P)),f(y.add(P))),y=y.add(P.rotate(-90))),f(y.add(P)),f(y.subtract(P))},getHandleBounds:function(s,a,o,c,d){var f=o.getStyle(),b=d.stroke&&f.hasStroke(),y,L;if(b){var P=o._getStrokeMatrix(c,d),x=f.getStrokeWidth()/2,E=x;f.getStrokeJoin()==="miter"&&(E=x*f.getMiterLimit()),f.getStrokeCap()==="square"&&(E=Math.max(E,x*Math.SQRT2)),y=Ae._getStrokePadding(x,P),L=Ae._getStrokePadding(E,P)}for(var I=new Array(6),T=1/0,M=-T,V=T,z=M,N=0,F=s.length;N<F;N++){var D=s[N];D._transformCoordinates(c,I);for(var O=0;O<6;O+=2){var H=O?y:L,G=H?H[0]:0,K=H?H[1]:0,j=I[O],J=I[O+1],ee=j-G,re=j+G,ie=J-K,oe=J+K;ee<T&&(T=ee),re>M&&(M=re),ie<V&&(V=ie),oe>z&&(z=oe)}}return new Z(T,V,M-T,z-V)}}});Ae.inject({statics:new function(){var s=.5522847498307936,a=[new Te([-1,0],[0,s],[0,-s]),new Te([0,-1],[-s,0],[s,0]),new Te([1,0],[0,-s],[0,s]),new Te([0,1],[s,0],[-s,0])];function o(d,f,b){var y=n.getNamed(b),L=new Ae(y&&(y.insert==!0?se.INSERT:y.insert==!1?se.NO_INSERT:null));return L._add(d),L._closed=f,L.set(y,se.INSERT)}function c(d,f,b){for(var y=new Array(4),L=0;L<4;L++){var P=a[L];y[L]=new Te(P._point.multiply(f).add(d),P._handleIn.multiply(f),P._handleOut.multiply(f))}return o(y,!0,b)}return{Line:function(){var d=arguments;return o([new Te(k.readNamed(d,"from")),new Te(k.readNamed(d,"to"))],!1,d)},Circle:function(){var d=arguments,f=k.readNamed(d,"center"),b=n.readNamed(d,"radius");return c(f,new X(b),d)},Rectangle:function(){var d=arguments,f=Z.readNamed(d,"rectangle"),b=X.readNamed(d,"radius",0,{readNull:!0}),y=f.getBottomLeft(!0),L=f.getTopLeft(!0),P=f.getTopRight(!0),x=f.getBottomRight(!0),E;if(!b||b.isZero())E=[new Te(y),new Te(L),new Te(P),new Te(x)];else{b=X.min(b,f.getSize(!0).divide(2));var I=b.width,T=b.height,M=I*s,V=T*s;E=[new Te(y.add(I,0),null,[-M,0]),new Te(y.subtract(0,T),[0,V]),new Te(L.add(0,T),null,[0,-V]),new Te(L.add(I,0),[-M,0],null),new Te(P.subtract(I,0),null,[M,0]),new Te(P.add(0,T),[0,-V],null),new Te(x.subtract(0,T),null,[0,V]),new Te(x.subtract(I,0),[M,0])]}return o(E,!0,d)},RoundRectangle:"#Rectangle",Ellipse:function(){var d=arguments,f=Se._readEllipse(d);return c(f.center,f.radius,d)},Oval:"#Ellipse",Arc:function(){var d=arguments,f=k.readNamed(d,"from"),b=k.readNamed(d,"through"),y=k.readNamed(d,"to"),L=n.getNamed(d),P=new Ae(L&&L.insert==!1&&se.NO_INSERT);return P.moveTo(f),P.arcTo(b,y),P.set(L)},RegularPolygon:function(){for(var d=arguments,f=k.readNamed(d,"center"),b=n.readNamed(d,"sides"),y=n.readNamed(d,"radius"),L=360/b,P=b%3===0,x=new k(0,P?-y:y),E=P?-1:.5,I=new Array(b),T=0;T<b;T++)I[T]=new Te(f.add(x.rotate((T+E)*L)));return o(I,!0,d)},Star:function(){for(var d=arguments,f=k.readNamed(d,"center"),b=n.readNamed(d,"points")*2,y=n.readNamed(d,"radius1"),L=n.readNamed(d,"radius2"),P=360/b,x=new k(0,-1),E=new Array(b),I=0;I<b;I++)E[I]=new Te(f.add(x.rotate(P*I).multiply(I%2?L:y)));return o(E,!0,d)}}}});var Xe=Ve.extend({_class:"CompoundPath",_serializeFields:{children:[]},beans:!0,initialize:function(a){this._children=[],this._namedChildren={},this._initialize(a)||(typeof a=="string"?this.setPathData(a):this.addChildren(Array.isArray(a)?a:arguments))},insertChildren:function s(a,o){var c=o,d=c[0];d&&typeof d[0]=="number"&&(c=[c]);for(var f=o.length-1;f>=0;f--){var b=c[f];c===o&&!(b instanceof Ae)&&(c=n.slice(c)),Array.isArray(b)?c[f]=new Ae({segments:b,insert:!1}):b instanceof Xe&&(c.splice.apply(c,[f,1].concat(b.removeChildren())),b.remove())}return s.base.call(this,a,c)},reduce:function s(a){for(var o=this._children,c=o.length-1;c>=0;c--){var d=o[c].reduce(a);d.isEmpty()&&d.remove()}if(!o.length){var d=new Ae(se.NO_INSERT);return d.copyAttributes(this),d.insertAbove(this),this.remove(),d}return s.base.call(this)},isClosed:function(){for(var s=this._children,a=0,o=s.length;a<o;a++)if(!s[a]._closed)return!1;return!0},setClosed:function(s){for(var a=this._children,o=0,c=a.length;o<c;o++)a[o].setClosed(s)},getFirstSegment:function(){var s=this.getFirstChild();return s&&s.getFirstSegment()},getLastSegment:function(){var s=this.getLastChild();return s&&s.getLastSegment()},getCurves:function(){for(var s=this._children,a=[],o=0,c=s.length;o<c;o++)n.push(a,s[o].getCurves());return a},getFirstCurve:function(){var s=this.getFirstChild();return s&&s.getFirstCurve()},getLastCurve:function(){var s=this.getLastChild();return s&&s.getLastCurve()},getArea:function(){for(var s=this._children,a=0,o=0,c=s.length;o<c;o++)a+=s[o].getArea();return a},getLength:function(){for(var s=this._children,a=0,o=0,c=s.length;o<c;o++)a+=s[o].getLength();return a},getPathData:function(s,a){for(var o=this._children,c=[],d=0,f=o.length;d<f;d++){var b=o[d],y=b._matrix;c.push(b.getPathData(s&&!y.isIdentity()?s.appended(y):s,a))}return c.join("")},_hitTestChildren:function s(a,o,c){return s.base.call(this,a,o.class===Ae||o.type==="path"?o:n.set({},o,{fill:!1}),c)},_draw:function(s,a,o,c){var d=this._children;if(d.length){a=a.extend({dontStart:!0,dontFinish:!0}),s.beginPath();for(var f=0,b=d.length;f<b;f++)d[f].draw(s,a,c);if(!a.clip){this._setStyles(s,a,o);var y=this._style;y.hasFill()&&(s.fill(y.getFillRule()),s.shadowColor="rgba(0,0,0,0)"),y.hasStroke()&&s.stroke()}}},_drawSelected:function(s,a,o){for(var c=this._children,d=0,f=c.length;d<f;d++){var b=c[d],y=b._matrix;o[b._id]||b._drawSelected(s,y.isIdentity()?a:a.appended(y))}}},new function(){function s(a,o){var c=a._children;if(o&&!c.length)throw new Error("Use a moveTo() command first");return c[c.length-1]}return n.each(["lineTo","cubicCurveTo","quadraticCurveTo","curveTo","arcTo","lineBy","cubicCurveBy","quadraticCurveBy","curveBy","arcBy"],function(a){this[a]=function(){var o=s(this,!0);o[a].apply(o,arguments)}},{moveTo:function(){var a=s(this),o=a&&a.isEmpty()?a:new Ae(se.NO_INSERT);o!==a&&this.addChild(o),o.moveTo.apply(o,arguments)},moveBy:function(){var a=s(this,!0),o=a&&a.getLastSegment(),c=k.read(arguments);this.moveTo(o?c.add(o._point):c)},closePath:function(a){s(this,!0).closePath(a)}})},n.each(["reverse","flatten","simplify","smooth"],function(s){this[s]=function(a){for(var o=this._children,c,d=0,f=o.length;d<f;d++)c=o[d][s](a)||c;return c}},{}));Ve.inject(new function(){var s=Math.min,a=Math.max,o=Math.abs,c={unite:{1:!0,2:!0},intersect:{2:!0},subtract:{1:!0},exclude:{1:!0,"-1":!0}};function d(N){return N._children||[N]}function f(N,F){var D=N.clone(!1).reduce({simplify:!0}).transform(null,!0,!0);if(F){for(var O=d(D),H=0,G=O.length;H<G;H++){var N=O[H];!N._closed&&!N.isEmpty()&&(N.closePath(1e-12),N.getFirstSegment().setHandleIn(0,0),N.getLastSegment().setHandleOut(0,0))}D=D.resolveCrossings().reorient(D.getFillRule()==="nonzero",!0)}return D}function b(N,F,D,O,H){var G=new Xe(se.NO_INSERT);return G.addChildren(N,!0),G=G.reduce({simplify:F}),H&&H.insert==!1||G.insertAbove(O&&D.isSibling(O)&&D.getIndex()<O.getIndex()?O:D),G.copyAttributes(D,!0),G}function y(N){return N.hasOverlap()||N.isCrossing()}function L(N,F,D,O){if(O&&(O.trace==!1||O.stroke)&&/^(subtract|intersect)$/.test(D))return P(N,F,D);var H=f(N,!0),G=F&&N!==F&&f(F,!0),K=c[D];K[D]=!0,G&&(K.subtract||K.exclude)^(G.isClockwise()^H.isClockwise())&&G.reverse();var j=T(De.expand(H.getIntersections(G,y))),J=d(H),ee=G&&d(G),re=[],ie=[],oe;function le(at){for(var Ut=0,Pt=at.length;Ut<Pt;Ut++){var At=at[Ut];n.push(re,At._segments),n.push(ie,At.getCurves()),At._overlapsOnly=!0}}function pe(at){for(var Ut=[],Pt=0,At=at&&at.length;Pt<At;Pt++)Ut.push(ie[at[Pt]]);return Ut}if(j.length){le(J),ee&&le(ee);for(var be=new Array(ie.length),Le=0,Ne=ie.length;Le<Ne;Le++)be[Le]=ie[Le].getValues();for(var He=S.findCurveBoundsCollisions(be,be,0,!0),Ue={},Le=0;Le<ie.length;Le++){var nt=ie[Le],et=nt._path._id,tt=Ue[et]=Ue[et]||{};tt[nt.getIndex()]={hor:pe(He[Le].hor),ver:pe(He[Le].ver)}}for(var Le=0,Ne=j.length;Le<Ne;Le++)V(j[Le]._segment,H,G,Ue,K);for(var Le=0,Ne=re.length;Le<Ne;Le++){var Je=re[Le],ct=Je._intersection;Je._winding||V(Je,H,G,Ue,K),ct&&ct._overlap||(Je._path._overlapsOnly=!1)}oe=z(re,K)}else oe=I(ee?J.concat(ee):J.slice(),function(at){return!!K[at]});return b(oe,!0,N,F,O)}function P(N,F,D){var O=f(N),H=f(F),G=O.getIntersections(H,y),K=D==="subtract",j=D==="divide",J={},ee=[];function re(le){if(!J[le._id]&&(j||H.contains(le.getPointAt(le.getLength()/2))^K))return ee.unshift(le),J[le._id]=!0}for(var ie=G.length-1;ie>=0;ie--){var oe=G[ie].split();oe&&(re(oe)&&oe.getFirstSegment().setHandleIn(0,0),O.getLastSegment().setHandleOut(0,0))}return re(O),b(ee,!1,N,F)}function x(N,F){for(var D=N;D;){if(D===F)return;D=D._previous}for(;N._next&&N._next!==F;)N=N._next;if(!N._next){for(;F._previous;)F=F._previous;N._next=F,F._previous=N}}function E(N){for(var F=N.length-1;F>=0;F--)N[F].clearHandles()}function I(N,F,D){var O=N&&N.length;if(O){var H=n.each(N,function(He,Ue){this[He._id]={container:null,winding:He.isClockwise()?1:-1,index:Ue}},{}),G=N.slice().sort(function(He,Ue){return o(Ue.getArea())-o(He.getArea())}),K=G[0],j=S.findItemBoundsCollisions(G,null,B.GEOMETRIC_EPSILON);D==null&&(D=K.isClockwise());for(var J=0;J<O;J++){var ee=G[J],re=H[ee._id],ie=0,oe=j[J];if(oe){for(var le=null,pe=oe.length-1;pe>=0;pe--)if(oe[pe]<J){le=le||ee.getInteriorPoint();var be=G[oe[pe]];if(be.contains(le)){var Le=H[be._id];ie=Le.winding,re.winding+=ie,re.container=Le.exclude?Le.container:be;break}}}if(F(re.winding)===F(ie))re.exclude=!0,N[re.index]=null;else{var Ne=re.container;ee.setClockwise(Ne?!Ne.isClockwise():D)}}}return N}function T(N,F,D){var O=F&&[],H=1e-8,G=1-H,K=!1,j=D||[],J=D&&{},ee,re,ie;function oe(Ut){return Ut._path._id+"."+Ut._segment1._index}for(var le=(D&&D.length)-1;le>=0;le--){var pe=D[le];pe._path&&(J[oe(pe)]=!0)}for(var le=N.length-1;le>=0;le--){var be=N[le],Le=be._time,Ne=Le,He=F&&!F(be),pe=be._curve,Ue;if(pe&&(pe!==re?(K=!pe.hasHandles()||J&&J[oe(pe)],ee=[],ie=null,re=pe):ie>=H&&(Le/=ie)),He){ee&&ee.push(be);continue}else F&&O.unshift(be);if(ie=Ne,Le<H)Ue=pe._segment1;else if(Le>G)Ue=pe._segment2;else{var nt=pe.divideAtTime(Le,!0);K&&j.push(pe,nt),Ue=nt._segment1;for(var et=ee.length-1;et>=0;et--){var tt=ee[et];tt._time=(tt._time-Le)/(1-Le)}}be._setSegment(Ue);var Je=Ue._intersection,ct=be._intersection;if(Je){x(Je,ct);for(var at=Je;at;)x(at._intersection,Je),at=at._next}else Ue._intersection=ct}return D||E(j),O||N}function M(N,F,D,O,H){var G=Array.isArray(F)?F:F[D?"hor":"ver"],K=D?1:0,j=K^1,J=[N.x,N.y],ee=J[K],re=J[j],ie=1e-9,oe=1e-6,le=ee-ie,pe=ee+ie,be=0,Le=0,Ne=0,He=0,Ue=!1,nt=!1,et=1,tt=[],Je,ct;function at(Xt){var ci=Xt[j+0],Mi=Xt[j+6];if(!(re<s(ci,Mi)||re>a(ci,Mi))){var $i=Xt[K+0],zs=Xt[K+2],gr=Xt[K+4],rn=Xt[K+6];if(ci===Mi){($i<pe&&rn>le||rn<pe&&$i>le)&&(Ue=!0);return}var _n=re===ci?0:re===Mi||le>a($i,zs,gr,rn)||pe<s($i,zs,gr,rn)?1:Ce.solveCubic(Xt,j,re,tt,0,1)>0?tt[0]:1,Ls=_n===0?$i:_n===1?rn:Ce.getPoint(Xt,_n)[D?"y":"x"],Ps=ci>Mi?1:-1,fr=Je[j]>Je[j+6]?1:-1,Ws=Je[K+6];return re!==ci?(Ls<le?Ne+=Ps:Ls>pe?He+=Ps:Ue=!0,Ls>ee-oe&&Ls<ee+oe&&(et/=2)):(Ps!==fr?$i<le?Ne+=Ps:$i>pe&&(He+=Ps):$i!=Ws&&(Ws<pe&&Ls>pe?(He+=Ps,Ue=!0):Ws>le&&Ls<le&&(Ne+=Ps,Ue=!0)),et/=4),Je=Xt,!H&&Ls>le&&Ls<pe&&Ce.getTangent(Xt,_n)[D?"x":"y"]===0&&M(N,F,!D,O,!0)}}function Ut(Xt){var ci=Xt[j+0],Mi=Xt[j+2],$i=Xt[j+4],zs=Xt[j+6];if(re<=a(ci,Mi,$i,zs)&&re>=s(ci,Mi,$i,zs)){for(var gr=Xt[K+0],rn=Xt[K+2],_n=Xt[K+4],Ls=Xt[K+6],Ps=le>a(gr,rn,_n,Ls)||pe<s(gr,rn,_n,Ls)?[Xt]:Ce.getMonoCurves(Xt,D),fr,Ws=0,Ko=Ps.length;Ws<Ko;Ws++)if(fr=at(Ps[Ws]))return fr}}for(var Pt=0,At=G.length;Pt<At;Pt++){var Ot=G[Pt],_t=Ot._path,Wi=Ot.getValues(),Oi;if((!Pt||G[Pt-1]._path!==_t)&&(Je=null,_t._closed||(ct=Ce.getValues(_t.getLastCurve().getSegment2(),Ot.getSegment1(),null,!O),ct[j]!==ct[j+6]&&(Je=ct)),!Je)){Je=Wi;for(var Xi=_t.getLastCurve();Xi&&Xi!==Ot;){var Ti=Xi.getValues();if(Ti[j]!==Ti[j+6]){Je=Ti;break}Xi=Xi.getPrevious()}}if(Oi=Ut(Wi))return Oi;if(Pt+1===At||G[Pt+1]._path!==_t){if(ct&&(Oi=Ut(ct)))return Oi;Ue&&!Ne&&!He&&(Ne=He=_t.isClockwise(O)^D?1:-1),be+=Ne,Le+=He,Ne=He=0,Ue&&(nt=!0,Ue=!1),ct=null}}return be=o(be),Le=o(Le),{winding:a(be,Le),windingL:be,windingR:Le,quality:et,onPath:nt}}function V(N,F,D,O,H){var G=[],K=N,j=0,ie;do{var J=N.getCurve();if(J){var ee=J.getLength();G.push({segment:N,curve:J,length:ee}),j+=ee}N=N.getNext()}while(N&&!N._intersection&&N!==K);for(var re=[.5,.25,.75],ie={winding:0,quality:-1},oe=.001,le=1-oe,pe=0;pe<re.length&&ie.quality<.5;pe++)for(var ee=j*re[pe],be=0,Le=G.length;be<Le;be++){var Ne=G[be],He=Ne.length;if(ee<=He){var J=Ne.curve,Ue=J._path,nt=Ue._parent,et=nt instanceof Xe?nt:Ue,tt=B.clamp(J.getTimeAt(ee),oe,le),Je=J.getPointAtTime(tt),ct=o(J.getTangentAtTime(tt).y)<Math.SQRT1_2,at=null;if(H.subtract&&D){var Ut=et===F?D:F,Pt=Ut._getWinding(Je,ct,!0);if(et===F&&Pt.winding||et===D&&!Pt.winding){if(Pt.quality<1)continue;at={winding:0,quality:1}}}at=at||M(Je,O[Ue._id][J.getIndex()],ct,!0),at.quality>ie.quality&&(ie=at);break}ee-=He}for(var be=G.length-1;be>=0;be--)G[be].segment._winding=ie}function z(N,F){var D=[],O;function H(At){var Ot;return!!(At&&!At._visited&&(!F||F[(Ot=At._winding||{}).winding]&&!(F.unite&&Ot.winding===2&&Ot.windingL&&Ot.windingR)))}function G(At){if(At){for(var Ot=0,_t=O.length;Ot<_t;Ot++)if(At===O[Ot])return!0}return!1}function K(At){for(var Ot=At._segments,_t=0,Wi=Ot.length;_t<Wi;_t++)Ot[_t]._visited=!0}function j(At,Ot){var _t=At._intersection,Wi=_t,Oi=[];Ot&&(O=[At]);function Xi(Ti,Xt){for(;Ti&&Ti!==Xt;){var ci=Ti._segment,Mi=ci&&ci._path;if(Mi){var $i=ci.getNext()||Mi.getFirstSegment(),zs=$i._intersection;ci!==At&&(G(ci)||G($i)||$i&&H(ci)&&(H($i)||zs&&H(zs._segment)))&&Oi.push(ci),Ot&&O.push(ci)}Ti=Ti._next}}if(_t){for(Xi(_t);_t&&_t._previous;)_t=_t._previous;Xi(_t,Wi)}return Oi}N.sort(function(At,Ot){var _t=At._intersection,Wi=Ot._intersection,Oi=!!(_t&&_t._overlap),Xi=!!(Wi&&Wi._overlap),Ti=At._path,Xt=Ot._path;return Oi^Xi?Oi?1:-1:!_t^!Wi?_t?1:-1:Ti!==Xt?Ti._id-Xt._id:At._index-Ot._index});for(var J=0,ee=N.length;J<ee;J++){var re=N[J],ie=H(re),oe=null,le=!1,pe=!0,be=[],Le,Ne,He;if(ie&&re._path._overlapsOnly){var Ue=re._path,nt=re._intersection._segment._path;Ue.compare(nt)&&(Ue.getArea()&&D.push(Ue.clone(!1)),K(Ue),K(nt),ie=!1)}for(;ie;){var et=!oe,tt=j(re,et),Je=tt.shift(),le=!et&&(G(re)||G(Je)),ct=!le&&Je;if(et&&(oe=new Ae(se.NO_INSERT),Le=null),le){(re.isFirst()||re.isLast())&&(pe=re._path._closed),re._visited=!0;break}if(ct&&Le&&(be.push(Le),Le=null),Le||(ct&&tt.push(re),Le={start:oe._segments.length,crossings:tt,visited:Ne=[],handleIn:He}),ct&&(re=Je),!H(re)){oe.removeSegments(Le.start);for(var at=0,Ut=Ne.length;at<Ut;at++)Ne[at]._visited=!1;Ne.length=0;do re=Le&&Le.crossings.shift(),(!re||!re._path)&&(re=null,Le=be.pop(),Le&&(Ne=Le.visited,He=Le.handleIn));while(Le&&!H(re));if(!re)break}var Pt=re.getNext();oe.add(new Te(re._point,He,Pt&&re._handleOut)),re._visited=!0,Ne.push(re),re=Pt||re._path.getFirstSegment(),He=Pt&&Pt._handleIn}le&&(pe&&(oe.getFirstSegment().setHandleIn(He),oe.setClosed(pe)),oe.getArea()!==0&&D.push(oe))}return D}return{_getWinding:function(N,F,D){return M(N,this.getCurves(),F,D)},unite:function(N,F){return L(this,N,"unite",F)},intersect:function(N,F){return L(this,N,"intersect",F)},subtract:function(N,F){return L(this,N,"subtract",F)},exclude:function(N,F){return L(this,N,"exclude",F)},divide:function(N,F){return F&&(F.trace==!1||F.stroke)?P(this,N,"divide"):b([this.subtract(N,F),this.intersect(N,F)],!0,this,N,F)},resolveCrossings:function(){var N=this._children,F=N||[this];function D(Le,Ne){var He=Le&&Le._intersection;return He&&He._overlap&&He._path===Ne}var O=!1,H=!1,G=this.getIntersections(null,function(Le){return Le.hasOverlap()&&(O=!0)||Le.isCrossing()&&(H=!0)}),K=O&&H&&[];if(G=De.expand(G),O)for(var j=T(G,function(Le){return Le.hasOverlap()},K),J=j.length-1;J>=0;J--){var ee=j[J],re=ee._path,ie=ee._segment,oe=ie.getPrevious(),le=ie.getNext();D(oe,re)&&D(le,re)&&(ie.remove(),oe._handleOut._set(0,0),le._handleIn._set(0,0),oe!==ie&&!oe.getCurve().hasLength()&&(le._handleIn.set(oe._handleIn),oe.remove()))}H&&(T(G,O&&function(Le){var Ne=Le.getCurve(),He=Le.getSegment(),Ue=Le._intersection,nt=Ue._curve,et=Ue._segment;if(Ne&&nt&&Ne._path&&nt._path)return!0;He&&(He._intersection=null),et&&(et._intersection=null)},K),K&&E(K),F=z(n.each(F,function(Le){n.push(this,Le._segments)},[])));var pe=F.length,be;return pe>1&&N?(F!==N&&this.setChildren(F),be=this):pe===1&&!N&&(F[0]!==this&&this.setSegments(F[0].removeSegments()),be=this),be||(be=new Xe(se.NO_INSERT),be.addChildren(F),be=be.reduce(),be.copyAttributes(this),this.replaceWith(be)),be},reorient:function(N,F){var D=this._children;return D&&D.length?this.setChildren(I(this.removeChildren(),function(O){return!!(N?O:O&1)},F)):F!==t&&this.setClockwise(F),this},getInteriorPoint:function(){var N=this.getBounds(),F=N.getCenter(!0);if(!this.contains(F)){for(var D=this.getCurves(),O=F.y,H=[],G=[],K=0,j=D.length;K<j;K++){var J=D[K].getValues(),ee=J[1],re=J[3],ie=J[5],oe=J[7];if(O>=s(ee,re,ie,oe)&&O<=a(ee,re,ie,oe))for(var le=Ce.getMonoCurves(J),pe=0,be=le.length;pe<be;pe++){var Le=le[pe],Ne=Le[1],He=Le[7];if(Ne!==He&&(O>=Ne&&O<=He||O>=He&&O<=Ne)){var Ue=O===Ne?Le[0]:O===He?Le[6]:Ce.solveCubic(Le,1,O,G,0,1)===1?Ce.getPoint(Le,G[0]).x:(Le[0]+Le[6])/2;H.push(Ue)}}}H.length>1&&(H.sort(function(nt,et){return nt-et}),F.x=(H[0]+H[1])/2)}return F}}});var zi=n.extend({_class:"PathFlattener",initialize:function(s,a,o,c,d){var f=[],b=[],y=0,L=1/(o||32),P=s._segments,x=P[0],E;function I(z,N){var F=Ce.getValues(z,N,d);f.push(F),T(F,z._index,0,1)}function T(z,N,F,D){if(D-F>L&&!(c&&Ce.isStraight(z))&&!Ce.isFlatEnough(z,a||.25)){var O=Ce.subdivide(z,.5),H=(F+D)/2;T(O[0],N,F,H),T(O[1],N,H,D)}else{var G=z[6]-z[0],K=z[7]-z[1],j=Math.sqrt(G*G+K*K);j>0&&(y+=j,b.push({offset:y,curve:z,index:N,time:D}))}}for(var M=1,V=P.length;M<V;M++)E=P[M],I(x,E),x=E;s._closed&&I(E||x,P[0]),this.curves=f,this.parts=b,this.length=y,this.index=0},_get:function(s){for(var a=this.parts,o=a.length,c,d=this.index;c=d,!(!d||a[--d].offset<s););for(;c<o;c++){var f=a[c];if(f.offset>=s){this.index=c;var b=a[c-1],y=b&&b.index===f.index?b.time:0,L=b?b.offset:0;return{index:f.index,time:y+(f.time-y)*(s-L)/(f.offset-L)}}}return{index:a[o-1].index,time:1}},drawPart:function(s,a,o){for(var c=this._get(a),d=this._get(o),f=c.index,b=d.index;f<=b;f++){var y=Ce.getPart(this.curves[f],f===c.index?c.time:0,f===d.index?d.time:1);f===c.index&&s.moveTo(y[0],y[1]),s.bezierCurveTo.apply(s,y.slice(2))}}},n.each(Ce._evaluateMethods,function(s){this[s+"At"]=function(a){var o=this._get(a);return Ce[s](this.curves[o.index],o.time)}},{})),Ki=n.extend({initialize:function(s){for(var a=this.points=[],o=s._segments,c=s._closed,d=0,f,b=o.length;d<b;d++){var y=o[d].point;(!f||!f.equals(y))&&a.push(f=y.clone())}c&&(a.unshift(a[a.length-1]),a.push(a[1])),this.closed=c},fit:function(s){var a=this.points,o=a.length,c=null;return o>0&&(c=[new Te(a[0])],o>1&&(this.fitCubic(c,s,0,o-1,a[1].subtract(a[0]),a[o-2].subtract(a[o-1])),this.closed&&(c.shift(),c.pop()))),c},fitCubic:function(s,a,o,c,d,f){var b=this.points;if(c-o===1){var y=b[o],L=b[c],P=y.getDistance(L)/3;this.addCurve(s,[y,y.add(d.normalize(P)),L.add(f.normalize(P)),L]);return}for(var x=this.chordLengthParameterize(o,c),E=Math.max(a,a*a),I,T=!0,M=0;M<=4;M++){var V=this.generateBezier(o,c,x,d,f),z=this.findMaxError(o,c,V,x);if(z.error<a&&T){this.addCurve(s,V);return}if(I=z.index,z.error>=E)break;T=this.reparameterize(o,c,x,V),E=z.error}var N=b[I-1].subtract(b[I+1]);this.fitCubic(s,a,o,I,d,N),this.fitCubic(s,a,I,c,N.negate(),f)},addCurve:function(s,a){var o=s[s.length-1];o.setHandleOut(a[1].subtract(a[0])),s.push(new Te(a[3],a[2].subtract(a[3])))},generateBezier:function(s,a,o,c,d){for(var f=1e-12,b=Math.abs,y=this.points,L=y[s],P=y[a],x=[[0,0],[0,0]],E=[0,0],I=0,T=a-s+1;I<T;I++){var M=o[I],V=1-M,z=3*M*V,N=V*V*V,F=z*V,D=z*M,O=M*M*M,H=c.normalize(F),G=d.normalize(D),K=y[s+I].subtract(L.multiply(N+F)).subtract(P.multiply(D+O));x[0][0]+=H.dot(H),x[0][1]+=H.dot(G),x[1][0]=x[0][1],x[1][1]+=G.dot(G),E[0]+=H.dot(K),E[1]+=G.dot(K)}var j=x[0][0]*x[1][1]-x[1][0]*x[0][1],J,ee;if(b(j)>f){var re=x[0][0]*E[1]-x[1][0]*E[0],ie=E[0]*x[1][1]-E[1]*x[0][1];J=ie/j,ee=re/j}else{var oe=x[0][0]+x[0][1],le=x[1][0]+x[1][1];J=ee=b(oe)>f?E[0]/oe:b(le)>f?E[1]/le:0}var pe=P.getDistance(L),be=f*pe,Le,Ne;if(J<be||ee<be)J=ee=pe/3;else{var He=P.subtract(L);Le=c.normalize(J),Ne=d.normalize(ee),Le.dot(He)-Ne.dot(He)>pe*pe&&(J=ee=pe/3,Le=Ne=null)}return[L,L.add(Le||c.normalize(J)),P.add(Ne||d.normalize(ee)),P]},reparameterize:function(s,a,o,c){for(var d=s;d<=a;d++)o[d-s]=this.findRoot(c,this.points[d],o[d-s]);for(var d=1,f=o.length;d<f;d++)if(o[d]<=o[d-1])return!1;return!0},findRoot:function(s,a,o){for(var c=[],d=[],f=0;f<=2;f++)c[f]=s[f+1].subtract(s[f]).multiply(3);for(var f=0;f<=1;f++)d[f]=c[f+1].subtract(c[f]).multiply(2);var b=this.evaluate(3,s,o),y=this.evaluate(2,c,o),L=this.evaluate(1,d,o),P=b.subtract(a),x=y.dot(y)+P.dot(L);return B.isMachineZero(x)?o:o-P.dot(y)/x},evaluate:function(s,a,o){for(var c=a.slice(),d=1;d<=s;d++)for(var f=0;f<=s-d;f++)c[f]=c[f].multiply(1-o).add(c[f+1].multiply(o));return c[0]},chordLengthParameterize:function(s,a){for(var o=[0],c=s+1;c<=a;c++)o[c-s]=o[c-s-1]+this.points[c].getDistance(this.points[c-1]);for(var c=1,d=a-s;c<=d;c++)o[c]/=o[d];return o},findMaxError:function(s,a,o,c){for(var d=Math.floor((a-s+1)/2),f=0,b=s+1;b<a;b++){var y=this.evaluate(3,o,c[b-s]),L=y.subtract(this.points[b]),P=L.x*L.x+L.y*L.y;P>=f&&(f=P,d=b)}return{error:f,index:d}}}),rt=se.extend({_class:"TextItem",_applyMatrix:!1,_canApplyMatrix:!1,_serializeFields:{content:null},_boundsOptions:{stroke:!1,handle:!1},initialize:function(a){this._content="",this._lines=[];var o=a&&n.isPlainObject(a)&&a.x===t&&a.y===t;this._initialize(o&&a,!o&&k.read(arguments))},_equals:function(s){return this._content===s._content},copyContent:function(s){this.setContent(s._content)},getContent:function(){return this._content},setContent:function(s){this._content=""+s,this._lines=this._content.split(/\r\n|\n|\r/mg),this._changed(521)},isEmpty:function(){return!this._content},getCharacterStyle:"#getStyle",setCharacterStyle:"#setStyle",getParagraphStyle:"#getStyle",setParagraphStyle:"#setStyle"}),Li=rt.extend({_class:"PointText",initialize:function(){rt.apply(this,arguments)},getPoint:function(){var s=this._matrix.getTranslation();return new Q(s.x,s.y,this,"setPoint")},setPoint:function(){var s=k.read(arguments);this.translate(s.subtract(this._matrix.getTranslation()))},_draw:function(s,a,o){if(this._content){this._setStyles(s,a,o);var c=this._lines,d=this._style,f=d.hasFill(),b=d.hasStroke(),y=d.getLeading(),L=s.shadowColor;s.font=d.getFontStyle(),s.textAlign=d.getJustification();for(var P=0,x=c.length;P<x;P++){s.shadowColor=L;var E=c[P];f&&(s.fillText(E,0,0),s.shadowColor="rgba(0,0,0,0)"),b&&s.strokeText(E,0,0),s.translate(0,y)}}},_getBounds:function(s,a){var o=this._style,c=this._lines,d=c.length,f=o.getJustification(),b=o.getLeading(),y=this.getView().getTextWidth(o.getFontStyle(),c),L=0;f!=="left"&&(L-=y/(f==="center"?2:1));var P=new Z(L,d?-.75*b:0,y,d*b);return s?s._transformBounds(P,P):P}}),Qt=n.extend(new function(){var s={gray:["gray"],rgb:["red","green","blue"],hsb:["hue","saturation","brightness"],hsl:["hue","saturation","lightness"],gradient:["gradient","origin","destination","highlight"]},a={},o={transparent:[0,0,0,0]},c;function d(y){var L=y.match(/^#([\da-f]{2})([\da-f]{2})([\da-f]{2})([\da-f]{2})?$/i)||y.match(/^#([\da-f])([\da-f])([\da-f])([\da-f])?$/i),P="rgb",x;if(L){var E=L[4]?4:3;x=new Array(E);for(var I=0;I<E;I++){var T=L[I+1];x[I]=parseInt(T.length==1?T+T:T,16)/255}}else if(L=y.match(/^(rgb|hsl)a?\((.*)\)$/)){P=L[1],x=L[2].trim().split(/[,\s]+/g);for(var M=P==="hsl",I=0,V=Math.min(x.length,4);I<V;I++){var z=x[I],T=parseFloat(z);if(M)if(I===0){var N=z.match(/([a-z]*)$/)[1];T*={turn:360,rad:180/Math.PI,grad:.9}[N]||1}else I<3&&(T/=100);else I<3&&(T/=/%$/.test(z)?100:255);x[I]=T}}else{var F=o[y];if(!F)if(e){c||(c=Ci.getContext(1,1,{willReadFrequently:!0}),c.globalCompositeOperation="copy"),c.fillStyle="rgba(0,0,0,0)",c.fillStyle=y,c.fillRect(0,0,1,1);var D=c.getImageData(0,0,1,1).data;F=o[y]=[D[0]/255,D[1]/255,D[2]/255]}else F=[0,0,0];x=F.slice()}return[P,x]}var f=[[0,3,1],[2,0,1],[1,0,3],[1,2,0],[3,1,0],[0,1,2]],b={"rgb-hsb":function(y,L,P){var x=Math.max(y,L,P),E=Math.min(y,L,P),I=x-E,T=I===0?0:(x==y?(L-P)/I+(L<P?6:0):x==L?(P-y)/I+2:(y-L)/I+4)*60;return[T,x===0?0:I/x,x]},"hsb-rgb":function(y,L,P){y=(y/60%6+6)%6;var E=Math.floor(y),x=y-E,E=f[E],I=[P,P*(1-L),P*(1-L*x),P*(1-L*(1-x))];return[I[E[0]],I[E[1]],I[E[2]]]},"rgb-hsl":function(y,L,P){var x=Math.max(y,L,P),E=Math.min(y,L,P),I=x-E,T=I===0,M=T?0:(x==y?(L-P)/I+(L<P?6:0):x==L?(P-y)/I+2:(y-L)/I+4)*60,V=(x+E)/2,z=T?0:V<.5?I/(x+E):I/(2-x-E);return[M,z,V]},"hsl-rgb":function(y,L,P){if(y=(y/360%1+1)%1,L===0)return[P,P,P];for(var x=[y+1/3,y,y-1/3],E=P<.5?P*(1+L):P+L-P*L,I=2*P-E,T=[],M=0;M<3;M++){var V=x[M];V<0&&(V+=1),V>1&&(V-=1),T[M]=6*V<1?I+(E-I)*6*V:2*V<1?E:3*V<2?I+(E-I)*(2/3-V)*6:I}return T},"rgb-gray":function(y,L,P){return[y*.2989+L*.587+P*.114]},"gray-rgb":function(y){return[y,y,y]},"gray-hsb":function(y){return[0,0,y]},"gray-hsl":function(y){return[0,0,y]},"gradient-rgb":function(){return[]},"rgb-gradient":function(){return[]}};return n.each(s,function(y,L){a[L]=[],n.each(y,function(P,x){var E=n.capitalize(P),I=/^(hue|saturation)$/.test(P),T=a[L][x]=L==="gradient"?P==="gradient"?function(M){var V=this._components[0];return M=Ri.read(Array.isArray(M)?M:arguments,0,{readNull:!0}),V!==M&&(V&&V._removeOwner(this),M&&M._addOwner(this)),M}:function(){return k.read(arguments,0,{readNull:P==="highlight",clone:!0})}:function(M){return M==null||isNaN(M)?0:+M};this["get"+E]=function(){return this._type===L||I&&/^hs[bl]$/.test(this._type)?this._components[x]:this._convert(L)[x]},this["set"+E]=function(M){this._type!==L&&!(I&&/^hs[bl]$/.test(this._type))&&(this._components=this._convert(L),this._properties=s[L],this._type=L),this._components[x]=T.call(this,M),this._changed()}},this)},{_class:"Color",_readIndex:!0,initialize:function y(L){var P=arguments,x=this.__read,E=0,I,T,M,V;Array.isArray(L)&&(P=L,L=P[0]);var z=L!=null&&typeof L;if(z==="string"&&L in s&&(I=L,L=P[1],Array.isArray(L)?(T=L,M=P[2]):(x&&(E=1),P=n.slice(P,1),z=typeof L)),!T){if(V=z==="number"?P:z==="object"&&L.length!=null?L:null,V){I||(I=V.length>=3?"rgb":"gray");var N=s[I].length;M=V[N],x&&(E+=V===arguments?N+(M!=null?1:0):1),V.length>N&&(V=n.slice(V,0,N))}else if(z==="string"){var F=d(L);I=F[0],T=F[1],T.length===4&&(M=T[3],T.length--)}else if(z==="object")if(L.constructor===y){if(I=L._type,T=L._components.slice(),M=L._alpha,I==="gradient")for(var D=1,O=T.length;D<O;D++){var H=T[D];H&&(T[D]=H.clone())}}else if(L.constructor===Ri)I="gradient",V=P;else{I="hue"in L?"lightness"in L?"hsl":"hsb":"gradient"in L||"stops"in L||"radial"in L?"gradient":"gray"in L?"gray":"rgb";var G=s[I],K=a[I];this._components=T=[];for(var D=0,O=G.length;D<O;D++){var j=L[G[D]];j==null&&!D&&I==="gradient"&&"stops"in L&&(j={stops:L.stops,radial:L.radial}),j=K[D].call(this,j),j!=null&&(T[D]=j)}M=L.alpha}x&&I&&(E=1)}if(this._type=I||"rgb",!T){this._components=T=[];for(var K=a[this._type],D=0,O=K.length;D<O;D++){var j=K[D].call(this,V&&V[D]);j!=null&&(T[D]=j)}}return this._components=T,this._properties=s[this._type],this._alpha=M,x&&(this.__read=E),this},set:"#initialize",_serialize:function(y,L){var P=this.getComponents();return n.serialize(/^(gray|rgb)$/.test(this._type)?P:[this._type].concat(P),y,!0,L)},_changed:function(){this._canvasStyle=null,this._owner&&(this._setter?this._owner[this._setter](this):this._owner._changed(129))},_convert:function(y){var L;return this._type===y?this._components.slice():(L=b[this._type+"-"+y])?L.apply(this,this._components):b["rgb-"+y].apply(this,b[this._type+"-rgb"].apply(this,this._components))},convert:function(y){return new Qt(y,this._convert(y),this._alpha)},getType:function(){return this._type},setType:function(y){this._components=this._convert(y),this._properties=s[y],this._type=y},getComponents:function(){var y=this._components.slice();return this._alpha!=null&&y.push(this._alpha),y},getAlpha:function(){return this._alpha!=null?this._alpha:1},setAlpha:function(y){this._alpha=y==null?null:Math.min(Math.max(y,0),1),this._changed()},hasAlpha:function(){return this._alpha!=null},equals:function(y){var L=n.isPlainValue(y,!0)?Qt.read(arguments):y;return L===this||L&&this._class===L._class&&this._type===L._type&&this.getAlpha()===L.getAlpha()&&n.equals(this._components,L._components)||!1},toString:function(){for(var y=this._properties,L=[],P=this._type==="gradient",x=C.instance,E=0,I=y.length;E<I;E++){var T=this._components[E];T!=null&&L.push(y[E]+": "+(P?T:x.number(T)))}return this._alpha!=null&&L.push("alpha: "+x.number(this._alpha)),"{ "+L.join(", ")+" }"},toCSS:function(y){var L=this._convert("rgb"),P=y||this._alpha==null?1:this._alpha;function x(E){return Math.round((E<0?0:E>1?1:E)*255)}return L=[x(L[0]),x(L[1]),x(L[2])],P<1&&L.push(P<0?0:P),y?"#"+((1<<24)+(L[0]<<16)+(L[1]<<8)+L[2]).toString(16).slice(1):(L.length==4?"rgba(":"rgb(")+L.join(",")+")"},toCanvasStyle:function(y,L){if(this._canvasStyle)return this._canvasStyle;if(this._type!=="gradient")return this._canvasStyle=this.toCSS();var P=this._components,x=P[0],E=x._stops,I=P[1],T=P[2],M=P[3],V=L&&L.inverted(),z;if(V&&(I=V._transformPoint(I),T=V._transformPoint(T),M&&(M=V._transformPoint(M))),x._radial){var N=T.getDistance(I);if(M){var F=M.subtract(I);F.getLength()>N&&(M=I.add(F.normalize(N-.1)))}var D=M||I;z=y.createRadialGradient(D.x,D.y,0,I.x,I.y,N)}else z=y.createLinearGradient(I.x,I.y,T.x,T.y);for(var O=0,H=E.length;O<H;O++){var G=E[O],K=G._offset;z.addColorStop(K??O/(H-1),G._color.toCanvasStyle())}return this._canvasStyle=z},transform:function(y){if(this._type==="gradient"){for(var L=this._components,P=1,x=L.length;P<x;P++){var E=L[P];y._transformPoint(E,E,!0)}this._changed()}},statics:{_types:s,random:function(){var y=Math.random;return new Qt(y(),y(),y())},_setOwner:function(y,L,P){return y&&(y._owner&&L&&y._owner!==L&&(y=y.clone()),!y._owner^!L&&(y._owner=L||null,y._setter=P||null)),y}}})},new function(){var s={add:function(a,o){return a+o},subtract:function(a,o){return a-o},multiply:function(a,o){return a*o},divide:function(a,o){return a/o}};return n.each(s,function(a,o){this[o]=function(c){c=Qt.read(arguments);for(var d=this._type,f=this._components,b=c._convert(d),y=0,L=f.length;y<L;y++)b[y]=a(f[y],b[y]);return new Qt(d,b,this._alpha!=null?a(this._alpha,c.getAlpha()):null)}},{})}),Ri=n.extend({_class:"Gradient",initialize:function(a,o){this._id=U.get(),a&&n.isPlainObject(a)&&(this.set(a),a=o=null),this._stops==null&&this.setStops(a||["white","black"]),this._radial==null&&this.setRadial(typeof o=="string"&&o==="radial"||o||!1)},_serialize:function(s,a){return a.add(this,function(){return n.serialize([this._stops,this._radial],s,!0,a)})},_changed:function(){for(var s=0,a=this._owners&&this._owners.length;s<a;s++)this._owners[s]._changed()},_addOwner:function(s){this._owners||(this._owners=[]),this._owners.push(s)},_removeOwner:function(s){var a=this._owners?this._owners.indexOf(s):-1;a!=-1&&(this._owners.splice(a,1),this._owners.length||(this._owners=t))},clone:function(){for(var s=[],a=0,o=this._stops.length;a<o;a++)s[a]=this._stops[a].clone();return new Ri(s,this._radial)},getStops:function(){return this._stops},setStops:function(s){if(s.length<2)throw new Error("Gradient stop list needs to contain at least two stops.");var a=this._stops;if(a)for(var o=0,c=a.length;o<c;o++)a[o]._owner=t;a=this._stops=us.readList(s,0,{clone:!0});for(var o=0,c=a.length;o<c;o++)a[o]._owner=this;this._changed()},getRadial:function(){return this._radial},setRadial:function(s){this._radial=s,this._changed()},equals:function(s){if(s===this)return!0;if(s&&this._class===s._class){var a=this._stops,o=s._stops,c=a.length;if(c===o.length){for(var d=0;d<c;d++)if(!a[d].equals(o[d]))return!1;return!0}}return!1}}),us=n.extend({_class:"GradientStop",initialize:function(a,o){var c=a,d=o;typeof a=="object"&&o===t&&(Array.isArray(a)&&typeof a[0]!="number"?(c=a[0],d=a[1]):("color"in a||"offset"in a||"rampPoint"in a)&&(c=a.color,d=a.offset||a.rampPoint||0)),this.setColor(c),this.setOffset(d)},clone:function(){return new us(this._color.clone(),this._offset)},_serialize:function(s,a){var o=this._color,c=this._offset;return n.serialize(c==null?[o]:[o,c],s,!0,a)},_changed:function(){this._owner&&this._owner._changed(129)},getOffset:function(){return this._offset},setOffset:function(s){this._offset=s,this._changed()},getRampPoint:"#getOffset",setRampPoint:"#setOffset",getColor:function(){return this._color},setColor:function(){Qt._setOwner(this._color,null),this._color=Qt._setOwner(Qt.read(arguments,0),this,"setColor"),this._changed()},equals:function(s){return s===this||s&&this._class===s._class&&this._color.equals(s._color)&&this._offset==s._offset||!1}}),sn=n.extend(new function(){var s={fillColor:null,fillRule:"nonzero",strokeColor:null,strokeWidth:1,strokeCap:"butt",strokeJoin:"miter",strokeScaling:!0,miterLimit:10,dashOffset:0,dashArray:[],shadowColor:null,shadowBlur:0,shadowOffset:new k,selectedColor:null},a=n.set({},s,{fontFamily:"sans-serif",fontWeight:"normal",fontSize:12,leading:null,justification:"left"}),o=n.set({},a,{fillColor:new Qt}),c={strokeWidth:193,strokeCap:193,strokeJoin:193,strokeScaling:201,miterLimit:193,fontFamily:9,fontWeight:9,fontSize:9,font:9,leading:9,justification:9},d={beans:!0},f={_class:"Style",beans:!0,initialize:function(y,L,P){this._values={},this._owner=L,this._project=L&&L._project||P||kt.project,this._defaults=!L||L instanceof fe?a:L instanceof rt?o:s,y&&this.set(y)}};return n.each(a,function(b,y){var L=/Color$/.test(y),P=y==="shadowOffset",x=n.capitalize(y),E=c[y],I="set"+x,T="get"+x;f[I]=function(M){var V=this._owner,z=V&&V._children,N=z&&z.length>0&&!(V instanceof Xe);if(N)for(var F=0,D=z.length;F<D;F++)z[F]._style[I](M);if((y==="selectedColor"||!N)&&y in this._defaults){var O=this._values[y];O!==M&&(L&&(O&&(Qt._setOwner(O,null),O._canvasStyle=null),M&&M.constructor===Qt&&(M=Qt._setOwner(M,V,N&&I))),this._values[y]=M,V&&V._changed(E||129))}},f[T]=function(M){var V=this._owner,z=V&&V._children,N=z&&z.length>0&&!(V instanceof Xe),F;if(N&&!M)for(var D=0,O=z.length;D<O;D++){var H=z[D]._style[T]();if(!D)F=H;else if(!n.equals(F,H))return t}else if(y in this._defaults){var F=this._values[y];if(F===t)F=this._defaults[y],F&&F.clone&&(F=F.clone());else{var G=L?Qt:P?k:null;G&&!(F&&F.constructor===G)&&(this._values[y]=F=G.read([F],0,{readNull:!0,clone:!0}))}}return F&&L&&(F=Qt._setOwner(F,V,N&&I)),F},d[T]=function(M){return this._style[T](M)},d[I]=function(M){this._style[I](M)}}),n.each({Font:"FontFamily",WindingRule:"FillRule"},function(b,y){var L="get"+y,P="set"+y;f[L]=d[L]="#get"+b,f[P]=d[P]="#set"+b}),se.inject(d),f},{set:function(s){var a=s instanceof sn,o=a?s._values:s;if(o){for(var c in o)if(c in this._defaults){var d=o[c];this[c]=d&&a&&d.clone?d.clone():d}}},equals:function(s){function a(o,c,d){var f=o._values,b=c._values,y=c._defaults;for(var L in f){var P=f[L],x=b[L];if(!(d&&L in b)&&!n.equals(P,x===t?y[L]:x))return!1}return!0}return s===this||s&&this._class===s._class&&a(this,s)&&a(s,this,!0)||!1},_dispose:function(){var s;s=this.getFillColor(),s&&(s._canvasStyle=null),s=this.getStrokeColor(),s&&(s._canvasStyle=null),s=this.getShadowColor(),s&&(s._canvasStyle=null)},hasFill:function(){var s=this.getFillColor();return!!s&&s.alpha>0},hasStroke:function(){var s=this.getStrokeColor();return!!s&&s.alpha>0&&this.getStrokeWidth()>0},hasShadow:function(){var s=this.getShadowColor();return!!s&&s.alpha>0&&(this.getShadowBlur()>0||!this.getShadowOffset().isZero())},getView:function(){return this._project._view},getFontStyle:function(){var s=this.getFontSize();return this.getFontWeight()+" "+s+(/[a-z]/i.test(s+"")?" ":"px ")+this.getFontFamily()},getFont:"#getFontFamily",setFont:"#setFontFamily",getLeading:function s(){var a=s.base.call(this),o=this.getFontSize();return/pt|em|%|px/.test(o)&&(o=this.getView().getPixelSize(o)),a??o*1.2}}),Vt=new function(){function s(a,o,c,d){for(var f=["","webkit","moz","Moz","ms","o"],b=o[0].toUpperCase()+o.substring(1),y=0;y<6;y++){var L=f[y],P=L?L+b:o;if(P in a){if(c)a[P]=d;else return a[P];break}}}return{getStyles:function(a){var o=a&&a.nodeType!==9?a.ownerDocument:a,c=o&&o.defaultView;return c&&c.getComputedStyle(a,"")},getBounds:function(a,o){var c=a.ownerDocument,d=c.body,f=c.documentElement,b;try{b=a.getBoundingClientRect()}catch{b={left:0,top:0,width:0,height:0}}var y=b.left-(f.clientLeft||d.clientLeft||0),L=b.top-(f.clientTop||d.clientTop||0);if(!o){var P=c.defaultView;y+=P.pageXOffset||f.scrollLeft||d.scrollLeft,L+=P.pageYOffset||f.scrollTop||d.scrollTop}return new Z(y,L,b.width,b.height)},getViewportBounds:function(a){var o=a.ownerDocument,c=o.defaultView,d=o.documentElement;return new Z(0,0,c.innerWidth||d.clientWidth,c.innerHeight||d.clientHeight)},getOffset:function(a,o){return Vt.getBounds(a,o).getPoint()},getSize:function(a){return Vt.getBounds(a,!0).getSize()},isInvisible:function(a){return Vt.getSize(a).equals(new X(0,0))},isInView:function(a){return!Vt.isInvisible(a)&&Vt.getViewportBounds(a).intersects(Vt.getBounds(a,!0))},isInserted:function(a){return i.body.contains(a)},getPrefixed:function(a,o){return a&&s(a,o)},setPrefixed:function(a,o,c){if(typeof o=="object")for(var d in o)s(a,d,!0,o[d]);else s(a,o,!0,c)}}},hi={add:function(s,a){if(s)for(var o in a)for(var c=a[o],d=o.split(/[\s,]+/g),f=0,b=d.length;f<b;f++){var y=d[f],L=s===i&&(y==="touchstart"||y==="touchmove")?{passive:!1}:!1;s.addEventListener(y,c,L)}},remove:function(s,a){if(s)for(var o in a)for(var c=a[o],d=o.split(/[\s,]+/g),f=0,b=d.length;f<b;f++)s.removeEventListener(d[f],c,!1)},getPoint:function(s){var a=s.targetTouches?s.targetTouches.length?s.targetTouches[0]:s.changedTouches[0]:s;return new k(a.pageX||a.clientX+i.documentElement.scrollLeft,a.pageY||a.clientY+i.documentElement.scrollTop)},getTarget:function(s){return s.target||s.srcElement},getRelatedTarget:function(s){return s.relatedTarget||s.toElement},getOffset:function(s,a){return hi.getPoint(s).subtract(Vt.getOffset(a||hi.getTarget(s)))}};hi.requestAnimationFrame=new function(){var s=Vt.getPrefixed(e,"requestAnimationFrame"),a=!1,o=[],c;function d(){var f=o;o=[];for(var b=0,y=f.length;b<y;b++)f[b]();a=s&&o.length,a&&s(d)}return function(f){o.push(f),s?a||(s(d),a=!0):c||(c=setInterval(d,1e3/60))}};var ni=n.extend(r,{_class:"View",initialize:function s(a,o){function c(E){return o[E]||parseInt(o.getAttribute(E),10)}function d(){var E=Vt.getSize(o);return E.isNaN()||E.isZero()?new X(c("width"),c("height")):E}var f;if(window&&o){this._id=o.getAttribute("id"),this._id==null&&o.setAttribute("id",this._id="paper-view-"+s._id++),hi.add(o,this._viewEvents);var b="none";if(Vt.setPrefixed(o.style,{userDrag:b,userSelect:b,touchCallout:b,contentZooming:b,tapHighlightColor:"rgba(0,0,0,0)"}),h.hasAttribute(o,"resize")){var y=this;hi.add(e,this._windowEvents={resize:function(){y.setViewSize(d())}})}if(f=d(),h.hasAttribute(o,"stats")&&typeof Stats<"u"){this._stats=new Stats;var L=this._stats.domElement,P=L.style,x=Vt.getOffset(o);P.position="absolute",P.left=x.x+"px",P.top=x.y+"px",i.body.appendChild(L)}}else f=new X(o),o=null;this._project=a,this._scope=a._scope,this._element=o,this._pixelRatio||(this._pixelRatio=e&&e.devicePixelRatio||1),this._setElementSize(f.width,f.height),this._viewSize=f,s._views.push(this),s._viewsById[this._id]=this,(this._matrix=new ye)._owner=this,s._focused||(s._focused=this),this._frameItems={},this._frameItemCount=0,this._itemEvents={native:{},virtual:{}},this._autoUpdate=!kt.agent.node,this._needsUpdate=!1},remove:function(){if(!this._project)return!1;ni._focused===this&&(ni._focused=null),ni._views.splice(ni._views.indexOf(this),1),delete ni._viewsById[this._id];var s=this._project;return s._view===this&&(s._view=null),hi.remove(this._element,this._viewEvents),hi.remove(e,this._windowEvents),this._element=this._project=null,this.off("frame"),this._animate=!1,this._frameItems={},!0},_events:n.each(se._itemHandlers.concat(["onResize","onKeyDown","onKeyUp"]),function(s){this[s]={}},{onFrame:{install:function(){this.play()},uninstall:function(){this.pause()}}}),_animate:!1,_time:0,_count:0,getAutoUpdate:function(){return this._autoUpdate},setAutoUpdate:function(s){this._autoUpdate=s,s&&this.requestUpdate()},update:function(){},draw:function(){this.update()},requestUpdate:function(){if(!this._requested){var s=this;hi.requestAnimationFrame(function(){if(s._requested=!1,s._animate){s.requestUpdate();var a=s._element;(!Vt.getPrefixed(i,"hidden")||h.getAttribute(a,"keepalive")==="true")&&Vt.isInView(a)&&s._handleFrame()}s._autoUpdate&&s.update()}),this._requested=!0}},play:function(){this._animate=!0,this.requestUpdate()},pause:function(){this._animate=!1},_handleFrame:function(){kt=this._scope;var s=Date.now()/1e3,a=this._last?s-this._last:0;this._last=s,this.emit("frame",new n({delta:a,time:this._time+=a,count:this._count++})),this._stats&&this._stats.update()},_animateItem:function(s,a){var o=this._frameItems;a?(o[s._id]={item:s,time:0,count:0},++this._frameItemCount===1&&this.on("frame",this._handleFrameItems)):(delete o[s._id],--this._frameItemCount===0&&this.off("frame",this._handleFrameItems))},_handleFrameItems:function(s){for(var a in this._frameItems){var o=this._frameItems[a];o.item.emit("frame",new n(s,{time:o.time+=s.delta,count:o.count++}))}},_changed:function(){this._project._changed(4097),this._bounds=this._decomposed=t},getElement:function(){return this._element},getPixelRatio:function(){return this._pixelRatio},getResolution:function(){return this._pixelRatio*72},getViewSize:function(){var s=this._viewSize;return new g(s.width,s.height,this,"setViewSize")},setViewSize:function(){var s=X.read(arguments),a=s.subtract(this._viewSize);a.isZero()||(this._setElementSize(s.width,s.height),this._viewSize.set(s),this._changed(),this.emit("resize",{size:s,delta:a}),this._autoUpdate&&this.update())},_setElementSize:function(s,a){var o=this._element;o&&(o.width!==s&&(o.width=s),o.height!==a&&(o.height=a))},getBounds:function(){return this._bounds||(this._bounds=this._matrix.inverted()._transformBounds(new Z(new k,this._viewSize))),this._bounds},getSize:function(){return this.getBounds().getSize()},isVisible:function(){return Vt.isInView(this._element)},isInserted:function(){return Vt.isInserted(this._element)},getPixelSize:function(s){var a=this._element,o;if(a){var c=a.parentNode,d=i.createElement("div");d.style.fontSize=s,c.appendChild(d),o=parseFloat(Vt.getStyles(d).fontSize),c.removeChild(d)}else o=parseFloat(o);return o},getTextWidth:function(s,a){return 0}},n.each(["rotate","scale","shear","skew"],function(s){var a=s==="rotate";this[s]=function(){var o=arguments,c=(a?n:k).read(o),d=k.read(o,0,{readNull:!0});return this.transform(new ye()[s](c,d||this.getCenter(!0)))}},{_decompose:function(){return this._decomposed||(this._decomposed=this._matrix.decompose())},translate:function(){var s=new ye;return this.transform(s.translate.apply(s,arguments))},getCenter:function(){return this.getBounds().getCenter()},setCenter:function(){var s=k.read(arguments);this.translate(this.getCenter().subtract(s))},getZoom:function(){var s=this._decompose().scaling;return(s.x+s.y)/2},setZoom:function(s){this.transform(new ye().scale(s/this.getZoom(),this.getCenter()))},getRotation:function(){return this._decompose().rotation},setRotation:function(s){var a=this.getRotation();a!=null&&s!=null&&this.rotate(s-a)},getScaling:function(){var s=this._decompose().scaling;return new Q(s.x,s.y,this,"setScaling")},setScaling:function(){var s=this.getScaling(),a=k.read(arguments,0,{clone:!0,readNull:!0});s&&a&&this.scale(a.x/s.x,a.y/s.y)},getMatrix:function(){return this._matrix},setMatrix:function(){var s=this._matrix;s.set.apply(s,arguments)},transform:function(s){this._matrix.append(s)},scrollBy:function(){this.translate(k.read(arguments).negate())}}),{projectToView:function(){return this._matrix._transformPoint(k.read(arguments))},viewToProject:function(){return this._matrix._inverseTransform(k.read(arguments))},getEventPoint:function(s){return this.viewToProject(hi.getOffset(s,this._element))}},{statics:{_views:[],_viewsById:{},_id:0,create:function(s,a){i&&typeof a=="string"&&(a=i.getElementById(a));var o=e?vn:ni;return new o(s,a)}}},new function(){if(!e)return;var s,a,o=!1,c=!1;function d(ie){var oe=hi.getTarget(ie);return oe.getAttribute&&ni._viewsById[oe.getAttribute("id")]}function f(){var ie=ni._focused;if(!ie||!ie.isVisible()){for(var oe=0,le=ni._views.length;oe<le;oe++)if((ie=ni._views[oe]).isVisible()){ni._focused=a=ie;break}}}function b(ie,oe,le){ie._handleMouseEvent("mousemove",oe,le)}var y=e.navigator,L,P,x;y.pointerEnabled||y.msPointerEnabled?(L="pointerdown MSPointerDown",P="pointermove MSPointerMove",x="pointerup pointercancel MSPointerUp MSPointerCancel"):(L="touchstart",P="touchmove",x="touchend touchcancel","ontouchstart"in e&&y.userAgent.match(/mobile|tablet|ip(ad|hone|od)|android|silk/i)||(L+=" mousedown",P+=" mousemove",x+=" mouseup"));var E={},I={mouseout:function(ie){var oe=ni._focused,le=hi.getRelatedTarget(ie);if(oe&&(!le||le.nodeName==="HTML")){var pe=hi.getOffset(ie,oe._element),be=pe.x,Le=Math.abs,Ne=Le(be),He=1<<25,Ue=Ne-He;pe.x=Le(Ue)<Ne?Ue*(be<0?-1:1):be,b(oe,ie,oe.viewToProject(pe))}},scroll:f};E[L]=function(ie){var oe=ni._focused=d(ie);o||(o=!0,oe._handleMouseEvent("mousedown",ie))},I[P]=function(ie){var oe=ni._focused;if(!c){var le=d(ie);le?oe!==le&&(oe&&b(oe,ie),s||(s=oe),oe=ni._focused=a=le):a&&a===oe&&(s&&!s.isInserted()&&(s=null),oe=ni._focused=s,s=null,f())}oe&&b(oe,ie)},I[L]=function(){c=!0},I[x]=function(ie){var oe=ni._focused;oe&&o&&oe._handleMouseEvent("mouseup",ie),c=o=!1},hi.add(i,I),hi.add(e,{load:f});var T=!1,M=!1,V={doubleclick:"click",mousedrag:"mousemove"},z=!1,N,F,D,O,H,G,K,j;function J(ie,oe,le,pe,be,Le,Ne){var He=!1,Ue;function nt(et,tt){if(et.responds(tt)){if(Ue||(Ue=new $o(tt,pe,be,oe||et,Le?be.subtract(Le):null)),et.emit(tt,Ue)&&(T=!0,Ue.prevented&&(M=!0),Ue.stopped))return He=!0}else{var Je=V[tt];if(Je)return nt(et,Je)}}for(;ie&&ie!==Ne&&!nt(ie,le);)ie=ie._parent;return He}function ee(ie,oe,le,pe,be,Le){return ie._project.removeOn(le),M=T=!1,H&&J(H,null,le,pe,be,Le)||oe&&oe!==H&&!oe.isDescendant(H)&&J(oe,null,le==="mousedrag"?"mousemove":le,pe,be,Le,H)||J(ie,H||oe||ie,le,pe,be,Le)}var re={mousedown:{mousedown:1,mousedrag:1,click:1,doubleclick:1},mouseup:{mouseup:1,mousedrag:1,click:1,doubleclick:1},mousemove:{mousedrag:1,mousemove:1,mouseenter:1,mouseleave:1}};return{_viewEvents:E,_handleMouseEvent:function(ie,oe,le){var pe=this._itemEvents,be=pe.native[ie],Le=ie==="mousemove",Ne=this._scope.tool,He=this;function Ue(Ut){return pe.virtual[Ut]||He.responds(Ut)||Ne&&Ne.responds(Ut)}Le&&o&&Ue("mousedrag")&&(ie="mousedrag"),le||(le=this.getEventPoint(oe));var nt=this.getBounds().contains(le),et=be&&nt&&He._project.hitTest(le,{tolerance:0,fill:!0,stroke:!0}),tt=et&&et.item||null,Je=!1,ct={};if(ct[ie.substr(5)]=!0,be&&tt!==O&&(O&&J(O,null,"mouseleave",oe,le),tt&&J(tt,null,"mouseenter",oe,le),O=tt),z^nt&&(J(this,null,nt?"mouseenter":"mouseleave",oe,le),Je=!0),(nt||ct.drag)&&!le.equals(F)&&(ee(this,tt,Le?ie:"mousemove",oe,le,F),Je=!0),z=nt,ct.down&&nt||ct.up&&N){if(ee(this,tt,ie,oe,le,N),ct.down){if(j=tt===G&&Date.now()-K<300,D=G=tt,!M&&tt){for(var at=tt;at&&!at.responds("mousedrag");)at=at._parent;at&&(H=tt)}N=le}else ct.up&&(!M&&tt===D&&(K=Date.now(),ee(this,tt,j?"doubleclick":"click",oe,le,N),j=!1),D=H=null);z=!1,Je=!0}F=le,Je&&Ne&&(T=Ne._handleMouseEvent(ie,oe,le,ct)||T),oe.cancelable!==!1&&(T&&!ct.move||ct.down&&Ue("mouseup"))&&oe.preventDefault()},_handleKeyEvent:function(ie,oe,le,pe){var be=this._scope,Le=be.tool,Ne;function He(Ue){Ue.responds(ie)&&(kt=be,Ue.emit(ie,Ne=Ne||new wa(ie,oe,le,pe)))}this.isVisible()&&(He(this),Le&&Le.responds(ie)&&He(Le))},_countItemEvent:function(ie,oe){var le=this._itemEvents,pe=le.native,be=le.virtual;for(var Le in re)pe[Le]=(pe[Le]||0)+(re[Le][ie]||0)*oe;be[ie]=(be[ie]||0)+oe},statics:{updateFocus:f,_resetState:function(){o=c=T=z=!1,s=a=N=F=D=O=H=G=K=j=null}}}}),vn=ni.extend({_class:"CanvasView",initialize:function(a,o){if(!(o instanceof e.HTMLCanvasElement)){var c=X.read(arguments,1);if(c.isZero())throw new Error("Cannot create CanvasView with the provided argument: "+n.slice(arguments,1));o=Ci.getCanvas(c)}var d=this._context=o.getContext("2d");if(d.save(),this._pixelRatio=1,!/^off|false$/.test(h.getAttribute(o,"hidpi"))){var f=e.devicePixelRatio||1,b=Vt.getPrefixed(d,"backingStorePixelRatio")||1;this._pixelRatio=f/b}ni.call(this,a,o),this._needsUpdate=!0},remove:function s(){return this._context.restore(),s.base.call(this)},_setElementSize:function s(a,o){var c=this._pixelRatio;if(s.base.call(this,a*c,o*c),c!==1){var d=this._element,f=this._context;if(!h.hasAttribute(d,"resize")){var b=d.style;b.width=a+"px",b.height=o+"px"}f.restore(),f.save(),f.scale(c,c)}},getContext:function(){return this._context},getPixelSize:function s(a){var o=kt.agent,c;if(o&&o.firefox)c=s.base.call(this,a);else{var d=this._context,f=d.font;d.font=a+" serif",c=parseFloat(d.font),d.font=f}return c},getTextWidth:function(s,a){var o=this._context,c=o.font,d=0;o.font=s;for(var f=0,b=a.length;f<b;f++)d=Math.max(d,o.measureText(a[f]).width);return o.font=c,d},update:function(){if(!this._needsUpdate)return!1;var s=this._project,a=this._context,o=this._viewSize;return a.clearRect(0,0,o.width+1,o.height+1),s&&s.draw(a,this._matrix,this._pixelRatio),this._needsUpdate=!1,!0}}),nn=n.extend({_class:"Event",initialize:function(a){this.event=a,this.type=a&&a.type},prevented:!1,stopped:!1,preventDefault:function(){this.prevented=!0,this.event.preventDefault()},stopPropagation:function(){this.stopped=!0,this.event.stopPropagation()},stop:function(){this.stopPropagation(),this.preventDefault()},getTimeStamp:function(){return this.event.timeStamp},getModifiers:function(){return pr.modifiers}}),wa=nn.extend({_class:"KeyEvent",initialize:function(a,o,c,d){this.type=a,this.event=o,this.key=c,this.character=d},toString:function(){return"{ type: '"+this.type+"', key: '"+this.key+"', character: '"+this.character+"', modifiers: "+this.getModifiers()+" }"}}),pr=new function(){var s={"	":"tab"," ":"space","\b":"backspace","":"delete",Spacebar:"space",Del:"delete",Win:"meta",Esc:"escape"},a={tab:"	",space:" ",enter:"\r"},o={},c={},d,f,b=new n({shift:!1,control:!1,alt:!1,meta:!1,capsLock:!1,space:!1}).inject({option:{get:function(){return this.alt}},command:{get:function(){var P=kt&&kt.agent;return P&&P.mac?this.meta:this.control}}});function y(P){var x=P.key||P.keyIdentifier;return x=/^U\+/.test(x)?String.fromCharCode(parseInt(x.substr(2),16)):/^Arrow[A-Z]/.test(x)?x.substr(5):x==="Unidentified"||x===t?String.fromCharCode(P.keyCode):x,s[x]||(x.length>1?n.hyphenate(x):x.toLowerCase())}function L(P,x,E,I){var T=ni._focused,M;if(o[x]=P,P?c[x]=E:delete c[x],x.length>1&&(M=n.camelize(x))in b){b[M]=P;var V=kt&&kt.agent;if(M==="meta"&&V&&V.mac)if(P)d={};else{for(var z in d)z in c&&L(!1,z,d[z],I);d=null}}else P&&d&&(d[x]=E);T&&T._handleKeyEvent(P?"keydown":"keyup",I,x,E)}return hi.add(i,{keydown:function(P){var x=y(P),E=kt&&kt.agent;x.length>1||E&&E.chrome&&(P.altKey||E.mac&&P.metaKey||!E.mac&&P.ctrlKey)?L(!0,x,a[x]||(x.length>1?"":x),P):f=x},keypress:function(P){if(f){var x=y(P),E=P.charCode,I=E>=32?String.fromCharCode(E):x.length>1?"":x;x!==f&&(x=I.toLowerCase()),L(!0,x,I,P),f=null}},keyup:function(P){var x=y(P);x in c&&L(!1,x,c[x],P)}}),hi.add(e,{blur:function(P){for(var x in c)L(!1,x,c[x],P)}}),{modifiers:b,isDown:function(P){return!!o[P]}}},$o=nn.extend({_class:"MouseEvent",initialize:function(a,o,c,d,f){this.type=a,this.event=o,this.point=c,this.target=d,this.delta=f},toString:function(){return"{ type: '"+this.type+"', point: "+this.point+", target: "+this.target+(this.delta?", delta: "+this.delta:"")+", modifiers: "+this.getModifiers()+" }"}}),Hr=nn.extend({_class:"ToolEvent",_item:null,initialize:function(a,o,c){this.tool=a,this.type=o,this.event=c},_choosePoint:function(s,a){return s||(a?a.clone():null)},getPoint:function(){return this._choosePoint(this._point,this.tool._point)},setPoint:function(s){this._point=s},getLastPoint:function(){return this._choosePoint(this._lastPoint,this.tool._lastPoint)},setLastPoint:function(s){this._lastPoint=s},getDownPoint:function(){return this._choosePoint(this._downPoint,this.tool._downPoint)},setDownPoint:function(s){this._downPoint=s},getMiddlePoint:function(){return!this._middlePoint&&this.tool._lastPoint?this.tool._point.add(this.tool._lastPoint).divide(2):this._middlePoint},setMiddlePoint:function(s){this._middlePoint=s},getDelta:function(){return!this._delta&&this.tool._lastPoint?this.tool._point.subtract(this.tool._lastPoint):this._delta},setDelta:function(s){this._delta=s},getCount:function(){return this.tool[/^mouse(down|up)$/.test(this.type)?"_downCount":"_moveCount"]},setCount:function(s){this.tool[/^mouse(down|up)$/.test(this.type)?"downCount":"count"]=s},getItem:function(){if(!this._item){var s=this.tool._scope.project.hitTest(this.getPoint());if(s){for(var a=s.item,o=a._parent;/^(Group|CompoundPath)$/.test(o._class);)a=o,o=o._parent;this._item=a}}return this._item},setItem:function(s){this._item=s},toString:function(){return"{ type: "+this.type+", point: "+this.getPoint()+", count: "+this.getCount()+", modifiers: "+this.getModifiers()+" }"}});p.extend({_class:"Tool",_list:"tools",_reference:"tool",_events:["onMouseDown","onMouseUp","onMouseDrag","onMouseMove","onActivate","onDeactivate","onEditOptions","onKeyDown","onKeyUp"],initialize:function(a){p.call(this),this._moveCount=-1,this._downCount=-1,this.set(a)},getMinDistance:function(){return this._minDistance},setMinDistance:function(s){this._minDistance=s,s!=null&&this._maxDistance!=null&&s>this._maxDistance&&(this._maxDistance=s)},getMaxDistance:function(){return this._maxDistance},setMaxDistance:function(s){this._maxDistance=s,this._minDistance!=null&&s!=null&&s<this._minDistance&&(this._minDistance=s)},getFixedDistance:function(){return this._minDistance==this._maxDistance?this._minDistance:null},setFixedDistance:function(s){this._minDistance=this._maxDistance=s},_handleMouseEvent:function(s,a,o,c){kt=this._scope,c.drag&&!this.responds(s)&&(s="mousemove");var d=c.move||c.drag,f=this.responds(s),b=this.minDistance,y=this.maxDistance,L=!1,P=this;function x(I,T){var M=o,V=d?P._point:P._downPoint||M;if(d){if(P._moveCount>=0&&M.equals(V))return!1;if(V&&(I!=null||T!=null)){var z=M.subtract(V),N=z.getLength();if(N<(I||0))return!1;T&&(M=V.add(z.normalize(Math.min(N,T))))}P._moveCount++}return P._point=M,P._lastPoint=V||M,c.down&&(P._moveCount=-1,P._downPoint=M,P._downCount++),!0}function E(){f&&(L=P.emit(s,new Hr(P,s,a))||L)}if(c.down)x(),E();else if(c.up)x(null,y),E();else if(f)for(;x(b,y);)E();return L}});var Rn=n.extend(r,{_class:"Tween",statics:{easings:new n({linear:function(s){return s},easeInQuad:function(s){return s*s},easeOutQuad:function(s){return s*(2-s)},easeInOutQuad:function(s){return s<.5?2*s*s:-1+2*(2-s)*s},easeInCubic:function(s){return s*s*s},easeOutCubic:function(s){return--s*s*s+1},easeInOutCubic:function(s){return s<.5?4*s*s*s:(s-1)*(2*s-2)*(2*s-2)+1},easeInQuart:function(s){return s*s*s*s},easeOutQuart:function(s){return 1- --s*s*s*s},easeInOutQuart:function(s){return s<.5?8*s*s*s*s:1-8*--s*s*s*s},easeInQuint:function(s){return s*s*s*s*s},easeOutQuint:function(s){return 1+--s*s*s*s*s},easeInOutQuint:function(s){return s<.5?16*s*s*s*s*s:1+16*--s*s*s*s*s}})},initialize:function s(a,o,c,d,f,b){this.object=a;var y=typeof f,L=y==="function";this.type=L?y:y==="string"?f:"linear",this.easing=L?f:s.easings[this.type],this.duration=d,this.running=!1,this._then=null,this._startTime=null;var P=o||c;this._keys=P?Object.keys(P):[],this._parsedKeys=this._parseKeys(this._keys),this._from=P&&this._getState(o),this._to=P&&this._getState(c),b!==!1&&this.start()},then:function(s){return this._then=s,this},start:function(){return this._startTime=null,this.running=!0,this},stop:function(){return this.running=!1,this},update:function(s){if(this.running){s>=1&&(s=1,this.running=!1);for(var a=this.easing(s),o=this._keys,c=function(x){return typeof x=="function"?x(a,s):x},d=0,f=o&&o.length;d<f;d++){var b=o[d],y=c(this._from[b]),L=c(this._to[b]),P=y&&L&&y.__add&&L.__add?L.__subtract(y).__multiply(a).__add(y):(L-y)*a+y;this._setProperty(this._parsedKeys[b],P)}this.responds("update")&&this.emit("update",new n({progress:s,factor:a})),!this.running&&this._then&&this._then(this.object)}return this},_events:{onUpdate:{}},_handleFrame:function(s){var a=this._startTime,o=a?(s-a)/this.duration:0;a||(this._startTime=s),this.update(o)},_getState:function(s){for(var a=this._keys,o={},c=0,d=a.length;c<d;c++){var f=a[c],b=this._parsedKeys[f],y=this._getProperty(b),L;if(s){var P=this._resolveValue(y,s[f]);this._setProperty(b,P),L=this._getProperty(b),L=L&&L.clone?L.clone():L,this._setProperty(b,y)}else L=y&&y.clone?y.clone():y;o[f]=L}return o},_resolveValue:function(s,a){if(a){if(Array.isArray(a)&&a.length===2){var o=a[0];return o&&o.match&&o.match(/^[+\-\*\/]=/)?this._calculate(s,o[0],a[1]):a}else if(typeof a=="string"){var c=a.match(/^[+\-*/]=(.*)/);if(c){var d=JSON.parse(c[1].replace(/(['"])?([a-zA-Z0-9_]+)(['"])?:/g,'"$2": '));return this._calculate(s,a[0],d)}}}return a},_calculate:function(s,a,o){return kt.PaperScript.calculateBinary(s,a,o)},_parseKeys:function(s){for(var a={},o=0,c=s.length;o<c;o++){var d=s[o],f=d.replace(/\.([^.]*)/g,"/$1").replace(/\[['"]?([^'"\]]*)['"]?\]/g,"/$1");a[d]=f.split("/")}return a},_getProperty:function(s,a){for(var o=this.object,c=0,d=s.length-(a||0);c<d&&o;c++)o=o[s[c]];return o},_setProperty:function(s,a){var o=this._getProperty(s,1);o&&(o[s[s.length-1]]=a)}}),Uo={request:function(s){var a=new e.XMLHttpRequest;return a.open((s.method||"get").toUpperCase(),s.url,n.pick(s.async,!0)),s.mimeType&&a.overrideMimeType(s.mimeType),a.onload=function(){var o=a.status;o===0||o===200?s.onLoad&&s.onLoad.call(a,a.responseText):a.onerror()},a.onerror=function(){var o=a.status,c='Could not load "'+s.url+'" (Status: '+o+")";if(s.onError)s.onError(c,o);else throw new Error(c)},a.send(null)}},Ci=n.exports.CanvasProvider={canvases:[],getCanvas:function(s,a,o){if(!e)return null;var c,d=!0;typeof s=="object"&&(a=s.height,s=s.width),this.canvases.length?c=this.canvases.pop():(c=i.createElement("canvas"),d=!1);var f=c.getContext("2d",o||{});if(!f)throw new Error("Canvas "+c+" is unable to provide a 2D context.");return c.width===s&&c.height===a?d&&f.clearRect(0,0,s+1,a+1):(c.width=s,c.height=a),f.save(),c},getContext:function(s,a,o){var c=this.getCanvas(s,a,o);return c?c.getContext("2d",o||{}):null},release:function(s){var a=s&&s.canvas?s.canvas:s;a&&a.getContext&&(a.getContext("2d").restore(),this.canvases.push(a))}},Vr=new function(){var s=Math.min,a=Math.max,o=Math.abs,c,d,f,b,y,L,P,x,E,I,T;function M(H,G,K){return .2989*H+.587*G+.114*K}function V(H,G,K,ee){var J=ee-M(H,G,K);E=H+J,I=G+J,T=K+J;var ee=M(E,I,T),re=s(E,I,T),ie=a(E,I,T);if(re<0){var oe=ee-re;E=ee+(E-ee)*ee/oe,I=ee+(I-ee)*ee/oe,T=ee+(T-ee)*ee/oe}if(ie>255){var le=255-ee,pe=ie-ee;E=ee+(E-ee)*le/pe,I=ee+(I-ee)*le/pe,T=ee+(T-ee)*le/pe}}function z(H,G,K){return a(H,G,K)-s(H,G,K)}function N(H,G,K,j){var J=[H,G,K],ee=a(H,G,K),re=s(H,G,K),ie;re=re===H?0:re===G?1:2,ee=ee===H?0:ee===G?1:2,ie=s(re,ee)===0?a(re,ee)===1?2:1:0,J[ee]>J[re]?(J[ie]=(J[ie]-J[re])*j/(J[ee]-J[re]),J[ee]=j):J[ie]=J[ee]=0,J[re]=0,E=J[0],I=J[1],T=J[2]}var F={multiply:function(){E=y*c/255,I=L*d/255,T=P*f/255},screen:function(){E=y+c-y*c/255,I=L+d-L*d/255,T=P+f-P*f/255},overlay:function(){E=y<128?2*y*c/255:255-2*(255-y)*(255-c)/255,I=L<128?2*L*d/255:255-2*(255-L)*(255-d)/255,T=P<128?2*P*f/255:255-2*(255-P)*(255-f)/255},"soft-light":function(){var H=c*y/255;E=H+y*(255-(255-y)*(255-c)/255-H)/255,H=d*L/255,I=H+L*(255-(255-L)*(255-d)/255-H)/255,H=f*P/255,T=H+P*(255-(255-P)*(255-f)/255-H)/255},"hard-light":function(){E=c<128?2*c*y/255:255-2*(255-c)*(255-y)/255,I=d<128?2*d*L/255:255-2*(255-d)*(255-L)/255,T=f<128?2*f*P/255:255-2*(255-f)*(255-P)/255},"color-dodge":function(){E=y===0?0:c===255?255:s(255,255*y/(255-c)),I=L===0?0:d===255?255:s(255,255*L/(255-d)),T=P===0?0:f===255?255:s(255,255*P/(255-f))},"color-burn":function(){E=y===255?255:c===0?0:a(0,255-(255-y)*255/c),I=L===255?255:d===0?0:a(0,255-(255-L)*255/d),T=P===255?255:f===0?0:a(0,255-(255-P)*255/f)},darken:function(){E=y<c?y:c,I=L<d?L:d,T=P<f?P:f},lighten:function(){E=y>c?y:c,I=L>d?L:d,T=P>f?P:f},difference:function(){E=y-c,E<0&&(E=-E),I=L-d,I<0&&(I=-I),T=P-f,T<0&&(T=-T)},exclusion:function(){E=y+c*(255-y-y)/255,I=L+d*(255-L-L)/255,T=P+f*(255-P-P)/255},hue:function(){N(c,d,f,z(y,L,P)),V(E,I,T,M(y,L,P))},saturation:function(){N(y,L,P,z(c,d,f)),V(E,I,T,M(y,L,P))},luminosity:function(){V(y,L,P,M(c,d,f))},color:function(){V(c,d,f,M(y,L,P))},add:function(){E=s(y+c,255),I=s(L+d,255),T=s(P+f,255)},subtract:function(){E=a(y-c,0),I=a(L-d,0),T=a(P-f,0)},average:function(){E=(y+c)/2,I=(L+d)/2,T=(P+f)/2},negation:function(){E=255-o(255-c-y),I=255-o(255-d-L),T=255-o(255-f-P)}},D=this.nativeModes=n.each(["source-over","source-in","source-out","source-atop","destination-over","destination-in","destination-out","destination-atop","lighter","darker","copy","xor"],function(H){this[H]=!0},{}),O=Ci.getContext(1,1,{willReadFrequently:!0});O&&(n.each(F,function(H,G){var K=G==="darken",j=!1;O.save();try{O.fillStyle=K?"#300":"#a00",O.fillRect(0,0,1,1),O.globalCompositeOperation=G,O.globalCompositeOperation===G&&(O.fillStyle=K?"#a00":"#300",O.fillRect(0,0,1,1),j=O.getImageData(0,0,1,1).data[0]!==K?170:51)}catch{}O.restore(),D[G]=j}),Ci.release(O)),this.process=function(H,G,K,j,J){var ee=G.canvas,re=H==="normal";if(re||D[H])K.save(),K.setTransform(1,0,0,1,0,0),K.globalAlpha=j,re||(K.globalCompositeOperation=H),K.drawImage(ee,J.x,J.y),K.restore();else{var ie=F[H];if(!ie)return;for(var oe=K.getImageData(J.x,J.y,ee.width,ee.height),le=oe.data,pe=G.getImageData(0,0,ee.width,ee.height).data,be=0,Le=le.length;be<Le;be+=4){c=pe[be],y=le[be],d=pe[be+1],L=le[be+1],f=pe[be+2],P=le[be+2],b=pe[be+3],x=le[be+3],ie();var Ne=b*j/255,He=1-Ne;le[be]=Ne*E+He*y,le[be+1]=Ne*I+He*L,le[be+2]=Ne*T+He*P,le[be+3]=b*j+He*x}K.putImageData(oe,J.x,J.y)}}},Pi=new function(){var s="http://www.w3.org/2000/svg",a="http://www.w3.org/2000/xmlns",o="http://www.w3.org/1999/xlink",c={href:o,xlink:a,xmlns:a+"/","xmlns:xlink":a+"/"};function d(y,L,P){return b(i.createElementNS(s,y),L,P)}function f(y,L){var P=c[L],x=P?y.getAttributeNS(P,L):y.getAttribute(L);return x==="null"?null:x}function b(y,L,P){for(var x in L){var E=L[x],I=c[x];typeof E=="number"&&P&&(E=P.number(E)),I?y.setAttributeNS(I,x,E):y.setAttribute(x,E)}return y}return{svg:s,xmlns:a,xlink:o,create:d,get:f,set:b}},Yo=n.each({fillColor:["fill","color"],fillRule:["fill-rule","string"],strokeColor:["stroke","color"],strokeWidth:["stroke-width","number"],strokeCap:["stroke-linecap","string"],strokeJoin:["stroke-linejoin","string"],strokeScaling:["vector-effect","lookup",{true:"none",false:"non-scaling-stroke"},function(s,a){return!a&&(s instanceof Ve||s instanceof Se||s instanceof rt)}],miterLimit:["stroke-miterlimit","number"],dashArray:["stroke-dasharray","array"],dashOffset:["stroke-dashoffset","number"],fontFamily:["font-family","string"],fontWeight:["font-weight","string"],fontSize:["font-size","number"],justification:["text-anchor","lookup",{left:"start",center:"middle",right:"end"}],opacity:["opacity","number"],blendMode:["mix-blend-mode","style"]},function(s,a){var o=n.capitalize(a),c=s[2];this[a]={type:s[1],property:a,attribute:s[0],toSVG:c,fromSVG:c&&n.each(c,function(d,f){this[d]=f},{}),exportFilter:s[3],get:"get"+o,set:"set"+o}},{});new function(){var s;function a(F,D,O){var H=new n,G=F.getTranslation();if(D){var K;F.isInvertible()?(F=F._shiftless(),K=F._inverseTransform(G),G=null):K=new k,H[O?"cx":"x"]=K.x,H[O?"cy":"y"]=K.y}if(!F.isIdentity()){var j=F.decompose();if(j){var J=[],ee=j.rotation,re=j.scaling,ie=j.skewing;G&&!G.isZero()&&J.push("translate("+s.point(G)+")"),ee&&J.push("rotate("+s.number(ee)+")"),(!B.isZero(re.x-1)||!B.isZero(re.y-1))&&J.push("scale("+s.point(re)+")"),ie.x&&J.push("skewX("+s.number(ie.x)+")"),ie.y&&J.push("skewY("+s.number(ie.y)+")"),H.transform=J.join(" ")}else H.transform="matrix("+F.getValues().join(",")+")"}return H}function o(F,D){for(var O=a(F._matrix),H=F._children,G=Pi.create("g",O,s),K=0,j=H.length;K<j;K++){var J=H[K],ee=z(J,D);if(ee)if(J.isClipMask()){var re=Pi.create("clipPath");re.appendChild(ee),M(J,re,"clip"),Pi.set(G,{"clip-path":"url(#"+re.id+")"})}else G.appendChild(ee)}return G}function c(F,D){var O=a(F._matrix,!0),H=F.getSize(),G=F.getImage();return O.x-=H.width/2,O.y-=H.height/2,O.width=H.width,O.height=H.height,O.href=D.embedImages==!1&&G&&G.src||F.toDataURL(),Pi.create("image",O,s)}function d(F,D){var O=D.matchShapes;if(O){var H=F.toShape(!1);if(H)return f(H)}var G=F._segments,K=G.length,j,J=a(F._matrix);if(O&&K>=2&&!F.hasHandles())if(K>2){j=F._closed?"polygon":"polyline";for(var ee=[],re=0;re<K;re++)ee.push(s.point(G[re]._point));J.points=ee.join(" ")}else{j="line";var ie=G[0]._point,oe=G[1]._point;J.set({x1:ie.x,y1:ie.y,x2:oe.x,y2:oe.y})}else j="path",J.d=F.getPathData(null,D.precision);return Pi.create(j,J,s)}function f(F){var D=F._type,O=F._radius,H=a(F._matrix,!0,D!=="rectangle");if(D==="rectangle"){D="rect";var G=F._size,K=G.width,j=G.height;H.x-=K/2,H.y-=j/2,H.width=K,H.height=j,O.isZero()&&(O=null)}return O&&(D==="circle"?H.r=O:(H.rx=O.width,H.ry=O.height)),Pi.create(D,H,s)}function b(F,D){var O=a(F._matrix),H=F.getPathData(null,D.precision);return H&&(O.d=H),Pi.create("path",O,s)}function y(F,D){var O=a(F._matrix,!0),H=F._definition,G=T(H,"symbol"),K=H._item,j=K.getStrokeBounds();return G||(G=Pi.create("symbol",{viewBox:s.rectangle(j)}),G.appendChild(z(K,D)),M(H,G,"symbol")),O.href="#"+G.id,O.x+=j.x,O.y+=j.y,O.width=j.width,O.height=j.height,O.overflow="visible",Pi.create("use",O,s)}function L(F){var D=T(F,"color");if(!D){var O=F.getGradient(),H=O._radial,G=F.getOrigin(),K=F.getDestination(),j;if(H){j={cx:G.x,cy:G.y,r:G.getDistance(K)};var J=F.getHighlight();J&&(j.fx=J.x,j.fy=J.y)}else j={x1:G.x,y1:G.y,x2:K.x,y2:K.y};j.gradientUnits="userSpaceOnUse",D=Pi.create((H?"radial":"linear")+"Gradient",j,s);for(var ee=O._stops,re=0,ie=ee.length;re<ie;re++){var oe=ee[re],le=oe._color,pe=le.getAlpha(),be=oe._offset;j={offset:be??re/(ie-1)},le&&(j["stop-color"]=le.toCSS(!0)),pe<1&&(j["stop-opacity"]=pe),D.appendChild(Pi.create("stop",j,s))}M(F,D,"color")}return"url(#"+D.id+")"}function P(F){var D=Pi.create("text",a(F._matrix,!0),s);return D.textContent=F._content,D}var x={Group:o,Layer:o,Raster:c,Path:d,Shape:f,CompoundPath:b,SymbolItem:y,PointText:P};function E(F,D,O){var H={},G=!O&&F.getParent(),K=[];return F._name!=null&&(H.id=F._name),n.each(Yo,function(j){var J=j.get,ee=j.type,re=F[J]();if(j.exportFilter?j.exportFilter(F,re):!G||!n.equals(G[J](),re)){if(ee==="color"&&re!=null){var ie=re.getAlpha();ie<1&&(H[j.attribute+"-opacity"]=ie)}ee==="style"?K.push(j.attribute+": "+re):H[j.attribute]=re==null?"none":ee==="color"?re.gradient?L(re):re.toCSS(!0):ee==="array"?re.join(","):ee==="lookup"?j.toSVG[re]:re}}),K.length&&(H.style=K.join(";")),H.opacity===1&&delete H.opacity,F._visible||(H.visibility="hidden"),Pi.set(D,H,s)}var I;function T(F,D){return I||(I={ids:{},svgs:{}}),F&&I.svgs[D+"-"+(F._id||F.__id||(F.__id=U.get("svg")))]}function M(F,D,O){I||T();var H=I.ids[O]=(I.ids[O]||0)+1;D.id=O+"-"+H,I.svgs[O+"-"+(F._id||F.__id)]=D}function V(F,D){var O=F,H=null;if(I){O=F.nodeName.toLowerCase()==="svg"&&F;for(var G in I.svgs)H||(O||(O=Pi.create("svg"),O.appendChild(F)),H=O.insertBefore(Pi.create("defs"),O.firstChild)),H.appendChild(I.svgs[G]);I=null}return D.asString?new e.XMLSerializer().serializeToString(O):O}function z(F,D,O){var H=x[F._class],G=H&&H(F,D);if(G){var K=D.onExport;K&&(G=K(F,G,D)||G);var j=JSON.stringify(F._data);j&&j!=="{}"&&j!=="null"&&G.setAttribute("data-paper-data",j)}return G&&E(F,G,O)}function N(F){return F||(F={}),s=new C(F.precision),F}se.inject({exportSVG:function(F){return F=N(F),V(z(this,F,!0),F)}}),de.inject({exportSVG:function(F){F=N(F);var D=this._children,O=this.getView(),H=n.pick(F.bounds,"view"),G=F.matrix||H==="view"&&O._matrix,K=G&&ye.read([G]),j=H==="view"?new Z([0,0],O.getViewSize()):H==="content"?se._getBounds(D,K,{stroke:!0}).rect:Z.read([H],0,{readNull:!0}),J={version:"1.1",xmlns:Pi.svg,"xmlns:xlink":Pi.xlink};j&&(J.width=j.width,J.height=j.height,(j.x||j.x===0||j.y||j.y===0)&&(J.viewBox=s.rectangle(j)));var ee=Pi.create("svg",J,s),re=ee;K&&!K.isIdentity()&&(re=ee.appendChild(Pi.create("g",a(K),s)));for(var ie=0,oe=D.length;ie<oe;ie++)re.appendChild(z(D[ie],F,!0));return V(ee,F)}})},new function(){var s={},a;function o(D,O,H,G,K,j){var J=Pi.get(D,O)||j,ee=J==null?G?null:H?"":0:H?J:parseFloat(J);return/%\s*$/.test(J)?ee/100*(K?1:a[/x|^width/.test(O)?"width":"height"]):ee}function c(D,O,H,G,K,j,J){return O=o(D,O||"x",!1,G,K,j),H=o(D,H||"y",!1,G,K,J),G&&(O==null||H==null)?null:new k(O,H)}function d(D,O,H,G,K){return O=o(D,O||"width",!1,G,K),H=o(D,H||"height",!1,G,K),G&&(O==null||H==null)?null:new X(O,H)}function f(D,O,H){return D==="none"?null:O==="number"?parseFloat(D):O==="array"?D?D.split(/[\s,]+/g).map(parseFloat):[]:O==="color"?z(D)||D:O==="lookup"?H[D]:D}function b(D,O,H,G){var K=D.childNodes,j=O==="clippath",J=O==="defs",ee=new fe,re=ee._project,ie=re._currentStyle,oe=[];if(!j&&!J&&(ee=V(ee,D,G),re._currentStyle=ee._style.clone()),G)for(var le=D.querySelectorAll("defs"),pe=0,be=le.length;pe<be;pe++)N(le[pe],H,!1);for(var pe=0,be=K.length;pe<be;pe++){var Le=K[pe],Ne;Le.nodeType===1&&!/^defs$/i.test(Le.nodeName)&&(Ne=N(Le,H,!1))&&!(Ne instanceof Ke)&&oe.push(Ne)}return ee.addChildren(oe),j&&(ee=V(ee.reduce(),D,G)),re._currentStyle=ie,(j||J)&&(ee.remove(),ee=null),ee}function y(D,O){for(var H=D.getAttribute("points").match(/[+-]?(?:\d*\.\d+|\d+\.?)(?:[eE][+-]?\d+)?/g),G=[],K=0,j=H.length;K<j;K+=2)G.push(new k(parseFloat(H[K]),parseFloat(H[K+1])));var J=new Ae(G);return O==="polygon"&&J.closePath(),J}function L(D){return Ve.create(D.getAttribute("d"))}function P(D,O){var H=(o(D,"href",!0)||"").substring(1),G=O==="radialgradient",K;if(H)K=s[H].getGradient(),K._radial^G&&(K=K.clone(),K._radial=G);else{for(var j=D.childNodes,J=[],ee=0,re=j.length;ee<re;ee++){var ie=j[ee];ie.nodeType===1&&J.push(V(new us,ie))}K=new Ri(J,G)}var oe,le,pe,be=o(D,"gradientUnits",!0)!=="userSpaceOnUse";G?(oe=c(D,"cx","cy",!1,be,"50%","50%"),le=oe.add(o(D,"r",!1,!1,be,"50%"),0),pe=c(D,"fx","fy",!0,be)):(oe=c(D,"x1","y1",!1,be,"0%","0%"),le=c(D,"x2","y2",!1,be,"100%","0%"));var Le=V(new Qt(K,oe,le,pe),D);return Le._scaleToBounds=be,null}var x={"#document":function(D,O,H,G){for(var K=D.childNodes,j=0,J=K.length;j<J;j++){var ee=K[j];if(ee.nodeType===1)return N(ee,H,G)}},g:b,svg:b,clippath:b,polygon:y,polyline:y,path:L,lineargradient:P,radialgradient:P,image:function(D){var O=new ze(o(D,"href",!0));return O.on("load",function(){var H=d(D);this.setSize(H);var G=c(D).add(H.divide(2));this._matrix.append(new ye().translate(G))}),O},symbol:function(D,O,H,G){return new Ke(b(D,O,H,G),!0)},defs:b,use:function(D){var O=(o(D,"href",!0)||"").substring(1),H=s[O],G=c(D);return H?H instanceof Ke?H.place(G):H.clone().translate(G):null},circle:function(D){return new Se.Circle(c(D,"cx","cy"),o(D,"r"))},ellipse:function(D){return new Se.Ellipse({center:c(D,"cx","cy"),radius:d(D,"rx","ry")})},rect:function(D){return new Se.Rectangle(new Z(c(D),d(D)),d(D,"rx","ry"))},line:function(D){return new Ae.Line(c(D,"x1","y1"),c(D,"x2","y2"))},text:function(D){var O=new Li(c(D).add(c(D,"dx","dy")));return O.setContent(D.textContent.trim()||""),O},switch:b};function E(D,O,H,G){if(D.transform){for(var K=(G.getAttribute(H)||"").split(/\)\s*/g),j=new ye,J=0,ee=K.length;J<ee;J++){var re=K[J];if(!re)break;for(var ie=re.split(/\(\s*/),oe=ie[0],le=ie[1].split(/[\s,]+/g),pe=0,be=le.length;pe<be;pe++)le[pe]=parseFloat(le[pe]);switch(oe){case"matrix":j.append(new ye(le[0],le[1],le[2],le[3],le[4],le[5]));break;case"rotate":j.rotate(le[0],le[1]||0,le[2]||0);break;case"translate":j.translate(le[0],le[1]||0);break;case"scale":j.scale(le);break;case"skewX":j.skew(le[0],0);break;case"skewY":j.skew(0,le[0]);break}}D.transform(j)}}function I(D,O,H){var G=H==="fill-opacity"?"getFillColor":"getStrokeColor",K=D[G]&&D[G]();K&&K.setAlpha(parseFloat(O))}var T=n.set(n.each(Yo,function(D){this[D.attribute]=function(O,H){if(O[D.set]&&(O[D.set](f(H,D.type,D.fromSVG)),D.type==="color")){var G=O[D.get]();if(G&&G._scaleToBounds){var K=O.getBounds();G.transform(new ye().translate(K.getPoint()).scale(K.getSize()))}}}},{}),{id:function(D,O){s[O]=D,D.setName&&D.setName(O)},"clip-path":function(D,O){var H=z(O);if(H)if(H=H.clone(),H.setClipMask(!0),D instanceof fe)D.insertChild(0,H);else return new fe(H,D)},gradientTransform:E,transform:E,"fill-opacity":I,"stroke-opacity":I,visibility:function(D,O){D.setVisible&&D.setVisible(O==="visible")},display:function(D,O){D.setVisible&&D.setVisible(O!==null)},"stop-color":function(D,O){D.setColor&&D.setColor(O)},"stop-opacity":function(D,O){D._color&&D._color.setAlpha(parseFloat(O))},offset:function(D,O){if(D.setOffset){var H=O.match(/(.*)%$/);D.setOffset(H?H[1]/100:parseFloat(O))}},viewBox:function(D,O,H,G,K){var j=new Z(f(O,"array")),J=d(G,null,null,!0),ee,re;if(D instanceof fe){var ie=J?J.divide(j.getSize()):1,re=new ye().scale(ie).translate(j.getPoint().negate());ee=D}else D instanceof Ke&&(J&&j.setSize(J),ee=D._item);if(ee){if(M(G,"overflow",K)!=="visible"){var oe=new Se.Rectangle(j);oe.setClipMask(!0),ee.addChild(oe)}re&&ee.transform(re)}}});function M(D,O,H){var G=D.attributes[O],K=G&&G.value;if(!K&&D.style){var j=n.camelize(O);K=D.style[j],!K&&H.node[j]!==H.parent[j]&&(K=H.node[j])}return K?K==="none"?null:K:t}function V(D,O,H){var G=O.parentNode,K={node:Vt.getStyles(O)||{},parent:!H&&!/^defs$/i.test(G.tagName)&&Vt.getStyles(G)||{}};return n.each(T,function(j,J){var ee=M(O,J,K);D=ee!==t&&j(D,ee,J,O,K)||D}),D}function z(D){var O=D&&D.match(/\((?:["'#]*)([^"')]+)/),H=O&&O[1],G=H&&s[window?H.replace(e.location.href.split("#")[0]+"#",""):H];return G&&G._scaleToBounds&&(G=G.clone(),G._scaleToBounds=!0),G}function N(D,O,H){var G=D.nodeName.toLowerCase(),K=G!=="#document",j=i.body,J,ee,re;H&&K&&(a=kt.getView().getSize(),a=d(D,null,null,!0)||a,J=Pi.create("svg",{style:"stroke-width: 1px; stroke-miterlimit: 10"}),ee=D.parentNode,re=D.nextSibling,J.appendChild(D),j.appendChild(J));var ie=kt.settings,oe=ie.applyMatrix,le=ie.insertItems;ie.applyMatrix=!1,ie.insertItems=!1;var pe=x[G],be=pe&&pe(D,G,O,H)||null;if(ie.insertItems=le,ie.applyMatrix=oe,be){K&&!(be instanceof fe)&&(be=V(be,D,H));var Le=O.onImport,Ne=K&&D.getAttribute("data-paper-data");Le&&(be=Le(D,be,O)||be),O.expandShapes&&be instanceof Se&&(be.remove(),be=be.toPath()),Ne&&(be._data=JSON.parse(Ne))}return J&&(j.removeChild(J),ee&&(re?ee.insertBefore(D,re):ee.appendChild(D))),H&&(s={},be&&n.pick(O.applyMatrix,oe)&&be.matrix.apply(!0,!0)),be}function F(D,O,H){if(!D)return null;O=typeof O=="function"?{onLoad:O}:O||{};var G=kt,K=null;function j(ie){try{var oe=typeof ie=="object"?ie:new e.DOMParser().parseFromString(ie.trim(),"image/svg+xml");if(!oe.nodeName)throw oe=null,new Error("Unsupported SVG source: "+D);kt=G,K=N(oe,O,!0),(!O||O.insert!==!1)&&H._insertItem(t,K);var le=O.onLoad;le&&le(K,ie)}catch(pe){J(pe)}}function J(ie,oe){var le=O.onError;if(le)le(ie,oe);else throw new Error(ie)}if(typeof D=="string"&&!/^[\s\S]*</.test(D)){var ee=i.getElementById(D);ee?j(ee):Uo.request({url:D,async:!0,onLoad:j,onError:J})}else if(typeof File<"u"&&D instanceof File){var re=new FileReader;return re.onload=function(){j(re.result)},re.onerror=function(){J(re.error)},re.readAsText(D)}else j(D);return K}se.inject({importSVG:function(D,O){return F(D,O,this)}}),de.inject({importSVG:function(D,O){return this.activate(),F(D,O,this)}})};var kt=new(h.inject(n.exports,{Base:n,Numerical:B,Key:pr,DomEvent:hi,DomElement:Vt,document:i,window,Symbol:Ke,PlacedSymbol:Re}));return kt.agent.node,typeof t=="function"&&t.amd?t("paper",kt):l&&(l.exports=kt),kt}).call(self,typeof self=="object"?self:null)})(Py);var Sy={exports:{}};(function(l){(function(e,t){typeof self.define=="function"&&self.define.amd?self.define([],t):l.exports?self.QueryStringMachine=t():e.QueryStringMachine=t()})(self,()=>{const e=",",t=()=>{try{return localStorage.getItem("phetTeamMember")==="true"}catch{return!1}},i=n=>n.length===0||n.indexOf("?")===0;return function(){const n=(de,se,fe,Fe,Se)=>{if(!de)if(Fe.public)if(r.addWarning(se,fe,Se),Fe.hasOwnProperty("defaultValue"))fe=Fe.defaultValue;else{const ze=Oe[Fe.type];ye(ze.hasOwnProperty("defaultValue"),"Type must have a default value if the provided schema does not have one."),fe=ze.defaultValue}else ye(de,Se);return fe},r={warnings:[],get:function(de,se){return this.getForString(de,se,self.location.search)},getAll:function(de){return this.getAllForString(de,self.location.search)},getForString:function(de,se,fe){if(!i(fe))throw new Error(`Query strings should be either the empty string or start with a "?": ${fe}`);const Fe=se.private&&!t()?[]:h(de,fe);p(de,se);let Se=B(de,se,Fe);se.hasOwnProperty("validValues")?Se=n(ce(Se,se.validValues),de,Se,se,`Invalid value supplied for key "${de}": ${Se} is not a member of valid values: ${se.validValues.join(", ")}`):se.hasOwnProperty("isValidValue")&&(Se=n(se.isValidValue(Se),de,Se,se,`Invalid value supplied for key "${de}": ${Se}`));let ze=Oe[se.type].isValidValue(Se);if(se.type==="array"&&Array.isArray(Se)){let Re=!0;for(let Ke=0;Ke<Se.length;Ke++){const Ze=Se[Ke];if(!Oe[se.elementSchema.type].isValidValue(Ze)){Re=!1;break}if(se.elementSchema.hasOwnProperty("isValidValue")&&!se.elementSchema.isValidValue(Ze)){Re=!1;break}if(se.elementSchema.hasOwnProperty("validValues")&&!ce(Ze,se.elementSchema.validValues)){Re=!1;break}}ze=ze&&Re}return Se=n(ze,de,Se,se,`Invalid value for type, key: ${de}`),Se},getAllForString:function(de,se){const fe={};for(const Fe in de)de.hasOwnProperty(Fe)&&(fe[Fe]=this.getForString(Fe,de[Fe],se));return fe},containsKey:function(de){return this.containsKeyForString(de,self.location.search)},containsKeyForString:function(de,se){if(!i(se))throw new Error(`Query strings should be either the empty string or start with a "?": ${se}`);return h(de,se).length>0},deepEquals:function(de,se){if(typeof de!=typeof se)return!1;if(typeof de=="string"||typeof de=="number"||typeof de=="boolean")return de===se;if(de===null&&se===null||de===void 0&&se===void 0)return!0;if(de===null&&se===void 0||de===void 0&&se===null)return!1;const fe=Object.keys(de),Fe=Object.keys(se);if(fe.length!==Fe.length)return!1;if(fe.length===0)return de===se;for(let Se=0;Se<fe.length;Se++){if(fe[Se]!==Fe[Se])return!1;const ze=de[fe[Se]],Re=se[fe[Se]];if(!r.deepEquals(ze,Re))return!1}return!0},removeKeyValuePair:function(de,se){if(assert&&assert(typeof de=="string",`url should be string, but it was: ${typeof de}`),assert&&assert(typeof se=="string",`url should be string, but it was: ${typeof se}`),assert&&assert(i(de),"queryString should be length 0 or begin with ?"),assert&&assert(se.length>0,"url should be a string with length > 0"),de.indexOf("?")===0){const fe=[],Se=de.substring(1).split("&");for(let ze=0;ze<Se.length;ze++){const Re=Se[ze],Ke=Re.split("=");decodeURIComponent(Ke[0])!==se&&fe.push(Re)}return fe.length>0?`?${fe.join("&")}`:""}else return de},removeKeyValuePairs:function(de,se){for(let fe=0;fe<se.length;fe++)de=this.removeKeyValuePair(de,se[fe]);return de},appendQueryString:function(de,se){if((se.indexOf("?")===0||se.indexOf("&")===0)&&(se=se.substring(1)),se.length===0)return de;const fe=de.indexOf("?")>=0?"&":"?";return de+fe+se},appendQueryStringArray:function(de,se){for(let fe=0;fe<se.length;fe++)de=this.appendQueryString(de,se[fe]);return de},getQueryString:function(de){const se=de.indexOf("?");return se>=0?de.substring(se):"?"},addWarning:function(de,se,fe){console.warn(fe),this.warnings.push({key:de,value:se,message:fe})},hasWarning:function(de){let se=!1;for(let fe=0;fe<this.warnings.length&&!se;fe++)se=this.warnings[fe].key===de;return se},getQueryParametersFromString:function(de){return de.indexOf("?")===0?de.substring(1).split("&"):[]},getSingleQueryParameterString:function(de,se){const fe=this.getQueryString(se),Fe=this.getQueryParametersFromString(fe);for(let Se=0;Se<Fe.length;Se++){const ze=Fe[Se],Re=ze.split("=");if(decodeURIComponent(Re[0])===de)return ze}return null}},h=function(de,se){const fe=[],Fe=se.slice(1).split("&");for(let Se=0;Se<Fe.length;Se++){const ze=Fe[Se].split("="),Re=ze[0],Ke=ze.slice(1).join("=");Re===de&&(Ke?fe.push(decodeURIComponent(Ke)):fe.push(null))}return fe},p=function(de,se){ye(se.hasOwnProperty("type"),`type field is required for key: ${de}`),ye(Oe.hasOwnProperty(se.type),`invalid type: ${se.type} for key: ${de}`),se.hasOwnProperty("parse")&&ye(typeof se.parse=="function",`parse must be a function for key: ${de}`),ye(!(se.hasOwnProperty("validValues")&&se.hasOwnProperty("isValidValue")),se),se.hasOwnProperty("validValues")&&ye(Array.isArray(se.validValues),`isValidValue must be an array for key: ${de}`),se.hasOwnProperty("isValidValue")&&ye(typeof se.isValidValue=="function",`isValidValue must be a function for key: ${de}`),se.hasOwnProperty("defaultValue")&&ye(Oe[se.type].isValidValue(se.defaultValue),`defaultValue incorrect type: ${de}`),se.hasOwnProperty("validValues")&&se.validValues.forEach(fe=>ye(Oe[se.type].isValidValue(fe),`validValue incorrect type for key: ${de}`)),se.hasOwnProperty("defaultValue")&&se.hasOwnProperty("validValues")&&ye(ce(se.defaultValue,se.validValues),se),se.hasOwnProperty("public")&&se.public&&se.type!=="flag"&&ye(se.hasOwnProperty("defaultValue"),`defaultValue is required when public: true for key: ${de}`),C(de,se,Oe[se.type].required,Oe[se.type].optional),Oe[se.type].validateSchema&&Oe[se.type].validateSchema(de,se)},S=function(de,se){se.hasOwnProperty("separator")&&ye(typeof se.separator=="string"&&se.separator.length===1,`invalid separator: ${se.separator}, for key: ${de}`),ye(!se.elementSchema.hasOwnProperty("public"),"Array elements should not declare public; it comes from the array schema itself."),p(`${de}.element`,se.elementSchema)},C=function(de,se,fe,Fe){const Se=Object.getOwnPropertyNames(se);fe.forEach(Re=>{ye(Se.indexOf(Re)!==-1,`missing required property: ${Re} for key: ${de}`)});const ze=fe.concat(Fe);Se.forEach(Re=>{ye(Re==="type"||ze.indexOf(Re)!==-1,`unsupported property: ${Re} for key: ${de}`)})},B=function(de,se,fe){let Fe;return ye(fe.length<=1,`query parameter cannot occur multiple times: ${de}`),se.type==="flag"?Fe=Oe[se.type].parse(de,se,fe[0]):(ye(fe[0]!==void 0||se.hasOwnProperty("defaultValue"),`missing required query parameter: ${de}`),fe[0]===void 0?Fe=se.defaultValue:Fe=Oe[se.type].parse(de,se,fe[0])),Fe},U=function(de,se,fe){return fe===null?!0:fe===void 0?!1:fe},k=function(de,se,fe){return fe==="true"?!0:fe==="false"?!1:fe},Q=function(de,se,fe){const Fe=Number(fe);return fe===null||isNaN(Fe)?fe:Fe},X=function(de,se,fe){return fe},g=function(de,se,fe){let Fe;return fe===null?Fe=[]:Fe=fe.split(se.separator||e).map(Se=>B(de,se.elementSchema,[Se])),Fe},Z=function(de,se,fe){return se.parse(fe)},ce=function(de,se){let fe=!1;for(let Fe=0;Fe<se.length&&!fe;Fe++)fe=r.deepEquals(se[Fe],de);return fe},ye=function(de,se){if(!de)throw console&&console.log&&console.log(se),new Error(`Query String Machine Assertion failed: ${se}`)},Oe={flag:{required:[],optional:["private","public"],validateSchema:null,parse:U,isValidValue:de=>de===!0||de===!1,defaultValue:!0},boolean:{required:[],optional:["defaultValue","private","public"],validateSchema:null,parse:k,isValidValue:de=>de===!0||de===!1},number:{required:[],optional:["defaultValue","validValues","isValidValue","private","public"],validateSchema:null,parse:Q,isValidValue:de=>typeof de=="number"&&!isNaN(de)},string:{required:[],optional:["defaultValue","validValues","isValidValue","private","public"],validateSchema:null,parse:X,isValidValue:de=>de===null||typeof de=="string"},array:{required:["elementSchema"],optional:["defaultValue","validValues","isValidValue","separator","validValues","private","public"],validateSchema:S,parse:g,isValidValue:de=>Array.isArray(de)||de===null},custom:{required:["parse"],optional:["defaultValue","validValues","isValidValue","private","public"],validateSchema:null,parse:Z,isValidValue:de=>!0}};return r}()})})(Sy);function el(l){throw new Error('Could not dynamically require "'+l+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}(function(l,e){(function(t){self.himalaya=t()})(function(){return function(){function t(i,n,r){function h(C,B){if(!n[C]){if(!i[C]){var U=typeof el=="function"&&el;if(!B&&U)return U(C,!0);if(p)return p(C,!0);var k=new Error("Cannot find module '"+C+"'");throw k.code="MODULE_NOT_FOUND",k}var Q=n[C]={exports:{}};i[C][0].call(Q.exports,function(X){var g=i[C][1][X];return h(g||X)},Q,Q.exports,t,i,n,r)}return n[C].exports}for(var p=typeof el=="function"&&el,S=0;S<r.length;S++)h(r[S]);return h}return t}()({1:[function(t,i,n){var r=function(){var U="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/compat.js",k="cde94accf38c67a096269c512dfb0f1bca69a38a",Q=(function(){}).constructor,X=new Q("return this")(),g="__coverage__",Z={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/compat.js",statementMap:{0:{start:{line:10,column:2},end:{line:10,column:72}},1:{start:{line:14,column:16},end:{line:14,column:62}},2:{start:{line:15,column:20},end:{line:15,column:56}},3:{start:{line:16,column:2},end:{line:16,column:48}},4:{start:{line:20,column:2},end:{line:20,column:56}},5:{start:{line:24,column:2},end:{line:24,column:42}},6:{start:{line:28,column:14},end:{line:28,column:26}},7:{start:{line:29,column:2},end:{line:29,column:29}},8:{start:{line:29,column:17},end:{line:29,column:29}},9:{start:{line:31,column:22},end:{line:31,column:34}},10:{start:{line:32,column:23},end:{line:32,column:47}},11:{start:{line:33,column:20},end:{line:33,column:70}},12:{start:{line:34,column:2},end:{line:38,column:3}},13:{start:{line:35,column:20},end:{line:35,column:40}},14:{start:{line:36,column:4},end:{line:36,column:46}},15:{start:{line:36,column:35},end:{line:36,column:46}},16:{start:{line:37,column:4},end:{line:37,column:55}},17:{start:{line:37,column:44},end:{line:37,column:55}},18:{start:{line:40,column:2},end:{line:40,column:14}}},fnMap:{0:{name:"startsWith",decl:{start:{line:9,column:16},end:{line:9,column:26}},loc:{start:{line:9,column:57},end:{line:11,column:1}},line:9},1:{name:"endsWith",decl:{start:{line:13,column:16},end:{line:13,column:24}},loc:{start:{line:13,column:55},end:{line:17,column:1}},line:13},2:{name:"stringIncludes",decl:{start:{line:19,column:16},end:{line:19,column:30}},loc:{start:{line:19,column:61},end:{line:21,column:1}},line:19},3:{name:"isRealNaN",decl:{start:{line:23,column:16},end:{line:23,column:25}},loc:{start:{line:23,column:30},end:{line:25,column:1}},line:23},4:{name:"arrayIncludes",decl:{start:{line:27,column:16},end:{line:27,column:29}},loc:{start:{line:27,column:63},end:{line:41,column:1}},line:27}},branchMap:{0:{loc:{start:{line:10,column:20},end:{line:10,column:33}},type:"binary-expr",locations:[{start:{line:10,column:20},end:{line:10,column:28}},{start:{line:10,column:32},end:{line:10,column:33}}],line:10},1:{loc:{start:{line:14,column:17},end:{line:14,column:39}},type:"binary-expr",locations:[{start:{line:14,column:17},end:{line:14,column:25}},{start:{line:14,column:29},end:{line:14,column:39}}],line:14},2:{loc:{start:{line:16,column:9},end:{line:16,column:48}},type:"binary-expr",locations:[{start:{line:16,column:9},end:{line:16,column:25}},{start:{line:16,column:29},end:{line:16,column:48}}],line:16},3:{loc:{start:{line:20,column:35},end:{line:20,column:48}},type:"binary-expr",locations:[{start:{line:20,column:35},end:{line:20,column:43}},{start:{line:20,column:47},end:{line:20,column:48}}],line:20},4:{loc:{start:{line:24,column:9},end:{line:24,column:42}},type:"binary-expr",locations:[{start:{line:24,column:9},end:{line:24,column:30}},{start:{line:24,column:34},end:{line:24,column:42}}],line:24},5:{loc:{start:{line:29,column:2},end:{line:29,column:29}},type:"if",locations:[{start:{line:29,column:2},end:{line:29,column:29}},{start:{line:29,column:2},end:{line:29,column:29}}],line:29},6:{loc:{start:{line:33,column:20},end:{line:33,column:70}},type:"cond-expr",locations:[{start:{line:33,column:39},end:{line:33,column:50}},{start:{line:33,column:53},end:{line:33,column:70}}],line:33},7:{loc:{start:{line:36,column:4},end:{line:36,column:46}},type:"if",locations:[{start:{line:36,column:4},end:{line:36,column:46}},{start:{line:36,column:4},end:{line:36,column:46}}],line:36},8:{loc:{start:{line:37,column:4},end:{line:37,column:55}},type:"if",locations:[{start:{line:37,column:4},end:{line:37,column:55}},{start:{line:37,column:4},end:{line:37,column:55}}],line:37},9:{loc:{start:{line:37,column:8},end:{line:37,column:42}},type:"binary-expr",locations:[{start:{line:37,column:8},end:{line:37,column:20}},{start:{line:37,column:24},end:{line:37,column:42}}],line:37}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0},f:{0:0,1:0,2:0,3:0,4:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0],7:[0,0],8:[0,0],9:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},ce=X[g]||(X[g]={});return ce[U]&&ce[U].hash===k?ce[U]:(Z.hash=k,ce[U]=Z)}();Object.defineProperty(n,"__esModule",{value:!0}),n.startsWith=h,n.endsWith=p,n.stringIncludes=S,n.isRealNaN=C,n.arrayIncludes=B;function h(U,k,Q){return r.f[0]++,r.s[0]++,U.substr((r.b[0][0]++,Q||(r.b[0][1]++,0)),k.length)===k}function p(U,k,Q){r.f[1]++;var X=(r.s[1]++,r.b[1][0]++,(Q||(r.b[1][1]++,U.length))-k.length),g=(r.s[2]++,U.lastIndexOf(k,X));return r.s[3]++,r.b[2][0]++,g!==-1&&(r.b[2][1]++,g===X)}function S(U,k,Q){return r.f[2]++,r.s[4]++,U.indexOf(k,(r.b[3][0]++,Q||(r.b[3][1]++,0)))!==-1}function C(U){return r.f[3]++,r.s[5]++,r.b[4][0]++,typeof U=="number"&&(r.b[4][1]++,isNaN(U))}function B(U,k,Q){r.f[4]++;var X=(r.s[6]++,U.length);if(r.s[7]++,X===0)return r.b[5][0]++,r.s[8]++,!1;r.b[5][1]++;var g=(r.s[9]++,Q|0),Z=(r.s[10]++,C(k)),ce=(r.s[11]++,g>=0?(r.b[6][0]++,g):(r.b[6][1]++,X+g));for(r.s[12]++;ce<X;){var ye=(r.s[13]++,U[ce++]);if(r.s[14]++,ye===k)return r.b[7][0]++,r.s[15]++,!0;if(r.b[7][1]++,r.s[16]++,r.b[9][0]++,Z&&(r.b[9][1]++,C(ye)))return r.b[8][0]++,r.s[17]++,!0;r.b[8][1]++}return r.s[18]++,!1}},{}],2:[function(t,i,n){var r=function(){var B="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/format.js",U="ef8c4d14fa58c2bce23a58bf5d7c370846a07329",k=(function(){}).constructor,Q=new k("return this")(),X="__coverage__",g={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/format.js",statementMap:{0:{start:{line:2,column:14},end:{line:2,column:30}},1:{start:{line:3,column:2},end:{line:3,column:30}},2:{start:{line:3,column:18},end:{line:3,column:30}},3:{start:{line:4,column:2},end:{line:4,column:57}},4:{start:{line:8,column:14},end:{line:8,column:27}},5:{start:{line:9,column:14},end:{line:9,column:28}},6:{start:{line:10,column:23},end:{line:10,column:49}},7:{start:{line:11,column:2},end:{line:13,column:3}},8:{start:{line:12,column:4},end:{line:12,column:28}},9:{start:{line:14,column:2},end:{line:14,column:12}},10:{start:{line:18,column:2},end:{line:32,column:4}},11:{start:{line:19,column:17},end:{line:19,column:26}},12:{start:{line:20,column:23},end:{line:27,column:39}},13:{start:{line:28,column:4},end:{line:30,column:5}},14:{start:{line:29,column:6},end:{line:29,column:41}},15:{start:{line:31,column:4},end:{line:31,column:21}},16:{start:{line:36,column:2},end:{line:43,column:4}},17:{start:{line:37,column:18},end:{line:37,column:50}},18:{start:{line:38,column:16},end:{line:38,column:24}},19:{start:{line:39,column:18},end:{line:41,column:12}},20:{start:{line:42,column:4},end:{line:42,column:23}}},fnMap:{0:{name:"splitHead",decl:{start:{line:1,column:16},end:{line:1,column:25}},loc:{start:{line:1,column:37},end:{line:5,column:1}},line:1},1:{name:"unquote",decl:{start:{line:7,column:16},end:{line:7,column:23}},loc:{start:{line:7,column:30},end:{line:15,column:1}},line:7},2:{name:"format",decl:{start:{line:17,column:16},end:{line:17,column:22}},loc:{start:{line:17,column:40},end:{line:33,column:1}},line:17},3:{name:"(anonymous_3)",decl:{start:{line:18,column:19},end:{line:18,column:20}},loc:{start:{line:18,column:27},end:{line:32,column:3}},line:18},4:{name:"formatAttributes",decl:{start:{line:35,column:16},end:{line:35,column:32}},loc:{start:{line:35,column:46},end:{line:44,column:1}},line:35},5:{name:"(anonymous_5)",decl:{start:{line:36,column:24},end:{line:36,column:25}},loc:{start:{line:36,column:37},end:{line:43,column:3}},line:36}},branchMap:{0:{loc:{start:{line:3,column:2},end:{line:3,column:30}},type:"if",locations:[{start:{line:3,column:2},end:{line:3,column:30}},{start:{line:3,column:2},end:{line:3,column:30}}],line:3},1:{loc:{start:{line:10,column:23},end:{line:10,column:49}},type:"binary-expr",locations:[{start:{line:10,column:23},end:{line:10,column:34}},{start:{line:10,column:38},end:{line:10,column:49}}],line:10},2:{loc:{start:{line:11,column:2},end:{line:13,column:3}},type:"if",locations:[{start:{line:11,column:2},end:{line:13,column:3}},{start:{line:11,column:2},end:{line:13,column:3}}],line:11},3:{loc:{start:{line:11,column:6},end:{line:11,column:45}},type:"binary-expr",locations:[{start:{line:11,column:6},end:{line:11,column:18}},{start:{line:11,column:22},end:{line:11,column:45}}],line:11},4:{loc:{start:{line:20,column:23},end:{line:27,column:39}},type:"cond-expr",locations:[{start:{line:21,column:8},end:{line:26,column:7}},{start:{line:27,column:8},end:{line:27,column:39}}],line:20},5:{loc:{start:{line:28,column:4},end:{line:30,column:5}},type:"if",locations:[{start:{line:28,column:4},end:{line:30,column:5}},{start:{line:28,column:4},end:{line:30,column:5}}],line:28},6:{loc:{start:{line:39,column:18},end:{line:41,column:12}},type:"cond-expr",locations:[{start:{line:40,column:8},end:{line:40,column:25}},{start:{line:41,column:8},end:{line:41,column:12}}],line:39}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0},f:{0:0,1:0,2:0,3:0,4:0,5:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},Z=Q[X]||(Q[X]={});return Z[B]&&Z[B].hash===U?Z[B]:(g.hash=U,Z[B]=g)}();Object.defineProperty(n,"__esModule",{value:!0}),n.splitHead=h,n.unquote=p,n.format=S,n.formatAttributes=C;function h(B,U){r.f[0]++;var k=(r.s[0]++,B.indexOf(U));return r.s[1]++,k===-1?(r.b[0][0]++,r.s[2]++,[B]):(r.b[0][1]++,r.s[3]++,[B.slice(0,k),B.slice(k+U.length)])}function p(B){r.f[1]++;var U=(r.s[4]++,B.charAt(0)),k=(r.s[5]++,B.length-1),Q=(r.s[6]++,r.b[1][0]++,U==='"'||(r.b[1][1]++,U==="'"));return r.s[7]++,r.b[3][0]++,Q&&(r.b[3][1]++,U===B.charAt(k))?(r.b[2][0]++,r.s[8]++,B.slice(1,k)):(r.b[2][1]++,r.s[9]++,B)}function S(B,U){return r.f[2]++,r.s[10]++,B.map(function(k){r.f[3]++;var Q=(r.s[11]++,k.type),X=(r.s[12]++,Q==="element"?(r.b[4][0]++,{type:Q,tagName:k.tagName.toLowerCase(),attributes:C(k.attributes),children:S(k.children,U)}):(r.b[4][1]++,{type:Q,content:k.content}));return r.s[13]++,U.includePositions?(r.b[5][0]++,r.s[14]++,X.position=k.position):r.b[5][1]++,r.s[15]++,X})}function C(B){return r.f[4]++,r.s[16]++,B.map(function(U){r.f[5]++;var k=(r.s[17]++,h(U.trim(),"=")),Q=(r.s[18]++,k[0]),X=(r.s[19]++,typeof k[1]=="string"?(r.b[6][0]++,p(k[1])):(r.b[6][1]++,null));return r.s[20]++,{key:Q,value:X}})}},{}],3:[function(t,i,n){var r=function(){var ce="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/index.js",ye="a91ca68b6320b199fa63e4cbd37dce6857e0c43d",Oe=(function(){}).constructor,de=new Oe("return this")(),se="__coverage__",fe={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/index.js",statementMap:{0:{start:{line:12,column:29},end:{line:18,column:1}},1:{start:{line:21,column:17},end:{line:21,column:36}},2:{start:{line:22,column:16},end:{line:22,column:39}},3:{start:{line:23,column:2},end:{line:23,column:31}},4:{start:{line:27,column:2},end:{line:27,column:29}}},fnMap:{0:{name:"parse",decl:{start:{line:20,column:16},end:{line:20,column:21}},loc:{start:{line:20,column:53},end:{line:24,column:1}},line:20},1:{name:"stringify",decl:{start:{line:26,column:16},end:{line:26,column:25}},loc:{start:{line:26,column:57},end:{line:28,column:1}},line:26}},branchMap:{0:{loc:{start:{line:20,column:28},end:{line:20,column:51}},type:"default-arg",locations:[{start:{line:20,column:38},end:{line:20,column:51}}],line:20},1:{loc:{start:{line:26,column:32},end:{line:26,column:55}},type:"default-arg",locations:[{start:{line:26,column:42},end:{line:26,column:55}}],line:26}},s:{0:0,1:0,2:0,3:0,4:0},f:{0:0,1:0},b:{0:[0],1:[0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},Fe=de[se]||(de[se]={});return Fe[ce]&&Fe[ce].hash===ye?Fe[ce]:(fe.hash=ye,Fe[ce]=fe)}();Object.defineProperty(n,"__esModule",{value:!0}),n.parseDefaults=void 0,n.parse=g,n.stringify=Z;var h=t("./lexer"),p=Q(h),S=t("./parser"),C=Q(S),B=t("./format"),U=t("./stringify"),k=t("./tags");function Q(ce){return ce&&ce.__esModule?ce:{default:ce}}var X=n.parseDefaults=(r.s[0]++,{voidTags:k.voidTags,closingTags:k.closingTags,childlessTags:k.childlessTags,closingTagAncestorBreakers:k.closingTagAncestorBreakers,includePositions:!1});function g(ce){var ye=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(r.b[0][0]++,X);r.f[0]++;var Oe=(r.s[1]++,(0,p.default)(ce,ye)),de=(r.s[2]++,(0,C.default)(Oe,ye));return r.s[3]++,(0,B.format)(de,ye)}function Z(ce){var ye=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(r.b[1][0]++,X);return r.f[1]++,r.s[4]++,(0,U.toHTML)(ce,ye)}},{"./format":2,"./lexer":4,"./parser":5,"./stringify":6,"./tags":7}],4:[function(t,i,n){var r=function(){var Se="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/lexer.js",ze="99f1269b85a36e02e6fcfa2eb5c9423a8a428848",Re=(function(){}).constructor,Ke=new Re("return this")(),Ze="__coverage__",Te={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/lexer.js",statementMap:{0:{start:{line:9,column:16},end:{line:9,column:30}},1:{start:{line:10,column:14},end:{line:10,column:42}},2:{start:{line:11,column:2},end:{line:19,column:3}},3:{start:{line:12,column:17},end:{line:12,column:30}},4:{start:{line:13,column:4},end:{line:18,column:5}},5:{start:{line:14,column:6},end:{line:14,column:21}},6:{start:{line:15,column:6},end:{line:15,column:25}},7:{start:{line:17,column:6},end:{line:17,column:23}},8:{start:{line:23,column:14},end:{line:23,column:34}},9:{start:{line:24,column:2},end:{line:24,column:41}},10:{start:{line:28,column:2},end:{line:32,column:3}},11:{start:{line:36,column:2},end:{line:40,column:3}},12:{start:{line:44,column:16},end:{line:49,column:3}},13:{start:{line:50,column:2},end:{line:50,column:12}},14:{start:{line:51,column:2},end:{line:51,column:21}},15:{start:{line:55,column:42},end:{line:55,column:47}},16:{start:{line:56,column:14},end:{line:56,column:24}},17:{start:{line:57,column:2},end:{line:72,column:3}},18:{start:{line:58,column:18},end:{line:58,column:38}},19:{start:{line:59,column:4},end:{line:59,column:18}},20:{start:{line:60,column:4},end:{line:71,column:5}},21:{start:{line:61,column:24},end:{line:61,column:57}},22:{start:{line:62,column:6},end:{line:70,column:7}},23:{start:{line:63,column:8},end:{line:63,column:25}},24:{start:{line:65,column:24},end:{line:65,column:37}},25:{start:{line:66,column:24},end:{line:66,column:45}},26:{start:{line:67,column:8},end:{line:69,column:9}},27:{start:{line:68,column:10},end:{line:68,column:36}},28:{start:{line:75,column:21},end:{line:75,column:34}},29:{start:{line:77,column:2},end:{line:87,column:3}},30:{start:{line:78,column:20},end:{line:78,column:43}},31:{start:{line:79,column:4},end:{line:81,column:5}},32:{start:{line:80,column:6},end:{line:80,column:20}},33:{start:{line:82,column:17},end:{line:82,column:40}},34:{start:{line:83,column:4},end:{line:85,column:5}},35:{start:{line:84,column:6},end:{line:84,column:20}},36:{start:{line:86,column:4},end:{line:86,column:23}},37:{start:{line:91,column:15},end:{line:91,column:21}},38:{start:{line:92,column:26},end:{line:92,column:31}},39:{start:{line:93,column:16},end:{line:93,column:48}},40:{start:{line:94,column:2},end:{line:94,column:40}},41:{start:{line:94,column:34},end:{line:94,column:40}},42:{start:{line:95,column:2},end:{line:97,column:3}},43:{start:{line:96,column:4},end:{line:96,column:24}},44:{start:{line:99,column:16},end:{line:99,column:38}},45:{start:{line:100,column:18},end:{line:100,column:52}},46:{start:{line:101,column:2},end:{line:101,column:38}},47:{start:{line:102,column:14},end:{line:102,column:36}},48:{start:{line:103,column:2},end:{line:103,column:60}},49:{start:{line:107,column:26},end:{line:107,column:31}},50:{start:{line:108,column:16},end:{line:108,column:38}},51:{start:{line:109,column:2},end:{line:109,column:32}},52:{start:{line:110,column:19},end:{line:110,column:53}},53:{start:{line:111,column:19},end:{line:111,column:33}},54:{start:{line:112,column:2},end:{line:114,column:3}},55:{start:{line:113,column:4},end:{line:113,column:40}},56:{start:{line:116,column:18},end:{line:116,column:55}},57:{start:{line:117,column:2},end:{line:117,column:41}},58:{start:{line:118,column:2},end:{line:125,column:4}},59:{start:{line:129,column:26},end:{line:129,column:31}},60:{start:{line:131,column:23},end:{line:131,column:53}},61:{start:{line:132,column:18},end:{line:132,column:36}},62:{start:{line:133,column:18},end:{line:133,column:40}},63:{start:{line:134,column:4},end:{line:134,column:46}},64:{start:{line:135,column:4},end:{line:135,column:68}},65:{start:{line:137,column:18},end:{line:137,column:35}},66:{start:{line:138,column:2},end:{line:138,column:25}},67:{start:{line:140,column:22},end:{line:140,column:48}},68:{start:{line:141,column:18},end:{line:141,column:35}},69:{start:{line:142,column:4},end:{line:142,column:46}},70:{start:{line:143,column:16},end:{line:143,column:38}},71:{start:{line:144,column:4},end:{line:144,column:64}},72:{start:{line:146,column:2},end:{line:146,column:16}},73:{start:{line:150,column:19},end:{line:150,column:23}},74:{start:{line:152,column:2},end:{line:152,column:30}},75:{start:{line:156,column:26},end:{line:156,column:31}},76:{start:{line:157,column:14},end:{line:157,column:24}},77:{start:{line:158,column:14},end:{line:158,column:28}},78:{start:{line:159,column:2},end:{line:164,column:3}},79:{start:{line:160,column:17},end:{line:160,column:34}},80:{start:{line:161,column:22},end:{line:161,column:79}},81:{start:{line:162,column:4},end:{line:162,column:24}},82:{start:{line:162,column:19},end:{line:162,column:24}},83:{start:{line:163,column:4},end:{line:163,column:11}},84:{start:{line:166,column:12},end:{line:166,column:21}},85:{start:{line:167,column:2},end:{line:172,column:3}},86:{start:{line:168,column:17},end:{line:168,column:32}},87:{start:{line:169,column:22},end:{line:169,column:79}},88:{start:{line:170,column:4},end:{line:170,column:25}},89:{start:{line:170,column:20},end:{line:170,column:25}},90:{start:{line:171,column:4},end:{line:171,column:9}},91:{start:{line:174,column:2},end:{line:174,column:34}},92:{start:{line:175,column:18},end:{line:175,column:39}},93:{start:{line:176,column:2},end:{line:179,column:4}},94:{start:{line:180,column:2},end:{line:180,column:16}},95:{start:{line:184,column:34},end:{line:184,column:39}},96:{start:{line:185,column:15},end:{line:185,column:29}},97:{start:{line:186,column:14},end:{line:186,column:18}},98:{start:{line:187,column:18},end:{line:187,column:24}},99:{start:{line:188,column:16},end:{line:188,column:18}},100:{start:{line:189,column:14},end:{line:189,column:24}},101:{start:{line:190,column:2},end:{line:227,column:3}},102:{start:{line:191,column:17},end:{line:191,column:35}},103:{start:{line:192,column:4},end:{line:199,column:5}},104:{start:{line:193,column:25},end:{line:193,column:39}},105:{start:{line:194,column:6},end:{line:196,column:7}},106:{start:{line:195,column:8},end:{line:195,column:20}},107:{start:{line:197,column:6},end:{line:197,column:14}},108:{start:{line:198,column:6},end:{line:198,column:14}},109:{start:{line:201,column:21},end:{line:201,column:49}},110:{start:{line:202,column:4},end:{line:207,column:5}},111:{start:{line:203,column:6},end:{line:205,column:7}},112:{start:{line:204,column:8},end:{line:204,column:48}},113:{start:{line:206,column:6},end:{line:206,column:11}},114:{start:{line:209,column:22},end:{line:209,column:44}},115:{start:{line:210,column:4},end:{line:217,column:5}},116:{start:{line:211,column:6},end:{line:213,column:7}},117:{start:{line:212,column:8},end:{line:212,column:48}},118:{start:{line:214,column:6},end:{line:214,column:28}},119:{start:{line:215,column:6},end:{line:215,column:14}},120:{start:{line:216,column:6},end:{line:216,column:14}},121:{start:{line:219,column:25},end:{line:219,column:54}},122:{start:{line:220,column:4},end:{line:224,column:5}},123:{start:{line:221,column:6},end:{line:221,column:18}},124:{start:{line:222,column:6},end:{line:222,column:14}},125:{start:{line:223,column:6},end:{line:223,column:14}},126:{start:{line:226,column:4},end:{line:226,column:12}},127:{start:{line:228,column:2},end:{line:228,column:37}},128:{start:{line:230,column:15},end:{line:230,column:27}},129:{start:{line:231,column:15},end:{line:231,column:26}},130:{start:{line:232,column:2},end:{line:269,column:3}},131:{start:{line:233,column:17},end:{line:233,column:25}},132:{start:{line:234,column:22},end:{line:234,column:46}},133:{start:{line:235,column:4},end:{line:253,column:5}},134:{start:{line:236,column:25},end:{line:236,column:37}},135:{start:{line:237,column:6},end:{line:252,column:7}},136:{start:{line:238,column:8},end:{line:243,column:9}},137:{start:{line:239,column:26},end:{line:239,column:43}},138:{start:{line:240,column:10},end:{line:240,column:47}},139:{start:{line:241,column:10},end:{line:241,column:16}},140:{start:{line:242,column:10},end:{line:242,column:18}},141:{start:{line:244,column:26},end:{line:244,column:38}},142:{start:{line:245,column:8},end:{line:245,column:14}},143:{start:{line:246,column:8},end:{line:251,column:9}},144:{start:{line:247,column:26},end:{line:247,column:48}},145:{start:{line:248,column:10},end:{line:248,column:47}},146:{start:{line:249,column:10},end:{line:249,column:16}},147:{start:{line:250,column:10},end:{line:250,column:18}},148:{start:{line:254,column:4},end:{line:266,column:5}},149:{start:{line:255,column:25},end:{line:255,column:37}},150:{start:{line:256,column:6},end:{line:261,column:7}},151:{start:{line:257,column:24},end:{line:257,column:41}},152:{start:{line:258,column:8},end:{line:258,column:45}},153:{start:{line:259,column:8},end:{line:259,column:14}},154:{start:{line:260,column:8},end:{line:260,column:16}},155:{start:{line:263,column:22},end:{line:263,column:39}},156:{start:{line:264,column:6},end:{line:264,column:43}},157:{start:{line:265,column:6},end:{line:265,column:14}},158:{start:{line:268,column:4},end:{line:268,column:38}},159:{start:{line:272,column:13},end:{line:272,column:20}},160:{start:{line:275,column:34},end:{line:275,column:39}},161:{start:{line:276,column:22},end:{line:276,column:43}},162:{start:{line:277,column:14},end:{line:277,column:24}},163:{start:{line:278,column:14},end:{line:278,column:28}},164:{start:{line:279,column:2},end:{line:311,column:3}},165:{start:{line:280,column:20},end:{line:280,column:44}},166:{start:{line:281,column:4},end:{line:284,column:5}},167:{start:{line:282,column:6},end:{line:282,column:20}},168:{start:{line:283,column:6},end:{line:283,column:11}},169:{start:{line:286,column:29},end:{line:286,column:51}},170:{start:{line:287,column:4},end:{line:287,column:48}},171:{start:{line:288,column:21},end:{line:288,column:66}},172:{start:{line:289,column:17},end:{line:289,column:33}},173:{start:{line:290,column:4},end:{line:293,column:5}},174:{start:{line:291,column:6},end:{line:291,column:37}},175:{start:{line:292,column:6},end:{line:292,column:14}},176:{start:{line:295,column:4},end:{line:306,column:5}},177:{start:{line:296,column:24},end:{line:296,column:46}},178:{start:{line:297,column:6},end:{line:297,column:42}},179:{start:{line:298,column:6},end:{line:305,column:8}},180:{start:{line:308,column:4},end:{line:308,column:39}},181:{start:{line:309,column:4},end:{line:309,column:56}},182:{start:{line:310,column:4},end:{line:310,column:9}}},fnMap:{0:{name:"feedPosition",decl:{start:{line:8,column:16},end:{line:8,column:28}},loc:{start:{line:8,column:50},end:{line:20,column:1}},line:8},1:{name:"jumpPosition",decl:{start:{line:22,column:16},end:{line:22,column:28}},loc:{start:{line:22,column:50},end:{line:25,column:1}},line:22},2:{name:"makeInitialPosition",decl:{start:{line:27,column:16},end:{line:27,column:35}},loc:{start:{line:27,column:39},end:{line:33,column:1}},line:27},3:{name:"copyPosition",decl:{start:{line:35,column:16},end:{line:35,column:28}},loc:{start:{line:35,column:40},end:{line:41,column:1}},line:35},4:{name:"lexer",decl:{start:{line:43,column:24},end:{line:43,column:29}},loc:{start:{line:43,column:45},end:{line:52,column:1}},line:43},5:{name:"lex",decl:{start:{line:54,column:16},end:{line:54,column:19}},loc:{start:{line:54,column:28},end:{line:73,column:1}},line:54},6:{name:"findTextEnd",decl:{start:{line:76,column:16},end:{line:76,column:27}},loc:{start:{line:76,column:41},end:{line:88,column:1}},line:76},7:{name:"lexText",decl:{start:{line:90,column:16},end:{line:90,column:23}},loc:{start:{line:90,column:32},end:{line:104,column:1}},line:90},8:{name:"lexComment",decl:{start:{line:106,column:16},end:{line:106,column:26}},loc:{start:{line:106,column:35},end:{line:126,column:1}},line:106},9:{name:"lexTag",decl:{start:{line:128,column:16},end:{line:128,column:22}},loc:{start:{line:128,column:31},end:{line:147,column:1}},line:128},10:{name:"isWhitespaceChar",decl:{start:{line:151,column:16},end:{line:151,column:32}},loc:{start:{line:151,column:40},end:{line:153,column:1}},line:151},11:{name:"lexTagName",decl:{start:{line:155,column:16},end:{line:155,column:26}},loc:{start:{line:155,column:35},end:{line:181,column:1}},line:155},12:{name:"lexTagAttributes",decl:{start:{line:183,column:16},end:{line:183,column:32}},loc:{start:{line:183,column:41},end:{line:270,column:1}},line:183},13:{name:"lexSkipTag",decl:{start:{line:274,column:16},end:{line:274,column:26}},loc:{start:{line:274,column:44},end:{line:312,column:1}},line:274}},branchMap:{0:{loc:{start:{line:13,column:4},end:{line:18,column:5}},type:"if",locations:[{start:{line:13,column:4},end:{line:18,column:5}},{start:{line:13,column:4},end:{line:18,column:5}}],line:13},1:{loc:{start:{line:60,column:4},end:{line:71,column:5}},type:"if",locations:[{start:{line:60,column:4},end:{line:71,column:5}},{start:{line:60,column:4},end:{line:71,column:5}}],line:60},2:{loc:{start:{line:62,column:6},end:{line:70,column:7}},type:"if",locations:[{start:{line:62,column:6},end:{line:70,column:7}},{start:{line:62,column:6},end:{line:70,column:7}}],line:62},3:{loc:{start:{line:67,column:8},end:{line:69,column:9}},type:"if",locations:[{start:{line:67,column:8},end:{line:69,column:9}},{start:{line:67,column:8},end:{line:69,column:9}}],line:67},4:{loc:{start:{line:79,column:4},end:{line:81,column:5}},type:"if",locations:[{start:{line:79,column:4},end:{line:81,column:5}},{start:{line:79,column:4},end:{line:81,column:5}}],line:79},5:{loc:{start:{line:83,column:4},end:{line:85,column:5}},type:"if",locations:[{start:{line:83,column:4},end:{line:85,column:5}},{start:{line:83,column:4},end:{line:85,column:5}}],line:83},6:{loc:{start:{line:83,column:8},end:{line:83,column:63}},type:"binary-expr",locations:[{start:{line:83,column:8},end:{line:83,column:20}},{start:{line:83,column:24},end:{line:83,column:36}},{start:{line:83,column:40},end:{line:83,column:63}}],line:83},7:{loc:{start:{line:94,column:2},end:{line:94,column:40}},type:"if",locations:[{start:{line:94,column:2},end:{line:94,column:40}},{start:{line:94,column:2},end:{line:94,column:40}}],line:94},8:{loc:{start:{line:95,column:2},end:{line:97,column:3}},type:"if",locations:[{start:{line:95,column:2},end:{line:97,column:3}},{start:{line:95,column:2},end:{line:97,column:3}}],line:95},9:{loc:{start:{line:112,column:2},end:{line:114,column:3}},type:"if",locations:[{start:{line:112,column:2},end:{line:114,column:3}},{start:{line:112,column:2},end:{line:114,column:3}}],line:112},10:{loc:{start:{line:134,column:32},end:{line:134,column:45}},type:"cond-expr",locations:[{start:{line:134,column:40},end:{line:134,column:41}},{start:{line:134,column:44},end:{line:134,column:45}}],line:134},11:{loc:{start:{line:142,column:32},end:{line:142,column:45}},type:"cond-expr",locations:[{start:{line:142,column:40},end:{line:142,column:41}},{start:{line:142,column:44},end:{line:142,column:45}}],line:142},12:{loc:{start:{line:161,column:24},end:{line:161,column:78}},type:"binary-expr",locations:[{start:{line:161,column:24},end:{line:161,column:46}},{start:{line:161,column:50},end:{line:161,column:62}},{start:{line:161,column:66},end:{line:161,column:78}}],line:161},13:{loc:{start:{line:162,column:4},end:{line:162,column:24}},type:"if",locations:[{start:{line:162,column:4},end:{line:162,column:24}},{start:{line:162,column:4},end:{line:162,column:24}}],line:162},14:{loc:{start:{line:169,column:24},end:{line:169,column:78}},type:"binary-expr",locations:[{start:{line:169,column:24},end:{line:169,column:46}},{start:{line:169,column:50},end:{line:169,column:62}},{start:{line:169,column:66},end:{line:169,column:78}}],line:169},15:{loc:{start:{line:170,column:4},end:{line:170,column:25}},type:"if",locations:[{start:{line:170,column:4},end:{line:170,column:25}},{start:{line:170,column:4},end:{line:170,column:25}}],line:170},16:{loc:{start:{line:192,column:4},end:{line:199,column:5}},type:"if",locations:[{start:{line:192,column:4},end:{line:199,column:5}},{start:{line:192,column:4},end:{line:199,column:5}}],line:192},17:{loc:{start:{line:194,column:6},end:{line:196,column:7}},type:"if",locations:[{start:{line:194,column:6},end:{line:196,column:7}},{start:{line:194,column:6},end:{line:196,column:7}}],line:194},18:{loc:{start:{line:201,column:21},end:{line:201,column:49}},type:"binary-expr",locations:[{start:{line:201,column:21},end:{line:201,column:33}},{start:{line:201,column:37},end:{line:201,column:49}}],line:201},19:{loc:{start:{line:202,column:4},end:{line:207,column:5}},type:"if",locations:[{start:{line:202,column:4},end:{line:207,column:5}},{start:{line:202,column:4},end:{line:207,column:5}}],line:202},20:{loc:{start:{line:203,column:6},end:{line:205,column:7}},type:"if",locations:[{start:{line:203,column:6},end:{line:205,column:7}},{start:{line:203,column:6},end:{line:205,column:7}}],line:203},21:{loc:{start:{line:210,column:4},end:{line:217,column:5}},type:"if",locations:[{start:{line:210,column:4},end:{line:217,column:5}},{start:{line:210,column:4},end:{line:217,column:5}}],line:210},22:{loc:{start:{line:211,column:6},end:{line:213,column:7}},type:"if",locations:[{start:{line:211,column:6},end:{line:213,column:7}},{start:{line:211,column:6},end:{line:213,column:7}}],line:211},23:{loc:{start:{line:219,column:25},end:{line:219,column:54}},type:"binary-expr",locations:[{start:{line:219,column:25},end:{line:219,column:38}},{start:{line:219,column:42},end:{line:219,column:54}}],line:219},24:{loc:{start:{line:220,column:4},end:{line:224,column:5}},type:"if",locations:[{start:{line:220,column:4},end:{line:224,column:5}},{start:{line:220,column:4},end:{line:224,column:5}}],line:220},25:{loc:{start:{line:235,column:4},end:{line:253,column:5}},type:"if",locations:[{start:{line:235,column:4},end:{line:253,column:5}},{start:{line:235,column:4},end:{line:253,column:5}}],line:235},26:{loc:{start:{line:237,column:6},end:{line:252,column:7}},type:"if",locations:[{start:{line:237,column:6},end:{line:252,column:7}},{start:{line:237,column:6},end:{line:252,column:7}}],line:237},27:{loc:{start:{line:237,column:10},end:{line:237,column:51}},type:"binary-expr",locations:[{start:{line:237,column:10},end:{line:237,column:20}},{start:{line:237,column:24},end:{line:237,column:51}}],line:237},28:{loc:{start:{line:238,column:8},end:{line:243,column:9}},type:"if",locations:[{start:{line:238,column:8},end:{line:243,column:9}},{start:{line:238,column:8},end:{line:243,column:9}}],line:238},29:{loc:{start:{line:246,column:8},end:{line:251,column:9}},type:"if",locations:[{start:{line:246,column:8},end:{line:251,column:9}},{start:{line:246,column:8},end:{line:251,column:9}}],line:246},30:{loc:{start:{line:254,column:4},end:{line:266,column:5}},type:"if",locations:[{start:{line:254,column:4},end:{line:266,column:5}},{start:{line:254,column:4},end:{line:266,column:5}}],line:254},31:{loc:{start:{line:256,column:6},end:{line:261,column:7}},type:"if",locations:[{start:{line:256,column:6},end:{line:261,column:7}},{start:{line:256,column:6},end:{line:261,column:7}}],line:256},32:{loc:{start:{line:256,column:10},end:{line:256,column:56}},type:"binary-expr",locations:[{start:{line:256,column:10},end:{line:256,column:20}},{start:{line:256,column:24},end:{line:256,column:56}}],line:256},33:{loc:{start:{line:281,column:4},end:{line:284,column:5}},type:"if",locations:[{start:{line:281,column:4},end:{line:284,column:5}},{start:{line:281,column:4},end:{line:284,column:5}}],line:281},34:{loc:{start:{line:290,column:4},end:{line:293,column:5}},type:"if",locations:[{start:{line:290,column:4},end:{line:293,column:5}},{start:{line:290,column:4},end:{line:293,column:5}}],line:290},35:{loc:{start:{line:295,column:4},end:{line:306,column:5}},type:"if",locations:[{start:{line:295,column:4},end:{line:306,column:5}},{start:{line:295,column:4},end:{line:306,column:5}}],line:295}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0,33:0,34:0,35:0,36:0,37:0,38:0,39:0,40:0,41:0,42:0,43:0,44:0,45:0,46:0,47:0,48:0,49:0,50:0,51:0,52:0,53:0,54:0,55:0,56:0,57:0,58:0,59:0,60:0,61:0,62:0,63:0,64:0,65:0,66:0,67:0,68:0,69:0,70:0,71:0,72:0,73:0,74:0,75:0,76:0,77:0,78:0,79:0,80:0,81:0,82:0,83:0,84:0,85:0,86:0,87:0,88:0,89:0,90:0,91:0,92:0,93:0,94:0,95:0,96:0,97:0,98:0,99:0,100:0,101:0,102:0,103:0,104:0,105:0,106:0,107:0,108:0,109:0,110:0,111:0,112:0,113:0,114:0,115:0,116:0,117:0,118:0,119:0,120:0,121:0,122:0,123:0,124:0,125:0,126:0,127:0,128:0,129:0,130:0,131:0,132:0,133:0,134:0,135:0,136:0,137:0,138:0,139:0,140:0,141:0,142:0,143:0,144:0,145:0,146:0,147:0,148:0,149:0,150:0,151:0,152:0,153:0,154:0,155:0,156:0,157:0,158:0,159:0,160:0,161:0,162:0,163:0,164:0,165:0,166:0,167:0,168:0,169:0,170:0,171:0,172:0,173:0,174:0,175:0,176:0,177:0,178:0,179:0,180:0,181:0,182:0},f:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0,0],7:[0,0],8:[0,0],9:[0,0],10:[0,0],11:[0,0],12:[0,0,0],13:[0,0],14:[0,0,0],15:[0,0],16:[0,0],17:[0,0],18:[0,0],19:[0,0],20:[0,0],21:[0,0],22:[0,0],23:[0,0],24:[0,0],25:[0,0],26:[0,0],27:[0,0],28:[0,0],29:[0,0],30:[0,0],31:[0,0],32:[0,0],33:[0,0],34:[0,0],35:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},ft=Ke[Ze]||(Ke[Ze]={});return ft[Se]&&ft[Se].hash===ze?ft[Se]:(Te.hash=ze,ft[Se]=Te)}();Object.defineProperty(n,"__esModule",{value:!0}),n.feedPosition=p,n.jumpPosition=S,n.makeInitialPosition=C,n.copyPosition=B,n.default=U,n.lex=k,n.findTextEnd=X,n.lexText=g,n.lexComment=Z,n.lexTag=ce,n.isWhitespaceChar=Oe,n.lexTagName=de,n.lexTagAttributes=se,n.lexSkipTag=Fe;var h=t("./compat");function p(Se,ze,Re){r.f[0]++;var Ke=(r.s[0]++,Se.index),Ze=(r.s[1]++,Se.index=Ke+Re);r.s[2]++;for(var Te=Ke;Te<Ze;Te++){var ft=(r.s[3]++,ze.charAt(Te));r.s[4]++,ft===`
`?(r.b[0][0]++,r.s[5]++,Se.line++,r.s[6]++,Se.column=0):(r.b[0][1]++,r.s[7]++,Se.column++)}}function S(Se,ze,Re){r.f[1]++;var Ke=(r.s[8]++,Re-Se.index);return r.s[9]++,p(Se,ze,Ke)}function C(){return r.f[2]++,r.s[10]++,{index:0,column:0,line:0}}function B(Se){return r.f[3]++,r.s[11]++,{index:Se.index,line:Se.line,column:Se.column}}function U(Se,ze){r.f[4]++;var Re=(r.s[12]++,{str:Se,options:ze,position:C(),tokens:[]});return r.s[13]++,k(Re),r.s[14]++,Re.tokens}function k(Se){r.f[5]++;var ze=(r.s[15]++,Se),Re=ze.str,Ke=ze.options.childlessTags,Ze=(r.s[16]++,Re.length);for(r.s[17]++;Se.position.index<Ze;){var Te=(r.s[18]++,Se.position.index);if(r.s[19]++,g(Se),r.s[20]++,Se.position.index===Te){r.b[1][0]++;var ft=(r.s[21]++,(0,h.startsWith)(Re,"!--",Te+1));if(r.s[22]++,ft)r.b[2][0]++,r.s[23]++,Z(Se);else{r.b[2][1]++;var Ce=(r.s[24]++,ce(Se)),De=(r.s[25]++,Ce.toLowerCase());r.s[26]++,(0,h.arrayIncludes)(Ke,De)?(r.b[3][0]++,r.s[27]++,Fe(Ce,Se)):r.b[3][1]++}}else r.b[1][1]++}}var Q=(r.s[28]++,/[A-Za-z0-9]/);function X(Se,ze){for(r.f[6]++,r.s[29]++;;){var Re=(r.s[30]++,Se.indexOf("<",ze));if(r.s[31]++,Re===-1)return r.b[4][0]++,r.s[32]++,Re;r.b[4][1]++;var Ke=(r.s[33]++,Se.charAt(Re+1));if(r.s[34]++,r.b[6][0]++,Ke==="/"||(r.b[6][1]++,Ke==="!")||(r.b[6][2]++,Q.test(Ke)))return r.b[5][0]++,r.s[35]++,Re;r.b[5][1]++,r.s[36]++,ze=Re+1}}function g(Se){r.f[7]++;var ze=(r.s[37]++,"text"),Re=(r.s[38]++,Se),Ke=Re.str,Ze=Re.position,Te=(r.s[39]++,X(Ke,Ze.index));if(r.s[40]++,Te===Ze.index){r.b[7][0]++,r.s[41]++;return}else r.b[7][1]++;r.s[42]++,Te===-1?(r.b[8][0]++,r.s[43]++,Te=Ke.length):r.b[8][1]++;var ft=(r.s[44]++,B(Ze)),Ce=(r.s[45]++,Ke.slice(Ze.index,Te));r.s[46]++,S(Ze,Ke,Te);var De=(r.s[47]++,B(Ze));r.s[48]++,Se.tokens.push({type:ze,content:Ce,position:{start:ft,end:De}})}function Z(Se){r.f[8]++;var ze=(r.s[49]++,Se),Re=ze.str,Ke=ze.position,Ze=(r.s[50]++,B(Ke));r.s[51]++,p(Ke,Re,4);var Te=(r.s[52]++,Re.indexOf("-->",Ke.index)),ft=(r.s[53]++,Te+3);r.s[54]++,Te===-1?(r.b[9][0]++,r.s[55]++,Te=ft=Re.length):r.b[9][1]++;var Ce=(r.s[56]++,Re.slice(Ke.index,Te));r.s[57]++,S(Ke,Re,ft),r.s[58]++,Se.tokens.push({type:"comment",content:Ce,position:{start:Ze,end:B(Ke)}})}function ce(Se){r.f[9]++;var ze=(r.s[59]++,Se),Re=ze.str,Ke=ze.position;{var Ze=(r.s[60]++,Re.charAt(Ke.index+1)),Te=(r.s[61]++,Ze==="/"),ft=(r.s[62]++,B(Ke));r.s[63]++,p(Ke,Re,Te?(r.b[10][0]++,2):(r.b[10][1]++,1)),r.s[64]++,Se.tokens.push({type:"tag-start",close:Te,position:{start:ft}})}var Ce=(r.s[65]++,de(Se));r.s[66]++,se(Se);{var De=(r.s[67]++,Re.charAt(Ke.index)),Ve=(r.s[68]++,De==="/");r.s[69]++,p(Ke,Re,Ve?(r.b[11][0]++,2):(r.b[11][1]++,1));var Ae=(r.s[70]++,B(Ke));r.s[71]++,Se.tokens.push({type:"tag-end",close:Ve,position:{end:Ae}})}return r.s[72]++,Ce}var ye=(r.s[73]++,/\s/);function Oe(Se){return r.f[10]++,r.s[74]++,ye.test(Se)}function de(Se){r.f[11]++;var ze=(r.s[75]++,Se),Re=ze.str,Ke=ze.position,Ze=(r.s[76]++,Re.length),Te=(r.s[77]++,Ke.index);for(r.s[78]++;Te<Ze;){var ft=(r.s[79]++,Re.charAt(Te)),Ce=(r.s[80]++,r.b[12][0]++,!(Oe(ft)||(r.b[12][1]++,ft==="/")||(r.b[12][2]++,ft===">")));if(r.s[81]++,Ce){r.b[13][0]++,r.s[82]++;break}else r.b[13][1]++;r.s[83]++,Te++}var De=(r.s[84]++,Te+1);for(r.s[85]++;De<Ze;){var Ve=(r.s[86]++,Re.charAt(De)),Ae=(r.s[87]++,r.b[14][0]++,!(Oe(Ve)||(r.b[14][1]++,Ve==="/")||(r.b[14][2]++,Ve===">")));if(r.s[88]++,Ae)r.b[15][1]++;else{r.b[15][0]++,r.s[89]++;break}r.s[90]++,De++}r.s[91]++,S(Ke,Re,De);var Xe=(r.s[92]++,Re.slice(Te,De));return r.s[93]++,Se.tokens.push({type:"tag",content:Xe}),r.s[94]++,Xe}function se(Se){r.f[12]++;var ze=(r.s[95]++,Se),Re=ze.str,Ke=ze.position,Ze=ze.tokens,Te=(r.s[96]++,Ke.index),ft=(r.s[97]++,null),Ce=(r.s[98]++,Te),De=(r.s[99]++,[]),Ve=(r.s[100]++,Re.length);for(r.s[101]++;Te<Ve;){var Ae=(r.s[102]++,Re.charAt(Te));if(r.s[103]++,ft){r.b[16][0]++;var Xe=(r.s[104]++,Ae===ft);r.s[105]++,Xe?(r.b[17][0]++,r.s[106]++,ft=null):r.b[17][1]++,r.s[107]++,Te++,r.s[108]++;continue}else r.b[16][1]++;var zi=(r.s[109]++,r.b[18][0]++,Ae==="/"||(r.b[18][1]++,Ae===">"));if(r.s[110]++,zi){r.b[19][0]++,r.s[111]++,Te!==Ce?(r.b[20][0]++,r.s[112]++,De.push(Re.slice(Ce,Te))):r.b[20][1]++,r.s[113]++;break}else r.b[19][1]++;var Ki=(r.s[114]++,Oe(Ae));if(r.s[115]++,Ki){r.b[21][0]++,r.s[116]++,Te!==Ce?(r.b[22][0]++,r.s[117]++,De.push(Re.slice(Ce,Te))):r.b[22][1]++,r.s[118]++,Ce=Te+1,r.s[119]++,Te++,r.s[120]++;continue}else r.b[21][1]++;var rt=(r.s[121]++,r.b[23][0]++,Ae==="'"||(r.b[23][1]++,Ae==='"'));if(r.s[122]++,rt){r.b[24][0]++,r.s[123]++,ft=Ae,r.s[124]++,Te++,r.s[125]++;continue}else r.b[24][1]++;r.s[126]++,Te++}r.s[127]++,S(Ke,Re,Te);var Li=(r.s[128]++,De.length),Qt=(r.s[129]++,"attribute");r.s[130]++;for(var Ri=0;Ri<Li;Ri++){var us=(r.s[131]++,De[Ri]),sn=(r.s[132]++,us.indexOf("=")===-1);if(r.s[133]++,sn){r.b[25][0]++;var Vt=(r.s[134]++,De[Ri+1]);if(r.s[135]++,r.b[27][0]++,Vt&&(r.b[27][1]++,(0,h.startsWith)(Vt,"="))){if(r.b[26][0]++,r.s[136]++,Vt.length>1){r.b[28][0]++;var hi=(r.s[137]++,us+Vt);r.s[138]++,Ze.push({type:Qt,content:hi}),r.s[139]++,Ri+=1,r.s[140]++;continue}else r.b[28][1]++;var ni=(r.s[141]++,De[Ri+2]);if(r.s[142]++,Ri+=1,r.s[143]++,ni){r.b[29][0]++;var vn=(r.s[144]++,us+"="+ni);r.s[145]++,Ze.push({type:Qt,content:vn}),r.s[146]++,Ri+=1,r.s[147]++;continue}else r.b[29][1]++}else r.b[26][1]++}else r.b[25][1]++;if(r.s[148]++,(0,h.endsWith)(us,"=")){r.b[30][0]++;var nn=(r.s[149]++,De[Ri+1]);if(r.s[150]++,r.b[32][0]++,nn&&(r.b[32][1]++,!(0,h.stringIncludes)(nn,"="))){r.b[31][0]++;var wa=(r.s[151]++,us+nn);r.s[152]++,Ze.push({type:Qt,content:wa}),r.s[153]++,Ri+=1,r.s[154]++;continue}else r.b[31][1]++;var pr=(r.s[155]++,us.slice(0,-1));r.s[156]++,Ze.push({type:Qt,content:pr}),r.s[157]++;continue}else r.b[30][1]++;r.s[158]++,Ze.push({type:Qt,content:us})}}var fe=(r.s[159]++,[].push);function Fe(Se,ze){r.f[13]++;var Re=(r.s[160]++,ze),Ke=Re.str,Ze=Re.position,Te=Re.tokens,ft=(r.s[161]++,Se.toLowerCase()),Ce=(r.s[162]++,Ke.length),De=(r.s[163]++,Ze.index);for(r.s[164]++;De<Ce;){var Ve=(r.s[165]++,Ke.indexOf("</",De));if(r.s[166]++,Ve===-1){r.b[33][0]++,r.s[167]++,g(ze),r.s[168]++;break}else r.b[33][1]++;var Ae=(r.s[169]++,B(Ze));r.s[170]++,S(Ae,Ke,Ve);var Xe=(r.s[171]++,{str:Ke,position:Ae,tokens:[]}),zi=(r.s[172]++,ce(Xe));if(r.s[173]++,ft!==zi.toLowerCase()){r.b[34][0]++,r.s[174]++,De=Xe.position.index,r.s[175]++;continue}else r.b[34][1]++;if(r.s[176]++,Ve!==Ze.index){r.b[35][0]++;var Ki=(r.s[177]++,B(Ze));r.s[178]++,S(Ze,Ke,Ve),r.s[179]++,Te.push({type:"text",content:Ke.slice(Ki.index,Ve),position:{start:Ki,end:B(Ze)}})}else r.b[35][1]++;r.s[180]++,fe.apply(Te,Xe.tokens),r.s[181]++,S(Ze,Ke,Xe.position.index),r.s[182]++;break}}},{"./compat":1}],5:[function(t,i,n){var r=function(){var U="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/parser.js",k="10fb0478bb046c7059c47c8225586b7e30f48474",Q=(function(){}).constructor,X=new Q("return this")(),g="__coverage__",Z={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/parser.js",statementMap:{0:{start:{line:4,column:15},end:{line:4,column:44}},1:{start:{line:5,column:16},end:{line:5,column:59}},2:{start:{line:6,column:2},end:{line:6,column:14}},3:{start:{line:7,column:2},end:{line:7,column:22}},4:{start:{line:11,column:21},end:{line:11,column:39}},5:{start:{line:12,column:2},end:{line:24,column:3}},6:{start:{line:13,column:23},end:{line:13,column:39}},7:{start:{line:14,column:4},end:{line:23,column:5}},8:{start:{line:15,column:28},end:{line:15,column:55}},9:{start:{line:16,column:6},end:{line:18,column:7}},10:{start:{line:17,column:8},end:{line:17,column:13}},11:{start:{line:19,column:6},end:{line:21,column:7}},12:{start:{line:20,column:8},end:{line:20,column:19}},13:{start:{line:22,column:6},end:{line:22,column:20}},14:{start:{line:25,column:2},end:{line:25,column:14}},15:{start:{line:29,column:2},end:{line:29,column:45}},16:{start:{line:30,column:2},end:{line:32,column:3}},17:{start:{line:31,column:4},end:{line:31,column:47}},18:{start:{line:33,column:2},end:{line:33,column:25}},19:{start:{line:37,column:28},end:{line:37,column:33}},20:{start:{line:38,column:16},end:{line:38,column:21}},21:{start:{line:39,column:14},end:{line:39,column:46}},22:{start:{line:40,column:14},end:{line:40,column:27}},23:{start:{line:41,column:17},end:{line:41,column:22}},24:{start:{line:42,column:2},end:{line:132,column:3}},25:{start:{line:43,column:18},end:{line:43,column:32}},26:{start:{line:44,column:4},end:{line:48,column:5}},27:{start:{line:45,column:6},end:{line:45,column:23}},28:{start:{line:46,column:6},end:{line:46,column:14}},29:{start:{line:47,column:6},end:{line:47,column:14}},30:{start:{line:50,column:21},end:{line:50,column:37}},31:{start:{line:51,column:4},end:{line:51,column:12}},32:{start:{line:52,column:20},end:{line:52,column:50}},33:{start:{line:53,column:4},end:{line:73,column:5}},34:{start:{line:54,column:18},end:{line:54,column:30}},35:{start:{line:55,column:25},end:{line:55,column:30}},36:{start:{line:56,column:6},end:{line:61,column:7}},37:{start:{line:57,column:8},end:{line:60,column:9}},38:{start:{line:58,column:10},end:{line:58,column:29}},39:{start:{line:59,column:10},end:{line:59,column:15}},40:{start:{line:62,column:6},end:{line:66,column:7}},41:{start:{line:63,column:25},end:{line:63,column:39}},42:{start:{line:64,column:8},end:{line:64,column:46}},43:{start:{line:64,column:41},end:{line:64,column:46}},44:{start:{line:65,column:8},end:{line:65,column:16}},45:{start:{line:67,column:6},end:{line:72,column:7}},46:{start:{line:68,column:8},end:{line:68,column:88}},47:{start:{line:69,column:8},end:{line:69,column:13}},48:{start:{line:71,column:8},end:{line:71,column:16}},49:{start:{line:75,column:25},end:{line:75,column:68}},50:{start:{line:76,column:34},end:{line:76,column:46}},51:{start:{line:77,column:4},end:{line:80,column:5}},52:{start:{line:78,column:56},end:{line:78,column:63}},53:{start:{line:79,column:6},end:{line:79,column:77}},54:{start:{line:82,column:4},end:{line:95,column:5}},55:{start:{line:85,column:25},end:{line:85,column:41}},56:{start:{line:86,column:6},end:{line:94,column:7}},57:{start:{line:87,column:8},end:{line:92,column:9}},58:{start:{line:88,column:10},end:{line:88,column:86}},59:{start:{line:89,column:32},end:{line:89,column:48}},60:{start:{line:90,column:10},end:{line:90,column:47}},61:{start:{line:91,column:10},end:{line:91,column:15}},62:{start:{line:93,column:8},end:{line:93,column:39}},63:{start:{line:97,column:21},end:{line:97,column:23}},64:{start:{line:99,column:4},end:{line:104,column:5}},65:{start:{line:100,column:6},end:{line:100,column:32}},66:{start:{line:101,column:6},end:{line:101,column:45}},67:{start:{line:101,column:40},end:{line:101,column:45}},68:{start:{line:102,column:6},end:{line:102,column:40}},69:{start:{line:103,column:6},end:{line:103,column:14}},70:{start:{line:106,column:4},end:{line:106,column:12}},71:{start:{line:107,column:21},end:{line:107,column:23}},72:{start:{line:108,column:21},end:{line:111,column:5}},73:{start:{line:112,column:24},end:{line:118,column:5}},74:{start:{line:119,column:4},end:{line:119,column:27}},75:{start:{line:121,column:24},end:{line:121,column:86}},76:{start:{line:122,column:4},end:{line:131,column:5}},77:{start:{line:123,column:19},end:{line:123,column:60}},78:{start:{line:124,column:25},end:{line:124,column:57}},79:{start:{line:125,column:6},end:{line:125,column:23}},80:{start:{line:126,column:6},end:{line:126,column:32}},81:{start:{line:127,column:31},end:{line:127,column:52}},82:{start:{line:128,column:6},end:{line:130,column:7}},83:{start:{line:129,column:8},end:{line:129,column:66}},84:{start:{line:133,column:2},end:{line:133,column:23}}},fnMap:{0:{name:"parser",decl:{start:{line:3,column:24},end:{line:3,column:30}},loc:{start:{line:3,column:49},end:{line:8,column:1}},line:3},1:{name:"hasTerminalParent",decl:{start:{line:10,column:16},end:{line:10,column:33}},loc:{start:{line:10,column:62},end:{line:26,column:1}},line:10},2:{name:"rewindStack",decl:{start:{line:28,column:16},end:{line:28,column:27}},loc:{start:{line:28,column:81},end:{line:34,column:1}},line:28},3:{name:"parse",decl:{start:{line:36,column:16},end:{line:36,column:21}},loc:{start:{line:36,column:30},end:{line:134,column:1}},line:36}},branchMap:{0:{loc:{start:{line:12,column:2},end:{line:24,column:3}},type:"if",locations:[{start:{line:12,column:2},end:{line:24,column:3}},{start:{line:12,column:2},end:{line:24,column:3}}],line:12},1:{loc:{start:{line:16,column:6},end:{line:18,column:7}},type:"if",locations:[{start:{line:16,column:6},end:{line:18,column:7}},{start:{line:16,column:6},end:{line:18,column:7}}],line:16},2:{loc:{start:{line:19,column:6},end:{line:21,column:7}},type:"if",locations:[{start:{line:19,column:6},end:{line:21,column:7}},{start:{line:19,column:6},end:{line:21,column:7}}],line:19},3:{loc:{start:{line:44,column:4},end:{line:48,column:5}},type:"if",locations:[{start:{line:44,column:4},end:{line:48,column:5}},{start:{line:44,column:4},end:{line:48,column:5}}],line:44},4:{loc:{start:{line:53,column:4},end:{line:73,column:5}},type:"if",locations:[{start:{line:53,column:4},end:{line:73,column:5}},{start:{line:53,column:4},end:{line:73,column:5}}],line:53},5:{loc:{start:{line:57,column:8},end:{line:60,column:9}},type:"if",locations:[{start:{line:57,column:8},end:{line:60,column:9}},{start:{line:57,column:8},end:{line:60,column:9}}],line:57},6:{loc:{start:{line:64,column:8},end:{line:64,column:46}},type:"if",locations:[{start:{line:64,column:8},end:{line:64,column:46}},{start:{line:64,column:8},end:{line:64,column:46}}],line:64},7:{loc:{start:{line:67,column:6},end:{line:72,column:7}},type:"if",locations:[{start:{line:67,column:6},end:{line:72,column:7}},{start:{line:67,column:6},end:{line:72,column:7}}],line:67},8:{loc:{start:{line:77,column:4},end:{line:80,column:5}},type:"if",locations:[{start:{line:77,column:4},end:{line:80,column:5}},{start:{line:77,column:4},end:{line:80,column:5}}],line:77},9:{loc:{start:{line:82,column:4},end:{line:95,column:5}},type:"if",locations:[{start:{line:82,column:4},end:{line:95,column:5}},{start:{line:82,column:4},end:{line:95,column:5}}],line:82},10:{loc:{start:{line:87,column:8},end:{line:92,column:9}},type:"if",locations:[{start:{line:87,column:8},end:{line:92,column:9}},{start:{line:87,column:8},end:{line:92,column:9}}],line:87},11:{loc:{start:{line:101,column:6},end:{line:101,column:45}},type:"if",locations:[{start:{line:101,column:6},end:{line:101,column:45}},{start:{line:101,column:6},end:{line:101,column:45}}],line:101},12:{loc:{start:{line:121,column:26},end:{line:121,column:85}},type:"binary-expr",locations:[{start:{line:121,column:26},end:{line:121,column:41}},{start:{line:121,column:45},end:{line:121,column:85}}],line:121},13:{loc:{start:{line:122,column:4},end:{line:131,column:5}},type:"if",locations:[{start:{line:122,column:4},end:{line:131,column:5}},{start:{line:122,column:4},end:{line:131,column:5}}],line:122},14:{loc:{start:{line:128,column:6},end:{line:130,column:7}},type:"if",locations:[{start:{line:128,column:6},end:{line:130,column:7}},{start:{line:128,column:6},end:{line:130,column:7}}],line:128}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0,15:0,16:0,17:0,18:0,19:0,20:0,21:0,22:0,23:0,24:0,25:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0,33:0,34:0,35:0,36:0,37:0,38:0,39:0,40:0,41:0,42:0,43:0,44:0,45:0,46:0,47:0,48:0,49:0,50:0,51:0,52:0,53:0,54:0,55:0,56:0,57:0,58:0,59:0,60:0,61:0,62:0,63:0,64:0,65:0,66:0,67:0,68:0,69:0,70:0,71:0,72:0,73:0,74:0,75:0,76:0,77:0,78:0,79:0,80:0,81:0,82:0,83:0,84:0},f:{0:0,1:0,2:0,3:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0],5:[0,0],6:[0,0],7:[0,0],8:[0,0],9:[0,0],10:[0,0],11:[0,0],12:[0,0],13:[0,0],14:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},ce=X[g]||(X[g]={});return ce[U]&&ce[U].hash===k?ce[U]:(Z.hash=k,ce[U]=Z)}();Object.defineProperty(n,"__esModule",{value:!0}),n.default=p,n.hasTerminalParent=S,n.rewindStack=C,n.parse=B;var h=t("./compat");function p(U,k){r.f[0]++;var Q=(r.s[0]++,{tagName:null,children:[]}),X=(r.s[1]++,{tokens:U,options:k,cursor:0,stack:[Q]});return r.s[2]++,B(X),r.s[3]++,Q.children}function S(U,k,Q){r.f[1]++;var X=(r.s[4]++,Q[U]);if(r.s[5]++,X){r.b[0][0]++;var g=(r.s[6]++,k.length-1);for(r.s[7]++;g>=0;){var Z=(r.s[8]++,k[g].tagName);if(r.s[9]++,Z===U){r.b[1][0]++,r.s[10]++;break}else r.b[1][1]++;if(r.s[11]++,(0,h.arrayIncludes)(X,Z))return r.b[2][0]++,r.s[12]++,!0;r.b[2][1]++,r.s[13]++,g--}}else r.b[0][1]++;return r.s[14]++,!1}function C(U,k,Q,X){r.f[2]++,r.s[15]++,U[k].position.end=X,r.s[16]++;for(var g=k+1,Z=U.length;g<Z;g++)r.s[17]++,U[g].position.end=Q;r.s[18]++,U.splice(k)}function B(U){r.f[3]++;var k=(r.s[19]++,U),Q=k.tokens,X=k.options,g=(r.s[20]++,U),Z=g.stack,ce=(r.s[21]++,Z[Z.length-1].children),ye=(r.s[22]++,Q.length),Oe=(r.s[23]++,U),de=Oe.cursor;for(r.s[24]++;de<ye;){var se=(r.s[25]++,Q[de]);if(r.s[26]++,se.type!=="tag-start"){r.b[3][0]++,r.s[27]++,ce.push(se),r.s[28]++,de++,r.s[29]++;continue}else r.b[3][1]++;var fe=(r.s[30]++,Q[++de]);r.s[31]++,de++;var Fe=(r.s[32]++,fe.content.toLowerCase());if(r.s[33]++,se.close){r.b[4][0]++;var Se=(r.s[34]++,Z.length),ze=(r.s[35]++,!1);for(r.s[36]++;--Se>-1;)if(r.s[37]++,Z[Se].tagName===Fe){r.b[5][0]++,r.s[38]++,ze=!0,r.s[39]++;break}else r.b[5][1]++;for(r.s[40]++;de<ye;){var Re=(r.s[41]++,Q[de]);if(r.s[42]++,Re.type!=="tag-end"){r.b[6][0]++,r.s[43]++;break}else r.b[6][1]++;r.s[44]++,de++}if(r.s[45]++,ze){r.b[7][0]++,r.s[46]++,C(Z,Se,se.position.start,Q[de-1].position.end),r.s[47]++;break}else{r.b[7][1]++,r.s[48]++;continue}}else r.b[4][1]++;var Ke=(r.s[49]++,(0,h.arrayIncludes)(X.closingTags,Fe)),Ze=(r.s[50]++,Ke);if(r.s[51]++,Ze){r.b[8][0]++;var Te=(r.s[52]++,X),ft=Te.closingTagAncestorBreakers;r.s[53]++,Ze=!S(Fe,Z,ft)}else r.b[8][1]++;if(r.s[54]++,Ze){r.b[9][0]++;var Ce=(r.s[55]++,Z.length-1);for(r.s[56]++;Ce>0;){if(r.s[57]++,Fe===Z[Ce].tagName){r.b[10][0]++,r.s[58]++,C(Z,Ce,se.position.start,se.position.start);var De=(r.s[59]++,Ce-1);r.s[60]++,ce=Z[De].children,r.s[61]++;break}else r.b[10][1]++;r.s[62]++,Ce=Ce-1}}else r.b[9][1]++;var Ve=(r.s[63]++,[]),Ae=void 0;for(r.s[64]++;de<ye;){if(r.s[65]++,Ae=Q[de],r.s[66]++,Ae.type==="tag-end"){r.b[11][0]++,r.s[67]++;break}else r.b[11][1]++;r.s[68]++,Ve.push(Ae.content),r.s[69]++,de++}r.s[70]++,de++;var Xe=(r.s[71]++,[]),zi=(r.s[72]++,{start:se.position.start,end:Ae.position.end}),Ki=(r.s[73]++,{type:"element",tagName:fe.content,attributes:Ve,children:Xe,position:zi});r.s[74]++,ce.push(Ki);var rt=(r.s[75]++,r.b[12][0]++,!(Ae.close||(r.b[12][1]++,(0,h.arrayIncludes)(X.voidTags,Fe))));if(r.s[76]++,rt){r.b[13][0]++;var Li=(r.s[77]++,Z.push({tagName:Fe,children:Xe,position:zi})),Qt=(r.s[78]++,{tokens:Q,options:X,cursor:de,stack:Z});r.s[79]++,B(Qt),r.s[80]++,de=Qt.cursor;var Ri=(r.s[81]++,Z.length===Li);r.s[82]++,Ri?(r.b[14][0]++,r.s[83]++,Ki.position.end=Q[de-1].position.end):r.b[14][1]++}else r.b[13][1]++}r.s[84]++,U.cursor=de}},{"./compat":1}],6:[function(t,i,n){var r=function(){var C="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/stringify.js",B="4a6a4628f3d12bd91f868fee07f716c74df89307",U=(function(){}).constructor,k=new U("return this")(),Q="__coverage__",X={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/stringify.js",statementMap:{0:{start:{line:4,column:2},end:{line:12,column:8}},1:{start:{line:5,column:25},end:{line:5,column:34}},2:{start:{line:6,column:4},end:{line:8,column:5}},3:{start:{line:7,column:6},end:{line:7,column:30}},4:{start:{line:9,column:24},end:{line:9,column:50}},5:{start:{line:10,column:18},end:{line:10,column:42}},6:{start:{line:11,column:4},end:{line:11,column:53}},7:{start:{line:16,column:2},end:{line:28,column:13}},8:{start:{line:17,column:4},end:{line:19,column:5}},9:{start:{line:18,column:6},end:{line:18,column:25}},10:{start:{line:20,column:4},end:{line:22,column:5}},11:{start:{line:21,column:6},end:{line:21,column:37}},12:{start:{line:23,column:44},end:{line:23,column:48}},13:{start:{line:24,column:26},end:{line:24,column:80}},14:{start:{line:25,column:4},end:{line:27,column:94}}},fnMap:{0:{name:"formatAttributes",decl:{start:{line:3,column:16},end:{line:3,column:32}},loc:{start:{line:3,column:46},end:{line:13,column:1}},line:3},1:{name:"(anonymous_1)",decl:{start:{line:4,column:27},end:{line:4,column:28}},loc:{start:{line:4,column:49},end:{line:12,column:3}},line:4},2:{name:"toHTML",decl:{start:{line:15,column:16},end:{line:15,column:22}},loc:{start:{line:15,column:39},end:{line:29,column:1}},line:15},3:{name:"(anonymous_3)",decl:{start:{line:16,column:18},end:{line:16,column:19}},loc:{start:{line:16,column:26},end:{line:28,column:3}},line:16}},branchMap:{0:{loc:{start:{line:6,column:4},end:{line:8,column:5}},type:"if",locations:[{start:{line:6,column:4},end:{line:8,column:5}},{start:{line:6,column:4},end:{line:8,column:5}}],line:6},1:{loc:{start:{line:10,column:18},end:{line:10,column:42}},type:"cond-expr",locations:[{start:{line:10,column:32},end:{line:10,column:35}},{start:{line:10,column:38},end:{line:10,column:42}}],line:10},2:{loc:{start:{line:17,column:4},end:{line:19,column:5}},type:"if",locations:[{start:{line:17,column:4},end:{line:19,column:5}},{start:{line:17,column:4},end:{line:19,column:5}}],line:17},3:{loc:{start:{line:20,column:4},end:{line:22,column:5}},type:"if",locations:[{start:{line:20,column:4},end:{line:22,column:5}},{start:{line:20,column:4},end:{line:22,column:5}}],line:20},4:{loc:{start:{line:25,column:11},end:{line:27,column:94}},type:"cond-expr",locations:[{start:{line:26,column:8},end:{line:26,column:53}},{start:{line:27,column:8},end:{line:27,column:94}}],line:25}},s:{0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0,9:0,10:0,11:0,12:0,13:0,14:0},f:{0:0,1:0,2:0,3:0},b:{0:[0,0],1:[0,0],2:[0,0],3:[0,0],4:[0,0]},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},g=k[Q]||(k[Q]={});return g[C]&&g[C].hash===B?g[C]:(X.hash=B,g[C]=X)}();Object.defineProperty(n,"__esModule",{value:!0}),n.formatAttributes=p,n.toHTML=S;var h=t("./compat");function p(C){return r.f[0]++,r.s[0]++,C.reduce(function(B,U){r.f[1]++;var k=(r.s[1]++,U),Q=k.key,X=k.value;if(r.s[2]++,X===null)return r.b[0][0]++,r.s[3]++,B+" "+Q;r.b[0][1]++;var g=(r.s[4]++,X.indexOf("'")!==-1),Z=(r.s[5]++,g?(r.b[1][0]++,'"'):(r.b[1][1]++,"'"));return r.s[6]++,B+" "+Q+"="+Z+X+Z},"")}function S(C,B){return r.f[2]++,r.s[7]++,C.map(function(U){if(r.f[3]++,r.s[8]++,U.type==="text")return r.b[2][0]++,r.s[9]++,U.content;if(r.b[2][1]++,r.s[10]++,U.type==="comment")return r.b[3][0]++,r.s[11]++,"<!--"+U.content+"-->";r.b[3][1]++;var k=(r.s[12]++,U),Q=k.tagName,X=k.attributes,g=k.children,Z=(r.s[13]++,(0,h.arrayIncludes)(B.voidTags,Q.toLowerCase()));return r.s[14]++,Z?(r.b[4][0]++,"<"+Q+p(X)+">"):(r.b[4][1]++,"<"+Q+p(X)+">"+S(g,B)+"</"+Q+">")}).join("")}n.default={toHTML:S}},{"./compat":1}],7:[function(t,i,n){var r=function(){var h="/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/tags.js",p="6039b9f65d15797c952509955976acf6930e65a4",S=(function(){}).constructor,C=new S("return this")(),B="__coverage__",U={path:"/Users/chrisandrejewski/Desktop/Work/github-repos/himalaya/src/tags.js",statementMap:{0:{start:{line:5,column:29},end:{line:5,column:60}},1:{start:{line:11,column:27},end:{line:14,column:1}},2:{start:{line:23,column:42},end:{line:32,column:1}},3:{start:{line:38,column:24},end:{line:42,column:1}}},fnMap:{},branchMap:{},s:{0:0,1:0,2:0,3:0},f:{},b:{},_coverageSchema:"332fd63041d2c1bcb487cc26dd0d5f7d97098a6c"},k=C[B]||(C[B]={});return k[h]&&k[h].hash===p?k[h]:(U.hash=p,k[h]=U)}();Object.defineProperty(n,"__esModule",{value:!0}),n.childlessTags=(r.s[0]++,["style","script","template"]),n.closingTags=(r.s[1]++,["html","head","body","p","dt","dd","li","option","thead","th","tbody","tr","td","tfoot","colgroup"]),n.closingTagAncestorBreakers=(r.s[2]++,{li:["ul","ol","menu"],dt:["dl"],dd:["dl"],tbody:["table"],thead:["table"],tfoot:["table"],tr:["table"],td:["table"]}),n.voidTags=(r.s[3]++,["!doctype","area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"])},{}]},{},[3])(3)})})();self.phet.chipper.packageObject={name:"scenery-lab-demo"};self.phet.chipper.stringRepos=[{repo:"joist",requirejsNamespace:"JOIST"},{repo:"scenery-phet",requirejsNamespace:"SCENERY_PHET"},{repo:"sun",requirejsNamespace:"SUN"},{repo:"tambo",requirejsNamespace:"TAMBO"},{repo:"vegas",requirejsNamespace:"VEGAS"}];self.phet.chipper.strings={en:{a11y:{numberSpinnerRoleDescription:{value:"number spinner"},close:{value:"Close"},closed:{value:"Closed"},titleClosePattern:{value:"{{title}}, Close."}}}};self.phet.chipper.localeData={en:{locale3:"eng",englishName:"English",localizedName:"English",direction:"ltr"}};self.sceneryLog=null;const Pg=document.createElement("canvas"),wy=Pg.getContext("2d");let Oa="";const q=new Yc("scenery");q.register("scratchCanvas",Pg);q.register("scratchContext",wy);function Cy(l){q.logString+=`${l.replace(/%c/g,"")}
`}function Ty(...l){self.console&&self.console.log&&self.console.log(...Array.prototype.slice.call(l,0))}const Ed={dirty:{name:"dirty",style:"color: #888;"},bounds:{name:"bounds",style:"color: #888;"},hitTest:{name:"hitTest",style:"color: #888;"},hitTestInternal:{name:"hitTestInternal",style:"color: #888;"},PerfCritical:{name:"Perf",style:"color: #f00;"},PerfMajor:{name:"Perf",style:"color: #aa0;"},PerfMinor:{name:"Perf",style:"color: #088;"},PerfVerbose:{name:"Perf",style:"color: #888;"},Cursor:{name:"Cursor",style:""},Stitch:{name:"Stitch",style:""},StitchDrawables:{name:"Stitch",style:""},GreedyStitcher:{name:"Greedy",style:"color: #088;"},GreedyVerbose:{name:"Greedy",style:"color: #888;"},RelativeTransform:{name:"RelativeTransform",style:"color: #606;"},BackboneDrawable:{name:"Backbone",style:"color: #a00;"},CanvasBlock:{name:"Canvas",style:""},WebGLBlock:{name:"WebGL",style:""},Display:{name:"Display",style:""},DOMBlock:{name:"DOM",style:""},Drawable:{name:"",style:""},FittedBlock:{name:"FittedBlock",style:""},Instance:{name:"Instance",style:""},InstanceTree:{name:"InstanceTree",style:""},ChangeInterval:{name:"ChangeInterval",style:"color: #0a0;"},SVGBlock:{name:"SVG",style:""},SVGGroup:{name:"SVGGroup",style:""},ImageSVGDrawable:{name:"ImageSVGDrawable",style:""},Paints:{name:"Paints",style:""},Filters:{name:"Filters",style:""},AlignBox:{name:"AlignBox",style:""},AlignGroup:{name:"AlignGroup",style:""},RichText:{name:"RichText",style:""},Sim:{name:"Sim",style:""},ParallelDOM:{name:"ParallelDOM",style:""},PDOMInstance:{name:"PDOMInstance",style:""},PDOMTree:{name:"PDOMTree",style:""},PDOMDisplaysInfo:{name:"PDOMDisplaysInfo",style:""},KeyboardFuzzer:{name:"KeyboardFuzzer",style:""},InputListener:{name:"InputListener",style:""},InputEvent:{name:"InputEvent",style:""},OnInput:{name:"OnInput",style:""},Pointer:{name:"Pointer",style:""},Input:{name:"Input",style:""},EventDispatch:{name:"EventDispatch",style:""},EventPath:{name:"EventPath",style:""}};dy(q,{logString:"",logFunction:function(...l){self.console&&self.console.log&&self.console.log(...Array.prototype.slice.call(l,0))},switchLogToConsole:function(){q.logFunction=Ty},switchLogToString:function(){self.console&&self.console.log("switching to string log"),q.logFunction=Cy},enableIndividualLog:function(l){if(l==="stitch"){this.enableIndividualLog("Stitch"),this.enableIndividualLog("StitchDrawables"),this.enableIndividualLog("GreedyStitcher"),this.enableIndividualLog("GreedyVerbose");return}if(l==="perf"){this.enableIndividualLog("PerfCritical"),this.enableIndividualLog("PerfMajor"),this.enableIndividualLog("PerfMinor"),this.enableIndividualLog("PerfVerbose");return}if(l==="input"){this.enableIndividualLog("InputListener"),this.enableIndividualLog("InputEvent"),this.enableIndividualLog("OnInput"),this.enableIndividualLog("Pointer"),this.enableIndividualLog("Input"),this.enableIndividualLog("EventDispatch"),this.enableIndividualLog("EventPath");return}if(l==="a11y"||l==="pdom"){this.enableIndividualLog("ParallelDOM"),this.enableIndividualLog("PDOMInstance"),this.enableIndividualLog("PDOMTree"),this.enableIndividualLog("PDOMDisplaysInfo");return}l&&(assert&&assert(Ed[l],`Unknown logger: ${l}, please use periods (.) to separate different log names`),self.sceneryLog[l]=self.sceneryLog[l]||function(e,t){const i=Ed[l],n=i.name?`[${i.name}] `:"";q.logFunction(`%c${Oa}%c${n}${e}`,"color: #ddd;",t||i.style)})},disableIndividualLog:function(l){l&&delete self.sceneryLog[l]},enableLogging:function(l){self.sceneryLog=function(e){q.logFunction(e)},self.sceneryLog.push=function(){Oa+="| "},self.sceneryLog.pop=function(){Oa=Oa.slice(0,-2)},self.sceneryLog.getDepth=function(){return Oa.length/2};for(let e=0;e<l.length;e++)this.enableIndividualLog(l[e])},disableLogging:function(){self.sceneryLog=null},isLoggingPerformance:function(){return self.sceneryLog.PerfCritical||self.sceneryLog.PerfMajor||self.sceneryLog.PerfMinor||self.sceneryLog.PerfVerbose}});const Qn={DISABLED_OPACITY:.45,DEFAULT_COLOR_PROFILE:"default",PROJECTOR_COLOR_PROFILE:"projector"};q.register("SceneryConstants",Qn);function it(l){return l instanceof Is||l instanceof vt}const vr=Ui.clamp,tl=Ui.linear,$r="(-?\\d{1,3}%?)",kd="(\\d+|\\d*\\.\\d+)",Ur="(\\d{1,3})";function Yr(l){let e=1;return l.endsWith("%")&&(e=2.55,l=l.slice(0,l.length-1)),Ui.roundSymmetric(Number(l)*e)}const wt=class wt{constructor(e,t,i,n){this.changeEmitter=new zt,this.set(e,t,i,n)}copy(){return new wt(this.r,this.g,this.b,this.a)}set(e,t,i,n){if(assert&&assert(e!==void 0,"Can't call Color.set( undefined )"),e===null)this.setRGBA(0,0,0,0);else if(typeof e=="string")this.setCSS(e);else if(e instanceof wt)this.setRGBA(e.r,e.g,e.b,e.a);else if(i===void 0){assert&&assert(t===void 0||typeof t=="number");const r=e>>16&255,h=e>>8&255,p=e>>0&255,S=t===void 0?1:t;this.setRGBA(r,h,p,S)}else assert&&assert(n===void 0||typeof n=="number"),this.setRGBA(e,t,i,n===void 0?1:n);return this}getRed(){return this.r}get red(){return this.getRed()}set red(e){this.setRed(e)}setRed(e){return this.setRGBA(e,this.g,this.b,this.a)}getGreen(){return this.g}get green(){return this.getGreen()}set green(e){this.setGreen(e)}setGreen(e){return this.setRGBA(this.r,e,this.b,this.a)}getBlue(){return this.b}get blue(){return this.getBlue()}set blue(e){this.setBlue(e)}setBlue(e){return this.setRGBA(this.r,this.g,e,this.a)}getAlpha(){return this.a}get alpha(){return this.getAlpha()}set alpha(e){this.setAlpha(e)}setAlpha(e){return this.setRGBA(this.r,this.g,this.b,e)}setRGBA(e,t,i,n){return this.r=Ui.roundSymmetric(vr(e,0,255)),this.g=Ui.roundSymmetric(vr(t,0,255)),this.b=Ui.roundSymmetric(vr(i,0,255)),this.a=vr(n,0,1),this.updateColor(),this}blend(e,t){const n=Math.pow(this.r,2.4),r=Math.pow(e.r,2.4),h=Math.pow(this.g,2.4),p=Math.pow(e.g,2.4),S=Math.pow(this.b,2.4),C=Math.pow(e.b,2.4),B=Math.pow(n+(r-n)*t,1/2.4),U=Math.pow(h+(p-h)*t,1/2.4),k=Math.pow(S+(C-S)*t,1/2.4),Q=this.a+(e.a-this.a)*t;return new wt(B,U,k,Q)}computeCSS(){if(this.a===1)return`rgb(${this.r},${this.g},${this.b})`;{let e=this.a.toFixed(20);for(;e.length>=2&&e.endsWith("0")&&e[e.length-2]!==".";)e=e.slice(0,e.length-1);const t=this.a===0||this.a===1?this.a:e;return`rgba(${this.r},${this.g},${this.b},${t})`}}toCSS(){return assert&&assert(this._css===this.computeCSS(),`CSS cached value is ${this._css}, but the computed value appears to be ${this.computeCSS()}`),this._css}setCSS(e){let t=!1;const i=wt.preprocessCSS(e);for(let n=0;n<wt.formatParsers.length;n++){const r=wt.formatParsers[n],h=r.regexp.exec(i);if(h){r.apply(this,h),t=!0;break}}if(!t)throw new Error(`Color unable to parse color string: ${e}`);return this.updateColor(),this}toNumber(){return(this.r<<16)+(this.g<<8)+this.b}updateColor(){assert&&assert(!this.immutable,"Cannot modify an immutable color. Likely caused by trying to mutate a color after it was used for a node fill/stroke"),assert&&assert(typeof this.red=="number"&&typeof this.green=="number"&&typeof this.blue=="number"&&typeof this.alpha=="number",`Ensure color components are numeric: ${this.toString()}`),assert&&assert(isFinite(this.red)&&isFinite(this.green)&&isFinite(this.blue)&&isFinite(this.alpha),"Ensure color components are finite and not NaN"),assert&&assert(this.red>=0&&this.red<=255&&this.green>=0&&this.green<=255&&this.red>=0&&this.red<=255&&this.alpha>=0&&this.alpha<=1,`Ensure color components are in the proper ranges: ${this.toString()}`);const e=this._css;this._css=this.computeCSS(),e!==this._css&&this.changeEmitter.emit()}setImmutable(){return assert&&(this.immutable=!0),this}getCanvasStyle(){return this.toCSS()}setHSLA(e,t,i,n){e=e%360/360,t=vr(t/100,0,1),i=vr(i/100,0,1);let r;i<.5?r=i*(t+1):r=i+t-i*t;const h=i*2-r;return this.r=Ui.roundSymmetric(wt.hueToRGB(h,r,e+1/3)*255),this.g=Ui.roundSymmetric(wt.hueToRGB(h,r,e)*255),this.b=Ui.roundSymmetric(wt.hueToRGB(h,r,e-1/3)*255),this.a=vr(n,0,1),this.updateColor(),this}equals(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}withAlpha(e){return new wt(this.r,this.g,this.b,e)}checkFactor(e){return assert&&assert(e===void 0||e>=0&&e<=1,`factor must be between 0 and 1: ${e}`),e===void 0?.7:e}brighterColor(e){e=this.checkFactor(e);const t=Math.min(255,Math.floor(this.r/e)),i=Math.min(255,Math.floor(this.g/e)),n=Math.min(255,Math.floor(this.b/e));return new wt(t,i,n,this.a)}colorUtilsBrighter(e){e=this.checkFactor(e);const t=Math.min(255,this.getRed()+Math.floor(e*(255-this.getRed()))),i=Math.min(255,this.getGreen()+Math.floor(e*(255-this.getGreen()))),n=Math.min(255,this.getBlue()+Math.floor(e*(255-this.getBlue())));return new wt(t,i,n,this.getAlpha())}darkerColor(e){e=this.checkFactor(e);const t=Math.max(0,Math.floor(e*this.r)),i=Math.max(0,Math.floor(e*this.g)),n=Math.max(0,Math.floor(e*this.b));return new wt(t,i,n,this.a)}colorUtilsDarker(e){e=this.checkFactor(e);const t=Math.max(0,this.getRed()-Math.floor(e*this.getRed())),i=Math.max(0,this.getGreen()-Math.floor(e*this.getGreen())),n=Math.max(0,this.getBlue()-Math.floor(e*this.getBlue()));return new wt(t,i,n,this.getAlpha())}colorUtilsBrightness(e){return e===0?this:e>0?this.colorUtilsBrighter(e):this.colorUtilsDarker(-e)}toString(){return`${this.constructor.name}[r:${this.r} g:${this.g} b:${this.b} a:${this.a}]`}toHexString(){let e=this.toNumber().toString(16);for(;e.length<6;)e=`0${e}`;return`#${e}`}toStateObject(){return{r:this.r,g:this.g,b:this.b,a:this.a}}static hueToRGB(e,t,i){return i<0&&(i=i+1),i>1&&(i=i-1),i*6<1?e+(t-e)*i*6:i*2<1?t:i*3<2?e+(t-e)*(2/3-i)*6:e}static toColor(e){return e===null?wt.TRANSPARENT:e instanceof wt?e:typeof e=="string"?new wt(e):wt.toColor(e.value)}static interpolateRGBA(e,t,i){if(i<0||i>1)throw new Error(`distance must be between 0 and 1: ${i}`);const n=Math.floor(tl(0,1,e.r,t.r,i)),r=Math.floor(tl(0,1,e.g,t.g,i)),h=Math.floor(tl(0,1,e.b,t.b,i)),p=tl(0,1,e.a,t.a,i);return new wt(n,r,h,p)}static supersampleBlend(e){const i=e.map(k=>Math.pow(k.r/255,2.2)),n=e.map(k=>Math.pow(k.g/255,2.2)),r=e.map(k=>Math.pow(k.b/255,2.2)),h=e.map(k=>Math.pow(k.a,2.2)),p=_.sum(h);if(p===0)return new wt(0,0,0,0);const S=_.sum(_.range(0,e.length).map(k=>i[k]*h[k]))/p,C=_.sum(_.range(0,e.length).map(k=>n[k]*h[k]))/p,B=_.sum(_.range(0,e.length).map(k=>r[k]*h[k]))/p,U=p/e.length;return new wt(Math.floor(Math.pow(S,1/2.2)*255),Math.floor(Math.pow(C,1/2.2)*255),Math.floor(Math.pow(B,1/2.2)*255),Math.pow(U,1/2.2))}static fromStateObject(e){return new wt(e.r,e.g,e.b,e.a)}static hsla(e,t,i,n){return new wt(0,0,0,1).setHSLA(e,t,i,n)}static checkPaintString(e){if(assert)try{Dy.setCSS(e)}catch{assert(!1,`The CSS string is an invalid color: ${e}`)}}static checkPaint(e){typeof e=="string"?wt.checkPaintString(e):it(e)&&typeof e.value=="string"&&wt.checkPaintString(e.value)}static getLuminance(e){const t=wt.toColor(e),i=t.red*.2126+t.green*.7152+t.blue*.0722;return assert&&assert(i>=0&&i<=255,`unexpected luminance: ${i}`),i}static toGrayscale(e){const t=wt.getLuminance(e);return new wt(t,t,t)}static isDarkColor(e,t=186){return assert&&assert(t>=0&&t<=255,"invalid luminanceThreshold"),wt.getLuminance(e)<t}static isLightColor(e,t){return!wt.isDarkColor(e,t)}static grayColor(e,t){return new wt(e,e,e,t)}static preprocessCSS(e){let t=e.replace(/ /g,"").toLowerCase();const i=wt.colorKeywords[t];return i&&(t=`#${i}`),t}static isCSSColorString(e){const t=wt.preprocessCSS(e);for(let i=0;i<wt.formatParsers.length;i++)if(wt.formatParsers[i].regexp.exec(t))return!0;return!1}};wt.formatParsers=[{regexp:/^transparent$/,apply:(e,t)=>{e.setRGBA(0,0,0,0)}},{regexp:/^#(\w{1})(\w{1})(\w{1})$/,apply:(e,t)=>{e.setRGBA(parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),1)}},{regexp:/^#(\w{2})(\w{2})(\w{2})$/,apply:(e,t)=>{e.setRGBA(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),1)}},{regexp:new RegExp(`^rgb\\(${$r},${$r},${$r}\\)$`),apply:(e,t)=>{e.setRGBA(Yr(t[1]),Yr(t[2]),Yr(t[3]),1)}},{regexp:new RegExp(`^rgba\\(${$r},${$r},${$r},${kd}\\)$`),apply:(e,t)=>{e.setRGBA(Yr(t[1]),Yr(t[2]),Yr(t[3]),Number(t[4]))}},{regexp:new RegExp(`^hsl\\(${Ur},${Ur}%,${Ur}%\\)$`),apply:(e,t)=>{e.setHSLA(Number(t[1]),Number(t[2]),Number(t[3]),1)}},{regexp:new RegExp(`^hsla\\(${Ur},${Ur}%,${Ur}%,${kd}\\)$`),apply:(e,t)=>{e.setHSLA(Number(t[1]),Number(t[2]),Number(t[3]),Number(t[4]))}}],wt.basicColorKeywords={aqua:"00ffff",black:"000000",blue:"0000ff",fuchsia:"ff00ff",gray:"808080",green:"008000",lime:"00ff00",maroon:"800000",navy:"000080",olive:"808000",purple:"800080",red:"ff0000",silver:"c0c0c0",teal:"008080",white:"ffffff",yellow:"ffff00"},wt.colorKeywords={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"778899",lightslategrey:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};let Me=wt;q.register("Color",Me);Me.BLACK=Me.black=new Me(0,0,0).setImmutable();Me.BLUE=Me.blue=new Me(0,0,255).setImmutable();Me.CYAN=Me.cyan=new Me(0,255,255).setImmutable();Me.DARK_GRAY=Me.darkGray=new Me(64,64,64).setImmutable();Me.GRAY=Me.gray=new Me(128,128,128).setImmutable();Me.GREEN=Me.green=new Me(0,255,0).setImmutable();Me.LIGHT_GRAY=Me.lightGray=new Me(192,192,192).setImmutable();Me.MAGENTA=Me.magenta=new Me(255,0,255).setImmutable();Me.ORANGE=Me.orange=new Me(255,200,0).setImmutable();Me.PINK=Me.pink=new Me(255,175,175).setImmutable();Me.RED=Me.red=new Me(255,0,0).setImmutable();Me.WHITE=Me.white=new Me(255,255,255).setImmutable();Me.YELLOW=Me.yellow=new Me(255,255,0).setImmutable();Me.TRANSPARENT=Me.transparent=new Me(0,0,0,0).setImmutable();const Dy=new Me("blue");Me.ColorIO=new li("ColorIO",{valueType:Me,documentation:"A color, with rgba",toStateObject:l=>l.toStateObject(),fromStateObject:l=>new Me(l.r,l.g,l.b,l.a),stateSchema:{r:Tt,g:Tt,b:Tt,a:Tt}});const Qe={};q.register("Features",Qe);function Vl(l){try{const e=document.createElement("canvas");e.width=1,e.height=1;const t=e.getContext("2d");t.fillStyle="black",t.fillRect(0,0,1,1);const i=e.toDataURL([l]),n=`data:${l}`;return i.slice(0,n.length)===n}catch{return!1}}function Gl(l,e){const t=document.createElement("canvas");t.width=1,t.height=1;const i=t.getContext("2d"),n=document.createElement("img");n.crossOrigin="Anonymous";const r=()=>{try{i.drawImage(n,0,0),t.toDataURL(),Qe[l]=!0}catch{Qe[l]=!1}};n.onload=r;try{n.src=e,n.complete&&r()}catch{Qe[l]=!1}}Qe.canvasPNGOutput=Vl("image/png");Qe.canvasJPEGOutput=Vl("image/jpeg");Qe.canvasGIFOutput=Vl("image/gif");Qe.canvasICONOutput=Vl("image/x-icon");Gl("canvasPNGInput","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQIW2NkYGD4DwABCQEBtxmN7wAAAABJRU5ErkJggg==");Gl("canvasJPEGInput","data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAMCAgICAgMCAgIDAwMDBAYEBAQEBAgGBgUGCQgKCgkICQkKDA8MCgsOCwkJDRENDg8QEBEQCgwSExIQEw8QEBD/2wBDAQMDAwQDBAgEBAgQCwkLEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBD/wAARCAABAAEDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD8qqKKKAP/2Q==");Gl("canvasSVGInput","data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIj8+DQo8c3ZnIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3cG9ydD0iMCAwIDEgMSIgd2lkdGg9IjEiIGhlaWdodD0iMSIgPg0KICA8cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMSIgaGVpZ2h0PSIxIiByeD0iMCIgcnk9IjAiIHN0eWxlPSJmaWxsOiBibGFjazsgc3Ryb2tlOiBub25lOyI+PC9yZWN0Pg0KPC9zdmc+DQo=");Gl("canvasGIFInput","data:image/gif;base64,R0lGODlhAQABAJEAAAAAAP///////wAAACH5BAEAAAIALAAAAAABAAEAAAICRAEAOw==");const Sg=document.createElement("canvas"),Ro=Sg.getContext("2d");Qe.toDataURLHD=ti(Sg,"toDataURLHD");Qe.createImageDataHD=ti(Ro,"createImageDataHD");Qe.getImageDataHD=ti(Ro,"getImageDataHD");Qe.putImageDataHD=ti(Ro,"putImageDataHD");Qe.currentTransform=ti(Ro,"currentTransform");Qe.canvasFilter=ti(Ro,"filter");const Zc=document.createElement("span"),yn=document.createElement("div");Qe.textStroke=ti(Zc.style,"textStroke");Qe.textStrokeColor=ti(Zc.style,"textStrokeColor");Qe.textStrokeWidth=ti(Zc.style,"textStrokeWidth");Qe.transform=ti(yn.style,"transform");Qe.transformOrigin=ti(yn.style,"transformOrigin");Qe.backfaceVisibility=ti(yn.style,"backfaceVisibility");Qe.borderRadius=ti(yn.style,"borderRadius");Qe.userSelect=ti(yn.style,"userSelect");Qe.touchAction=ti(yn.style,"touchAction");Qe.touchCallout=ti(yn.style,"touchCallout");Qe.userDrag=ti(yn.style,"userDrag");Qe.tapHighlightColor=ti(yn.style,"tapHighlightColor");Qe.fontSmoothing=ti(yn.style,"fontSmoothing");Qe.requestAnimationFrame=ti(self,"requestAnimationFrame");Qe.cancelAnimationFrame=ti(self,"cancelAnimationFrame");Qe.setStyle=(l,e,t)=>{e!==void 0&&(l.style[e]=t)};Qe.passive=!1;self.addEventListener("test",null,Object.defineProperty({},"passive",{get:()=>{Qe.passive=!0}}));const Ad=["normal","italic","oblique"],Od=["normal","small-caps"],Md=["normal","bold","bolder","lighter","100","200","300","400","500","600","700","800","900"],Nd=["normal","ultra-condensed","extra-condensed","condensed","semi-condensed","semi-expanded","expanded","extra-expanded","ultra-expanded"],ks=class ks extends yi{constructor(e){assert&&assert(e===void 0||typeof e=="object"&&Object.getPrototypeOf(e)===Object.prototype,"options, if provided, should be a raw object");const t=je()({style:"normal",variant:"normal",weight:"normal",stretch:"normal",size:"10px",lineHeight:"normal",family:"sans-serif",phetioType:ks.FontIO},e);assert&&assert(typeof t.weight=="string"||typeof t.weight=="number","Font weight should be specified as a string or number"),assert&&assert(typeof t.size=="string"||typeof t.size=="number","Font size should be specified as a string or number"),super(t),this._style=t.style,this._variant=t.variant,this._weight=`${t.weight}`,this._stretch=t.stretch,this._size=ks.castSize(t.size),this._lineHeight=t.lineHeight,this._family=t.family,assert&&assert(typeof this._style=="string"&&_.includes(Ad,this._style),'Font style must be one of "normal", "italic", or "oblique"'),assert&&assert(typeof this._variant=="string"&&_.includes(Od,this._variant),'Font variant must be "normal" or "small-caps"'),assert&&assert(typeof this._weight=="string"&&_.includes(Md,this._weight),'Font weight must be one of "normal", "bold", "bolder", "lighter", "100", "200", "300", "400", "500", "600", "700", "800", or "900"'),assert&&assert(typeof this._stretch=="string"&&_.includes(Nd,this._stretch),'Font stretch must be one of "normal", "ultra-condensed", "extra-condensed", "condensed", "semi-condensed", "semi-expanded", "expanded", "extra-expanded", or "ultra-expanded"'),assert&&assert(typeof this._size=="string"&&!_.includes(["0","1","2","3","4","5","6","7","8","9"],this._size[this._size.length-1]),"Font size must be either passed as a number (not a string, interpreted as px), or must contain a suffix for percentage, absolute or relative units, or an explicit size constant"),assert&&assert(typeof this._lineHeight=="string"),assert&&assert(typeof this._family=="string"),this._font=this.computeShorthand()}getFont(){return this._font}get font(){return this.getFont()}getStyle(){return this._style}get style(){return this.getStyle()}getVariant(){return this._variant}get variant(){return this.getVariant()}getWeight(){return this._weight}get weight(){return this.getWeight()}getStretch(){return this._stretch}get stretch(){return this.getStretch()}getSize(){return this._size}get size(){return this.getSize()}getNumericSize(){const e=this._size.match(/^(\d+)px$/);if(e)return Number(e[1]);const t=this._size.match(/^(\d+)pt$/);if(t)return .75*Number(t[1]);const i=this._size.match(/^(\d+)em$/);return i?Number(i[1])/16:12}get numericSize(){return this.getNumericSize()}getLineHeight(){return this._lineHeight}get lineHeight(){return this.getLineHeight()}getFamily(){return this._family}get family(){return this.getFamily()}copy(e){return new ks(ii({style:this._style,variant:this._variant,weight:this._weight,stretch:this._stretch,size:this._size,lineHeight:this._lineHeight,family:this._family},e))}computeShorthand(){let e="";return this._style!=="normal"&&(e+=`${this._style} `),this._variant!=="normal"&&(e+=`${this._variant} `),this._weight!=="normal"&&(e+=`${this._weight} `),this._stretch!=="normal"&&(e+=`${this._stretch} `),e+=this._size,this._lineHeight!=="normal"&&(e+=`/${this._lineHeight}`),e+=` ${this._family}`,e}toCSS(){return this.getFont()}static castSize(e){return typeof e=="number"?`${e}px`:e}static isFontStyle(e){return Ad.includes(e)}static isFontVariant(e){return Od.includes(e)}static isFontWeight(e){return Md.includes(e)}static isFontStretch(e){return Nd.includes(e)}static fromCSS(e){const t={},i=_.filter(e.split(/[\x09\x0A\x0C\x0D\x20]/),n=>n.length>0);for(let n=0;n<i.length;n++){const r=i[n];if(r!=="normal")if(ks.isFontStyle(r))assert&&assert(t.style===void 0,`Style cannot be applied twice. Already set to "${t.style}", attempt to replace with "${r}"`),t.style=r;else if(ks.isFontVariant(r))assert&&assert(t.variant===void 0,`Variant cannot be applied twice. Already set to "${t.variant}", attempt to replace with "${r}"`),t.variant=r;else if(ks.isFontWeight(r))assert&&assert(t.weight===void 0,`Weight cannot be applied twice. Already set to "${t.weight}", attempt to replace with "${r}"`),t.weight=r;else if(ks.isFontStretch(r))assert&&assert(t.stretch===void 0,`Stretch cannot be applied twice. Already set to "${t.stretch}", attempt to replace with "${r}"`),t.stretch=r;else{const h=r.split(/\//);t.size=h[0],h[1]&&(t.lineHeight=h[1]),t.family=i.slice(n+1).join(" ");break}}return new ks(t)}};ks.DEFAULT=new ks;let ki=ks;q.register("Font",ki);ki.FontIO=new li("FontIO",{valueType:ki,documentation:"Font handling for text drawing. Options:<ul><li><strong>style:</strong> normal      &mdash; normal | italic | oblique </li><li><strong>variant:</strong> normal    &mdash; normal | small-caps </li><li><strong>weight:</strong> normal     &mdash; normal | bold | bolder | lighter | 100 | 200 | 300 | 400 | 500 | 600 | 700 | 800 | 900 </li><li><strong>stretch:</strong> normal    &mdash; normal | ultra-condensed | extra-condensed | condensed | semi-condensed | semi-expanded | expanded | extra-expanded | ultra-expanded </li><li><strong>size:</strong> 10px         &mdash; absolute-size | relative-size | length | percentage -- unitless number interpreted as px. absolute suffixes: cm, mm, in, pt, pc, px. relative suffixes: em, ex, ch, rem, vw, vh, vmin, vmax. </li><li><strong>lineHeight:</strong> normal &mdash; normal | number | length | percentage -- NOTE: Canvas spec forces line-height to normal </li><li><strong>family:</strong> sans-serif &mdash; comma-separated list of families, including generic families (serif, sans-serif, cursive, fantasy, monospace). ideally escape with double-quotes</li></ul>",toStateObject:l=>({style:l.getStyle(),variant:l.getVariant(),weight:l.getWeight(),stretch:l.getStretch(),size:l.getSize(),lineHeight:l.getLineHeight(),family:l.getFamily()}),fromStateObject(l){return new ki(l)},stateSchema:{style:si,variant:si,weight:si,stretch:si,size:si,lineHeight:si,family:si}});const ne={};q.register("Renderer",ne);ne.numActiveRenderers=4;ne.bitsPerRenderer=5;ne.bitmaskRendererArea=255;ne.bitmaskCurrentRendererArea=15;ne.bitmaskLacksOffset=65536;ne.bitmaskLacksShift=16;ne.bitmaskNodeDefault=ne.bitmaskRendererArea;ne.bitmaskCanvas=1;ne.bitmaskSVG=2;ne.bitmaskDOM=4;ne.bitmaskWebGL=8;ne.bitmaskSingleCanvas=256;ne.bitmaskSingleSVG=512;ne.bitmaskNotPainted=4096;ne.bitmaskBoundsValid=8192;ne.bitmaskNoPDOM=16384;ne.bitmaskLacksCanvas=ne.bitmaskCanvas<<ne.bitmaskLacksShift;ne.bitmaskLacksSVG=ne.bitmaskSVG<<ne.bitmaskLacksShift;ne.bitmaskLacksDOM=ne.bitmaskDOM<<ne.bitmaskLacksShift;ne.bitmaskLacksWebGL=ne.bitmaskWebGL<<ne.bitmaskLacksShift;ne.isCanvas=function(l){return(l&ne.bitmaskCanvas)!==0};ne.isSVG=function(l){return(l&ne.bitmaskSVG)!==0};ne.isDOM=function(l){return(l&ne.bitmaskDOM)!==0};ne.isWebGL=function(l){return(l&ne.bitmaskWebGL)!==0};const Iy={canvas:ne.bitmaskCanvas,svg:ne.bitmaskSVG,dom:ne.bitmaskDOM,webgl:ne.bitmaskWebGL};ne.fromName=function(l){return Iy[l]};ne.stripBitmask=function(l){return l&ne.bitmaskRendererArea};ne.createOrderBitmask=function(l,e,t,i){return l=l||0,e=e||0,t=t||0,i=i||0,l|e<<5|t<<10|i<<15};ne.bitmaskOrder=function(l,e){return e>0&&(l=l>>5*e),l&ne.bitmaskCurrentRendererArea};ne.bitmaskOrderFirst=function(l){return l&ne.bitmaskCurrentRendererArea};ne.bitmaskOrderSecond=function(l){return l>>5&ne.bitmaskCurrentRendererArea};ne.bitmaskOrderThird=function(l){return l>>10&ne.bitmaskCurrentRendererArea};ne.bitmaskOrderFourth=function(l){return l>>15&ne.bitmaskCurrentRendererArea};ne.pushOrderBitmask=function(l,e){assert&&assert(typeof l=="number"),assert&&assert(typeof e=="number");let t=e;const i=ne.bitsPerRenderer*ne.numActiveRenderers;for(let n=0;n<=i;n+=ne.bitsPerRenderer){const r=l>>n&ne.bitmaskCurrentRendererArea;if(r===t)return l;if(r===0)return l=l|t<<n,l;if(l=l&~(ne.bitmaskCurrentRendererArea<<n),l=l|t<<n,t=r,t===e)return l}throw new Error("pushOrderBitmask overflow")};ne.createSelfDrawable=function(l,e,t,i){let n;if(ne.isCanvas(t))n=e.createCanvasDrawable(t,l);else if(ne.isSVG(t))n=e.createSVGDrawable(t,l);else if(ne.isDOM(t))n=e.createDOMDrawable(t,l);else if(ne.isWebGL(t))n=e.createWebGLDrawable(t,l);else throw new Error(`Unrecognized renderer: ${t}`);return assert&&_.each(e.drawableMarkFlags,r=>{const h=`markDirty${r[0].toUpperCase()}${r.slice(1)}`;assert(typeof n[h]=="function",`Did not find ${h}`)}),n.setFittable(i),n};ne.webglCustom=1;ne.webglTexturedTriangles=2;ne.webglVertexColorPolygons=3;const Gt="http://www.w3.org/2000/svg";q.register("svgns",Gt);const ia="http://www.w3.org/1999/xlink";q.register("xlinkns",ia);function zn(l,e){return new We(l,e)}const vh=Qe.transform,xy=Qe.transformOrigin||"transformOrigin";let Rd=!0,_h;const Dt={prepareForTransform(l){l.style[xy]="top left"},applyPreparedTransform(l,e){e.style[vh]=l.getCSSTransform()},setTransform(l,e){e.style[vh]=l},unsetTransform(l){l.style[vh]=""},polyfillRequestAnimationFrame(){(!self.requestAnimationFrame||!self.cancelAnimationFrame)&&(!Qe.requestAnimationFrame||!Qe.cancelAnimationFrame?(self.requestAnimationFrame=l=>{const e=Date.now();return self.setTimeout(()=>{l(Date.now()-e)},16)},self.cancelAnimationFrame=clearTimeout):(self.requestAnimationFrame=self[Qe.requestAnimationFrame],self.cancelAnimationFrame=self[Qe.cancelAnimationFrame]))},backingStorePixelRatio(l){return l.webkitBackingStorePixelRatio||l.mozBackingStorePixelRatio||l.msBackingStorePixelRatio||l.oBackingStorePixelRatio||l.backingStorePixelRatio||1},backingScale(l){if("devicePixelRatio"in window){const e=Dt.backingStorePixelRatio(l);return self.devicePixelRatio/e}return 1},supportsNativeCanvasFilter(){return!!Qe.canvasFilter},supportsImageDataCanvasFilter(){return Dt.backingStorePixelRatio(q.scratchContext)===1},scanBounds(l,e,t){const i=_.map(_.range(e),()=>!1),n=_.map(_.range(e),()=>!1);for(let B=0;B<e;B++)for(let U=0;U<e;U++){const k=4*(U*e+B);(l.data[k]!==0||l.data[k+1]!==0||l.data[k+2]!==0||l.data[k+3]!==0)&&(i[B]=!0,n[U]=!0)}const r=_.indexOf(i,!0),h=_.lastIndexOf(i,!0),p=_.indexOf(n,!0),S=_.lastIndexOf(n,!0),C=e/16;return{minBounds:new Be(r<1||r>=e-1?Number.POSITIVE_INFINITY:t.inversePosition2(zn(r+1+C,0)).x,p<1||p>=e-1?Number.POSITIVE_INFINITY:t.inversePosition2(zn(0,p+1+C)).y,h<1||h>=e-1?Number.NEGATIVE_INFINITY:t.inversePosition2(zn(h-C,0)).x,S<1||S>=e-1?Number.NEGATIVE_INFINITY:t.inversePosition2(zn(0,S-C)).y),maxBounds:new Be(r<1||r>=e-1?Number.NEGATIVE_INFINITY:t.inversePosition2(zn(r-1-C,0)).x,p<1||p>=e-1?Number.NEGATIVE_INFINITY:t.inversePosition2(zn(0,p-1-C)).y,h<1||h>=e-1?Number.POSITIVE_INFINITY:t.inversePosition2(zn(h+2+C,0)).x,S<1||S>=e-1?Number.POSITIVE_INFINITY:t.inversePosition2(zn(0,S+2+C)).y)}},canvasAccurateBounds(l,e){const t=e&&e.precision?e.precision:.001,i=e&&e.resolution?e.resolution:128,n=e&&e.initialScale?e.initialScale:1/16;let r=Be.NOTHING,h=Be.EVERYTHING;const p=document.createElement("canvas");p.width=i,p.height=i;const S=p.getContext("2d");function C(ce){S.save(),ce.matrix.canvasSetTransform(S),l(S),S.restore();const ye=S.getImageData(0,0,i,i),Oe=Dt.scanBounds(ye,i,ce);return S.clearRect(0,0,i,i),Oe}function B(ce){const Oe=(i-4)/(ce.maxX-ce.minX),de=(i-2*2)/(ce.maxY-ce.minY),se=-Oe*ce.minX+2,fe=-de*ce.minY+2;return new Fs($e.translation(se,fe).timesMatrix($e.scaling(Oe,de)))}const U=new Fs;U.append($e.translation(i/2,i/2)),U.append($e.scaling(n));const k=C(U);r=r.union(k.minBounds),h=h.intersection(k.maxBounds);let Q,X,g;for(Q=h.minY,X=h.maxY;isFinite(r.minX)&&isFinite(h.minX)&&Math.abs(r.minX-h.minX)>t&&(g=C(B(new Be(h.minX,Q,r.minX,X))),!(r.minX<=g.minBounds.minX&&h.minX>=g.maxBounds.minX));)r=r.withMinX(Math.min(r.minX,g.minBounds.minX)),h=h.withMinX(Math.max(h.minX,g.maxBounds.minX)),Q=Math.max(Q,g.maxBounds.minY),X=Math.min(X,g.maxBounds.maxY);for(Q=h.minY,X=h.maxY;isFinite(r.maxX)&&isFinite(h.maxX)&&Math.abs(r.maxX-h.maxX)>t&&(g=C(B(new Be(r.maxX,Q,h.maxX,X))),!(r.maxX>=g.minBounds.maxX&&h.maxX<=g.maxBounds.maxX));)r=r.withMaxX(Math.max(r.maxX,g.minBounds.maxX)),h=h.withMaxX(Math.min(h.maxX,g.maxBounds.maxX)),Q=Math.max(Q,g.maxBounds.minY),X=Math.min(X,g.maxBounds.maxY);for(Q=h.minX,X=h.maxX;isFinite(r.minY)&&isFinite(h.minY)&&Math.abs(r.minY-h.minY)>t&&(g=C(B(new Be(Q,h.minY,X,r.minY))),!(r.minY<=g.minBounds.minY&&h.minY>=g.maxBounds.minY));)r=r.withMinY(Math.min(r.minY,g.minBounds.minY)),h=h.withMinY(Math.max(h.minY,g.maxBounds.minY)),Q=Math.max(Q,g.maxBounds.minX),X=Math.min(X,g.maxBounds.maxX);for(Q=h.minX,X=h.maxX;isFinite(r.maxY)&&isFinite(h.maxY)&&Math.abs(r.maxY-h.maxY)>t&&(g=C(B(new Be(Q,r.maxY,X,h.maxY))),!(r.maxY>=g.minBounds.maxY&&h.maxY<=g.maxBounds.maxY));)r=r.withMaxY(Math.max(r.maxY,g.minBounds.maxY)),h=h.withMaxY(Math.min(h.maxY,g.maxBounds.maxY)),Q=Math.max(Q,g.maxBounds.minX),X=Math.min(X,g.maxBounds.maxX);const Z=new Be(isFinite(r.minX)&&isFinite(h.minX)?(r.minX+h.minX)/2:Number.POSITIVE_INFINITY,isFinite(r.minY)&&isFinite(h.minY)?(r.minY+h.minY)/2:Number.POSITIVE_INFINITY,isFinite(r.maxX)&&isFinite(h.maxX)?(r.maxX+h.maxX)/2:Number.NEGATIVE_INFINITY,isFinite(r.maxY)&&isFinite(h.maxY)?(r.maxY+h.maxY)/2:Number.NEGATIVE_INFINITY);return Z.minBounds=r,Z.maxBounds=h,Z.isConsistent=h.containsBounds(r),Z.precision=Math.max(Math.abs(r.minX-h.minX),Math.abs(r.minY-h.minY),Math.abs(r.maxX-h.maxX),Math.abs(r.maxY-h.maxY)),Z},toPowerOf2(l){let e=1;for(;e<l;)e*=2;return e},createShader(l,e,t){const i=l.createShader(t);return l.shaderSource(i,e),l.compileShader(i),l.getShaderParameter(i,l.COMPILE_STATUS)||(console.log("GLSL compile error:"),console.log(l.getShaderInfoLog(i)),console.log(e)),i},applyWebGLContextDefaults(l){l.clearColor(0,0,0,0),l.enable(l.BLEND),l.blendFunc(l.ONE,l.ONE_MINUS_SRC_ALPHA)},setWebGLEnabled(l){Rd=l},checkWebGLSupport(l){if(!Rd)return!1;const e=document.createElement("canvas"),t={failIfMajorPerformanceCaveat:!0};try{const i=!!self.WebGLRenderingContext&&(e.getContext("webgl",t)||e.getContext("experimental-webgl",t));if(!i)return!1;if(l){for(let n=0;n<l.length;n++)if(i.getExtension(l[n])===null)return!1}return!0}catch{return!1}},checkIE11StencilSupport(){const l=document.createElement("canvas");try{const e=!!self.WebGLRenderingContext&&(l.getContext("webgl")||l.getContext("experimental-webgl"));return e?(e.clearStencil(0),e.getError()===0):!1}catch{return!1}},get isWebGLSupported(){return _h===void 0&&(_h=Dt.checkWebGLSupport()),_h},loseContext(l){const e=l.getExtension("WEBGL_lose_context");e&&(e.loseContext(),setTimeout(()=>{e.restoreContext()},1e3))},safariEmbeddingMarkWorkaround(l){if(_i.safari){const e=l.split("");let t="",i=!1;for(let n=0;n<e.length;n++){const r=e[n],h=r===""||r===""||r==="";i&&h&&(t+=""),t+=r,i=h}return t}else return l}};q.register("Utils",Dt);const kl=class kl{constructor(e,t){this.display=e,this.trail=t}};kl.FocusIO=new li("FocusIO",{valueType:kl,documentation:"A PhET-iO Type for the instance in the simulation which currently has keyboard focus. FocusIO is serialized into and Object with key `focusedPhetioElement` that is a list of PhET-iO Elements, from parent-most to child-most corresponding to the PhET-iO Element that was instrumented.",toStateObject:e=>{const t=[];return e.trail.nodes.forEach((i,n)=>{i.isPhetioInstrumented()&&t.push(i.tandem.phetioID)}),{focusedPhetioElement:t}},stateSchema:{focusedPhetioElement:Mo(si)}});let Js=kl;q.register("Focus",Js);const wg="ArrowRight",Cg="ArrowLeft",Tg="ArrowUp",Dg="ArrowDown",Qc="ShiftRight",Jc="ShiftLeft",eu="ControlLeft",tu="ControlRight",iu="AltLeft",su="AltRight",nu="MetaLeft",ru="MetaRight",au="OSLeft",ou="OSRight",Ey="KeyW",ky="KeyA",Ay="KeyS",Oy="KeyD",Ig="Digit0",xg="Digit1",Eg="Digit2",kg="Digit3",Ag="Digit4",Og="Digit5",Mg="Digit6",Ng="Digit7",Rg="Digit8",Bg="Digit9",cc="Alt",uc="Shift",dc="Control",Lh=[wg,Cg,Tg,Dg],Ph=[Ey,Ay,ky,Oy],My=[Ig,xg,Eg,kg,Ag,Og,Mg,Ng,Rg,Bg],Sh=[Jc,Qc],wh=[eu,tu],Ch=[iu,su],Bd=[nu,ru,au,ou],Ny=[cc,dc,uc],Ry=[iu,su,eu,tu,Jc,Qc,nu,ru,au,ou],By={valueType:Event},pc=[],me={KEY_SPACE:"Space",KEY_ENTER:"Enter",KEY_TAB:"Tab",KEY_RIGHT_ARROW:wg,KEY_LEFT_ARROW:Cg,KEY_UP_ARROW:Tg,KEY_DOWN_ARROW:Dg,KEY_SHIFT_LEFT:Jc,KEY_SHIFT_RIGHT:Qc,KEY_ALT_LEFT:iu,KEY_ALT_RIGHT:su,KEY_CONTROL_LEFT:eu,KEY_CONTROL_RIGHT:tu,KEY_META_LEFT:nu,KEY_META_RIGHT:ru,KEY_META_LEFT_FIREFOX:au,KEY_META_RIGHT_FIREFOX:ou,KEY_SHIFT:uc,KEY_ALT:cc,KEY_CONTROL:dc,KEY_ESCAPE:"Escape",KEY_DELETE:"Delete",KEY_BACKSPACE:"Backspace",KEY_PAGE_UP:"PageUp",KEY_PAGE_DOWN:"PageDown",KEY_END:"End",KEY_HOME:"Home",KEY_0:Ig,KEY_1:xg,KEY_2:Eg,KEY_3:kg,KEY_4:Ag,KEY_5:Og,KEY_6:Mg,KEY_7:Ng,KEY_8:Rg,KEY_9:Bg,KEY_NUMPAD_0:"Numpad0",KEY_NUMPAD_1:"Numpad1",KEY_NUMPAD_2:"Numpad2",KEY_NUMPAD_3:"Numpad3",KEY_NUMPAD_4:"Numpad4",KEY_NUMPAD_5:"Numpad5",KEY_NUMPAD_6:"Numpad6",KEY_NUMPAD_7:"Numpad7",KEY_NUMPAD_8:"Numpad8",KEY_NUMPAD_9:"Numpad9",KEY_NUMPAD_DECIMAL:"NumpadDecimal",KEY_NUMPAD_PLUS:"NumpadAdd",KEY_NUMPAD_MINUS:"NumpadSubtract",KEY_A:"KeyA",KEY_B:"KeyB",KEY_C:"KeyC",KEY_D:"KeyD",KEY_E:"KeyE",KEY_F:"KeyF",KEY_G:"KeyG",KEY_H:"KeyH",KEY_I:"KeyI",KEY_J:"KeyJ",KEY_K:"KeyK",KEY_L:"KeyL",KEY_M:"KeyM",KEY_N:"KeyN",KEY_O:"KeyO",KEY_P:"KeyP",KEY_Q:"KeyQ",KEY_R:"KeyR",KEY_S:"KeyS",KEY_T:"KeyT",KEY_U:"KeyU",KEY_V:"KeyV",KEY_W:"KeyW",KEY_X:"KeyX",KEY_Y:"KeyY",KEY_Z:"KeyZ",KEY_EQUALS:"Equal",KEY_PLUS:"Equal",KEY_MINUS:"Minus",KEY_PERIOD:"Period",ARROW_KEYS:Lh,WASD_KEYS:Ph,MOVEMENT_KEYS:Lh.concat(Ph),SHIFT_KEYS:Sh,CONTROL_KEYS:wh,ALT_KEYS:Ch,META_KEYS:Bd,MODIFIER_KEY_CODES:Ry,MODIFIER_KEY_TO_CODE_MAP:new Map([[cc,Ch],[uc,Sh],[dc,wh]]),isArrowKey(l){return me.isAnyKeyEvent(l,Lh)},isRangeKey(l){return me.isArrowKey(l)||me.isAnyKeyEvent(l,[me.KEY_PAGE_UP,me.KEY_PAGE_DOWN,me.KEY_HOME,me.KEY_END])},isNumberKey(l){return me.isAnyKeyEvent(l,My)},getNumberFromCode(l){return me.isNumberKey(l)&&l instanceof KeyboardEvent?Number(l.code.replace("Digit","")):null},isShiftKey(l){return me.isAnyKeyEvent(l,Sh)},isAltKey(l){return me.isAnyKeyEvent(l,Ch)},isControlKey(l){return me.isAnyKeyEvent(l,wh)},isMetaKey(l){return me.isAnyKeyEvent(l,Bd)},isWASDKey(l){return me.isAnyKeyEvent(l,Ph)},isMovementKey(l){return me.isAnyKeyEvent(l,me.MOVEMENT_KEYS)},isAnyKeyEvent(l,e){ir(l,By);const t=me.getEventCode(l);return t?e.includes(t):!1},isKeyEvent(l,e){return me.getEventCode(l)===e},getEventCode(l){let e=null;return l instanceof KeyboardEvent&&l.code&&(e=l.code,e.startsWith("Numpad")&&pc.includes(l.key)&&(e=l.key)),e},isModifierKey(l){return Ny.includes(l)},ALL_KEYS:pc};for(const l in me)me.hasOwnProperty(l)&&typeof me[l]=="string"&&pc.push(me[l]);q.register("KeyboardUtils",me);const sa={q:[me.KEY_Q],w:[me.KEY_W],e:[me.KEY_E],r:[me.KEY_R],t:[me.KEY_T],y:[me.KEY_Y],u:[me.KEY_U],i:[me.KEY_I],o:[me.KEY_O],p:[me.KEY_P],a:[me.KEY_A],s:[me.KEY_S],d:[me.KEY_D],f:[me.KEY_F],g:[me.KEY_G],h:[me.KEY_H],j:[me.KEY_J],k:[me.KEY_K],l:[me.KEY_L],z:[me.KEY_Z],x:[me.KEY_X],c:[me.KEY_C],v:[me.KEY_V],b:[me.KEY_B],n:[me.KEY_N],m:[me.KEY_M],0:[me.KEY_0,me.KEY_NUMPAD_0],1:[me.KEY_1,me.KEY_NUMPAD_1],2:[me.KEY_2,me.KEY_NUMPAD_2],3:[me.KEY_3,me.KEY_NUMPAD_3],4:[me.KEY_4,me.KEY_NUMPAD_4],5:[me.KEY_5,me.KEY_NUMPAD_5],6:[me.KEY_6,me.KEY_NUMPAD_6],7:[me.KEY_7,me.KEY_NUMPAD_7],8:[me.KEY_8,me.KEY_NUMPAD_8],9:[me.KEY_9,me.KEY_NUMPAD_9],enter:[me.KEY_ENTER],tab:[me.KEY_TAB],equals:[me.KEY_EQUALS],plus:[me.KEY_PLUS,me.KEY_NUMPAD_PLUS],minus:[me.KEY_MINUS,me.KEY_NUMPAD_MINUS],period:[me.KEY_PERIOD,me.KEY_NUMPAD_DECIMAL],escape:[me.KEY_ESCAPE],delete:[me.KEY_DELETE],backspace:[me.KEY_BACKSPACE],pageUp:[me.KEY_PAGE_UP],pageDown:[me.KEY_PAGE_DOWN],end:[me.KEY_END],home:[me.KEY_HOME],space:[me.KEY_SPACE],arrowLeft:[me.KEY_LEFT_ARROW],arrowRight:[me.KEY_RIGHT_ARROW],arrowUp:[me.KEY_UP_ARROW],arrowDown:[me.KEY_DOWN_ARROW],ctrl:me.CONTROL_KEYS,alt:me.ALT_KEYS,shift:me.SHIFT_KEYS,meta:me.META_KEYS};q.register("EnglishStringToCodeMap",sa);const Fy=["ctrl","alt","shift","meta"],Fg=l=>{for(const e in sa)if(sa.hasOwnProperty(e)&&sa[e].includes(l))return e;return null},Jn=new li("BooleanIO",{supertype:Lg,valueType:"boolean",documentation:"PhET-iO Type for Javascript's boolean primitive type",stateSchema:Kc.asValue("boolean",{valueType:"boolean"}),toStateObject:_.identity});dr.register("BooleanIO",Jn);const Fd=l=>Object.getPrototypeOf(l)===Object.prototype,gc=new li("ObjectLiteralIO",{documentation:"PhET-iO Type for object literals",isValidValue:Fd,supertype:Lg,stateSchema:Kc.asValue("object",{valueType:Object,isValidValue:Fd}),toStateObject:_.identity});dr.register("ObjectLiteralIO",gc);const rr=new li("EventIO",{valueType:self.Event,documentation:"A DOM Event",toStateObject:l=>On.serializeDomEvent(l),fromStateObject:l=>On.deserializeDomEvent(l),stateSchema:()=>({constructorName:si,altKey:Lt(Jn),button:Lt(Tt),charCode:Lt(Tt),clientX:Lt(Tt),clientY:Lt(Tt),code:Lt(si),ctrlKey:Lt(Jn),deltaMode:Lt(Tt),deltaX:Lt(Tt),deltaY:Lt(Tt),deltaZ:Lt(Tt),key:Lt(si),keyCode:Lt(Tt),metaKey:Lt(Jn),pageX:Lt(Tt),pageY:Lt(Tt),pointerId:Lt(Tt),pointerType:Lt(si),scale:Lt(Tt),shiftKey:Lt(Jn),target:Lt(gc),type:Lt(si),relatedTarget:Lt(gc),which:Lt(Tt)})});q.register("EventIO",rr);const lu=document.createElement("style");lu.type="text/css";document.head.appendChild(lu);const Hg=document.styleSheets[document.styleSheets.length-1];assert&&assert(Hg.disabled===!1);const zl={stylesheet:Hg,styleElement:lu,addRule(l){this.stylesheet.insertRule(l,0)}};q.register("SceneryStyle",zl);class sr{constructor(e,t){this.canvas=e,this.context=t,this.resetStyles()}resetStyles(){this.fillStyle=void 0,this.strokeStyle=void 0,this.lineWidth=void 0,this.lineCap=void 0,this.lineJoin=void 0,this.lineDash=void 0,this.lineDashOffset=void 0,this.miterLimit=void 0,this.font=void 0,this.direction=void 0}setDimensions(e,t){this.canvas.width=e,this.canvas.height=t,this.resetStyles()}setFillStyle(e){e&&it(e)&&(e=e.value),e&&e.getCanvasStyle&&(e=e.getCanvasStyle()),this.fillStyle!==e&&(this.fillStyle=e,this.context.fillStyle=e)}setStrokeStyle(e){e&&it(e)&&(e=e.value),e&&e.getCanvasStyle&&(e=e.getCanvasStyle()),this.strokeStyle!==e&&(this.strokeStyle=e,this.context.strokeStyle=e)}setLineWidth(e){this.lineWidth!==e&&(this.lineWidth=e,this.context.lineWidth=e)}setLineCap(e){this.lineCap!==e&&(this.lineCap=e,this.context.lineCap=e)}setLineJoin(e){this.lineJoin!==e&&(this.lineJoin=e,this.context.lineJoin=e)}setMiterLimit(e){assert&&assert(typeof e=="number"),this.miterLimit!==e&&(this.miterLimit=e,this.context.miterLimit=e)}setLineDash(e){assert&&assert(e!==void 0,"undefined line dash would cause hard-to-trace errors"),this.lineDash!==e&&(this.lineDash=e,this.context.setLineDash?this.context.setLineDash(e===null?[]:e):this.context.mozDash!==void 0?this.context.mozDash=e:this.context.webkitLineDash!==void 0&&(this.context.webkitLineDash=e||[]))}setLineDashOffset(e){this.lineDashOffset!==e&&(this.lineDashOffset=e,this.context.lineDashOffset!==void 0?this.context.lineDashOffset=e:this.context.webkitLineDashOffset!==void 0&&(this.context.webkitLineDashOffset=e))}setFont(e){this.font!==e&&(this.font=e,this.context.font=e)}setDirection(e){this.direction!==e&&(this.direction=e,this.context.direction=e)}}q.register("CanvasContextWrapper",sr);const Hd=ti(document,"exitFullscreen")||ti(document,"cancelFullScreen"),Hy=ti(document,"fullscreenElement")||ti(document,"fullScreenElement"),Vy=ti(document,"fullscreenEnabled")||ti(document,"fullScreenEnabled");let fc=_y(document,"fullscreenchange");fc==="msfullscreenchange"&&(fc="MSFullscreenChange");const Er={isFullScreen(){return!!document[Hy]},isFullScreenEnabled(){return document[Vy]&&!_i.safari7},enterFullScreen(l){const e=ti(document.body,"requestFullscreen")||ti(document.body,"requestFullScreen");l.domElement[e]&&l.domElement[e]()},exitFullScreen(){document[Hd]&&document[Hd]()},toggleFullScreen(l){Er.isFullScreen()?Er.exitFullScreen():Er.enterFullScreen(l)},isFullScreenProperty:new ei(!1)};document.addEventListener(fc,l=>{Er.isFullScreenProperty.set(Er.isFullScreen())});q.register("FullScreen",Er);const Gy=Er;class Vg{constructor(e,t){this.create=e,this.destroy=t,this.map=new Map}increment(e,t=1){if(assert&&assert(typeof t=="number"),assert&&assert(t>=1),this.map.has(e))this.map.get(e).count+=t;else{const i=this.create(e),n=mc.createFromPool(t,e,i);this.map.set(e,n)}}decrement(e,t=1){assert&&assert(typeof t=="number"),assert&&assert(t>=1);const i=this.map.get(e);i&&(i.count-=t,i.count<1&&(this.destroy(e,i.value),this.map.delete(e),i.dispose()))}get(e){return this.map.get(e).value}clear(){this.map.clear()}}class mc{constructor(e,t,i){this.initialize(e,t,i)}initialize(e,t,i){this.count=e,this.key=t,this.value=i}dispose(){this.key=null,this.value=null,this.freeToPool()}}$t.mixInto(mc,{initialize:mc.prototype.initialize});q.register("CountMap",Vg);class hu extends vt{constructor(e,t){const i=je()({display:null,followPDOMOrder:!1,requireVisible:!0,requirePDOMVisible:!1,requireEnabled:!1,requireInputEnabled:!1},t);super([]),this.listenedNodeSet=new Set,this.node=e,this.display=i.display,this.followPDOMOrder=i.followPDOMOrder,this.requireVisible=i.requireVisible,this.requirePDOMVisible=i.requirePDOMVisible,this.requireEnabled=i.requireEnabled,this.requireInputEnabled=i.requireInputEnabled,this._trailUpdateListener=this.update.bind(this),this.update()}update(){const e=this.display,t=this.followPDOMOrder,i=this.requireVisible,n=this.requirePDOMVisible,r=this.requireEnabled,h=this.requireInputEnabled,p=[],S=new Set,C=new ht(this.node);(function k(){const Q=C.rootNode();if(Q.isDisposed||(S.add(Q),i&&!Q.visible||n&&!Q.pdomVisible||r&&!Q.enabled||h&&!Q.inputEnabled))return;const X=Q.getRootedDisplays();let g;e===null?g=X.length>0:e instanceof Fi?g=X.includes(e):g=X.some(e),g&&p.push(C.copy()),(t&&Q.pdomParent?[Q.pdomParent]:Q.parents).forEach(ce=>{C.addAncestor(ce),k(),C.removeAncestor()})})(),S.forEach(k=>{this.listenedNodeSet.has(k)||this.addNodeListener(k)}),this.listenedNodeSet.forEach(k=>{S.has(k)||this.removeNodeListener(k)});const B=this.value;let U=B.length===p.length;if(U){for(let k=0;k<p.length;k++)if(!B[k].equals(p[k])){U=!1;break}}U||(this.value=p)}addNodeListener(e){this.listenedNodeSet.add(e),e.parentAddedEmitter.addListener(this._trailUpdateListener),e.parentRemovedEmitter.addListener(this._trailUpdateListener),e.rootedDisplayChangedEmitter.addListener(this._trailUpdateListener),e.disposeEmitter.addListener(this._trailUpdateListener),this.followPDOMOrder&&e.pdomParentChangedEmitter.addListener(this._trailUpdateListener),this.requireVisible&&e.visibleProperty.lazyLink(this._trailUpdateListener),this.requirePDOMVisible&&e.pdomVisibleProperty.lazyLink(this._trailUpdateListener),this.requireEnabled&&e.enabledProperty.lazyLink(this._trailUpdateListener),this.requireInputEnabled&&e.inputEnabledProperty.lazyLink(this._trailUpdateListener)}removeNodeListener(e){this.listenedNodeSet.delete(e),e.parentAddedEmitter.removeListener(this._trailUpdateListener),e.parentRemovedEmitter.removeListener(this._trailUpdateListener),e.rootedDisplayChangedEmitter.removeListener(this._trailUpdateListener),e.disposeEmitter.removeListener(this._trailUpdateListener),this.followPDOMOrder&&e.pdomParentChangedEmitter.removeListener(this._trailUpdateListener),this.requireVisible&&e.visibleProperty.unlink(this._trailUpdateListener),this.requirePDOMVisible&&e.pdomVisibleProperty.unlink(this._trailUpdateListener),this.requireEnabled&&e.enabledProperty.unlink(this._trailUpdateListener),this.requireInputEnabled&&e.inputEnabledProperty.unlink(this._trailUpdateListener)}dispose(){this.listenedNodeSet.forEach(e=>this.removeNodeListener(e)),super.dispose()}}q.register("DisplayedTrailsProperty",hu);const zy="DerivedPropertyIO",Vd=_.hasIn(self,"phet.chipper.queryParameters")&&phet.chipper.queryParameters.strictAxonDependencies;function Th(l,e,t){assert&&Vd&&l&&Dd.push(t);try{return e(...t.map(i=>i.get()))}finally{assert&&Vd&&l&&Dd.pop()}}class Jt extends Is{constructor(e,t,i){const n=je()({phetioReadOnly:!0,phetioOuterType:Jt.DerivedPropertyIO,phetioLinkDependencies:!0,strictAxonDependencies:!0},i);assert&&assert(e.every(_.identity),"dependencies should all be truthy"),assert&&assert(e.length===_.uniq(e).length,"duplicate dependencies");const r=Th(n.strictAxonDependencies,t,e);super(r,n),Ft.VALIDATION&&this.isPhetioInstrumented()&&assert&&assert(this.phetioType.typeName.startsWith("DerivedPropertyIO"),"phetioType should be DerivedPropertyIO"),this.dependencies=e,this.derivation=t,this.strictAxonDependencies=n.strictAxonDependencies,this.derivedPropertyListener=this.getDerivedPropertyListener.bind(this),e.forEach(h=>{if(h.lazyLink(this.derivedPropertyListener),Ft.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&h instanceof yi&&h.isPhetioInstrumented()&&(h instanceof Is&&py.registerPhetioOrderDependency(h,Td.UNDEFER,this,Td.UNDEFER),n.tandem&&n.phetioLinkDependencies)){const p=n.tandem.createTandem("dependencies");this.addLinkedElement(h,{tandem:p.createTandemFromPhetioID(h.tandem.phetioID)})}})}hasDependency(e){return this.definedDependencies.includes(e)}get definedDependencies(){return assert&&assert(this.dependencies!==null,"Dependencies should be defined, has this Property been disposed?"),this.dependencies}getDerivedPropertyListener(){this.isDisposed||(this.isDeferred?this.hasDeferredValue=!0:super.set(Th(this.strictAxonDependencies,this.derivation,this.definedDependencies)))}recomputeDerivation(){this.getDerivedPropertyListener()}dispose(){const e=this.definedDependencies;for(let t=0;t<e.length;t++){const i=e[t];i.hasListener(this.derivedPropertyListener)&&i.unlink(this.derivedPropertyListener)}this.dependencies=null,super.dispose()}setDeferred(e){return this.isDeferred&&!e&&(this.deferredValue=Th(this.strictAxonDependencies,this.derivation,this.definedDependencies)),super.setDeferred(e)}static valueEquals(e,t,i){return new Jt([e,t],(n,r)=>n===r,i)}static valueEqualsConstant(e,t,i){return new Jt([e],n=>n===t,i)}static and(e,t){return assert&&assert(e.length>0,"must provide a dependency"),Jt.deriveAny(e,()=>_.reduce(e,Wy,!0),t)}static or(e,t){return assert&&assert(e.length>0,"must provide a dependency"),Jt.deriveAny(e,()=>_.reduce(e,$y,!1),t)}static multiply(e,t){return assert&&assert(e.length>0,"must provide a dependency"),Jt.deriveAny(e,()=>_.reduce(e,Uy,1),t)}static add(e,t){return assert&&assert(e.length>0,"must provide a dependency"),Jt.deriveAny(e,()=>_.reduce(e,Yy,0),t)}static not(e,t){return new Jt([e],i=>!i,t)}static deriveAny(e,t,i){return new Jt(e,t,i)}}const Wy=(l,e)=>l&&e.value,$y=(l,e)=>(assert&&assert(typeof e.value=="boolean","boolean value required"),l||e.value),Uy=(l,e)=>(assert&&assert(typeof e.value=="number","number value required"),l*e.value),Yy=(l,e)=>(assert&&assert(typeof e.value=="number","number value required"),l+e.value),Dh=new va;Jt.DerivedPropertyIO=l=>(assert&&assert(l,"DerivedPropertyIO needs parameterType"),Dh.has(l)||Dh.set(l,new li(`${zy}<${l.typeName}>`,{valueType:Jt,parameterTypes:[l],supertype:ei.PropertyIO(l),documentation:"Like PropertyIO, but not settable.  Instead it is derived from other DerivedPropertyIO or PropertyIO instances",applyState:_.noop,methods:{setValue:{returnType:Ds,parameterTypes:[l],implementation:Jt.prototype.set,documentation:"Errors out when you try to set a derived property.",invocableForReadOnlyElements:!1}}})),Dh.get(l));class Gg extends Jt{}class oP extends Jt{}class lP extends Jt{}class hP extends Jt{}hs.register("DerivedProperty",Jt);class Ky extends Gg{constructor(e,t){const i=new hu(e,t);super([i],n=>n.length>0,t),this.displayedTrailsProperty=i}dispose(){this.displayedTrailsProperty.dispose(),super.dispose()}}q.register("DisplayedProperty",Ky);class jy{constructor(e){this.scene=e,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.img=document.createElement("img"),this.update()}update(e){this.scene.updateScene(),this.canvas.width=this.scene.getSceneWidth(),this.canvas.height=this.scene.getSceneHeight(),this.scene.renderToCanvas(this.canvas,this.context,()=>{const t=this.toDataURL();this.img.onload=()=>{e(),delete this.img.onload},this.img.src=t})}}q.register("SceneImage",jy);class Wt extends ei{constructor(e,t){const i=je()({valueType:"boolean",phetioValueType:Jn},t);super(e,i)}toggle(){this.value=!this.value}}hs.register("BooleanProperty",Wt);var mg,yg,bg,vg,_g;const ua=new Wt(!((yg=(mg=self==null?void 0:self.phet)==null?void 0:mg.chipper)!=null&&yg.queryParameters)||((_g=(vg=(bg=self==null?void 0:self.phet)==null?void 0:bg.chipper)==null?void 0:vg.queryParameters)==null?void 0:_g.allowLinks),{tandem:Ft.GENERAL_MODEL.createTandem("allowLinksProperty")});q.register("allowLinksProperty",ua);function zg(l,e=ua.value){const t=phet&&phet.chipper&&phet.chipper.isFuzzEnabled();if(e&&!t){const i=self.open(l,"_blank");i&&i.focus()}}q.register("openPopup",zg);const yc=(l,e)=>{const t=je()({requiredOnly:!1},e),i=[],n=new LineBreaker(l);n[Symbol.iterator]=()=>({next(){const h=n.nextBreak();return h!==null?{value:h,done:!1}:{done:!0}}});let r=0;for(const h of n){const p=h.position;t.requiredOnly&&!h.required||(r!==p&&i.push(new In(r,p)),r=h.position)}return r<l.length&&i.push(new In(r,l.length)),i};q.register("getLineBreakRanges",yc);const qy=new We(0,0),Xy=$e.IDENTITY.copy(),As=class As extends Mr{};As.TRANSLATION=new As,As.TRANSLATION_AND_SCALE=new As,As.TRANSLATION_AND_ROTATION=new As,As.AFFINE=new As,As.enumeration=new Nr(As,{phetioDocumentation:"Defines the available transform type for a SpriteInstance"});let Cr=As;const no=class no{constructor(){this.sprite=null,this.matrix=new $e().setToAffine(1,0,0,0,1,0),this.transformType=Cr.TRANSLATION,this.alpha=1}initialize(){return this}getShape(){return this.sprite?this.sprite.getShape().transformed(this.matrix):new yt}containsPoint(e){if(!this.sprite)return!1;const t=qy.set(e);return this.transformType===Cr.AFFINE?Xy.set(this.matrix).invert().multiplyVector2(t):(t.x-=this.matrix.m02(),t.y-=this.matrix.m12(),this.transformType===Cr.TRANSLATION_AND_SCALE?(t.x/=this.matrix.m00(),t.y/=this.matrix.m11()):this.transformType===Cr.TRANSLATION_AND_ROTATION&&t.rotate(-this.matrix.rotation)),this.sprite.containsPoint(t)}freeToPool(){no.pool.freeToPool(this)}};no.pool=new cs(no,{maxSize:1e3});let bc=no;q.register("SpriteInstance",bc);const Ih=new Zs(1024,1024),_r=1,il=1,od=class od{constructor(e){this.useMipmaps=e,this.gl=null,this.texture=null,this.bounds=new Be(0,0,Ih.width,Ih.height),assert&&assert(this.bounds.minX===0&&this.bounds.minY===0,"Assumed constraint later on for transforms"),this.width=this.bounds.width,this.height=this.bounds.height,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.context=this.canvas.getContext("2d"),this.binPacker=new gy(this.bounds),this.dirty=!0,this.usedSprites=[],this.unusedSprites=[]}initializeContext(e){this.gl=e,this.createTexture()}createTexture(){const e=this.gl;assert&&assert(e),this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,this.useMipmaps?e.LINEAR_MIPMAP_LINEAR:e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.canvas),this.useMipmaps&&(e.hint(e.GENERATE_MIPMAP_HINT,e.NICEST),e.generateMipmap(e.TEXTURE_2D)),e.bindTexture(e.TEXTURE_2D,null),this.dirty=!1}updateTexture(){if(assert&&assert(this.gl,"SpriteSheet needs context to updateTexture()"),this.dirty){this.dirty=!1;const e=this.gl;assert&&assert(e),e.bindTexture(e.TEXTURE_2D,this.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.canvas),this.useMipmaps&&(e.hint(e.GENERATE_MIPMAP_HINT,e.NICEST),e.generateMipmap(e.TEXTURE_2D)),e.bindTexture(e.TEXTURE_2D,null)}}addImage(e,t,i){let n;for(n=0;n<this.usedSprites.length;n++){const h=this.usedSprites[n];if(h.image===e)return h.count++,h}for(n=0;n<this.unusedSprites.length;n++){const h=this.unusedSprites[n];if(h.image===e)return h.count++,assert&&assert(h.count===1,"Count should be exactly 1 after coming back from being unused"),this.unusedSprites.splice(n,1),this.usedSprites.push(h),h}let r;for(;!(r=this.binPacker.allocate(t+2*_r+il,i+2*_r+il))&&this.unusedSprites.length;){const h=this.unusedSprites.shift();this.dirty=!0;const p=h.bin.bounds;this.context.clearRect(p.x,p.y,p.width,p.height),this.binPacker.deallocate(h.bin)}if(r){const h=new Be((r.bounds.minX+_r)/this.width,(r.bounds.minY+_r)/this.height,(r.bounds.maxX-_r-il)/this.width,(r.bounds.maxY-_r-il)/this.height),p=new Wg(this,r,h,e,1);return this.copyImageWithGutter(e,t,i,r.bounds.x,r.bounds.y),this.dirty=!0,this.usedSprites.push(p),p}else return null}removeImage(e){let t,i;for(i=0;i<this.usedSprites.length;i++)if(this.usedSprites[i].image===e){t=this.usedSprites[i];break}assert&&assert(t,"Sprite not found for removeImage"),--t.count<=0&&(this.usedSprites.splice(i,1),this.unusedSprites.push(t))}containsImage(e){let t;for(t=0;t<this.usedSprites.length;t++)if(this.usedSprites[t].image===e)return!0;for(t=0;t<this.unusedSprites.length;t++)if(this.unusedSprites[t].image===e)return!0;return!1}copyImageWithGutter(e,t,i,n,r){assert&&assert(_r===1),this.copyImageRegion(e,1,1,0,0,n,r),this.copyImageRegion(e,1,1,t-1,0,n+1+t,r),this.copyImageRegion(e,1,1,t-1,i-1,n+1+t,r+1+i),this.copyImageRegion(e,1,1,0,i-1,n,r+1+i),this.copyImageRegion(e,t,1,0,0,n+1,r),this.copyImageRegion(e,t,1,0,i-1,n+1,r+1+i),this.copyImageRegion(e,1,i,0,0,n,r+1),this.copyImageRegion(e,1,i,t-1,0,n+1+t,r+1),this.context.drawImage(e,n+1,r+1)}copyImageRegion(e,t,i,n,r,h,p){this.context.drawImage(e,n,r,t,i,h,p,t,i)}};od.MAX_DIMENSION=Ih;let ar=od;q.register("SpriteSheet",ar);let Wg=class{constructor(e,t,i,n,r){this.spriteSheet=e,this.bin=t,this.uvBounds=i,this.image=n,this.count=r}};ar.Sprite=Wg;class Wl{constructor(e,t,i,n){const r=je()({attributes:[],uniforms:[]},n);this.vertexSource=t,this.fragmentSource=i,this.attributeNames=r.attributes,this.uniformNames=r.uniforms,this.initialize(e)}initialize(e){this.gl=e,this.used=!1,this.program=this.gl.createProgram(),this.vertexShader=Dt.createShader(this.gl,this.vertexSource,this.gl.VERTEX_SHADER),this.fragmentShader=Dt.createShader(this.gl,this.fragmentSource,this.gl.FRAGMENT_SHADER),this.gl.attachShader(this.program,this.vertexShader),this.gl.attachShader(this.program,this.fragmentShader),this.gl.linkProgram(this.program),this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS)||(console.log("GLSL link error:"),console.log(this.gl.getProgramInfoLog(this.program)),console.log("for vertex shader"),console.log(this.vertexSource),console.log("for fragment shader"),console.log(this.fragmentSource)),this.gl.deleteShader(this.vertexShader),this.gl.deleteShader(this.fragmentShader),this.uniformLocations={},this.attributeLocations={},this.activeAttributes={},_.each(this.attributeNames,t=>{this.attributeLocations[t]=this.gl.getAttribLocation(this.program,t),this.activeAttributes[t]=!0}),_.each(this.uniformNames,t=>{this.uniformLocations[t]=this.gl.getUniformLocation(this.program,t)}),this.isInitialized=!0}use(){this.used||(this.used=!0,this.gl.useProgram(this.program),_.each(this.attributeNames,e=>{this.activeAttributes[e]&&this.enableVertexAttribArray(e)}))}activateAttribute(e){this.activeAttributes[e]||(this.activeAttributes[e]=!0,this.used&&this.enableVertexAttribArray(e))}enableVertexAttribArray(e){this.gl.enableVertexAttribArray(this.attributeLocations[e])}unuse(){this.used&&(this.used=!1,_.each(this.attributeNames,e=>{this.activeAttributes[e]&&this.disableVertexAttribArray(e)}))}disableVertexAttribArray(e){this.gl.disableVertexAttribArray(this.attributeLocations[e])}deactivateAttribute(e){this.activeAttributes[e]&&(this.activeAttributes[e]=!1,this.used&&this.disableVertexAttribArray(e))}dispose(){this.gl.deleteProgram(this.program)}}q.register("ShaderProgram",Wl);class $g extends ei{constructor(e,t){t&&(assert&&assert(!t.hasOwnProperty("valueType"),"ColorProperty sets valueType"),assert&&assert(!t.hasOwnProperty("phetioType"),"ColorProperty sets phetioType"));const i=je()({valueType:Me,phetioValueType:Me.ColorIO},t);super(e,i)}}q.register("ColorProperty",$g);const Gd="sceneryTextSizeContainer",zd="sceneryTextSizeElement";let on,Ys;const Wd={};let $d=!1;const Ts={approximateSVGBounds(l,e){if(assert&&assert(l instanceof ki,"Font required"),assert&&assert(typeof e=="string","renderedText required"),!on.parentNode)if(document.body)document.body.appendChild(on);else throw new Error("No document.body and trying to get approximate SVG bounds of a Text node");Ts.setSVGTextAttributes(Ys,l,e);const t=Ys.getBBox();return t.width===0&&t.height===0&&e.length>0?($d||($d=!0,console.log("WARNING: Guessing text bounds, is the simulation hidden? See https://github.com/phetsims/chipper/issues/768")),Ts.guessSVGBounds(l,e)):new Be(t.x,t.y,t.x+t.width,t.y+t.height)},guessSVGBounds(l,e){const t=l.getNumericSize(),i=l.weight==="bold";return new Be(0,-.9*t,(i?.435:.4)*t*e.length,.22*t)},accurateCanvasBounds(l){const e=q.scratchContext;e.font=l._font.toCSS(),e.direction="ltr";const t=e.measureText(l.renderedText);return new Be(-t.actualBoundingBoxLeft,-t.actualBoundingBoxAscent,t.actualBoundingBoxRight,t.actualBoundingBoxDescent)},accurateCanvasBoundsFallback(l){const e=Ts.approximateSVGBounds(l._font,l.renderedText);if(!l.renderedText.length||e.width===0)return e;const t=Dt.canvasAccurateBounds(i=>{if(i.font=l._font.toCSS(),i.direction="ltr",i.fillText(l.renderedText,0,0),l.hasPaintableStroke()){const n=new sr(null,i);l.beforeCanvasStroke(n),i.strokeText(l.renderedText,0,0),l.afterCanvasStroke(n)}},{precision:.5,resolution:128,initialScale:32/Math.max(Math.abs(e.minX),Math.abs(e.minY),Math.abs(e.maxX),Math.abs(e.maxY))});return t.isFinite()?t:e},getVerticalBounds(l){assert&&assert(l instanceof ki,"Font required");const e=l.toCSS();let t=Wd[e];return t||(t=Wd[e]=Ts.approximateSVGBounds(l,"m")),t},approximateCanvasWidth(l,e){assert&&assert(l instanceof ki,"Font required"),assert&&assert(typeof e=="string","renderedText required");const t=q.scratchContext;return t.font=l.toCSS(),t.direction="ltr",t.measureText(e).width},approximateHybridBounds(l,e){assert&&assert(l instanceof ki,"Font required"),assert&&assert(typeof e=="string","renderedText required");const t=Ts.getVerticalBounds(l),i=Ts.approximateCanvasWidth(l,e);return new Be(0,t.minY,i,t.maxY)},approximateDOMBounds(l,e){assert&&assert(l instanceof ki,"Font required");const t=1024,i=document.createElement("div");$(i).css({position:"absolute",left:0,top:0,padding:"0 !important",margin:"0 !important",display:"hidden"});const n=document.createElement("span");$(n).css("font",l.toCSS()),n.appendChild(e),n.setAttribute("direction","ltr");const r=document.createElement("div");$(r).css({"vertical-align":"baseline",display:"inline-block",width:0,height:`${t}px`,margin:"0 !important",padding:"0 !important"}),i.appendChild(n),i.appendChild(r),document.body.appendChild(i);const h=n.getBoundingClientRect(),p=i.getBoundingClientRect(),S=new Be(h.left,h.top-t,h.right+1,h.bottom-t).shiftedXY(-p.left,-p.top);return document.body.removeChild(i),S},approximateImprovedDOMBounds(l,e){assert&&assert(l instanceof ki,"Font required");const t=document.createElement("div");t.style.display="inline-block",t.style.font=l.toCSS(),t.style.color="transparent",t.style.padding="0 !important",t.style.margin="0 !important",t.style.position="absolute",t.style.left="0",t.style.top="0",t.setAttribute("direction","ltr"),t.appendChild(e),document.body.appendChild(t);const i=new Be(t.offsetLeft,t.offsetTop,t.offsetLeft+t.offsetWidth+1,t.offsetTop+t.offsetHeight+1);document.body.removeChild(t);const n=Ts.getVerticalBounds(l);return i.shiftedY(n.minY)},setSVGTextAttributes(l,e,t){assert&&assert(e instanceof ki,"Font required"),assert&&assert(typeof t=="string","renderedText required"),l.setAttribute("direction","ltr"),l.setAttribute("font-family",e.getFamily()),l.setAttribute("font-size",e.getSize()),l.setAttribute("font-style",e.getStyle()),l.setAttribute("font-weight",e.getWeight()),l.setAttribute("font-stretch",e.getStretch()),l.lastChild.nodeValue=t},initializeTextBounds(){on=document.getElementById(Gd),on||(on=document.createElementNS(Gt,"svg"),on.setAttribute("width","2"),on.setAttribute("height","2"),on.setAttribute("id",Gd),on.setAttribute("style","visibility: hidden; pointer-events: none; position: absolute; left: -65535px; right: -65535px;")),Ys=document.getElementById(zd),Ys||(Ys=document.createElementNS(Gt,"text"),Ys.appendChild(document.createTextNode("")),Ys.setAttribute("dominant-baseline","alphabetic"),Ys.setAttribute("text-rendering","geometricPrecision"),Ys.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),Ys.setAttribute("id",zd),on.appendChild(Ys))}};q.register("TextBounds",Ts);class vc{constructor(e,t,i){this.pdomInstance=e,this.trail=t,this.isRoot=i,this.isRoot=i,this.fullTrail=this.pdomInstance.trail.copy();for(let n=this.isRoot?0:1;n<this.trail.length;n++)this.fullTrail.addDescendant(this.trail.nodes[n])}}q.register("PartialPDOMTrail",vc);const Ug="a11y-pdom-element",Yg="a11y-pdom-root",Kg="a11y-pdom-list-item";zl.addRule(`.${Ug}{position: fixed;top: 0px;left: 0px;transform-origin: left top 0px;border-width: 0px;border: 0px;padding: 1px 1px;margin: 0px;white-space: nowrap;outline: none;box-shadow:none;border-color:transparent;font-size: 1px;clip: rect(1px, 1px, 1px, 1px);}`);zl.addRule(`.${Yg}{position: absolute;pointer-events: none;z-index: 1;opacity: 0.0001;}`);zl.addRule(`.${Kg}{list-style: none;`);const jg={SIBLING_CLASS_NAME:Ug,ROOT_CLASS_NAME:Yg,LIST_ITEM_CLASS_NAME:Kg};q.register("PDOMSiblingStyle",jg);const cu=jg,qg="NEXT",Zy="PREVIOUS",pl="INPUT",Qy="LABEL",_c="BUTTON",Lc="TEXTAREA",Pc="SELECT",Ud="OPTGROUP",Yd="DATALIST",Kd="OUTPUT",jd="DIV",Sc="A",Jy="AREA",xh="P",eb="IFRAME",Xg="B",Zg="STRONG",Qg="I",Jg="EM",ef="MARK",tf="SMALL",sf="DEL",nf="INS",rf="SUB",af="SUP",tb="BR",ib=[Sc,Jy,pl,Pc,Lc,_c,eb],qd=[Xg,Zg,Qg,Jg,ef,tf,sf,nf,rf,af,tb],sb=[pl],nb=["focusin","focusout","input","change","click","keydown","keyup"],rb=["input","change","click","keydown","keyup"],ab=["touchstart","touchend","touchmove","touchcancel","mousedown","mouseup","mousemove","mouseover","mouseout","pointerdown","pointerup","pointermove","pointerover","pointerout","pointercancel","gotpointercapture","lostpointercapture"],ob="aria-labelledby",lb="aria-describedby",hb="aria-activedescendant",Xd="data-focusable",cb="data-unique-id",ub=[ob,lb,hb];function wc(l){const e=l.getElementsByTagName("*"),t=[];for(let i=0;i<e.length;i++)e[i].nodeType===Node.ELEMENT_NODE&&(t[i]=e[i]);return t}function of(l){return l.hidden?!0:l===document.body?!1:of(l.parentElement)}function Zd(l,e){const t=e||document.body,i=wc(t),n=document.activeElement,r=i.indexOf(n),h=l===qg?1:-1;let p=r+h;for(;p<i.length&&p>=0;){const S=i[p];if(p+=h,Zn.isElementFocusable(S))return S}return n}function db(l){return l.replace(/^\s+/,"")}function Qd(l){return!_.includes(sb,l.toUpperCase())}const Zn={unwrapStringProperty(l){const e=l===null?null:typeof l=="string"?l:l.value;return assert&&assert(e===null||typeof e=="string"),e},getNextFocusable(l){return Zd(qg,l)},getPreviousFocusable(l){return Zd(Zy,l)},getFirstFocusable(l){const e=l||document.body,t=wc(e);let i=document.body,n=0;for(;n<t.length;){const r=t[n];if(n++,Zn.isElementFocusable(r)){i=r;break}}return i},getRandomFocusable(l){assert&&assert(l,"Random expected");const e=wc(document.body),t=[];for(let i=0;i<e.length;i++)Zn.isElementFocusable(e[i])&&t.push(e[i]);return t[l.nextInt(t.length)]},unwrapProperty(l){return it(l)?l.value:l},containsFormattingTags(l){if(l===null)return!1;assert&&assert(typeof l=="string","unsupported type for textContent.");let e=0;const t=[],i=[];for(;e<l.length;){const h=l.indexOf("<",e),p=l.indexOf(">",e);h>-1&&(t.push(h),e=h+1),p>-1?(i.push(p),e=p+1):e++}if(t.length!==i.length||t.length===0)return!1;let n=!0;const r=l.toUpperCase();for(let h=0;h<t.length;h++){let p=r.substring(t[h]+1,i[h]);p=p.replace("/","");const S=db(p);p.length-S.length>0||_.includes(qd,p)||(n=!1)}return n},setTextContent(l,e){if(assert&&assert(l instanceof Element),assert&&assert(e===null||typeof e=="string"),e===null)l.innerHTML="";else{const t=e.replaceAll("<br>","<br/>"),i=Xc(t);ir(i,Hs.STRING_WITHOUT_TEMPLATE_VARS_VALIDATOR),Qd(l.tagName)&&(Zn.containsFormattingTags(i)?l.innerHTML=i:l.textContent=i)}},tagIsDefaultFocusable(l){return _.includes(ib,l.toUpperCase())},isElementFocusable(l){return!document.body.contains(l)||of(l)||_.includes(qd,l.tagName)?!1:l.getAttribute(Xd)==="true"},tagNameSupportsContent(l){return Qd(l)},removeElements(l,e){for(let t=0;t<e.length;t++){const i=e[t];assert&&assert(l.contains(i),"element does not contain child to be removed: ",i),l.removeChild(i)}},insertElements(l,e,t){assert&&assert(l instanceof self.Element),assert&&assert(Array.isArray(e));for(let i=0;i<e.length;i++){const n=e[i];l.insertBefore(n,t||null)}},createElement(l,e,t){t=ns({namespace:null,id:null},t);const i=t.namespace?document.createElementNS(t.namespace,l):document.createElement(l);return t.id&&(i.id=t.id),Zn.overrideFocusWithTabIndex(i,e),i.classList.add(cu.SIBLING_CLASS_NAME),i},overrideFocusWithTabIndex(l,e){Zn.tagIsDefaultFocusable(l.tagName)!==e?l.tabIndex=e?0:-1:l.removeAttribute("tabindex"),l.setAttribute(Xd,e)},TAGS:{INPUT:pl,LABEL:Qy,BUTTON:_c,TEXTAREA:Lc,SELECT:Pc,OPTGROUP:Ud,DATALIST:Yd,OUTPUT:Kd,DIV:jd,A:Sc,P:xh,B:Xg,STRONG:Zg,I:Qg,EM:Jg,MARK:ef,SMALL:tf,DEL:sf,INS:nf,SUB:rf,SUP:af},FORM_ELEMENTS:[pl,_c,Lc,Pc,Ud,Yd,Kd,Sc],DEFAULT_CONTAINER_TAG_NAME:jd,DEFAULT_DESCRIPTION_TAG_NAME:xh,DEFAULT_LABEL_TAG_NAME:xh,ASSOCIATION_ATTRIBUTES:ub,INPUT_TYPES_THAT_SUPPORT_CHECKED:["RADIO","CHECKBOX"],DOM_EVENTS:nb,USER_GESTURE_EVENTS:rb,BLOCKED_DOM_EVENTS:ab,DATA_PDOM_UNIQUE_ID:cb,PDOM_UNIQUE_ID_SEPARATOR:"-",DATA_EXCLUDE_FROM_INPUT:"data-exclude-from-input"};q.register("PDOMUtils",Zn);const dt=Zn;class $l extends ei{constructor(e,t){t&&(assert&&assert(!t.hasOwnProperty("valueType"),"StringProperty sets valueType"),assert&&assert(!t.hasOwnProperty("phetioType"),"StringProperty sets phetioType"));const i=je()({valueType:"string",phetioValueType:si},t);super(e,i)}}hs.register("StringProperty",$l);const pb=_.hasIn(self,"phet.chipper.queryParameters.colorProfile")?phet.chipper.queryParameters.colorProfile:Qn.DEFAULT_COLOR_PROFILE,gb=_.hasIn(self,"phet.chipper.colorProfiles")?phet.chipper.colorProfiles:[Qn.DEFAULT_COLOR_PROFILE],wo=new $l(pb,{tandem:Ft.GENERAL_VIEW.createTandem("colorProfileProperty"),phetioFeatured:!0,validValues:gb});q.register("colorProfileProperty",wo);const fb=".",so=[];class mb extends $g{constructor(e,t,i,n){const r=je()({valueComparisonStrategy:"equalsFunction",tandemNameSuffix:["ColorProperty","FillProperty","StrokeProperty"]},n);if(i=_.mapValues(i,h=>Me.toColor(h).setImmutable()),assert&&assert(i.hasOwnProperty(Qn.DEFAULT_COLOR_PROFILE),"default color profile must be provided"),assert&&assert(!!i[Qn.DEFAULT_COLOR_PROFILE],"default color profile must be truthy"),super(Me.toColor(i[wo.value]||i[Qn.DEFAULT_COLOR_PROFILE]),r),this.colorProfileMap=i,wo.link(h=>{this.value=Me.toColor(this.colorProfileMap[h]||this.colorProfileMap[Qn.DEFAULT_COLOR_PROFILE])}),this.name=`${e.name}${fb}${t}`,this.link(h=>{self.parent!==window&&self.parent.postMessage(JSON.stringify({type:"reportColor",name:this.name,value:h.toHexString(),alpha:h.getAlpha()}),"*")}),assert){const h=so.filter(p=>p.name===this.name);assert&&assert(h.length===0,"cannot use the same name for two different ProfileColorProperty instances: "+name)}so.push(this)}dispose(){Vs(so,this),super.dispose()}}self.addEventListener("message",l=>{let e;try{e=JSON.parse(l.data)}catch{}if(e&&e.type==="setColor")for(let t=0;t<so.length;t++){const i=so[t];i.name===e.name&&(i.colorProfileMap[wo.value]=new Me(e.value).withAlpha(e.alpha),i.value=Me.toColor(i.colorProfileMap[wo.value]))}});q.register("ProfileColorProperty",mb);let yb=1;class Bs{constructor(){this.id=`paint${yb++}`,this.transformMatrix=null}setTransformMatrix(e){return this.transformMatrix!==e&&(this.transformMatrix=e),this}toString(){return this.id}}Bs.prototype.isPaint=!0;q.register("Paint",Bs);class ls extends Bs{constructor(){super(),assert&&assert(this.constructor.name!=="Gradient","Please create a LinearGradient or RadialGradient. Do not directly use the supertype Gradient."),this.stops=[],this.lastStopRatio=0,this.canvasGradient=null,this.colorStopsDirty=!1,this.lastColorStopValues=[]}addColorStop(e,t){if(assert&&assert(e>=0&&e<=1,"Ratio needs to be between 0,1 inclusively"),assert&&assert(t===null||typeof t=="string"||t instanceof Me||it(t)&&(t.value===null||typeof t.value=="string"||t.value instanceof Me),"Color should match the addColorStop type specification"),this.lastStopRatio>e)throw new Error("Color stops not specified in the order of increasing ratios");return this.lastStopRatio=e,this.stops.push({ratio:e,color:t}),this.lastColorStopValues.push(""),this}getSVGStops(){return this.stops}invalidateCanvasGradient(){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`Invalidated Canvas Gradient for #${this.id}`),this.colorStopsDirty=!0}haveCanvasColorStopsChanged(){if(this.lastColorStopValues===null)return!0;for(let e=0;e<this.stops.length;e++)if(ls.colorToString(this.stops[e].color)!==this.lastColorStopValues[e])return!0;return!1}getCanvasStyle(){if(!this.canvasGradient||this.colorStopsDirty&&this.haveCanvasColorStopsChanged()){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`Regenerating Canvas Gradient for #${this.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.colorStopsDirty=!1,Bt(this.lastColorStopValues),this.canvasGradient=this.createCanvasGradient();for(let e=0;e<this.stops.length;e++){const t=this.stops[e],i=ls.colorToString(t.color);this.canvasGradient.addColorStop(t.ratio,i),this.lastColorStopValues.push(i)}sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}return this.canvasGradient}static colorToString(e){return it(e)&&(e=e.value),e===null&&(e="transparent"),e instanceof Me&&(e=e.toCSS()),e}}ls.prototype.isGradient=!0;q.register("Gradient",ls);class na extends ls{constructor(e,t,i,n){assert&&assert(isFinite(e)&&isFinite(t)&&isFinite(i)&&isFinite(n)),super(),this.start=new We(e,t),this.end=new We(i,n)}createCanvasGradient(){return q.scratchContext.createLinearGradient(this.start.x,this.start.y,this.end.x,this.end.y)}createSVGPaint(e){return fl.pool.create(e,this)}toString(){let e=`new phet.scenery.LinearGradient( ${this.start.x}, ${this.start.y}, ${this.end.x}, ${this.end.y} )`;return _.each(this.stops,t=>{e+=`.addColorStop( ${t.ratio}, ${uu.scenerySerialize(t.color)} )`}),e}}na.prototype.isLinearGradient=!0;q.register("LinearGradient",na);class ra extends ls{constructor(e,t,i,n,r,h){if(super(),this.start=new We(e,t),this.end=new We(n,r),_i.safari){const p=(e+n)/2,S=(t+r)/2;this.start.x=p,this.start.y=S,this.end.x=p,this.end.y=S}this.startRadius=i,this.endRadius=h,this.focalPoint=this.start.plus(this.end.minus(this.start).times(this.startRadius/(this.startRadius-this.endRadius))),this.startIsLarger=this.startRadius>this.endRadius,this.largePoint=this.startIsLarger?this.start:this.end,this.maxRadius=Math.max(this.startRadius,this.endRadius),this.minRadius=Math.min(this.startRadius,this.endRadius),this.startRadius>=this.endRadius?assert&&assert(this.focalPoint.minus(this.start).magnitude<=this.startRadius):assert&&assert(this.focalPoint.minus(this.end).magnitude<=this.endRadius)}createCanvasGradient(){return q.scratchContext.createRadialGradient(this.start.x,this.start.y,this.startRadius,this.end.x,this.end.y,this.endRadius)}createSVGPaint(e){return ml.pool.create(e,this)}getSVGStops(){const e=this.startIsLarger,t=this.maxRadius,i=this.minRadius;function n(p,S,C,B,U){return C+(U-p)*(B-C)/(S-p)}function r(p){let S=e?1-p.ratio:p.ratio;return i>0&&(S=n(0,1,i/t,1,S)),{ratio:S,color:p.color}}const h=this.stops.map(r);return e&&h.reverse(),h}toString(){let e=`new phet.scenery.RadialGradient( ${this.start.x}, ${this.start.y}, ${this.startRadius}, ${this.end.x}, ${this.end.y}, ${this.endRadius} )`;return _.each(this.stops,t=>{e+=`.addColorStop( ${t.ratio}, ${uu.scenerySerialize(t.color)} )`}),e}}ra.prototype.isRadialGradient=!0;q.register("RadialGradient",ra);class or extends Bs{constructor(e){super(),this.image=e,this.canvasPattern=q.scratchContext.createPattern(e,"repeat")}getCanvasStyle(){return this.canvasPattern}createSVGPaint(e){return yl.pool.create(this)}toString(){return`new phet.scenery.Pattern( $( '<img src="${this.image.src}"/>' )[0] )`}}or.prototype.isPattern=!0;q.register("Pattern",or);class lf extends or{constructor(e,t,i,n,r,h,p=$e.IDENTITY){assert&&assert(t>0&&Number.isInteger(t),"Resolution should be a positive integer"),assert&&assert(Number.isInteger(r)),assert&&assert(Number.isInteger(h));const S=document.createElement("img");function C(U,k,Q,X,g){S.src=U.toDataURL()}new Ge({scale:t,children:[e]}).toCanvas(C,-i*t,-n*t,r*t,h*t),super(S),this.setTransformMatrix(p.timesMatrix($e.scaling(1/t)))}}q.register("NodePattern",lf);let bb=1;class lr{constructor(){this.id=`filter${bb++}`,this.filterRegionPercentageIncrease=0}isDOMCompatible(){return!1}isSVGCompatible(){return!1}isCanvasCompatible(){return Qe.canvasFilter?this.isDOMCompatible():!1}isWebGLCompatible(){return!1}toString(){return this.id}static applyColorMatrix(e,t,i,n){const r=document.createElementNS(Gt,"feColorMatrix");r.setAttribute("type","matrix"),r.setAttribute("values",e),r.setAttribute("in",i),r.setAttribute("color-interpolation-filters","sRGB"),n&&r.setAttribute("result",n),t.appendChild(r)}}q.register("Filter",lr);const Eh=new va,da=l=>{assert&&assert(Array.isArray(l),"OrIO needs to be an array"),assert&&assert(l.length>1,"OrIO needs parameterTypes");const e=l.map(i=>i.typeName),t=e.join(",");if(!Eh.has(t)){const i=n=>{for(let r=0;r<l.length;r++){const h=l[r];if(Hs.isValueValid(n,h.validator))return!0}return!1};Eh.set(t,new li(`OrIO<${e.join(", ")}>`,{documentation:"A PhET-iO Type adding support for a composite type that can be any of its parameters.",parameterTypes:l,isValidValue:i,toStateObject:n=>{for(let r=0;r<l.length;r++){const h=l[r];if(Hs.isValueValid(n,h.validator))return{index:r,state:h.toStateObject(n)}}throw new Error("somehow the instance was not valid, we should not get here. Why was isValidValue not used before this step?")},fromStateObject:n=>(assert&&assert(n.hasOwnProperty("index"),"index required for deserialization"),assert&&assert(n.hasOwnProperty("state"),"state required for deserialization"),l[n.index].fromStateObject(n.state)),stateSchema:Kc.asValue(`${e.join("|")}`,{isValidValue:n=>typeof n.index=="number"?l[n.index].isStateObjectValid(n.state):!1})}))}return Eh.get(t)};dr.register("OrIO",da);class hf extends Error{constructor(){super("CouldNotYetDeserializeError")}}dr.register("CouldNotYetDeserializeError",hf);const kh=new va,cf=l=>{assert&&assert(l,"ReferenceIO needs parameterType");const e=l;return kh.has(e)||(assert&&assert(typeof l.typeName=="string","type name should be a string"),kh.set(e,new li(`ReferenceIO<${l.typeName}>`,{isValidValue:t=>Hs.isValueValid(t,l.validator),documentation:"Uses reference identity for serializing and deserializing, and validates based on its parameter PhET-iO Type.",parameterTypes:[l],toStateObject(t){return{phetioID:t.tandem.phetioID}},stateSchema:{phetioID:si},fromStateObject(t){if(assert&&assert(t&&typeof t.phetioID=="string","phetioID should be a string"),phet.phetio.phetioEngine.hasPhetioObject(t.phetioID))return phet.phetio.phetioEngine.getPhetioElement(t.phetioID);throw new hf},applyState(t){assert&&assert(!1,`ReferenceIO is meant to be used as DataType serialization (see fromStateObject) for phetioID: ${t.tandem.phetioID}`)}}))),kh.get(e)};dr.register("ReferenceIO",cf);const Co={isColorDef(l){return l===null||typeof l=="string"||l instanceof Me||it(l)&&(l.value===null||typeof l.value=="string"||l.value instanceof Me)},scenerySerialize(l){return l===null?"null":l instanceof Me?`'${l.toCSS()}'`:typeof l=="string"?`'${l}'`:Co.scenerySerialize(l.value)},ColorDefIO:null};Co.ColorDefIO=new li("ColorDefIO",{isValidValue:Co.isColorDef,supertype:Lt(da([si,Me.ColorIO,cf(ei.PropertyIO(Lt(da([si,Me.ColorIO]))))]))});q.register("ColorDef",Co);const uu=Co,xn={isPaintDef(l){return l===null||typeof l=="string"||l instanceof Me||l instanceof Bs||it(l)&&(l.value===null||typeof l.value=="string"||l.value instanceof Me)},toColor(l){if(typeof l=="string")return new Me(l);if(l instanceof Me)return l.copy();if(it(l))return xn.toColor(l.value);if(l instanceof ls){let e=Me.TRANSPARENT;const t=0;return l.stops.forEach(i=>{e=e.blend(xn.toColor(i.color),1/(t+1))}),e}return Me.TRANSPARENT}};q.register("PaintDef",xn);const vb=(l,e,t)=>Jt.and([l,new Wt(!0,ii({tandem:e.createTandem("selfVisibleProperty"),phetioFeatured:!0},t))],{tandem:e.createTandem("visibleProperty"),phetioValueType:Jn});q.register("createGatedVisibleProperty",vb);const _b=Dt.supportsImageDataCanvasFilter(),Lb=_i.chromium;class Rr extends lr{constructor(e,t,i,n,r,h,p,S,C,B,U,k,Q,X,g,Z,ce,ye,Oe,de){assert&&assert(isFinite(e),"m00 should be a finite number"),assert&&assert(isFinite(t),"m01 should be a finite number"),assert&&assert(isFinite(i),"m02 should be a finite number"),assert&&assert(isFinite(n),"m03 should be a finite number"),assert&&assert(isFinite(r),"m04 should be a finite number"),assert&&assert(isFinite(h),"m10 should be a finite number"),assert&&assert(isFinite(p),"m11 should be a finite number"),assert&&assert(isFinite(S),"m12 should be a finite number"),assert&&assert(isFinite(C),"m13 should be a finite number"),assert&&assert(isFinite(B),"m14 should be a finite number"),assert&&assert(isFinite(U),"m20 should be a finite number"),assert&&assert(isFinite(k),"m21 should be a finite number"),assert&&assert(isFinite(Q),"m22 should be a finite number"),assert&&assert(isFinite(X),"m23 should be a finite number"),assert&&assert(isFinite(g),"m24 should be a finite number"),assert&&assert(isFinite(Z),"m30 should be a finite number"),assert&&assert(isFinite(ce),"m31 should be a finite number"),assert&&assert(isFinite(ye),"m32 should be a finite number"),assert&&assert(isFinite(Oe),"m33 should be a finite number"),assert&&assert(isFinite(de),"m34 should be a finite number"),super(),this.m00=e,this.m01=t,this.m02=i,this.m03=n,this.m04=r,this.m10=h,this.m11=p,this.m12=S,this.m13=C,this.m14=B,this.m20=U,this.m21=k,this.m22=Q,this.m23=X,this.m24=g,this.m30=Z,this.m31=ce,this.m32=ye,this.m33=Oe,this.m34=de}applySVGFilter(e,t,i){lr.applyColorMatrix(`${Rt(this.m00)} ${Rt(this.m01)} ${Rt(this.m02)} ${Rt(this.m03)} ${Rt(this.m04)} ${Rt(this.m10)} ${Rt(this.m11)} ${Rt(this.m12)} ${Rt(this.m13)} ${Rt(this.m14)} ${Rt(this.m20)} ${Rt(this.m21)} ${Rt(this.m22)} ${Rt(this.m23)} ${Rt(this.m24)} ${Rt(this.m30)} ${Rt(this.m31)} ${Rt(this.m32)} ${Rt(this.m33)} ${Rt(this.m34)}`,e,t,i)}applyCanvasFilter(e){const t=e.canvas.width,i=e.canvas.height,n=e.context.getImageData(0,0,t,i),r=t*i;for(let h=0;h<r;h++){const p=h*4;if(Lb){const C=Math.pow(n.data[p+0]/255,1.45),B=Math.pow(n.data[p+1]/255,1.45),U=Math.pow(n.data[p+2]/255,1.45),k=Math.pow(n.data[p+3]/255,1.45);n.data[p+0]=255*Math.pow(C*this.m00+B*this.m01+U*this.m02+k*this.m03+this.m04,1/1.45),n.data[p+1]=255*Math.pow(C*this.m10+B*this.m11+U*this.m12+k*this.m13+this.m14,1/1.45),n.data[p+2]=255*Math.pow(C*this.m20+B*this.m21+U*this.m22+k*this.m23+this.m24,1/1.45),n.data[p+3]=255*Math.pow(C*this.m30+B*this.m31+U*this.m32+k*this.m33+this.m34,1/1.45)}else{const S=n.data[p+0],C=n.data[p+1],B=n.data[p+2],U=n.data[p+3];n.data[p+0]=S*this.m00+C*this.m01+B*this.m02+U*this.m03+this.m04,n.data[p+1]=S*this.m10+C*this.m11+B*this.m12+U*this.m13+this.m14,n.data[p+2]=S*this.m20+C*this.m21+B*this.m22+U*this.m23+this.m24,n.data[p+3]=S*this.m30+C*this.m31+B*this.m32+U*this.m33+this.m34}}e.context.putImageData(n,0,0)}isSVGCompatible(){return!0}isCanvasCompatible(){return super.isCanvasCompatible()||_b}getCSSFilterString(){throw new Error("unimplemented")}}q.register("ColorMatrixFilter",Rr);const Al=class Al extends Rr{constructor(e){assert&&assert(isFinite(e),"Brightness amount should be finite"),assert&&assert(e>=0,"Brightness amount should be non-negative"),super(e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`brightness(${Rt(this.amount)})`}isDOMCompatible(){return!0}};Al.BLACKEN=new Al(0);let Cc=Al;q.register("Brightness",Cc);const Ol=class Ol extends Rr{constructor(e){assert&&assert(isFinite(e),"Contrast amount should be finite"),assert&&assert(e>=0,"Contrast amount should be non-negative"),super(e,0,0,0,-(.5*e)+.5,0,e,0,0,-(.5*e)+.5,0,0,e,0,-(.5*e)+.5,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`contrast(${Rt(this.amount)})`}isDOMCompatible(){return!0}};Ol.GRAY=new Ol(0);let Tc=Ol;q.register("Contrast",Tc);class Pb extends lr{constructor(e,t,i,n=15){assert&&assert(e.isFinite(),"DropShadow offset should be finite"),assert&&assert(isFinite(t),"DropShadow blurRadius should be finite"),assert&&assert(t>=0,"DropShadow blurRadius should be non-negative"),assert&&assert(uu.isColorDef(i),"DropShadow color should be a ColorDef"),super(),this.offset=e,this.blurRadius=t,this.color=i,this.colorCSS=xn.toColor(i).toCSS(),this.filterRegionPercentageIncrease=n}getCSSFilterString(){return`drop-shadow(${Rt(this.offset.x)}px ${Rt(this.offset.y)}px ${Rt(this.blurRadius)}px ${this.colorCSS})`}isDOMCompatible(){return!0}applyCanvasFilter(){throw new Error("unimplemented")}applySVGFilter(e,t,i){throw new Error("unimplemented")}}q.register("DropShadow",Pb);class Sb extends lr{constructor(e,t=15){assert&&assert(isFinite(e),"GaussianBlur standardDeviation should be finite"),assert&&assert(e>=0,"GaussianBlur standardDeviation should be non-negative"),super(),this.standardDeviation=e,this.filterRegionPercentageIncrease=t}getCSSFilterString(){return`blur(${Rt(this.standardDeviation)}px)`}applySVGFilter(e,t,i){const n=document.createElementNS(Gt,"feGaussianBlur");n.setAttribute("stdDeviation",Rt(this.standardDeviation)),n.setAttribute("edgeMode","none"),e.appendChild(n),n.setAttribute("in",t),i&&n.setAttribute("result",i),e.appendChild(n)}isDOMCompatible(){return!0}isSVGCompatible(){return!0}applyCanvasFilter(e){throw new Error("unimplemented")}}q.register("GaussianBlur",Sb);const Ml=class Ml extends Rr{constructor(e=1){assert&&assert(isFinite(e),"Grayscale amount should be finite"),assert&&assert(e>=0,"Grayscale amount should be non-negative"),assert&&assert(e<=1,"Grayscale amount should be no greater than 1");const t=1-e;super(.2126+.7874*t,.7152-.7152*t,.0722-.0722*t,0,0,.2126-.2126*t,.7152+.2848*t,.0722-.0722*t,0,0,.2126-.2126*t,.7152-.7152*t,.0722+.9278*t,0,0,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`grayscale(${Rt(this.amount)})`}isDOMCompatible(){return!0}};Ml.FULL=new Ml(1);let Dc=Ml;q.register("Grayscale",Dc);class wb extends Rr{constructor(e){assert&&assert(isFinite(e),"HueRotate amount should be finite"),assert&&assert(e>=0,"HueRotate amount should be non-negative");const t=Math.cos(e),i=Math.sin(e);super(.213+.787*t-.213*i,.715-.715*t-.715*i,.072-.072*t+.928*i,0,0,.213-.213*t+.143*i,.715+.285*t+.14*i,.072-.072*t-.283*i,0,0,.213-.213*t-.787*i,.715-.715*t+.715*i,.072+.928*t+.072*i,0,0,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`hue-rotate(${Rt(Ui.toDegrees(this.amount))}deg)`}isDOMCompatible(){return!0}}q.register("HueRotate",wb);const Nl=class Nl extends lr{constructor(e=1){assert&&assert(isFinite(e),"Invert amount should be finite"),assert&&assert(e>=0,"Invert amount should be non-negative"),assert&&assert(e<=1,"Invert amount should be no greater than 1"),super(),this.amount=e}getCSSFilterString(){return`invert(${Rt(this.amount)})`}isDOMCompatible(){return!0}applyCanvasFilter(e){throw new Error("unimplemented")}applySVGFilter(e,t,i){throw new Error("unimplemented")}};Nl.FULL=new Nl(1);let Ic=Nl;q.register("Invert",Ic);class Cb extends lr{constructor(e){assert&&assert(isFinite(e),"Opacity amount should be finite"),assert&&assert(e>=0,"Opacity amount should be non-negative"),assert&&assert(e<=1,"Opacity amount should be no greater than 1"),super(),this.amount=e}getCSSFilterString(){return`opacity(${Rt(this.amount)})`}isDOMCompatible(){return!0}applyCanvasFilter(e){throw new Error("unimplemented")}applySVGFilter(e,t,i){throw new Error("unimplemented")}}q.register("Opacity",Cb);class Tb extends Rr{constructor(e){assert&&assert(isFinite(e),"Saturate amount should be finite"),assert&&assert(e>=0,"Saturate amount should be non-negative"),super(.213+.787*e,.715-.715*e,.072-.072*e,0,0,.213-.213*e,.715-.285*e,.072-.072*e,0,0,.213-.213*e,.715-.715*e,.072-.928*e,0,0,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`saturate(${Rt(this.amount)})`}isDOMCompatible(){return!0}}q.register("Saturate",Tb);const Rl=class Rl extends Rr{constructor(e=1){assert&&assert(isFinite(e),"Sepia amount should be finite"),assert&&assert(e>=0,"Sepia amount should be non-negative"),assert&&assert(e<=1,"Sepia amount should be at most 1"),super(.393+.607*(1-e),.769-.769*(1-e),.189-.189*(1-e),0,0,.349-.349*(1-e),.686+.314*(1-e),.168-.168*(1-e),0,0,.272-.272*(1-e),.534-.534*(1-e),.131+.869*(1-e),0,0,0,0,0,1,0),this.amount=e}getCSSFilterString(){return`sepia(${Rt(this.amount)})`}isDOMCompatible(){return!0}};Rl.FULL=new Rl(1);let xc=Rl;q.register("Sepia",xc);const Db=new vt(!1),pa=Db;dr.register("isSettingPhetioStateProperty",pa);class dn extends vt{constructor(e,t=!1,i){super(e,i),t&&(this.targetPropertyInstrumented=t),assert&&(this.phetioInitialized=!1)}setValueOrTargetProperty(e,t,i){if(it(i))this.setTargetProperty(i,e,t);else{const n=this.get();this.clearTargetProperty(),assert&&assert(!this.targetProperty,"just cleared"),this.setPropertyValue(i),this.areValuesEqual(n,i)||this.notifyListeners(n)}}setTargetProperty(e,t=null,i=null){if(assert&&t&&i===null&&this.targetPropertyInstrumented&&assert(!t.isPhetioInstrumented(),"tandemName must be provided for instrumented Nodes"),this.targetProperty===e)return t;const n=this.targetProperty&&this.targetProperty instanceof Is&&this.targetProperty.isPhetioInstrumented();assert&&n&&assert(e&&e instanceof Is&&e.isPhetioInstrumented(),"Cannot set swap out a PhET-iO instrumented targetProperty for an uninstrumented one");const r=this.targetProperty;this.ownedPhetioProperty&&e!==this.ownedPhetioProperty&&this.disposeOwnedPhetioProperty(),t&&i!==null&&t.updateLinkedElementForProperty(i,r,e);const h=this.get();return this.clearTargetProperty(),this.targetProperty=e,this.targetProperty?(assert&&assert(this.forwardingListener,"forwardingListener is not set yet"),this.targetProperty.lazyLink(this.forwardingListener),this.setPropertyValue(this.targetProperty.value)):this.setPropertyValue(h),this.areValuesEqual(h,this.get())||this.notifyListeners(h),t}clearTargetProperty(){this.forwardingListener=this.forwardingListener||this.onTargetPropertyChange.bind(this),this.targetProperty&&this.targetProperty.unlink(this.forwardingListener),this.targetProperty=null}onTargetPropertyChange(e){super.set(e)}set(e){return this.targetProperty?(assert&&assert(this.targetProperty.isSettable(),"targetProperty must be settable"),this.targetProperty.set(e)):super.set(e),this}setTargetPropertyInstrumented(e,t){return assert&&assert(!t.isPhetioInstrumented(),"this option only works if it is passed in before this Node is instrumented"),this.targetPropertyInstrumented=e,t}getTargetPropertyInstrumented(){return this.targetPropertyInstrumented||!1}initializePhetio(e,t,i){assert&&assert(!this.phetioInitialized,"already initialized"),assert&&assert(!this.ownedPhetioProperty,"Already created the ownedPhetioProperty"),!this.targetProperty&&this.targetPropertyInstrumented?(this.ownedPhetioProperty=i(),assert&&assert(this.ownedPhetioProperty instanceof ei,"The owned property should be an AXON/Property"),assert&&assert(this.ownedPhetioProperty instanceof Is&&this.ownedPhetioProperty.isPhetioInstrumented(),"The owned property should be PhET-iO instrumented"),this.setTargetProperty(this.ownedPhetioProperty,e,t)):this.targetProperty&&this.targetProperty instanceof Is&&this.targetProperty.isPhetioInstrumented()&&e.updateLinkedElementForProperty(t,null,this.targetProperty),assert&&(this.phetioInitialized=!0)}getTargetProperty(){return this.targetProperty||null}disposeOwnedPhetioProperty(){this.ownedPhetioProperty&&(this.ownedPhetioProperty.dispose(),delete this.ownedPhetioProperty)}dispose(){this.clearTargetProperty(),this.disposeOwnedPhetioProperty(),super.dispose()}}hs.register("TinyForwardingProperty",dn);const Kr=dt.TAGS.INPUT,uf=dt.TAGS.P,Ib=uf,xb=uf,Eb=(l,e,t)=>(e.labelTagName=`h${l.headingLevel}`,e.labelContent=t,e),Ma=l=>{const e=l===null?null:typeof l=="string"?l:l.value;return assert&&assert(e===null||typeof e=="string"),e},kb=dt.FORM_ELEMENTS,Jd=dt.INPUT_TYPES_THAT_SUPPORT_CHECKED,Ab=dt.ASSOCIATION_ATTRIBUTES,Ec=["focusable","tagName","accessibleName","accessibleNameBehavior","helpText","helpTextBehavior","pdomHeading","pdomHeadingBehavior","containerTagName","containerAriaRole","innerContent","inputType","inputValue","pdomChecked","pdomNamespace","ariaLabel","ariaRole","ariaValueText","labelTagName","labelContent","appendLabel","descriptionTagName","descriptionContent","appendDescription","focusHighlight","focusHighlightLayerable","groupFocusHighlight","pdomVisibleProperty","pdomVisible","pdomOrder","ariaLabelledbyAssociations","ariaDescribedbyAssociations","activeDescendantAssociations","focusPanTargetBoundsProperty","limitPanDirection","positionInPDOM","pdomTransformSourceNode"];class To extends yi{constructor(e){super(e),this._inputValue=null,this._labelContent=null,this._innerContent=null,this._descriptionContent=null,this._ariaLabel=null,this._hasAppliedAriaLabel=!1,this._ariaValueText=null,this._hasAppliedAriaValueText=!1,this._accessibleName=null,this._helpText=null,this._pdomHeading=null,this.focusHighlightChangedEmitter=new zt,this.pdomParentChangedEmitter=new zt,this.pdomDisplaysEmitter=new zt,this._onPDOMContentChangeListener=this.onPDOMContentChange.bind(this),this._onInputValueChangeListener=this.invalidatePeerInputValue.bind(this),this._onAriaLabelChangeListener=this.onAriaLabelChange.bind(this),this._onAriaValueTextChangeListener=this.onAriaValueTextChange.bind(this),this._onLabelContentChangeListener=this.invalidatePeerLabelSiblingContent.bind(this),this._onDescriptionContentChangeListener=this.invalidatePeerDescriptionSiblingContent.bind(this),this._onInnerContentChangeListener=this.onInnerContentPropertyChange.bind(this),this._tagName=null,this._containerTagName=null,this._labelTagName=null,this._descriptionTagName=null,this._inputType=null,this._pdomChecked=!1,this._appendLabel=!1,this._appendDescription=!1,this._pdomAttributes=[],this._pdomClasses=[],this._pdomNamespace=null,this._ariaRole=null,this._containerAriaRole=null,this._ariaLabelledbyAssociations=[],this._nodesThatAreAriaLabelledbyThisNode=[],this._ariaDescribedbyAssociations=[],this._nodesThatAreAriaDescribedbyThisNode=[],this._activeDescendantAssociations=[],this._nodesThatAreActiveDescendantToThisNode=[],this._focusableOverride=null,this._focusHighlight=null,this._focusHighlightLayerable=!1,this._groupFocusHighlight=!1,this._pdomOrder=null,this._pdomParent=null,this._pdomTransformSourceNode=null,this._focusPanTargetBoundsProperty=null,this._limitPanDirection=null,this._pdomDisplaysInfo=new ff(this),this._pdomInstances=[],this._positionInPDOM=!1,this.excludeLabelSiblingFromInput=!1,this._pdomVisibleProperty=new dn(!0,!1,this.onPdomVisiblePropertyChange.bind(this)),this._accessibleNameBehavior=To.BASIC_ACCESSIBLE_NAME_BEHAVIOR,this._helpTextBehavior=To.HELP_TEXT_AFTER_CONTENT,this._headingLevel=null,this._pdomHeadingBehavior=Eb,this.pdomBoundInputEnabledListener=this.pdomInputEnabledListener.bind(this)}disposeParallelDOM(){if(it(this._accessibleName)&&!this._accessibleName.isDisposed&&(this._accessibleName.unlink(this._onPDOMContentChangeListener),this._accessibleName=null),it(this._helpText)&&!this._helpText.isDisposed&&(this._helpText.unlink(this._onPDOMContentChangeListener),this._helpText=null),it(this._pdomHeading)&&!this._pdomHeading.isDisposed&&(this._pdomHeading.unlink(this._onPDOMContentChangeListener),this._pdomHeading=null),it(this._inputValue)&&!this._inputValue.isDisposed&&(this._inputValue.unlink(this._onPDOMContentChangeListener),this._inputValue=null),it(this._ariaLabel)&&!this._ariaLabel.isDisposed&&this._ariaLabel.unlink(this._onAriaLabelChangeListener),it(this._ariaValueText)&&!this._ariaValueText.isDisposed&&this._ariaValueText.unlink(this._onAriaValueTextChangeListener),it(this._innerContent)&&!this._innerContent.isDisposed&&this._innerContent.unlink(this._onInnerContentChangeListener),it(this._labelContent)&&!this._labelContent.isDisposed&&this._labelContent.unlink(this._onLabelContentChangeListener),it(this._descriptionContent)&&!this._descriptionContent.isDisposed&&this._descriptionContent.unlink(this._onDescriptionContentChangeListener),this.inputEnabledProperty.unlink(this.pdomBoundInputEnabledListener),this.pdomOrder=null,this._pdomParent){const e=this._pdomParent._pdomOrder;assert&&assert(e,"pdomParent should have a pdomOrder"),this._pdomParent.pdomOrder=e.filter(t=>t!==this)}this.setPDOMTransformSourceNode(null),this.setAriaLabelledbyAssociations([]),this.setAriaDescribedbyAssociations([]),this.setActiveDescendantAssociations([]),this.removePDOMAttributes(),this._pdomVisibleProperty.dispose()}pdomInputEnabledListener(e){this.setPDOMAttribute("aria-disabled",!e),this.setPDOMAttribute("onclick",e?"":"return false")}isFocused(){for(let e=0;e<this._pdomInstances.length;e++)if(this._pdomInstances[e].peer.isFocused())return!0;return!1}get focused(){return this.isFocused()}focus(){if(this._pdomInstances.length>0){assert&&assert(this.focusable,"trying to set focus on a node that is not focusable"),assert&&assert(this.pdomVisible,"trying to set focus on a node with invisible pdom content"),assert&&assert(this._pdomInstances.length===1,"focus() unsupported for Nodes using DAG, pdom content is not unique");const e=this._pdomInstances[0].peer;assert&&assert(e,"must have a peer to focus"),e.focus()}}blur(){if(this._pdomInstances.length>0){assert&&assert(this._pdomInstances.length===1,"blur() unsupported for Nodes using DAG, pdom content is not unique");const e=this._pdomInstances[0].peer;assert&&assert(e,"must have a peer to blur"),e.blur()}}pdomAudit(){this.hasPDOMContent&&assert&&(this._inputType&&assert(this._tagName.toUpperCase()===Kr,"tagName must be INPUT to support inputType"),this._pdomChecked&&assert(this._tagName.toUpperCase()===Kr,"tagName must be INPUT to support pdomChecked."),this._inputValue&&assert(this._tagName.toUpperCase()===Kr,"tagName must be INPUT to support inputValue"),this._pdomChecked&&assert(Jd.includes(this._inputType.toUpperCase()),`inputType does not support checked attribute: ${this._inputType}`),this._focusHighlightLayerable&&assert(this.focusHighlight instanceof Ge,"focusHighlight must be Node if highlight is layerable"),this._tagName.toUpperCase()===Kr&&assert(typeof this._inputType=="string"," inputType expected for input"),this.ariaRole==="application"&&assert(this.innerContent||this.accessibleName,"must have some innerContent or element will never be focusable in VoiceOver"));for(let e=0;e<this.children.length;e++)this.children[e].pdomAudit()}setAccessibleName(e){e!==this._accessibleName&&(it(this._accessibleName)&&!this._accessibleName.isDisposed&&this._accessibleName.unlink(this._onPDOMContentChangeListener),this._accessibleName=e,it(e)&&e.lazyLink(this._onPDOMContentChangeListener),this.onPDOMContentChange())}set accessibleName(e){this.setAccessibleName(e)}get accessibleName(){return this.getAccessibleName()}getAccessibleName(){return it(this._accessibleName)?this._accessibleName.value:this._accessibleName}removeFromPDOM(){assert&&assert(this._tagName!==null,"There is no pdom content to clear from the PDOM"),this.tagName=null}setAccessibleNameBehavior(e){this._accessibleNameBehavior!==e&&(this._accessibleNameBehavior=e,this.onPDOMContentChange())}set accessibleNameBehavior(e){this.setAccessibleNameBehavior(e)}get accessibleNameBehavior(){return this.getAccessibleNameBehavior()}getAccessibleNameBehavior(){return this._accessibleNameBehavior}setPDOMHeading(e){e!==this._pdomHeading&&(it(this._pdomHeading)&&!this._pdomHeading.isDisposed&&this._pdomHeading.unlink(this._onPDOMContentChangeListener),this._pdomHeading=e,it(e)&&e.lazyLink(this._onPDOMContentChangeListener),this.onPDOMContentChange())}set pdomHeading(e){this.setPDOMHeading(e)}get pdomHeading(){return this.getPDOMHeading()}getPDOMHeading(){return it(this._pdomHeading)?this._pdomHeading.value:this._pdomHeading}setPDOMHeadingBehavior(e){this._pdomHeadingBehavior!==e&&(this._pdomHeadingBehavior=e,this.onPDOMContentChange())}set pdomHeadingBehavior(e){this.setPDOMHeadingBehavior(e)}get pdomHeadingBehavior(){return this.getPDOMHeadingBehavior()}getPDOMHeadingBehavior(){return this._pdomHeadingBehavior}getHeadingLevel(){return this._headingLevel}get headingLevel(){return this.getHeadingLevel()}computeHeadingLevel(){if(!this._pdomParent)return this.pdomHeading?(this._headingLevel=1,1):0;if(this.pdomHeading){const e=this._pdomParent.computeHeadingLevel()+1;return this._headingLevel=e,e}else return this._pdomParent.computeHeadingLevel()}setHelpText(e){e!==this._helpText&&(it(this._helpText)&&!this._helpText.isDisposed&&this._helpText.unlink(this._onPDOMContentChangeListener),this._helpText=e,it(e)&&e.lazyLink(this._onPDOMContentChangeListener),this.onPDOMContentChange())}set helpText(e){this.setHelpText(e)}get helpText(){return this.getHelpText()}getHelpText(){return it(this._helpText)?this._helpText.value:this._helpText}setHelpTextBehavior(e){this._helpTextBehavior!==e&&(this._helpTextBehavior=e,this.onPDOMContentChange())}set helpTextBehavior(e){this.setHelpTextBehavior(e)}get helpTextBehavior(){return this.getHelpTextBehavior()}getHelpTextBehavior(){return this._helpTextBehavior}setTagName(e){assert&&assert(e===null||typeof e=="string"),e!==this._tagName&&(this._tagName=e,this.onPDOMContentChange())}set tagName(e){this.setTagName(e)}get tagName(){return this.getTagName()}getTagName(){return this._tagName}setLabelTagName(e){assert&&assert(e===null||typeof e=="string"),e!==this._labelTagName&&(this._labelTagName=e,this.onPDOMContentChange())}set labelTagName(e){this.setLabelTagName(e)}get labelTagName(){return this.getLabelTagName()}getLabelTagName(){return this._labelTagName}setDescriptionTagName(e){assert&&assert(e===null||typeof e=="string"),e!==this._descriptionTagName&&(this._descriptionTagName=e,this.onPDOMContentChange())}set descriptionTagName(e){this.setDescriptionTagName(e)}get descriptionTagName(){return this.getDescriptionTagName()}getDescriptionTagName(){return this._descriptionTagName}setInputType(e){if(assert&&assert(e===null||typeof e=="string"),assert&&this.tagName&&assert(this._tagName.toUpperCase()===Kr,"tag name must be INPUT to support inputType"),e!==this._inputType){this._inputType=e;for(let t=0;t<this._pdomInstances.length;t++){const i=this._pdomInstances[t].peer;e===null?i.removeAttributeFromElement("type"):i.setAttributeToElement("type",e)}}}set inputType(e){this.setInputType(e)}get inputType(){return this.getInputType()}getInputType(){return this._inputType}setAppendLabel(e){this._appendLabel!==e&&(this._appendLabel=e,this.onPDOMContentChange())}set appendLabel(e){this.setAppendLabel(e)}get appendLabel(){return this.getAppendLabel()}getAppendLabel(){return this._appendLabel}setAppendDescription(e){this._appendDescription!==e&&(this._appendDescription=e,this.onPDOMContentChange())}set appendDescription(e){this.setAppendDescription(e)}get appendDescription(){return this.getAppendDescription()}getAppendDescription(){return this._appendDescription}setContainerTagName(e){assert&&assert(e===null||typeof e=="string",`invalid tagName argument: ${e}`),this._containerTagName!==e&&(this._containerTagName=e,this.onPDOMContentChange())}set containerTagName(e){this.setContainerTagName(e)}get containerTagName(){return this.getContainerTagName()}getContainerTagName(){return this._containerTagName}invalidatePeerLabelSiblingContent(){const e=this.labelContent;this._labelTagName||this.setLabelTagName(xb);for(let t=0;t<this._pdomInstances.length;t++)this._pdomInstances[t].peer.setLabelSiblingContent(e)}setLabelContent(e){e!==this._labelContent&&(it(this._labelContent)&&!this._labelContent.isDisposed&&this._labelContent.unlink(this._onLabelContentChangeListener),this._labelContent=e,it(e)&&e.lazyLink(this._onLabelContentChangeListener),this.invalidatePeerLabelSiblingContent())}set labelContent(e){this.setLabelContent(e)}get labelContent(){return this.getLabelContent()}getLabelContent(){return Ma(this._labelContent)}onInnerContentPropertyChange(){const e=this.innerContent;for(let t=0;t<this._pdomInstances.length;t++)this._pdomInstances[t].peer.setPrimarySiblingContent(e)}setInnerContent(e){e!==this._innerContent&&(it(this._innerContent)&&!this._innerContent.isDisposed&&this._innerContent.unlink(this._onInnerContentChangeListener),this._innerContent=e,it(e)&&e.lazyLink(this._onInnerContentChangeListener),this.onInnerContentPropertyChange())}set innerContent(e){this.setInnerContent(e)}get innerContent(){return this.getInnerContent()}getInnerContent(){return Ma(this._innerContent)}invalidatePeerDescriptionSiblingContent(){const e=this.descriptionContent;this._descriptionTagName||this.setDescriptionTagName(Ib);for(let t=0;t<this._pdomInstances.length;t++)this._pdomInstances[t].peer.setDescriptionSiblingContent(e)}setDescriptionContent(e){e!==this._descriptionContent&&(it(this._descriptionContent)&&!this._descriptionContent.isDisposed&&this._descriptionContent.unlink(this._onDescriptionContentChangeListener),this._descriptionContent=e,it(e)&&e.lazyLink(this._onDescriptionContentChangeListener),this.invalidatePeerDescriptionSiblingContent())}set descriptionContent(e){this.setDescriptionContent(e)}get descriptionContent(){return this.getDescriptionContent()}getDescriptionContent(){return Ma(this._descriptionContent)}setAriaRole(e){assert&&assert(e===null||typeof e=="string"),this._ariaRole!==e&&(this._ariaRole=e,e!==null?this.setPDOMAttribute("role",e):this.removePDOMAttribute("role"))}set ariaRole(e){this.setAriaRole(e)}get ariaRole(){return this.getAriaRole()}getAriaRole(){return this._ariaRole}setContainerAriaRole(e){assert&&assert(e===null||typeof e=="string"),this._containerAriaRole!==e&&(this._containerAriaRole=e,e===null?this.removePDOMAttribute("role",{elementName:Cn.CONTAINER_PARENT}):this.setPDOMAttribute("role",e,{elementName:Cn.CONTAINER_PARENT}))}set containerAriaRole(e){this.setContainerAriaRole(e)}get containerAriaRole(){return this.getContainerAriaRole()}getContainerAriaRole(){return this._containerAriaRole}onAriaValueTextChange(){const e=this.ariaValueText;e===null?this._hasAppliedAriaLabel&&(this.removePDOMAttribute("aria-valuetext"),this._hasAppliedAriaLabel=!1):(this.setPDOMAttribute("aria-valuetext",e),this._hasAppliedAriaLabel=!0)}setAriaValueText(e){this._ariaValueText!==e&&(it(this._ariaValueText)&&!this._ariaValueText.isDisposed&&this._ariaValueText.unlink(this._onAriaValueTextChangeListener),this._ariaValueText=e,it(e)&&e.lazyLink(this._onAriaValueTextChangeListener),this.onAriaValueTextChange())}set ariaValueText(e){this.setAriaValueText(e)}get ariaValueText(){return this.getAriaValueText()}getAriaValueText(){return Ma(this._ariaValueText)}setPDOMNamespace(e){return assert&&assert(e===null||typeof e=="string"),this._pdomNamespace!==e&&(this._pdomNamespace=e,this.onPDOMContentChange()),this}set pdomNamespace(e){this.setPDOMNamespace(e)}get pdomNamespace(){return this.getPDOMNamespace()}getPDOMNamespace(){return this._pdomNamespace}onAriaLabelChange(){const e=this.ariaLabel;e===null?this._hasAppliedAriaLabel&&(this.removePDOMAttribute("aria-label"),this._hasAppliedAriaLabel=!1):(this.setPDOMAttribute("aria-label",e),this._hasAppliedAriaLabel=!0)}setAriaLabel(e){this._ariaLabel!==e&&(it(this._ariaLabel)&&!this._ariaLabel.isDisposed&&this._ariaLabel.unlink(this._onAriaLabelChangeListener),this._ariaLabel=e,it(e)&&e.lazyLink(this._onAriaLabelChangeListener),this.onAriaLabelChange())}set ariaLabel(e){this.setAriaLabel(e)}get ariaLabel(){return this.getAriaLabel()}getAriaLabel(){return Ma(this._ariaLabel)}setFocusHighlight(e){this._focusHighlight!==e&&(this._focusHighlight=e,this._focusHighlightLayerable&&(assert&&assert(e instanceof Ge),e.visible=!1),this.focusHighlightChangedEmitter.emit())}set focusHighlight(e){this.setFocusHighlight(e)}get focusHighlight(){return this.getFocusHighlight()}getFocusHighlight(){return this._focusHighlight}setFocusHighlightLayerable(e){this._focusHighlightLayerable!==e&&(this._focusHighlightLayerable=e,this._focusHighlight&&(assert&&assert(this._focusHighlight instanceof Ge),this._focusHighlight.visible=!1,this.focusHighlightChangedEmitter.emit()))}set focusHighlightLayerable(e){this.setFocusHighlightLayerable(e)}get focusHighlightLayerable(){return this.getFocusHighlightLayerable()}getFocusHighlightLayerable(){return this._focusHighlightLayerable}setGroupFocusHighlight(e){this._groupFocusHighlight=e}set groupFocusHighlight(e){this.setGroupFocusHighlight(e)}get groupFocusHighlight(){return this.getGroupFocusHighlight()}getGroupFocusHighlight(){return this._groupFocusHighlight}setAriaLabelledbyAssociations(e){let t,i;if(assert)for(assert(Array.isArray(e)),i=0;i<e.length;i++)t=e[i];if(e.length===0&&this._ariaLabelledbyAssociations.length===0)return;const n=[],r=[],h=[];for(xr(e,this._ariaLabelledbyAssociations,r,n,h),i=0;i<n.length;i++)t=n[i],this.removeAriaLabelledbyAssociation(t);for(assert&&assert(this._ariaLabelledbyAssociations.length===h.length,"Removing associations should not have triggered other association changes"),i=0;i<r.length;i++){const p=e[i];this.addAriaLabelledbyAssociation(p)}}set ariaLabelledbyAssociations(e){this.setAriaLabelledbyAssociations(e)}get ariaLabelledbyAssociations(){return this.getAriaLabelledbyAssociations()}getAriaLabelledbyAssociations(){return this._ariaLabelledbyAssociations}addAriaLabelledbyAssociation(e){this._ariaLabelledbyAssociations.push(e),e.otherNode._nodesThatAreAriaLabelledbyThisNode.push(this),this.updateAriaLabelledbyAssociationsInPeers()}removeAriaLabelledbyAssociation(e){assert&&assert(_.includes(this._ariaLabelledbyAssociations,e)),this._ariaLabelledbyAssociations.splice(_.indexOf(this._ariaLabelledbyAssociations,e),1)[0].otherNode.removeNodeThatIsAriaLabelledByThisNode(this),this.updateAriaLabelledbyAssociationsInPeers()}removeNodeThatIsAriaLabelledByThisNode(e){const t=_.indexOf(this._nodesThatAreAriaLabelledbyThisNode,e);assert&&assert(t>=0),this._nodesThatAreAriaLabelledbyThisNode.splice(t,1)}updateAriaLabelledbyAssociationsInPeers(){for(let e=0;e<this.pdomInstances.length;e++)this.pdomInstances[e].peer.onAriaLabelledbyAssociationChange()}updateOtherNodesAriaLabelledby(){for(let e=0;e<this._nodesThatAreAriaLabelledbyThisNode.length;e++)this._nodesThatAreAriaLabelledbyThisNode[e].updateAriaLabelledbyAssociationsInPeers()}getNodesThatAreAriaLabelledbyThisNode(){return this._nodesThatAreAriaLabelledbyThisNode}get nodesThatAreAriaLabelledbyThisNode(){return this.getNodesThatAreAriaLabelledbyThisNode()}setAriaDescribedbyAssociations(e){let t;if(assert){assert(Array.isArray(e));for(let p=0;p<e.length;p++)t=e[p]}if(e.length===0&&this._ariaDescribedbyAssociations.length===0)return;const i=[],n=[],r=[];let h;for(xr(e,this._ariaDescribedbyAssociations,n,i,r),h=0;h<i.length;h++)t=i[h],this.removeAriaDescribedbyAssociation(t);for(assert&&assert(this._ariaDescribedbyAssociations.length===r.length,"Removing associations should not have triggered other association changes"),h=0;h<n.length;h++){const p=e[h];this.addAriaDescribedbyAssociation(p)}}set ariaDescribedbyAssociations(e){this.setAriaDescribedbyAssociations(e)}get ariaDescribedbyAssociations(){return this.getAriaDescribedbyAssociations()}getAriaDescribedbyAssociations(){return this._ariaDescribedbyAssociations}addAriaDescribedbyAssociation(e){assert&&assert(!_.includes(this._ariaDescribedbyAssociations,e),"describedby association already registed"),this._ariaDescribedbyAssociations.push(e),e.otherNode._nodesThatAreAriaDescribedbyThisNode.push(this),this.updateAriaDescribedbyAssociationsInPeers()}hasAriaDescribedbyAssociation(e){return _.includes(this._ariaDescribedbyAssociations,e)}removeAriaDescribedbyAssociation(e){assert&&assert(_.includes(this._ariaDescribedbyAssociations,e)),this._ariaDescribedbyAssociations.splice(_.indexOf(this._ariaDescribedbyAssociations,e),1)[0].otherNode.removeNodeThatIsAriaDescribedByThisNode(this),this.updateAriaDescribedbyAssociationsInPeers()}removeNodeThatIsAriaDescribedByThisNode(e){const t=_.indexOf(this._nodesThatAreAriaDescribedbyThisNode,e);assert&&assert(t>=0),this._nodesThatAreAriaDescribedbyThisNode.splice(t,1)}updateAriaDescribedbyAssociationsInPeers(){for(let e=0;e<this.pdomInstances.length;e++)this.pdomInstances[e].peer.onAriaDescribedbyAssociationChange()}updateOtherNodesAriaDescribedby(){for(let e=0;e<this._nodesThatAreAriaDescribedbyThisNode.length;e++)this._nodesThatAreAriaDescribedbyThisNode[e].updateAriaDescribedbyAssociationsInPeers()}getNodesThatAreAriaDescribedbyThisNode(){return this._nodesThatAreAriaDescribedbyThisNode}get nodesThatAreAriaDescribedbyThisNode(){return this.getNodesThatAreAriaDescribedbyThisNode()}setActiveDescendantAssociations(e){let t;if(assert){assert(Array.isArray(e));for(let p=0;p<e.length;p++)t=e[p]}if(e.length===0&&this._activeDescendantAssociations.length===0)return;const i=[],n=[],r=[];let h;for(xr(e,this._activeDescendantAssociations,n,i,r),h=0;h<i.length;h++)t=i[h],this.removeActiveDescendantAssociation(t);for(assert&&assert(this._activeDescendantAssociations.length===r.length,"Removing associations should not have triggered other association changes"),h=0;h<n.length;h++){const p=e[h];this.addActiveDescendantAssociation(p)}}set activeDescendantAssociations(e){this.setActiveDescendantAssociations(e)}get activeDescendantAssociations(){return this.getActiveDescendantAssociations()}getActiveDescendantAssociations(){return this._activeDescendantAssociations}addActiveDescendantAssociation(e){this._activeDescendantAssociations.push(e),e.otherNode._nodesThatAreActiveDescendantToThisNode.push(this),this.updateActiveDescendantAssociationsInPeers()}removeActiveDescendantAssociation(e){assert&&assert(_.includes(this._activeDescendantAssociations,e)),this._activeDescendantAssociations.splice(_.indexOf(this._activeDescendantAssociations,e),1)[0].otherNode.removeNodeThatIsActiveDescendantThisNode(this),this.updateActiveDescendantAssociationsInPeers()}removeNodeThatIsActiveDescendantThisNode(e){const t=_.indexOf(this._nodesThatAreActiveDescendantToThisNode,e);assert&&assert(t>=0),this._nodesThatAreActiveDescendantToThisNode.splice(t,1)}updateActiveDescendantAssociationsInPeers(){for(let e=0;e<this.pdomInstances.length;e++)this.pdomInstances[e].peer.onActiveDescendantAssociationChange()}updateOtherNodesActiveDescendant(){for(let e=0;e<this._nodesThatAreActiveDescendantToThisNode.length;e++)this._nodesThatAreActiveDescendantToThisNode[e].updateActiveDescendantAssociationsInPeers()}getNodesThatAreActiveDescendantToThisNode(){return this._nodesThatAreActiveDescendantToThisNode}get nodesThatAreActiveDescendantToThisNode(){return this.getNodesThatAreActiveDescendantToThisNode()}setPDOMOrder(e){assert&&assert(Array.isArray(e)||e===null,`Array or null expected, received: ${e}`),assert&&e&&e.forEach((i,n)=>{assert&&assert(i===null||i instanceof Ge,`Elements of pdomOrder should be either a Node or null. Element at index ${n} is: ${i}`)}),assert&&e&&assert(this.getTrails(i=>_.includes(e,i)).length===0,"pdomOrder should not include any ancestors or the node itself");let t=this._pdomOrder===null&&e!==null||this._pdomOrder!==null&&e===null;if(!t&&e&&this._pdomOrder&&(t=e.length!==this._pdomOrder.length,!t)){for(let i=0;i<e.length;i++)if(e[i]!==this._pdomOrder[i]){t=!0;break}}if(t){const i=this._pdomOrder;this._pdomOrder=e===null?null:e.slice(),Rs.pdomOrderChange(this,i,e),this.rendererSummaryRefreshEmitter.emit()}}set pdomOrder(e){this.setPDOMOrder(e)}get pdomOrder(){return this.getPDOMOrder()}getPDOMOrder(){return this._pdomOrder?this._pdomOrder.slice(0):this._pdomOrder}hasPDOMOrder(){return this._pdomOrder!==null&&this._pdomOrder.length!==0&&(this._pdomOrder.length>1||this._pdomOrder[0]!==null)}getPDOMParent(){return this._pdomParent}get pdomParent(){return this.getPDOMParent()}getEffectiveChildren(){const e=[];for(let t=0;t<this._children.length;t++){const i=this._children[t];i._pdomParent||e.push(i)}if(this.hasPDOMOrder()){const t=this.pdomOrder.slice(),i=t.indexOf(null);return i>=0?(e.unshift(i,1),Array.prototype.splice.apply(t,e)):Array.prototype.push.apply(t,e),t}else return e}onPdomVisiblePropertyChange(e){this._pdomDisplaysInfo.onPDOMVisibilityChange(e)}setPdomVisibleProperty(e){return this._pdomVisibleProperty.setTargetProperty(e),this}set pdomVisibleProperty(e){this.setPdomVisibleProperty(e)}get pdomVisibleProperty(){return this.getPdomVisibleProperty()}getPdomVisibleProperty(){return this._pdomVisibleProperty}setPDOMVisible(e){this.pdomVisibleProperty.value=e}set pdomVisible(e){this.setPDOMVisible(e)}get pdomVisible(){return this.isPDOMVisible()}isPDOMVisible(){return this.pdomVisibleProperty.value}isPDOMDisplayed(){for(let e=0;e<this._pdomInstances.length;e++)if(this._pdomInstances[e].isGloballyVisible())return!0;return!1}get pdomDisplayed(){return this.isPDOMDisplayed()}invalidatePeerInputValue(){for(let e=0;e<this.pdomInstances.length;e++)this.pdomInstances[e].peer.onInputValueChange()}setInputValue(e){assert&&this._tagName&&assert(_.includes(kb,this._tagName.toUpperCase()),"dom element must be a form element to support value"),e!==this._inputValue&&(it(this._inputValue)&&!this._inputValue.isDisposed&&this._inputValue.unlink(this._onPDOMContentChangeListener),this._inputValue=e,it(e)&&e.lazyLink(this._onPDOMContentChangeListener),this.invalidatePeerInputValue())}set inputValue(e){this.setInputValue(e)}get inputValue(){return this.getInputValue()}getInputValue(){let e;return it(this._inputValue)?e=this._inputValue.value:e=this._inputValue,e===null?null:""+e}setPDOMChecked(e){this._tagName&&assert&&assert(this._tagName.toUpperCase()===Kr,"Cannot set checked on a non input tag."),this._inputType&&assert&&assert(Jd.includes(this._inputType.toUpperCase()),`inputType does not support checked: ${this._inputType}`),this._pdomChecked!==e&&(this._pdomChecked=e,this.setPDOMAttribute("checked",e,{asProperty:!0}))}set pdomChecked(e){this.setPDOMChecked(e)}get pdomChecked(){return this.getPDOMChecked()}getPDOMChecked(){return this._pdomChecked}getPDOMAttributes(){return this._pdomAttributes.slice(0)}get pdomAttributes(){return this.getPDOMAttributes()}setPDOMAttribute(e,t,i){assert&&i&&assert(Object.getPrototypeOf(i)===Object.prototype,"Extra prototype on pdomAttribute options object is a code smell");const n=je()({namespace:null,asProperty:!1,elementName:Cn.PRIMARY_SIBLING},i);assert&&assert(!Ab.includes(e),"setPDOMAttribute does not support association attributes");for(let h=0;h<this._pdomAttributes.length;h++){const p=this._pdomAttributes[h];p.attribute===e&&p.options.namespace===n.namespace&&p.options.elementName===n.elementName&&(p.options.asProperty===n.asProperty?this._pdomAttributes.splice(h,1):this.removePDOMAttribute(p.attribute,p.options))}let r=h=>{assert&&typeof h=="string"&&ir(h,Hs.STRING_WITHOUT_TEMPLATE_VARS_VALIDATOR);for(let p=0;p<this._pdomInstances.length;p++)this._pdomInstances[p].peer.setAttributeToElement(e,h,n)};it(t)?t.link(r):(r(t),r=null),this._pdomAttributes.push({attribute:e,value:t,listener:r,options:n})}removePDOMAttribute(e,t){assert&&t&&assert(Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on pdomAttribute options object is a code smell");const i=je()({namespace:null,elementName:Cn.PRIMARY_SIBLING},t);let n=!1;for(let r=0;r<this._pdomAttributes.length;r++)if(this._pdomAttributes[r].attribute===e&&this._pdomAttributes[r].options.namespace===i.namespace&&this._pdomAttributes[r].options.elementName===i.elementName){const h=this._pdomAttributes[r];h.listener&&it(h.value)&&!h.value.isDisposed&&h.value.unlink(h.listener),this._pdomAttributes.splice(r,1),n=!0}assert&&assert(n,`Node does not have pdom attribute ${e}`);for(let r=0;r<this._pdomInstances.length;r++)this._pdomInstances[r].peer.removeAttributeFromElement(e,i)}removePDOMAttributes(){const e=this.getPDOMAttributes();for(let t=0;t<e.length;t++){const i=e[t].attribute;this.removePDOMAttribute(i)}}hasPDOMAttribute(e,t){assert&&t&&assert(Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on pdomAttribute options object is a code smell");const i=je()({namespace:null,elementName:Cn.PRIMARY_SIBLING},t);let n=!1;for(let r=0;r<this._pdomAttributes.length;r++)this._pdomAttributes[r].attribute===e&&this._pdomAttributes[r].options.namespace===i.namespace&&this._pdomAttributes[r].options.elementName===i.elementName&&(n=!0);return n}setPDOMClass(e,t){const i=je()({elementName:Cn.PRIMARY_SIBLING},t);for(let n=0;n<this._pdomClasses.length;n++){const r=this._pdomClasses[n];if(r.className===e&&r.options.elementName===i.elementName)return}this._pdomClasses.push({className:e,options:i});for(let n=0;n<this._pdomInstances.length;n++)this._pdomInstances[n].peer.setClassToElement(e,i)}removePDOMClass(e,t){const i=je()({elementName:Cn.PRIMARY_SIBLING},t);let n=!1;for(let r=0;r<this._pdomClasses.length;r++)this._pdomClasses[r].className===e&&this._pdomClasses[r].options.elementName===i.elementName&&(this._pdomClasses.splice(r,1),n=!0);assert&&assert(n,`Node does not have pdom attribute ${e}`);for(let r=0;r<this._pdomClasses.length;r++)this.pdomInstances[r].peer.removeClassFromElement(e,i)}getPDOMClasses(){return this._pdomClasses.slice(0)}get pdomClasses(){return this.getPDOMClasses()}setFocusable(e){if(assert&&assert(e===null||typeof e=="boolean"),this._focusableOverride!==e){this._focusableOverride=e;for(let t=0;t<this._pdomInstances.length;t++)assert&&assert(this._pdomInstances[t].peer,"Peer required to set focusable."),this._pdomInstances[t].peer.setFocusable(this.focusable)}}set focusable(e){this.setFocusable(e)}get focusable(){return this.isFocusable()}isFocusable(){return this._focusableOverride!==null?this._focusableOverride:this._tagName===null?!1:dt.tagIsDefaultFocusable(this._tagName)}setPDOMTransformSourceNode(e){this._pdomTransformSourceNode=e;for(let t=0;t<this._pdomInstances.length;t++)this._pdomInstances[t].peer.setPDOMTransformSourceNode(this._pdomTransformSourceNode)}set pdomTransformSourceNode(e){this.setPDOMTransformSourceNode(e)}get pdomTransformSourceNode(){return this.getPDOMTransformSourceNode()}getPDOMTransformSourceNode(){return this._pdomTransformSourceNode}setFocusPanTargetBoundsProperty(e){e!==this._focusPanTargetBoundsProperty&&(assert&&assert(!this._focusPanTargetBoundsProperty,"Cannot change focusPanTargetBoundsProperty after it is set."),this._focusPanTargetBoundsProperty=e)}getFocusPanTargetBoundsProperty(){return this._focusPanTargetBoundsProperty}set focusPanTargetBoundsProperty(e){this.setFocusPanTargetBoundsProperty(e)}get focusPanTargetBoundsProperty(){return this.getFocusPanTargetBoundsProperty()}setLimitPanDirection(e){this._limitPanDirection=e}getLimitPanDirection(){return this._limitPanDirection}set limitPanDirection(e){this.setLimitPanDirection(e)}get limitPanDirection(){return this.getLimitPanDirection()}setPositionInPDOM(e){this._positionInPDOM=e;for(let t=0;t<this._pdomInstances.length;t++)this._pdomInstances[t].peer.setPositionInPDOM(e)}set positionInPDOM(e){this.setPositionInPDOM(e)}get positionInPDOM(){return this.getPositionInPDOM()}getPositionInPDOM(){return this._positionInPDOM}setExcludeLabelSiblingFromInput(){this.excludeLabelSiblingFromInput=!0,this.onPDOMContentChange()}isInsidePhetioArchetype(e=this){if(e.isPhetioInstrumented())return e.phetioIsArchetype;for(let t=0;t<e.parents.length;t++)if(this.isInsidePhetioArchetype(e.parents[t]))return!0;return!1}alertDescriptionUtterance(e){if(pa.value||Ft.PHET_IO_ENABLED&&this.isInsidePhetioArchetype())return;const t=this.getConnectedDisplays();for(let i=0;i<t.length;i++){const n=t[i];n.isAccessible()&&n.descriptionUtteranceQueue.addToBack(e)}}forEachUtteranceQueue(e){const t=this.getConnectedDisplays();assert&&assert(t.length>0,"must be connected to a display to use UtteranceQueue features");for(let i=0;i<t.length;i++){const n=t[i];n.isAccessible()&&e(n.descriptionUtteranceQueue)}}getBaseOptions(){const e={};for(let t=0;t<Ec.length;t++){const i=Ec[t];e[i]=this[i]}return e}getNestedPDOMOrder(){const e=new ht(this);let t=[];const i=[],n=[i];function r(h,p){let S=0;if(_.each(t,U=>{h===U&&S++}),S>1||S===1&&!p)return;if(h.hasPDOMContent){const U={trail:e.copy(),children:[]};n[n.length-1].push(U),n.push(U.children)}const C=h._pdomOrder===null?[]:h._pdomOrder;t=t.concat(C),_.each(C,U=>{_.each(h.getLeafTrailsTo(U),k=>{k.removeAncestor(),e.addDescendantTrail(k),r(U,!0),e.removeDescendantTrail(k)})});const B=h._children.length;for(let U=0;U<B;U++){const k=h._children[U];e.addDescendant(k,U),r(k,!1),e.removeDescendant()}_.each(C,()=>{t.pop()}),h.hasPDOMContent&&n.pop()}return r(this,!1),i}onPDOMContentChange(){Rs.pdomContentChange(this),this.pdomHeading&&this.computeHeadingLevel(),this.rendererSummaryRefreshEmitter.emit()}get hasPDOMContent(){return!!this._tagName}onPDOMAddChild(e){sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.ParallelDOM(`onPDOMAddChild n#${e.id} (parent:n#${this.id})`),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.push(),assert&&function(i){i._rendererSummary.hasNoPDOM()||i.pdomOrder&&assert(i.getTrails(n=>_.includes(i.pdomOrder,n)).length===0,"pdomOrder should not include any ancestors or the node itself")}(e),assert&&Rs.auditNodeForPDOMCycles(this),this._pdomDisplaysInfo.onAddChild(e),Rs.addChild(this,e),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.pop()}onPDOMRemoveChild(e){sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.ParallelDOM(`onPDOMRemoveChild n#${e.id} (parent:n#${this.id})`),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.push(),this._pdomDisplaysInfo.onRemoveChild(e),Rs.removeChild(this,e),e.updateOtherNodesAriaLabelledby(),e.updateOtherNodesAriaDescribedby(),e.updateOtherNodesActiveDescendant(),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.pop()}onPDOMReorderedChildren(){sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.ParallelDOM(`onPDOMReorderedChildren (parent:n#${this.id})`),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.push(),Rs.childrenOrderChange(this),sceneryLog&&sceneryLog.ParallelDOM&&sceneryLog.pop()}updateLinkedElementForProperty(e,t,i){if(assert&&assert(t!==i,"should not be called on same values"),this.isPhetioInstrumented()){t&&t instanceof Is&&t.isPhetioInstrumented()&&t instanceof yi&&this.removeLinkedElements(t);const n=this.tandem.createTandem(e);i&&i instanceof Is&&i.isPhetioInstrumented()&&i instanceof yi&&n!==i.tandem&&this.addLinkedElement(i,{tandemName:e})}}getPDOMInstances(){return this._pdomInstances}get pdomInstances(){return this.getPDOMInstances()}addPDOMInstance(e){this._pdomInstances.push(e)}removePDOMInstance(e){const t=_.indexOf(this._pdomInstances,e);assert&&assert(t!==-1,"Cannot remove a PDOMInstance from a Node if it was not there"),this._pdomInstances.splice(t,1)}static BASIC_ACCESSIBLE_NAME_BEHAVIOR(e,t,i){return e.tagName==="input"?(t.labelTagName="label",t.labelContent=i):dt.tagNameSupportsContent(e.tagName)?t.innerContent=i:t.ariaLabel=i,t}static HELP_TEXT_BEFORE_CONTENT(e,t,i){return t.descriptionTagName=dt.DEFAULT_DESCRIPTION_TAG_NAME,t.descriptionContent=i,t.appendDescription=!1,t}static HELP_TEXT_AFTER_CONTENT(e,t,i){return t.descriptionTagName=dt.DEFAULT_DESCRIPTION_TAG_NAME,t.descriptionContent=i,t.appendDescription=!0,t}}q.register("ParallelDOM",To);const Ah="enabledProperty";class Do extends Wt{constructor(e,t){const i=je()({phetioDocumentation:"Determines whether the element is enabled (true) or disabled (false).",phetioFeatured:!0,checkTandemName:!0},t);assert&&i&&i.tandem&&i.tandem.supplied&&i.checkTandemName&&assert&&assert(i.tandem.name===Ah,`EnabledProperty tandems should be named ${Ah}`),super(e,i)}static get TANDEM_NAME(){return Ah}}hs.register("EnabledProperty",Do);class Qa extends vt{constructor(e,t){super(e),this.onAccessAttempt=t}get(){return this.onAccessAttempt(),super.get()}set(e){throw new Error("Cannot set a TinyStaticProperty value")}isSettable(){return!1}notifyListeners(e){this.emit(this.get(),e,this)}link(e){this.addListener(e),e(this.get(),null,this)}equalsValue(e){return this.areValuesEqual(e,this.get())}}hs.register("TinyStaticProperty",Qa);let Ob=1;const Na=Be.NOTHING.copy(),Mb=Be.NOTHING.copy(),Oh=new $e,Mh=Do.TANDEM_NAME,Nh="visibleProperty",Rh="inputEnabledProperty",df=!1;let Ra=0,Ba=0;const kn=["leftTop","centerTop","rightTop","leftCenter","center","rightCenter","leftBottom","centerBottom","rightBottom","left","right","top","bottom","centerX","centerY"],Nb=["children","cursor","phetioVisiblePropertyInstrumented","visibleProperty","visible","pickableProperty","pickable","phetioEnabledPropertyInstrumented","enabledProperty","enabled","phetioInputEnabledPropertyInstrumented","inputEnabledProperty","inputEnabled","inputListeners","opacity","disabledOpacity","filters","matrix","translation","x","y","rotation","scale","excludeInvisibleChildrenFromBounds","layoutOptions","localBounds","maxWidth","maxHeight","renderer","layerSplit","usesOpacity","cssTransform","excludeInvisible","webglScale","preventFit","mouseArea","touchArea","clipArea","transformBounds",...kn],gi={phetioVisiblePropertyInstrumented:!0,visible:!0,opacity:1,disabledOpacity:1,pickable:null,enabled:!0,phetioEnabledPropertyInstrumented:!1,inputEnabled:!0,phetioInputEnabledPropertyInstrumented:!1,clipArea:null,mouseArea:null,touchArea:null,cursor:null,transformBounds:!1,maxWidth:null,maxHeight:null,renderer:null,usesOpacity:!1,layerSplit:!1,cssTransform:!1,excludeInvisible:!1,webglScale:null,preventFit:!1},Rb=gi.renderer===null?0:ne.fromName(gi.renderer);var ji;let Or=(ji=class extends To{constructor(e){super(),this.childrenChangedEmitter=new zt,this.childInsertedEmitter=new zt,this.childRemovedEmitter=new zt,this.childrenReorderedEmitter=new zt,this.parentAddedEmitter=new zt,this.parentRemovedEmitter=new zt,this.transformEmitter=new zt,this.instanceRefreshEmitter=new zt,this.rendererSummaryRefreshEmitter=new zt,this.filterChangeEmitter=new zt,this.changedInstanceEmitter=new zt,this.rootedDisplayChangedEmitter=new zt,this.layoutOptionsChangedEmitter=new zt,this._activeParentLayoutConstraint=null,this._id=Ob++,this._instances=[],this._rootedDisplays=[],this._drawables=[],this._visibleProperty=new dn(gi.visible,gi.phetioVisiblePropertyInstrumented,this.onVisiblePropertyChange.bind(this)),this.opacityProperty=new vt(gi.opacity,this.onOpacityPropertyChange.bind(this)),this.disabledOpacityProperty=new vt(gi.disabledOpacity,this.onDisabledOpacityPropertyChange.bind(this)),this._pickableProperty=new dn(gi.pickable,!1,this.onPickablePropertyChange.bind(this)),this._enabledProperty=new dn(gi.enabled,gi.phetioEnabledPropertyInstrumented,this.onEnabledPropertyChange.bind(this)),this._inputEnabledProperty=new dn(gi.inputEnabled,gi.phetioInputEnabledPropertyInstrumented),this.clipAreaProperty=new vt(gi.clipArea),this.voicingVisibleProperty=new vt(!0),this._mouseArea=gi.mouseArea,this._touchArea=gi.touchArea,this._cursor=gi.cursor,this._children=[],this._parents=[],this._transformBounds=gi.transformBounds,this._transform=new Fs,this._transformListener=this.onTransformChange.bind(this),this._transform.changeEmitter.addListener(this._transformListener),this._maxWidth=gi.maxWidth,this._maxHeight=gi.maxHeight,this._appliedScaleFactor=1,this._inputListeners=[],this._renderer=Rb,this._usesOpacity=gi.usesOpacity,this._layerSplit=gi.layerSplit,this._cssTransform=gi.cssTransform,this._excludeInvisible=gi.excludeInvisible,this._webglScale=gi.webglScale,this._preventFit=gi.preventFit,this.inputEnabledProperty.lazyLink(this.pdomBoundInputEnabledListener);const t=this.onBoundsListenersAddedOrRemoved.bind(this),i=this.validateBounds.bind(this),n=this.validateSelfBounds.bind(this);this.boundsProperty=new Qa(Be.NOTHING.copy(),i),this.boundsProperty.changeCount=t,this.localBoundsProperty=new Qa(Be.NOTHING.copy(),i),this.localBoundsProperty.changeCount=t,this.childBoundsProperty=new Qa(Be.NOTHING.copy(),i),this.childBoundsProperty.changeCount=t,this.selfBoundsProperty=new Qa(Be.NOTHING.copy(),n),this._localBoundsOverridden=!1,this._excludeInvisibleChildrenFromBounds=!1,this._layoutOptions=null,this._boundsDirty=!0,this._localBoundsDirty=!0,this._selfBoundsDirty=!0,this._childBoundsDirty=!0,assert&&(this._originalBounds=this.boundsProperty._value,this._originalLocalBounds=this.localBoundsProperty._value,this._originalSelfBounds=this.selfBoundsProperty._value,this._originalChildBounds=this.childBoundsProperty._value),this._filters=[],this._rendererBitmask=ne.bitmaskNodeDefault,this._rendererSummary=new Bh(this),this._boundsEventCount=0,this._boundsEventSelfCount=0,this._picker=new pf(this),this._isGettingRemovedFromParent=!1,e&&this.mutate(e)}insertChild(e,t,i){var n,r,h,p;if(assert&&assert(t!=null,"insertChild cannot insert a null/undefined child"),assert&&assert(!_.includes(this._children,t),"Parent already contains child"),assert&&assert(t!==this,"Cannot add self as a child"),assert&&assert(t._parents!==null,"Tried to insert a disposed child node?"),assert&&assert(!t.isDisposed,"Tried to insert a disposed Node"),this._picker.onInsertChild(t),this.changeBoundsEventCount(t._boundsEventCount>0?1:0),this._rendererSummary.summaryChange(Bh.bitmaskAll,t._rendererSummary.bitmask),t._parents.push(this),assert&&((r=(n=self.phet)==null?void 0:n.chipper)!=null&&r.queryParameters)&&isFinite(phet.chipper.queryParameters.parentLimit)){const S=t._parents.length;Ra<S&&(Ra=S,console.log(`Max Node parents: ${Ra}`),assert(Ra<=phet.chipper.queryParameters.parentLimit,`parent count of ${Ra} above ?parentLimit=${phet.chipper.queryParameters.parentLimit}`))}if(this._children.splice(e,0,t),assert&&((p=(h=self.phet)==null?void 0:h.chipper)!=null&&p.queryParameters)&&isFinite(phet.chipper.queryParameters.childLimit)){const S=this._children.length;Ba<S&&(Ba=S,console.log(`Max Node children: ${Ba}`),assert(Ba<=phet.chipper.queryParameters.childLimit,`child count of ${Ba} above ?childLimit=${phet.chipper.queryParameters.childLimit}`))}return t._rendererSummary.hasNoPDOM()||this.onPDOMAddChild(t),t.invalidateBounds(),this._boundsDirty=!0,this.childInsertedEmitter.emit(t,e),t.parentAddedEmitter.emit(this),!i&&this.childrenChangedEmitter.emit(),assertSlow&&this._picker.audit(),this}addChild(e,t){return this.insertChild(this._children.length,e,t),this}removeChild(e,t){assert&&assert(e&&e instanceof ji,"Need to call node.removeChild() with a Node."),assert&&assert(this.hasChild(e),"Attempted to removeChild with a node that was not a child.");const i=_.indexOf(this._children,e);return this.removeChildWithIndex(e,i,t),this}removeChildAt(e,t){assert&&assert(e>=0),assert&&assert(e<this._children.length);const i=this._children[e];return this.removeChildWithIndex(i,e,t),this}removeChildWithIndex(e,t,i){assert&&assert(e&&e instanceof ji,"Need to call node.removeChildWithIndex() with a Node."),assert&&assert(this.hasChild(e),"Attempted to removeChild with a node that was not a child."),assert&&assert(this._children[t]===e,"Incorrect index for removeChildWithIndex"),assert&&assert(e._parents!==null,"Tried to remove a disposed child node?");const n=_.indexOf(e._parents,this);e._isGettingRemovedFromParent=!0,e._rendererSummary.hasNoPDOM()||this.onPDOMRemoveChild(e),this._picker.onRemoveChild(e),this.changeBoundsEventCount(e._boundsEventCount>0?-1:0),this._rendererSummary.summaryChange(e._rendererSummary.bitmask,Bh.bitmaskAll),e._parents.splice(n,1),this._children.splice(t,1),e._isGettingRemovedFromParent=!1,this.invalidateBounds(),this._childBoundsDirty=!0,this.childRemovedEmitter.emit(e,t),e.parentRemovedEmitter.emit(this),!i&&this.childrenChangedEmitter.emit(),assertSlow&&this._picker.audit()}moveChildToIndex(e,t){assert&&assert(this.hasChild(e),"Attempted to moveChildToIndex with a node that was not a child."),assert&&assert(t%1===0&&t>=0&&t<this._children.length,`Invalid index: ${t}`);const i=this.indexOfChild(e);return this._children[t]!==e&&(this._children.splice(i,1),this._children.splice(t,0,e),this._rendererSummary.hasNoPDOM()||this.onPDOMReorderedChildren(),this.childrenReorderedEmitter.emit(Math.min(i,t),Math.max(i,t)),this.childrenChangedEmitter.emit()),this}removeAllChildren(){return this.setChildren([]),this}setChildren(e){const t=[],i=[],n=[];let r;for(xr(e,this._children,i,t,n),r=t.length-1;r>=0;r--)this.removeChild(t[r],!0);assert&&assert(this._children.length===n.length,"Removing children should not have triggered other children changes");let h=-1,p=-1;for(r=0;r<n.length;r++){const C=n[r];this._children[r]!==C&&(this._children[r]=C,h===-1&&(h=r),p=r)}const S=h!==-1;if(S&&(this._rendererSummary.hasNoPDOM()||this.onPDOMReorderedChildren(),this.childrenReorderedEmitter.emit(h,p)),i.length){let C=0,B=i[C];for(r=0;r<e.length;r++)e[r]===B&&(this.insertChild(r,B,!0),B=i[++C])}if((t.length!==0||i.length!==0||S)&&this.childrenChangedEmitter.emit(),assert)for(let C=0;C<this._children.length;C++)assert(e[C]===this._children[C],"Incorrect child after setChildren, possibly a reentrancy issue");return this}set children(e){this.setChildren(e)}get children(){return this.getChildren()}getChildren(){return this._children.slice(0)}getChildrenCount(){return this._children.length}getParents(){return this._parents.slice(0)}get parents(){return this.getParents()}getParent(){return assert&&assert(this._parents.length<=1,"Cannot call getParent on a node with multiple parents"),this._parents.length?this._parents[0]:null}get parent(){return this.getParent()}getChildAt(e){return this._children[e]}indexOfParent(e){return _.indexOf(this._parents,e)}indexOfChild(e){return _.indexOf(this._children,e)}moveToFront(){return _.each(this.parents,e=>e.moveChildToFront(this)),this}moveChildToFront(e){return this.moveChildToIndex(e,this._children.length-1)}moveForward(){return this.parents.forEach(e=>e.moveChildForward(this)),this}moveChildForward(e){const t=this.indexOfChild(e);return t<this.getChildrenCount()-1&&this.moveChildToIndex(e,t+1),this}moveBackward(){return this.parents.forEach(e=>e.moveChildBackward(this)),this}moveChildBackward(e){const t=this.indexOfChild(e);return t>0&&this.moveChildToIndex(e,t-1),this}moveToBack(){return _.each(this.parents,e=>e.moveChildToBack(this)),this}moveChildToBack(e){return this.moveChildToIndex(e,0)}replaceChild(e,t){assert&&assert(this.hasChild(e),"Attempted to replace a node that was not a child.");const i=this.indexOfChild(e),n=e.focused;return this.removeChild(e,!0),this.insertChild(i,t,!0),this.childrenChangedEmitter.emit(),n&&t.focusable&&t.focus(),this}detach(){return _.each(this._parents.slice(0),e=>e.removeChild(this)),this}changeBoundsEventCount(e){if(e!==0){const t=this._boundsEventCount===0;this._boundsEventCount+=e,assert&&assert(this._boundsEventCount>=0,"subtree bounds event count should be guaranteed to be >= 0");const i=this._boundsEventCount===0;if(t!==i){const n=t?1:-1,r=this._parents.length;for(let h=0;h<r;h++)this._parents[h].changeBoundsEventCount(n)}}}validateSelfBounds(){if(this._selfBoundsDirty){const e=Na.set(this.selfBoundsProperty._value),t=this.updateSelfBounds();return this._selfBoundsDirty=!1,t&&this.selfBoundsProperty.notifyListeners(e),!0}return!1}validateBounds(){sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds(`validateBounds #${this._id}`),sceneryLog&&sceneryLog.bounds&&sceneryLog.push();let e;const t=1e-13;let i=this.validateSelfBounds();const n=this.childBoundsProperty._value,r=this.localBoundsProperty._value,h=this.selfBoundsProperty._value,p=this.boundsProperty._value;if(this._childBoundsDirty){for(i=!0,sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds("childBounds dirty"),e=this._children.length;e--;){const C=this._children[e];C&&C.validateBounds()}const S=Na.set(n);for(n.set(Be.NOTHING),e=this._children.length;e--;){const C=this._children[e];(C&&!this._excludeInvisibleChildrenFromBounds||C.isVisible())&&n.includeBounds(C.bounds)}this._childBoundsDirty=!1,sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds(`childBounds: ${n}`),n.equals(S)||n.equalsEpsilon(S,t)||this.childBoundsProperty.notifyListeners(S)}if(this._localBoundsDirty){i=!0,sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds("localBounds dirty"),this._localBoundsDirty=!1;const S=Na.set(r);if(!this._localBoundsOverridden){r.set(h).includeBounds(n);const C=this.clipArea;C&&r.constrainBounds(C.bounds)}sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds(`localBounds: ${r}`),(this._maxWidth!==null||this._maxHeight!==null)&&this.updateMaxDimension(r),r.equals(S)||(this._boundsDirty=!0,r.equalsEpsilon(S,t)||this.localBoundsProperty.notifyListeners(S))}if(this._boundsDirty){i=!0,sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds("bounds dirty"),this._boundsDirty=!1;const S=Na.set(p);if(this._transformBounds&&!this._transform.getMatrix().isAxisAligned()){const C=Oh.set(this.getMatrix());p.set(Be.NOTHING),this._includeTransformedSubtreeBounds(C,p);const B=this.clipArea;B&&p.constrainBounds(B.getBoundsWithTransform(C))}else p.set(r),this.transformBoundsFromLocalToParent(p);if(sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds(`bounds: ${p}`),!p.equals(S)){for(e=this._parents.length;e--;)this._parents[e].invalidateBounds();p.equalsEpsilon(S,t)||this.boundsProperty.notifyListeners(S)}}return(this._childBoundsDirty||this._boundsDirty)&&(sceneryLog&&sceneryLog.bounds&&sceneryLog.bounds("revalidation"),this.validateBounds()),assert&&(assert(this._originalBounds===this.boundsProperty._value,"Reference for bounds changed!"),assert(this._originalLocalBounds===this.localBoundsProperty._value,"Reference for localBounds changed!"),assert(this._originalSelfBounds===this.selfBoundsProperty._value,"Reference for selfBounds changed!"),assert(this._originalChildBounds===this.childBoundsProperty._value,"Reference for childBounds changed!")),assertSlow&&(()=>{const C=Be.NOTHING.copy();_.each(this._children,Q=>{(!this._excludeInvisibleChildrenFromBounds||Q.isVisible())&&C.includeBounds(Q.boundsProperty._value)});let B=this.selfBoundsProperty._value.union(C);const U=this.clipArea;U&&(B=B.intersection(U.bounds));const k=this.localToParentBounds(B);assertSlow&&assertSlow(this.childBoundsProperty._value.equalsEpsilon(C,1e-6),`Child bounds mismatch after validateBounds: ${this.childBoundsProperty._value.toString()}, expected: ${C.toString()}`),assertSlow&&assertSlow(this._localBoundsOverridden||this._transformBounds||this.boundsProperty._value.equalsEpsilon(k,1e-6),`Bounds mismatch after validateBounds: ${this.boundsProperty._value.toString()}, expected: ${k.toString()}. This could have happened if a bounds instance owned by a Node was directly mutated (e.g. bounds.erode())`)})(),sceneryLog&&sceneryLog.bounds&&sceneryLog.pop(),i}_includeTransformedSubtreeBounds(e,t){this.selfBounds.isEmpty()||t.includeBounds(this.getTransformedSelfBounds(e));const i=this._children.length;for(let n=0;n<i;n++){const r=this._children[n];e.multiplyMatrix(r._transform.getMatrix()),r._includeTransformedSubtreeBounds(e,t),e.multiplyMatrix(r._transform.getInverse())}return t}validateWatchedBounds(){for(;this.watchedBoundsScan(););}watchedBoundsScan(){if(this._boundsEventSelfCount!==0)return this.validateBounds();if(this._boundsEventCount>0&&this._childBoundsDirty){let e=!1;const t=this._children.length;for(let i=0;i<t;i++)e=this._children[i].watchedBoundsScan()||e;return e}else return!1}invalidateBounds(){this._boundsDirty=!0,this._localBoundsDirty=!0;let e=this._parents.length;for(;e--;)this._parents[e].invalidateChildBounds()}invalidateChildBounds(){if(!this._childBoundsDirty){this._childBoundsDirty=!0,this._localBoundsDirty=!0;let e=this._parents.length;for(;e--;)this._parents[e].invalidateChildBounds()}}invalidateSelf(e){assert&&assert(e===void 0||e instanceof Be,"invalidateSelf's newSelfBounds, if provided, needs to be Bounds2");const t=this.selfBoundsProperty._value;if(!e)this._selfBoundsDirty=!0,this.invalidateBounds(),this._picker.onSelfBoundsDirty();else if(assert&&assert(e.isEmpty()||e.isFinite(),"Bounds must be empty or finite in invalidateSelf"),this._selfBoundsDirty=!1,!t.equals(e)){const i=Na.set(t);this.invalidateBounds(),this._picker.onSelfBoundsDirty(),t.set(e),this.selfBoundsProperty.notifyListeners(i)}assertSlow&&this._picker.audit()}updateSelfBounds(){return assert&&assert(this.selfBoundsProperty._value.equals(Be.NOTHING)),!1}hasChild(e){assert&&assert(e&&e instanceof ji,"hasChild needs to be called with a Node");const t=_.includes(this._children,e);return assert&&assert(t===_.includes(e._parents,this),"child-parent reference should match parent-child reference"),t}getSelfShape(){return this.selfBounds.isEmpty()?new yt:yt.bounds(this.selfBounds)}getSelfBounds(){return this.selfBoundsProperty.value}get selfBounds(){return this.getSelfBounds()}getSafeSelfBounds(){return this.selfBoundsProperty.value}get safeSelfBounds(){return this.getSafeSelfBounds()}getChildBounds(){return this.childBoundsProperty.value}get childBounds(){return this.getChildBounds()}getLocalBounds(){return this.localBoundsProperty.value}get localBounds(){return this.getLocalBounds()}set localBounds(e){this.setLocalBounds(e)}get localBoundsOverridden(){return this._localBoundsOverridden}setLocalBounds(e){assert&&assert(e===null||e instanceof Be,"localBounds override should be set to either null or a Bounds2"),assert&&assert(e===null||!isNaN(e.minX),"minX for localBounds should not be NaN"),assert&&assert(e===null||!isNaN(e.minY),"minY for localBounds should not be NaN"),assert&&assert(e===null||!isNaN(e.maxX),"maxX for localBounds should not be NaN"),assert&&assert(e===null||!isNaN(e.maxY),"maxY for localBounds should not be NaN");const t=this.localBoundsProperty._value,i=t.copy();if(e===null)this._localBoundsOverridden&&(this._localBoundsOverridden=!1,this.localBoundsProperty.notifyListeners(i),this.invalidateBounds());else{const n=!e.equals(t)||!this._localBoundsOverridden;n&&t.set(e),this._localBoundsOverridden||(this._localBoundsOverridden=!0),n&&(this.localBoundsProperty.notifyListeners(i),this.invalidateBounds())}return this}getTransformedSelfBounds(e){return this.selfBounds.transformed(e)}getTransformedSafeSelfBounds(e){return this.safeSelfBounds.transformed(e)}getSafeTransformedVisibleBounds(e){const t=(e||$e.IDENTITY).timesMatrix(this.matrix),i=Be.NOTHING.copy();if(this.visibleProperty.value&&(this.selfBounds.isEmpty()||i.includeBounds(this.getTransformedSafeSelfBounds(t)),this._children.length))for(let n=0;n<this._children.length;n++)i.includeBounds(this._children[n].getSafeTransformedVisibleBounds(t));return i}get safeTransformedVisibleBounds(){return this.getSafeTransformedVisibleBounds()}setTransformBounds(e){return this._transformBounds!==e&&(this._transformBounds=e,this.invalidateBounds()),this}set transformBounds(e){this.setTransformBounds(e)}get transformBounds(){return this.getTransformBounds()}getTransformBounds(){return this._transformBounds}getBounds(){return this.boundsProperty.value}get bounds(){return this.getBounds()}getVisibleLocalBounds(){const e=this.selfBounds.copy();let t=this._children.length;for(;t--;)e.includeBounds(this._children[t].getVisibleBounds());const i=this.clipArea;return i&&e.constrainBounds(i.bounds),assert&&assert(e.isFinite()||e.isEmpty(),"Visible bounds should not be infinite"),e}get visibleLocalBounds(){return this.getVisibleLocalBounds()}getVisibleBounds(){return this.isVisible()?this.getVisibleLocalBounds().transform(this.getMatrix()):Be.NOTHING}get visibleBounds(){return this.getVisibleBounds()}hitTest(e,t,i){return assert&&assert(e.isFinite(),"The point should be a finite Vector2"),assert&&assert(t===void 0||typeof t=="boolean","If isMouse is provided, it should be a boolean"),assert&&assert(i===void 0||typeof i=="boolean","If isTouch is provided, it should be a boolean"),this._picker.hitTest(e,!!t,!!i)}trailUnderPointer(e){return e.point===null?null:this.hitTest(e.point,e instanceof bs,e.isTouchLike())}containsPoint(e){return this.hitTest(e)!==null}containsPointSelf(e){return this.selfBounds.containsPoint(e)}intersectsBoundsSelf(e){return this.selfBounds.intersectsBounds(e)}isPhetioMouseHittable(e){return this.pickable===!1&&!this.isAnyDescendantAPhetioMouseHitTarget()?!1:this.visible&&(this.clipArea===null||this.clipArea.containsPoint(this._transform.getInverse().timesVector2(e)))}isAnyDescendantAPhetioMouseHitTarget(){return this.getPhetioMouseHitTarget()!=="phetioNotSelectable"||_.some(this.children,e=>e.isAnyDescendantAPhetioMouseHitTarget())}getPhetioMouseHit(e){if(!this.isPhetioMouseHittable(e))return null;const t=this._transform.getInverse().timesVector2(e);let i=null;for(let n=this._children.length-1;n>=0;n--){const r=this._children[n].getPhetioMouseHit(t);if(r instanceof yi)return r;r==="phetioNotSelectable"&&(i=!0)}return i?this.getPhetioMouseHitTarget():this._mouseArea?this._mouseArea.containsPoint(t)?this.getPhetioMouseHitTarget():null:this.selfBounds.containsPoint(t)&&this.containsPointSelf(t)?this.getPhetioMouseHitTarget():null}isPainted(){return!1}areSelfBoundsValid(){return!0}hasParent(){return this._parents.length!==0}hasChildren(){return this._children.length>0}isChildIncludedInLayout(e){return e.bounds.isValid()&&(!this._excludeInvisibleChildrenFromBounds||e.visible)}walkDepthFirst(e){e(this);const t=this._children.length;for(let i=0;i<t;i++)this._children[i].walkDepthFirst(e)}addInputListener(e){return assert&&assert(!_.includes(this._inputListeners,e),"Input listener already registered on this Node"),assert&&assert(e!==null,"Input listener cannot be null"),assert&&assert(e!==void 0,"Input listener cannot be undefined"),_.includes(this._inputListeners,e)||(this._inputListeners.push(e),this._picker.onAddInputListener(),assertSlow&&this._picker.audit(),e.hotkeys&&Bc.updateHotkeysFromInputListenerChange(this)),this}removeInputListener(e){const t=_.indexOf(this._inputListeners,e);return assert&&assert(this.isDisposed||t>=0,"Could not find input listener to remove"),t>=0&&(this._inputListeners.splice(t,1),this._picker.onRemoveInputListener(),assertSlow&&this._picker.audit(),e.hotkeys&&Bc.updateHotkeysFromInputListenerChange(this)),this}hasInputListener(e){for(let t=0;t<this._inputListeners.length;t++)if(this._inputListeners[t]===e)return!0;return!1}interruptInput(){const e=this.inputListeners;for(let t=0;t<e.length;t++){const i=e[t];i.interrupt&&i.interrupt()}return this}interruptSubtreeInput(){this.interruptInput();const e=this._children.slice();for(let t=0;t<e.length;t++)e[t].interruptSubtreeInput();return this}translate(e,t,i){if(typeof e=="number"){if(assert&&assert(isFinite(e),"x should be a finite number"),assert&&assert(typeof t=="number"&&isFinite(t),"y should be a finite number"),Math.abs(e)<1e-12&&Math.abs(t)<1e-12)return;i?this.prependTranslation(e,t):this.appendMatrix(Oh.setToTranslation(e,t))}else{const n=e;if(assert&&assert(n.isFinite(),"translation should be a finite Vector2 if not finite numbers"),!n.x&&!n.y)return;this.translate(n.x,n.y,t)}}scale(e,t,i){if(typeof e=="number")if(assert&&assert(isFinite(e),"scales should be finite"),t===void 0||typeof t=="boolean")this.scale(e,e,t);else{if(assert&&assert(isFinite(t),"scales should be finite numbers"),assert&&assert(i===void 0||typeof i=="boolean","If provided, prependInstead should be boolean"),e===1&&t===1)return;i?this.prependMatrix($e.scaling(e,t)):this.appendMatrix($e.scaling(e,t))}else{const n=e;assert&&assert(n.isFinite(),"scale should be a finite Vector2 if not a finite number"),this.scale(n.x,n.y,t)}}rotate(e,t){assert&&assert(isFinite(e),"angle should be a finite number"),assert&&assert(t===void 0||typeof t=="boolean"),e%(2*Math.PI)!==0&&(t?this.prependMatrix($e.rotation2(e)):this.appendMatrix($e.rotation2(e)))}rotateAround(e,t){assert&&assert(e.isFinite(),"point should be a finite Vector2"),assert&&assert(isFinite(t),"angle should be a finite number");let i=$e.translation(-e.x,-e.y);return i=$e.rotation2(t).timesMatrix(i),i=$e.translation(e.x,e.y).timesMatrix(i),this.prependMatrix(i),this}setX(e){return assert&&assert(isFinite(e),"x should be a finite number"),this.translate(e-this.getX(),0,!0),this}set x(e){this.setX(e)}get x(){return this.getX()}getX(){return this._transform.getMatrix().m02()}setY(e){return assert&&assert(isFinite(e),"y should be a finite number"),this.translate(0,e-this.getY(),!0),this}set y(e){this.setY(e)}get y(){return this.getY()}getY(){return this._transform.getMatrix().m12()}setScaleMagnitude(e,t){const i=this.getScaleVector();return typeof e=="number"?(t===void 0&&(t=e),assert&&assert(isFinite(e),"setScaleMagnitude parameters should be finite numbers"),assert&&assert(isFinite(t),"setScaleMagnitude parameters should be finite numbers"),this.appendMatrix($e.scaling(e/i.x,t/i.y))):(assert&&assert(e.isFinite(),"first parameter should be a finite Vector2"),this.appendMatrix($e.scaling(e.x/i.x,e.y/i.y))),this}getScaleVector(){return this._transform.getMatrix().getScaleVector()}setRotation(e){return assert&&assert(isFinite(e),"rotation should be a finite number"),this.appendMatrix(Oh.setToRotationZ(e-this.getRotation())),this}set rotation(e){this.setRotation(e)}get rotation(){return this.getRotation()}getRotation(){return this._transform.getMatrix().getRotation()}setTranslation(e,t){const i=this._transform.getMatrix(),n=i.m02(),r=i.m12();let h,p;return typeof e=="number"?(assert&&assert(isFinite(e),"Parameters to setTranslation should be finite numbers"),assert&&assert(t!==void 0&&isFinite(t),"Parameters to setTranslation should be finite numbers"),h=e-n,p=t-r):(assert&&assert(e.isFinite(),"Should be a finite Vector2"),h=e.x-n,p=e.y-r),this.translate(h,p,!0),this}set translation(e){this.setTranslation(e)}get translation(){return this.getTranslation()}getTranslation(){const e=this._transform.getMatrix();return new We(e.m02(),e.m12())}appendMatrix(e){assert&&assert(e.isFinite(),"matrix should be a finite Matrix3"),assert&&assert(e.getDeterminant()!==0,"matrix should not map plane to a line or point"),this._transform.append(e)}prependMatrix(e){assert&&assert(e.isFinite(),"matrix should be a finite Matrix3"),assert&&assert(e.getDeterminant()!==0,"matrix should not map plane to a line or point"),this._transform.prepend(e)}prependTranslation(e,t){assert&&assert(isFinite(e),"x should be a finite number"),assert&&assert(isFinite(t),"y should be a finite number"),!(!e&&!t)&&this._transform.prependTranslation(e,t)}setMatrix(e){assert&&assert(e.isFinite(),"matrix should be a finite Matrix3"),assert&&assert(e.getDeterminant()!==0,"matrix should not map plane to a line or point"),this._transform.setMatrix(e)}set matrix(e){this.setMatrix(e)}get matrix(){return this.getMatrix()}getMatrix(){return this._transform.getMatrix()}getTransform(){return this._transform}get transform(){return this.getTransform()}resetTransform(){this.setMatrix($e.IDENTITY)}onTransformChange(){this.invalidateBounds(),this._picker.onTransformChange(),assertSlow&&this._picker.audit(),this.transformEmitter.emit()}onSummaryChange(e,t){this._pdomDisplaysInfo.onSummaryChange(e,t)}updateMaxDimension(e){assert&&this.auditMaxDimensions();const t=this._appliedScaleFactor;let i=1;if(this._maxWidth!==null){const r=e.width;r>this._maxWidth&&(i=Math.min(i,this._maxWidth/r))}if(this._maxHeight!==null){const r=e.height;r>this._maxHeight&&(i=Math.min(i,this._maxHeight/r))}const n=i/t;n!==1&&(this._appliedScaleFactor=i,this.scale(n))}auditMaxDimensions(){assert&&assert(this._maxWidth===null||!aa(this)||this.preferredWidth===null||this._maxWidth>=this.preferredWidth-1e-7,"If maxWidth and preferredWidth are both non-null, maxWidth should NOT be smaller than the preferredWidth. If that happens, it would trigger an infinite loop"),assert&&assert(this._maxHeight===null||!oa(this)||this.preferredHeight===null||this._maxHeight>=this.preferredHeight-1e-7,"If maxHeight and preferredHeight are both non-null, maxHeight should NOT be smaller than the preferredHeight. If that happens, it would trigger an infinite loop")}onMaxDimensionChange(e,t){e===null&&t!==null?(this.changeBoundsEventCount(1),this._boundsEventSelfCount++):e!==null&&t===null&&(this.changeBoundsEventCount(-1),this._boundsEventSelfCount--)}setMaxWidth(e){assert&&assert(e===null||typeof e=="number"&&e>0,"maxWidth should be null (no constraint) or a positive number"),this._maxWidth!==e&&(this.onMaxDimensionChange(this._maxWidth,e),this._maxWidth=e,this.updateMaxDimension(this.localBoundsProperty.value))}set maxWidth(e){this.setMaxWidth(e)}get maxWidth(){return this.getMaxWidth()}getMaxWidth(){return this._maxWidth}setMaxHeight(e){assert&&assert(e===null||typeof e=="number"&&e>0,"maxHeight should be null (no constraint) or a positive number"),this._maxHeight!==e&&(this.onMaxDimensionChange(this._maxHeight,e),this._maxHeight=e,this.updateMaxDimension(this.localBoundsProperty.value))}set maxHeight(e){this.setMaxHeight(e)}get maxHeight(){return this.getMaxHeight()}getMaxHeight(){return this._maxHeight}setLeft(e){const t=this.getLeft();return isFinite(t)&&this.translate(e-t,0,!0),this}set left(e){this.setLeft(e)}get left(){return this.getLeft()}getLeft(){return this.getBounds().minX}setRight(e){const t=this.getRight();return isFinite(t)&&this.translate(e-t,0,!0),this}set right(e){this.setRight(e)}get right(){return this.getRight()}getRight(){return this.getBounds().maxX}setCenterX(e){const t=this.getCenterX();return isFinite(t)&&this.translate(e-t,0,!0),this}set centerX(e){this.setCenterX(e)}get centerX(){return this.getCenterX()}getCenterX(){return this.getBounds().getCenterX()}setCenterY(e){const t=this.getCenterY();return isFinite(t)&&this.translate(0,e-t,!0),this}set centerY(e){this.setCenterY(e)}get centerY(){return this.getCenterY()}getCenterY(){return this.getBounds().getCenterY()}setTop(e){const t=this.getTop();return isFinite(t)&&this.translate(0,e-t,!0),this}set top(e){this.setTop(e)}get top(){return this.getTop()}getTop(){return this.getBounds().minY}setBottom(e){const t=this.getBottom();return isFinite(t)&&this.translate(0,e-t,!0),this}set bottom(e){this.setBottom(e)}get bottom(){return this.getBottom()}getBottom(){return this.getBounds().maxY}setLeftTop(e){assert&&assert(e.isFinite(),"leftTop should be a finite Vector2");const t=this.getLeftTop();return t.isFinite()&&this.translate(e.minus(t),!0),this}set leftTop(e){this.setLeftTop(e)}get leftTop(){return this.getLeftTop()}getLeftTop(){return this.getBounds().getLeftTop()}setCenterTop(e){assert&&assert(e.isFinite(),"centerTop should be a finite Vector2");const t=this.getCenterTop();return t.isFinite()&&this.translate(e.minus(t),!0),this}set centerTop(e){this.setCenterTop(e)}get centerTop(){return this.getCenterTop()}getCenterTop(){return this.getBounds().getCenterTop()}setRightTop(e){assert&&assert(e.isFinite(),"rightTop should be a finite Vector2");const t=this.getRightTop();return t.isFinite()&&this.translate(e.minus(t),!0),this}set rightTop(e){this.setRightTop(e)}get rightTop(){return this.getRightTop()}getRightTop(){return this.getBounds().getRightTop()}setLeftCenter(e){assert&&assert(e.isFinite(),"leftCenter should be a finite Vector2");const t=this.getLeftCenter();return t.isFinite()&&this.translate(e.minus(t),!0),this}set leftCenter(e){this.setLeftCenter(e)}get leftCenter(){return this.getLeftCenter()}getLeftCenter(){return this.getBounds().getLeftCenter()}setCenter(e){assert&&assert(e.isFinite(),"center should be a finite Vector2");const t=this.getCenter();return t.isFinite()&&this.translate(e.minus(t),!0),this}set center(e){this.setCenter(e)}get center(){return this.getCenter()}getCenter(){return this.getBounds().getCenter()}setRightCenter(e){assert&&assert(e.isFinite(),"rightCenter should be a finite Vector2");const t=this.getRightCenter();return t.isFinite()&&this.translate(e.minus(t),!0),this}set rightCenter(e){this.setRightCenter(e)}get rightCenter(){return this.getRightCenter()}getRightCenter(){return this.getBounds().getRightCenter()}setLeftBottom(e){assert&&assert(e.isFinite(),"leftBottom should be a finite Vector2");const t=this.getLeftBottom();return t.isFinite()&&this.translate(e.minus(t),!0),this}set leftBottom(e){this.setLeftBottom(e)}get leftBottom(){return this.getLeftBottom()}getLeftBottom(){return this.getBounds().getLeftBottom()}setCenterBottom(e){assert&&assert(e.isFinite(),"centerBottom should be a finite Vector2");const t=this.getCenterBottom();return t.isFinite()&&this.translate(e.minus(t),!0),this}set centerBottom(e){this.setCenterBottom(e)}get centerBottom(){return this.getCenterBottom()}getCenterBottom(){return this.getBounds().getCenterBottom()}setRightBottom(e){assert&&assert(e.isFinite(),"rightBottom should be a finite Vector2");const t=this.getRightBottom();return t.isFinite()&&this.translate(e.minus(t),!0),this}set rightBottom(e){this.setRightBottom(e)}get rightBottom(){return this.getRightBottom()}getRightBottom(){return this.getBounds().getRightBottom()}getWidth(){return this.getBounds().getWidth()}get width(){return this.getWidth()}getHeight(){return this.getBounds().getHeight()}get height(){return this.getHeight()}getLocalWidth(){return this.getLocalBounds().getWidth()}get localWidth(){return this.getLocalWidth()}getLocalHeight(){return this.getLocalBounds().getHeight()}get localHeight(){return this.getLocalHeight()}getLocalLeft(){return this.getLocalBounds().minX}get localLeft(){return this.getLocalLeft()}getLocalRight(){return this.getLocalBounds().maxX}get localRight(){return this.getLocalRight()}getLocalCenterX(){return this.getLocalBounds().getCenterX()}get localCenterX(){return this.getLocalCenterX()}getLocalCenterY(){return this.getLocalBounds().getCenterY()}get localCenterY(){return this.getLocalCenterY()}getLocalTop(){return this.getLocalBounds().minY}get localTop(){return this.getLocalTop()}getLocalBottom(){return this.getLocalBounds().maxY}get localBottom(){return this.getLocalBottom()}getLocalLeftTop(){return this.getLocalBounds().getLeftTop()}get localLeftTop(){return this.getLocalLeftTop()}getLocalCenterTop(){return this.getLocalBounds().getCenterTop()}get localCenterTop(){return this.getLocalCenterTop()}getLocalRightTop(){return this.getLocalBounds().getRightTop()}get localRightTop(){return this.getLocalRightTop()}getLocalLeftCenter(){return this.getLocalBounds().getLeftCenter()}get localLeftCenter(){return this.getLocalLeftCenter()}getLocalCenter(){return this.getLocalBounds().getCenter()}get localCenter(){return this.getLocalCenter()}getLocalRightCenter(){return this.getLocalBounds().getRightCenter()}get localRightCenter(){return this.getLocalRightCenter()}getLocalLeftBottom(){return this.getLocalBounds().getLeftBottom()}get localLeftBottom(){return this.getLocalLeftBottom()}getLocalCenterBottom(){return this.getLocalBounds().getCenterBottom()}get localCenterBottom(){return this.getLocalCenterBottom()}getLocalRightBottom(){return this.getLocalBounds().getRightBottom()}get localRightBottom(){return this.getLocalRightBottom()}getId(){return this._id}get id(){return this.getId()}onVisiblePropertyChange(e){this._picker.onVisibilityChange(),assertSlow&&this._picker.audit(),this._pdomDisplaysInfo.onVisibilityChange(e);for(let t=0;t<this._parents.length;t++){const i=this._parents[t];i._excludeInvisibleChildrenFromBounds&&i.invalidateChildBounds()}}setVisibleProperty(e){return this._visibleProperty.setTargetProperty(e,this,Nh)}set visibleProperty(e){this.setVisibleProperty(e)}get visibleProperty(){return this.getVisibleProperty()}getVisibleProperty(){return this._visibleProperty}setVisible(e){return this.visibleProperty.set(e),this}set visible(e){this.setVisible(e)}get visible(){return this.isVisible()}isVisible(){return this.visibleProperty.value}setPhetioVisiblePropertyInstrumented(e){return this._visibleProperty.setTargetPropertyInstrumented(e,this)}set phetioVisiblePropertyInstrumented(e){this.setPhetioVisiblePropertyInstrumented(e)}get phetioVisiblePropertyInstrumented(){return this.getPhetioVisiblePropertyInstrumented()}getPhetioVisiblePropertyInstrumented(){return this._visibleProperty.getTargetPropertyInstrumented()}swapVisibility(e){assert&&assert(this.visible!==e.visible);const t=this.visible?this:e,i=this.visible?e:this,n=t.focused;return t.visible=!1,i.visible=!0,n&&i.focusable&&i.focus(),this}setOpacity(e){if(assert&&assert(isFinite(e),"opacity should be a finite number"),e<0||e>1)throw new Error(`opacity out of range: ${e}`);this.opacityProperty.value=e}set opacity(e){this.setOpacity(e)}get opacity(){return this.getOpacity()}getOpacity(){return this.opacityProperty.value}setDisabledOpacity(e){if(assert&&assert(isFinite(e),"disabledOpacity should be a finite number"),e<0||e>1)throw new Error(`disabledOpacity out of range: ${e}`);return this.disabledOpacityProperty.value=e,this}set disabledOpacity(e){this.setDisabledOpacity(e)}get disabledOpacity(){return this.getDisabledOpacity()}getDisabledOpacity(){return this.disabledOpacityProperty.value}getEffectiveOpacity(){return this.opacityProperty.value*(this.enabledProperty.value?1:this.disabledOpacityProperty.value)}get effectiveOpacity(){return this.getEffectiveOpacity()}onOpacityPropertyChange(){this.filterChangeEmitter.emit()}onDisabledOpacityPropertyChange(){this._enabledProperty.value||this.filterChangeEmitter.emit()}setFilters(e){assert&&assert(Array.isArray(e),"filters should be an array"),assert&&assert(_.every(e,t=>t instanceof lr),"filters should consist of Filter objects only"),this._filters.length=0,this._filters.push(...e),this.invalidateHint(),this.filterChangeEmitter.emit()}set filters(e){this.setFilters(e)}get filters(){return this.getFilters()}getFilters(){return this._filters.slice()}setPickableProperty(e){return this._pickableProperty.setTargetProperty(e,this,null)}set pickableProperty(e){this.setPickableProperty(e)}get pickableProperty(){return this.getPickableProperty()}getPickableProperty(){return this._pickableProperty}setPickable(e){return assert&&assert(e===null||typeof e=="boolean"),this._pickableProperty.set(e),this}set pickable(e){this.setPickable(e)}get pickable(){return this.isPickable()}isPickable(){return this._pickableProperty.value}onPickablePropertyChange(e,t){this._picker.onPickableChange(t,e),assertSlow&&this._picker.audit()}setEnabledProperty(e){return this._enabledProperty.setTargetProperty(e,this,Mh)}set enabledProperty(e){this.setEnabledProperty(e)}get enabledProperty(){return this.getEnabledProperty()}getEnabledProperty(){return this._enabledProperty}setPhetioEnabledPropertyInstrumented(e){return this._enabledProperty.setTargetPropertyInstrumented(e,this)}set phetioEnabledPropertyInstrumented(e){this.setPhetioEnabledPropertyInstrumented(e)}get phetioEnabledPropertyInstrumented(){return this.getPhetioEnabledPropertyInstrumented()}getPhetioEnabledPropertyInstrumented(){return this._enabledProperty.getTargetPropertyInstrumented()}setEnabled(e){return assert&&assert(e===null||typeof e=="boolean"),this._enabledProperty.set(e),this}set enabled(e){this.setEnabled(e)}get enabled(){return this.isEnabled()}isEnabled(){return this._enabledProperty.value}onEnabledPropertyChange(e){!e&&this.interruptSubtreeInput(),this.inputEnabled=e,this.disabledOpacityProperty.value!==1&&this.filterChangeEmitter.emit()}setInputEnabledProperty(e){return this._inputEnabledProperty.setTargetProperty(e,this,Rh)}set inputEnabledProperty(e){this.setInputEnabledProperty(e)}get inputEnabledProperty(){return this.getInputEnabledProperty()}getInputEnabledProperty(){return this._inputEnabledProperty}setPhetioInputEnabledPropertyInstrumented(e){return this._inputEnabledProperty.setTargetPropertyInstrumented(e,this)}set phetioInputEnabledPropertyInstrumented(e){this.setPhetioInputEnabledPropertyInstrumented(e)}get phetioInputEnabledPropertyInstrumented(){return this.getPhetioInputEnabledPropertyInstrumented()}getPhetioInputEnabledPropertyInstrumented(){return this._inputEnabledProperty.getTargetPropertyInstrumented()}setInputEnabled(e){this.inputEnabledProperty.value=e}set inputEnabled(e){this.setInputEnabled(e)}get inputEnabled(){return this.isInputEnabled()}isInputEnabled(){return this.inputEnabledProperty.value}setInputListeners(e){for(assert&&assert(Array.isArray(e));this._inputListeners.length;)this.removeInputListener(this._inputListeners[0]);for(let t=0;t<e.length;t++)this.addInputListener(e[t]);return this}set inputListeners(e){this.setInputListeners(e)}get inputListeners(){return this.getInputListeners()}getInputListeners(){return this._inputListeners.slice(0)}setCursor(e){this._cursor=e==="auto"?null:e}set cursor(e){this.setCursor(e)}get cursor(){return this.getCursor()}getCursor(){return this._cursor}getEffectiveCursor(){if(this._cursor)return this._cursor;for(let e=0;e<this._inputListeners.length;e++){const t=this._inputListeners[e];if(t.cursor)return t.cursor}return null}setMouseArea(e){return assert&&assert(e===null||e instanceof yt||e instanceof Be,"mouseArea needs to be a phet.kite.Shape, phet.dot.Bounds2, or null"),this._mouseArea!==e&&(this._mouseArea=e,this._picker.onMouseAreaChange(),assertSlow&&this._picker.audit()),this}set mouseArea(e){this.setMouseArea(e)}get mouseArea(){return this.getMouseArea()}getMouseArea(){return this._mouseArea}setTouchArea(e){return assert&&assert(e===null||e instanceof yt||e instanceof Be,"touchArea needs to be a phet.kite.Shape, phet.dot.Bounds2, or null"),this._touchArea!==e&&(this._touchArea=e,this._picker.onTouchAreaChange(),assertSlow&&this._picker.audit()),this}set touchArea(e){this.setTouchArea(e)}get touchArea(){return this.getTouchArea()}getTouchArea(){return this._touchArea}setClipArea(e){assert&&assert(e===null||e instanceof yt,"clipArea needs to be a phet.kite.Shape, or null"),this.clipArea!==e&&(this.clipAreaProperty.value=e,this.invalidateBounds(),this._picker.onClipAreaChange(),assertSlow&&this._picker.audit())}set clipArea(e){this.setClipArea(e)}get clipArea(){return this.getClipArea()}getClipArea(){return this.clipAreaProperty.value}hasClipArea(){return this.clipArea!==null}setRendererBitmask(e){assert&&assert(isFinite(e)),e!==this._rendererBitmask&&(this._rendererBitmask=e,this._rendererSummary.selfChange(),this.instanceRefreshEmitter.emit())}invalidateSupportedRenderers(){}invalidateHint(){this.rendererSummaryRefreshEmitter.emit(),this.instanceRefreshEmitter.emit()}setRenderer(e){assert&&assert(e===null||e==="canvas"||e==="svg"||e==="dom"||e==="webgl",'Renderer input should be null, or one of: "canvas", "svg", "dom" or "webgl".');let t=0;e==="canvas"?t=ne.bitmaskCanvas:e==="svg"?t=ne.bitmaskSVG:e==="dom"?t=ne.bitmaskDOM:e==="webgl"&&(t=ne.bitmaskWebGL),assert&&assert(e===null==(t===0),"We should only end up with no actual renderer if renderer is null"),this._renderer!==t&&(this._renderer=t,this.invalidateHint())}set renderer(e){this.setRenderer(e)}get renderer(){return this.getRenderer()}getRenderer(){return this._renderer===0?null:this._renderer===ne.bitmaskCanvas?"canvas":this._renderer===ne.bitmaskSVG?"svg":this._renderer===ne.bitmaskDOM?"dom":this._renderer===ne.bitmaskWebGL?"webgl":(assert&&assert(!1,"Seems to be an invalid renderer?"),null)}setLayerSplit(e){e!==this._layerSplit&&(this._layerSplit=e,this.invalidateHint())}set layerSplit(e){this.setLayerSplit(e)}get layerSplit(){return this.isLayerSplit()}isLayerSplit(){return this._layerSplit}setUsesOpacity(e){e!==this._usesOpacity&&(this._usesOpacity=e,this.invalidateHint())}set usesOpacity(e){this.setUsesOpacity(e)}get usesOpacity(){return this.getUsesOpacity()}getUsesOpacity(){return this._usesOpacity}setCSSTransform(e){e!==this._cssTransform&&(this._cssTransform=e,this.invalidateHint())}set cssTransform(e){this.setCSSTransform(e)}get cssTransform(){return this.isCSSTransformed()}isCSSTransformed(){return this._cssTransform}setExcludeInvisible(e){e!==this._excludeInvisible&&(this._excludeInvisible=e,this.invalidateHint())}set excludeInvisible(e){this.setExcludeInvisible(e)}get excludeInvisible(){return this.isExcludeInvisible()}isExcludeInvisible(){return this._excludeInvisible}setExcludeInvisibleChildrenFromBounds(e){e!==this._excludeInvisibleChildrenFromBounds&&(this._excludeInvisibleChildrenFromBounds=e,this.invalidateBounds())}set excludeInvisibleChildrenFromBounds(e){this.setExcludeInvisibleChildrenFromBounds(e)}get excludeInvisibleChildrenFromBounds(){return this.isExcludeInvisibleChildrenFromBounds()}isExcludeInvisibleChildrenFromBounds(){return this._excludeInvisibleChildrenFromBounds}setLayoutOptions(e){assert&&assert(e===null||typeof e=="object"&&Object.getPrototypeOf(e)===Object.prototype,"layoutOptions should be null or an plain options-style object"),e!==this._layoutOptions&&(this._layoutOptions=e,this.layoutOptionsChangedEmitter.emit())}set layoutOptions(e){this.setLayoutOptions(e)}get layoutOptions(){return this.getLayoutOptions()}getLayoutOptions(){return this._layoutOptions}mutateLayoutOptions(e){this.layoutOptions=En()({},this.layoutOptions||{},e)}get widthSizable(){return!1}get heightSizable(){return!1}get extendsWidthSizable(){return!1}get extendsHeightSizable(){return!1}get extendsSizable(){return!1}setPreventFit(e){e!==this._preventFit&&(this._preventFit=e,this.invalidateHint())}set preventFit(e){this.setPreventFit(e)}get preventFit(){return this.isPreventFit()}isPreventFit(){return this._preventFit}setWebGLScale(e){assert&&assert(e===null||typeof e=="number"&&isFinite(e)),e!==this._webglScale&&(this._webglScale=e,this.invalidateHint())}set webglScale(e){this.setWebGLScale(e)}get webglScale(){return this.getWebGLScale()}getWebGLScale(){return this._webglScale}getUniqueTrail(e){if(e){const t=this.getTrails(e);return assert&&assert(t.length===1,`getUniqueTrail found ${t.length} matching trails for the predicate`),t[0]}else{const t=new ht;let i=this;for(;i;)assert&&assert(i._parents.length<=1,`getUniqueTrail found a Node with ${i._parents.length} parents.`),t.addAncestor(i),i=i._parents[0];return t}}getUniqueTrailTo(e){return this.getUniqueTrail(t=>e===t)}getTrails(e){e=e||ji.defaultTrailPredicate;const t=[],i=new ht(this);return ht.appendAncestorTrailsWithPredicate(t,i,e),t}getTrailsTo(e){return this.getTrails(t=>t===e)}getLeafTrails(e){e=e||ji.defaultLeafTrailPredicate;const t=[],i=new ht(this);return ht.appendDescendantTrailsWithPredicate(t,i,e),t}getLeafTrailsTo(e){return this.getLeafTrails(t=>t===e)}getUniqueLeafTrail(e){const t=this.getLeafTrails(e);return assert&&assert(t.length===1,`getUniqueLeafTrail found ${t.length} matching trails for the predicate`),t[0]}getUniqueLeafTrailTo(e){return this.getUniqueLeafTrail(t=>t===e)}getConnectedNodes(){const e=[];let t=this._children.concat(this._parents).concat(this);for(;t.length;){const i=t.pop();_.includes(e,i)||(e.push(i),t=t.concat(i._children,i._parents))}return e}getSubtreeNodes(){const e=[];let t=this._children.concat(this);for(;t.length;){const i=t.pop();_.includes(e,i)||(e.push(i),t=t.concat(i._children))}return e}getTopologicallySortedNodes(){const e={},t=[],i=[];let n;_.each(this.getConnectedNodes(),h=>{e[h.id]={},_.each(h._children,p=>{e[h.id][p.id]=!0}),h.parents.length||t.push(h)});function r(h){delete e[n.id][h.id],_.every(e,p=>!p[h.id])&&t.push(h)}for(;t.length;)n=t.pop(),i.push(n),_.each(n._children,r);return assert&&assert(_.every(e,h=>_.every(h,p=>!1)),"circular reference check"),i}canAddChild(e){if(this===e||_.includes(this._children,e))return!1;const t={},i=[];let n;_.each(this.getConnectedNodes().concat(e.getConnectedNodes()),h=>{t[h.id]={},_.each(h._children,p=>{t[h.id][p.id]=!0}),!h.parents.length&&h!==e&&i.push(h)}),t[this.id][e.id]=!0;function r(h){delete t[n.id][h.id],_.every(t,p=>!p[h.id])&&i.push(h)}for(;i.length;)n=i.pop(),_.each(n._children,r),n===this&&r(e);return _.every(t,h=>_.every(h,p=>!1))}canvasPaintSelf(e,t){}renderToCanvasSelf(e,t){this.isPainted()&&this._rendererBitmask&ne.bitmaskCanvas&&this.canvasPaintSelf(e,t)}renderToCanvasSubtree(e,t){t=t||$e.identity(),e.resetStyles(),this.renderToCanvasSelf(e,t);for(let i=0;i<this._children.length;i++){const n=this._children[i];if(n.isVisible()&&n.bounds.isValid()){const r=n.effectiveOpacity!==1||n.clipArea||n._filters.length;if(e.context.save(),t.multiplyMatrix(n._transform.getMatrix()),t.canvasSetTransform(e.context),r){const h=n.localBounds.transformed(t).dilate(4).roundOut().constrainBounds(Mb.setMinMax(0,0,e.canvas.width,e.canvas.height));if(h.width>0&&h.height>0){const p=document.createElement("canvas");p.width=h.width,p.height=h.height;const S=p.getContext("2d"),C=new sr(p,S),B=t.copy().prependTranslation(-h.minX,-h.minY);B.canvasSetTransform(S),n.renderToCanvasSubtree(C,B),e.context.save(),n.clipArea&&(e.context.beginPath(),n.clipArea.writeToContext(e.context),e.context.clip()),e.context.setTransform(1,0,0,1,0,0),e.context.globalAlpha=n.effectiveOpacity;let U=!1;n._filters.length&&(Qe.canvasFilter&&_.every(n._filters,k=>k.isDOMCompatible())?(e.context.filter=n._filters.map(k=>k.getCSSFilterString()).join(" "),U=!0):n._filters.forEach(k=>k.applyCanvasFilter(C))),e.context.drawImage(p,h.minX,h.minY),e.context.restore(),U&&(e.context.filter="none")}}else n.renderToCanvasSubtree(e,t);t.multiplyMatrix(n._transform.getInverse()),e.context.restore()}}}renderToCanvas(e,t,i,n){assert&&Xs("Node.renderToCanvas() is deprecated, please use Node.rasterized() instead"),e.width=e.width,n&&(t.fillStyle=n,t.fillRect(0,0,e.width,e.height));const r=new sr(e,t);this.renderToCanvasSubtree(r,$e.identity()),i&&i()}toCanvas(e,t,i,n,r){assert&&assert(t===void 0||typeof t=="number","If provided, x should be a number"),assert&&assert(i===void 0||typeof i=="number","If provided, y should be a number"),assert&&assert(n===void 0||typeof n=="number"&&n>=0&&n%1===0,"If provided, width should be a non-negative integer"),assert&&assert(r===void 0||typeof r=="number"&&r>=0&&r%1===0,"If provided, height should be a non-negative integer");const h=2,p=this.getBounds().union(this.localToParentBounds(this.getSafeSelfBounds()));assert&&assert(!p.isEmpty()||t!==void 0&&i!==void 0&&n!==void 0&&r!==void 0,"Should not call toCanvas on a Node with empty bounds, unless all dimensions are provided"),t=t!==void 0?t:Math.ceil(h-p.minX),i=i!==void 0?i:Math.ceil(h-p.minY),n=n!==void 0?n:Math.ceil(p.getWidth()+2*h),r=r!==void 0?r:Math.ceil(p.getHeight()+2*h);const S=document.createElement("canvas");S.width=n,S.height=r;const C=S.getContext("2d");C.translate(t,i),this._transform.getMatrix().canvasAppendTransform(C);const B=new sr(S,C);this.renderToCanvasSubtree(B,$e.translation(t,i).timesMatrix(this._transform.getMatrix())),e(S,t,i,n,r)}toDataURL(e,t,i,n,r){assert&&assert(t===void 0||typeof t=="number","If provided, x should be a number"),assert&&assert(i===void 0||typeof i=="number","If provided, y should be a number"),assert&&assert(n===void 0||typeof n=="number"&&n>=0&&n%1===0,"If provided, width should be a non-negative integer"),assert&&assert(r===void 0||typeof r=="number"&&r>=0&&r%1===0,"If provided, height should be a non-negative integer"),this.toCanvas((h,p,S,C,B)=>{e(h.toDataURL(),p,S,C,B)},t,i,n,r)}toImage(e,t,i,n,r){assert&&Xs("Node.toImage() is deprecated, please use Node.rasterized() instead"),assert&&assert(t===void 0||typeof t=="number","If provided, x should be a number"),assert&&assert(i===void 0||typeof i=="number","If provided, y should be a number"),assert&&assert(n===void 0||typeof n=="number"&&n>=0&&n%1===0,"If provided, width should be a non-negative integer"),assert&&assert(r===void 0||typeof r=="number"&&r>=0&&r%1===0,"If provided, height should be a non-negative integer"),this.toDataURL((h,p,S)=>{const C=document.createElement("img");C.onload=()=>{e(C,p,S);try{delete C.onload}catch{}},C.src=h},t,i,n,r)}toImageNodeAsynchronous(e,t,i,n,r){assert&&Xs("Node.toImageNodeAsyncrhonous() is deprecated, please use Node.rasterized() instead"),assert&&assert(t===void 0||typeof t=="number","If provided, x should be a number"),assert&&assert(i===void 0||typeof i=="number","If provided, y should be a number"),assert&&assert(n===void 0||typeof n=="number"&&n>=0&&n%1===0,"If provided, width should be a non-negative integer"),assert&&assert(r===void 0||typeof r=="number"&&r>=0&&r%1===0,"If provided, height should be a non-negative integer"),this.toImage((h,p,S)=>{e(new ji({children:[new qi(h,{x:-p,y:-S})]}))},t,i,n,r)}toCanvasNodeSynchronous(e,t,i,n){assert&&Xs("Node.toCanvasNodeSynchronous() is deprecated, please use Node.rasterized() instead"),assert&&assert(e===void 0||typeof e=="number","If provided, x should be a number"),assert&&assert(t===void 0||typeof t=="number","If provided, y should be a number"),assert&&assert(i===void 0||typeof i=="number"&&i>=0&&i%1===0,"If provided, width should be a non-negative integer"),assert&&assert(n===void 0||typeof n=="number"&&n>=0&&n%1===0,"If provided, height should be a non-negative integer");let r=null;return this.toCanvas((h,p,S)=>{r=new ji({children:[new qi(h,{x:-p,y:-S})]})},e,t,i,n),assert&&assert(r,"toCanvasNodeSynchronous requires that the node can be rendered only using Canvas"),r}toDataURLImageSynchronous(e,t,i,n){assert&&Xs("Node.toDataURLImageSychronous() is deprecated, please use Node.rasterized() instead"),assert&&assert(e===void 0||typeof e=="number","If provided, x should be a number"),assert&&assert(t===void 0||typeof t=="number","If provided, y should be a number"),assert&&assert(i===void 0||typeof i=="number"&&i>=0&&i%1===0,"If provided, width should be a non-negative integer"),assert&&assert(n===void 0||typeof n=="number"&&n>=0&&n%1===0,"If provided, height should be a non-negative integer");let r=null;return this.toDataURL((h,p,S,C,B)=>{r=new qi(h,{x:-p,y:-S,initialWidth:C,initialHeight:B})},e,t,i,n),assert&&assert(r,"toDataURL failed to return a result synchronously"),r}toDataURLNodeSynchronous(e,t,i,n){return assert&&Xs("Node.toDataURLNodeSynchronous() is deprecated, please use Node.rasterized() instead"),assert&&assert(e===void 0||typeof e=="number","If provided, x should be a number"),assert&&assert(t===void 0||typeof t=="number","If provided, y should be a number"),assert&&assert(i===void 0||typeof i=="number"&&i>=0&&i%1===0,"If provided, width should be a non-negative integer"),assert&&assert(n===void 0||typeof n=="number"&&n>=0&&n%1===0,"If provided, height should be a non-negative integer"),new ji({children:[this.toDataURLImageSynchronous(e,t,i,n)]})}rasterized(e){const t=je()({resolution:1,sourceBounds:null,useTargetBounds:!0,wrap:!0,useCanvas:!1,imageOptions:{}},e),i=t.resolution,n=t.sourceBounds;assert&&(assert(typeof i=="number"&&i>0,"resolution should be a positive number"),assert(n===null||n instanceof Be,"sourceBounds should be null or a Bounds2"),n&&(assert(n.isValid(),"sourceBounds should be valid (finite non-negative)"),assert(Number.isInteger(n.width),"sourceBounds.width should be an integer"),assert(Number.isInteger(n.height),"sourceBounds.height should be an integer")));const r=new ji({scale:i,children:[this]});let h=n||this.getSafeTransformedVisibleBounds().dilated(2).roundedOut();i!==1&&(h=new Be(i*h.minX,i*h.minY,i*h.maxX,i*h.maxY),h.width%1!==0&&(h.maxX+=1-h.width%1),h.height%1!==0&&(h.maxY+=1-h.height%1));let p=null;function S(B,U,k,Q,X){const g=t.useCanvas?B:B.toDataURL();p=new qi(g,ii({},t.imageOptions,{x:-U,y:-k,initialWidth:Q,initialHeight:X})),p.scale(1/i,1/i,!0)}r.toCanvas(S,-h.minX,-h.minY,Ui.roundSymmetric(h.width),Ui.roundSymmetric(h.height)),assert&&assert(p,"The toCanvas should have executed synchronously"),r.dispose();let C=this.getVisibleBounds();if(n&&(C=n.intersection(C)),t.useTargetBounds&&(p.imageBounds=p.parentToLocalBounds(C)),t.wrap){const B=new ji({children:[p]});return t.useTargetBounds&&(B.localBounds=C),B}else return t.useTargetBounds&&(p.localBounds=p.parentToLocalBounds(C)),p}createDOMDrawable(e,t){throw new Error("createDOMDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")}createSVGDrawable(e,t){throw new Error("createSVGDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")}createCanvasDrawable(e,t){throw new Error("createCanvasDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")}createWebGLDrawable(e,t){throw new Error("createWebGLDrawable is abstract. The subtype should either override this method, or not support the DOM renderer")}getInstances(){return this._instances}get instances(){return this.getInstances()}addInstance(e){this._instances.push(e),this.changedInstanceEmitter.emit(e,!0)}removeInstance(e){const t=_.indexOf(this._instances,e);assert&&assert(t!==-1,"Cannot remove a Instance from a Node if it was not there"),this._instances.splice(t,1),this.changedInstanceEmitter.emit(e,!1)}wasVisuallyDisplayed(e){for(let t=0;t<this._instances.length;t++){const i=this._instances[t];if(i.visible&&(!e||i.display===e))return!0}return!1}getRootedDisplays(){return this._rootedDisplays}get rootedDisplays(){return this.getRootedDisplays()}addRootedDisplay(e){this._rootedDisplays.push(e),this._pdomDisplaysInfo.onAddedRootedDisplay(e),this.rootedDisplayChangedEmitter.emit(e)}removeRootedDisplay(e){const t=_.indexOf(this._rootedDisplays,e);assert&&assert(t!==-1,"Cannot remove a Display from a Node if it was not there"),this._rootedDisplays.splice(t,1),this._pdomDisplaysInfo.onRemovedRootedDisplay(e),this.rootedDisplayChangedEmitter.emit(e)}getRecursiveConnectedDisplays(e){this.rootedDisplays.length&&e.push(...this.rootedDisplays);for(let t=0;t<this._parents.length;t++)e.push(...this._parents[t].getRecursiveConnectedDisplays(e));return _.uniq(e)}getConnectedDisplays(){return _.uniq(this.getRecursiveConnectedDisplays([]))}localToParentPoint(e){return this._transform.transformPosition2(e)}localToParentBounds(e){return this._transform.transformBounds2(e)}parentToLocalPoint(e){return this._transform.inversePosition2(e)}parentToLocalBounds(e){return this._transform.inverseBounds2(e)}transformBoundsFromLocalToParent(e){return e.transform(this._transform.getMatrix())}transformBoundsFromParentToLocal(e){return e.transform(this._transform.getInverse())}getLocalToGlobalMatrix(){let e=this;const t=[];for(;e;)t.push(e._transform.getMatrix()),assert&&assert(e._parents[1]===void 0,"getLocalToGlobalMatrix unable to work for DAG"),e=e._parents[0];const i=$e.identity();for(let n=t.length-1;n>=0;n--)i.multiplyMatrix(t[n]);return i}getUniqueTransform(){return new Fs(this.getLocalToGlobalMatrix())}getGlobalToLocalMatrix(){return this.getLocalToGlobalMatrix().invert()}localToGlobalPoint(e){let t=this;const i=e.copy();for(;t;)t._transform.getMatrix().multiplyVector2(i),assert&&assert(t._parents[1]===void 0,"localToGlobalPoint unable to work for DAG"),t=t._parents[0];return i}globalToLocalPoint(e){let t=this;const i=[];for(;t;)i.push(t._transform),assert&&assert(t._parents[1]===void 0,"globalToLocalPoint unable to work for DAG"),t=t._parents[0];const n=e.copy();for(let r=i.length-1;r>=0;r--)i[r].getInverse().multiplyVector2(n);return n}localToGlobalBounds(e){return e.transformed(this.getLocalToGlobalMatrix())}globalToLocalBounds(e){return e.transformed(this.getGlobalToLocalMatrix())}parentToGlobalPoint(e){return assert&&assert(this.parents.length<=1,"parentToGlobalPoint unable to work for DAG"),this.parents.length?this.parents[0].localToGlobalPoint(e):e}parentToGlobalBounds(e){return assert&&assert(this.parents.length<=1,"parentToGlobalBounds unable to work for DAG"),this.parents.length?this.parents[0].localToGlobalBounds(e):e}globalToParentPoint(e){return assert&&assert(this.parents.length<=1,"globalToParentPoint unable to work for DAG"),this.parents.length?this.parents[0].globalToLocalPoint(e):e}globalToParentBounds(e){return assert&&assert(this.parents.length<=1,"globalToParentBounds unable to work for DAG"),this.parents.length?this.parents[0].globalToLocalBounds(e):e}getGlobalBounds(){return assert&&assert(this.parents.length<=1,"globalBounds unable to work for DAG"),this.parentToGlobalBounds(this.getBounds())}get globalBounds(){return this.getGlobalBounds()}boundsOf(e){return this.globalToLocalBounds(e.getGlobalBounds())}boundsTo(e){return e.globalToLocalBounds(this.getGlobalBounds())}attachDrawable(e){return this._drawables.push(e),this}detachDrawable(e){const t=_.indexOf(this._drawables,e);return assert&&assert(t>=0,"Invalid operation: trying to detach a non-referenced drawable"),this._drawables.splice(t,1),this}mutate(e){if(!e)return this;assert&&assert(Object.getPrototypeOf(e)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&assert(_.filter(["translation","x","left","right","centerX","centerTop","rightTop","leftCenter","center","rightCenter","leftBottom","centerBottom","rightBottom"],i=>e[i]!==void 0).length<=1,`More than one mutation on this Node set the x component, check ${Object.keys(e).join(",")}`),assert&&assert(_.filter(["translation","y","top","bottom","centerY","centerTop","rightTop","leftCenter","center","rightCenter","leftBottom","centerBottom","rightBottom"],i=>e[i]!==void 0).length<=1,`More than one mutation on this Node set the y component, check ${Object.keys(e).join(",")}`),assert&&e.hasOwnProperty("enabled")&&e.hasOwnProperty("enabledProperty")&&assert&&assert(e.enabledProperty.value===e.enabled,"If both enabled and enabledProperty are provided, then values should match"),assert&&e.hasOwnProperty("inputEnabled")&&e.hasOwnProperty("inputEnabledProperty")&&assert&&assert(e.inputEnabledProperty.value===e.inputEnabled,"If both inputEnabled and inputEnabledProperty are provided, then values should match"),assert&&e.hasOwnProperty("visible")&&e.hasOwnProperty("visibleProperty")&&assert&&assert(e.visibleProperty.value===e.visible,"If both visible and visibleProperty are provided, then values should match"),assert&&e.hasOwnProperty("pdomVisible")&&e.hasOwnProperty("pdomVisibleProperty")&&assert&&assert(e.pdomVisibleProperty.value===e.pdomVisible,"If both pdomVisible and pdomVisibleProperty are provided, then values should match"),assert&&e.hasOwnProperty("pickable")&&e.hasOwnProperty("pickableProperty")&&assert&&assert(e.pickableProperty.value===e.pickable,"If both pickable and pickableProperty are provided, then values should match");const t=this._mutatorKeys;for(let i=0;i<t.length;i++){const n=t[i];if(assert&&assert(!e.hasOwnProperty(n)||e[n]!==void 0,`Undefined not allowed for Node key: ${n}`),e[n]!==void 0){const r=Object.getOwnPropertyDescriptor(ji.prototype,n);r&&typeof r.value=="function"?this[n](e[n]):this[n]=e[n]}}return this.initializePhetioObject(Bb,e),this}initializePhetioObject(e,t){const i=this.isPhetioInstrumented();super.initializePhetioObject(e,t),Ft.PHET_IO_ENABLED&&!i&&this.isPhetioInstrumented()&&(this._visibleProperty.initializePhetio(this,Nh,()=>new Wt(this.visible,ii({phetioReadOnly:this.phetioReadOnly,tandem:this.tandem.createTandem(Nh),phetioDocumentation:"Controls whether the Node will be visible (and interactive)."},t.visiblePropertyOptions))),this._enabledProperty.initializePhetio(this,Mh,()=>new Do(this.enabled,ii({phetioReadOnly:this.phetioReadOnly,phetioDocumentation:'Sets whether the node is enabled. This will set whether input is enabled for this Node and most often children as well. It will also control and toggle the "disabled look" of the node.',tandem:this.tandem.createTandem(Mh)},t.enabledPropertyOptions))),this._inputEnabledProperty.initializePhetio(this,Rh,()=>new ei(this.inputEnabled,ii({phetioReadOnly:this.phetioReadOnly,tandem:this.tandem.createTandem(Rh),phetioValueType:Jn,phetioFeatured:!0,phetioDocumentation:"Sets whether the element will have input enabled, and hence be interactive."},t.inputEnabledPropertyOptions))))}setVoicingVisible(e){this.voicingVisibleProperty.value!==e&&(this.voicingVisibleProperty.value=e)}set voicingVisible(e){this.setVoicingVisible(e)}get voicingVisible(){return this.isVoicingVisible()}isVoicingVisible(){return this.voicingVisibleProperty.value}getDebugHTMLExtras(){return""}inspect(){localStorage.scenerySnapshot=JSON.stringify({type:"Subtree",rootNodeId:this.id,nodes:ym(this)})}toString(){return`${this.constructor.name}#${this.id}`}auditInstanceSubtreeForDisplay(e){if(assertSlow){const t=this._instances.length;for(let i=0;i<t;i++){const n=this._instances[i];n.display===e&&assertSlow(n.trail.isValid(),`Invalid trail on Instance: ${n.toString()} with trail ${n.trail.toString()}`)}this.children.forEach(i=>{i.auditInstanceSubtreeForDisplay(e)})}}onBoundsListenersAddedOrRemoved(e){this.changeBoundsEventCount(e),this._boundsEventSelfCount+=e}dispose(){this.disposeParallelDOM(),this.removeAllChildren(),this.detach(),this._inputEnabledProperty.dispose(),this._enabledProperty.dispose(),this._pickableProperty.dispose(),this._visibleProperty.dispose(),super.dispose()}disposeSubtree(){if(!this.isDisposed){const e=this.children;this.dispose();for(let t=0;t<e.length;t++)e[t].disposeSubtree()}}static defaultTrailPredicate(e){return e._parents.length===0}static defaultLeafTrailPredicate(e){return e._children.length===0}},ji.REQUIRES_BOUNDS_OPTION_KEYS=kn,ji.DEFAULT_NODE_OPTIONS=gi,ji);Or.prototype._mutatorKeys=Ec.concat(Nb);Or.prototype.drawableMarkFlags=[];q.register("Node",Or);Or.NodeIO=new li("NodeIO",{valueType:Or,documentation:"The base type for graphical and potentially interactive objects.",metadataDefaults:{phetioState:df}});const Bb={phetioType:Or.NodeIO,phetioState:df},Ge=Or;class pf{constructor(e){this.node=e,this.selfPruned=!1,this.selfInclusive=!1,this.subtreePrunable=!0,this.subtreePickableCount=0,this.mouseInclusiveBounds=Be.NOTHING.copy(),this.mouseExclusiveBounds=Be.NOTHING.copy(),this.touchInclusiveBounds=Be.NOTHING.copy(),this.touchExclusiveBounds=Be.NOTHING.copy(),this.mouseInclusiveDirty=!0,this.mouseExclusiveDirty=!0,this.touchInclusiveDirty=!0,this.touchExclusiveDirty=!0,this.scratchVector=new We(0,0)}hitTest(e,t,i){assert&&assert(e,"trailUnderPointer requires a point"),sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`-------------- ${this.node.constructor.name}#${this.node.id}`);const n=this.selfInclusive;return t?n?this.validateMouseInclusive():this.validateMouseExclusive():i?n?this.validateTouchInclusive():this.validateTouchExclusive():this.node.validateBounds(),this.recursiveHitTest(e,t,i,!1)}recursiveHitTest(e,t,i,n){if(n=n||this.selfInclusive,this.selfPruned||!n&&this.subtreePrunable)return sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} pruned ${this.selfPruned?"(self)":"(subtree)"}`),null;let r;if(t?(r=n?this.mouseInclusiveBounds:this.mouseExclusiveBounds,assert&&assert(n?!this.mouseInclusiveDirty:!this.mouseExclusiveDirty)):i?(r=n?this.touchInclusiveBounds:this.touchExclusiveBounds,assert&&assert(n?!this.touchInclusiveDirty:!this.touchExclusiveDirty)):(r=this.node.bounds,assert&&assert(!this.node._boundsDirty)),!r.containsPoint(e))return sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} pruned: ${t?"mouse":i?"touch":"regular"}`),null;const h=this.node._transform.getInverse().multiplyVector2(this.scratchVector.set(e)),p=this.node.clipArea;if(p!==null&&!p.containsPoint(h))return sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} out of clip area`),null;sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id}`);for(let S=this.node._children.length-1;S>=0;S--){const C=this.node._children[S];sceneryLog&&sceneryLog.hitTest&&sceneryLog.push();const B=C._picker.recursiveHitTest(h,t,i,n);if(sceneryLog&&sceneryLog.hitTest&&sceneryLog.pop(),B)return B.addAncestor(this.node,S)}return t&&this.node._mouseArea?(sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} mouse area hit`),this.node._mouseArea.containsPoint(h)?new ht(this.node):null):i&&this.node._touchArea?(sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} touch area hit`),this.node._touchArea.containsPoint(h)?new ht(this.node):null):this.node.selfBounds.containsPoint(h)&&this.node.containsPointSelf(h)?(sceneryLog&&sceneryLog.hitTest&&sceneryLog.hitTest(`${this.node.constructor.name}#${this.node.id} self hit`),new ht(this.node)):null}invalidate(e,t){let i=!!t||!this.mouseInclusiveDirty||!this.touchInclusiveDirty;if(this.mouseInclusiveDirty=!0,this.touchInclusiveDirty=!0,e&&(i=i||!this.mouseExclusiveDirty||!this.touchExclusiveDirty,this.mouseExclusiveDirty=!0,this.touchExclusiveDirty=!0),!this.selfPruned&&i){const n=this.node._parents;for(let r=0;r<n.length;r++)n[r]._picker.invalidate(e||this.selfInclusive,!1)}}validateMouseInclusive(){if(!this.mouseInclusiveDirty)return;this.mouseInclusiveBounds.set(this.node.selfBounds);const e=this.node._children;for(let t=0;t<e.length;t++){const i=e[t]._picker;i.selfPruned||(i.validateMouseInclusive(),this.mouseInclusiveBounds.includeBounds(i.mouseInclusiveBounds))}this.applyAreasAndTransform(this.mouseInclusiveBounds,this.node._mouseArea),this.mouseInclusiveDirty=!1}validateMouseExclusive(){if(!this.mouseExclusiveDirty)return;this.mouseExclusiveBounds.set(this.node.selfBounds);const e=this.node._children;for(let t=0;t<e.length;t++){const i=e[t]._picker;i.subtreePrunable||(i.selfInclusive?(i.validateMouseInclusive(),this.mouseExclusiveBounds.includeBounds(i.mouseInclusiveBounds)):(i.validateMouseExclusive(),this.mouseExclusiveBounds.includeBounds(i.mouseExclusiveBounds)))}this.applyAreasAndTransform(this.mouseExclusiveBounds,this.node._mouseArea),this.mouseExclusiveDirty=!1}validateTouchInclusive(){if(!this.touchInclusiveDirty)return;this.touchInclusiveBounds.set(this.node.selfBounds);const e=this.node._children;for(let t=0;t<e.length;t++){const i=e[t]._picker;i.selfPruned||(i.validateTouchInclusive(),this.touchInclusiveBounds.includeBounds(i.touchInclusiveBounds))}this.applyAreasAndTransform(this.touchInclusiveBounds,this.node._touchArea),this.touchInclusiveDirty=!1}validateTouchExclusive(){if(!this.touchExclusiveDirty)return;this.touchExclusiveBounds.set(this.node.selfBounds);const e=this.node._children;for(let t=0;t<e.length;t++){const i=e[t]._picker;i.subtreePrunable||(i.selfInclusive?(i.validateTouchInclusive(),this.touchExclusiveBounds.includeBounds(i.touchInclusiveBounds)):(i.validateTouchExclusive(),this.touchExclusiveBounds.includeBounds(i.touchExclusiveBounds)))}this.applyAreasAndTransform(this.touchExclusiveBounds,this.node._touchArea),this.touchExclusiveDirty=!1}applyAreasAndTransform(e,t){t&&e.includeBounds(t instanceof Be?t:t.bounds);const i=this.node.clipArea;if(i){const n=i.bounds;e.minX=Math.max(e.minX,n.minX),e.minY=Math.max(e.minY,n.minY),e.maxX=Math.min(e.maxX,n.maxX),e.maxY=Math.min(e.maxY,n.maxY)}this.node.transformBoundsFromLocalToParent(e)}onInsertChild(e){if(!e._picker.selfPruned){const t=e._picker.subtreePickableCount>0;t&&this.changePickableCount(1),this.invalidate(t,!0)}}onRemoveChild(e){if(!e._picker.selfPruned){const t=e._picker.subtreePickableCount>0;t&&this.changePickableCount(-1),this.invalidate(t,!0)}}onAddInputListener(){this.checkSelfInclusive(),this.checkSubtreePrunable(),this.changePickableCount(1),assertSlow&&this.audit()}onRemoveInputListener(){this.checkSelfInclusive(),this.checkSubtreePrunable(),this.changePickableCount(-1),assertSlow&&this.audit()}onPickableChange(e,t){this.checkSelfPruned(),this.checkSelfInclusive(),this.checkSubtreePrunable();const i=(e===!0?-1:0)+(t===!0?1:0);i&&this.changePickableCount(i),assertSlow&&this.audit()}onVisibilityChange(){this.checkSelfPruned(),this.checkSubtreePrunable()}onMouseAreaChange(){this.invalidate(!0)}onTouchAreaChange(){this.invalidate(!0)}onTransformChange(){this.invalidate(!0)}onSelfBoundsDirty(){this.invalidate(!0)}onClipAreaChange(){this.invalidate(!0)}checkSelfPruned(){const e=this.node.pickableProperty.value===!1||!this.node.isVisible();if(this.selfPruned!==e){this.selfPruned=e;const t=this.node._parents;for(let i=0;i<t.length;i++){const n=t[i]._picker;this.subtreePickableCount>0?(n.invalidate(!0,!0),n.changePickableCount(this.selfPruned?-1:1)):n.invalidate(!1,!0)}}}checkSelfInclusive(){const e=this.node.pickableProperty.value===!0||this.node._inputListeners.length>0;this.selfInclusive!==e&&(this.selfInclusive=e,this.invalidate(!0,!0))}checkSubtreePrunable(){const e=this.node.pickableProperty.value===!1||!this.node.isVisible()||this.node.pickableProperty.value!==!0&&this.subtreePickableCount===0;this.subtreePrunable!==e&&(this.subtreePrunable=e,this.invalidate(!0,!0))}changePickableCount(e){if(e===0)return;const t=this.subtreePickableCount===0;this.subtreePickableCount+=e;const i=this.subtreePickableCount===0;if(this.checkSubtreePrunable(),assert&&assert(this.subtreePickableCount>=0,"subtree pickable count should be guaranteed to be >= 0"),!this.selfPruned&&t!==i){const n=this.node._parents.length;for(let r=0;r<n;r++)this.node._parents[r]._picker.changePickableCount(t?1:-1)}}audit(){if(assertSlow){this.node._children.forEach(h=>{h._picker.audit()});const e=assertSlow,t=this.node.pickable===!1||!this.node.isVisible(),i=this.node.pickable===!0||this.node._inputListeners.length>0,n=this.node.pickable===!1||!this.node.isVisible()||this.node.pickable!==!0&&this.subtreePickableCount===0,r=this.node._inputListeners.length+(this.node.pickableProperty.value===!0?1:0)+_.filter(this.node._children,h=>!h._picker.selfPruned&&h._picker.subtreePickableCount>0).length;assertSlow(this.selfPruned===t,"selfPruned mismatch"),assertSlow(this.selfInclusive===i,"selfInclusive mismatch"),assertSlow(this.subtreePrunable===n,"subtreePrunable mismatch"),assertSlow(this.subtreePickableCount===r,"subtreePickableCount mismatch"),this.node._parents.forEach(h=>{const p=h._picker,S=this;p.mouseInclusiveDirty||e(S.selfPruned||!S.mouseInclusiveDirty),p.mouseExclusiveDirty||(S.selfInclusive?e(S.selfPruned||!S.mouseInclusiveDirty):e(S.selfPruned||S.subtreePrunable||!S.mouseExclusiveDirty)),p.touchInclusiveDirty||e(S.selfPruned||!S.touchInclusiveDirty),p.touchExclusiveDirty||(S.selfInclusive?e(S.selfPruned||!S.touchInclusiveDirty):e(S.selfPruned||S.subtreePrunable||!S.touchExclusiveDirty))})}}}q.register("Picker",pf);const Tn=[ne.bitmaskCanvas,ne.bitmaskSVG,ne.bitmaskDOM,ne.bitmaskWebGL,ne.bitmaskSingleCanvas,ne.bitmaskSingleSVG,ne.bitmaskNotPainted,ne.bitmaskBoundsValid,ne.bitmaskNoPDOM,ne.bitmaskLacksCanvas,ne.bitmaskLacksSVG,ne.bitmaskLacksDOM,ne.bitmaskLacksWebGL],gf={};Tn.forEach((l,e)=>{gf[l]=e});const $n=Tn.length;let du=0;for(let l=0;l<$n;l++)du|=Tn[l];class Dn{constructor(e){assert&&assert(e instanceof Ge),assert&&assert(e._rendererBitmask===ne.bitmaskNodeDefault,"Node must have a default bitmask when creating a RendererSummary"),assert&&assert(e._children.length===0,"Node cannot have children when creating a RendererSummary"),this.node=e,this._counts=new Int16Array($n),this.bitmask=du,this.selfBitmask=Dn.summaryBitmaskForNodeSelf(e),this.summaryChange(this.bitmask,this.selfBitmask);const t=this.selfChange.bind(this);this.node.filterChangeEmitter.addListener(t),this.node.clipAreaProperty.lazyLink(t),this.node.rendererSummaryRefreshEmitter.addListener(t)}summaryChange(e,t){assert&&this.audit();const i=e^t;let n=0,r=0;for(let h=0;h<$n;h++){const p=Tn[h],S=gf[p];p&i&&(p&t?(this._counts[S]--,this._counts[S]===0&&(r|=p)):(this._counts[S]++,this._counts[S]===1&&(n|=p)))}if(n||r){const h=this.bitmask;assert&&assert(h!==void 0);for(let S=0;S<$n;S++){const C=Tn[S];r&C&&(this.bitmask|=C),n&C&&(this.bitmask^=C,assert&&assert(!(this.bitmask&C),"Should be cleared, doing cheaper XOR assuming it already was set"))}this.node.instanceRefreshEmitter.emit(),this.node.onSummaryChange(h,this.bitmask);const p=this.node._parents.length;for(let S=0;S<p;S++)this.node._parents[S]._rendererSummary.summaryChange(n,r);assert&&assert(this.bitmask===this.computeBitmask(),"Sanity check")}assert&&this.audit()}selfChange(){const e=this.selfBitmask,t=Dn.summaryBitmaskForNodeSelf(this.node);e!==t&&(this.summaryChange(e,t),this.selfBitmask=t)}computeBitmask(){let e=0;for(let t=0;t<$n;t++)this._counts[t]===0&&(e|=Tn[t]);return e}isSubtreeFullyCompatible(e){return!!(e&this.bitmask)}isSubtreeContainingCompatible(e){return!(e<<ne.bitmaskLacksShift&this.bitmask)}isSingleCanvasSupported(){return!!(ne.bitmaskSingleCanvas&this.bitmask)}isSingleSVGSupported(){return!!(ne.bitmaskSingleSVG&this.bitmask)}isNotPainted(){return!!(ne.bitmaskNotPainted&this.bitmask)}hasNoPDOM(){return!!(ne.bitmaskNoPDOM&this.bitmask)}areBoundsValid(){return!!(ne.bitmaskBoundsValid&this.bitmask)}isSubtreeRenderedExclusivelySVG(e){if(!this.isSingleSVGSupported())return!1;for(let t=0;t<ne.numActiveRenderers;t++){const i=ne.bitmaskOrder(e,t);if(ne.bitmaskSVG&i)return!0;if(this.isSubtreeContainingCompatible(i))return!1}return!1}isSubtreeRenderedExclusivelyCanvas(e){if(!this.isSingleCanvasSupported())return!1;for(let t=0;t<ne.numActiveRenderers;t++){const i=ne.bitmaskOrder(e,t);if(ne.bitmaskCanvas&i)return!0;if(this.isSubtreeContainingCompatible(i))return!1}return!1}audit(){if(assert)for(let e=0;e<$n;e++){const t=Tn[e],i=this._counts[e]===0,n=!!(this.bitmask&t);assert(i===n,"Bits should be set if count is zero")}}toString(){let e=Dn.bitmaskToString(this.bitmask);for(let t=0;t<$n;t++){const i=Tn[t],n=this._counts[t];n!==0&&(e+=` ${Dn.bitToString(i)}:${n}`)}return e}static summaryBitmaskForNodeSelf(e){let t=e._rendererBitmask;e.isPainted()?t|=(e._rendererBitmask&ne.bitmaskCurrentRendererArea^ne.bitmaskCurrentRendererArea)<<ne.bitmaskLacksShift:t|=ne.bitmaskCurrentRendererArea<<ne.bitmaskLacksShift;const i=e._cssTransform||e._layerSplit,n=e._renderer;return!i&&ne.isSVG(e._rendererBitmask)&&(!n||ne.isSVG(n))&&(t|=ne.bitmaskSingleSVG),!i&&ne.isCanvas(e._rendererBitmask)&&(!n||ne.isCanvas(n))&&(t|=ne.bitmaskSingleCanvas),e.isPainted()||(t|=ne.bitmaskNotPainted),e.areSelfBoundsValid()&&(t|=ne.bitmaskBoundsValid),!e.hasPDOMContent&&!e.hasPDOMOrder()&&(t|=ne.bitmaskNoPDOM),t}static bitToString(e){return e===ne.bitmaskCanvas?"Canvas":e===ne.bitmaskSVG?"SVG":e===ne.bitmaskDOM?"DOM":e===ne.bitmaskWebGL?"WebGL":e===ne.bitmaskLacksCanvas?"(-Canvas)":e===ne.bitmaskLacksSVG?"(-SVG)":e===ne.bitmaskLacksDOM?"(-DOM)":e===ne.bitmaskLacksWebGL?"(-WebGL)":e===ne.bitmaskSingleCanvas?"SingleCanvas":e===ne.bitmaskSingleSVG?"SingleSVG":e===ne.bitmaskNotPainted?"NotPainted":e===ne.bitmaskBoundsValid?"BoundsValid":e===ne.bitmaskNoPDOM?"NotAccessible":"?"}static bitmaskToString(e){let t="";for(let i=0;i<$n;i++){const n=Tn[i];e&n&&(t+=`${Dn.bitToString(n)} `)}return t}}Dn.bitmaskAll=du;q.register("RendererSummary",Dn);const Bh=Dn;class ff{constructor(e){this.node=e,this.pdomDisplays=[]}onAddChild(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onAddChild n#${e.id} (parent:n#${this.node.id})`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),e._pdomDisplaysInfo.canHavePDOMDisplays()&&e._pdomDisplaysInfo.addPDOMDisplays(this.pdomDisplays),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onRemoveChild(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onRemoveChild n#${e.id} (parent:n#${this.node.id})`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),e._pdomDisplaysInfo.canHavePDOMDisplays()&&e._pdomDisplaysInfo.removePDOMDisplays(this.pdomDisplays),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onSummaryChange(e,t){if(sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onSummaryChange n#${this.node.id} wasPDOM:${!(ne.bitmaskNoPDOM&e)}, isPDOM:${!(ne.bitmaskNoPDOM&t)}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),this.node.visible&&this.node.pdomVisible){const i=!(ne.bitmaskNoPDOM&e),n=!(ne.bitmaskNoPDOM&t);n&&!i&&this.addAllPDOMDisplays(),!n&&i&&this.removeAllPDOMDisplays()}sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onVisibilityChange(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onVisibilityChange n#${this.node.id} visible:${e}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),this.node.pdomVisible&&!this.node._rendererSummary.hasNoPDOM()&&(e?this.addAllPDOMDisplays():this.removeAllPDOMDisplays()),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onPDOMVisibilityChange(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onPDOMVisibilityChange n#${this.node.id} pdomVisible:${e}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),this.node.visible&&!this.node._rendererSummary.hasNoPDOM()&&(e?this.addAllPDOMDisplays():this.removeAllPDOMDisplays()),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onAddedRootedDisplay(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onAddedRootedDisplay n#${this.node.id}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),e._accessible&&this.canHavePDOMDisplays()&&this.addPDOMDisplays([e]),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}onRemovedRootedDisplay(e){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`onRemovedRootedDisplay n#${this.node.id}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),e._accessible&&this.canHavePDOMDisplays()&&this.removePDOMDisplays([e]),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}canHavePDOMDisplays(){return this.node.visible&&this.node.pdomVisible&&!this.node._rendererSummary.hasNoPDOM()}addAllPDOMDisplays(){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`addAllPDOMDisplays n#${this.node.id}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),assert&&assert(this.pdomDisplays.length===0,"Should be empty before adding everything"),assert&&assert(this.canHavePDOMDisplays(),"Should happen when we can store pdomDisplays");let e;const t=[];for(e=0;e<this.node._parents.length;e++)Array.prototype.push.apply(t,this.node._parents[e]._pdomDisplaysInfo.pdomDisplays);for(e=0;e<this.node._rootedDisplays.length;e++){const i=this.node._rootedDisplays[e];i._accessible&&t.push(i)}this.addPDOMDisplays(t),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}removeAllPDOMDisplays(){sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`removeAllPDOMDisplays n#${this.node.id}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),assert&&assert(!this.canHavePDOMDisplays(),"Should happen when we cannot store pdomDisplays"),this.removePDOMDisplays(this.pdomDisplays.slice()),assert&&assert(this.pdomDisplays.length===0,"Should be empty after removing everything"),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}addPDOMDisplays(e){if(sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`addPDOMDisplays n#${this.node.id} numDisplays:${e.length}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),assert&&assert(Array.isArray(e)),e.length!==0){Array.prototype.push.apply(this.pdomDisplays,e);for(let t=0;t<this.node._children.length;t++)this.node._children[t]._pdomDisplaysInfo.canHavePDOMDisplays()&&this.node._children[t]._pdomDisplaysInfo.addPDOMDisplays(e);this.node.pdomDisplaysEmitter.emit()}sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}removePDOMDisplays(e){if(sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.PDOMDisplaysInfo(`removePDOMDisplays n#${this.node.id} numDisplays:${e.length}`),sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.push(),assert&&assert(Array.isArray(e)),assert&&assert(this.pdomDisplays.length>=e.length,"there should be at least as many PDOMDisplays as Displays"),e.length!==0){let t;for(t=e.length-1;t>=0;t--){const i=this.pdomDisplays.lastIndexOf(e[t]);assert&&assert(i>=0),this.pdomDisplays.splice(t,1)}for(t=0;t<this.node._children.length;t++){const i=this.node._children[t];i._pdomDisplaysInfo.canHavePDOMDisplays()&&!i._isGettingRemovedFromParent&&i._pdomDisplaysInfo.removePDOMDisplays(e)}this.node.pdomDisplaysEmitter.emit()}sceneryLog&&sceneryLog.PDOMDisplaysInfo&&sceneryLog.pop()}}q.register("PDOMDisplaysInfo",ff);const sl=1e-9,kc=["preferredWidth","minimumWidth","localPreferredWidth","localMinimumWidth","widthSizable"],Ul=Ai(l=>{const e=_a("WidthSizable",kc,class extends l{constructor(...i){super(...i),this.preferredWidthProperty=new vt(null),this.minimumWidthProperty=new vt(null),this.localPreferredWidthProperty=new vt(null),this.localMinimumWidthProperty=new vt(null),this.isWidthResizableProperty=new vt(!0),this._preferredSizeChanging=!1,this._minimumSizeChanging=!1,this._preferredSizeChangeAttemptDuringLock=!1,this._minimumSizeChangeAttemptDuringLock=!1,this._updatePreferredWidthListener=this._updatePreferredWidth.bind(this),this._updateLocalPreferredWidthListener=this._updateLocalPreferredWidth.bind(this),this._updateMinimumWidthListener=this._updateMinimumWidth.bind(this),this._updateLocalMinimumWidthListener=this._updateLocalMinimumWidth.bind(this),this.preferredWidthProperty.lazyLink(this._updateLocalPreferredWidthListener),this.localPreferredWidthProperty.lazyLink(this._updatePreferredWidthListener),this.minimumWidthProperty.lazyLink(this._updateLocalMinimumWidthListener),this.localMinimumWidthProperty.lazyLink(this._updateMinimumWidthListener),this.transformEmitter.addListener(this._updateLocalPreferredWidthListener),this.transformEmitter.addListener(this._updateMinimumWidthListener)}get preferredWidth(){return assert&&assert(this.preferredWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.preferredWidthProperty.value}set preferredWidth(i){assert&&assert(this.preferredWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(i===null||typeof i=="number"&&isFinite(i)&&i>=0,"preferredWidth should be null or a non-negative finite number"),this.preferredWidthProperty.value=i}get localPreferredWidth(){return assert&&assert(this.localPreferredWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.localPreferredWidthProperty.value}set localPreferredWidth(i){assert&&assert(this.localPreferredWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(i===null||typeof i=="number"&&isFinite(i)&&i>=0,"localPreferredWidth should be null or a non-negative finite number"),this.localPreferredWidthProperty.value=i}get minimumWidth(){return assert&&assert(this.minimumWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.minimumWidthProperty.value}set minimumWidth(i){assert&&assert(this.minimumWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(i===null||typeof i=="number"&&isFinite(i)),this.minimumWidthProperty.value=i}get localMinimumWidth(){return assert&&assert(this.localMinimumWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.localMinimumWidthProperty.value}set localMinimumWidth(i){assert&&assert(this.localMinimumWidthProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(i===null||typeof i=="number"&&isFinite(i)),this.localMinimumWidthProperty.value=i}get widthSizable(){return assert&&assert(this.isWidthResizableProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.isWidthResizableProperty.value}set widthSizable(i){assert&&assert(this.isWidthResizableProperty,"WidthSizable options should be set from a later mutate() call instead of the super constructor"),this.isWidthResizableProperty.value=i}get extendsWidthSizable(){return!0}validateLocalPreferredWidth(){if(assert){const i=this.localWidth,n=this.localMinimumWidth===null?i:this.localMinimumWidth,r=this.localPreferredWidth===null?n:this.localPreferredWidth;assert(r===i||Math.abs(r-i)<1e-7)}}_calculateLocalPreferredWidth(){return this.matrix.isAligned()&&this.preferredWidth!==null?Math.abs(this.transform.inverseDeltaX(this.preferredWidth)):null}_onReentrantPreferredWidth(){this._updateLocalPreferredWidthListener()}_updateLocalPreferredWidth(){if(assert&&this.auditMaxDimensions(),this._preferredSizeChanging)this._preferredSizeChangeAttemptDuringLock=!0;else{this._preferredSizeChanging=!0;do{this._preferredSizeChangeAttemptDuringLock=!1;const i=this._calculateLocalPreferredWidth();(this.localPreferredWidthProperty.value===null||i===null||Math.abs(this.localPreferredWidthProperty.value-i)>sl)&&(this.localPreferredWidthProperty.value=i)}while(this._preferredSizeChangeAttemptDuringLock);this._preferredSizeChanging=!1}}_calculatePreferredWidth(){return this.matrix.isAligned()&&this.localPreferredWidth!==null?Math.abs(this.transform.transformDeltaX(this.localPreferredWidth)):null}_updatePreferredWidth(){if(this._preferredSizeChanging)this._preferredSizeChangeAttemptDuringLock=!0;else{this._preferredSizeChanging=!0,this._preferredSizeChangeAttemptDuringLock=!1;const i=this._calculatePreferredWidth();(this.preferredWidthProperty.value===null||i===null||Math.abs(this.preferredWidthProperty.value-i)>sl)&&(this.preferredWidthProperty.value=i),this._preferredSizeChanging=!1,this._preferredSizeChangeAttemptDuringLock&&this._onReentrantPreferredWidth()}}_calculateLocalMinimumWidth(){return this.matrix.isAligned()&&this.minimumWidth!==null?Math.abs(this.transform.inverseDeltaX(this.minimumWidth)):null}_onReentrantLocalMinimumWidth(){this._updateMinimumWidthListener()}_updateLocalMinimumWidth(){if(this._minimumSizeChanging)this._minimumSizeChangeAttemptDuringLock=!0;else{this._minimumSizeChanging=!0;const i=this._calculateLocalMinimumWidth();this._minimumSizeChangeAttemptDuringLock=!1,(this.localMinimumWidthProperty.value===null||i===null||Math.abs(this.localMinimumWidthProperty.value-i)>sl)&&(this.localMinimumWidthProperty.value=i),this._minimumSizeChanging=!1,this._minimumSizeChangeAttemptDuringLock&&this._onReentrantLocalMinimumWidth()}}_calculateMinimumWidth(){return this.matrix.isAligned()&&this.localMinimumWidth!==null?Math.abs(this.transform.transformDeltaX(this.localMinimumWidth)):null}_updateMinimumWidth(){if(this._minimumSizeChanging)this._minimumSizeChangeAttemptDuringLock=!0;else{this._minimumSizeChanging=!0;do{this._minimumSizeChangeAttemptDuringLock=!1;const i=this._calculateMinimumWidth();(this.minimumWidthProperty.value===null||i===null||Math.abs(this.minimumWidthProperty.value-i)>sl)&&(this.minimumWidthProperty.value=i)}while(this._minimumSizeChangeAttemptDuringLock);this._minimumSizeChanging=!1}}mutate(i){return super.mutate(i)}});if(e.prototype._mutatorKeys){const t=e.prototype._mutatorKeys,i=kc,n=t.indexOf(kn[0]);e.prototype._mutatorKeys=[...t.slice(0,n),...i,...t.slice(n)]}return e}),aa=l=>l.widthSizable,ep=l=>l.extendsWidthSizable;q.register("WidthSizable",Ul);const nl=1e-9,Ac=["preferredHeight","minimumHeight","localPreferredHeight","localMinimumHeight","heightSizable"],pu=Ai(l=>{const e=_a("HeightSizable",Ac,class extends l{constructor(...i){super(...i),this.preferredHeightProperty=new vt(null),this.minimumHeightProperty=new vt(null),this.localPreferredHeightProperty=new vt(null),this.localMinimumHeightProperty=new vt(null),this.isHeightResizableProperty=new vt(!0),this._preferredSizeChanging=!1,this._minimumSizeChanging=!1,this._preferredSizeChangeAttemptDuringLock=!1,this._minimumSizeChangeAttemptDuringLock=!1,this._updatePreferredHeightListener=this._updatePreferredHeight.bind(this),this._updateLocalPreferredHeightListener=this._updateLocalPreferredHeight.bind(this),this._updateMinimumHeightListener=this._updateMinimumHeight.bind(this),this._updateLocalMinimumHeightListener=this._updateLocalMinimumHeight.bind(this),this.preferredHeightProperty.lazyLink(this._updateLocalPreferredHeightListener),this.localPreferredHeightProperty.lazyLink(this._updatePreferredHeightListener),this.minimumHeightProperty.lazyLink(this._updateLocalMinimumHeightListener),this.localMinimumHeightProperty.lazyLink(this._updateMinimumHeightListener),this.transformEmitter.addListener(this._updateLocalPreferredHeightListener),this.transformEmitter.addListener(this._updateMinimumHeightListener)}get preferredHeight(){return assert&&assert(this.preferredHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.preferredHeightProperty.value}set preferredHeight(i){assert&&assert(this.preferredHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(i===null||typeof i=="number"&&isFinite(i)&&i>=0,"preferredHeight should be null or a non-negative finite number"),this.preferredHeightProperty.value=i}get localPreferredHeight(){return assert&&assert(this.localPreferredHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.localPreferredHeightProperty.value}set localPreferredHeight(i){assert&&assert(this.localPreferredHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(i===null||typeof i=="number"&&isFinite(i)&&i>=0,"localPreferredHeight should be null or a non-negative finite number"),this.localPreferredHeightProperty.value=i}get minimumHeight(){return assert&&assert(this.minimumHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.minimumHeightProperty.value}set minimumHeight(i){assert&&assert(this.minimumHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(i===null||typeof i=="number"&&isFinite(i)),this.minimumHeightProperty.value=i}get localMinimumHeight(){return assert&&assert(this.localMinimumHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.localMinimumHeightProperty.value}set localMinimumHeight(i){assert&&assert(this.localMinimumHeightProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),assert&&assert(i===null||typeof i=="number"&&isFinite(i)),this.localMinimumHeightProperty.value=i}get heightSizable(){return assert&&assert(this.isHeightResizableProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.isHeightResizableProperty.value}set heightSizable(i){assert&&assert(this.isHeightResizableProperty,"HeightSizable options should be set from a later mutate() call instead of the super constructor"),this.isHeightResizableProperty.value=i}get extendsHeightSizable(){return!0}validateLocalPreferredHeight(){if(assert){const i=this.localHeight,n=this.localMinimumHeight===null?i:this.localMinimumHeight,r=this.localPreferredHeight===null?n:this.localPreferredHeight;assert(r===i||Math.abs(r-i)<1e-7)}}_calculateLocalPreferredHeight(){return this.matrix.isAligned()&&this.preferredHeight!==null?Math.abs(this.transform.inverseDeltaY(this.preferredHeight)):null}_onReentrantPreferredHeight(){this._updateLocalPreferredHeightListener()}_updateLocalPreferredHeight(){if(assert&&this.auditMaxDimensions(),this._preferredSizeChanging)this._preferredSizeChangeAttemptDuringLock=!0;else{this._preferredSizeChanging=!0;do{this._preferredSizeChangeAttemptDuringLock=!1;const i=this._calculateLocalPreferredHeight();(this.localPreferredHeightProperty.value===null||i===null||Math.abs(this.localPreferredHeightProperty.value-i)>nl)&&(this.localPreferredHeightProperty.value=i)}while(this._preferredSizeChangeAttemptDuringLock);this._preferredSizeChanging=!1}}_calculatePreferredHeight(){return this.matrix.isAligned()&&this.localPreferredHeight!==null?Math.abs(this.transform.transformDeltaY(this.localPreferredHeight)):null}_updatePreferredHeight(){if(this._preferredSizeChanging)this._preferredSizeChangeAttemptDuringLock=!0;else{this._preferredSizeChanging=!0,this._preferredSizeChangeAttemptDuringLock=!1;const i=this._calculatePreferredHeight();(this.preferredHeightProperty.value===null||i===null||Math.abs(this.preferredHeightProperty.value-i)>nl)&&(this.preferredHeightProperty.value=i),this._preferredSizeChanging=!1,this._preferredSizeChangeAttemptDuringLock&&this._onReentrantPreferredHeight()}}_calculateLocalMinimumHeight(){return this.matrix.isAligned()&&this.minimumHeight!==null?Math.abs(this.transform.inverseDeltaY(this.minimumHeight)):null}_onReentrantLocalMinimumHeight(){this._updateMinimumHeight()}_updateLocalMinimumHeight(){if(this._minimumSizeChanging)this._minimumSizeChangeAttemptDuringLock=!0;else{this._minimumSizeChanging=!0,this._minimumSizeChangeAttemptDuringLock=!1;const i=this._calculateLocalMinimumHeight();(this.localMinimumHeightProperty.value===null||i===null||Math.abs(this.localMinimumHeightProperty.value-i)>nl)&&(this.localMinimumHeightProperty.value=i),this._minimumSizeChanging=!1,this._minimumSizeChangeAttemptDuringLock&&this._onReentrantLocalMinimumHeight()}}_calculateMinimumHeight(){return this.matrix.isAligned()&&this.localMinimumHeight!==null?Math.abs(this.transform.transformDeltaY(this.localMinimumHeight)):null}_updateMinimumHeight(){if(!this._minimumSizeChanging){this._minimumSizeChanging=!0;do{this._minimumSizeChangeAttemptDuringLock=!1;const i=this._calculateMinimumHeight();(this.minimumHeightProperty.value===null||i===null||Math.abs(this.minimumHeightProperty.value-i)>nl)&&(this.minimumHeightProperty.value=i)}while(this._minimumSizeChangeAttemptDuringLock);this._minimumSizeChanging=!1}}mutate(i){return super.mutate(i)}});if(e.prototype._mutatorKeys){const t=e.prototype._mutatorKeys,i=Ac,n=t.indexOf(kn[0]);e.prototype._mutatorKeys=[...t.slice(0,n),...i,...t.slice(n)]}return e}),oa=l=>l.heightSizable,tp=l=>l.extendsHeightSizable;q.register("HeightSizable",pu);const ip=["preferredSize","minimumSize","localPreferredSize","localMinimumSize","sizable"],mf=["preferredSize","minimumSize","localPreferredSize","localMinimumSize","sizable",...kc,...Ac],Yl=Ai(l=>{const e=_a("Sizable",ip,class extends Ul(pu(l)){constructor(...i){super(...i),this.preferredWidthProperty.lazyLink(this._updateLocalPreferredHeightListener),this.preferredHeightProperty.lazyLink(this._updateLocalPreferredWidthListener),this.localPreferredWidthProperty.lazyLink(this._updatePreferredHeightListener),this.localPreferredHeightProperty.lazyLink(this._updatePreferredWidthListener),this.minimumWidthProperty.lazyLink(this._updateLocalMinimumHeightListener),this.minimumHeightProperty.lazyLink(this._updateLocalMinimumWidthListener),this.localMinimumWidthProperty.lazyLink(this._updateMinimumHeightListener),this.localMinimumHeightProperty.lazyLink(this._updateMinimumWidthListener)}get preferredSize(){return assert&&assert(this.preferredWidth===null==(this.preferredHeight===null),"Cannot get a preferredSize when one of preferredWidth/preferredHeight is null"),this.preferredWidth===null||this.preferredHeight===null?null:new Zs(this.preferredWidth,this.preferredHeight)}set preferredSize(i){this.preferredWidth=i===null?null:i.width,this.preferredHeight=i===null?null:i.height}get localPreferredSize(){return assert&&assert(this.localPreferredWidth===null==(this.localPreferredHeight===null),"Cannot get a preferredSize when one of preferredWidth/preferredHeight is null"),this.localPreferredWidth===null||this.localPreferredHeight===null?null:new Zs(this.localPreferredWidth,this.localPreferredHeight)}set localPreferredSize(i){this.localPreferredWidth=i===null?null:i.width,this.localPreferredHeight=i===null?null:i.height}get minimumSize(){return assert&&assert(this.minimumWidth===null==(this.minimumHeight===null),"Cannot get a minimumSize when one of minimumWidth/minimumHeight is null"),this.minimumWidth===null||this.minimumHeight===null?null:new Zs(this.minimumWidth,this.minimumHeight)}set minimumSize(i){this.minimumWidth=i===null?null:i.width,this.minimumHeight=i===null?null:i.height}get localMinimumSize(){return assert&&assert(this.localMinimumWidth===null==(this.localMinimumHeight===null),"Cannot get a minimumSize when one of minimumWidth/minimumHeight is null"),this.localMinimumWidth===null||this.localMinimumHeight===null?null:new Zs(this.localMinimumWidth,this.localMinimumHeight)}set localMinimumSize(i){this.localMinimumWidth=i===null?null:i.width,this.localMinimumHeight=i===null?null:i.height}get sizable(){return assert&&assert(this.widthSizable===this.heightSizable,"widthSizable and heightSizable not the same, which is required for the sizable getter"),this.widthSizable}set sizable(i){this.widthSizable=i,this.heightSizable=i}get extendsSizable(){return!0}validateLocalPreferredSize(){assert&&(this.validateLocalPreferredWidth(),this.validateLocalPreferredHeight())}mutate(i){return Hi(i,["preferredSize"],["preferredWidth","preferredHeight"]),Hi(i,["localPreferredSize"],["localPreferredWidth","localPreferredHeight"]),Hi(i,["minimumSize"],["minimumWidth","minimumHeight"]),Hi(i,["localMinimumSize"],["localMinimumWidth","localMinimumHeight"]),Hi(i,["sizable"],["widthSizable","heightSizable"]),super.mutate(i)}_calculateLocalPreferredWidth(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.preferredWidth!==null)return Math.abs(this.transform.inverseDeltaX(this.preferredWidth))}else if(this.preferredHeight!==null)return Math.abs(this.transform.getInverse().m01()*this.preferredHeight)}return null}_calculateLocalPreferredHeight(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.preferredHeight!==null)return Math.abs(this.transform.inverseDeltaY(this.preferredHeight))}else if(this.preferredWidth!==null)return Math.abs(this.transform.getInverse().m10()*this.preferredWidth)}return null}_calculatePreferredWidth(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.localPreferredWidth!==null)return Math.abs(this.transform.transformDeltaX(this.localPreferredWidth))}else if(this.localPreferredHeight!==null)return Math.abs(this.transform.matrix.m01()*this.localPreferredHeight)}return null}_calculatePreferredHeight(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.localPreferredHeight!==null)return Math.abs(this.transform.transformDeltaY(this.localPreferredHeight))}else if(this.localPreferredWidth!==null)return Math.abs(this.transform.matrix.m10()*this.localPreferredWidth)}return null}_onReentrantLocalMinimumWidth(){this._updateMinimumWidthListener(),this._updateMinimumHeightListener()}_onReentrantLocalMinimumHeight(){this._updateMinimumWidthListener(),this._updateMinimumHeightListener()}_onReentrantPreferredWidth(){this._updateLocalPreferredWidthListener(),this._updateLocalPreferredHeightListener()}_onReentrantPreferredHeight(){this._updateLocalPreferredWidthListener(),this._updateLocalPreferredHeightListener()}_calculateLocalMinimumWidth(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.minimumWidth!==null)return Math.abs(this.transform.inverseDeltaX(this.minimumWidth))}else if(this.minimumHeight!==null)return Math.abs(this.transform.getInverse().m01()*this.minimumHeight)}return null}_calculateLocalMinimumHeight(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.minimumHeight!==null)return Math.abs(this.transform.inverseDeltaY(this.minimumHeight))}else if(this.minimumWidth!==null)return Math.abs(this.transform.getInverse().m10()*this.minimumWidth)}return null}_calculateMinimumWidth(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.localMinimumWidth!==null)return Math.abs(this.transform.transformDeltaX(this.localMinimumWidth))}else if(this.localMinimumHeight!==null)return Math.abs(this.transform.matrix.m01()*this.localMinimumHeight)}return null}_calculateMinimumHeight(){if(this.matrix.isAxisAligned()){if(this.matrix.isAligned()){if(this.localMinimumHeight!==null)return Math.abs(this.transform.transformDeltaY(this.localMinimumHeight))}else if(this.localMinimumWidth!==null)return Math.abs(this.transform.matrix.m10()*this.localMinimumWidth)}return null}});if(e.prototype._mutatorKeys){const t=e.prototype._mutatorKeys,i=ip,n=t.indexOf(kn[0]);e.prototype._mutatorKeys=[...t.slice(0,n),...i,...t.slice(n)]}return e});q.register("Sizable",Yl);const rl=dt.PDOM_UNIQUE_ID_SEPARATOR;class ht{constructor(e){if(assert&&(this.immutable=void 0),e instanceof ht){const t=e;this.nodes=t.nodes.slice(0),this.length=t.length,this.uniqueId=t.uniqueId,this.indices=t.indices.slice(0);return}if(this.nodes=[],this.length=0,this.uniqueId="",this.indices=[],e)if(e instanceof Ge){const t=e;this.addDescendant(t)}else{const t=e.length;for(let i=0;i<t;i++)this.addDescendant(e[i])}}copy(){return new ht(this)}isPainted(){return this.lastNode().isPainted()}isValid(){this.reindex();const e=this.indices.length;for(let t=0;t<e;t++)if(this.indices[t]<0)return!1;return!0}isVisible(){let e=this.nodes.length;for(;e--;)if(!this.nodes[e].isVisible())return!1;return!0}isPDOMVisible(){let e=this.nodes.length;for(;e--;)if(!this.nodes[e].isVisible()||!this.nodes[e].isPDOMVisible())return!1;return!0}getOpacity(){let e=1,t=this.nodes.length;for(;t--;)e*=this.nodes[t].getOpacity();return e}isPickable(){return _.some(this.nodes,e=>e.pickable===!1||!e.visible)?!1:!!_.some(this.nodes,e=>e._inputListeners.length>0||e.pickableProperty.value===!0)}get(e){return e>=0?this.nodes[e]:this.nodes[this.nodes.length+e]}slice(e,t){return new ht(this.nodes.slice(e,t))}subtrailTo(e,t=!1){return this.slice(0,_.indexOf(this.nodes,e)+(t?0:1))}isEmpty(){return this.nodes.length===0}getMatrixConcatenation(e,t){const i=$e.identity(),n=this.nodes;for(let r=e;r<t;r++)i.multiplyMatrix(n[r].getMatrix());return i}getMatrix(){return this.getMatrixConcatenation(0,this.nodes.length)}getAncestorMatrix(){return this.getMatrixConcatenation(1,this.nodes.length)}getParentMatrix(){return this.getMatrixConcatenation(0,this.nodes.length-1)}getAncestorParentMatrix(){return this.getMatrixConcatenation(1,this.nodes.length-1)}getTransform(){return new Fs(this.getMatrix())}getParentTransform(){return new Fs(this.getParentMatrix())}addAncestor(e,t){if(assert&&assert(!this.immutable,"cannot modify an immutable Trail with addAncestor"),assert&&assert(e,"cannot add falsy value to a Trail"),this.nodes.length){const i=this.nodes[0];this.indices.unshift(t===void 0?_.indexOf(e._children,i):t)}return this.nodes.unshift(e),this.length++,this.uniqueId=this.uniqueId?e.id+rl+this.uniqueId:`${e.id}`,this}removeAncestor(){return assert&&assert(!this.immutable,"cannot modify an immutable Trail with removeAncestor"),assert&&assert(this.length>0,"cannot remove a Node from an empty trail"),this.nodes.shift(),this.indices.length&&this.indices.shift(),this.length--,this.updateUniqueId(),this}addDescendant(e,t){if(assert&&assert(!this.immutable,"cannot modify an immutable Trail with addDescendant"),assert&&assert(e,"cannot add falsy value to a Trail"),this.nodes.length){const i=this.lastNode();this.indices.push(t===void 0?_.indexOf(i._children,e):t)}return this.nodes.push(e),this.length++,this.uniqueId=this.uniqueId?this.uniqueId+rl+e.id:`${e.id}`,this}removeDescendant(){return assert&&assert(!this.immutable,"cannot modify an immutable Trail with removeDescendant"),assert&&assert(this.length>0,"cannot remove a Node from an empty trail"),this.nodes.pop(),this.indices.length&&this.indices.pop(),this.length--,this.updateUniqueId(),this}addDescendantTrail(e){const t=e.length;t&&this.addDescendant(e.nodes[0]);for(let i=1;i<t;i++)this.addDescendant(e.nodes[i],this.indices[i-1])}removeDescendantTrail(e){const t=e.length;for(let i=t-1;i>=0;i--)assert&&assert(this.lastNode()===e.nodes[i]),this.removeDescendant()}reindex(){const e=this.length;for(let t=1;t<e;t++){const i=this.indices[t-1],n=this.nodes[t-1];n._children[i]!==this.nodes[t]&&(this.indices[t-1]=_.indexOf(n._children,this.nodes[t]))}}setImmutable(){return assert&&(assert(this.immutable!==!1,"A trail cannot be made immutable after being flagged as mutable"),this.immutable=!0),this}setMutable(){return assert&&(assert(this.immutable!==!0,"A trail cannot be made mutable after being flagged as immutable"),this.immutable=!1),this}areIndicesValid(){for(let e=1;e<this.length;e++){const t=this.indices[e-1];if(this.nodes[e-1]._children[t]!==this.nodes[e])return!1}return!0}equals(e){if(this.length!==e.length)return!1;for(let t=0;t<this.nodes.length;t++)if(this.nodes[t]!==e.nodes[t])return!1;return!0}upToNode(e){const t=_.indexOf(this.nodes,e);return assert&&assert(t>=0,"Trail does not contain the node"),this.slice(0,_.indexOf(this.nodes,e)+1)}isExtensionOf(e,t){if(this.length<=e.length-(t?1:0))return!1;for(let i=0;i<e.nodes.length;i++)if(this.nodes[i]!==e.nodes[i])return!1;return!0}containsNode(e){return _.includes(this.nodes,e)}getTransformTo(e){return new Fs(this.getMatrixTo(e))}getMatrixTo(e){this.reindex(),e.reindex();const t=this.getBranchIndexTo(e);let i,n=$e.IDENTITY;for(i=this.length-1;i>=t;i--)n=this.nodes[i].getMatrix().timesMatrix(n);for(i=t;i<e.length;i++)n=e.nodes[i].getTransform().getInverse().timesMatrix(n);return n}getBranchIndexTo(e){assert&&assert(this.nodes[0]===e.nodes[0],"To get a branch index, the trails must have the same root");let t;const i=Math.min(this.length,e.length);for(t=0;t<i&&this.nodes[t]===e.nodes[t];t++);return t}getLastInputEnabledIndex(){let e=-1;for(let t=0;t<this.length&&this.nodes[t].inputEnabled;t++)e=t;return e}getCursorCheckIndex(){return this.getLastInputEnabledIndex()}nodeFromTop(e){return this.nodes[this.length-1-e]}lastNode(){return this.nodeFromTop(0)}rootNode(){return this.nodes[0]}previous(){if(this.nodes.length<=1)return null;const e=this.nodeFromTop(0),t=this.nodeFromTop(1),i=_.indexOf(t._children,e);assert&&assert(i!==-1);const n=this.nodes.slice(0,this.nodes.length-1);if(i===0)return new ht(n);for(n.push(t._children[i-1]);n[n.length-1]._children.length!==0;){const r=n[n.length-1];n.push(r._children[r._children.length-1])}return new ht(n)}previousPainted(){let e=this.previous();for(;e&&!e.isPainted();)e=e.previous();return e}next(){const e=this.nodes.slice(0),t=this.nodeFromTop(0);if(t._children.length>0)return e.push(t._children[0]),new ht(e);{let i=this.nodes.length-1;for(;i>0;){const n=this.nodes[i],r=this.nodes[i-1];e.pop();const h=_.indexOf(r._children,n);if(h!==r._children.length-1)return e.push(r._children[h+1]),new ht(e);i--}return null}}nextPainted(){let e=this.next();for(;e&&!e.isPainted();)e=e.next();return e}eachTrailUnder(e){new hn(this,!0).eachTrailBetween(new hn(this,!1),e)}compare(e){assert&&assert(!this.isEmpty(),"cannot compare with an empty trail"),assert&&assert(!e.isEmpty(),"cannot compare with an empty trail"),assert&&assert(this.nodes[0]===e.nodes[0],"for Trail comparison, trails must have the same root node"),assertSlow&&assertSlow(this.areIndicesValid(),`Trail.compare this.areIndicesValid() failed on ${this.toString()}`),assertSlow&&assertSlow(e.areIndicesValid(),`Trail.compare other.areIndicesValid() failed on ${e.toString()}`);const t=Math.min(this.nodes.length,e.nodes.length);for(let i=0;i<t;i++)if(this.nodes[i]!==e.nodes[i])return this.nodes[i-1].children.indexOf(this.nodes[i])<e.nodes[i-1].children.indexOf(e.nodes[i])?-1:1;return this.nodes.length<e.nodes.length?-1:this.nodes.length>e.nodes.length?1:0}isBefore(e){return this.compare(e)===-1}isAfter(e){return this.compare(e)===1}localToGlobalPoint(e){return this.getMatrix().timesVector2(e)}localToGlobalBounds(e){return e.transformed(this.getMatrix())}globalToLocalPoint(e){return this.getTransform().inversePosition2(e)}globalToLocalBounds(e){return this.getTransform().inverseBounds2(e)}parentToGlobalPoint(e){return this.getParentMatrix().timesVector2(e)}parentToGlobalBounds(e){return e.transformed(this.getParentMatrix())}globalToParentPoint(e){return this.getParentTransform().inversePosition2(e)}globalToParentBounds(e){return this.getParentTransform().inverseBounds2(e)}updateUniqueId(){let e="";const t=this.nodes.length;t>0&&(e+=this.nodes[0]._id);for(let i=1;i<t;i++)e+=rl+this.nodes[i]._id;this.uniqueId=e}getUniqueId(){if(assert){const e=this.uniqueId;this.updateUniqueId(),assert(e===this.uniqueId)}return this.uniqueId}toString(){return this.reindex(),this.length?`[Trail ${this.indices.join(".")} ${this.getUniqueId()}]`:"Empty Trail"}toPathString(){return _.map(this.nodes,e=>{let t=e.constructor.name;return t==="Node"&&(t="."),t}).join("/")}toDebugString(){return`${this.toString()} ${this.toPathString()}`}static eachPaintedTrailBetween(e,t,i,n,r){ht.eachTrailBetween(e,t,h=>h.isPainted()?i(h):!1,n,r)}static eachTrailBetween(e,t,i,n,r){const h=e?new hn(e.copy(),!0):new hn(new ht(r),!0),p=t?new hn(t.copy(),!0):new hn(new ht(r),!1);n&&(h.nestedForwards(),p.nestedBackwards(),h.compareNested(p)===1)||h.depthFirstUntil(p,S=>S.isBefore?i(S.trail):!1,!1)}static branchIndex(e,t){assert&&assert(e.nodes[0]===t.nodes[0],"Branch changes require roots to be the same");let i;const n=Math.min(e.length,t.length);for(i=0;i<n&&e.nodes[i]===t.nodes[i];i++);return i}static sharedTrail(e,t){return e.slice(0,ht.branchIndex(e,t))}static appendAncestorTrailsWithPredicate(e,t,i){const n=t.rootNode();i(n)&&e.push(t.copy());const r=n._parents.length;for(let h=0;h<r;h++){const p=n._parents[h];t.addAncestor(p),ht.appendAncestorTrailsWithPredicate(e,t,i),t.removeAncestor()}}static appendDescendantTrailsWithPredicate(e,t,i){const n=t.lastNode();i(n)&&e.push(t.copy());const r=n._children.length;for(let h=0;h<r;h++){const p=n._children[h];t.addDescendant(p,h),ht.appendDescendantTrailsWithPredicate(e,t,i),t.removeDescendant()}}static spannedSubtrees(e,t){}static fromUniqueId(e,t){const n=t.split(rl).map(S=>Number(S));let r=e;const h=n.shift(),p=[r];for(assert&&assert(h===e.id);n.length>0;){const S=n.shift(),B=(r.pdomOrder||[]).concat(r.children);for(let U=0;U<B.length;U++){if(B[U]!==null&&B[U].id===S){const k=B[U];p.push(k),r=k;break}assert&&assert(U!==B.length-1,"unable to find node from unique Trail id")}}return new ht(p)}}q.register("Trail",ht);class hn{constructor(e,t){this.trail=e,this.setBefore(t)}isActive(){return!!this.trail}copy(){return assert&&assert(this.isActive()),new hn(this.trail.copy(),this.isBefore)}setBefore(e){this.isBefore=e,this.isAfter=!e}getRenderSwappedPointer(){assert&&assert(this.isActive());const e=this,t=this.isBefore?e.trail.previous():e.trail.next();return t===null?null:new hn(t,!this.isBefore)}getRenderBeforePointer(){return this.isBefore?this:this.getRenderSwappedPointer()}getRenderAfterPointer(){return this.isAfter?this:this.getRenderSwappedPointer()}compareRender(e){assert&&assert(e!==null);const t=this.getRenderBeforePointer(),i=e.getRenderBeforePointer();return t!==null&&i!==null?(assert&&assert(t.isActive()&&i.isActive()),t.trail.compare(i.trail)):t===i?0:t===null?1:-1}compareNested(e){assert&&assert(e),assert&&assert(this.isActive()&&e.isActive());const t=this,i=e,n=t.trail.compare(i.trail);return n===0?this.isBefore===e.isBefore?0:this.isBefore?-1:1:t.trail.isExtensionOf(i.trail)?e.isBefore?1:-1:i.trail.isExtensionOf(t.trail)?this.isBefore?-1:1:n}equalsRender(e){return this.compareRender(e)===0}equalsNested(e){return this.compareNested(e)===0}hasTrail(){return!!this.trail}nestedForwards(){assert&&assert(this.isActive());const e=this;if(this.isBefore){const t=e.trail.lastNode()._children;t.length>0?e.trail.addDescendant(t[0],0):this.setBefore(!1)}else{if(e.trail.indices.length===0)return this.trail=null,null;{const t=e.trail.indices[e.trail.indices.length-1];e.trail.removeDescendant();const i=e.trail.lastNode()._children;i.length>t+1&&(e.trail.addDescendant(i[t+1],t+1),this.setBefore(!0))}}return this}nestedBackwards(){assert&&assert(this.isActive());const e=this;if(this.isBefore){if(e.trail.indices.length===0)return this.trail=null,null;{const t=e.trail.indices[e.trail.indices.length-1];e.trail.removeDescendant(),t-1>=0&&(e.trail.addDescendant(e.trail.lastNode()._children[t-1],t-1),this.setBefore(!1))}}else if(e.trail.lastNode()._children.length>0){const t=e.trail.lastNode()._children;e.trail.addDescendant(t[t.length-1],t.length-1)}else this.setBefore(!0);return this}eachNodeBetween(e,t){this.eachTrailBetween(e,i=>t(i.lastNode()))}eachTrailBetween(e,t){this.isBefore&&(assert&&assert(this.isActive()),t(this.trail)),this.depthFirstUntil(e,i=>i.isBefore?t(i.trail):!1,!0)}depthFirstUntil(e,t,i){assert&&assert(this.isActive()&&e.isActive());const n=this,r=e;assert&&assert(this.compareNested(e)<=(i?-1:0),"TrailPointer.depthFirstUntil pointers out of order, possibly in both meanings of the phrase!"),assert&&assert(n.trail.rootNode()===r.trail.rootNode(),"TrailPointer.depthFirstUntil takes pointers with the same root"),n.trail.reindex(),r.trail.reindex();const h=this.copy();h.trail.setMutable();let p=!0;for(;!h.equalsNested(e);){assert&&assert(h.compareNested(e)!==1,"skipped in depthFirstUntil");let S=!1;if(p?(i||(S=t(h)),p=!1):S=t(h),S&&h.isBefore){if(h.setBefore(!1),h.compareNested(e)===1)break}else h.nestedForwards()}i||t(h)}toString(){return assert&&assert(this.isActive()),`[${this.isBefore?"before":"after"} ${this.trail.toString().slice(1)}`}static compareNested(e,t,i,n){const r=e.compare(i);return r===0?t===n?0:t?-1:1:e.isExtensionOf(i)?n?1:-1:i.isExtensionOf(e)?t?-1:1:r}}q.register("TrailPointer",hn);const Fb=(l,e)=>l.size===e.size&&_.every([...l],t=>e.has(t));class Oc extends vt{constructor(e){super(new Set),this.node=e,this.listenedNodeSet=new Set,this.updateEmitter=new zt,this.valueComparisonStrategy=Fb,this._nodeUpdateListener=this.update.bind(this),this.addNodeListener(e),this.update()}update(){const e=new Set;(function t(i){i.parents.forEach(r=>{e.add(r),t(r)})})(this.node),e.forEach(t=>{this.listenedNodeSet.has(t)||this.addNodeListener(t)}),this.listenedNodeSet.forEach(t=>{!e.has(t)&&t!==this.node&&this.removeNodeListener(t)}),this.value=e,this.updateEmitter.emit()}addNodeListener(e){this.listenedNodeSet.add(e),e.parentAddedEmitter.addListener(this._nodeUpdateListener),e.parentRemovedEmitter.addListener(this._nodeUpdateListener)}removeNodeListener(e){this.listenedNodeSet.delete(e),e.parentAddedEmitter.removeListener(this._nodeUpdateListener),e.parentRemovedEmitter.removeListener(this._nodeUpdateListener)}dispose(){this.listenedNodeSet.forEach(e=>this.removeNodeListener(e)),super.dispose()}}q.register("AncestorNodesProperty",Oc);class yf extends vt{constructor(e,t){super([]),this.listenedNodeSet=new Set,this.rootNode=e,this.leafNode=t,this._trailUpdateListener=this.update.bind(this),this.update()}update(){const e=[],t=new Set,i=new ht(this.leafNode),n=this.rootNode;(function p(){const S=i.rootNode();t.add(S),S===n&&e.push(i.copy()),S.parents.forEach(C=>{i.addAncestor(C),p(),i.removeAncestor()})})(),t.forEach(p=>{this.listenedNodeSet.has(p)||this.addNodeListener(p)}),this.listenedNodeSet.forEach(p=>{t.has(p)||this.removeNodeListener(p)});const r=this.value;let h=r.length===e.length;if(h){for(let p=0;p<e.length;p++)if(!r[p].equals(e[p])){h=!1;break}}h||(this.value=e)}addNodeListener(e){this.listenedNodeSet.add(e),e.parentAddedEmitter.addListener(this._trailUpdateListener),e.parentRemovedEmitter.addListener(this._trailUpdateListener)}removeNodeListener(e){this.listenedNodeSet.delete(e),e.parentAddedEmitter.removeListener(this._trailUpdateListener),e.parentRemovedEmitter.removeListener(this._trailUpdateListener)}dispose(){this.listenedNodeSet.forEach(e=>this.removeNodeListener(e)),super.dispose()}}q.register("TrailsBetweenProperty",yf);class Hb extends vt{constructor(e,t,i){const n=je()({fromCoordinateFrame:"local",toCoordinateFrame:"local"},i);super($e.IDENTITY),this.from=e,this.to=t,this.rootNode=null,this.fromTrail=null,this.toTrail=null,this.listenedNodeSet=new Set,this.fromCoordinateFrame=n.fromCoordinateFrame,this.toCoordinateFrame=n.toCoordinateFrame,this.valueComparisonStrategy="equalsFunction",this.fromAncestorsProperty=new Oc(e),this.toAncestorsProperty=new Oc(t);const r=this.update.bind(this);this._nodeTransformListener=this.updateMatrix.bind(this),this.fromAncestorsProperty.updateEmitter.addListener(r),this.toAncestorsProperty.updateEmitter.addListener(r),this.update()}update(){const e=[...this.fromAncestorsProperty.value,this.from],t=[...this.toAncestorsProperty.value,this.to],i=e.filter(p=>t.includes(p));let n=!1;const r=i.filter(p=>{const S=e.filter(ce=>p.hasChild(ce)),C=t.filter(ce=>p.hasChild(ce)),B=[],U=[];xr(S,C,B,U,[]);const Q=S.length>1||C.length>1,X=B.length||U.length;Q&&X&&(n=!0);const g=B.length>0||this.from===p,Z=U.length>0||this.to===p;return g&&Z});!n&&r.length===1?(this.rootNode=r[0],this.fromTrail=this.from.getUniqueTrailTo(this.rootNode),this.toTrail=this.to.getUniqueTrailTo(this.rootNode)):(this.rootNode=null,this.fromTrail=null,this.toTrail=null);const h=new Set;this.fromTrail&&this.fromTrail.nodes.forEach(p=>h.add(p)),this.toTrail&&this.toTrail.nodes.forEach(p=>h.add(p)),h.forEach(p=>{this.listenedNodeSet.has(p)||this.addNodeListener(p)}),this.listenedNodeSet.forEach(p=>{!h.has(p)&&p!==this.from&&p!==this.to&&this.removeNodeListener(p)}),this.updateMatrix()}updateMatrix(){if(this.rootNode&&this.fromTrail&&this.toTrail){const e=this.fromTrail.nodes.length===1,t=this.toTrail.nodes.length===1,i=e&&this.fromCoordinateFrame==="parent"||t&&this.toCoordinateFrame==="parent",n=this.fromTrail.getMatrixConcatenation(i?0:1,this.fromTrail.nodes.length-(this.fromCoordinateFrame==="parent"?1:0)),r=this.toTrail.getMatrixConcatenation(i?0:1,this.toTrail.nodes.length-(this.toCoordinateFrame==="parent"?1:0));this.value=r.inverted().timesMatrix(n)}else this.value=null}addNodeListener(e){this.listenedNodeSet.add(e),e.transformEmitter.addListener(this._nodeTransformListener)}removeNodeListener(e){this.listenedNodeSet.delete(e),e.transformEmitter.removeListener(this._nodeTransformListener)}dispose(){this.fromAncestorsProperty.dispose(),this.toAncestorsProperty.dispose(),super.dispose()}}q.register("MatrixBetweenProperty",Hb);const Vb=_i.safari5,bf=["fill","fillPickable","stroke","strokePickable","lineWidth","lineCap","lineJoin","miterLimit","lineDash","lineDashOffset","cachedPaints"],er={fill:null,fillPickable:!0,stroke:null,strokePickable:!1,lineWidth:Aa.lineWidth,lineCap:Aa.lineCap,lineJoin:Aa.lineJoin,lineDashOffset:Aa.lineDashOffset,miterLimit:Aa.miterLimit},vf=["fill","stroke","lineWidth","lineOptions","cachedPaints"],Kl=Ai(l=>(assert&&assert(_.includes(vs(l),Ge),"Only Node subtypes should mix Paintable"),class extends l{constructor(...t){super(...t),Ly(this,["_drawables"]),this._fill=er.fill,this._fillPickable=er.fillPickable,this._stroke=er.stroke,this._strokePickable=er.strokePickable,this._cachedPaints=[],this._lineDrawingStyles=new xd}setFill(t){return assert&&assert(xn.isPaintDef(t),"Invalid fill type"),assert&&typeof t=="string"&&Me.checkPaintString(t),this._fill!==t&&(this._fill=t,this.invalidateFill()),this}set fill(t){this.setFill(t)}get fill(){return this.getFill()}getFill(){return this._fill}hasFill(){return this.getFillValue()!==null}getFillValue(){const t=this.getFill();return it(t)?t.get():t}get fillValue(){return this.getFillValue()}setStroke(t){if(assert&&assert(xn.isPaintDef(t),"Invalid stroke type"),assert&&typeof t=="string"&&Me.checkPaintString(t),this._stroke!==t){if(this._stroke=t,assert&&t instanceof Bs&&t.transformMatrix){const i=t.transformMatrix.getScaleVector();assert(Math.abs(i.x-i.y)<1e-7,"You cannot specify a pattern or gradient to a stroke that does not have a symmetric scale.")}this.invalidateStroke()}return this}set stroke(t){this.setStroke(t)}get stroke(){return this.getStroke()}getStroke(){return this._stroke}hasStroke(){return this.getStrokeValue()!==null}hasPaintableStroke(){return this.hasStroke()&&this.getLineWidth()>0}getStrokeValue(){const t=this.getStroke();return it(t)?t.get():t}get strokeValue(){return this.getStrokeValue()}setFillPickable(t){return this._fillPickable!==t&&(this._fillPickable=t,this.invalidateFill()),this}set fillPickable(t){this.setFillPickable(t)}get fillPickable(){return this.isFillPickable()}isFillPickable(){return this._fillPickable}setStrokePickable(t){return this._strokePickable!==t&&(this._strokePickable=t,this.invalidateStroke()),this}set strokePickable(t){this.setStrokePickable(t)}get strokePickable(){return this.isStrokePickable()}isStrokePickable(){return this._strokePickable}setLineWidth(t){if(assert&&assert(t>=0,`lineWidth should be non-negative instead of ${t}`),this.getLineWidth()!==t){this._lineDrawingStyles.lineWidth=t,this.invalidateStroke();const i=this._drawables.length;for(let n=0;n<i;n++)this._drawables[n].markDirtyLineWidth()}return this}set lineWidth(t){this.setLineWidth(t)}get lineWidth(){return this.getLineWidth()}getLineWidth(){return this._lineDrawingStyles.lineWidth}setLineCap(t){if(assert&&assert(t==="butt"||t==="round"||t==="square",`lineCap should be one of "butt", "round" or "square", not ${t}`),this._lineDrawingStyles.lineCap!==t){this._lineDrawingStyles.lineCap=t,this.invalidateStroke();const i=this._drawables.length;for(let n=0;n<i;n++)this._drawables[n].markDirtyLineOptions()}return this}set lineCap(t){this.setLineCap(t)}get lineCap(){return this.getLineCap()}getLineCap(){return this._lineDrawingStyles.lineCap}setLineJoin(t){if(assert&&assert(t==="miter"||t==="round"||t==="bevel",`lineJoin should be one of "miter", "round" or "bevel", not ${t}`),this._lineDrawingStyles.lineJoin!==t){this._lineDrawingStyles.lineJoin=t,this.invalidateStroke();const i=this._drawables.length;for(let n=0;n<i;n++)this._drawables[n].markDirtyLineOptions()}return this}set lineJoin(t){this.setLineJoin(t)}get lineJoin(){return this.getLineJoin()}getLineJoin(){return this._lineDrawingStyles.lineJoin}setMiterLimit(t){if(assert&&assert(isFinite(t),"miterLimit should be a finite number"),this._lineDrawingStyles.miterLimit!==t){this._lineDrawingStyles.miterLimit=t,this.invalidateStroke();const i=this._drawables.length;for(let n=0;n<i;n++)this._drawables[n].markDirtyLineOptions()}return this}set miterLimit(t){this.setMiterLimit(t)}get miterLimit(){return this.getMiterLimit()}getMiterLimit(){return this._lineDrawingStyles.miterLimit}setLineDash(t){if(assert&&assert(Array.isArray(t)&&t.every(i=>typeof i=="number"&&isFinite(i)&&i>=0),"lineDash should be an array of finite non-negative numbers"),this._lineDrawingStyles.lineDash!==t){this._lineDrawingStyles.lineDash=t||[],this.invalidateStroke();const i=this._drawables.length;for(let n=0;n<i;n++)this._drawables[n].markDirtyLineOptions()}return this}set lineDash(t){this.setLineDash(t)}get lineDash(){return this.getLineDash()}getLineDash(){return this._lineDrawingStyles.lineDash}hasLineDash(){return!!this._lineDrawingStyles.lineDash.length}setLineDashOffset(t){if(assert&&assert(isFinite(t),`lineDashOffset should be a number, not ${t}`),this._lineDrawingStyles.lineDashOffset!==t){this._lineDrawingStyles.lineDashOffset=t,this.invalidateStroke();const i=this._drawables.length;for(let n=0;n<i;n++)this._drawables[n].markDirtyLineOptions()}return this}set lineDashOffset(t){this.setLineDashOffset(t)}get lineDashOffset(){return this.getLineDashOffset()}getLineDashOffset(){return this._lineDrawingStyles.lineDashOffset}setLineStyles(t){return this._lineDrawingStyles=t,this.invalidateStroke(),this}set lineStyles(t){this.setLineStyles(t)}get lineStyles(){return this.getLineStyles()}getLineStyles(){return this._lineDrawingStyles}setCachedPaints(t){this._cachedPaints=t.filter(n=>n instanceof Bs);const i=this._drawables.length;for(let n=0;n<i;n++)this._drawables[n].markDirtyCachedPaints();return this}set cachedPaints(t){this.setCachedPaints(t)}get cachedPaints(){return this.getCachedPaints()}getCachedPaints(){return this._cachedPaints}addCachedPaint(t){if(t instanceof Bs){this._cachedPaints.push(t);const i=this._drawables.length;for(let n=0;n<i;n++)this._drawables[n].markDirtyCachedPaints()}}removeCachedPaint(t){if(t instanceof Bs){assert&&assert(_.includes(this._cachedPaints,t)),Vs(this._cachedPaints,t);const i=this._drawables.length;for(let n=0;n<i;n++)this._drawables[n].markDirtyCachedPaints()}}beforeCanvasFill(t){assert&&assert(this.getFillValue()!==null);const i=this.getFillValue();t.setFillStyle(i),i.transformMatrix&&(t.context.save(),i.transformMatrix.canvasAppendTransform(t.context))}afterCanvasFill(t){this.getFillValue().transformMatrix&&t.context.restore()}beforeCanvasStroke(t){const i=this.getStrokeValue();if(t.setStrokeStyle(this._stroke),t.setLineCap(this.getLineCap()),t.setLineJoin(this.getLineJoin()),i.transformMatrix){const n=i.transformMatrix.getScaleVector();assert&&assert(Math.abs(n.x-n.y)<1e-7,"You cannot specify a pattern or gradient to a stroke that does not have a symmetric scale.");const r=1/n.x;t.context.save(),i.transformMatrix.canvasAppendTransform(t.context),t.setLineWidth(this.getLineWidth()*r),t.setMiterLimit(this.getMiterLimit()*r),t.setLineDash(this.getLineDash().map(h=>h*r)),t.setLineDashOffset(this.getLineDashOffset()*r)}else t.setLineWidth(this.getLineWidth()),t.setMiterLimit(this.getMiterLimit()),t.setLineDash(this.getLineDash()),t.setLineDashOffset(this.getLineDashOffset())}afterCanvasStroke(t){this.getStrokeValue().transformMatrix&&t.context.restore()}getCSSFill(){const t=this.getFillValue();return t?t.toCSS?t.toCSS():t:"transparent"}getSimpleCSSStroke(){const t=this.getStrokeValue();return t?t.toCSS?t.toCSS():t:"transparent"}appendFillablePropString(t,i){return this._fill&&(i&&(i+=`,
`),typeof this.getFillValue()=="string"?i+=`${t}fill: '${this.getFillValue()}'`:i+=`${t}fill: ${this.getFillValue()}`),i}appendStrokablePropString(t,i){function n(r,h,p){i&&(i+=`,
`),!p&&typeof h=="string"?i+=`${t+r}: '${h}'`:i+=`${t+r}: ${h}`}if(this._stroke){const r=new xd,h=this.getStrokeValue();typeof h=="string"?n("stroke",h):n("stroke",h?h.toString():"null",!0),_.each(["lineWidth","lineCap","miterLimit","lineJoin","lineDashOffset"],p=>{this[p]!==r[p]&&n(p,this[p])}),this.lineDash.length&&n("lineDash",JSON.stringify(this.lineDash),!0)}return i}getFillRendererBitmask(){let t=0;return Vb&&this._fill instanceof ls||(t|=ne.bitmaskSVG),t|=ne.bitmaskCanvas,this.hasFill()&&(this._fill instanceof or||this._fill instanceof ls)||(t|=ne.bitmaskDOM,t|=ne.bitmaskWebGL),t}getStrokeRendererBitmask(){let t=0;return t|=ne.bitmaskCanvas,t|=ne.bitmaskSVG,this.hasStroke()||(t|=ne.bitmaskDOM,t|=ne.bitmaskWebGL),t}invalidateFill(){this.invalidateSupportedRenderers();const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyFill()}invalidateStroke(){this.invalidateSupportedRenderers();const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyStroke()}}));q.register("Paintable",Kl);Kl.DEFAULT_OPTIONS=er;const Gb=Math.log2||function(l){return Math.log(l)/Math.LN2},Sn={imageOpacity:1,initialWidth:0,initialHeight:0,mipmap:!1,mipmapBias:0,mipmapInitialLevel:4,mipmapMaxLevel:5,hitTestPixels:!1};let Fh=null,Hh=null;const _f=()=>(Fh||(Fh=document.createElement("canvas")),Fh),zb=()=>(Hh||(Hh=_f().getContext("2d",{willReadFrequently:!0})),Hh),Gs=l=>class extends l{constructor(...t){super(...t),this._imageProperty=new dn(null,!1,this.onImagePropertyChange.bind(this)),this._image=null,this._initialWidth=Sn.initialWidth,this._initialHeight=Sn.initialHeight,this._imageOpacity=Sn.imageOpacity,this._mipmap=Sn.mipmap,this._mipmapBias=Sn.mipmapBias,this._mipmapInitialLevel=Sn.mipmapInitialLevel,this._mipmapMaxLevel=Sn.mipmapMaxLevel,this._hitTestPixels=Sn.hitTestPixels,this._mipmapCanvases=[],this._mipmapURLs=[],this._mipmapData=null,this._imageLoadListener=this._onImageLoad.bind(this),this._imageLoadListenerAttached=!1,this._hitTestImageData=null,this.mipmapEmitter=new zt}setImage(t){return assert&&assert(t,"image should be available"),this._imageProperty.value=t,this}set image(t){this.setImage(t)}get image(){return this.getImage()}getImage(){return assert&&assert(this._image!==null),this._image}onImagePropertyChange(t){assert&&assert(t,"image should be available");let i=this._image!==t;if(i&&typeof t=="string"&&this._image&&this._image instanceof HTMLImageElement&&t===this._image.src&&(i=!1),i&&t===this._mipmapData&&(i=!1),i){if(this._initialWidth=0,this._initialHeight=0,this._image&&this._imageLoadListenerAttached&&this._detachImageLoadListener(),this._mipmapData=null,typeof t=="string"){const n=t;t=document.createElement("img"),t.src=n}else Array.isArray(t)&&(this._mipmapData=t,t=t[0].img,this._mipmapInitialLevel=this._mipmapMaxLevel=this._mipmapData.length,this._mipmap=!0);this._image=t,this._image instanceof HTMLImageElement&&(!this._image.width||!this._image.height)&&this._attachImageLoadListener(),this.invalidateImage()}}setImageProperty(t){return this._imageProperty.setTargetProperty(t)}set imageProperty(t){this.setImageProperty(t)}get imageProperty(){return this.getImageProperty()}getImageProperty(){return this._imageProperty}invalidateImage(){this.invalidateMipmaps(),this._invalidateHitTestData()}setImageWithSize(t,i,n){return this.setImage(t),this.setInitialWidth(i),this.setInitialHeight(n),this}setImageOpacity(t){assert&&assert(isFinite(t)&&t>=0&&t<=1,`imageOpacity out of range: ${t}`),this._imageOpacity!==t&&(this._imageOpacity=t)}set imageOpacity(t){this.setImageOpacity(t)}get imageOpacity(){return this.getImageOpacity()}getImageOpacity(){return this._imageOpacity}setInitialWidth(t){return assert&&assert(t>=0&&t%1===0,"initialWidth should be a non-negative integer"),t!==this._initialWidth&&(this._initialWidth=t,this.invalidateImage()),this}set initialWidth(t){this.setInitialWidth(t)}get initialWidth(){return this.getInitialWidth()}getInitialWidth(){return this._initialWidth}setInitialHeight(t){return assert&&assert(t>=0&&t%1===0,"initialHeight should be a non-negative integer"),t!==this._initialHeight&&(this._initialHeight=t,this.invalidateImage()),this}set initialHeight(t){this.setInitialHeight(t)}get initialHeight(){return this.getInitialHeight()}getInitialHeight(){return this._initialHeight}setMipmap(t){return this._mipmap!==t&&(this._mipmap=t,this.invalidateMipmaps()),this}set mipmap(t){this.setMipmap(t)}get mipmap(){return this.isMipmap()}isMipmap(){return this._mipmap}setMipmapBias(t){return this._mipmapBias!==t&&(this._mipmapBias=t,this.invalidateMipmaps()),this}set mipmapBias(t){this.setMipmapBias(t)}get mipmapBias(){return this.getMipmapBias()}getMipmapBias(){return this._mipmapBias}setMipmapInitialLevel(t){return assert&&assert(t%1===0&&t>=0,"mipmapInitialLevel should be a non-negative integer"),this._mipmapInitialLevel!==t&&(this._mipmapInitialLevel=t,this.invalidateMipmaps()),this}set mipmapInitialLevel(t){this.setMipmapInitialLevel(t)}get mipmapInitialLevel(){return this.getMipmapInitialLevel()}getMipmapInitialLevel(){return this._mipmapInitialLevel}setMipmapMaxLevel(t){return assert&&assert(t%1===0&&t>=0,"mipmapMaxLevel should be a non-negative integer"),this._mipmapMaxLevel!==t&&(this._mipmapMaxLevel=t,this.invalidateMipmaps()),this}set mipmapMaxLevel(t){this.setMipmapMaxLevel(t)}get mipmapMaxLevel(){return this.getMipmapMaxLevel()}getMipmapMaxLevel(){return this._mipmapMaxLevel}setHitTestPixels(t){return this._hitTestPixels!==t&&(this._hitTestPixels=t,this._invalidateHitTestData()),this}set hitTestPixels(t){this.setHitTestPixels(t)}get hitTestPixels(){return this.getHitTestPixels()}getHitTestPixels(){return this._hitTestPixels}_constructNextMipmap(){const t=this._mipmapCanvases.length,i=this._mipmapCanvases[t-1];if(i.width*i.height>2){const n=document.createElement("canvas");if(n.width=Math.ceil(i.width/2),n.height=Math.ceil(i.height/2),n.width>0&&n.height>0){const r=n.getContext("2d");r.scale(.5,.5),r.drawImage(i,0,0),this._mipmapCanvases.push(n),this._mipmapURLs.push(n.toDataURL())}}}invalidateMipmaps(){if(Bt(this._mipmapCanvases),Bt(this._mipmapURLs),this._image&&this._mipmap)if(this._mipmapData)for(let t=0;t<this._mipmapData.length;t++){const i=this._mipmapData[t].url;this._mipmapURLs.push(i);const n=this._mipmapData[t].updateCanvas;n&&n(),this._mipmapCanvases.push(this._mipmapData[t].canvas)}else{const t=document.createElement("canvas");if(t.width=this.getImageWidth(),t.height=this.getImageHeight(),t.width&&t.height){t.getContext("2d").drawImage(this._image,0,0),this._mipmapCanvases.push(t),this._mipmapURLs.push(t.toDataURL());let n=0;for(;++n<this._mipmapInitialLevel;)this._constructNextMipmap()}}this.mipmapEmitter.emit()}getMipmapLevel(t,i=0){assert&&assert(this._mipmap,"Assumes mipmaps can be used");const n=Gs.getApproximateMatrixScale(t)*(self.devicePixelRatio||1);return this.getMipmapLevelFromScale(n,i)}getMipmapLevelFromScale(t,i=0){if(assert&&assert(t>0,"scale should be a positive number"),t>=1)return 0;let n=Gb(1/t);if(n=Ui.roundSymmetric(n+this._mipmapBias+i-.7),n<0&&(n=0),n>this._mipmapMaxLevel&&(n=this._mipmapMaxLevel),this.mipmap&&!this._mipmapCanvases[n]){let r=this._mipmapCanvases.length-1;for(;++r<=n;)this._constructNextMipmap();return Math.min(n,this._mipmapCanvases.length-1)}else return n}getMipmapCanvas(t){if(assert&&assert(t>=0&&t<this._mipmapCanvases.length&&t%1===0),this._mipmapData){const i=this._mipmapData[t]&&this._mipmapData[t].updateCanvas;i&&i()}return this._mipmapCanvases[t]}getMipmapURL(t){return assert&&assert(t>=0&&t<this._mipmapCanvases.length&&t%1===0),this._mipmapURLs[t]}hasMipmaps(){return this._mipmapCanvases.length>0}_invalidateHitTestData(){this._hitTestPixels&&this._image!==null&&(this._hitTestImageData=Gs.getHitTestData(this._image,this.imageWidth,this.imageHeight))}getImageWidth(){if(this._image===null)return 0;const t=this._mipmapData?this._mipmapData[0].width:("naturalWidth"in this._image?this._image.naturalWidth:0)||this._image.width;return t===0?this._initialWidth:(assert&&assert(this._initialWidth===0||this._initialWidth===t,"Bad Image.initialWidth"),t)}get imageWidth(){return this.getImageWidth()}getImageHeight(){if(this._image===null)return 0;const t=this._mipmapData?this._mipmapData[0].height:("naturalHeight"in this._image?this._image.naturalHeight:0)||this._image.height;return t===0?this._initialHeight:(assert&&assert(this._initialHeight===0||this._initialHeight===t,"Bad Image.initialHeight"),t)}get imageHeight(){return this.getImageHeight()}getImageURL(){return assert&&assert(this._image instanceof HTMLImageElement,"Only supported for HTML image elements"),this._image.src}_attachImageLoadListener(){assert&&assert(!this._imageLoadListenerAttached,"Should only be attached to one thing at a time"),this.isDisposed||(this._image.addEventListener("load",this._imageLoadListener),this._imageLoadListenerAttached=!0)}_detachImageLoadListener(){assert&&assert(this._imageLoadListenerAttached,"Needs to be attached first to be detached."),this._image.removeEventListener("load",this._imageLoadListener),this._imageLoadListenerAttached=!1}_onImageLoad(){assert&&assert(this._imageLoadListenerAttached,"If _onImageLoad is firing, it should be attached"),this.invalidateImage(),this._detachImageLoadListener()}dispose(){this._image&&this._imageLoadListenerAttached&&this._detachImageLoadListener(),this._imageProperty.dispose(),super.dispose&&super.dispose()}};Gs.getHitTestData=(l,e,t)=>{if(!("naturalWidth"in l&&l.naturalWidth||l.width)||!("naturalHeight"in l&&l.naturalHeight||l.height))return null;const i=_f(),n=zb();return i.width=e,i.height=t,n.drawImage(l,0,0),n.getImageData(0,0,e,t)};Gs.testHitTestData=(l,e,t,i)=>{const n=Ui.clamp(Math.floor(i.x/e*l.width),0,l.width-1),r=Ui.clamp(Math.floor(i.y/t*l.height),0,l.height-1),h=4*(n+r*l.width)+3;return l.data[h]!==0};Gs.hitTestDataToShape=(l,e,t)=>{const i=e/l.width,n=t/l.height,r=new yt;let h=!1,p=0;for(let S=0;S<l.height;S++){for(let C=0;C<l.width;C++){const B=4*(C+S*l.width)+3;l.data[B]!==0?h||(h=!0,p=C):h&&(h=!1,r.rect(p*i,S*i,i*(C-p),n))}h&&(h=!1,r.rect(p*i,S*i,i*(l.width-p),n))}return r.getSimplifiedAreaShape()};Gs.createSVGImage=(l,e,t)=>{assert&&assert(isFinite(e)&&e>=0&&e%1===0,"width should be a non-negative finite integer"),assert&&assert(isFinite(t)&&t>=0&&t%1===0,"height should be a non-negative finite integer");const i=document.createElementNS(Gt,"image");return i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`),i.setAttributeNS(ia,"xlink:href",l),i};Gs.createFastMipmapFromCanvas=l=>{const e=[],t=l.toDataURL(),i=new self.Image;i.src=t,e.push({img:i,url:t,width:l.width,height:l.height,canvas:l});let n=l;for(;n.width>=2&&n.height>=2;){const r=document.createElement("canvas");r.width=Math.ceil(n.width/2),r.height=Math.ceil(n.height/2);const h=r.getContext("2d");h.setTransform(.5,0,0,.5,0,0),h.drawImage(n,0,0);const p={width:r.width,height:r.height,canvas:r,url:r.toDataURL(),img:new self.Image};p.img.src=p.url,n=r,e.push(p)}return e};Gs.getApproximateMatrixScale=l=>(Math.sqrt(l.m00()*l.m00()+l.m10()*l.m10())+Math.sqrt(l.m01()*l.m01()+l.m11()*l.m11()))/2;Gs.CANVAS_MIPMAP_BIAS_ADJUSTMENT=.5;Gs.DEFAULT_OPTIONS=Sn;q.register("Imageable",Gs);const ms=Gs,Lf=(l,e,t)=>{const i=`_${l}PendingOptions`,n=`_${l}IsConstructed`;return class extends t{constructor(...h){super(...h),this[n]=!0,this.mutate(this[i]),this[i]=void 0}mutate(h){return h&&!this[n]&&(this[i]=ii(this[i]||{},_.pick(h,e)),h=_.omit(h,e)),super.mutate(h)}}};q.register("DelayedMutate",Lf);const _a=Lf,Wb=["image","imageProperty","imageOpacity","imageBounds","initialWidth","initialHeight","mipmap","mipmapBias","mipmapInitialLevel","mipmapMaxLevel","hitTestPixels"],ld=class ld extends ms(Ge){constructor(e,t){const i={};it(e)?i.imageProperty=e:i.image=e;const n=je()(i,t);super(),this._imageBounds=null,this.mutate(n),this.invalidateSupportedRenderers()}invalidateImage(){this._image?this.invalidateSelf(this._imageBounds||new Be(0,0,this.getImageWidth(),this.getImageHeight())):this.invalidateSelf(Be.NOTHING);const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirtyImage();super.invalidateImage(),this.invalidateSupportedRenderers()}invalidateSupportedRenderers(){let e=ne.bitmaskCanvas;this.getImageWidth()<=ar.MAX_DIMENSION.width&&this.getImageHeight()<=ar.MAX_DIMENSION.height&&(e|=ne.bitmaskWebGL),this._image instanceof HTMLCanvasElement||(e|=ne.bitmaskSVG|ne.bitmaskDOM),this.setRendererBitmask(e)}setImageOpacity(e){const t=this._imageOpacity!==e;if(super.setImageOpacity(e),t){const i=this._drawables.length;for(let n=0;n<i;n++)this._drawables[n].markDirtyImageOpacity()}}setImageBounds(e){this._imageBounds!==e&&(this._imageBounds=e,this.invalidateImage())}set imageBounds(e){this.setImageBounds(e)}get imageBounds(){return this._imageBounds}getImageBounds(){return this._imageBounds}isPainted(){return!0}canvasPaintSelf(e,t){eg.prototype.paintCanvas(e,this,t)}createDOMDrawable(e,t){return _L.createFromPool(e,t)}createSVGDrawable(e,t){return PL.createFromPool(e,t)}createCanvasDrawable(e,t){return eg.createFromPool(e,t)}createWebGLDrawable(e,t){return SL.createFromPool(e,t)}containsPointSelf(e){const t=Ge.prototype.containsPointSelf.call(this,e);return!t||!this._hitTestPixels||!this._hitTestImageData?t:ms.testHitTestData(this._hitTestImageData,this.imageWidth,this.imageHeight,e)}getSelfShape(){return this._hitTestPixels&&this._hitTestImageData?ms.hitTestDataToShape(this._hitTestImageData,this.imageWidth,this.imageHeight):Ge.prototype.getSelfShape.call(this)}invalidateMipmaps(){const e=this._image&&this._mipmap&&!this._mipmapData;if(super.invalidateMipmaps(),e){const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyMipmap()}}mutate(e){return super.mutate(e)}};ld.DEFAULT_IMAGE_OPTIONS=ii({},Ge.DEFAULT_NODE_OPTIONS,ms.DEFAULT_OPTIONS);let qi=ld;qi.prototype._mutatorKeys=[...Wb,...Ge.prototype._mutatorKeys];qi.prototype.drawableMarkFlags=[...Ge.prototype.drawableMarkFlags,"image","imageOpacity","mipmap"];qi.ImageIO=new li("ImageIO",{valueType:qi,supertype:Ge.NodeIO,events:["changed"],methods:{setImage:{returnType:Ds,parameterTypes:[si],implementation:function(l){const e=new self.Image;e.src=l,this.image=e},documentation:"Set the image from a base64 string",invocableForReadOnlyElements:!1}}});q.register("Image",qi);const $b=["boundsMethod","shape","shapeProperty"],al={shape:null,boundsMethod:"accurate"},hd=class hd extends Kl(Ge){constructor(e,t){assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell"),(e||t!=null&&t.shape)&&assert&&assert(!e||!(t!=null&&t.shape),"Do not define shape twice. Check constructor and providedOptions.");const i={boundsMethod:al.boundsMethod};it(e)?i.shapeProperty=e:i.shape=e;const n=je()(i,t);super(),this._shapeProperty=new dn(null,!1,this.onShapePropertyChange.bind(this)),this._shape=al.shape,this._strokedShape=null,this._boundsMethod=al.boundsMethod,this._invalidShapeListener=this.invalidateShape.bind(this),this._invalidShapeListenerAttached=!1,this.invalidateSupportedRenderers(),this.mutate(n)}setShape(e){return assert&&assert(e===null||typeof e=="string"||e instanceof yt,"A path's shape should either be null, a string, or a Shape"),this._shapeProperty.value=e,this}set shape(e){this.setShape(e)}get shape(){return this.getShape()}getShape(){return this._shape}onShapePropertyChange(e){assert&&assert(e===null||typeof e=="string"||e instanceof yt,"A path's shape should either be null, a string, or a Shape"),this._shape!==e&&(this._invalidShapeListenerAttached&&this.detachShapeListener(),typeof e=="string"&&(e=new yt(e)),this._shape=e,this.invalidateShape(),this._shape&&!this._shape.isImmutable()&&this.attachShapeListener())}setShapeProperty(e){return this._shapeProperty.setTargetProperty(e)}set shapeProperty(e){this.setShapeProperty(e)}get shapeProperty(){return this.getShapeProperty()}getShapeProperty(){return this._shapeProperty}getStrokedShape(){return assert&&assert(this.hasShape(),"We cannot stroke a non-existing shape"),this._strokedShape||(this._strokedShape=this.getShape().getStrokedShape(this._lineDrawingStyles)),this._strokedShape}getPathRendererBitmask(){return ne.bitmaskCanvas|ne.bitmaskSVG}invalidateSupportedRenderers(){this.setRendererBitmask(this.getFillRendererBitmask()&this.getStrokeRendererBitmask()&this.getPathRendererBitmask())}invalidateShape(){this.invalidatePath();const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirtyShape();this._invalidShapeListenerAttached&&this._shape&&this._shape.isImmutable()&&this.detachShapeListener()}invalidatePath(){this._strokedShape=null,this.invalidateSelf()}attachShapeListener(){assert&&assert(!this._invalidShapeListenerAttached,"We do not want to have two listeners attached!"),this.isDisposed||(this._shape.invalidatedEmitter.addListener(this._invalidShapeListener),this._invalidShapeListenerAttached=!0)}detachShapeListener(){assert&&assert(this._invalidShapeListenerAttached,"We cannot detach an unattached listener"),this._shape.invalidatedEmitter.removeListener(this._invalidShapeListener),this._invalidShapeListenerAttached=!1}updateSelfBounds(){const e=this.hasShape()?this.computeShapeBounds():Be.NOTHING,t=!e.equals(this.selfBoundsProperty._value);return t&&this.selfBoundsProperty._value.set(e),t}setBoundsMethod(e){return assert&&assert(e==="accurate"||e==="unstroked"||e==="tightPadding"||e==="safePadding"||e==="none"),this._boundsMethod!==e&&(this._boundsMethod=e,this.invalidatePath(),this.rendererSummaryRefreshEmitter.emit()),this}set boundsMethod(e){this.setBoundsMethod(e)}get boundsMethod(){return this.getBoundsMethod()}getBoundsMethod(){return this._boundsMethod}computeShapeBounds(){const e=this.getShape();if(this._boundsMethod==="none"||!e)return Be.NOTHING;if(!this.hasPaintableStroke()||this._boundsMethod==="unstroked")return e.bounds;if(this._boundsMethod==="accurate")return e.getStrokedBounds(this.getLineStyles());{let t;return this._boundsMethod==="safePadding"&&this.getLineJoin()==="miter"?t=this.getMiterLimit():this.getLineCap()==="square"?t=Math.SQRT2:t=1,e.bounds.dilated(t*this.getLineWidth()/2)}}areSelfBoundsValid(){return this._boundsMethod==="accurate"||this._boundsMethod==="safePadding"?!0:this._boundsMethod==="none"?!1:!this.hasStroke()}getTransformedSelfBounds(e){return assert&&assert(this.hasShape()),(this._stroke?this.getStrokedShape():this.getShape()).getBoundsWithTransform(e)}getTransformedSafeSelfBounds(e){return this.getTransformedSelfBounds(e)}invalidateStroke(){this.invalidatePath(),this.rendererSummaryRefreshEmitter.emit(),super.invalidateStroke()}hasShape(){return!!this._shape}canvasPaintSelf(e,t){ig.prototype.paintCanvas(e,this,t)}createSVGDrawable(e,t){return DL.createFromPool(e,t)}createCanvasDrawable(e,t){return ig.createFromPool(e,t)}isPainted(){return!0}containsPointSelf(e){let t=!1;return this.hasShape()&&(this._fillPickable&&(t=this.getShape().containsPoint(e)),!t&&this._strokePickable&&(t=this.getStrokedShape().containsPoint(e))),t}getSelfShape(){return yt.union([...this.hasShape()&&this._fillPickable?[this.getShape()]:[],...this.hasShape()&&this._strokePickable?[this.getStrokedShape()]:[]])}intersectsBoundsSelf(e){return this._shape?this._shape.intersectsBounds(e):!1}requiresSVGBoundsWorkaround(){if(!this._stroke||!(this._stroke instanceof Bs)||!this.hasShape())return!1;const e=this.computeShapeBounds();return e.width*e.height===0}getDebugHTMLExtras(){return this._shape?` (<span style="color: #88f" onclick="self.open( 'data:text/plain;charset=utf-8,' + encodeURIComponent( '${this._shape.getSVGPath()}' ) );">path</span>)`:""}dispose(){this._invalidShapeListenerAttached&&this.detachShapeListener(),this._shapeProperty.dispose(),super.dispose()}mutate(e){return super.mutate(e)}};hd.DEFAULT_PATH_OPTIONS=ii({},Ge.DEFAULT_NODE_OPTIONS,al);let mi=hd;mi.prototype._mutatorKeys=[...bf,...$b,...Ge.prototype._mutatorKeys];mi.prototype.drawableMarkFlags=[...Ge.prototype.drawableMarkFlags,...vf,"shape"];q.register("Path",mi);const Ub=["view","linked","string","none"],gu=new ei("none",{tandem:Ft.GENERAL_VIEW.createTandem("phetioElementSelectionProperty"),phetioValueType:si,validValues:Ub,phetioState:!1,phetioDocumentation:'Specifies how PhET-iO Elements are being selected. "view": the target view element, "linked": the corresponding linked element of the view element (if there is one), "string": select only string elements in the sim, "none": no active selection.'});dr.register("phetioElementSelectionProperty",gu);const dl="stringProperty",Yb=["boundsMethod",dl,"string","font","fontWeight","fontFamily","fontStretch","fontStyle","fontSize"],Kb=self.navigator.userAgent.includes("like Gecko) Version/5")&&self.navigator.userAgent.includes("Safari/"),Os=class Os extends Kl(Ge){constructor(e,t){assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell"),super(),this._stringProperty=new dn("",!0,this.onStringPropertyChange.bind(this)),this._font=ki.DEFAULT,this._boundsMethod="hybrid",this._isHTML=!1,this._cachedRenderedText=null;const i=ta({fill:"#000000",tandemNameSuffix:"Text",phetioType:Os.TextIO,phetioVisiblePropertyInstrumented:!1},t);assert&&assert(!i.hasOwnProperty("string")&&!i.hasOwnProperty(Os.STRING_PROPERTY_TANDEM_NAME),"provide string and stringProperty through constructor arg please"),typeof e=="string"||typeof e=="number"?i.string=e:i.stringProperty=e,this.mutate(i),this.invalidateSupportedRenderers()}mutate(e){return assert&&e&&e.hasOwnProperty("string")&&e.hasOwnProperty(dl)&&assert&&assert(e.stringProperty.value===e.string,"If both string and stringProperty are provided, then values should match"),super.mutate(e)}setString(e){return assert&&assert(e!=null,"String should be defined and non-null. Use the empty string if needed."),e=`${e}`,this._stringProperty.set(e),this}set string(e){this.setString(e)}get string(){return this.getString()}getString(){return this._stringProperty.value}getRenderedText(){return this._cachedRenderedText===null&&(this._cachedRenderedText=this.string.replace(" ",""),_i.edge&&(this._cachedRenderedText=Os.simplifyEmbeddingMarks(this._cachedRenderedText))),this._cachedRenderedText}get renderedText(){return this.getRenderedText()}onStringPropertyChange(){this._cachedRenderedText=null;const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirtyText();this.invalidateText()}setStringProperty(e){return this._stringProperty.setTargetProperty(e,this,Os.STRING_PROPERTY_TANDEM_NAME)}set stringProperty(e){this.setStringProperty(e)}get stringProperty(){return this.getStringProperty()}getStringProperty(){return this._stringProperty}initializePhetioObject(e,t){const i=this.isPhetioInstrumented();super.initializePhetioObject(e,t),Ft.PHET_IO_ENABLED&&!i&&this.isPhetioInstrumented()&&this._stringProperty.initializePhetio(this,Os.STRING_PROPERTY_TANDEM_NAME,()=>new $l(this.string,ii({phetioReadOnly:!0,tandem:this.tandem.createTandem(Os.STRING_PROPERTY_TANDEM_NAME),phetioDocumentation:"Property for the displayed text"},t.stringPropertyOptions)))}getPhetioMouseHitTarget(e=!1){return gu.value==="string"?this.getStringPropertyPhetioMouseHitTarget(e):super.getPhetioMouseHitTarget(e)}getStringPropertyPhetioMouseHitTarget(e=!1){const t=this._stringProperty.getTargetProperty();return t instanceof yi?t.getPhetioMouseHitTarget(e):"phetioNotSelectable"}setBoundsMethod(e){if(assert&&assert(e==="fast"||e==="fastCanvas"||e==="accurate"||e==="hybrid","Unknown Text boundsMethod"),e!==this._boundsMethod){this._boundsMethod=e,this.invalidateSupportedRenderers();const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyBounds();this.invalidateText(),this.rendererSummaryRefreshEmitter.emit()}return this}set boundsMethod(e){this.setBoundsMethod(e)}get boundsMethod(){return this.getBoundsMethod()}getBoundsMethod(){return this._boundsMethod}getTextRendererBitmask(){let e=0;return this._boundsMethod!=="fast"&&!this._isHTML&&(e|=ne.bitmaskCanvas),this._isHTML||(e|=ne.bitmaskSVG),e|=ne.bitmaskDOM,e}invalidateSupportedRenderers(){this.setRendererBitmask(this.getFillRendererBitmask()&this.getStrokeRendererBitmask()&this.getTextRendererBitmask())}invalidateText(){this.invalidateSelf();const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirtyBounds();this.invalidateSupportedRenderers()}updateSelfBounds(){let e;this._isHTML||Kb&&this._boundsMethod!=="accurate"?e=Ts.approximateDOMBounds(this._font,this.getDOMTextNode()):this._boundsMethod==="hybrid"?e=Ts.approximateHybridBounds(this._font,this.renderedText):this._boundsMethod==="accurate"?e=Ts.accurateCanvasBounds(this):(assert&&assert(this._boundsMethod==="fast"||this._boundsMethod==="fastCanvas"),e=Ts.approximateSVGBounds(this._font,this.renderedText)),this.hasStroke()&&e.dilate(this.getLineWidth()/2);const t=!e.equals(this.selfBoundsProperty._value);return t&&this.selfBoundsProperty._value.set(e),t}invalidateStroke(){this.invalidateText(),super.invalidateStroke()}invalidateFill(){this.invalidateText(),super.invalidateFill()}canvasPaintSelf(e,t){rg.prototype.paintCanvas(e,this,t)}createDOMDrawable(e,t){return ML.createFromPool(e,t)}createSVGDrawable(e,t){return BL.createFromPool(e,t)}createCanvasDrawable(e,t){return rg.createFromPool(e,t)}getDOMTextNode(){if(this._isHTML){const e=document.createElement("span");return e.innerHTML=this.string,e}else return document.createTextNode(this.renderedText)}getSafeSelfBounds(){const t=this.getSelfBounds();return t.dilatedXY(1*t.width,1*t.height)}setFont(e){if(e!==(typeof e=="string"?this._font.toCSS():this._font)){this._font=typeof e=="string"?ki.fromCSS(e):e;const i=this._drawables.length;for(let n=0;n<i;n++)this._drawables[n].markDirtyFont();this.invalidateText()}return this}set font(e){this.setFont(e)}get font(){return this.getFont()}getFont(){return this._font.getFont()}setFontWeight(e){return this.setFont(this._font.copy({weight:e}))}set fontWeight(e){this.setFontWeight(e)}get fontWeight(){return this.getFontWeight()}getFontWeight(){return this._font.getWeight()}setFontFamily(e){return this.setFont(this._font.copy({family:e}))}set fontFamily(e){this.setFontFamily(e)}get fontFamily(){return this.getFontFamily()}getFontFamily(){return this._font.getFamily()}setFontStretch(e){return this.setFont(this._font.copy({stretch:e}))}set fontStretch(e){this.setFontStretch(e)}get fontStretch(){return this.getFontStretch()}getFontStretch(){return this._font.getStretch()}setFontStyle(e){return this.setFont(this._font.copy({style:e}))}set fontStyle(e){this.setFontStyle(e)}get fontStyle(){return this.getFontStyle()}getFontStyle(){return this._font.getStyle()}setFontSize(e){return this.setFont(this._font.copy({size:e}))}set fontSize(e){this.setFontSize(e)}get fontSize(){return this.getFontSize()}getFontSize(){return this._font.getSize()}isPainted(){return!0}areSelfBoundsValid(){return this._boundsMethod==="accurate"}getDebugHTMLExtras(){return` "${hc(this.renderedText)}"${this._isHTML?" (html)":""}`}dispose(){super.dispose(),this._stringProperty.dispose()}static embeddedDebugString(e){return e.replace(/\u202a/g,"[LTR]").replace(/\u202b/g,"[RTL]").replace(/\u202c/g,"[POP]")}static simplifyEmbeddingMarks(e){const t={dir:null,children:[],parent:null};let i=t;for(let C=0;C<e.length;C++){const B=e.charAt(C);if(B===jb||B===qb){const U={dir:B,children:[],parent:i};i.children.push(U),i=U}else B===Xb?(assert&&assert(i.parent,`Bad nesting of embedding marks: ${Os.embeddedDebugString(e)}`),i=i.parent):i.children.push(B)}assert&&assert(i===t,`Bad nesting of embedding marks: ${Os.embeddedDebugString(e)}`);function n(C){for(let B=C.children.length-1;B>=0;B--){const U=C.children[B];typeof U!="string"&&C.dir===U.dir&&C.children.splice(B,1,...U.children)}}function r(C){C.children.length===1&&typeof C.children[0]!="string"&&C.children[0].dir&&(C.dir=C.children[0].dir,C.children=C.children[0].children)}function h(C){for(let B=C.children.length-1;B>=1;B--){const U=C.children[B-1],k=C.children[B];typeof k!="string"&&typeof U!="string"&&k.dir&&U.dir===k.dir&&(U.children=U.children.concat(k.children),C.children.splice(B,1),h(U))}}function p(C){if(typeof C!="string"){for(let B=0;B<C.children.length;B++)p(C.children[B]);r(C),n(C),h(C)}return C}function S(C){if(typeof C=="string")return C;const B=C.children.map(S).join("");return C.dir?`${C.dir+B}`:B}return S(p(t))}};Os.STRING_PROPERTY_NAME=dl,Os.STRING_PROPERTY_TANDEM_NAME=dl;let Vi=Os;Vi.prototype._mutatorKeys=[...bf,...Yb,...Ge.prototype._mutatorKeys];Vi.prototype.drawableMarkFlags=[...Ge.prototype.drawableMarkFlags,...vf,"text","font","bounds"];q.register("Text",Vi);const jb="",qb="",Xb="";Ts.initializeTextBounds();Vi.TextIO=new li("TextIO",{valueType:Vi,supertype:Ge.NodeIO,documentation:"Text that is displayed in the simulation. TextIO has a nested PropertyIO.&lt;String&gt; for the current string value."});const Zb=["canvasBounds"];class Tr extends Ge{constructor(e){super(e),this.setRendererBitmask(ne.bitmaskCanvas)}setCanvasBounds(e){this.invalidateSelf(e)}set canvasBounds(e){this.setCanvasBounds(e)}get canvasBounds(){return this.getCanvasBounds()}getCanvasBounds(){return this.getSelfBounds()}isPainted(){return!0}invalidatePaint(){const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirty()}canvasPaintSelf(e,t){this.paintCanvas(e.context)}containsPointSelf(e){return!1}getSelfShape(){return new yt}createCanvasDrawable(e,t){return mL.createFromPool(e,t)}mutate(e){return super.mutate(e)}}Tr.prototype._mutatorKeys=Zb.concat(Ge.prototype._mutatorKeys);q.register("CanvasNode",Tr);const Qb=["radius"];class ga extends mi{constructor(e,t){super(null),this._radius=0,typeof e=="object"?(t=e,assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell")):(assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell"),t=ta({radius:e},t)),this.mutate(t)}getStrokeRendererBitmask(){let e=super.getStrokeRendererBitmask();return this.hasStroke()&&!this.getStroke().isGradient&&!this.getStroke().isPattern&&this.getLineWidth()<=this.getRadius()&&(e|=ne.bitmaskDOM),e}getPathRendererBitmask(){return ne.bitmaskCanvas|ne.bitmaskSVG|(Qe.borderRadius?ne.bitmaskDOM:0)}invalidateCircle(){assert&&assert(this._radius>=0,"A circle needs a non-negative radius"),this._shape=null,this.invalidatePath()}createCircleShape(){return yt.circle(0,0,this._radius).makeImmutable()}intersectsBoundsSelf(e){let t=Math.abs(e.centerX),i=Math.abs(e.centerY);const n=e.maxX-t,r=e.maxY-i;return t>n+this._radius||i>r+this._radius?!1:t<=n||i<=r?!0:(t-=n,i-=r,t*t+i*i<=this._radius*this._radius)}canvasPaintSelf(e,t){Jp.prototype.paintCanvas(e,this,t)}createDOMDrawable(e,t){return yL.createFromPool(e,t)}createSVGDrawable(e,t){return vL.createFromPool(e,t)}createCanvasDrawable(e,t){return Jp.createFromPool(e,t)}setRadius(e){if(assert&&assert(e>=0,"A circle needs a non-negative radius"),assert&&assert(isFinite(e),"A circle needs a finite radius"),this._radius!==e){this._radius=e,this.invalidateCircle();const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyRadius()}return this}set radius(e){this.setRadius(e)}get radius(){return this.getRadius()}getRadius(){return this._radius}computeShapeBounds(){let e=new Be(-this._radius,-this._radius,this._radius,this._radius);return this._stroke&&(e=e.dilated(this.getLineWidth()/2)),e}containsPointSelf(e){const t=e.x*e.x+e.y*e.y;let i=!0,n;if(this._strokePickable){n=this.getLineWidth()/2;const r=this._radius+n;i=i&&t<=r*r}if(this._fillPickable)return this._strokePickable?i:t<=this._radius*this._radius;if(this._strokePickable){const r=this._radius-n;return i&&t>=r*r}else return!1}setShape(e){if(e!==null)throw new Error("Cannot set the shape of a Circle to something non-null");return this.invalidatePath(),this}getShape(){return this._shape||(this._shape=this.createCircleShape()),this._shape}hasShape(){return!0}setShapeProperty(e){if(e!==null)throw new Error("Cannot set the shapeProperty of a Circle to something non-null, it handles this itself");return this}mutate(e){return super.mutate(e)}}ga.prototype._mutatorKeys=Qb.concat(mi.prototype._mutatorKeys);ga.prototype.drawableMarkFlags=mi.prototype.drawableMarkFlags.concat(["radius"]).filter(l=>l!=="shape");q.register("Circle",ga);const Jb=["element","preventTransform","allowInput"],ev=l=>!!(l&&l.jquery);class Io extends Ge{constructor(e,t){assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&assert(e instanceof self.Element||e.jquery,"DOM nodes need to be passed an HTML/DOM element or a jQuery selection like $( ... )"),ev(e)&&(e=e[0],assert&&assert(e instanceof self.Element)),super(),this._container=document.createElement("div"),this._container.style.position="absolute",this._container.style.left="0",this._container.style.top="0",this._allowInput=!1,this._$container=$(this._container),this.invalidateDOMLock=!1,this._preventTransform=!1,this.invalidateAllowInput(this._allowInput),t=ta({element:e},t),this.mutate(t),this.setRendererBitmask(ne.bitmaskDOM)}calculateDOMBounds(){const e=$(this._element);return new Be(0,0,e.width(),e.height())}invalidateDOM(){if(this.invalidateDOMLock)return;this.invalidateDOMLock=!0;const e=document.createElement("div");$(e).css({display:"hidden",padding:"0 !important",margin:"0 !important",position:"absolute",left:0,top:0,width:65535,height:65535}),this._container.removeChild(this._element),e.appendChild(this._element),document.body.appendChild(e);const t=this.calculateDOMBounds();this.invalidateSelf(t),this._$container.width(t.getWidth()),this._$container.height(t.getHeight()),document.body.removeChild(e),e.removeChild(this._element),this._container.appendChild(this._element),this.invalidateDOMLock=!1}createDOMDrawable(e,t){return Wc.createFromPool(e,t)}isPainted(){return!0}setElement(e){return assert&&assert(!this._element,"We should only ever attach one DOMElement to a DOM node"),this._element!==e&&(this._element&&this._container.removeChild(this._element),this._element=e,this._container.appendChild(this._element),this.invalidateDOM()),this}set element(e){this.setElement(e)}get element(){return this.getElement()}getElement(){return this._element}setPreventTransform(e){this._preventTransform!==e&&(this._preventTransform=e)}set preventTransform(e){this.setPreventTransform(e)}get preventTransform(){return this.isTransformPrevented()}isTransformPrevented(){return this._preventTransform}setAllowInput(e){this._allowInput!==e&&(this._allowInput=e,this.invalidateAllowInput(e))}isInputAllowed(){return this._allowInput}invalidateAllowInput(e){this._container.dataset.sceneryAllowInput=e?"true":"false",this._container.style.pointerEvents=e?"auto":"none"}set allowInput(e){this.setAllowInput(e)}get allowInput(){return this.isInputAllowed()}mutate(e){return super.mutate(e)}}Io.prototype._mutatorKeys=Jb.concat(Ge.prototype._mutatorKeys);q.register("DOM",Io);const tv=["p1","p2","x1","y1","x2","y2"];class An extends mi{constructor(e,t,i,n,r){super(null),this._x1=0,this._y1=0,this._x2=0,this._y2=0,typeof e=="object"?e instanceof We?(assert&&assert(i===void 0||typeof i=="object"),assert&&assert(i===void 0||Object.getPrototypeOf(i)===Object.prototype,"Extra prototype on Node options object is a code smell"),r=ta({x1:e.x,y1:e.y,x2:t.x,y2:t.y,strokePickable:!0},i)):(assert&&assert(t===void 0),assert&&assert(e===void 0||Object.getPrototypeOf(e)===Object.prototype,"Extra prototype on Node options object is a code smell"),r=ta({strokePickable:!0},e)):(assert&&assert(e!==void 0&&typeof t=="number"&&typeof i=="number"&&typeof n=="number"),assert&&assert(r===void 0||Object.getPrototypeOf(r)===Object.prototype,"Extra prototype on Node options object is a code smell"),r=ta({x1:e,y1:t,x2:i,y2:n,strokePickable:!0},r)),this.mutate(r)}setLine(e,t,i,n){assert&&assert(e!==void 0&&t!==void 0&&i!==void 0&&n!==void 0,"parameters need to be defined"),this._x1=e,this._y1=t,this._x2=i,this._y2=n;const r=this._drawables.length;for(let h=0;h<r;h++)this._drawables[h].markDirtyLine();return this.invalidateLine(),this}setPoint1(e,t){typeof e=="number"?(assert&&assert(e!==void 0&&t!==void 0,"parameters need to be defined"),this._x1=e,this._y1=t):(assert&&assert(e.x!==void 0&&e.y!==void 0,"parameters need to be defined"),this._x1=e.x,this._y1=e.y);const i=this._drawables.length;for(let n=0;n<i;n++)this._drawables[n].markDirtyP1();return this.invalidateLine(),this}set p1(e){this.setPoint1(e)}get p1(){return new We(this._x1,this._y1)}setPoint2(e,t){typeof e=="number"?(assert&&assert(e!==void 0&&t!==void 0,"parameters need to be defined"),this._x2=e,this._y2=t):(assert&&assert(e.x!==void 0&&e.y!==void 0,"parameters need to be defined"),this._x2=e.x,this._y2=e.y);const i=this._drawables.length;for(let n=0;n<i;n++)this._drawables[n].markDirtyP2();return this.invalidateLine(),this}set p2(e){this.setPoint2(e)}get p2(){return new We(this._x2,this._y2)}setX1(e){if(this._x1!==e){this._x1=e;const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyX1();this.invalidateLine()}return this}set x1(e){this.setX1(e)}get x1(){return this.getX1()}getX1(){return this._x1}setY1(e){if(this._y1!==e){this._y1=e;const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyY1();this.invalidateLine()}return this}set y1(e){this.setY1(e)}get y1(){return this.getY1()}getY1(){return this._y1}setX2(e){if(this._x2!==e){this._x2=e;const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyX2();this.invalidateLine()}return this}set x2(e){this.setX2(e)}get x2(){return this.getX2()}getX2(){return this._x2}setY2(e){if(this._y2!==e){this._y2=e;const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyY2();this.invalidateLine()}return this}set y2(e){this.setY2(e)}get y2(){return this.getY2()}getY2(){return this._y2}createLineShape(){return yt.lineSegment(this._x1,this._y1,this._x2,this._y2).makeImmutable()}invalidateLine(){assert&&assert(isFinite(this._x1),`A line needs to have a finite x1 (${this._x1})`),assert&&assert(isFinite(this._y1),`A line needs to have a finite y1 (${this._y1})`),assert&&assert(isFinite(this._x2),`A line needs to have a finite x2 (${this._x2})`),assert&&assert(isFinite(this._y2),`A line needs to have a finite y2 (${this._y2})`),this._shape=null,this.invalidatePath()}containsPointSelf(e){return this._strokePickable?super.containsPointSelf(e):!1}canvasPaintSelf(e,t){tg.prototype.paintCanvas(e,this,t)}computeShapeBounds(){if(this._stroke){const e=this.getLineCap(),t=this.getLineWidth()/2;if(e==="round")return new Be(Math.min(this._x1,this._x2)-t,Math.min(this._y1,this._y2)-t,Math.max(this._x1,this._x2)+t,Math.max(this._y1,this._y2)+t);{const i=this._x2-this._x1,n=this._y2-this._y1,r=Math.sqrt(i*i+n*n);if(r===0)return new Be(this._x1-t,this._y1-t,this._x2+t,this._y2+t);const h=t*i/r,p=t*n/r,S=Be.NOTHING.copy();return e==="butt"?(S.addCoordinates(this._x1-p,this._y1+h),S.addCoordinates(this._x1+p,this._y1-h),S.addCoordinates(this._x2-p,this._y2+h),S.addCoordinates(this._x2+p,this._y2-h)):(assert&&assert(e==="square"),S.addCoordinates(this._x1-h-p,this._y1-p+h),S.addCoordinates(this._x1-h+p,this._y1-p-h),S.addCoordinates(this._x2+h-p,this._y2+p+h),S.addCoordinates(this._x2+h+p,this._y2+p-h)),S}}else{const e=Be.NOTHING.copy();return e.addCoordinates(this._x1,this._y1),e.addCoordinates(this._x2,this._y2),e}}createSVGDrawable(e,t){return CL.createFromPool(e,t)}createCanvasDrawable(e,t){return tg.createFromPool(e,t)}setShape(e){if(e!==null)throw new Error("Cannot set the shape of a Line to something non-null");return this.invalidatePath(),this}getShape(){return this._shape||(this._shape=this.createLineShape()),this._shape}hasShape(){return!0}setShapeProperty(e){if(e!==null)throw new Error("Cannot set the shapeProperty of a Line to something non-null, it handles this itself");return this}mutate(e){return super.mutate(e)}getFillRendererBitmask(){return ne.bitmaskCanvas|ne.bitmaskSVG|ne.bitmaskDOM|ne.bitmaskWebGL}}An.prototype._mutatorKeys=tv.concat(mi.prototype._mutatorKeys);An.prototype.drawableMarkFlags=mi.prototype.drawableMarkFlags.concat(["line","p1","p2","x1","x2","y1","y2"]).filter(l=>l!=="shape");q.register("Line",An);const iv=["rectBounds","rectSize","rectX","rectY","rectWidth","rectHeight","cornerRadius","cornerXRadius","cornerYRadius"],Pf=Yl(mi);class vi extends Pf{constructor(e,t,i,n,r,h,p){const S={sizable:!1};super(null,S);let C={};this._rectX=0,this._rectY=0,this._rectWidth=0,this._rectHeight=0,this._cornerXRadius=0,this._cornerYRadius=0,typeof e=="object"?e instanceof Be?typeof t!="number"?(assert&&assert(arguments.length===1||arguments.length===2,"new Rectangle( bounds, { ... } ) should only take one or two arguments"),assert&&assert(t===void 0||typeof t=="object","new Rectangle( bounds, { ... } ) second parameter should only ever be an options object"),assert&&assert(t===void 0||Object.getPrototypeOf(t)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&t&&(assert(t.rectWidth===void 0,"Should not specify rectWidth in multiple ways"),assert(t.rectHeight===void 0,"Should not specify rectHeight in multiple ways"),assert(t.rectBounds===void 0,"Should not specify rectBounds in multiple ways")),C=ii(C,{rectBounds:e},t)):(assert&&assert(arguments.length===3||arguments.length===4,"new Rectangle( bounds, cornerXRadius, cornerYRadius, { ... } ) should only take three or four arguments"),assert&&assert(n===void 0||typeof n=="object","new Rectangle( bounds, cornerXRadius, cornerYRadius, { ... } ) fourth parameter should only ever be an options object"),assert&&assert(n===void 0||Object.getPrototypeOf(n)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&n&&(assert(n.rectWidth===void 0,"Should not specify rectWidth in multiple ways"),assert(n.rectHeight===void 0,"Should not specify rectHeight in multiple ways"),assert(n.rectBounds===void 0,"Should not specify rectBounds in multiple ways"),assert(n.cornerXRadius===void 0,"Should not specify cornerXRadius in multiple ways"),assert(n.cornerYRadius===void 0,"Should not specify cornerYRadius in multiple ways"),assert(n.cornerRadius===void 0,"Should not specify cornerRadius in multiple ways")),C=ii(C,{rectBounds:e,cornerXRadius:t,cornerYRadius:i},n)):C=ii(C,e):h===void 0?(assert&&assert(arguments.length===4||arguments.length===5,"new Rectangle( x, y, width, height, { ... } ) should only take four or five arguments"),assert&&assert(r===void 0||typeof r=="object","new Rectangle( x, y, width, height, { ... } ) fifth parameter should only ever be an options object"),assert&&assert(r===void 0||Object.getPrototypeOf(r)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&r&&(assert(r.rectX===void 0,"Should not specify rectX in multiple ways"),assert(r.rectY===void 0,"Should not specify rectY in multiple ways"),assert(r.rectWidth===void 0,"Should not specify rectWidth in multiple ways"),assert(r.rectHeight===void 0,"Should not specify rectHeight in multiple ways"),assert(r.rectBounds===void 0,"Should not specify rectBounds in multiple ways")),C=ii(C,{rectX:e,rectY:t,rectWidth:i,rectHeight:n},r)):(assert&&assert(arguments.length===6||arguments.length===7,"new Rectangle( x, y, width, height, cornerXRadius, cornerYRadius{ ... } ) should only take six or seven arguments"),assert&&assert(C===void 0||typeof C=="object","new Rectangle( x, y, width, height, cornerXRadius, cornerYRadius{ ... } ) seventh parameter should only ever be an options object"),assert&&assert(C===void 0||Object.getPrototypeOf(C)===Object.prototype,"Extra prototype on Node options object is a code smell"),assert&&p&&(assert(p.rectX===void 0,"Should not specify rectX in multiple ways"),assert(p.rectY===void 0,"Should not specify rectY in multiple ways"),assert(p.rectWidth===void 0,"Should not specify rectWidth in multiple ways"),assert(p.rectHeight===void 0,"Should not specify rectHeight in multiple ways"),assert(p.rectBounds===void 0,"Should not specify rectBounds in multiple ways"),assert(p.cornerXRadius===void 0,"Should not specify cornerXRadius in multiple ways"),assert(p.cornerYRadius===void 0,"Should not specify cornerYRadius in multiple ways"),assert(p.cornerRadius===void 0,"Should not specify cornerRadius in multiple ways")),C=ii(C,{rectX:e,rectY:t,rectWidth:i,rectHeight:n,cornerXRadius:r,cornerYRadius:h},p)),this.localPreferredWidthProperty.lazyLink(this.updatePreferredSizes.bind(this)),this.localPreferredHeightProperty.lazyLink(this.updatePreferredSizes.bind(this)),this.localMinimumWidthProperty.lazyLink(this.updatePreferredSizes.bind(this)),this.localMinimumHeightProperty.lazyLink(this.updatePreferredSizes.bind(this)),this.mutate(C)}getMaximumArcSize(){return Math.min(this._rectWidth/2,this._rectHeight/2)}getStrokeRendererBitmask(){let e=super.getStrokeRendererBitmask();const t=this.getStroke();return t&&!(t instanceof ls)&&!(t instanceof or)&&!this.hasLineDash()&&(this.getLineJoin()==="miter"||this.getLineJoin()==="round"&&Qe.borderRadius)&&(e|=ne.bitmaskDOM),this.hasStroke()||(e|=ne.bitmaskWebGL),e}getPathRendererBitmask(){let e=ne.bitmaskCanvas|ne.bitmaskSVG;const t=this.getMaximumArcSize();return(!this.hasStroke()||this.getLineWidth()<=this._rectHeight&&this.getLineWidth()<=this._rectWidth)&&(!this.isRounded()||Qe.borderRadius&&this._cornerXRadius===this._cornerYRadius)&&this._cornerYRadius<=t&&this._cornerXRadius<=t&&(e|=ne.bitmaskDOM),!this.hasStroke()&&!this.isRounded()&&(e|=ne.bitmaskWebGL),e}setRect(e,t,i,n,r,h){const p=r!==void 0,S=h!==void 0;if(assert&&assert(isFinite(e)&&isFinite(t)&&isFinite(i)&&isFinite(n),"x/y/width/height should be finite numbers"),assert&&assert(!p||isFinite(r)&&(!S||isFinite(h)),"Corner radii (if provided) should be finite numbers"),this._rectX===e&&this._rectY===t&&this._rectWidth===i&&this._rectHeight===n&&(!p||this._cornerXRadius===r)&&(!S||this._cornerYRadius===h))return this;this._rectX=e,this._rectY=t,this._rectWidth=i,this._rectHeight=n,this._cornerXRadius=p?r:this._cornerXRadius,this._cornerYRadius=S?h:this._cornerYRadius;const C=this._drawables.length;for(let B=0;B<C;B++)this._drawables[B].markDirtyRectangle();return this.invalidateRectangle(),this}setRectX(e){if(assert&&assert(isFinite(e),"rectX should be a finite number"),this._rectX!==e){this._rectX=e;const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyX();this.invalidateRectangle()}return this}set rectX(e){this.setRectX(e)}get rectX(){return this.getRectX()}getRectX(){return this._rectX}setRectY(e){if(assert&&assert(isFinite(e),"rectY should be a finite number"),this._rectY!==e){this._rectY=e;const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyY();this.invalidateRectangle()}return this}set rectY(e){this.setRectY(e)}get rectY(){return this.getRectY()}getRectY(){return this._rectY}setRectWidth(e){if(assert&&assert(isFinite(e),"rectWidth should be a finite number"),this._rectWidth!==e){this._rectWidth=e;const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyWidth();this.invalidateRectangle()}return this}set rectWidth(e){this.setRectWidth(e)}get rectWidth(){return this.getRectWidth()}getRectWidth(){return this._rectWidth}setRectHeight(e){if(assert&&assert(isFinite(e),"rectHeight should be a finite number"),this._rectHeight!==e){this._rectHeight=e;const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyHeight();this.invalidateRectangle()}return this}set rectHeight(e){this.setRectHeight(e)}get rectHeight(){return this.getRectHeight()}getRectHeight(){return this._rectHeight}setCornerXRadius(e){if(assert&&assert(isFinite(e),"cornerXRadius should be a finite number"),this._cornerXRadius!==e){this._cornerXRadius=e;const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyCornerXRadius();this.invalidateRectangle()}return this}set cornerXRadius(e){this.setCornerXRadius(e)}get cornerXRadius(){return this.getCornerXRadius()}getCornerXRadius(){return this._cornerXRadius}setCornerYRadius(e){if(assert&&assert(isFinite(e),"cornerYRadius should be a finite number"),this._cornerYRadius!==e){this._cornerYRadius=e;const t=this._drawables.length;for(let i=0;i<t;i++)this._drawables[i].markDirtyCornerYRadius();this.invalidateRectangle()}return this}set cornerYRadius(e){this.setCornerYRadius(e)}get cornerYRadius(){return this.getCornerYRadius()}getCornerYRadius(){return this._cornerYRadius}setRectBounds(e){return this.setRect(e.x,e.y,e.width,e.height),this}set rectBounds(e){this.setRectBounds(e)}get rectBounds(){return this.getRectBounds()}getRectBounds(){return Be.rect(this._rectX,this._rectY,this._rectWidth,this._rectHeight)}setRectSize(e){return this.setRectWidth(e.width),this.setRectHeight(e.height),this}set rectSize(e){this.setRectSize(e)}get rectSize(){return this.getRectSize()}getRectSize(){return new Zs(this._rectWidth,this._rectHeight)}setRectWidthFromRight(e){if(this._rectWidth!==e){const t=this._rectX+this._rectWidth;this.setRectWidth(e),this.setRectX(t-e)}return this}set rectWidthFromRight(e){this.setRectWidthFromRight(e)}get rectWidthFromRight(){return this.getRectWidth()}setRectHeightFromBottom(e){if(this._rectHeight!==e){const t=this._rectY+this._rectHeight;this.setRectHeight(e),this.setRectY(t-e)}return this}set rectHeightFromBottom(e){this.setRectHeightFromBottom(e)}get rectHeightFromBottom(){return this.getRectHeight()}isRounded(){return this._cornerXRadius!==0&&this._cornerYRadius!==0}computeShapeBounds(){let e=new Be(this._rectX,this._rectY,this._rectX+this._rectWidth,this._rectY+this._rectHeight);return this._stroke&&(e=e.dilated(this.getLineWidth()/2)),e}createRectangleShape(){if(this.isRounded()){const e=Math.min(this._rectWidth/2,this._rectHeight/2);return yt.roundRectangle(this._rectX,this._rectY,this._rectWidth,this._rectHeight,Math.min(e,this._cornerXRadius),Math.min(e,this._cornerYRadius)).makeImmutable()}else return yt.rectangle(this._rectX,this._rectY,this._rectWidth,this._rectHeight).makeImmutable()}invalidateRectangle(){assert&&assert(isFinite(this._rectX),`A rectangle needs to have a finite x (${this._rectX})`),assert&&assert(isFinite(this._rectY),`A rectangle needs to have a finite y (${this._rectY})`),assert&&assert(this._rectWidth>=0&&isFinite(this._rectWidth),`A rectangle needs to have a non-negative finite width (${this._rectWidth})`),assert&&assert(this._rectHeight>=0&&isFinite(this._rectHeight),`A rectangle needs to have a non-negative finite height (${this._rectHeight})`),assert&&assert(this._cornerXRadius>=0&&isFinite(this._cornerXRadius),`A rectangle needs to have a non-negative finite arcWidth (${this._cornerXRadius})`),assert&&assert(this._cornerYRadius>=0&&isFinite(this._cornerYRadius),`A rectangle needs to have a non-negative finite arcHeight (${this._cornerYRadius})`),this._shape=null,this.invalidatePath(),this.invalidateSupportedRenderers()}updatePreferredSizes(){let e=this.localPreferredWidth,t=this.localPreferredHeight;e!==null&&(e=Math.max(e,this.localMinimumWidth||0)),t!==null&&(t=Math.max(t,this.localMinimumHeight||0)),e!==null&&(this.rectWidth=this.hasStroke()?e-this.lineWidth:e),t!==null&&(this.rectHeight=this.hasStroke()?t-this.lineWidth:t)}invalidateStroke(){super.invalidateStroke(),this.updatePreferredSizes()}containsPointSelf(e){const t=this._rectX,i=this._rectY,n=this._rectWidth,r=this._rectHeight,h=this._cornerXRadius,p=this._cornerYRadius,S=this.getLineWidth()/2;let C=!0;if(this._strokePickable){const B=this.isRounded();if(!B&&this.getLineJoin()==="bevel")return super.containsPointSelf(e);const U=this.getLineJoin()==="miter"&&!B;C=C&&vi.intersects(t-S,i-S,n+2*S,r+2*S,U?0:h+S,U?0:p+S,e)}return this._fillPickable?this._strokePickable?C:vi.intersects(t,i,n,r,h,p,e):this._strokePickable?C&&!vi.intersects(t+S,i+S,n-2*S,r-2*S,h-S,p-S,e):!1}intersectsBoundsSelf(e){return!this.computeShapeBounds().intersection(e).isEmpty()}canvasPaintSelf(e,t){sg.prototype.paintCanvas(e,this,t)}createDOMDrawable(e,t){return IL.createFromPool(e,t)}createSVGDrawable(e,t){return EL.createFromPool(e,t)}createCanvasDrawable(e,t){return sg.createFromPool(e,t)}createWebGLDrawable(e,t){return AL.createFromPool(e,t)}setShape(e){if(e!==null)throw new Error("Cannot set the shape of a Rectangle to something non-null");return this.invalidatePath(),this}getShape(){return this._shape||(this._shape=this.createRectangleShape()),this._shape}hasShape(){return!0}setShapeProperty(e){if(e!==null)throw new Error("Cannot set the shapeProperty of a Rectangle to something non-null, it handles this itself");return this}setCornerRadius(e){return this.setCornerXRadius(e),this.setCornerYRadius(e),this}set cornerRadius(e){this.setCornerRadius(e)}get cornerRadius(){return this.getCornerRadius()}getCornerRadius(){return assert&&assert(this._cornerXRadius===this._cornerYRadius,"getCornerRadius() invalid if x/y radii are different"),this._cornerXRadius}mutate(e){return super.mutate(e)}static intersects(e,t,i,n,r,h,p){const S=p.x>=e&&p.x<=e+i&&p.y>=t&&p.y<=t+n;if(!S||r<=0||h<=0)return S;const C=Math.min(i/2,n/2);r=Math.min(C,r),h=Math.min(C,h);let B,U,k=!1;if(p.x<e+i/2?(B=e+r,k=k||p.x>=B):(B=e+i-r,k=k||p.x<=B),k||(p.y<t+n/2?(U=t+h,k=k||p.y>=U):(U=t+n-h,k=k||p.y<=U),k))return!0;let Q=p.x-B,X=p.y-U;return Q/=r,X/=h,Q*=Q,X*=X,Q+X<=1}static rect(e,t,i,n,r){return new vi(e,t,i,n,0,0,r)}static roundedRect(e,t,i,n,r,h,p){return new vi(e,t,i,n,r,h,p)}static bounds(e,t){return new vi(e.minX,e.minY,e.width,e.height,t)}static roundedBounds(e,t,i,n){return new vi(e.minX,e.minY,e.width,e.height,t,i,n)}static dimension(e,t){return new vi(0,0,e.width,e.height,0,0,t)}}vi.prototype._mutatorKeys=[...iv,...Pf.prototype._mutatorKeys];vi.prototype.drawableMarkFlags=mi.prototype.drawableMarkFlags.concat(["x","y","width","height","cornerXRadius","cornerYRadius"]).filter(l=>l!=="shape");q.register("Rectangle",vi);class fu extends Ge{constructor(e){const t=je()({sprites:[],spriteInstances:[],hitTestSprites:!1,renderer:"webgl"},e);super(),this._sprites=t.sprites,this._spriteInstances=t.spriteInstances,this._hitTestSprites=t.hitTestSprites,this.setRendererBitmask(ne.bitmaskCanvas|ne.bitmaskWebGL),this.mutate(t)}setCanvasBounds(e){this.invalidateSelf(e)}set canvasBounds(e){this.setCanvasBounds(e)}get canvasBounds(){return this.getCanvasBounds()}getCanvasBounds(){return this.getSelfBounds()}canvasPaintSelf(e,t){ng.prototype.paintCanvas(e,this,t)}createCanvasDrawable(e,t){return ng.createFromPool(e,t)}createWebGLDrawable(e,t){return OL.createFromPool(e,t)}containsPointSelf(e){return super.containsPointSelf(e)?this._hitTestSprites?!!this.getSpriteInstanceFromPoint(e):!0:!1}getSpriteInstanceFromPoint(e){for(let t=this._spriteInstances.length-1;t>=0;t--)if(this._spriteInstances[t].containsPoint(e))return this._spriteInstances[t];return null}getSelfShape(){return this._hitTestSprites?yt.union(this._spriteInstances.map(e=>e.getShape())):yt.bounds(this.selfBounds)}isPainted(){return!0}invalidatePaint(){const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirty()}mutate(e){return super.mutate(e)}}fu.prototype._mutatorKeys=["canvasBounds"].concat(Ge.prototype._mutatorKeys);q.register("Sprites",fu);const sv=["canvasBounds"],Bl=class Bl extends Ge{constructor(e,t){super(t),this.setRendererBitmask(ne.bitmaskWebGL),this.painterType=e}setCanvasBounds(e){return this.invalidateSelf(e),this}set canvasBounds(e){this.setCanvasBounds(e)}get canvasBounds(){return this.getCanvasBounds()}getCanvasBounds(){return this.getSelfBounds()}isPainted(){return!0}invalidatePaint(){const e=this._drawables.length;for(let t=0;t<e;t++)this._drawables[t].markDirty()}containsPointSelf(e){return!1}getSelfShape(){return new yt}canvasPaintSelf(e,t){assert&&assert(!1,"unimplemented: canvasPaintSelf in WebGLNode")}renderToCanvasSelf(e,t){const i=e.canvas.width,n=e.canvas.height,r=document.createElement("canvas");r.width=i,r.height=n;const h={antialias:!0,preserveDrawingBuffer:!0},p=r.getContext("webgl",h)||r.getContext("experimental-webgl",h);Dt.applyWebGLContextDefaults(p);const S=new $e().rowMajor(2/i,0,-1,0,-2/n,1,0,0,1);p.viewport(0,0,i,n);const C=this.painterType,B=new C(p,this);B.paint(t,S),B.dispose(),S.freeToPool(),p.flush(),e.context.setTransform(1,0,0,1,0,0),e.context.drawImage(r,0,0),e.context.restore()}createWebGLDrawable(e,t){return FL.createFromPool(e,t)}mutate(e){return super.mutate(e)}};Bl.PAINTED_NOTHING=0,Bl.PAINTED_SOMETHING=1;let pn=Bl;pn.prototype._mutatorKeys=sv.concat(Ge.prototype._mutatorKeys);q.register("WebGLNode",pn);class nv extends vi{constructor(e){super(-2e3,-2e3,6e3,6e3,e)}}q.register("Plane",nv);const Sf=Ai(l=>class extends l{constructor(...t){super(...t)}insertChild(t,i){throw new Error("Attempt to insert child into Leaf")}removeChildWithIndex(t,i){throw new Error("Attempt to remove child from Leaf")}});q.register("Leaf",Sf);class mu extends Sf(Ge){constructor(e,t,i){assert&&assert(isFinite(e),"width should be a finite number"),assert&&assert(isFinite(t),"height should be a finite number"),super(),this.localBounds=new Be(0,0,e,t),this.mutate(i)}}q.register("Spacer",mu);class rv extends mu{constructor(e,t){super(e,0,t)}}q.register("HStrut",rv);class av extends mu{constructor(e,t){super(0,e,t)}}q.register("VStrut",av);let ov=1;const lv=new We(0,0);class hv extends ms(Object){constructor(e,t,i){assert&&assert(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement);const n={hitTestPixels:!1,pickable:!0};it(e)?n.imageProperty=e:n.image=e;const r=je()(n,i);super(),this.id=ov++,this.offset=t,this.pickable=r.pickable,this.shape=null,this.imageData=null,it(e)?this.imageProperty=e:this.image=e,No(this,Object.keys(ms.DEFAULT_OPTIONS),r)}get width(){return this.imageWidth}get height(){return this.imageHeight}getShape(){if(!this.pickable)return new yt;if(!this.shape){if(this.hitTestPixels)if(this.ensureImageData(),this.imageData)this.shape=ms.hitTestDataToShape(this.imageData,this.width,this.height);else return new yt;else if(this.width&&this.height)this.shape=yt.rect(0,0,this.width,this.height);else return new yt;this.shape=this.shape.transformed($e.translation(-this.offset.x,-this.offset.y))}return this.shape}ensureImageData(){!this.imageData&&this.width&&this.height&&(this.imageData=ms.getHitTestData(this.image,this.width,this.height))}containsPoint(e){if(!this.pickable)return!1;const t=this.width,i=this.height;if(!t&&!i)return!1;const n=lv.set(e).add(this.offset);return n.x<0||n.y<0||n.x>t||n.y>i?!1:this.hitTestPixels?(this.ensureImageData(),this.imageData?ms.testHitTestData(this.imageData,t,i,n):!1):!0}}q.register("SpriteImage",hv);class cv{constructor(e){this.imageProperty=new ei(e)}getShape(){return this.imageProperty.value.getShape()}containsPoint(e){return this.imageProperty.value.containsPoint(e)}}q.register("Sprite",cv);class fa{constructor(e){this.primary=null,this.changeCallback=e,this.notifyChangeCallback=this.notifyChanged.bind(this),this.updateSecondaryListener=this.updateSecondary.bind(this),this.secondaryPropertyCountsMap={}}setPrimary(e){e!==this.primary&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] primary update"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.detachPrimary(this.primary),this.primary=e,this.attachPrimary(e),this.notifyChangeCallback(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop())}clean(){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] clean"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.detachPrimary(this.primary),this.primary=null,sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}updateSecondary(e,t,i){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] secondary update"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const n=this.secondaryPropertyCountsMap[i.id];assert&&assert(n>0,"We should always be removing at least one reference");for(let r=0;r<n;r++)this.attachSecondary(e);this.notifyChangeCallback(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}attachPrimary(e){if(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] attachPrimary"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),it(e))sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] add Property listener"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.secondaryLazyLinkProperty(e),this.attachSecondary(e.get()),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop();else if(e instanceof Me)sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] Color changed to immutable"),e.setImmutable();else if(e instanceof ls){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] add Gradient listeners"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();for(let t=0;t<e.stops.length;t++)this.attachPrimary(e.stops[t].color);sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}detachPrimary(e){if(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] detachPrimary"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),it(e))sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] remove Property listener"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.secondaryUnlinkProperty(e),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop();else if(e instanceof ls){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] remove Gradient listeners"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();for(let t=0;t<e.stops.length;t++)this.detachPrimary(e.stops[t].color);sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}attachSecondary(e){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] attachSecondary"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),e instanceof Me&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] Color set to immutable"),e.setImmutable()),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}notifyChanged(){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints("[PaintObserver] changed"),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.primary instanceof ls&&this.primary.invalidateCanvasGradient(),this.changeCallback(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}secondaryLazyLinkProperty(e){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[PaintObserver] secondaryLazyLinkProperty ${e._id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const t=e.id;this.secondaryPropertyCountsMap[t]?this.secondaryPropertyCountsMap[t]++:(this.secondaryPropertyCountsMap[t]=1,e.lazyLink(this.updateSecondaryListener)),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}secondaryUnlinkProperty(e){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[PaintObserver] secondaryUnlinkProperty ${e._id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const t=e.id,i=--this.secondaryPropertyCountsMap[t];assert&&assert(i>=0,"We should have had a reference before"),i===0&&(delete this.secondaryPropertyCountsMap[t],e.isDisposed||e.unlink(this.updateSecondaryListener)),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}}q.register("PaintObserver",fa);class uv extends ei{constructor(e,t){const i=xn.toColor(e),n=je()({luminanceFactor:0,valueComparisonStrategy:"equalsFunction"},t);super(i,n),this._paint=null,this._luminanceFactor=n.luminanceFactor,this._changeListener=this.invalidatePaint.bind(this),this._paintObserver=new fa(this._changeListener),this.setPaint(e)}setPaint(e){assert&&assert(xn.isPaintDef(e)),this._paint=e,this._paintObserver.setPrimary(e)}set paint(e){this.setPaint(e)}get paint(){return this.getPaint()}getPaint(){return this._paint}setLuminanceFactor(e){assert&&assert(e>=-1&&e<=1),this.luminanceFactor!==e&&(this._luminanceFactor=e,this.invalidatePaint())}set luminanceFactor(e){this.setLuminanceFactor(e)}get luminanceFactor(){return this.getLuminanceFactor()}getLuminanceFactor(){return this._luminanceFactor}invalidatePaint(){this.value=xn.toColor(this._paint).colorUtilsBrightness(this._luminanceFactor)}dispose(){this.paint=null,super.dispose()}}q.register("PaintColorProperty",uv);class wf{constructor(){this.initialize()}initialize(){this.svgBlock=null,this.fillStyle="none",this.strokeStyle="none",this.fillPaint=null,this.strokePaint=null,this.updateBaseStyle(),this.strokeDetailStyle=""}dispose(){this.releaseFillPaint(),this.releaseStrokePaint()}releaseFillPaint(){this.fillPaint&&(this.svgBlock.decrementPaint(this.fillPaint),this.fillPaint=null)}releaseStrokePaint(){this.strokePaint&&(this.svgBlock.decrementPaint(this.strokePaint),this.strokePaint=null)}updateFill(e,t){assert&&assert(this.svgBlock===e);const i=sp(t,e);t!==this.fillPaint&&(this.releaseFillPaint(),t&&t.isPaint&&(this.fillPaint=t,e.incrementPaint(t))),i!==this.fillStyle&&(this.fillStyle=i,this.updateBaseStyle())}updateStroke(e,t){assert&&assert(this.svgBlock===e);const i=sp(t,e);t!==this.strokePaint&&(this.releaseStrokePaint(),t&&t.isPaint&&(this.strokePaint=t,e.incrementPaint(t))),i!==this.strokeStyle&&(this.strokeStyle=i,this.updateBaseStyle())}updateBaseStyle(){this.baseStyle=`fill: ${this.fillStyle}; stroke: ${this.strokeStyle};`}updateStrokeDetailStyle(e){let t="";const i=e.getLineWidth();i!==1&&(t+=`stroke-width: ${i};`);const n=e.getLineCap();n!=="butt"&&(t+=`stroke-linecap: ${n};`);const r=e.getLineJoin();r!=="miter"&&(t+=`stroke-linejoin: ${r};`);const h=e.getMiterLimit();t+=`stroke-miterlimit: ${h};`,e.hasLineDash()&&(t+=`stroke-dasharray: ${e.getLineDash().join(",")};`,t+=`stroke-dashoffset: ${e.getLineDashOffset()};`),this.strokeDetailStyle=t}updateSVGBlock(e){const t=this.svgBlock;t&&(this.fillPaint&&t.decrementPaint(this.fillPaint),this.strokePaint&&t.decrementPaint(this.strokePaint)),this.svgBlock=e,this.fillPaint&&e.incrementPaint(this.fillPaint),this.strokePaint&&e.incrementPaint(this.strokePaint)}}function sp(l,e){return l?l.toCSS?l.toCSS():l.isPaint?`url(#${l.id}-${e?e.id:"noblock"})`:l:"none"}q.register("PaintSVGState",wf);const Fa=new Me("transparent"),ro=class ro{constructor(e,t,i){this.lastColor=null,this.initialize(e,t,i)}isActiveSVGGradientStop(){return!!this.svgGradient}initialize(e,t,i){return sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] initialize: ${e.gradient.id} : ${t}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.svgGradient=e,this.color=i,this.ratio=t,this.svgElement=this.svgElement||document.createElementNS(Gt,"stop"),this.svgElement.setAttribute("offset",""+t),this.dirty=!0,this.update(),this.propertyListener=this.propertyListener||this.onPropertyChange.bind(this),this.colorListener=this.colorListener||this.markDirty.bind(this),it(i)?(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] adding Property listener: ${this.svgGradient.gradient.id} : ${this.ratio}`),i.lazyLink(this.propertyListener),i.value instanceof Me&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] adding Color listener: ${this.svgGradient.gradient.id} : ${this.ratio}`),i.value.changeEmitter.addListener(this.colorListener),this.lastColor=i.value)):i instanceof Me&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] adding Color listener: ${this.svgGradient.gradient.id} : ${this.ratio}`),i.changeEmitter.addListener(this.colorListener)),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop(),this}onPropertyChange(e,t){assert&&assert(this.isActiveSVGGradientStop());const i=this;this.lastColor!==null&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] removing Color listener: ${i.svgGradient.gradient.id} : ${this.ratio}`),this.lastColor.changeEmitter.removeListener(this.colorListener),this.lastColor=null),e instanceof Me&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] adding Color listener: ${i.svgGradient.gradient.id} : ${this.ratio}`),e.changeEmitter.addListener(this.colorListener),this.lastColor=e),this.markDirty()}markDirty(){assert&&assert(this.isActiveSVGGradientStop()),this.dirty=!0,this.svgGradient.markDirty()}update(){if(!this.dirty)return;this.dirty=!1,assert&&assert(this.isActiveSVGGradientStop());const e=this;sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] update: ${e.svgGradient.gradient.id} : ${this.ratio}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();let t=this.color;it(t)&&(t=t.value),t===null&&(t="transparent"),typeof t=="string"?Fa.setCSS(t):Fa.set(t);const i=`stop-opacity: ${Fa.a.toFixed(20)};`;Fa.alpha=1;const n=`stop-color: ${Fa.toCSS()};`;this.svgElement.setAttribute("style",`${n} ${i}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}dispose(){assert&&assert(this.isActiveSVGGradientStop());const e=this;sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] dispose: ${e.svgGradient.gradient.id} : ${this.ratio}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const t=this.color;this.lastColor&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] removing Color listener: ${e.svgGradient.gradient.id} : ${this.ratio}`),this.lastColor.changeEmitter.removeListener(this.colorListener),this.lastColor=null),it(t)?(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] removing Property listener: ${e.svgGradient.gradient.id} : ${this.ratio}`),t.hasListener(this.propertyListener)&&t.unlink(this.propertyListener)):t instanceof Me&&(sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradientStop] removing Color listener: ${e.svgGradient.gradient.id} : ${this.ratio}`),t.changeEmitter.removeListener(this.colorListener)),this.color=null,this.svgGradient=null,this.freeToPool(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}freeToPool(){ro.pool.freeToPool(this)}};ro.pool=new cs(ro);let gl=ro;q.register("SVGGradientStop",gl);class yu{constructor(e,t){this.initialize(e,t)}isActiveSVGGradient(){return!!this.svgBlock}initialize(e,t){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradient] initialize ${t.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.svgBlock=e,this.gradient=t;const i=this.definition!==void 0;this.definition=this.definition||this.createDefinition(),i||this.definition.setAttribute("gradientUnits","userSpaceOnUse"),t.transformMatrix?this.definition.setAttribute("gradientTransform",t.transformMatrix.getSVGTransform()):this.definition.removeAttribute("gradientTransform");const n=t.getSVGStops();this.stops=Bt(this.stops);for(let r=0;r<n.length;r++){const h=new gl(this,n[r].ratio,n[r].color);this.stops.push(h),this.definition.appendChild(h.svgElement)}this.dirty=!1,sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}markDirty(){if(!this.dirty){assert&&assert(this.isActiveSVGGradient());const e=this;sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradient] switched to dirty: ${this.gradient.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),this.dirty=!0,e.svgBlock.markDirtyGradient(this),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}}update(){if(this.dirty){this.dirty=!1,sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradient] update: ${this.gradient.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();for(let e=0;e<this.stops.length;e++)this.stops[e].update();sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}}dispose(){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGGradient] dispose ${this.gradient.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();for(let e=0;e<this.stops.length;e++){const t=this.stops[e];this.definition.removeChild(t.svgElement),t.dispose()}Bt(this.stops),this.svgBlock=null,this.gradient=null,this.freeToPool(),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop()}}q.register("SVGGradient",yu);const ao=class ao extends yu{constructor(e,t){super(e,t)}initialize(e,t){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGLinearGradient] initialize ${t.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),super.initialize(e,t);const i=t;return this.definition.setAttribute("x1",""+i.start.x),this.definition.setAttribute("y1",""+i.start.y),this.definition.setAttribute("x2",""+i.end.x),this.definition.setAttribute("y2",""+i.end.y),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop(),this}createDefinition(){return document.createElementNS(Gt,"linearGradient")}freeToPool(){ao.pool.freeToPool(this)}};ao.pool=new cs(ao);let fl=ao;q.register("SVGLinearGradient",fl);const oo=class oo extends yu{constructor(e,t){super(e,t)}initialize(e,t){return sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGRadialGradient] initialize ${t.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push(),super.initialize(e,t),this.definition.setAttribute("cx",""+t.largePoint.x),this.definition.setAttribute("cy",""+t.largePoint.y),this.definition.setAttribute("r",""+t.maxRadius),this.definition.setAttribute("fx",""+t.focalPoint.x),this.definition.setAttribute("fy",""+t.focalPoint.y),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop(),this}createDefinition(){return document.createElementNS(Gt,"radialGradient")}freeToPool(){oo.pool.freeToPool(this)}};oo.pool=new cs(oo);let ml=oo;q.register("SVGRadialGradient",ml);const lo=class lo{constructor(e){this.initialize(e)}initialize(e){sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`[SVGPattern] initialize: ${e.id}`),sceneryLog&&sceneryLog.Paints&&sceneryLog.push();const t=this.definition!==void 0;return this.definition=this.definition||document.createElementNS(Gt,"pattern"),t||(this.definition.setAttribute("patternUnits","userSpaceOnUse"),this.definition.setAttribute("patternContentUnits","userSpaceOnUse")),e.transformMatrix?this.definition.setAttribute("patternTransform",e.transformMatrix.getSVGTransform()):this.definition.removeAttribute("patternTransform"),this.definition.setAttribute("x","0"),this.definition.setAttribute("y","0"),this.definition.setAttribute("width",""+e.image.width),this.definition.setAttribute("height",""+e.image.height),this.imageElement=this.imageElement||document.createElementNS(Gt,"image"),this.imageElement.setAttribute("x","0"),this.imageElement.setAttribute("y","0"),this.imageElement.setAttribute("width",`${e.image.width}px`),this.imageElement.setAttribute("height",`${e.image.height}px`),this.imageElement.setAttributeNS(ia,"xlink:href",e.image.src),t||this.definition.appendChild(this.imageElement),sceneryLog&&sceneryLog.Paints&&sceneryLog.pop(),this}update(){}dispose(){this.freeToPool()}freeToPool(){lo.pool.freeToPool(this)}};lo.pool=new cs(lo);let yl=lo;q.register("SVGPattern",yl);class Cf{constructor(e,t){this._matrices=null,this._dirtyIndex=0,this._listeners=[],this._nodeTransformListeners=[];const i=je()({isStatic:!1},t);this._isStatic=i.isStatic,this.trail=e,this._nodeTransformListeners=[];for(let n=1;n<this.trail.length;n++){const r=(h=>()=>{this.onTransformChange(h)})(n-1);this._nodeTransformListeners.push(r),e.nodes[n].transformEmitter.addListener(r)}}dispose(){for(let e=1;e<this.trail.length;e++){const t=this._nodeTransformListeners[e-1];this.trail.nodes[e].transformEmitter.hasListener(t)&&this.trail.nodes[e].transformEmitter.removeListener(t)}}addListener(e){this._listeners.push(e)}removeListener(e){const t=_.indexOf(this._listeners,e);assert&&assert(t>=0,"TransformTracker listener not found"),this._listeners.splice(t,1)}notifyListeners(){let e=this._listeners;this._isStatic||(e=e.slice());const t=e.length;for(let i=0;i<t;i++)e[i]()}onTransformChange(e){this._dirtyIndex=Math.min(this._dirtyIndex,e),this.notifyListeners()}getMatrix(){if(this._matrices===null){this._matrices=[];for(let t=1;t<this.trail.length;t++)this._matrices.push(new $e)}if(this._matrices.length<=0)return $e.IDENTITY;const e=this._matrices.length;for(let t=this._dirtyIndex;t<e;t++){const i=this.trail.nodes[t+1].matrix;t===0?this._matrices[t].set(i):(this._matrices[t].set(this._matrices[t-1]),this._matrices[t].multiplyMatrix(i))}return this._dirtyIndex=e,this._matrices[e-1]}get matrix(){return this.getMatrix()}}q.register("TransformTracker",Cf);const kr=Cf;class Tf{constructor(e,t){t=ns({isStatic:!1},t),this.isStatic=t.isStatic,this.trail=e,this._listeners=[],this.trailVisibleProperty=new vt(this.trail.isVisible()),this._nodeVisibilityListeners=[];for(let i=0;i<this.trail.length;i++){const n=()=>{this.trailVisibleProperty.set(e.isVisible())};this._nodeVisibilityListeners.push(n),e.nodes[i].visibleProperty.link(n)}this.boundTrailVisibilityChangedListener=this.onVisibilityChange.bind(this),this.trailVisibleProperty.link(this.boundTrailVisibilityChangedListener)}addListener(e){assert&&assert(typeof e=="function"),this._listeners.push(e)}removeListener(e){assert&&assert(typeof e=="function");const t=_.indexOf(this._listeners,e);assert&&assert(t>=0,"TrailVisibilityTracker listener not found"),this._listeners.splice(t,1)}dispose(){for(let e=0;e<this.trail.length;e++){const t=this._nodeVisibilityListeners[e];this.trail.nodes[e].visibleProperty.hasListener(t)&&this.trail.nodes[e].visibleProperty.removeListener(t)}this.trailVisibleProperty.unlink(this.boundTrailVisibilityChangedListener)}onVisibilityChange(){this.notifyListeners()}notifyListeners(){let e=this._listeners;this._isStatic||(e=e.slice());const t=e.length;for(let i=0;i<t;i++)e[i]()}}q.register("TrailVisibilityTracker",Tf);const dv={mutateNode(l,e){e?l.setPDOMAttribute("aria-haspopup",e):(assert&&assert(l.hasPDOMAttribute("aria-haspopup"),"Set aria-haspopup once before removing it."),l.removePDOMAttribute("aria-haspopup")),l.positionInPDOM=!!e}};q.register("AriaHasPopUpMutator",dv);class pv extends Ge{constructor(e){const t=je()({headingLevel:1},e);super(t),this.tagName=`h${t.headingLevel}`,this.focusHighlight="invisible";const i={blur:()=>{this.focusable=!1}};this.addInputListener(i),this.disposeFocusableHeadingNode=()=>{this.removeInputListener(i)}}focus(){this.focusable=!0,super.focus()}dispose(){this.disposeFocusableHeadingNode(),super.dispose()}}q.register("FocusableHeadingNode",pv);const Ji=" ",ol="End of Document",ln=",",Ha=15,es="NEXT",Lr="PREVIOUS";class gv{constructor(e){const t=this;this.outputUtteranceProperty=new ei(new Va(document.title,"off")),this.linearDOM=this.getLinearDOMElements(e),this.activeElement=null,this.activeLine=null,this.letterPosition=0,this.positionInLine=0,this.wordPosition=0,this.observers=[],this.keyState={},document.addEventListener("keydown",i=>{this.keyState[i.keyCode]=!0;let n;const h=i.shiftKey?Lr:es;if(this.linearDOM=this.getLinearDOMElements(e),this.updateLiveElementList(),!(this.activeElement&&this.activeElement.getAttribute("role")==="application")){if(this.keyState[40]&&!this.keyState[45])n=this.readNextPreviousLine(es);else if(this.keyState[38]&&!this.keyState[45])n=this.readNextPreviousLine(Lr);else if(this.keyState[72]){const p=["H1","H2","H3","H4","H5","H6"];n=this.readNextPreviousHeading(p,h)}else this.keyState[9]||(this.keyState[39]&&!this.keyState[17]?n=this.readNextPreviousCharacter(es):this.keyState[37]&&!this.keyState[17]?n=this.readNextPreviousCharacter(Lr):this.keyState[37]&&this.keyState[17]?n=this.readNextPreviousWord(Lr):this.keyState[39]&&this.keyState[17]?n=this.readNextPreviousWord(es):this.keyState[45]&&this.keyState[38]?n=this.readActiveLine():this.keyState[49]?n=this.readNextPreviousHeading(["H1"],h):this.keyState[50]?n=this.readNextPreviousHeading(["H2"],h):this.keyState[51]?n=this.readNextPreviousHeading(["H3"],h):this.keyState[52]?n=this.readNextPreviousHeading(["H4"],h):this.keyState[53]?n=this.readNextPreviousHeading(["H5"],h):this.keyState[54]?n=this.readNextPreviousHeading(["H6"],h):this.keyState[70]?n=this.readNextPreviousFormElement(h):this.keyState[66]?n=this.readNextPreviousButton(h):this.keyState[76]?n=this.readNextPreviousList(h):this.keyState[73]?n=this.readNextPreviousListItem(h):this.keyState[45]&&this.keyState[40]&&this.readEntireDocument());this.activeElement&&this.isFocusable(this.activeElement)&&this.activeElement.focus(),n===Ji&&(n="space"),n&&this.outputUtteranceProperty.set(new Va(n,"off"))}}),document.addEventListener("keyup",i=>{this.keyState[i.keyCode]=!1}),document.addEventListener("focusin",function(i){if(i.target!==t.activeElement){t.activeElement=i.target;const r=t.getAccessibleText(this.activeElement,!0);if(r){const h=t.activeElement.getAttribute("aria-live");t.outputUtteranceProperty.set(new Va(r,h))}}})}getLinearDOMElements(e){const t=e.getElementsByTagName("*"),i=[];for(let n=0;n<t.length;n++)t[n].nodeType===Node.ELEMENT_NODE&&(i[n]=t[n]);return i}getLiveRole(e){let t=null;return["log","status","alert","progressbar","marquee","timer","assertive","polite"].forEach(n=>{(e.getAttribute("aria-live")===n||e.getAttribute("role")===n)&&(t=n)}),t}getNextPreviousElement(e){this.activeElement||(this.activeElement=this.linearDOM[0]);const t=e==="NEXT"?1:-1,n=this.linearDOM.indexOf(this.activeElement)+t;return this.linearDOM[n]}getLabel(e){const t=document.getElementsByTagName("label");let i;return Array.prototype.forEach.call(t,n=>{n.getAttribute("for")&&(i=n)}),assert&&assert(i,"No label found for id"),i}getAccessibleText(e,t){let i="";if(!e)return ol;if(e.getAttribute("class")==="ScreenView"||e.tagName==="HEADER"||e.tagName==="SECTION"||e.tagName==="LABEL")return null;let n=e;for(;n.parentElement;){if(n.getAttribute("aria-hidden")||n.hidden)return null;n=n.parentElement}if(e.tagName==="P"&&(i+=e.textContent),e.tagName==="H1"&&(i+=`Heading Level 1, ${e.textContent}`),e.tagName==="H2"&&(i+=`Heading Level 2, ${e.textContent}`),e.tagName==="H3"&&(i+=`Heading Level 3, ${e.textContent}`),e.tagName==="UL"){const r=e.children.length;i+=`List with ${r} items`}if(e.tagName==="LI"&&(i+=`List Item: ${e.textContent}`),e.tagName==="BUTTON"){const r=" Button";if(e.getAttribute("aria-pressed")){let h=" toggle";const p=" pressed",S=" not";h+=r+ln,e.getAttribute("aria-pressed")==="true"?h+=p:h+=S+p,i+=e.textContent+ln+h}else i+=e.textContent+r}if(e.tagName==="INPUT"&&(e.type==="reset"&&(i+=`${e.getAttribute("value")} Button`),e.type==="checkbox")){const h=this.getLabel(e.id).textContent;if(e.getAttribute("role")==="switch"){const p=e.getAttribute("aria-checked");if(p){const S=p==="true"?"On":"Off";i+=`${h+ln+Ji}switch${ln}${Ji}${S}`}else assert&&assert(!1,"checkbox switch must have aria-checked attribute")}else{const p=e.checked?" Checked":" Not Checked";i+=`${e.textContent} Checkbox${p}`}}if(t){i.length>0&&(i+=ln);const r=e.getAttribute("aria-label");r&&(i+=Ji+r+ln);const h=e.getAttribute("aria-labelledBy");if(h){const B=document.getElementById(h).textContent;i+=Ji+B+ln}n=e;let p;for(;n.parentElement;)if(p=n.getAttribute("role"),p==="document"||p==="application"){i+=Ji+p+ln;break}else n=n.parentElement;e.getAttribute("role")&&(p=e.getAttribute("role"),p==="button"&&(i+=`${Ji}Button`)),e.draggable&&(i+=`${Ji}draggable${ln}`),e.getAttribute("aria-grabbed")==="true"&&(i+=`${Ji}grabbed${ln}`);const S=e.getAttribute("aria-describedby");if(S){const C=S.split(Ji);let B,U;C.forEach(k=>{B=document.getElementById(k),U=B.textContent,i+=Ji+U})}}return i[i.length-1]===","&&(i=i.slice(0,-1)),i}getNextPreviousElementWithPDOMContent(e){let t;for(;!t;)this.activeElement=this.getNextPreviousElement(e),t=this.getAccessibleText(this.activeElement,!1);return this.activeElement}getNextPreviousElementWithRole(e,t){let i=null;const n=t===es?1:-1;this.activeElement||(this.activeElement=this.linearDOM[0]);let r=this.linearDOM.indexOf(this.activeElement)+n;for(;this.linearDOM[r];){for(let h=0;h<e.length;h++){const p=this.linearDOM[r].tagName,S=this.linearDOM[r].type,C=this.linearDOM[r].getAttribute("role"),B=e[h];if(p===B||C===B||S===B){i=this.linearDOM[r];break}}if(i)break;r+=n}return i}readNextPreviousLine(e){let t="";this.letterPosition=0,this.wordPosition=0,this.activeElement||(this.activeElement=this.getNextPreviousElementWithPDOMContent(e));let i=this.getAccessibleText(this.activeElement,!1).split(Ji);if(e===Lr&&(this.positionInLine=this.positionInLine-2*Ha),!i[this.positionInLine]){this.positionInLine=0;const r=this.activeElement;this.activeElement=this.getNextPreviousElementWithPDOMContent(e),i=this.getAccessibleText(this.activeElement,!1).split(" "),this.activeElement||(this.activeElement=r)}const n=this.positionInLine+Ha;for(let r=this.positionInLine;r<n;r++)if(i[r])if(t+=i[r],this.positionInLine+=1,i[r+1])t+=Ji;else{this.positionInLine+=Ha-this.positionInLine%Ha;break}return this.activeLine=t,t}readActiveLine(){let e="";this.activeLine||(this.activeLine=this.readNextPreviousLine(es));const t=this.activeLine.split(Ji);for(let i=0;i<Ha;i++)if(t[i])if(e+=t[i],t[i+1])e+=Ji;else break;return e}readNextPreviousWord(e){this.activeLine||(this.activeLine=this.readNextPreviousLine(e));const t=this.activeLine.split(Ji);let i,n;e===es?(n=t.length,i=1):e===Lr&&(n=0,i=-2),this.wordPosition===n&&(this.activeLine=this.readNextPreviousLine(e));const r=t[this.wordPosition];return this.wordPosition+=i,r}readNextPreviousHeading(e,t){let i,n,r;for(;!i;)r=this.activeElement,n=this.getNextPreviousElementWithRole(e,t),this.activeElement=n,i=this.getAccessibleText(n);if(!n){this.activeElement=r;const h=t===es?"more":"previous";if(e.length===1){const p=`No ${h} headings at `,S=e[0];return p+(S==="H1"?"Level 1":S==="H2"?"Level 2":S==="H3"?"Level 3":S==="H4"?"Level 4":S==="H5"?"Level 5":"Level 6")}return`No ${h} headings`}return this.activeElement=n,i}readNextPreviousButton(e){const t=["button","BUTTON","submit","reset"];let i,n,r;for(;!n;)r=this.activeElement,i=this.getNextPreviousElementWithRole(t,e),this.activeElement=i,n=this.getAccessibleText(i,!0);return i?(this.activeElement=i,n):(this.activeElement=r,`No ${e===es?"more":"previous"} buttons`)}readNextPreviousFormElement(e){const t=["INPUT","BUTTON"],i=["button"],n=t.concat(i);let r,h,p;for(;!h;)p=this.activeElement,r=this.getNextPreviousElementWithRole(n,e),this.activeElement=r,h=this.getAccessibleText(r,!0);return h===ol?(this.activeElement=p,`No ${e===es?"next":"previous"} form field`):(this.activeElement=r,h)}readNextPreviousListItem(e){this.activeElement||(this.activeElement=this.getNextPreviousElementWithPDOMContent(e));let t;const i=this.activeElement.parentElement;if(i.tagName==="UL"||i.tagName==="OL"){const n=e===es?1:-1;let r=Array.prototype.indexOf.call(i.children,this.activeElement)+n;for(;i.children[r];){if(t=this.getAccessibleText(i.children[r]),t){this.activeElement=i.children[r];break}r+=n}t||(t=this.readNextPreviousList(e))}else t=this.readNextPreviousList(e);return t||`No ${e===es?"more":"previous"} list items`}readNextPreviousList(e){this.activeElement||(this.activeElement=this.getNextPreviousElementWithPDOMContent(e));const t=this.activeElement.parentElement;let i;(t.tagName==="UL"||t.tagName==="OL")&&(i=this.activeElement,this.activeElement=t);const n=this.getNextPreviousElementWithRole(["UL","OL"],e);if(!n)return i&&(this.activeElement=i),`No ${e===es?"more":"previous"} lists`;const r=this.getAccessibleText(n);let h="";const p=n.children[0];return p&&(h=this.getAccessibleText(p),this.activeElement=p),`${r}, ${h}`}readNextPreviousCharacter(e){this.activeLine||(this.activeLine=this.readNextPreviousLine(es));let t,i,n;e===es?(t=this.activeLine.length,i=1,n=0):e===Lr&&(t=2,i=-1,n=-2),this.letterPosition===t&&(this.activeLine=this.readNextPreviousLine(e),this.letterPosition=this.activeLine.length);const r=this.activeLine[this.letterPosition+n];return this.letterPosition+=i,r}updateLiveElementList(){for(let e=0;e<this.observers.length;e++)this.observers[e]&&this.observers[e].disconnect();this.observers=[];for(let e=0;e<this.linearDOM.length;e++){const t=this.linearDOM[e];if(this.getLiveRole(t)){const n=p=>{p.forEach(S=>{let C,B=S.target;for(;!C;)C=this.getLiveRole(B),B=B.parentElement;if(S.addedNodes[0]){const U=S.addedNodes[0].data;this.outputUtteranceProperty.set(new Va(U,C))}})},r=new MutationObserver(p=>{n(p)}),h={childList:!0,subtree:!0};r.observe(t,h),this.observers.push(r)}}}readEntireDocument(){const e="polite";let t=this.getAccessibleText(this.activeElement),i=this.activeElement;for(;t!==ol;)i=this.activeElement,t=this.readNextPreviousLine(es),t===ol&&(this.activeElement=i),this.outputUtteranceProperty.set(new Va(t,e))}isFocusable(e){const t=["tabindex","BUTTON","INPUT"];let i=!1;return t.forEach(n=>{(e.getAttribute(n)||e.tagName===n)&&(i=!0)}),i}}q.register("Cursor",gv);let Va=class{constructor(e,t){this.text=e,this.liveRole=t}};const Vh={validateValidator:!1},Df=[];assert&&Object.freeze(Df);const fv=["name","phetioType","phetioDocumentation","phetioPrivate"].concat(Hs.VALIDATOR_KEYS),np=l=>l.phetioType,mv=l=>l.name;class xo extends yi{constructor(e){var n;const t=je()({parameters:Df,hasListenerOrderDependencies:!1,phetioPlayback:yi.DEFAULT_OPTIONS.phetioPlayback,phetioEventMetadata:yi.DEFAULT_OPTIONS.phetioEventMetadata,phetioDocumentation:""},e);assert&&xo.validateParameters(t.parameters,!!((n=t.tandem)!=null&&n.supplied)),assert&&assert(t.phetioType===void 0,"PhetioDataHandler sets its own phetioType. Instead provide parameter phetioTypes through `options.parameters` with a phetioOuterType");const i=t.parameters.filter(np);t.phetioType=t.phetioOuterType(i.map(np)),t.phetioPlayback&&(t.phetioEventMetadata=t.phetioEventMetadata||{},assert&&assert(!t.phetioEventMetadata.hasOwnProperty("dataKeys"),"dataKeys should be supplied by PhetioDataHandler, not elsewhere"),t.phetioEventMetadata.dataKeys=t.parameters.map(mv)),t.phetioDocumentation=xo.getPhetioDocumentation(t.phetioDocumentation,i),super(t),this.parameters=t.parameters}static validateParameters(e,t){ir(e,{valueType:Array});let i=!1;for(let n=0;n<e.length;n++){const r=e[n];assert&&assert(Object.getPrototypeOf(r)===Object.prototype,"Extra prototype on parameter object is a code smell"),i=i||r.phetioPrivate,assert&&i&&assert(r.phetioPrivate,"after first phetioPrivate parameter, all subsequent parameters must be phetioPrivate"),assert&&t&&Ft.VALIDATION&&assert(r.phetioType||r.phetioPrivate,"instrumented Emitters must include phetioType for each parameter or be marked as `phetioPrivate`."),assert&&r.phetioType&&assert(r.name,"`name` is a required parameter for phet-io instrumented parameters."),assert&&Hi(r,["phetioPrivate"],["name","phetioType","phetioDocumentation"]),assert&&assert(_.intersection(Object.keys(r),Hs.VALIDATOR_KEYS).length>0,`validator must be specified for parameter ${n}`);for(const h in r)assert&&assert(fv.includes(h),`unrecognized parameter key: ${h}`);assert&&Object.freeze(e[n]),Hs.validateValidator(r)}assert&&Object.freeze(e)}validateArguments(...e){assert&&assert(e.length===this.parameters.length,`Emitted unexpected number of args. Expected: ${this.parameters.length} and received ${e.length}`);for(let t=0;t<this.parameters.length;t++){const i=this.parameters[t];assert&&ir(e[t],i,Vh),i.phetioType&&!i.valueType&&assert&&ir(e[t],i.phetioType.validator,Vh)}}getValidationErrors(...e){return assert&&assert(e.length===this.parameters.length,`Emitted unexpected number of args. Expected: ${this.parameters.length} and received ${e.length}`),this.parameters.map((t,i)=>Hs.getValidationError(e[i],t,Vh))}getPhetioData(...e){assert&&assert(Ft.PHET_IO_ENABLED,"should only get phet-io data in phet-io brand");let t=null;if(this.parameters.length>0){t={};for(let i=0;i<this.parameters.length;i++){const n=this.parameters[i];n.phetioPrivate||(assert&&assert(n.name,"name required"),t[n.name]=n.phetioType.toStateObject(e[i]))}}return t}static getPhetioDocumentation(e,t){const i=n=>{const r=n.phetioDocumentation?` - ${n.phetioDocumentation}`:"";return`<li>${n.name}: ${n.phetioType.typeName}${r}</li>`};return e+(t.length===0?"<br>No parameters.":`<br>The parameters are:<br/><ol>${t.map(i).join("<br/>")}</ol>`)}}hs.register("PhetioDataHandler",xo);const If=xo,rp=!1,Sr=class Sr extends If{constructor(e){const t=je()({reentrantNotificationStrategy:"stack",phetioOuterType:Sr.EmitterIO,phetioState:rp},e);super(t),this.tinyEmitter=new zt(null,t.hasListenerOrderDependencies,t.reentrantNotificationStrategy)}emit(...e){assert&&assert(this.tinyEmitter instanceof zt,"Emitter should not emit until constructor complete"),assert&&this.validateArguments(...e),Ft.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioStartEvent("emitted",{data:this.getPhetioData(...e)}),this.tinyEmitter.emit(...e),Ft.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioEndEvent()}dispose(){this.tinyEmitter.dispose(),super.dispose()}addListener(e){this.tinyEmitter.addListener(e)}removeListener(e){this.tinyEmitter.removeListener(e)}removeAllListeners(){this.tinyEmitter.removeAllListeners()}hasListener(e){return this.tinyEmitter.hasListener(e)}hasListeners(){return this.tinyEmitter.hasListeners()}getListenerCount(){return this.tinyEmitter.getListenerCount()}debug(e){const t=(...i)=>console.log(e,...i);return this.addListener(t),t}};Sr.EmitterIO=e=>{const t=e.map(ap).join(",");return Gh.has(t)||Gh.set(t,new li(`EmitterIO<${e.map(ap).join(", ")}>`,{valueType:Sr,documentation:"Emits when an event occurs and calls added listeners.",parameterTypes:e,events:["emitted"],metadataDefaults:{phetioState:rp},methods:{addListener:{returnType:Ds,parameterTypes:[lc(Ds,e)],implementation:Sr.prototype.addListener,documentation:"Adds a listener which will be called when the emitter emits."},removeListener:{returnType:Ds,parameterTypes:[lc(Ds,e)],implementation:Sr.prototype.removeListener,documentation:"Remove a listener."},emit:{returnType:Ds,parameterTypes:e,implementation:function(...i){this.emit(...i)},documentation:"Emits a single event to all listeners.",invocableForReadOnlyElements:!1},getValidationErrors:{returnType:Mo(Lt(si)),parameterTypes:e,implementation:function(...i){return this.getValidationErrors(...i)},documentation:"Checks to see if the proposed values are valid. Returns an array of length N where each element is an error (string) or null if the value is valid."}}})),Gh.get(t)};let Yi=Sr;const ap=l=>l.typeName,Gh=new va;hs.register("Emitter",Yi);class yv{constructor(e){this.speakingStartedEmitter=new Yi({parameters:[{valueType:Object}]}),this.speakingEndedEmitter=new Yi({parameters:[{valueType:Object}]}),this.speaking=!1,this.politeUtterances=[];const t=navigator.userAgent,i=t.match(/Windows/),n=!!(t.match(/Version\/[5-9]\./)&&t.match(/Safari\//)&&t.match(/AppleWebKit/));self.speechSynthesis&&SpeechSynthesisUtterance&&self.speechSynthesis.speak?(this.synth=self.speechSynthesis,e.outputUtteranceProperty.link(r=>{const h=new SpeechSynthesisUtterance(r.text);h.addEventListener("start",S=>{this.speakingStartedEmitter.emit(r)}),h.addEventListener("end",S=>{this.speakingEndedEmitter.emit(r)});let p;if(this.synth.getVoices().forEach(S=>{S.default&&(p=S)}),h.voice=p,h.rate=1.2,r.liveRole==="assertive"||r.liveRole==="off"||!r.liveRole)this.politeUtterances=[],this.speaking=!0,i?(this.synth.pause(),this.synth.cancel(),this.synth.speak(h),this.synth.resume()):(this.synth.cancel(),this.synth.speak(h));else if(r.liveRole==="polite")if(n){this.politeUtterances.push(h);const S=()=>{this.speaking=!0;const C=this.politeUtterances.shift();C?this.synth.speak(C):this.speaking=!1};if(this.speaking)setTimeout(()=>{S()},2e3);else{this.synth.speak(h);const C=this.politeUtterances.indexOf(h);C>0&&this.politeUtterances.splice(C,1)}}else this.synth.speak(h)})):e.outputUtteranceProperty.link(()=>{this.speakingStartedEmitter.emit({text:"Sorry! Web Speech API not supported on this platform."})})}}q.register("Reader",yv);const bv=[],op=!1,ho=class ho extends If{constructor(e,t){var n;const i=je()({parameters:bv,phetioOuterType:ho.PhetioActionIO,phetioState:op,phetioReadOnly:yi.DEFAULT_OPTIONS.phetioReadOnly,phetioHighFrequency:yi.DEFAULT_OPTIONS.phetioHighFrequency,phetioEventType:yi.DEFAULT_OPTIONS.phetioEventType,phetioDocumentation:"A class that wraps a function, adding API to execute that function and data stream capture."},t);super(i),this.action=e,this.isExecutingCount=0,this.disposeOnExecuteCompletion=!1,this.executedEmitter=new Yi({parameters:i.parameters,tandem:(n=i.tandem)==null?void 0:n.createTandem("executedEmitter"),hasListenerOrderDependencies:i.hasListenerOrderDependencies,phetioState:i.phetioState,phetioReadOnly:i.phetioReadOnly,phetioHighFrequency:i.phetioHighFrequency,phetioEventType:i.phetioEventType,phetioDocumentation:"Emitter that emits when this actions work is complete"}),this.disposePhetioAction=()=>{this.executedEmitter.dispose()}}execute(...e){assert&&assert(!this.isDisposed,"should not be called if disposed"),assert&&assert(!this.executedEmitter.isDisposed,"self should not be disposed"),this.isExecutingCount++,assert&&super.validateArguments(...e),Ft.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioStartEvent("executed",{data:this.getPhetioData(...e)}),this.action.apply(null,e),this.executedEmitter.emit(...e),Ft.PHET_IO_ENABLED&&this.isPhetioInstrumented()&&this.phetioEndEvent(),this.isExecutingCount--,this.disposeOnExecuteCompletion&&this.isExecutingCount===0&&(this.disposePhetioAction(),this.disposeOnExecuteCompletion=!1)}dispose(){this.isExecutingCount>0?this.disposeOnExecuteCompletion=!0:this.disposePhetioAction(),super.dispose()}};ho.PhetioActionIO=e=>{const t=e.map(lp).join(",");return zh.has(t)||zh.set(t,new li(`PhetioActionIO<${e.map(lp).join(", ")}>`,{valueType:ho,documentation:"Executes when an event occurs",events:["executed"],parameterTypes:e,metadataDefaults:{phetioState:op},methods:{execute:{returnType:Ds,parameterTypes:e,implementation:function(...i){this.execute(...i)},documentation:"Executes the function the PhetioAction is wrapping.",invocableForReadOnlyElements:!1},getValidationErrors:{returnType:Mo(Lt(si)),parameterTypes:e,implementation:function(...i){return this.getValidationErrors(...i)},documentation:"Checks to see if the proposed values are valid. Returns an array of length N where each element is an error (string) or null if the value is valid."}}})),zh.get(t)};let bl=ho;const lp=l=>l.typeName,zh=new va;dr.register("PhetioAction",bl);const xt=bl,xf=new fy;hs.register("stepTimer",xf);const Gi=xf;class Ef{constructor(e){var i,n;this.keyState={},this._lastKeyDown=null,this.attachedToDocument=!1,this.documentKeyupListener=null,this.documentKeydownListener=null,this.documentBlurListener=null,this._enabled=!0,this.keydownEmitter=new Yi({parameters:[{valueType:KeyboardEvent}]}),this.keyupEmitter=new Yi({parameters:[{valueType:KeyboardEvent}]}),this.keyDownStateChangedEmitter=new Yi({parameters:[{valueType:[KeyboardEvent,null]}]}),this.keydownUpdateAction=new xt(r=>{const h=me.getEventCode(r);if(h){if(this.correctModifierKeys(r),assert&&!me.isShiftKey(r)&&assert(r.shiftKey===this.shiftKeyDown,"shift key inconsistency between event and keyState."),assert&&!me.isAltKey(r)&&assert(r.altKey===this.altKeyDown,"alt key inconsistency between event and keyState."),assert&&!me.isControlKey(r)&&assert(r.ctrlKey===this.ctrlKeyDown,"ctrl key inconsistency between event and keyState."),assert&&!me.isMetaKey(r)&&assert(r.metaKey===this.metaKeyDown,"meta key inconsistency between event and keyState."),!this.isKeyDown(h)){const p=me.getEventCode(r);assert&&assert(p,"Could not find key from domEvent"),this.keyState[p]={key:p,timeDown:0}}this._lastKeyDown=h,this.keydownEmitter.emit(r),this.keyDownStateChangedEmitter.emit(r)}},{phetioPlayback:!0,tandem:(i=e==null?void 0:e.tandem)==null?void 0:i.createTandem("keydownUpdateAction"),parameters:[{name:"event",phetioType:rr}],phetioEventType:Nt.USER,phetioDocumentation:"Action that executes whenever a keydown occurs from the input listeners this keyStateTracker adds (most likely to the document)."}),this.keyupUpdateAction=new xt(r=>{const h=me.getEventCode(r);h&&(this.correctModifierKeys(r),this.isKeyDown(h)&&delete this.keyState[h],_i.mac&&me.isMetaKey(r)&&this.clearState(!0),this.keyupEmitter.emit(r),this.keyDownStateChangedEmitter.emit(r))},{phetioPlayback:!0,tandem:(n=e==null?void 0:e.tandem)==null?void 0:n.createTandem("keyupUpdateAction"),parameters:[{name:"event",phetioType:rr}],phetioEventType:Nt.USER,phetioDocumentation:"Action that executes whenever a keyup occurs from the input listeners this keyStateTracker adds (most likely to the document)."});const t=this.step.bind(this);Gi.addListener(t),this.disposeKeyStateTracker=()=>{Gi.removeListener(t),this.attachedToDocument&&this.detachFromDocument()}}keydownUpdate(e){this.enabled&&this.keydownUpdateAction.execute(e)}correctModifierKeys(e){const t=me.getEventCode(e);assert&&assert(t,"key not found from domEvent");let i=!1;e.shiftKey&&!me.isShiftKey(e)&&!this.shiftKeyDown&&(i=i||!this.keyState[me.KEY_SHIFT_LEFT],this.keyState[me.KEY_SHIFT_LEFT]={key:t,timeDown:0}),e.altKey&&!me.isAltKey(e)&&!this.altKeyDown&&(i=i||!this.keyState[me.KEY_ALT_LEFT],this.keyState[me.KEY_ALT_LEFT]={key:t,timeDown:0}),e.ctrlKey&&!me.isControlKey(e)&&!this.ctrlKeyDown&&(i=i||!this.keyState[me.KEY_CONTROL_LEFT],this.keyState[me.KEY_CONTROL_LEFT]={key:t,timeDown:0}),e.metaKey&&!me.isMetaKey(e)&&!this.metaKeyDown&&(i=i||!this.keyState[me.KEY_META_LEFT],this.keyState[me.KEY_META_LEFT]={key:t,timeDown:0}),!e.shiftKey&&this.shiftKeyDown&&(i=i||!!this.keyState[me.KEY_SHIFT_LEFT]||!!this.keyState[me.KEY_SHIFT_RIGHT],delete this.keyState[me.KEY_SHIFT_LEFT],delete this.keyState[me.KEY_SHIFT_RIGHT]),!e.altKey&&this.altKeyDown&&(i=i||!!this.keyState[me.KEY_ALT_LEFT]||!!this.keyState[me.KEY_ALT_RIGHT],delete this.keyState[me.KEY_ALT_LEFT],delete this.keyState[me.KEY_ALT_RIGHT]),!e.ctrlKey&&this.ctrlKeyDown&&(i=i||!!this.keyState[me.KEY_CONTROL_LEFT]||!!this.keyState[me.KEY_CONTROL_RIGHT],delete this.keyState[me.KEY_CONTROL_LEFT],delete this.keyState[me.KEY_CONTROL_RIGHT]),!e.metaKey&&this.metaKeyDown&&(i=i||me.META_KEYS.some(n=>!!this.keyState[n]),me.META_KEYS.forEach(n=>{delete this.keyState[n]})),i&&this.keyDownStateChangedEmitter.emit(e)}keyupUpdate(e){this.enabled&&this.keyupUpdateAction.execute(e)}get movementKeysDown(){return this.isAnyKeyInListDown(me.MOVEMENT_KEYS)}getLastKeyDown(){return this._lastKeyDown}isKeyDown(e){return!!this.keyState[e]}isEnglishKeyDown(e){return this.isAnyKeyInListDown(sa[e])}getKeysDown(){return Object.keys(this.keyState)}getEnglishKeysDown(){const e=new Set;for(const t of this.getKeysDown()){const i=Fg(t);i&&e.add(i)}return e}isAnyKeyInListDown(e){for(let t=0;t<e.length;t++)if(this.isKeyDown(e[t]))return!0;return!1}areKeysDown(e){for(let i=0;i<e.length;i++)if(!this.isKeyDown(e[i]))return!1;return!0}areKeysExclusivelyDown(e){const t=Object.keys(this.keyState);if(t.length!==e.length)return!1;let i=!0;for(let n=0;n<e.length;n++){const r=e[n];let h=[r];me.isModifierKey(r)&&(h=me.MODIFIER_KEY_TO_CODE_MAP.get(r)),_.intersection(t,h).length===0&&(i=!1)}return i}areKeysDownWithoutExtraModifiers(e){for(let t=0;t<me.MODIFIER_KEY_CODES.length;t++){const i=me.MODIFIER_KEY_CODES[t];if(this.isKeyDown(i)&&!e.includes(i))return!1}return this.areKeysDown(e)}keysAreDown(){return Object.keys(this.keyState).length>0}get enterKeyDown(){return this.isKeyDown(me.KEY_ENTER)}get shiftKeyDown(){return this.isAnyKeyInListDown(me.SHIFT_KEYS)}get altKeyDown(){return this.isAnyKeyInListDown(me.ALT_KEYS)}get ctrlKeyDown(){return this.isAnyKeyInListDown(me.CONTROL_KEYS)}get metaKeyDown(){return this.isAnyKeyInListDown(me.META_KEYS)}timeDownForKey(e){return assert&&assert(this.isKeyDown(e),"cannot get timeDown on a key that is not pressed down"),this.keyState[e].timeDown}clearState(e){this.keyState={},e||this.keyDownStateChangedEmitter.emit(null)}step(e){if(this.keysAreDown()){const t=e*1e3;for(const i in this.keyState)this.keyState[i]&&(this.keyState[i].timeDown+=t)}}attachToWindow(){assert&&assert(!this.attachedToDocument,"KeyStateTracker is already attached to document."),this.documentKeydownListener=t=>{this.keydownUpdate(t)},this.documentKeyupListener=t=>{this.keyupUpdate(t)},this.documentBlurListener=t=>{this.clearState()};const e=()=>{self.addEventListener("keyup",this.documentKeyupListener,{capture:!0}),self.addEventListener("keydown",this.documentKeydownListener,{capture:!0}),self.addEventListener("blur",this.documentBlurListener,{capture:!0}),this.attachedToDocument=!0};if(document)e();else{const t=()=>{e(),self.removeEventListener("load",t)};self.addEventListener("load",t)}}setEnabled(e){this._enabled!==e&&(this._enabled=e,!e&&this.clearState())}set enabled(e){this.setEnabled(e)}get enabled(){return this.isEnabled()}isEnabled(){return this._enabled}detachFromDocument(){assert&&assert(this.attachedToDocument,"KeyStateTracker is not attached to self."),assert&&assert(this.documentKeyupListener,"keyup listener was not created or attached to window"),assert&&assert(this.documentKeydownListener,"keydown listener was not created or attached to self."),assert&&assert(this.documentBlurListener,"blur listener was not created or attached to self."),self.removeEventListener("keyup",this.documentKeyupListener),self.removeEventListener("keydown",this.documentKeydownListener),self.removeEventListener("blur",this.documentBlurListener),this.documentKeyupListener=null,this.documentKeydownListener=null,this.documentBlurListener=null,this.attachedToDocument=!1}dispose(){this.disposeKeyStateTracker()}}q.register("KeyStateTracker",Ef);class vv extends Ef{constructor(e){super(e)}}const kf=new vv({tandem:Ft.GENERAL_CONTROLLER.createTandem("keyStateTracker")});q.register("globalKeyStateTracker",kf);const ys=kf,hp=["interactiveHighlight","interactiveHighlightLayerable","interactiveHighlightEnabled"],bu=Ai(l=>{assert&&assert(!l._mixesInteractiveHighlighting,"InteractiveHighlighting is already added to this Type");const e=_a("InteractiveHighlightingClass",hp,class extends l{constructor(...i){super(...i),this._pointer=null,this.displays={},this._interactiveHighlight=null,this._interactiveHighlightLayerable=!1,this._interactiveHighlightEnabled=!0,this.interactiveHighlightChangedEmitter=new zt,this._isInteractiveHighlightActiveProperty=new vt(!1),this._activationListener={enter:this._onPointerEntered.bind(this),over:this._onPointerOver.bind(this),move:this._onPointerMove.bind(this),exit:this._onPointerExited.bind(this),down:this._onPointerDown.bind(this)},this._changedInstanceListener=this.onChangedInstance.bind(this),this.changedInstanceEmitter.addListener(this._changedInstanceListener),this._interactiveHighlightingEnabledListener=this._onInteractiveHighlightingEnabledChange.bind(this),this._boundPointerFocusClearedListener=this.handleLockedPointerFocusCleared.bind(this);const n=this._onPointerRelease.bind(this),r=this._onPointerCancel.bind(this);this._pointerListener={up:n,cancel:r,interrupt:r},this.isInteractiveHighlightActiveProperty=this._isInteractiveHighlightActiveProperty}get isInteractiveHighlighting(){return!0}static get _mixesInteractiveHighlighting(){return!0}setInteractiveHighlight(i){this._interactiveHighlight!==i&&(this._interactiveHighlight=i,this._interactiveHighlightLayerable&&(assert&&assert(i instanceof Ge),i.visible=!1),this.interactiveHighlightChangedEmitter.emit())}set interactiveHighlight(i){this.setInteractiveHighlight(i)}get interactiveHighlight(){return this.getInteractiveHighlight()}getInteractiveHighlight(){return this._interactiveHighlight}setInteractiveHighlightLayerable(i){this._interactiveHighlightLayerable!==i&&(this._interactiveHighlightLayerable=i,this._interactiveHighlight&&(assert&&assert(this._interactiveHighlight instanceof Ge),this._interactiveHighlight.visible=!1,this.interactiveHighlightChangedEmitter.emit()))}set interactiveHighlightLayerable(i){this.setInteractiveHighlightLayerable(i)}get interactiveHighlightLayerable(){return this.getInteractiveHighlightLayerable()}getInteractiveHighlightLayerable(){return this._interactiveHighlightLayerable}setInteractiveHighlightEnabled(i){this._interactiveHighlightEnabled=i;const n=Object.keys(this.displays);for(let r=0;r<n.length;r++){const h=this.displays[n[r]];this._interactiveHighlightingEnabledListener(h.focusManager.pointerHighlightsVisibleProperty.value)}}getInteractiveHighlightEnabled(){return this._interactiveHighlightEnabled}set interactiveHighlightEnabled(i){this.setInteractiveHighlightEnabled(i)}get interactiveHighlightEnabled(){return this.getInteractiveHighlightEnabled()}isInteractiveHighlightActivated(){let i=!1;const n=Object.keys(this.displays);for(let r=0;r<n.length;r++){const h=this.displays[n[r]];if(h.focusManager.pointerHighlightsVisibleProperty.value){const p=h.focusManager.pointerFocusProperty.value,S=h.focusManager.lockedPointerFocusProperty.value;if(S){if((S==null?void 0:S.trail.lastNode())===this){i=!0;break}}else if((p==null?void 0:p.trail.lastNode())===this){i=!0;break}}}return i}handleHighlightActiveChange(){this._isInteractiveHighlightActiveProperty.value=this.isInteractiveHighlightActivated()}dispose(){this.changedInstanceEmitter.removeListener(this._changedInstanceListener),this.hasInputListener(this._activationListener)&&this.removeInputListener(this._activationListener),this._pointer&&(this._pointer.removeInputListener(this._pointerListener),this._pointer=null);const i=Object.keys(this.displays);for(let n=0;n<i.length;n++){const r=this.displays[i[n]];this.onDisplayRemoved(r),delete this.displays[i[n]]}super.dispose&&super.dispose()}_onPointerOver(i){const n=i.trail.nodes.find(r=>r.groupFocusHighlight&&r.isInteractiveHighlighting);if(n){const r=i.trail.subtrailTo(n),h=Object.values(this.displays);for(let p=0;p<h.length;p++){const S=h[p];S.focusManager.pointerFocusProperty.value===null&&S.focusManager.pointerFocusProperty.set(new Js(S,r))}}}_onPointerEntered(i){let n=!1;const r=Object.values(this.displays);for(let h=0;h<r.length;h++){const p=r[h];if(p.focusManager.pointerFocusProperty.value===null||!i.trail.equals(p.focusManager.pointerFocusProperty.value.trail)){const S=new Js(p,i.trail);p.focusManager.pointerFocusProperty.set(S),p.focusManager.lockedPointerFocusProperty.value===null&&i.pointer.attachedListener&&(this.lockHighlight(S,p.focusManager),n=!0)}}n&&this.savePointer(i.pointer)}_onPointerMove(i){let n=!1;const r=Object.values(this.displays);for(let h=0;h<r.length;h++){const p=r[h],S=i.trail.subtrailTo(this);if((p.focusManager.pointerFocusProperty.value===null||!S.equals(p.focusManager.pointerFocusProperty.value.trail))&&!this.getDescendantsUseHighlighting(i.trail)){const C=new Js(p,S);p.focusManager.pointerFocusProperty.set(C),p.focusManager.lockedPointerFocusProperty.value===null&&i.pointer.attachedListener&&(this.lockHighlight(C,p.focusManager),n=!0)}}n&&this.savePointer(i.pointer)}_onPointerExited(i){const n=Object.values(this.displays);for(let r=0;r<n.length;r++){const h=n[r];h.focusManager.pointerFocusProperty.set(null);const p=h.focusManager.lockedPointerFocusProperty.value;!i.trail.isPickable()&&(p===null||i.trail.containsNode(p.trail.lastNode()))&&this._onPointerRelease(i)}}_onPointerDown(i){if(this._pointer===null){let n=!1;const r=Object.values(this.displays);for(let h=0;h<r.length;h++){const p=r[h],S=p.focusManager.pointerFocusProperty.value,C=!!p.focusManager.lockedPointerFocusProperty.value;S&&!C&&(assert&&assert(!S.trail.lastNode().isDisposed,"Focus should not be set to a disposed Node"),this.lockHighlight(S,p.focusManager),n=!0)}n&&this.savePointer(i.pointer)}}onDisplayAdded(i){i.focusManager.pointerHighlightsVisibleProperty.hasListener(this._interactiveHighlightingEnabledListener)||i.focusManager.pointerHighlightsVisibleProperty.link(this._interactiveHighlightingEnabledListener)}onDisplayRemoved(i){i.focusManager.lockedPointerFocusProperty.hasListener(this._boundPointerFocusClearedListener)&&i.focusManager.lockedPointerFocusProperty.unlink(this._boundPointerFocusClearedListener),i.focusManager.pointerHighlightsVisibleProperty.unlink(this._interactiveHighlightingEnabledListener)}_onPointerRelease(i){const n=Object.values(this.displays);for(let r=0;r<n.length;r++){const h=n[r];h.focusManager.lockedPointerFocusProperty.value=null,h.focusManager.lockedPointerFocusProperty.hasListener(this._boundPointerFocusClearedListener)&&h.focusManager.lockedPointerFocusProperty.unlink(this._boundPointerFocusClearedListener)}this._pointer&&this._pointer.listeners.includes(this._pointerListener)&&(this._pointer.removeInputListener(this._pointerListener),this._pointer=null)}_onPointerCancel(i){const n=Object.values(this.displays);for(let r=0;r<n.length;r++)n[r].focusManager.pointerFocusProperty.set(null);this._onPointerRelease(i)}savePointer(i){assert&&assert(this._pointer===null,"It should be impossible to already have a Pointer before locking from touchSnag"),this._pointer=i,this._pointer.addInputListener(this._pointerListener)}lockHighlight(i,n){assert&&assert(this._pointer===null,"It should be impossible to already have a Pointer before locking from touchSnag"),n.lockedPointerFocusProperty.set(new Js(i.display,i.trail.copy())),assert&&assert(!n.lockedPointerFocusProperty.hasListener(this._boundPointerFocusClearedListener),"this listener still on the lockedPointerFocusProperty indicates a memory leak"),n.lockedPointerFocusProperty.link(this._boundPointerFocusClearedListener)}handleLockedPointerFocusCleared(i){i===null&&this._onPointerRelease()}_onInteractiveHighlightingEnabledChange(i){const n=i&&this._interactiveHighlightEnabled,r=this.hasInputListener(this._activationListener);n&&!r?this.addInputListener(this._activationListener):!n&&r&&this.removeInputListener(this._activationListener),this.handleHighlightActiveChange()}onChangedInstance(i,n){assert&&assert(i.trail,"should have a trail"),assert&&assert(i.display,"should have a display");const r=i.trail.uniqueId;if(n){const h=i.display;this.displays[r]=h,this.onDisplayAdded(h)}else{assert&&assert(i.node,"should have a node");const h=this.displays[r];assert&&assert(h,`interactive highlighting does not have a Display for removed instance: ${r}`),i.node.instances.length===0&&this.onDisplayRemoved(h),delete this.displays[r]}}getDescendantsUseHighlighting(i){const n=i.nodes.indexOf(this),r=i.nodes.slice(n+1,i.nodes.length);let h=!1;for(let p=0;p<r.length;p++)if(r[p].isInteractiveHighlighting){h=!0;break}return h}mutate(i){return super.mutate(i)}});return e.prototype._mutatorKeys=hp.concat(e.prototype._mutatorKeys),assert&&assert(e.prototype._mutatorKeys.length===_.uniq(e.prototype._mutatorKeys).length,"duplicate mutator keys in InteractiveHighlighting"),e});q.register("InteractiveHighlighting",bu);class _v extends bu(Ge){constructor(e){super(e)}}q.register("InteractiveHighlightingNode",_v);const Lv={enabledProperty:null,enabled:!0,enabledPropertyOptions:null,phetioEnabledPropertyInstrumented:!0,tandem:yi.DEFAULT_OPTIONS.tandem};class Bo extends jc{constructor(e){const t=En()({},Lv,e),i=!t.enabledProperty;assert&&t.enabledPropertyOptions&&assert(!(!t.phetioEnabledPropertyInstrumented&&t.enabledPropertyOptions.tandem),"incompatible options. Cannot specify phetioEnabledPropertyInstrumented opt out and a Tandem via enabledPropertyOptions."),super(t),this.enabledProperty=t.enabledProperty||new Do(t.enabled,ns({tandem:t.phetioEnabledPropertyInstrumented?t.tandem.createTandem(Do.TANDEM_NAME):Ft.OPT_OUT},t.enabledPropertyOptions)),this.disposeEnabledComponent=()=>{i&&this.enabledProperty.dispose()}}setEnabled(e){assert&&assert(this.enabledProperty.isSettable(),"cannot set enabledProperty"),this.enabledProperty.value=e}set enabled(e){this.setEnabled(e)}get enabled(){return this.isEnabled()}isEnabled(){return this.enabledProperty.value}dispose(){this.disposeEnabledComponent(),super.dispose()}}hs.register("EnabledComponent",Bo);const Pv={valueType:"number",isValidValue:l=>l%1===0,validationMessage:"Should be a valid integer"},Sv={isValidValue:l=>!isNaN(l),validationMessage:"Should not be NaN"},wv={validateValidator:!1},Cv=["FloatingPoint","Integer"],Wh="rangeProperty",cp=In.EVERYTHING,$h=ei.PropertyIO(Tt),co=class co extends ei{constructor(e,t){var C;assert&&t&&Hi(["range"],["validValues"]);const i=je()({numberType:"FloatingPoint",range:cp,validators:[],phetioOuterType:()=>co.NumberPropertyIO},t);i.rangePropertyOptions=je()({phetioDocumentation:"Provides the range of possible values for the parent NumberPropertyIO",phetioValueType:In.RangeIO,phetioReadOnly:!0,tandem:i.range!==cp?(C=i.tandem)==null?void 0:C.createTandem(Wh):Ft.OPT_OUT},i.rangePropertyOptions),assert&&Ft.VALIDATION&&i.rangePropertyOptions.tandem&&i.rangePropertyOptions.tandem.supplied&&assert&&assert(i.rangePropertyOptions.tandem.name===Wh,`rangePropertyOptions.tandem.name must be ${Wh}: ${i.rangePropertyOptions.tandem.name}`),i.valueType="number",i.phetioValueType=Tt;const r=!(i.range&&i.range instanceof Is),h=i.range instanceof Is?i.range:new ei(i.range,i.rangePropertyOptions);i.validators.push(Sv),i.numberType==="Integer"&&i.validators.push(Pv);let p=!1;i.validators.push({isValidValue:B=>h.value.contains(B),validationMessage:()=>`Number value ${p?this.value:e} must be within rangeProperty value: ${h.value}`}),super(e,i),p=!0,this.numberType=i.numberType,this.rangeProperty=h,assert&&Ft.VALIDATION&&this.rangeProperty.isPhetioInstrumented()&&assert&&assert(this.isPhetioInstrumented(),"NumberProperty must be phet-io instrumented if the range is");const S=()=>{ir(this.value,this.valueValidator,wv)};if(assert&&this.rangeProperty.link(S),this.rangeProperty.addPhetioStateDependencies([this]),this.addPhetioStateDependencies([this.rangeProperty]),i.validValues&&this.validateNumberAndRangeProperty)for(let B=0;B<i.validValues.length;B++){const U=i.validValues[B];this.validateNumberAndRangeProperty(U)}this.disposeNumberProperty=()=>{r?this.rangeProperty.dispose():assert&&this.rangeProperty.unlink(S)},this.resetNumberProperty=()=>{r&&this.rangeProperty.reset()}}get range(){return this.rangeProperty.value}set range(e){this.rangeProperty.value=e}reset(){this.resetValueAndRange(),super.reset()}dispose(){this.disposeNumberProperty(),super.dispose()}setValueAndRange(e,t){assert&&assert(t.contains(e),`value ${e} is not in range [${t.min},${t.max}]`),this.setDeferred(!0),this.rangeProperty.setDeferred(!0),this.set(e),this.rangeProperty.set(t);const i=this.setDeferred(!1),n=this.rangeProperty.setDeferred(!1);i&&i(),n&&n()}resetValueAndRange(){this.setValueAndRange(this.initialValue,this.rangeProperty.initialValue)}toStateObject(){const e=$h.toStateObject(this);e.numberType=this.numberType,e.range=In.RangeIO.toStateObject(this.rangeProperty.value);const t=this.rangeProperty&&this.rangeProperty.isPhetioInstrumented();return e.rangePhetioID=t?this.rangeProperty.tandem.phetioID:null,e}};co.NumberPropertyIO=new li("NumberPropertyIO",{valueType:co,supertype:$h,parameterTypes:[Tt],documentation:`Extends PropertyIO to add values for the numeric range ( min, max ) and numberType ( '${Cv.join("' | '")}' )`,toStateObject:e=>e.toStateObject(),applyState:(e,t)=>{$h.applyState(e,t)},stateSchema:{numberType:si,range:In.RangeIO,rangePhetioID:Lt(si)}});let gn=co;hs.register("NumberProperty",gn);class Af extends Is{constructor(e,t){const i=je()({bidirectional:!1,defaultValue:null,derive:_.identity,map:_.identity,inverseMap:_.identity},t),n=i.derive,r=i.map,h=i.inverseMap,p=typeof n=="function"?n:U=>U[n],S=typeof r=="function"?r:U=>U[r],C=typeof h=="function"?h:U=>U[h],B=e.value===null?S(i.defaultValue):S(p(e.value).value);super(B,i),this.defaultValue=i.defaultValue,this.derive=p,this.map=S,this.inverseMap=C,this.bidirectional=i.bidirectional,this.valuePropertyProperty=e,this.isExternallyChanging=!1,this.propertyPropertyListener=this.onPropertyPropertyChange.bind(this),this.propertyListener=this.onPropertyChange.bind(this),e.link(this.propertyListener),i.bidirectional&&this.lazyLink(this.onSelfChange.bind(this))}onPropertyPropertyChange(e,t,i){this.bidirectional&&this.valuePropertyProperty.value!==null&&i&&this.derive(this.valuePropertyProperty.value)===i&&i.areValuesEqual(this.inverseMap(this.value),i.get())||super.set(this.map(e))}onPropertyChange(e,t){t&&this.derive(t).unlink(this.propertyPropertyListener),e?this.derive(e).link(this.propertyPropertyListener):this.onPropertyPropertyChange(this.defaultValue,null,null)}onSelfChange(e){if(assert&&assert(this.bidirectional),this.valuePropertyProperty.value!==null){const t=this.derive(this.valuePropertyProperty.value);this.areValuesEqual(e,this.map(t.value))||(t.value=this.inverseMap(e))}}dispose(){this.valuePropertyProperty.unlink(this.propertyListener),this.valuePropertyProperty.value!==null&&this.derive(this.valuePropertyProperty.value).unlink(this.propertyPropertyListener),super.dispose()}reset(){assert&&assert(this.bidirectional,"Cannot reset a non-bidirectional DynamicProperty"),this.valuePropertyProperty.value!==null&&this.derive(this.valuePropertyProperty.value).reset()}set(e){assert&&assert(this.bidirectional,`Cannot set values directly to a non-bidirectional DynamicProperty, tried to set: ${e}${this.isPhetioInstrumented()?" for "+this.phetioID:""}`),this.isExternallyChanging=!0,super.set(e),this.isExternallyChanging=!1}get value(){return super.value}set value(e){this.set(e)}isSettable(){return super.isSettable()||this.bidirectional}}hs.register("DynamicProperty",Af);const Of=new Yc("phetcommon"),ll="",hl="",jr="",wn={format:function(l){const e=arguments;return l.replace(/{(\d)}/g,(t,i)=>e[+i+1])},fillIn:function(l,e){l=l&&l.get?l.get():l,assert&&assert(typeof l=="string",`invalid template: ${l}`),assert&&assert(e&&typeof e=="object",`invalid values: ${e}`);let t=l;const i=l.match(/\{\{[^{}]+\}\}/g)||[];for(let n=0;n<i.length;n++){const r=i[n],h=r.replace("{{","").replace("}}","");if(e[h]!==void 0){const p=e[h]&&e[h].get?e[h].get():e[h];t=t.replace(r,p)}}return t},isEmbeddingMark:function(l){return l===ll||l===hl||l===jr},embeddedSlice:function(l,e,t){const i=[];let n;for(t===void 0&&(t=l.length),t<0&&(t+=l.length);e<l.length&&wn.isEmbeddingMark(l.charAt(e));)e++;for(;t>=1&&wn.isEmbeddingMark(l.charAt(t-1));)t--;if(e>=t||e>=l.length)return"";for(let k=0;k<e;k++)n=l.charAt(k),n===ll||n===hl?i.push(n):n===jr&&i.pop();let r=i.length,h=i.slice();const p=l.slice(e,t);for(let k=0;k<p.length;k++)n=p.charAt(k),n===ll||n===hl?i.push(n):n===jr&&(i.pop(),r=Math.min(i.length,r));let S=i;const C=Math.max(0,r-1);h=h.slice(C),S=S.slice(C);const B=h.join(""),U=S.join("").replace(/./g,jr);return B+p+U},embeddedSplit:function(l,e,t){if(e===void 0)return[l];let i=[],n,r=l;function h(){let S,C;if(e instanceof self.RegExp){const B=r.match(e);B?(S=B.index,C=B[0].length):S=-1}else assert&&assert(typeof e=="string"),S=r.indexOf(e),C=e.length;return{index:S,length:C}}let p=0;for(;(n=h()).index>=0;){i.push(wn.embeddedSlice(l,p,p+n.index));const S=n.index+n.length;r=r.slice(S),p+=S}return i.push(wn.embeddedSlice(l,p)),t!==void 0&&(assert&&assert(typeof t=="number"),i=_.first(i,t)),i},embeddedDebugString:function(l){return l.replace(/\u202a/g,"[LTR]").replace(/\u202b/g,"[RTL]").replace(/\u202c/g,"[POP]")},wrapLTR:function(l){return ll+l+jr},wrapRTL:function(l){return hl+l+jr},wrapDirection:function(l,e){return assert&&assert(e==="ltr"||e==="rtl"),e==="ltr"?wn.wrapLTR(l):wn.wrapRTL(l)},localeToLocalizedName:function(l){return assert&&assert(phet.chipper.localeData[l],"locale needs to be a valid locale code defined in localeData"),wn.wrapDirection(phet.chipper.localeData[l].localizedName,phet.chipper.localeData[l].direction)},capitalize(l){const e=l.search(/[A-Za-z0-9]/);if(e===-1)return l.slice(0);const t=e>0?l.slice(0,e):"",i=l.charAt(e).toUpperCase(),n=e+1<l.length?l.slice(e+1):"";return t+i+n}};Of.register("StringUtils",wn);const bn=new Yc("utteranceQueue"),Tv="NAME",Dv="OBJECT",Iv="CONTEXT",xv="HINT",Ev={nameObjectContextHint:"{{NAME}}, {{OBJECT}}, {{CONTEXT}} {{HINT}}",nameObjectContext:"{{NAME}}, {{OBJECT}}, {{CONTEXT}}",nameObjectHint:"{{NAME}}, {{OBJECT}}, {{HINT}}",nameContextHint:"{{NAME}}, {{CONTEXT}} {{HINT}}",nameObject:"{{NAME}}, {{OBJECT}}",nameContext:"{{NAME}}, {{CONTEXT}}",nameHint:"{{NAME}}, {{HINT}}",name:"{{NAME}}",objectContextHint:"{{OBJECT}}, {{CONTEXT}} {{HINT}}",objectContext:"{{OBJECT}}, {{CONTEXT}}",objectHint:"{{OBJECT}}, {{HINT}}",contextHint:"{{CONTEXT}} {{HINT}}",object:"{{OBJECT}}",context:"{{CONTEXT}}",hint:"{{HINT}}"},Fl=class Fl{constructor(e){const t=En()({},Ev,e);this.nameObjectContextHint=t.nameObjectContextHint,this.nameObjectContext=t.nameObjectContext,this.nameObjectHint=t.nameObjectHint,this.nameContextHint=t.nameContextHint,this.nameObject=t.nameObject,this.nameContext=t.nameContext,this.nameHint=t.nameHint,this.name=t.name,this.objectContextHint=t.objectContextHint,this.objectContext=t.objectContext,this.objectHint=t.objectHint,this.contextHint=t.contextHint,this.object=t.object,this.context=t.context,this.hint=t.hint}getResponsePattern(e){const t=this[e];return assert&&assert(t,`no pattern string found for key ${e}`),t}static createPatternKey(e,t,i,n){let r="";return e&&(r=r.concat(Tv.concat("_"))),t&&(r=r.concat(Dv.concat("_"))),i&&(r=r.concat(Iv.concat("_"))),n&&(r=r.concat(xv.concat("_"))),_.camelCase(r)}};Fl.DEFAULT_RESPONSE_PATTERNS=new Fl;let hr=Fl;bn.register("ResponsePatternCollection",hr);const up={nameResponse:null,objectResponse:null,contextResponse:null,hintResponse:null,ignoreProperties:!1,responsePatternCollection:hr.DEFAULT_RESPONSE_PATTERNS},Yn=class Yn{constructor(e){const t=En()({},up,e);assert&&assert(t.responsePatternCollection instanceof hr),this._nameResponse=t.nameResponse,this._objectResponse=t.objectResponse,this._contextResponse=t.contextResponse,this._hintResponse=t.hintResponse,this.ignoreProperties=t.ignoreProperties,this.responsePatternCollection=t.responsePatternCollection}getNameResponse(){return Yn.getResponseText(this._nameResponse)}get nameResponse(){return this.getNameResponse()}set nameResponse(e){this.setNameResponse(e)}setNameResponse(e){this._nameResponse=e}getObjectResponse(){return Yn.getResponseText(this._objectResponse)}get objectResponse(){return this.getObjectResponse()}set objectResponse(e){this.setObjectResponse(e)}setObjectResponse(e){this._objectResponse=e}getContextResponse(){return Yn.getResponseText(this._contextResponse)}get contextResponse(){return this.getContextResponse()}set contextResponse(e){this.setContextResponse(e)}setContextResponse(e){this._contextResponse=e}getHintResponse(){return Yn.getResponseText(this._hintResponse)}get hintResponse(){return this.getHintResponse()}set hintResponse(e){this.setHintResponse(e)}setHintResponse(e){this._hintResponse=e}static getResponseText(e){return it(e)?e.value:typeof e=="function"?e():e}copy(){return new Yn(this.serialize())}serialize(){return{nameResponse:this.nameResponse,objectResponse:this.objectResponse,contextResponse:this.contextResponse,hintResponse:this.hintResponse,ignoreProperties:this.ignoreProperties,responsePatternCollection:this.responsePatternCollection}}};Yn.DEFAULT_OPTIONS=up;let ma=Yn;bn.register("ResponsePacket",ma);class kv extends yi{constructor(e){super(),this.nameResponsesEnabledProperty=new Wt(!0),this.objectResponsesEnabledProperty=new Wt(!1),this.contextResponsesEnabledProperty=new Wt(!1),this.hintResponsesEnabledProperty=new Wt(!1)}reset(){this.nameResponsesEnabledProperty.reset(),this.objectResponsesEnabledProperty.reset(),this.contextResponsesEnabledProperty.reset(),this.hintResponsesEnabledProperty.reset()}collectResponses(e){const t=En()({},ma.DEFAULT_OPTIONS,e);assert&&assert(t.responsePatternCollection instanceof hr);const i=!!(t.nameResponse&&(this.nameResponsesEnabledProperty.get()||t.ignoreProperties)),n=!!(t.objectResponse&&(this.objectResponsesEnabledProperty.get()||t.ignoreProperties)),r=!!(t.contextResponse&&(this.contextResponsesEnabledProperty.get()||t.ignoreProperties)),h=!!(t.hintResponse&&(this.hintResponsesEnabledProperty.get()||t.ignoreProperties)),p=hr.createPatternKey(i,n,r,h);let S="";if(p){const C=t.responsePatternCollection.getResponsePattern(p);S=wn.fillIn(C,{NAME:t.nameResponse,OBJECT:t.objectResponse,CONTEXT:t.contextResponse,HINT:t.hintResponse})}return S}}const Mf=new kv;bn.register("responseCollector",Mf);const Nf=Mf,dp=1;let Av=1;const Ms=class Ms extends jc{constructor(e){const t=je()({alert:null,predicate:function(){return!0},canAnnounceProperties:[],descriptionCanAnnounceProperties:[],voicingCanAnnounceProperties:[],alertStableDelay:200,alertMaximumDelay:Number.MAX_VALUE,announcerOptions:{},priority:dp},e);super(t),this.id=Av++,this._alert=t.alert,this.predicate=t.predicate,this.canAnnounceProperty=new Uh({dependentProperties:t.canAnnounceProperties}),this.descriptionCanAnnounceProperty=new Uh({dependentProperties:t.descriptionCanAnnounceProperties}),this.voicingCanAnnounceProperty=new Uh({dependentProperties:t.voicingCanAnnounceProperties}),this.alertStableDelay=t.alertStableDelay,this.alertMaximumDelay=t.alertMaximumDelay,this.announcerOptions=t.announcerOptions,this.priorityProperty=new gn(t.priority),this.previousAlertText=null}static getAlertStringFromResponsePacket(e,t){const i=e.serialize();return t||(i.ignoreProperties=!0),Nf.collectResponses(i)}getAlertText(e=!1){const t=Ms.alertableToText(this._alert,e);return this.previousAlertText=t,t}getAlert(){return this._alert}get alert(){return this.getAlert()}set alert(e){this.setAlert(e)}setAlert(e){this._alert=e}setAlertStableDelay(e){this.alertStableDelay=e}toString(){return`Utterance_${this.id}#${this.getAlertText()}`}toStateObject(){return{alert:Lt(da([si,Tt])).toStateObject(this.getAlertText())}}reset(){this.previousAlertText=null}setCanAnnounceProperties(e){this.canAnnounceProperty.setDependentProperties(e)}set canAnnounceProperties(e){this.setCanAnnounceProperties(e)}get canAnnounceProperties(){return this.getCanAnnounceProperties()}getCanAnnounceProperties(){return this.canAnnounceProperty.getDependentProperties()}setDescriptionCanAnnounceProperties(e){this.descriptionCanAnnounceProperty.setDependentProperties(e)}set descriptionCanAnnounceProperties(e){this.setDescriptionCanAnnounceProperties(e)}get descriptionCanAnnounceProperties(){return this.getDescriptionCanAnnounceProperties()}getDescriptionCanAnnounceProperties(){return this.descriptionCanAnnounceProperty.getDependentProperties()}setVoicingCanAnnounceProperties(e){this.voicingCanAnnounceProperty.setDependentProperties(e)}set voicingCanAnnounceProperties(e){this.setVoicingCanAnnounceProperties(e)}get voicingCanAnnounceProperties(){return this.getVoicingCanAnnounceProperties()}getVoicingCanAnnounceProperties(){return this.voicingCanAnnounceProperty.getDependentProperties()}dispose(){this.canAnnounceProperty.dispose(),this.descriptionCanAnnounceProperty.dispose(),this.voicingCanAnnounceProperty.dispose(),this.priorityProperty.dispose(),super.dispose()}static alertableToText(e,t=!1){let i;if(typeof e=="function")i=e();else if(e instanceof ma)i=Ms.getAlertStringFromResponsePacket(e,t);else{if(e instanceof Ms)return e.getAlertText(t);it(e)?i=e.value:i=e}return i}};Ms.TOP_PRIORITY=10,Ms.HIGH_PRIORITY=5,Ms.MEDIUM_PRIORITY=2,Ms.DEFAULT_PRIORITY=dp,Ms.LOW_PRIORITY=0,Ms.UtteranceIO=new li("UtteranceIO",{valueType:Ms,documentation:"Announces text to a specific browser technology (like aria-live or web speech)",toStateObject:e=>e.toStateObject(),stateSchema:{alert:Lt(da([si,Tt]))}});let xs=Ms;class Uh extends Af{constructor(e){const t=je()({dependentProperties:[]},e),i=new ei(new vt(!1));super(i),this._dependentProperties=[],this.implementationProperty=i,this.setDependentProperties(t.dependentProperties)}setDependentProperties(e){this.implementationProperty.value&&this.implementationProperty.value.dispose();const t=e.length===0?[new vt(!0)]:e;this.implementationProperty.value=Jt.and(t),this._dependentProperties=e}set dependentProperties(e){this.setDependentProperties(e)}get dependentProperties(){return this.getDependentProperties()}getDependentProperties(){return this._dependentProperties.slice(0)}dispose(){this.implementationProperty.dispose(),this._dependentProperties=[],super.dispose()}}bn.register("Utterance",xs);const uo=class uo extends yi{constructor(e){var i;const t=je()({respectResponseCollectorProperties:!0,phetioType:uo.AnnouncerIO,phetioState:!1},e);super(t),this.readyToAnnounce=!0,this.hasSpoken=!1,this.respectResponseCollectorProperties=t.respectResponseCollectorProperties,this.announcementCompleteEmitter=new Yi({parameters:[{name:"utterance",phetioType:xs.UtteranceIO},{name:"text",phetioType:Lt(da([si,Tt]))}],tandem:(i=t.tandem)==null?void 0:i.createTandem("announcementCompleteEmitter"),phetioReadOnly:!0,phetioDocumentation:"The announcement that has just completed. The Utterance text could potentially differ from the exact text that was announced, so both are emitted. Use `text` for an exact match of what was announced."})}shouldUtteranceCancelOther(e,t){return t.priorityProperty.value<e.priorityProperty.value}onUtterancePriorityChange(e){}};uo.AnnouncerIO=new li("AnnouncerIO",{valueType:uo,documentation:"Announces text to a specific browser technology (like aria-live or web speech)"});let Eo=uo;bn.register("Announcer",Eo);const Rf={initialize(){if(self.speechSynthesis||self.SpeechSynthesis||self.SpeechSynthesisUtterance)throw new Error("SpeechSynthesis is supported here, the polyfill should not overwrite it");assert&&assert(self.parent,"This polyfill requires a parent frame implementation of SpeechSynthesis."),self.SpeechSynthesis=self.parent.SpeechSynthesis,self.speechSynthesis=new self.parent.SpeechSynthesis,self.SpeechSynthesisUtterance=self.parent.SpeechSynthesisUtterance}};bn.register("SpeechSynthesisParentPolyfill",Rf);class tr{constructor(e,t,i){if(this.dependencies=e,assert&&assert(e.every(_.identity),"dependencies should all be truthy"),assert&&assert(e.length===_.uniq(e).length,"duplicate dependencies"),this.dependencyListeners=new Map,e.forEach(n=>{const r=()=>{if(!this.isDisposed){const h=e.map(p=>p.get());t(...h)}};this.dependencyListeners.set(n,r),n.lazyLink(r,{phetioDependencies:_.without(e,n)})}),!i){const n=e.map(r=>r.get());t(...n)}this.isDisposed=!1}get definedDependencies(){return assert&&assert(this.dependencies!==null,"Dependencies should be defined, has this Property been disposed?"),this.dependencies}dispose(){assert&&assert(this.dependencies,"A Multilink cannot be disposed twice.");const e=this.definedDependencies;for(let t=0;t<e.length;t++){const i=e[t],n=this.dependencyListeners.get(i);assert&&assert(n,"The listener should exist"),i.hasListener(n)&&i.unlink(n)}this.dependencies=null,this.dependencyListeners.clear(),this.isDisposed=!0}static multilink(e,t){return new tr(e,t,!1)}static multilinkAny(e,t){return new tr(e,t)}static lazyMultilink(e,t){return new tr(e,t,!0)}static lazyMultilinkAny(e,t){return new tr(e,t,!0)}static unmultilink(e){e.dispose()}}hs.register("Multilink",tr);self.phet&&phet.chipper&&phet.chipper.queryParameters&&phet.chipper.queryParameters.speechSynthesisFromParent&&Rf.initialize();const pp=5e3,Ov=5e3,Mv=1e4,gp=125,Nv=["Albert","Bad News","Bahh","Bells","Boing","Bubbles","Cellos","Good News","Jester","Organ","Superstar","Trinoids","Whisper","Wobble","Zarvox","Flo","Grandma","Grandpa","Junior"];let fp=0;const mp={cmn:"zh_CN",yue:"zh_HK","yue-HK":"zh_HK",yue_HK:"zh_HK","fil-PH":"tl",fil_PH:"tl"},yp={cancelSelf:!0,cancelOther:!0,voice:null};class la extends Eo{constructor(e){var i,n,r,h;const t=je()({respectResponseCollectorProperties:!1,debug:!1},e);super(t),this.debug=t.debug,this.voiceProperty=new ei(null,{tandem:(i=t.tandem)==null?void 0:i.createTandem("voiceProperty"),phetioValueType:Lt(Fv),phetioState:!1,phetioReadOnly:!0,phetioDocumentation:"the voice that is currently voicing responses"}),this.voiceRateProperty=new gn(1,{range:new In(.75,2),tandem:(n=t.tandem)==null?void 0:n.createTandem("voiceRateProperty"),phetioState:!1,phetioDocumentation:"changes the rate of the voicing-feature voice"}),this.voicePitchProperty=new gn(1,{range:new In(.5,2),tandem:(r=t.tandem)==null?void 0:r.createTandem("voicePitchProperty"),phetioState:!1,phetioDocumentation:"changes the pitch of the voicing-feature voice"}),this.voiceVolumeProperty=new gn(1,{range:new In(0,1)}),this.hasSpoken=!1,this.timeSinceWakingEngine=0,this.timeSincePauseResume=0,this.timeSincePendingUtterance=0,this.timeSinceUtteranceEnd=gp,this.startSpeakingEmitter=new Yi({parameters:[{valueType:"string"},{valueType:xs}]}),this.endSpeakingEmitter=new Yi({parameters:[{valueType:"string"},{valueType:xs}]}),this.enabledComponentImplementation=new Bo({enabled:!1,tandem:t.tandem,enabledPropertyOptions:{phetioDocumentation:"toggles this controller of SpeechSynthesis on and off",phetioState:!1,phetioFeatured:!1}}),assert&&assert(this.enabledComponentImplementation.enabledProperty.isSettable(),"enabledProperty must be settable"),this.enabledProperty=this.enabledComponentImplementation.enabledProperty,this.mainWindowVoicingEnabledProperty=new Wt(!0,{tandem:(h=t.tandem)==null?void 0:h.createTandem("mainWindowVoicingEnabledProperty"),phetioState:!1,phetioDocumentation:"toggles the voicing feature on and off for the simulation screen (not the voicing preferences and toolbar controls)"}),this.voicingFullyEnabledProperty=Jt.and([this.enabledProperty,this.mainWindowVoicingEnabledProperty]),this._speechAllowedAndFullyEnabledProperty=new Wt(!1),this.speechAllowedAndFullyEnabledProperty=this._speechAllowedAndFullyEnabledProperty,this.synth=null,this.voicesProperty=new ei([]),this.speakingSpeechSynthesisUtteranceWrapper=null,this.isInitializedProperty=new Wt(!1),this.canSpeakProperty=null,this.boundHandleCanSpeakChange=this.handleCanSpeakChange.bind(this),this.boundHandleCanAnnounceChange=this.handleCanAnnounceChange.bind(this),this.debug&&(this.announcementCompleteEmitter.addListener((p,S)=>{console.log("announcement complete",S)}),this.startSpeakingEmitter.addListener(p=>{this.debug&&console.log("startSpeakingListener",p)}),this.endSpeakingEmitter.addListener(p=>{this.debug&&console.log("endSpeakingListener",p)}))}get initialized(){return this.isInitializedProperty.value}initialize(e,t){assert&&assert(!this.initialized,"can only be initialized once"),assert&&assert(la.isSpeechSynthesisSupported(),"trying to initialize speech, but speech is not supported on this platform."),assert&&assert(fp===0,"Only one instance of SpeechSynthesisAnnouncer can be initialized at a time."),fp++;const i=je()({speechAllowedProperty:new Wt(!0)},t);this.synth=self.speechSynthesis,this.canSpeakProperty=Jt.and([i.speechAllowedProperty,this.enabledProperty]),this.canSpeakProperty.link(this.boundHandleCanSpeakChange),tr.multilink([i.speechAllowedProperty,this.voicingFullyEnabledProperty],(h,p)=>{this._speechAllowedAndFullyEnabledProperty.value=h&&p});const n=this.getSynth();n.addEventListener&&n.addEventListener("voiceschanged",()=>{this.populateVoices()}),this.populateVoices();const r=()=>{this.timeSinceWakingEngine=pp,e.removeListener(r)};e.addListener(r),Gi.addListener(this.step.bind(this)),this.isInitializedProperty.value=!0}step(e){e*=1e3;const t=this.getSynth();this.initialized&&t&&(this.hasSpoken||(this.hasSpoken=t.speaking),this.timeSinceUtteranceEnd=t.speaking?0:this.timeSinceUtteranceEnd+e,this.timeSincePendingUtterance=this.speakingSpeechSynthesisUtteranceWrapper&&!this.speakingSpeechSynthesisUtteranceWrapper.started?this.timeSincePendingUtterance+e:0,this.timeSincePendingUtterance>Ov&&(assert&&assert(this.speakingSpeechSynthesisUtteranceWrapper,"should have this.speakingSpeechSynthesisUtteranceWrapper"),this.handleSpeechSynthesisEnd(this.speakingSpeechSynthesisUtteranceWrapper.announceText,this.speakingSpeechSynthesisUtteranceWrapper),this.speakingSpeechSynthesisUtteranceWrapper=null,this.cancelSynth()),this.timeSinceUtteranceEnd>gp&&!this.speakingSpeechSynthesisUtteranceWrapper&&(this.readyToAnnounce=!0),_i.chromium&&!_i.android&&this.voiceProperty.value&&!this.voiceProperty.value.localService&&(this.timeSincePauseResume=t.speaking?this.timeSincePauseResume+e:0,this.timeSincePauseResume>Mv&&(this.timeSincePauseResume=0,t.pause(),t.resume())),_i.chromeOS&&(this.timeSinceWakingEngine+=e,!t.speaking&&this.timeSinceWakingEngine>pp&&(this.timeSinceWakingEngine=0,t.speak(new SpeechSynthesisUtterance(" ")))))}handleCanSpeakChange(e){e||this.cancel()}populateVoices(){const e=this.getSynth();e&&(this.voicesProperty.value=_.uniqBy(e.getVoices(),t=>t.name))}getPrioritizedVoices(){assert&&assert(this.initialized,"No voices available until the SpeechSynthesisAnnouncer is initialized"),assert&&assert(this.voicesProperty.value.length>0,"No voices available to provided a prioritized list.");const e=this.voicesProperty.value.slice(),t=_.filter(e,n=>!_.some(Nv,r=>n.name.includes(r))),i=n=>n.name.includes("Google")?-1:n.name.includes("Fred")?t.length:t.indexOf(n);return t.sort((n,r)=>i(n)-i(r))}getEnglishPrioritizedVoices(){return _.filter(this.getPrioritizedVoices(),e=>e.lang==="en-US"||e.lang==="en_US")}getPrioritizedVoicesForLocale(e){const t=e,i=e.replace("_","-");return _.filter(this.getPrioritizedVoices(),n=>{const r=mp.hasOwnProperty(n.lang)?mp[n.lang]:n.lang;let h=!1;return(r.includes("_")||r.includes("-"))&&(h=t===r.slice(0,2)),h||t===r||i===r})}announce(e,t){this.initialized&&this.canSpeakProperty&&this.canSpeakProperty.value?this.requestSpeech(e,t):this.handleAnnouncementFailure(t,e)}handleAnnouncementFailure(e,t){this.debug&&console.log("announcement failure",t),this.announcementCompleteEmitter.emit(e,t)}speakIgnoringEnabled(e){this.initialized&&(this.cancel(),this.requestSpeech(e.getAlertText(this.respectResponseCollectorProperties),e))}requestSpeech(e,t){if(assert&&assert(la.isSpeechSynthesisSupported(),"trying to speak with speechSynthesis, but it is not supported on this platform"),this.debug&&console.log("requestSpeech",e),!e){this.handleAnnouncementFailure(t,e);return}const i=En()({},yp,t.announcerOptions),n=Bv(Xc(e+""));ir(n,Hs.STRING_WITHOUT_TEMPLATE_VARS_VALIDATOR);const r=new SpeechSynthesisUtterance(n);r.voice=i.voice||this.voiceProperty.value,r.pitch=this.voicePitchProperty.value,r.rate=this.voiceRateProperty.value,r.volume=this.voiceVolumeProperty.value;const h=()=>{this.startSpeakingEmitter.emit(n,t),assert&&assert(this.speakingSpeechSynthesisUtteranceWrapper,"should have been set in requestSpeech"),this.speakingSpeechSynthesisUtteranceWrapper.started=!0,r.removeEventListener("start",h)},p=()=>{this.handleSpeechSynthesisEnd(n,S)},S=new Rv(t,e,r,!1,p,h);assert&&assert(this.speakingSpeechSynthesisUtteranceWrapper===null,"Wrapper should be null, we should have received an end event to clear it before the next one."),this.speakingSpeechSynthesisUtteranceWrapper=S,r.addEventListener("start",h),r.addEventListener("end",p),r.addEventListener("error",p),this.readyToAnnounce=!1,this.timeSinceUtteranceEnd=0,t.canAnnounceProperty.link(this.boundHandleCanAnnounceChange),t.voicingCanAnnounceProperty.link(this.boundHandleCanAnnounceChange),this.getSynth().speak(r)}handleCanAnnounceChange(){this.speakingSpeechSynthesisUtteranceWrapper&&this.cancelUtteranceIfCanAnnounceFalse(this.speakingSpeechSynthesisUtteranceWrapper.utterance)}cancelUtteranceIfCanAnnounceFalse(e){(!e.canAnnounceProperty.value||!e.voicingCanAnnounceProperty.value)&&this.cancelUtterance(e)}handleSpeechSynthesisEnd(e,t){this.endSpeakingEmitter.emit(e,t.utterance),this.announcementCompleteEmitter.emit(t.utterance,t.speechSynthesisUtterance.text),t.speechSynthesisUtterance.removeEventListener("error",t.endListener),t.speechSynthesisUtterance.removeEventListener("end",t.endListener),t.speechSynthesisUtterance.removeEventListener("start",t.startListener);const i=t.utterance.canAnnounceProperty;i.hasListener(this.boundHandleCanAnnounceChange)&&i.unlink(this.boundHandleCanAnnounceChange);const n=t.utterance.voicingCanAnnounceProperty;n.hasListener(this.boundHandleCanAnnounceChange)&&n.unlink(this.boundHandleCanAnnounceChange),this.speakingSpeechSynthesisUtteranceWrapper=null}getSynth(){return assert&&assert(la.isSpeechSynthesisSupported(),"Trying to use SpeechSynthesis, but it is not supported on this platform."),this.synth}cancel(){this.initialized&&this.speakingSpeechSynthesisUtteranceWrapper&&this.cancelUtterance(this.speakingSpeechSynthesisUtteranceWrapper.utterance)}cancelUtterance(e){const t=this.speakingSpeechSynthesisUtteranceWrapper;t&&e===t.utterance&&(this.handleSpeechSynthesisEnd(t.announceText,t),this.cancelSynth())}shouldUtteranceCancelOther(e,t){const i=En()({},yp,e.announcerOptions);let n;return t.priorityProperty.value!==e.priorityProperty.value?n=t.priorityProperty.value<e.priorityProperty.value:(n=i.cancelOther,t&&t===e&&(n=i.cancelSelf)),n}onUtterancePriorityChange(e){const t=this.speakingSpeechSynthesisUtteranceWrapper;t&&this.shouldUtteranceCancelOther(e,t.utterance)&&this.cancelUtterance(t.utterance)}cancelSynth(){assert&&assert(this.initialized,"must be initialized to use synth");const e=this.getSynth();e&&e.cancel()}static isSpeechSynthesisSupported(){return!!self.speechSynthesis&&!!self.SpeechSynthesisUtterance}}class Rv{constructor(e,t,i,n,r,h){this.utterance=e,this.announceText=t,this.speechSynthesisUtterance=i,this.started=n,this.endListener=r,this.startListener=h}}function Bv(l){return l.split("<br/>").join(" ").split("<br>").join(" ")}const Fv=new li("SpeechSynthesisVoiceIO",{isValidValue:l=>!0,toStateObject:l=>l.name});bn.register("SpeechSynthesisAnnouncer",la);class Hv extends la{constructor(e){const t=je()({respectResponseCollectorProperties:!0,phetioDocumentation:"Announcer that manages the voicing feature, providing audio responses via WebAudio."},e);super(t)}initialize(e,t){super.initialize(e,t),ys.keyupEmitter.addListener(i=>{me.isControlKey(i)&&this.cancel()})}voicingSupportedForLocale(e){return e.startsWith("en")}}const Bf=new Hv;q.register("voicingManager",Bf);const cn=Bf,Vv=4;let Mc=1;const Kn=class Kn extends Mr{constructor(e){super(),this.attributeString=e}};Kn.POLITE=new Kn("polite"),Kn.ASSERTIVE=new Kn("assertive"),Kn.enumeration=new Nr(Kn);let Un=Kn;function bp(l){const e=l.attributeString,t=document.createElement("div");for(let i=1;i<=Vv;i++){const n=document.createElement("p");n.setAttribute("id",`elements-${Mc}-${e}-${i}`),n.setAttribute("aria-live",e),t.appendChild(n)}return t}const po=class po extends Eo{constructor(e){const t=je()({respectResponseCollectorProperties:!1,lang:"en"},e);super(t),this.politeElementIndex=0,this.assertiveElementIndex=0,this.ariaLiveContainer=document.createElement("div"),this.ariaLiveContainer.setAttribute("lang",t.lang),this.ariaLiveContainer.setAttribute("id",`aria-live-elements-${Mc}`),this.ariaLiveContainer.setAttribute("style","position: absolute; left: 0px; top: 0px; width: 0px; height: 0px; clip: rect(0px 0px 0px 0px); pointer-events: none;");const i=bp(Un.POLITE),n=bp(Un.ASSERTIVE);this.ariaLiveContainer.appendChild(i),this.ariaLiveContainer.appendChild(n),this.politeElements=Array.from(i.children),this.assertiveElements=Array.from(n.children),Mc++}announce(e,t,i){const n=je()({ariaLivePriority:Un.POLITE},i);if(this.hasSpoken=!0,e)if(it(e)&&(e=e.value),n.ariaLivePriority===Un.POLITE){const r=this.politeElements[this.politeElementIndex];this.updateLiveElement(r,e,t),this.politeElementIndex=(this.politeElementIndex+1)%this.politeElements.length}else if(n.ariaLivePriority===Un.ASSERTIVE){const r=this.assertiveElements[this.assertiveElementIndex];this.updateLiveElement(r,e,t),this.assertiveElementIndex=(this.assertiveElementIndex+1)%this.assertiveElements.length}else assert&&assert(!1,"unsupported aria live prioirity");this.announcementCompleteEmitter.emit(t,e)}cancel(){}cancelUtterance(e){}updateLiveElement(e,t,i){e.textContent="",e.hidden=!1,this.readyToAnnounce=!1,Gi.setTimeout(()=>{i.predicate()?(dt.setTextContent(e,t),Gi.setTimeout(()=>{_i.safari&&!_i.mobileSafari?e.hidden=!0:e.textContent="",this.readyToAnnounce=!0},po.ARIA_LIVE_DELAY)):this.readyToAnnounce=!0},0)}};po.ARIA_LIVE_DELAY=200,po.AriaLive=Un;let vl=po;bn.register("AriaLiveAnnouncer",vl);const Ff=vl;class Hf{constructor(e){this.utterance=e,this.timeInQueue=0,this.stableTime=0,this.announcingUtterancePriorityListener=null}resetTimingVariables(){this.timeInQueue=0,this.stableTime=0}}bn.register("UtteranceWrapper",Hf);class jl extends yi{constructor(e,t){const i=je()({debug:!1,initialize:!0,featureSpecificAnnouncingControlPropertyName:null},t);super(i),this.announcer=e,this._initialized=i.initialize,this.featureSpecificAnnouncingControlPropertyName=i.featureSpecificAnnouncingControlPropertyName,this.queue=[],this._muted=!1,this._enabled=!0,this.utteranceToPriorityListenerMap=new Map,this.announcingUtteranceWrapper=null,this.debug=i.debug,this.announcer.announcementCompleteEmitter.addListener(n=>{if(this.announcingUtteranceWrapper&&n===this.announcingUtteranceWrapper.utterance){assert&&assert(this.announcingUtteranceWrapper.announcingUtterancePriorityListener,"announcingUtterancePriorityListener should be set on this.announcingUtteranceWrapper");const r=this.announcingUtteranceWrapper.announcingUtterancePriorityListener;this.announcingUtteranceWrapper.utterance.priorityProperty.hasListener(r)&&(this.announcingUtteranceWrapper.utterance.priorityProperty.unlink(r),this.announcingUtteranceWrapper.announcingUtterancePriorityListener=null,this.announcingUtteranceWrapper=null)}}),this.stepQueueListener=null,this._initialized&&(this.stepQueueListener=this.stepQueue.bind(this),Gi.addListener(this.stepQueueListener))}get length(){return this.queue.length}addToBack(e){if(this.initializedAndEnabled)if(!this.announcer.hasSpoken)this.announceImmediately(e);else{const t=this.prepareUtterance(e);this.queue.push(t),this.debug&&console.log("addToBack"),this.addPriorityListenerAndPrioritizeQueue(t)}}addToFront(e){if(Xs("`addToFront()` has been deprecated because it is confusing, and most of the time doesn't do what is expected, because Utterances are announced based on time-in-queue first, and then position in the queue. It is recommended to use addToBack, and then timing variables on Utterances, or instead call queue.clear() before adding a more important alert to the queue."),!this.initializedAndEnabled)return;const t=this.prepareUtterance(e);this.queue.unshift(t)}addPriorityListenerAndPrioritizeQueue(e){assert&&assert(!this.utteranceToPriorityListenerMap.has(e.utterance),"About to add the priority listener twice and only one should exist on the Utterance. The listener should have been removed by removeOthersAndUpdateUtteranceWrapper.");const t=()=>{this.prioritizeUtterances(e)};e.utterance.priorityProperty.lazyLink(t),this.utteranceToPriorityListenerMap.set(e.utterance,t),this.prioritizeUtterances(e)}prepareUtterance(e){e instanceof xs||(e=new xs({alert:e}));const t=new Hf(e);return this.removeOthersAndUpdateUtteranceWrapper(t),t.stableTime=0,t}removeUtterance(e){const t=n=>n.utterance===e;assert&&assert(_.find(this.queue,t),"utterance to be removed not found in queue");const i=_.remove(this.queue,t);this.removePriorityListeners(i)}prioritizeUtterances(e){let t=this.queue.indexOf(e);const i=t>=0;let n;i?n=t-1:n=-1;for(let r=n;r>=0;r--){const h=this.queue[r];this.shouldUtteranceCancelOther(e.utterance,h.utterance)&&this.removeUtterance(h.utterance)}if(i){t=this.queue.indexOf(e),assert&&assert(t>-1,"utteranceWrapper is not in queue?");const r=this.queue[t+1];r&&this.shouldUtteranceCancelOther(r.utterance,e.utterance)&&this.removeUtterance(e.utterance)}this.queue.length>0&&this.announcer.onUtterancePriorityChange(this.queue[0].utterance)}shouldUtteranceCancelOther(e,t){return this.announcer.shouldUtteranceCancelOther(e,t)}removeOthersAndUpdateUtteranceWrapper(e){const t=[];for(let n=0;n<this.queue.length;n++){const r=this.queue[n];r.utterance===e.utterance&&t.push(r.timeInQueue)}t.length>=1&&(e.timeInQueue=Math.max(...t));const i=_.remove(this.queue,n=>n.utterance===e.utterance);this.removePriorityListeners(i)}get initializedAndEnabled(){return this._enabled&&this._initialized}getNextUtterance(){let e=null;for(let t=0;t<this.queue.length;t++){const i=this.queue[t];if(i.stableTime>i.utterance.alertStableDelay||i.timeInQueue>i.utterance.alertMaximumDelay){e=i;break}}return e}hasUtterance(e){for(let t=0;t<this.queue.length;t++){const i=this.queue[t];if(e===i.utterance)return!0}return!1}clear(){this.debug&&console.log("UttearnceQueue.clear()"),this.removePriorityListeners(this.queue),this.queue.length=0}cancelUtterance(e){this.announcer.cancelUtterance(e),this.hasUtterance(e)&&this.removeUtterance(e)}cancel(){this.debug&&console.log("UtteranceQueue.cancel()"),this.clear(),this.announcer.cancel()}removePriorityListeners(e){e.forEach(t=>this.removePriorityListener(t.utterance))}removePriorityListener(e){const t=this.utteranceToPriorityListenerMap.get(e);t&&(e.priorityProperty.unlink(t),this.utteranceToPriorityListenerMap.delete(e))}setMuted(e){this._muted=e}set muted(e){this.setMuted(e)}get muted(){return this.getMuted()}getMuted(){return this._muted}setEnabled(e){this._enabled=e}set enabled(e){this.setEnabled(e)}get enabled(){return this.isEnabled()}isEnabled(){return this._enabled}stepQueue(e){if(this._enabled&&(e*=1e3,this.queue.length>0)){for(let i=0;i<this.queue.length;i++){const n=this.queue[i];n.timeInQueue+=e,n.stableTime+=e}const t=this.getNextUtterance();t&&this.attemptToAnnounce(t)}}announceImmediately(e){if(this.initializedAndEnabled&&(this.debug&&console.log("announceImmediately"),e instanceof xs||(e=new xs({alert:e})),this.announcingUtteranceWrapper===null||this.announcer.shouldUtteranceCancelOther(e,this.announcingUtteranceWrapper.utterance))){const t=this.prepareUtterance(e);t.stableTime=Number.POSITIVE_INFINITY,t.timeInQueue=Number.POSITIVE_INFINITY,this.queue.unshift(t),this.addPriorityListenerAndPrioritizeQueue(t),this.queue.includes(t)&&this.attemptToAnnounce(t)}}attemptToAnnounce(e){const t=e.utterance;if(this.announcer.readyToAnnounce){const i=t.getAlertText(this.announcer.respectResponseCollectorProperties);this.debug&&console.log("ready to announce in attemptToAnnounce(): ",i);const n=!this.featureSpecificAnnouncingControlPropertyName||t[this.featureSpecificAnnouncingControlPropertyName].value,r=t.canAnnounceProperty.value&&t.predicate()&&n;!this._muted&&r&&i!==""?(assert&&assert(this.announcingUtteranceWrapper===null,"announcingUtteranceWrapper and its priorityProperty listener should have been disposed"),this.announcingUtteranceWrapper=e,this.announcingUtteranceWrapper.announcingUtterancePriorityListener=()=>{this.prioritizeUtterances(e)},e.utterance.priorityProperty.link(this.announcingUtteranceWrapper.announcingUtterancePriorityListener),this.debug&&console.log("announcing: ",i),this.announcer.announce(i,t,t.announcerOptions)):this.debug&&console.log("announcer readyToAnnounce but utterance cannot announce, will not be spoken: ",i),this.queue.includes(e)&&this.removeUtterance(e.utterance)}else this.debug&&console.log("announcer not readyToAnnounce")}dispose(){this._initialized&&(assert&&assert(this.stepQueueListener),Gi.removeListener(this.stepQueueListener)),super.dispose()}static fromFactory(){const e=new Ff,t=new jl(e),i=e.ariaLiveContainer;document.body?document.body.appendChild(i):document.children[0].appendChild(i);let n=0;const r=h=>{const p=h-n;n=h,phet.axon.stepTimer.emit(p/1e3),self.requestAnimationFrame(r)};return self.requestAnimationFrame(r),t}}bn.register("UtteranceQueue",jl);const Vf=jl,ql=new Vf(cn,{featureSpecificAnnouncingControlPropertyName:"voicingCanAnnounceProperty"});ql.enabled=!1;q.register("voicingUtteranceQueue",ql);function Gv(l){if(!(l instanceof xs))throw new Error("utterance is not an Utterance")}class vp extends xs{constructor(e){super(e)}}const Nc=["voicingNameResponse","voicingObjectResponse","voicingContextResponse","voicingHintResponse","voicingUtterance","voicingResponsePatternCollection","voicingIgnoreVoicingManagerProperties","voicingFocusListener"],tn=l=>{assert&&assert(_.includes(vs(l),Ge),"Only Node subtypes should compose Voicing");const e=_a("Voicing",Nc,class Gf extends bu(l){constructor(...i){super(...i),this._boundInstanceCanVoiceChangeListener=this.onInstanceCanVoiceChange.bind(this),this._voicingUtterance=null,Gf.prototype.initialize.call(this)}initialize(...i){return super.initialize&&super.initialize(i),this._voicingCanSpeakProperty=new vt(!0),this._voicingResponsePacket=new ma,this._voicingFocusListener=this.defaultFocusListener,this.setVoicingUtterance(new vp),this._voicingCanSpeakCount=0,this._boundInstancesChangedListener=this.addOrRemoveInstanceListeners.bind(this),this.changedInstanceEmitter.addListener(this._boundInstancesChangedListener),this._speakContentOnFocusListener={focus:n=>{this._voicingFocusListener&&this._voicingFocusListener(n)}},this.addInputListener(this._speakContentOnFocusListener),this}voicingSpeakFullResponse(i){const n=ii({},i);n.hasOwnProperty("nameResponse")||(n.nameResponse=this._voicingResponsePacket.nameResponse),n.hasOwnProperty("objectResponse")||(n.objectResponse=this._voicingResponsePacket.objectResponse),n.hasOwnProperty("contextResponse")||(n.contextResponse=this._voicingResponsePacket.contextResponse),n.hasOwnProperty("hintResponse")||(n.hintResponse=this._voicingResponsePacket.hintResponse),this.collectAndSpeakResponse(n)}voicingSpeakResponse(i){const n=ii({nameResponse:null,objectResponse:null,contextResponse:null,hintResponse:null},i);this.collectAndSpeakResponse(n)}voicingSpeakNameResponse(i){const n=ii({},i);n.hasOwnProperty("nameResponse")||(n.nameResponse=this._voicingResponsePacket.nameResponse),this.collectAndSpeakResponse(n)}voicingSpeakObjectResponse(i){const n=ii({},i);n.hasOwnProperty("objectResponse")||(n.objectResponse=this._voicingResponsePacket.objectResponse),this.collectAndSpeakResponse(n)}voicingSpeakContextResponse(i){const n=ii({},i);n.hasOwnProperty("contextResponse")||(n.contextResponse=this._voicingResponsePacket.contextResponse),this.collectAndSpeakResponse(n)}voicingSpeakHintResponse(i){const n=ii({},i);n.hasOwnProperty("hintResponse")||(n.hintResponse=this._voicingResponsePacket.hintResponse),this.collectAndSpeakResponse(n)}collectAndSpeakResponse(i){this.speakContent(this.collectResponse(i))}collectResponse(i){const n=ii({ignoreProperties:this._voicingResponsePacket.ignoreProperties,responsePatternCollection:this._voicingResponsePacket.responsePatternCollection,utterance:this.voicingUtterance},i);let r=Nf.collectResponses(n);return n.utterance&&(n.utterance.alert=r,r=n.utterance),r}speakContent(i){const n=!Ft.PHET_IO_ENABLED||!this.isInsidePhetioArchetype();i&&n&&ql.addToBack(i)}setVoicingNameResponse(i){this._voicingResponsePacket.nameResponse=i}set voicingNameResponse(i){this.setVoicingNameResponse(i)}get voicingNameResponse(){return this.getVoicingNameResponse()}getVoicingNameResponse(){return this._voicingResponsePacket.nameResponse}setVoicingObjectResponse(i){this._voicingResponsePacket.objectResponse=i}set voicingObjectResponse(i){this.setVoicingObjectResponse(i)}get voicingObjectResponse(){return this.getVoicingObjectResponse()}getVoicingObjectResponse(){return this._voicingResponsePacket.objectResponse}setVoicingContextResponse(i){this._voicingResponsePacket.contextResponse=i}set voicingContextResponse(i){this.setVoicingContextResponse(i)}get voicingContextResponse(){return this.getVoicingContextResponse()}getVoicingContextResponse(){return this._voicingResponsePacket.contextResponse}setVoicingHintResponse(i){this._voicingResponsePacket.hintResponse=i}set voicingHintResponse(i){this.setVoicingHintResponse(i)}get voicingHintResponse(){return this.getVoicingHintResponse()}getVoicingHintResponse(){return this._voicingResponsePacket.hintResponse}setVoicingIgnoreVoicingManagerProperties(i){this._voicingResponsePacket.ignoreProperties=i}set voicingIgnoreVoicingManagerProperties(i){this.setVoicingIgnoreVoicingManagerProperties(i)}get voicingIgnoreVoicingManagerProperties(){return this.getVoicingIgnoreVoicingManagerProperties()}getVoicingIgnoreVoicingManagerProperties(){return this._voicingResponsePacket.ignoreProperties}setVoicingResponsePatternCollection(i){this._voicingResponsePacket.responsePatternCollection=i}set voicingResponsePatternCollection(i){this.setVoicingResponsePatternCollection(i)}get voicingResponsePatternCollection(){return this.getVoicingResponsePatternCollection()}getVoicingResponsePatternCollection(){return this._voicingResponsePacket.responsePatternCollection}setVoicingUtterance(i){this._voicingUtterance!==i&&(this._voicingUtterance&&this.cleanVoicingUtterance(),tn.registerUtteranceToVoicingNode(i,this),this._voicingUtterance=i)}set voicingUtterance(i){this.setVoicingUtterance(i)}get voicingUtterance(){return this.getVoicingUtterance()}getVoicingUtterance(){return Gv(this._voicingUtterance),this._voicingUtterance}setVoicingFocusListener(i){this._voicingFocusListener=i}set voicingFocusListener(i){this.setVoicingFocusListener(i)}get voicingFocusListener(){return this.getVoicingFocusListener()}getVoicingFocusListener(){return this._voicingFocusListener}defaultFocusListener(){this.voicingSpeakFullResponse({contextResponse:null})}get isVoicing(){return!0}dispose(){this.removeInputListener(this._speakContentOnFocusListener),this.changedInstanceEmitter.removeListener(this._boundInstancesChangedListener),this._voicingUtterance&&(this.cleanVoicingUtterance(),this._voicingUtterance=null),super.dispose()}clean(){this.removeInputListener(this._speakContentOnFocusListener),this.changedInstanceEmitter.removeListener(this._boundInstancesChangedListener),this._voicingUtterance&&(this.cleanVoicingUtterance(),this._voicingUtterance=null),super.clean&&super.clean()}onInstanceCanVoiceChange(i){i?this._voicingCanSpeakCount++:this._voicingCanSpeakCount--,assert&&assert(this._voicingCanSpeakCount>=0,"the voicingCanSpeakCount should not go below zero"),assert&&assert(this._voicingCanSpeakCount<=this.instances.length,"The voicingCanSpeakCount cannot be greater than the number of Instances."),this._voicingCanSpeakProperty.value=this._voicingCanSpeakCount>0}handleInstancesChanged(i,n){i.visible&&i.voicingVisible&&(this._voicingCanSpeakCount=n?this._voicingCanSpeakCount+1:this._voicingCanSpeakCount-1),this._voicingCanSpeakProperty.value=this._voicingCanSpeakCount>0}addOrRemoveInstanceListeners(i,n){assert&&assert(i.canVoiceEmitter,"Instance must be initialized."),n?i.canVoiceEmitter.addListener(this._boundInstanceCanVoiceChangeListener):i.canVoiceEmitter.removeListener(this._boundInstanceCanVoiceChangeListener),this.handleInstancesChanged(i,n)}cleanVoicingUtterance(){assert&&assert(this._voicingUtterance,"A voicingUtterance must be available to clean."),this._voicingUtterance instanceof vp?this._voicingUtterance.dispose():this._voicingUtterance&&!this._voicingUtterance.isDisposed&&tn.unregisterUtteranceToVoicingNode(this._voicingUtterance,this)}mutate(i){return super.mutate(i)}});return e.prototype._mutatorKeys=Nc.concat(e.prototype._mutatorKeys),assert&&assert(e.prototype._mutatorKeys.length===_.uniq(e.prototype._mutatorKeys).length,"duplicate mutator keys in Voicing"),e};tn.VOICING_OPTION_KEYS=Nc;tn.alertUtterance=l=>{assert&&assert(l.voicingCanAnnounceProperties.length>0,"voicingCanAnnounceProperties required, this Utterance might not be connected to Node in the scene graph."),ql.addToBack(l)};tn.registerUtteranceToVoicingNode=(l,e)=>{const t=l.voicingCanAnnounceProperties,i=e._voicingCanSpeakProperty;t.includes(i)||(l.voicingCanAnnounceProperties=t.concat([i]))};tn.unregisterUtteranceToVoicingNode=(l,e)=>{const t=l.voicingCanAnnounceProperties,i=e._voicingCanSpeakProperty,n=t.indexOf(i);assert&&assert(n>-1,"voicingNode.voicingCanSpeakProperty is not on the Utterance, was it not registered?"),l.voicingCanAnnounceProperties=t.splice(n,1)};tn.registerUtteranceToNode=(l,e)=>{const t=l.voicingCanAnnounceProperties;t.includes(e.visibleProperty)||(l.voicingCanAnnounceProperties=l.voicingCanAnnounceProperties.concat([e.visibleProperty])),t.includes(e.voicingVisibleProperty)||(l.voicingCanAnnounceProperties=l.voicingCanAnnounceProperties.concat([e.voicingVisibleProperty]))};tn.unregisterUtteranceToNode=(l,e)=>{const t=l.voicingCanAnnounceProperties;assert&&assert(t.includes(e.visibleProperty)&&t.includes(e.voicingVisibleProperty),"visibleProperty and voicingVisibleProperty were not on the Utterance, was it not registered to the node?");const i=t.indexOf(e.visibleProperty),r=t.splice(i,1).indexOf(e.voicingVisibleProperty),h=t.splice(r,1);l.voicingCanAnnounceProperties=h};q.register("Voicing",tn);class zf extends xs{constructor(e,t){super(t),this.readingBlockFocus=e}}q.register("ReadingBlockUtterance",zf);const _l=zf;class Wf{constructor(e){this.node=null,this.visibilityTracker=null,this.focusProperty=e,this.boundVisibilityListener=this.handleTrailVisibilityChange.bind(this),this.boundInstancesChangedListener=this.handleInstancesChange.bind(this),this.boundNodeDisposedListener=this.handleNodeDisposed.bind(this),this.boundFocusListener=this.handleFocusChange.bind(this),this.focusProperty.link(this.boundFocusListener)}handleFocusChange(e){this.removeDisplayedListeners(),e&&this.addDisplayedListeners(e)}handleTrailVisibilityChange(){this.visibilityTracker&&!this.visibilityTracker.trailVisibleProperty.value&&(this.focusProperty.value=null)}handleInstancesChange(e){e.node&&e.node.instances.length===0&&(this.focusProperty.value=null)}handleNodeDisposed(){this.focusProperty.value=null}addDisplayedListeners(e){assert&&assert(this.visibilityTracker===null,"creating a new TrailVisibilityTracker but the last one was not disposed"),assert&&assert(this.node===null,"Still a reference to the previously focused Node, possible memory leak"),this.visibilityTracker=new Tf(e.trail),this.visibilityTracker.addListener(this.boundVisibilityListener),this.node=e.trail.lastNode(),this.node.changedInstanceEmitter.addListener(this.boundInstancesChangedListener),this.node.disposeEmitter.addListener(this.boundNodeDisposedListener)}removeDisplayedListeners(){this.visibilityTracker&&(this.visibilityTracker.removeListener(this.boundVisibilityListener),this.visibilityTracker.dispose(),this.visibilityTracker=null),this.node&&(this.node.changedInstanceEmitter.removeListener(this.boundInstancesChangedListener),this.node.disposeEmitter.removeListener(this.boundNodeDisposedListener),this.node=null)}dispose(){this.removeDisplayedListeners(),this.focusProperty.unlink(this.boundFocusListener),this.node=null,this.visibilityTracker=null}}q.register("FocusDisplayedController",Wf);const Yh=Wf,qt=class qt{constructor(){this.pointerFocusProperty=new ei(null),this.readingBlockFocusProperty=new ei(null),this.lockedPointerFocusProperty=new ei(null),this.pdomFocusHighlightsVisibleProperty=new Wt(!0),this.interactiveHighlightsVisibleProperty=new Wt(!1),this.readingBlockHighlightsVisibleProperty=new Wt(!1),this.voicingFullyEnabledListener=e=>{this.readingBlockHighlightsVisibleProperty.value=e},cn.voicingFullyEnabledProperty.link(this.voicingFullyEnabledListener),this.pointerHighlightsVisibleProperty=new Jt([this.interactiveHighlightsVisibleProperty,this.readingBlockHighlightsVisibleProperty],(e,t)=>e||t),this.readingBlockFocusController=new Yh(this.readingBlockFocusProperty),this.startSpeakingListener=(e,t)=>{this.readingBlockFocusProperty.value=t instanceof _l?t.readingBlockFocus:null},cn.startSpeakingEmitter.addListener(this.startSpeakingListener),this.endSpeakingListener=(e,t)=>{t instanceof _l&&this.readingBlockFocusProperty.value&&(assert&&assert(t.readingBlockFocus,"should be non null focus"),t.readingBlockFocus.trail.equals(this.readingBlockFocusProperty.value.trail)&&(this.readingBlockFocusProperty.value=null))},cn.endSpeakingEmitter.addListener(this.endSpeakingListener),this.pointerFocusDisplayedController=new Yh(this.pointerFocusProperty),this.lockedPointerFocusDisplayedController=new Yh(this.lockedPointerFocusProperty),[this.pointerFocusProperty,this.lockedPointerFocusProperty].forEach(e=>{e.link(this.onPointerFocusChange.bind(this))})}dispose(){this.pointerFocusProperty.dispose(),this.readingBlockFocusProperty.dispose(),this.lockedPointerFocusProperty.dispose(),this.pdomFocusHighlightsVisibleProperty.dispose(),this.interactiveHighlightsVisibleProperty.dispose(),this.readingBlockHighlightsVisibleProperty.dispose(),this.readingBlockFocusController.dispose(),this.pointerFocusDisplayedController.dispose(),this.pointerHighlightsVisibleProperty.dispose(),this.lockedPointerFocusDisplayedController.dispose(),cn.startSpeakingEmitter.removeListener(this.startSpeakingListener),cn.endSpeakingEmitter.removeListener(this.endSpeakingListener),cn.voicingFullyEnabledProperty.unlink(this.voicingFullyEnabledListener)}static updatePDOMFocusFromEvent(e,t,i){if(assert&&assert(document.activeElement,"Must be called from focusin, therefore active elemetn expected"),i)for(let n=0;n<e.length;n++){const r=e[n],h=document.activeElement;if(r.isElementUnderPDOM(h,!1)){const p=h.getAttribute(dt.DATA_PDOM_UNIQUE_ID);assert&&assert(p,"Event target must have a unique ID on its data if it is in the PDOM.");const S=en.uniqueIdToTrail(r,p);assert&&assert(S,"We must have a trail since the target was under the PDOM.");const C=en.guessVisualTrail(S,r.rootNode);C.lastNode().focusable?qt.pdomFocus=new Js(r,C):(t.target.blur(),t.stopImmediatePropagation());break}}else for(let n=0;n<e.length;n++){const r=e[n],h=r._input.getRelatedTargetTrail(t);h&&h.lastNode().focusable?qt.pdomFocus=new Js(r,en.guessVisualTrail(h,r.rootNode)):qt.pdomFocus=null}}onPointerFocusChange(e,t){const i=e==null?void 0:e.trail.lastNode();i&&i.isInteractiveHighlighting&&i.handleHighlightActiveChange();const n=t==null?void 0:t.trail.lastNode();n&&n.isInteractiveHighlighting&&n.handleHighlightActiveChange()}static set pdomFocus(e){if(qt.pdomFocusProperty.value!==e){let t;qt.pdomFocusProperty.value&&(t=qt.pdomFocusedNode),qt.pdomFocusProperty.value=e,t&&!e&&t.blur()}}static get pdomFocus(){return qt.pdomFocusProperty.value}static getPDOMFocusedNode(){let e=null;const t=qt.pdomFocusProperty.get();return t&&(e=t.trail.lastNode()),e}static get pdomFocusedNode(){return this.getPDOMFocusedNode()}static attachToWindow(){assert&&assert(!qt.globallyAttached,"Can only be attached statically once."),qt.attachedWindowFocusListener=()=>{qt._windowHasFocusProperty.value=!0},qt.attachedWindowBlurListener=()=>{qt._windowHasFocusProperty.value=!1},self.addEventListener("focus",qt.attachedWindowFocusListener),self.addEventListener("blur",qt.attachedWindowBlurListener),qt._windowHasFocusProperty.value=document.hasFocus(),qt.globallyAttached=!0}static detachFromWindow(){self.removeEventListener("focus",qt.attachedWindowFocusListener),self.removeEventListener("blur",qt.attachedWindowBlurListener),qt._windowHasFocusProperty.value=!1,qt.globallyAttached=!1}};qt.attachedWindowFocusListener=null,qt.attachedWindowBlurListener=null,qt.globallyAttached=!1,qt.pdomFocusProperty=new ei(null,{tandem:Ft.GENERAL_MODEL.createTandem("pdomFocusProperty"),phetioDocumentation:"Stores the current focus in the Parallel DOM, null if nothing has focus. This is not updated based on mouse or touch input, only keyboard and other alternative inputs. Note that this only applies to simulations that support alternative input.",phetioValueType:Lt(Js.FocusIO),phetioState:!1,phetioFeatured:!0,phetioReadOnly:!0}),qt._windowHasFocusProperty=new Wt(!1),qt.windowHasFocusProperty=qt._windowHasFocusProperty;let jt=qt;q.register("FocusManager",jt);const _p=new Me("rgba(212,19,106,0.5)"),Lp=new Me("rgba(250,40,135,0.9)"),zv=new Me("rgba(233,113,166,1.0)"),Wv=new Me("rgba(233,113,166,1.0)"),$v=new Me("rgba(159,15,80,1.0)"),Uv=new Me("rgba(159,15,80,1.0)"),Yv=2.5,Pp=4,Kv=2,jv=2,wi=class wi extends mi{constructor(e,t){const i=je()({outerStroke:_p,innerStroke:Lp,outerLineWidth:null,innerLineWidth:null,dashed:!1,transformSourceNode:null},t);super(e),this.highlightChangedEmitter=new Yi,this._innerHighlightColor=i.innerStroke,this._outerHighlightColor=i.outerStroke;const n=_.pick(i,Object.keys(mi.DEFAULT_PATH_OPTIONS));this.innerLineWidth=i.innerLineWidth,this.outerLineWidth=i.outerLineWidth,this.transformSourceNode=i.transformSourceNode,i.stroke=i.outerStroke,this.mutate(i);const r=ii({},n,{stroke:i.innerStroke});this.innerHighlightPath=new mi(e,r),this.addChild(this.innerHighlightPath),i.dashed&&this.makeDashed(!0)}mutateWithInnerHighlight(e){super.mutate(e),this.innerHighlightPath&&this.innerHighlightPath.mutate(e),this.highlightChangedEmitter.emit()}makeDashed(e){const t=e?[7,7]:[];this.mutateWithInnerHighlight({lineDash:t})}setShape(e){return super.setShape(e),this.innerHighlightPath&&this.innerHighlightPath.setShape(e),this.highlightChangedEmitter&&this.highlightChangedEmitter.emit(),this}updateLineWidth(e){this.lineWidth=this.getOuterLineWidth(e),this.innerHighlightPath.lineWidth=this.getInnerLineWidth(e),this.highlightChangedEmitter.emit()}getOuterLineWidth(e){return this.outerLineWidth?this.outerLineWidth:wi.getOuterLineWidthFromMatrix(e)}getInnerLineWidth(e){return this.innerLineWidth?this.innerLineWidth:wi.getInnerLineWidthFromMatrix(e)}setInnerHighlightColor(e){this._innerHighlightColor=e,this.innerHighlightPath.setStroke(e),this.highlightChangedEmitter.emit()}set innerHighlightColor(e){this.setInnerHighlightColor(e)}get innerHighlightColor(){return this.getInnerHighlightColor()}getInnerHighlightColor(){return this._innerHighlightColor}setOuterHighlightColor(e){this._outerHighlightColor=e,this.setStroke(e),this.highlightChangedEmitter.emit()}set outerHighlightColor(e){this.setOuterHighlightColor(e)}get outerHighlightColor(){return this.getOuterHighlightColor()}getOuterHighlightColor(){return this._outerHighlightColor}getUniqueHighlightTrail(e){assert&&assert(this.transformSourceNode,"getUniqueHighlightTrail requires a transformSourceNode");const t=this.transformSourceNode;let i=null;if(t.instances.length<=1)i=t.getUniqueTrail();else{const n=t.getTrails().filter(r=>r.isExtensionOf(e,!0));assert&&assert(n.length===1,"No unique trail to highlight, either avoid DAG for transformSourceNode or don't use transformSourceNode with HighlightPath"),i=n[0]}return assert&&assert(i,"no unique Trail found for getUniqueHighlightTrail"),i}static getInnerLineWidthFromMatrix(e){return Yv/wi.localToGlobalScaleFromMatrix(e)}static getOuterLineWidthFromMatrix(e){return Pp/wi.localToGlobalScaleFromMatrix(e)}static localToGlobalScaleFromMatrix(e){return Math.sqrt(e.m00()*e.m00()+e.m10()*e.m10())}static getDilationCoefficient(e){return wi.getOuterLineWidthFromMatrix(e)*(.5+.25)}static getDefaultDilationCoefficient(){return wi.getDilationCoefficient($e.IDENTITY)}static getDefaultGroupDilationCoefficient(){return wi.getGroupDilationCoefficient($e.IDENTITY)}static getDefaultHighlightLineWidth(){return Pp}static getGroupDilationCoefficient(e){return wi.getOuterLineWidthFromMatrix(e)*(.5+1.4)}static getPanZoomCorrectingMatrix(){return zp.initialized?zp.listener.matrixProperty.value.inverted():$e.IDENTITY}static getLayoutCorrectingMatrix(){return $e.scaling(1/wi.layoutScale,1/wi.layoutScale)}static getCorrectiveScalingMatrix(){return wi.getPanZoomCorrectingMatrix().timesMatrix(wi.getLayoutCorrectingMatrix())}};wi.OUTER_FOCUS_COLOR=_p,wi.INNER_FOCUS_COLOR=Lp,wi.INNER_LIGHT_GROUP_FOCUS_COLOR=zv,wi.OUTER_LIGHT_GROUP_FOCUS_COLOR=Wv,wi.INNER_DARK_GROUP_FOCUS_COLOR=$v,wi.OUTER_DARK_GROUP_FOCUS_COLOR=Uv,wi.GROUP_OUTER_LINE_WIDTH=Kv,wi.GROUP_INNER_LINE_WIDTH=jv,wi.layoutScale=1;let Ll=wi;q.register("HighlightPath",Ll);const fi=Ll;class qv extends fi{constructor(e,t){const i=je()({outerStroke:fi.OUTER_LIGHT_GROUP_FOCUS_COLOR,innerStroke:fi.INNER_LIGHT_GROUP_FOCUS_COLOR,outerLineWidth:fi.GROUP_OUTER_LINE_WIDTH,innerLineWidth:fi.GROUP_INNER_LINE_WIDTH},t);super(e,i)}}q.register("GroupHighlightPath",qv);class $f extends fi{constructor(e,t){const i=je()({useLocalBounds:!0,dilationCoefficient:null,useGroupDilation:!1},t);i.transformSourceNode=e,super(null,i),this.observedBoundsProperty=null,this.boundsListener=null,this.useLocalBounds=i.useLocalBounds,this.useGroupDilation=i.useGroupDilation,this.dilationCoefficient=i.dilationCoefficient,e&&this.setShapeFromNode(e)}setShapeFromNode(e,t){this.observedBoundsProperty&&(assert&&assert(this.boundsListener,"should be a listener if there is a previous focusHighlightNode"),this.observedBoundsProperty.unlink(this.boundsListener)),this.observedBoundsProperty=e.localBoundsProperty,this.boundsListener=i=>{if(!i.isFinite())return;let n=this.dilationCoefficient;assert&&assert(t||e.getTrails().length<2,"HighlightFromNode requires a unique Trail if using DAG.");const h=(t||e.getUniqueTrail()).getMatrix().timesMatrix(fi.getCorrectiveScalingMatrix());this.dilationCoefficient===null&&(n=this.useGroupDilation?fi.getGroupDilationCoefficient(h):fi.getDilationCoefficient(h));const S=(this.useLocalBounds?e.getVisibleLocalBounds():e.getVisibleBounds()).dilated(n);this.setShape(yt.bounds(S))},this.observedBoundsProperty.link(this.boundsListener)}dispose(){this.observedBoundsProperty&&(assert&&assert(this.boundsListener,"should be a listener if there is a previous focusHighlightNode"),this.observedBoundsProperty.unlink(this.boundsListener)),super.dispose()}}q.register("HighlightFromNode",$f);const ko=$f;class Xl extends ko{constructor(e,t){const i=je()({outerStroke:"grey",innerStroke:"black"},t);super(e,i)}}q.register("ReadingBlockHighlight",Xl);const Sp=["readingBlockTagName","readingBlockNameResponse","readingBlockHintResponse","readingBlockResponsePatternCollection","readingBlockActiveHighlight"];function Xv(l){l instanceof _l||assert&&assert(!1,"utterance is not a ReadinBlockUtterance")}class wp extends _l{constructor(e,t){super(e,t)}}const Zv=new hr({nameHint:"{{NAME}}. {{HINT}}"}),vu=Ai(l=>{const e=_a("ReadingBlock",Sp,class extends tn(l){constructor(...i){super(...i),this._readingBlockTagName="button",this._readingBlockDisabledTagName="p",this._readingBlockActiveHighlight=null,this.readingBlockActiveHighlightChangedEmitter=new zt,this.readingBlockResponsePatternCollection=Zv,this._localBoundsChangedListener=this._onLocalBoundsChanged.bind(this),this.localBoundsProperty.link(this._localBoundsChangedListener),this._readingBlockInputListener={focus:n=>this._speakReadingBlockContentListener(n),up:n=>this._speakReadingBlockContentListener(n),click:n=>this._speakReadingBlockContentListener(n)},this._readingBlockFocusableChangeListener=this._onReadingBlockFocusableChanged.bind(this),cn.speechAllowedAndFullyEnabledProperty.link(this._readingBlockFocusableChangeListener),this.focusHighlight=new Xl(this),this.voicingUtterance=new wp(null)}get isReadingBlock(){return!0}setReadingBlockTagName(i){this._readingBlockTagName=i,this._onReadingBlockFocusableChanged(cn.speechAllowedAndFullyEnabledProperty.value)}set readingBlockTagName(i){this.setReadingBlockTagName(i)}get readingBlockTagName(){return this.getReadingBlockTagName()}getReadingBlockTagName(){return this._readingBlockTagName}setReadingBlockNameResponse(i){this._voicingResponsePacket.nameResponse=i}set readingBlockNameResponse(i){this.setReadingBlockNameResponse(i)}get readingBlockNameResponse(){return this.getReadingBlockNameResponse()}getReadingBlockNameResponse(){return this._voicingResponsePacket.nameResponse}setReadingBlockHintResponse(i){this._voicingResponsePacket.hintResponse=i}set readingBlockHintResponse(i){this.setReadingBlockHintResponse(i)}get readingBlockHintResponse(){return this.getReadingBlockHintResponse()}getReadingBlockHintResponse(){return this._voicingResponsePacket.hintResponse}setReadingBlockResponsePatternCollection(i){this._voicingResponsePacket.responsePatternCollection=i}set readingBlockResponsePatternCollection(i){this.setReadingBlockResponsePatternCollection(i)}get readingBlockResponsePatternCollection(){return this.getReadingBlockResponsePatternCollection()}getReadingBlockResponsePatternCollection(){return this._voicingResponsePacket.responsePatternCollection}setVoicingUtterance(i){super.setVoicingUtterance(i)}set voicingUtterance(i){super.voicingUtterance=i}get voicingUtterance(){return this.getVoicingUtterance()}getVoicingUtterance(){const i=super.getVoicingUtterance();return Xv(i),i}setVoicingNameResponse(){assert&&assert(!1,"ReadingBlocks only support setting the name response via readingBlockNameResponse")}getVoicingNameResponse(){assert&&assert(!1,"ReadingBlocks only support getting the name response via readingBlockNameResponse")}setVoicingObjectResponse(){assert&&assert(!1,"ReadingBlocks do not support setting object response")}getVoicingObjectResponse(){assert&&assert(!1,"ReadingBlocks do not support setting object response")}setVoicingContextResponse(){assert&&assert(!1,"ReadingBlocks do not support setting context response")}getVoicingContextResponse(){assert&&assert(!1,"ReadingBlocks do not support setting context response")}setVoicingHintResponse(){assert&&assert(!1,"ReadingBlocks only support setting the hint response via readingBlockHintResponse.")}getVoicingHintResponse(){assert&&assert(!1,"ReadingBlocks only support getting the hint response via readingBlockHintResponse.")}setVoicingResponsePatternCollection(){assert&&assert(!1,"ReadingBlocks only support setting the response patterns via readingBlockResponsePatternCollection.")}getVoicingResponsePatternCollection(){assert&&assert(!1,"ReadingBlocks only support getting the response patterns via readingBlockResponsePatternCollection.")}setReadingBlockActiveHighlight(i){this._readingBlockActiveHighlight!==i&&(this._readingBlockActiveHighlight=i,this.readingBlockActiveHighlightChangedEmitter.emit())}set readingBlockActiveHighlight(i){this.setReadingBlockActiveHighlight(i)}get readingBlockActiveHighlight(){return this._readingBlockActiveHighlight}getReadingBlockActiveHighlight(){return this._readingBlockActiveHighlight}isReadingBlockActivated(){let i=!1;const n=Object.keys(this.displays);for(let r=0;r<n.length;r++){const h=this.displays[n[r]].focusManager.readingBlockFocusProperty.value;if(h&&h.trail.lastNode()===this){i=!0;break}}return i}get readingBlockActivated(){return this.isReadingBlockActivated()}_onReadingBlockFocusableChanged(i){this.focusable=i,i?(this.tagName=this._readingBlockTagName,this.hasInputListener(this._readingBlockInputListener)||this.addInputListener(this._readingBlockInputListener)):(this.tagName=this._readingBlockDisabledTagName,this.hasInputListener(this._readingBlockInputListener)&&this.removeInputListener(this._readingBlockInputListener))}_onLocalBoundsChanged(i){this.mouseArea=i,this.touchArea=i}_speakReadingBlockContentListener(i){const n=this.getConnectedDisplays(),r=this.voicingUtterance,h=this.collectResponse({nameResponse:this.getReadingBlockNameResponse(),hintResponse:this.getReadingBlockHintResponse(),ignoreProperties:this.voicingIgnoreVoicingManagerProperties,responsePatternCollection:this._voicingResponsePacket.responsePatternCollection,utterance:r});if(h){for(let p=0;p<n.length;p++)if(!this.getDescendantsUseHighlighting(i.trail)){const S=i.trail.subtrailTo(this),C=en.guessVisualTrail(S,n[p].rootNode),B=new Js(n[p],C);r.readingBlockFocus=B,this.speakContent(h)}}}cleanVoicingUtterance(){this._voicingUtterance instanceof wp&&this._voicingUtterance.dispose(),super.cleanVoicingUtterance()}dispose(){cn.speechAllowedAndFullyEnabledProperty.unlink(this._readingBlockFocusableChangeListener),this.localBoundsProperty.unlink(this._localBoundsChangedListener),this.hasInputListener(this._readingBlockInputListener)&&this.removeInputListener(this._readingBlockInputListener),super.dispose()}mutate(i){return super.mutate(i)}});return e.prototype._mutatorKeys=Sp.concat(e.prototype._mutatorKeys),assert&&assert(e.prototype._mutatorKeys.length===_.uniq(e.prototype._mutatorKeys).length,"x mutator keys in ReadingBlock"),e});q.register("ReadingBlock",vu);const Ar={isPlatformMac:()=>_.includes(self.navigator.platform,"Mac"),getPlatformZoomMetaKey:()=>Ar.isPlatformMac()?"metaKey":"ctrlKey",isZoomCommand:(l,e)=>{const t=e?me.KEY_EQUALS:me.KEY_MINUS,i=Ar.getPlatformZoomMetaKey();return l[i]&&me.isKeyEvent(l,t)},isZoomResetCommand:l=>{const e=Ar.getPlatformZoomMetaKey();return l[e]&&me.isKeyEvent(l,me.KEY_0)}};q.register("KeyboardZoomUtils",Ar);const Cp={INPUT:[...me.ARROW_KEYS,me.KEY_PAGE_UP,me.KEY_PAGE_DOWN,me.KEY_HOME,me.KEY_END,me.KEY_ENTER,me.KEY_SPACE],DIV:[...me.ARROW_KEYS,...me.WASD_KEYS],P:[me.KEY_ESCAPE],BUTTON:[me.KEY_ENTER,me.KEY_SPACE]},Tp=me.ALL_KEYS,Dp=100,Qv=.1,Uf=.6,Jv=Uf+.1,e_="keydown",t_="keyup";class i_{constructor(e,t){this.display=e,this.random=new qc({seed:t}),this.numberOfComponentsTested=10,this.keyupListeners=[],this.currentElement=null}chooseNextElement(){if(this.currentElement===null)this.currentElement=document.activeElement;else if(this.random.nextDouble()<Qv){sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer("choosing new element"),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push(),this.clearListeners();const e=dt.getRandomFocusable(this.random);e.focus(),this.currentElement=e,sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}}clearListeners(){this.keyupListeners.forEach(e=>{assert&&assert(typeof e.timeout=="function","should have an attached timeout"),Gi.clearTimeout(e.timeout),e(),assert&&assert(!this.keyupListeners.includes(e),"calling listener should remove itself from the keyupListeners.")})}triggerClickEvent(){sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer("triggering click"),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push();const e=document.activeElement;e instanceof HTMLElement&&e.click(),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}triggerKeyDownUpEvents(e){sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer(`trigger keydown/up: ${e}`),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push(),this.triggerDOMEvent(e_,e);const t=this.random.nextInt(Dp),i=()=>{this.triggerDOMEvent(t_,e),this.keyupListeners.includes(i)&&this.keyupListeners.splice(this.keyupListeners.indexOf(i),1)};i.timeout=Gi.setTimeout(i,t===Dp?2e3:t),this.keyupListeners.push(i),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}triggerRandomKeyDownUpEvents(e){const t=Tp[Math.floor(this.random.nextDouble()*(Tp.length-1))];sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer(`trigger random keydown/up: ${t}`),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push(),this.triggerKeyDownUpEvents(t),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}fuzzBoardEvents(e){if(this.display&&this.display._input&&this.display._input.pdomPointer){const t=this.display._input.pdomPointer;t&&!t.blockTrustedEvents&&(t.blockTrustedEvents=!0)}for(let t=0;t<this.numberOfComponentsTested;t++){this.chooseNextElement();for(let i=0;i<e/this.numberOfComponentsTested;i++){sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.KeyboardFuzzer(`main loop, i=${i}`),sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.push();const n=document.activeElement;if(n&&Cp[n.tagName.toUpperCase()]){const r=this.random.nextDouble();if(r<Uf){const h=Cp[n.tagName],p=this.random.sample(h);this.triggerKeyDownUpEvents(p)}else r<Jv?this.triggerClickEvent():this.triggerRandomKeyDownUpEvents(n)}else n&&this.triggerRandomKeyDownUpEvents(n);sceneryLog&&sceneryLog.KeyboardFuzzer&&sceneryLog.pop()}}}triggerDOMEvent(e,t){if(document.activeElement){const i=new KeyboardEvent(e,{bubbles:!0,code:t,shiftKey:ys.shiftKeyDown,altKey:ys.altKeyDown,ctrlKey:ys.ctrlKeyDown});document.activeElement.dispatchEvent(i)}}}q.register("KeyboardFuzzer",i_);class s_ extends ko{constructor(e,t){const i=je()({outerStroke:fi.OUTER_LIGHT_GROUP_FOCUS_COLOR,innerStroke:fi.INNER_LIGHT_GROUP_FOCUS_COLOR,outerLineWidth:fi.GROUP_OUTER_LINE_WIDTH,innerLineWidth:fi.GROUP_INNER_LINE_WIDTH,useGroupDilation:!0},t);super(e,i)}}q.register("GroupHighlightFromNode",s_);const Ip="rgba(255,255,0,0.5)",cd=class cd extends ko{constructor(e,t){const i=je()({innerStroke:null,outerStroke:null,fill:Ip},t);super(e,i)}};cd.ACTIVATED_HIGHLIGHT_COLOR=Ip;let Pl=cd;q.register("ActivatedReadingBlockHighlight",Pl);const n_=Pl,Ja="PRIMARY_SIBLING",r_="LABEL_SIBLING",a_="DESCRIPTION_SIBLING",o_="CONTAINER_PARENT",l_=dt.TAGS.LABEL,h_=dt.TAGS.INPUT,Kh="disabled",c_={attributes:!1,childList:!0,characterData:!0};let u_=1;const Pr=new Be(0,0,0,0),Ln=new Be(0,0,0,0),xp=new $e,Ep=new $e,d_=new $e;class ss{constructor(e,t){this.initializePDOMPeer(e,t)}initializePDOMPeer(e,t){return t=ns({primarySibling:null},t),assert&&assert(!this.id||this.isDisposed,"If we previously existed, we need to have been disposed"),this.id=this.id||u_++,this.pdomInstance=e,this.node=this.pdomInstance.node,this.display=e.display,this.trail=e.trail,this.visible=null,this.focusable=null,this._labelSibling=null,this._descriptionSibling=null,this._containerParent=null,this.topLevelElements=[],this.positionDirty=!1,this.forceReflowWorkaround=!1,this.childPositionDirty=!1,this.positionInPDOM=!1,this.mutationObserver=this.mutationObserver||new MutationObserver(this.invalidateCSSPositioning.bind(this,!1)),this.transformListener=this.transformListener||this.invalidateCSSPositioning.bind(this,!1),this.pdomInstance.transformTracker.addListener(this.transformListener),this._preservedDisabledValue=null,this.isDisposed=!1,this.pdomInstance.isRootInstance&&(this._primarySibling=t.primarySibling,this._primarySibling.classList.add(cu.ROOT_CLASS_NAME),dt.BLOCKED_DOM_EVENTS.forEach(i=>{this._primarySibling.addEventListener(i,n=>{n.stopPropagation()})})),this}update(e){let t=this.node.getBaseOptions();const i=[];this.node.accessibleName!==null&&(t=this.node.accessibleNameBehavior(this.node,t,this.node.accessibleName,i),assert&&assert(typeof t=="object","should return an object")),this.node.pdomHeading!==null&&(t=this.node.pdomHeadingBehavior(this.node,t,this.node.pdomHeading,i),assert&&assert(typeof t=="object","should return an object")),this.node.helpText!==null&&(t=this.node.helpTextBehavior(this.node,t,this.node.helpText,i),assert&&assert(typeof t=="object","should return an object")),this._primarySibling=cl(t.tagName,this.node.focusable,{namespace:t.pdomNamespace}),t.containerTagName&&(this._containerParent=cl(t.containerTagName,!1)),t.labelTagName&&(this._labelSibling=cl(t.labelTagName,!1,{excludeFromInput:this.node.excludeLabelSiblingFromInput})),t.descriptionTagName&&(this._descriptionSibling=cl(t.descriptionTagName,!1)),e&&this.updateIndicesStringAndElementIds(),this.orderElements(t),this.mutationObserver.disconnect(),this.mutationObserver.observe(this._primarySibling,c_),t.labelContent&&t.labelTagName!==null&&this.setLabelSiblingContent(t.labelContent),t.innerContent&&t.tagName!==null&&this.setPrimarySiblingContent(t.innerContent),t.descriptionContent&&t.descriptionTagName!==null&&this.setDescriptionSiblingContent(t.descriptionContent),t.tagName.toUpperCase()===h_&&t.inputType&&this.setAttributeToElement("type",t.inputType),t.labelTagName&&t.labelTagName.toUpperCase()===l_&&this.setAttributeToElement("for",this._primarySibling.id,{elementName:ss.LABEL_SIBLING}),this.setFocusable(this.node.focusable),this.setPositionInPDOM(this.node.positionInPDOM),this.onAriaLabelledbyAssociationChange(),this.onAriaDescribedbyAssociationChange(),this.onActiveDescendantAssociationChange(),this.onAttributeChange(t),this.onClassChange(),this.onInputValueChange(),this.node.updateOtherNodesAriaLabelledby(),this.node.updateOtherNodesAriaDescribedby(),this.node.updateOtherNodesActiveDescendant(),i.forEach(n=>{assert&&assert(typeof n=="function"),n()})}orderElements(e){this._containerParent?(this._containerParent.insertBefore(this._primarySibling,this._containerParent.children[0]||null),this.topLevelElements=[this._containerParent]):this.topLevelElements=[this._labelSibling,this._descriptionSibling,this._primarySibling].filter(_.identity),this._labelSibling&&this.arrangeContentElement(this._labelSibling,e.appendLabel),this._descriptionSibling&&this.arrangeContentElement(this._descriptionSibling,e.appendDescription)}getPrimarySibling(){return this._primarySibling}get primarySibling(){return this.getPrimarySibling()}getLabelSibling(){return this._labelSibling}get labelSibling(){return this.getLabelSibling()}getDescriptionSibling(){return this._descriptionSibling}get descriptionSibling(){return this.getDescriptionSibling()}getContainerParent(){return this._containerParent}get containerParent(){return this.getContainerParent()}getTopLevelElementContainingPrimarySibling(){return this._containerParent||this._primarySibling}onAriaLabelledbyAssociationChange(){this.removeAttributeFromAllElements("aria-labelledby");for(let e=0;e<this.node.ariaLabelledbyAssociations.length;e++){const t=this.node.ariaLabelledbyAssociations[e];assert&&assert(t.otherNode.nodesThatAreAriaLabelledbyThisNode.indexOf(this.node)>=0,"unexpected otherNode"),this.setAssociationAttribute("aria-labelledby",t)}}onAriaDescribedbyAssociationChange(){this.removeAttributeFromAllElements("aria-describedby");for(let e=0;e<this.node.ariaDescribedbyAssociations.length;e++){const t=this.node.ariaDescribedbyAssociations[e];assert&&assert(t.otherNode.nodesThatAreAriaDescribedbyThisNode.indexOf(this.node)>=0,"unexpected otherNode"),this.setAssociationAttribute("aria-describedby",t)}}onActiveDescendantAssociationChange(){this.removeAttributeFromAllElements("aria-activedescendant");for(let e=0;e<this.node.activeDescendantAssociations.length;e++){const t=this.node.activeDescendantAssociations[e];assert&&assert(t.otherNode.nodesThatAreActiveDescendantToThisNode.indexOf(this.node)>=0,"unexpected otherNode"),this.setAssociationAttribute("aria-activedescendant",t)}}handleAttributeWithPDOMOption(e,t){typeof t=="string"?this.setAttributeToElement(e,t):this.removeAttributeFromElement(e)}onAttributeChange(e){for(let t=0;t<this.node.pdomAttributes.length;t++){const i=this.node.pdomAttributes[t];this.setAttributeToElement(i.attribute,i.value,i.options)}this.handleAttributeWithPDOMOption("aria-label",e.ariaLabel),this.handleAttributeWithPDOMOption("role",e.ariaRole)}onClassChange(){for(let e=0;e<this.node.pdomClasses.length;e++){const t=this.node.pdomClasses[e];this.setClassToElement(t.className,t.options)}}onInputValueChange(){if(assert&&assert(this.node.inputValue!==void 0,"use null to remove input value attribute"),this.node.inputValue===null)this.removeAttributeFromElement("value");else{const e=`${this.node.inputValue}`;this.setAttributeToElement("value",e,{asProperty:!0})}}getElementByName(e){if(e===ss.PRIMARY_SIBLING)return this._primarySibling;if(e===ss.LABEL_SIBLING)return this._labelSibling;if(e===ss.DESCRIPTION_SIBLING)return this._descriptionSibling;if(e===ss.CONTAINER_PARENT)return this._containerParent;throw new Error(`invalid elementName name: ${e}`)}setAttributeToElement(e,t,i){i=ns({namespace:null,asProperty:!1,elementName:Ja,element:null},i);const n=i.element||this.getElementByName(i.elementName),r=dt.unwrapProperty(t);let h=r;typeof r=="string"&&(h=Xc(r)),e===Kh&&!this.display.interactive&&(this._preservedDisabledValue=i.asProperty?h:!0),i.namespace?n.setAttributeNS(i.namespace,e,h):i.asProperty?n[e]=h:n.setAttribute(e,h)}removeAttributeFromElement(e,t){t=ns({namespace:null,elementName:Ja,element:null},t);const i=t.element||this.getElementByName(t.elementName);t.namespace?i.removeAttributeNS(t.namespace,e):e===Kh&&!this.display.interactive?this._preservedDisabledValue=!1:i.removeAttribute(e)}removeAttributeFromAllElements(e){assert&&assert(e!==Kh,"this method does not currently support disabled, to make Display.interactive toggling easier to implement"),assert&&assert(typeof e=="string"),this._primarySibling&&this._primarySibling.removeAttribute(e),this._labelSibling&&this._labelSibling.removeAttribute(e),this._descriptionSibling&&this._descriptionSibling.removeAttribute(e),this._containerParent&&this._containerParent.removeAttribute(e)}setClassToElement(e,t){assert&&assert(typeof e=="string"),t=ns({elementName:Ja},t),this.getElementByName(t.elementName).classList.add(e)}removeClassFromElement(e,t){assert&&assert(typeof e=="string"),t=ns({elementName:Ja},t),this.getElementByName(t.elementName).classList.remove(e)}setAssociationAttribute(e,t){assert&&assert(dt.ASSOCIATION_ATTRIBUTES.indexOf(e)>=0,`unsupported attribute for setting with association object: ${e}`);const i=t.otherNode.getPDOMInstances();if(i.length>0){const n=i[0];n===this.pdomInstance&&(n.peer=this),assert&&assert(n.peer,"peer should exist");const r=n.peer.getElementByName(t.otherElementName),h=this.getElementByName(t.thisElementName);if(h&&r){const p=h.getAttribute(e)||"";assert&&assert(typeof p=="string");const S=[p.trim(),r.id].join(" ").trim();this.setAttributeToElement(e,S,{elementName:t.thisElementName})}}}arrangeContentElement(e,t){if(this.topLevelElements[0]===this._containerParent)assert&&assert(this.topLevelElements.length===1),t?this._containerParent.appendChild(e):this._containerParent.insertBefore(e,this._primarySibling);else{Vs(this.topLevelElements,e);const i=this.topLevelElements.indexOf(this._primarySibling),n=t?this.topLevelElements.length:i;this.topLevelElements.splice(n,0,e)}}isVisible(){if(assert){let e=0;this.topLevelElements.forEach(t=>{!t.hidden&&!t.hasAttribute("hidden")&&(e+=1)}),assert(this.visible?e===this.topLevelElements.length:e===0,"some of the peer's elements are visible and some are not")}return this.visible===null?!0:this.visible}setVisible(e){if(assert&&assert(typeof e=="boolean"),this.visible!==e){this.visible=e;for(let t=0;t<this.topLevelElements.length;t++){const i=this.topLevelElements[t];e?this.removeAttributeFromElement("hidden",{element:i}):this.setAttributeToElement("hidden","",{element:i})}this.invalidateCSSPositioning(_i.safari)}}isFocused(){const e=en.guessVisualTrail(this.trail,this.display.rootNode);return jt.pdomFocusProperty.value&&jt.pdomFocusProperty.value.trail.equals(e)}focus(){assert&&assert(this._primarySibling,"must have a primary sibling to focus"),jt.windowHasFocusProperty.value&&this._primarySibling.focus()}blur(){assert&&assert(this._primarySibling,"must have a primary sibling to blur"),this._primarySibling.blur()}setFocusable(e){assert&&assert(typeof e=="boolean");const t=this.isFocused();this.focusable!==e&&(this.focusable=e,dt.overrideFocusWithTabIndex(this.primarySibling,e),t&&!e&&this.blur(),this.invalidateCSSPositioning())}setLabelSiblingContent(e){assert&&assert(e===null||typeof e=="string","incorrect label content type"),this._labelSibling&&dt.setTextContent(this._labelSibling,e)}setDescriptionSiblingContent(e){assert&&assert(e===null||typeof e=="string","incorrect description content type"),this._descriptionSibling&&dt.setTextContent(this._descriptionSibling,e)}setPrimarySiblingContent(e){assert&&assert(e===null||typeof e=="string","incorrect inner content type"),assert&&assert(this.pdomInstance.children.length===0,"descendants exist with accessible content, innerContent cannot be used"),assert&&assert(dt.tagNameSupportsContent(this._primarySibling.tagName),`tagName: ${this.node.tagName} does not support inner content`),this._primarySibling&&dt.setTextContent(this._primarySibling,e)}setPDOMTransformSourceNode(e){this.pdomInstance.transformTracker.removeListener(this.transformListener),this.pdomInstance.updateTransformTracker(e),this.pdomInstance.transformTracker.addListener(this.transformListener),this.invalidateCSSPositioning()}setPositionInPDOM(e){this.positionInPDOM=e,this.invalidateCSSPositioning()}getElementId(e,t){return`display${this.display.id}-${e}-${t}`}updateIndicesStringAndElementIds(){const e=this.pdomInstance.getPDOMInstanceUniqueId();this._primarySibling&&(this._primarySibling.setAttribute(dt.DATA_PDOM_UNIQUE_ID,e),this._primarySibling.id=this.getElementId("primary",e)),this._labelSibling&&(this._labelSibling.setAttribute(dt.DATA_PDOM_UNIQUE_ID,e),this._labelSibling.id=this.getElementId("label",e)),this._descriptionSibling&&(this._descriptionSibling.setAttribute(dt.DATA_PDOM_UNIQUE_ID,e),this._descriptionSibling.id=this.getElementId("description",e)),this._containerParent&&(this._containerParent.setAttribute(dt.DATA_PDOM_UNIQUE_ID,e),this._containerParent.id=this.getElementId("container",e))}invalidateCSSPositioning(e=!1){if(!this.positionDirty){if(this.positionDirty=!0,e){this.forceReflowWorkaround=!0;for(let i=0;i<this.topLevelElements.length;i++)this.topLevelElements[i].style.transform="scale(1)"}let t=this.pdomInstance.parent;for(;t;)t.peer.childPositionDirty=!0,t=t.parent}}positionElements(e){if(assert&&assert(this._primarySibling,"a primary sibling required to receive CSS positioning"),assert&&assert(this.positionDirty,"elements should only be repositioned if dirty"),e){const t=this.node.pdomTransformSourceNode||this.node;if(Pr.set(t.localBounds),Pr.isFinite()){Pr.transform(this.pdomInstance.transformTracker.getMatrix());const i=this.display.bounds;if(i.intersectsBounds(Pr)){Pr.constrainBounds(i);let n=Ap(this._primarySibling),r=n.width,h=n.height;r>0&&h>0&&(Ln.setMinMax(0,0,r,h),Ln.transform(kp(r,h,Pr)),ul(this._primarySibling,Ln)),this.labelSibling&&(n=Ap(this._labelSibling),r=n.width,h=n.height,h>0&&r>0&&(Ln.setMinMax(0,0,r,h),Ln.transform(kp(r,h,Pr)),ul(this._labelSibling,Ln)))}}}else Ln.set(ss.OFFSCREEN_SIBLING_BOUNDS),ul(this._primarySibling,Ln),this._labelSibling&&ul(this._labelSibling,Ln);this.forceReflowWorkaround&&this.topLevelElements.forEach(t=>{t.style.transform="",t.style.offsetHeight}),this.positionDirty=!1,this.forceReflowWorkaround=!1}updateSubtreePositioning(e=!1){this.childPositionDirty=!1;const t=this.positionInPDOM||e;this.positionDirty&&this.positionElements(t);for(let i=0;i<this.pdomInstance.children.length;i++){const n=this.pdomInstance.children[i].peer;(n.positionDirty||n.childPositionDirty)&&this.pdomInstance.children[i].peer.updateSubtreePositioning(t)}}recursiveDisable(e){e?(this._preservedDisabledValue=this._primarySibling.disabled,this._primarySibling.disabled=!0):this._primarySibling.disabled=this._preservedDisabledValue;for(let t=0;t<this.pdomInstance.children.length;t++)this.pdomInstance.children[t].peer.recursiveDisable(e)}dispose(){this.isDisposed=!0,this.blur(),this._primarySibling.removeEventListener("blur",this.blurEventListener),this._primarySibling.removeEventListener("focus",this.focusEventListener),this.pdomInstance.transformTracker.removeListener(this.transformListener),this.mutationObserver.disconnect(),this.pdomInstance=null,this.node=null,this.display=null,this.trail=null,this._primarySibling=null,this._labelSibling=null,this._descriptionSibling=null,this._containerParent=null,this.focusable=null,this.freeToPool()}}ss.PRIMARY_SIBLING=Ja;ss.LABEL_SIBLING=r_;ss.DESCRIPTION_SIBLING=a_;ss.CONTAINER_PARENT=o_;ss.OFFSCREEN_SIBLING_BOUNDS=new Be(0,0,1,1);q.register("PDOMPeer",ss);$t.mixInto(ss,{initialize:ss.prototype.initializePDOMPeer});function cl(l,e,t){t=ns({siblingName:null,excludeFromInput:!1},t);const i=dt.createElement(l,e,t);return t.excludeFromInput&&i.setAttribute(dt.DATA_EXCLUDE_FROM_INPUT,!0),i}function kp(l,e,t){return xp.setToTranslation(t.minX,t.minY),Ep.setToScale(t.width/l,t.height/e),xp.multiplyMatrix(Ep).multiplyMatrix(d_)}function Ap(l){let e=l.clientWidth,t=l.clientHeight;if(e===0&&t===0){const i=l.getBoundingClientRect();e=i.width,t=i.height}return{width:e,height:t}}function ul(l,e){l.style.top=`${e.top}px`,l.style.left=`${e.left}px`,l.style.width=`${e.width}px`,l.style.height=`${e.height}px`}const Cn=ss,jn=class jn extends Mr{};jn.INDICES=new jn,jn.TRAIL_ID=new jn,jn.enumeration=new Nr(jn);let js=jn;const Wn=js.TRAIL_ID;let p_=1;const qn=class qn{constructor(e,t,i){this.relativeNodes=[],this.relativeVisibilities=[],this.relativeListeners=[],this.transformTracker=null,this.initializePDOMInstance(e,t,i)}initializePDOMInstance(e,t,i){if(assert&&assert(!this.id||this.isDisposed,"If we previously existed, we need to have been disposed"),this.id=this.id||p_++,this.parent=e,this.display=t,this.trail=i,this.isRootInstance=e===null,this.node=this.isRootInstance?null:i.lastNode(),this.children=Bt(this.children),this.node&&this.node.addPDOMInstance(this),this.invisibleCount=0,this.relativeNodes=[],this.relativeVisibilities=[],this.relativeListeners=[],this.transformTracker=null,this.updateTransformTracker(this.node?this.node.pdomTransformSourceNode:null),this.isDisposed=!1,this.isRootInstance){const n=document.createElement("div");this.peer=Cn.createFromPool(this,{primarySibling:n})}else{this.peer=Cn.createFromPool(this),this.peer.update(Wn===js.TRAIL_ID),assert&&assert(this.peer.primarySibling,"accessible peer must have a primarySibling upon completion of construction");const n=this.parent.trail;for(let r=n.length;r<i.length;r++){const h=i.nodes[r];this.relativeNodes.push(h);const p=h._pdomDisplaysInfo.pdomDisplays,S=_.includes(p,t);this.relativeVisibilities.push(S),S||this.invisibleCount++;const C=this.checkAccessibleDisplayVisibility.bind(this,r-n.length);h.pdomDisplaysEmitter.addListener(C),this.relativeListeners.push(C)}this.updateVisibility()}return sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`Initialized ${this.toString()}`),this}addConsecutiveInstances(e){sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`addConsecutiveInstances on ${this.toString()} with: ${e.map(i=>i.toString()).join(",")}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push();const t=this.children.length>0;Array.prototype.push.apply(this.children,e);for(let i=0;i<e.length;i++)assert&&assert(!!this.peer.primarySibling,"Primary sibling must be defined to insert elements."),dt.insertElements(this.peer.primarySibling,e[i].peer.topLevelElements);t&&this.sortChildren(),assert&&this.node&&(assert&&assert(this.node instanceof Ge),this.children.length>0&&assert(!this.node.innerContent,`${this.children.length} child PDOMInstances present but this node has innerContent: ${this.node.innerContent}`)),Wn===js.INDICES&&this.updateDescendantPeerIds(e),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}removeInstancesForTrail(e){sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`removeInstancesForTrail on ${this.toString()} with trail ${e.toString()}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push();for(let t=0;t<this.children.length;t++){const i=this.children[t],n=i.trail;let r=n.length<e.length;if(!r){for(let h=this.trail.length;h<e.length;h++)if(e.nodes[h]!==n.nodes[h]){r=!0;break}}r||(this.children.splice(t,1),i.dispose(),t-=1)}sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}removeAllChildren(){for(sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`removeAllChildren on ${this.toString()}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push();this.children.length;)this.children.pop().dispose();sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}findChildWithTrail(e){for(let t=0;t<this.children.length;t++){const i=this.children[t];if(i.trail.equals(e))return i}return null}removeSubtree(e){sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`removeSubtree on ${this.toString()} with trail ${e.toString()}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push();for(let t=this.children.length-1;t>=0;t--){const i=this.children[t];i.trail.isExtensionOf(e,!0)&&(sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`Remove parent: ${this.toString()}, child: ${i.toString()}`),this.children.splice(t,1),i.dispose())}sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}checkAccessibleDisplayVisibility(e){const t=_.includes(this.relativeNodes[e]._pdomDisplaysInfo.pdomDisplays,this.display),i=this.relativeVisibilities[e];if(t!==i){this.relativeVisibilities[e]=t;const n=this.invisibleCount===0;this.invisibleCount+=t?-1:1,assert&&assert(this.invisibleCount>=0&&this.invisibleCount<=this.relativeNodes.length),this.invisibleCount===0!==n&&this.updateVisibility()}}updateVisibility(){assert&&assert(!!this.peer,"Peer needs to be available on update visibility."),this.peer.setVisible(this.invisibleCount<=0),!this.peer.isVisible()&&jt.pdomFocusedNode&&(assert&&assert(jt.pdomFocusedNode.pdomInstances.length===1,"focusable Nodes do not support DAG, and should be connected with an instance if focused."),jt.pdomFocusedNode.pdomInstances[0].trail.containsNode(this.node)&&(jt.pdomFocus=null))}isGloballyVisible(){return assert&&assert(!!this.peer,"PDOMPeer needs to be available, has this PDOMInstance been disposed?"),this.peer.isVisible()?this.parent?this.parent.isGloballyVisible():!0:!1}getChildOrdering(e){const t=e.lastNode(),i=t.getEffectiveChildren();let n;const r=[];if(t.hasPDOMContent&&t!==this.node){const h=t.pdomInstances;e:for(n=0;n<h.length;n++){const p=h[n];if(p.parent===this){for(let S=0;S<e.length;S++)if(e.nodes[S]!==p.trail.nodes[S+p.trail.length-e.length])continue e;r.push(p)}}assert&&assert(r.length<=1,"If we select more than one this way, we have problems")}else for(n=0;n<i.length;n++)e.addDescendant(i[n],n),Array.prototype.push.apply(r,this.getChildOrdering(e)),e.removeDescendant();return r}sortChildren(){var p,S;assert&&assert(this.peer!==null,"peer required for sort");let e;this.isRootInstance?(assert&&assert(this.display!==null,"Display should be available for the root"),e=this.display.rootNode):(assert&&assert(this.node!==null,"Node should be defined, were we disposed?"),e=this.node);const t=this.getChildOrdering(new ht(e));assert&&assert(t.length===this.children.length,"sorting should not change number of children"),this.children=t;const i=this.peer.primarySibling,n=((S=(p=jt.pdomFocusedNode)==null?void 0:p.pdomInstances[0])==null?void 0:S.trail)||null;let r=i.childNodes.length-1;const h=n&&_.find(this.children,C=>n.containsNode(C.peer.node));if(h){const C=_.flatten(this.children.map(U=>U.peer.topLevelElements));if(!_.every(C,(U,k)=>i.children[k]===U)){const U=h.peer.getTopLevelElementContainingPrimarySibling(),k=C.indexOf(U);assert&&assert(k>=0);for(let Q=0;Q<k;Q++)i.insertBefore(C[Q],U);for(let Q=k+1;Q<C.length;Q++)i.appendChild(C[Q])}}else for(let C=this.children.length-1;C>=0;C--){const B=this.children[C].peer;for(let U=B.topLevelElements.length-1;U>=0;U--){const k=B.topLevelElements[U];i.childNodes[r]!==k&&i.insertBefore(k,i.childNodes[r+1]),r--}}if(assert){const C=_.flatten(this.children.map(B=>B.peer.topLevelElements));assert(_.every(C,(B,U)=>i.children[U]===B))}Wn===js.INDICES&&this.updateDescendantPeerIds(this.children)}updateTransformTracker(e){this.transformTracker&&this.transformTracker.dispose();let t=null;e?t=e.getUniqueTrail():t=qn.guessVisualTrail(this.trail,this.display.rootNode),this.transformTracker=new kr(t)}getPDOMInstanceUniqueId(){if(Wn===js.INDICES){const e=[];let t=this;for(;t.parent;){const i=t.parent.children.indexOf(t);if(i===-1)return"STILL_BEING_CREATED"+io.nextDouble();e.unshift(i),t=t.parent}return e.join(dt.PDOM_UNIQUE_ID_SEPARATOR)}else return assert&&assert(Wn===js.TRAIL_ID),this.trail.getUniqueId()}updateDescendantPeerIds(e){assert&&assert(Wn===js.INDICES,"method should not be used with uniqueId comes from TRAIL_ID");const t=Array.from(e);for(;t.length>0;){const i=t.shift();i.peer.updateIndicesStringAndElementIds(),t.push(...i.children)}}static uniqueIdToTrail(e,t){return Wn===js.INDICES?e.getTrailFromPDOMIndicesString(t):(assert&&assert(Wn===js.TRAIL_ID),ht.fromUniqueId(e.rootNode,t))}dispose(){sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`Disposing ${this.toString()}`),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.push(),assert&&assert(!!this.peer,"PDOMPeer required, were we already disposed?");const e=this.peer;if(!this.isRootInstance){dt.removeElements(this.parent.peer.primarySibling,e.topLevelElements);for(let t=0;t<this.relativeNodes.length;t++)this.relativeNodes[t].pdomDisplaysEmitter.removeListener(this.relativeListeners[t])}for(;this.children.length;)this.children.pop().dispose();e.dispose(),this.transformTracker.dispose(),this.transformTracker=null,this.node&&this.node.removePDOMInstance(this),this.relativeNodes=null,this.display=null,this.trail=null,this.node=null,this.peer=null,this.isDisposed=!0,this.freeToPool(),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.pop()}toString(){return`${this.id}#{${this.trail.toString()}}`}auditRoot(){if(!assert)return;const e=this.display.rootNode;assert(this.trail.length===0,"Should only call auditRoot() on the root PDOMInstance for a display");function t(i,n){assert&&assert(i.children.length===n.children.length,"Different number of children in accessible instance"),assert&&assert(i.node===n.node,"Node mismatch for PDOMInstance");for(let p=0;p<n.children.length;p++)t(i.children[p],n.children[p]);const r=n.isGloballyVisible();let h=!0;for(let p=0;p<n.trail.length;p++)if(n.trail.nodes[p].getTrailsTo(e).filter(B=>B.isPDOMVisible()).length===0){h=!1;break}assert&&assert(r===h,"Instance visibility mismatch")}t(qn.createFakePDOMTree(e),this)}static guessVisualTrail(e,t){e.reindex();const i=e.indices.lastIndexOf(-1);if(i<0)return e;const n=i+1,h=e.nodes[n].getTrailsTo(t);if(h.length===0)return e;const p=h[0];for(let S=n+1;S<e.length;S++)p.addDescendant(e.nodes[S]);return assert&&assert(p.isValid(),`trail not valid: ${e.uniqueId}`),p}static createFakePDOMTree(e){function t(i){let n=_.flatten(i.getEffectiveChildren().map(t));return i.hasPDOMContent&&(n=[{node:i,children:n}]),n}return{node:null,children:t(e)}}freeToPool(){qn.pool.freeToPool(this)}};qn.pool=new cs(qn,{initialize:qn.prototype.initializePDOMInstance});let Sl=qn;q.register("PDOMInstance",Sl);const en=Sl,It={addChild(l,e){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`addChild parent:n#${l._id}, child:n#${e._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(l instanceof Ge),assert&&assert(e instanceof Ge),assert&&assert(!e._rendererSummary.hasNoPDOM());const t=It.beforeOp();e._pdomParent||It.addTree(l,e),It.afterOp(t),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},removeChild(l,e){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`removeChild parent:n#${l._id}, child:n#${e._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(l instanceof Ge),assert&&assert(e instanceof Ge),assert&&assert(!e._rendererSummary.hasNoPDOM());const t=It.beforeOp();e._pdomParent||It.removeTree(l,e),It.afterOp(t),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},childrenOrderChange(l){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`childrenOrderChange node:n#${l._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(l instanceof Ge),assert&&assert(!l._rendererSummary.hasNoPDOM());const e=It.beforeOp();It.reorder(l),It.afterOp(e),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},pdomOrderChange(l,e,t){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`pdomOrderChange n#${l._id}: ${It.debugOrder(e)},${It.debugOrder(t)}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(l instanceof Ge);const i=It.beforeOp(),n=[],r=[];xr(e||[],t||[],n,r),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`removed: ${It.debugOrder(n)}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`added: ${It.debugOrder(r)}`);let h,p;if(assert){for(h=0;h<n;h++)assert(n[h]===null||n[h]._pdomParent===l,"Node should have had a pdomOrder");for(h=0;h<r;h++)assert(r[h]===null||r[h]._pdomParent===null,"Node is already specified in a pdomOrder")}const S=It.findPDOMTrails(l);for(h=0;h<n.length;h++){const C=n[h];C&&(It.removeTree(l,C,S),C._pdomParent=null,C.pdomParentChangedEmitter.emit())}for(h=0;h<r.length;h++){const C=r[h];if(C){const B=C._parents;for(p=0;p<B.length;p++)It.removeTree(B[p],C);C._pdomParent=l,C.pdomParentChangedEmitter.emit()}}for(h=0;h<n.length;h++){const C=n[h];if(C){const B=C._parents;for(p=0;p<B.length;p++)It.addTree(B[p],C)}}for(h=0;h<r.length;h++){const C=r[h];C&&It.addTree(l,C,S)}It.reorder(l,S),It.afterOp(i),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},pdomContentChange(l){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`pdomContentChange n#${l._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&assert(l instanceof Ge);const e=It.beforeOp();let t;const i=l._pdomParent?[l._pdomParent]:l._parents,n=[];for(t=0;t<i.length;t++){const r=i[t],h=It.findPDOMTrails(r);n.push(h),It.removeTree(r,l,h)}for(t=0;t<i.length;t++)It.addTree(i[t],l,n[t]);for(t=0;t<l._rootedDisplays.length;t++){const r=l._rootedDisplays[t];r._accessible&&It.rebuildInstanceTree(r._rootPDOMInstance)}It.afterOp(e),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},rebuildInstanceTree(l){const e=l.display.rootNode;assert&&assert(e),l.removeAllChildren(),l.addConsecutiveInstances(It.createTree(new ht(e),l.display,l))},addTree(l,e,t){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`addTree parent:n#${l._id}, child:n#${e._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),assert&&It.auditNodeForPDOMCycles(l),t=t||It.findPDOMTrails(l);for(let i=0;i<t.length;i++){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`trail: ${t[i].trail.toString()} full:${t[i].fullTrail.toString()} for ${t[i].pdomInstance.toString()} root:${t[i].isRoot}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push();const n=t[i],r=n.pdomInstance;n.fullTrail.addDescendant(e);const h=It.createTree(n.fullTrail,r.display,r);n.fullTrail.removeDescendant(e),r.addConsecutiveInstances(h),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()}sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},removeTree(l,e,t){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`removeTree parent:n#${l._id}, child:n#${e._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),t=t||It.findPDOMTrails(l);for(let i=0;i<t.length;i++){const n=t[i];n.fullTrail.addDescendant(e),n.pdomInstance.removeInstancesForTrail(n.fullTrail),n.fullTrail.removeDescendant(e)}sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},reorder(l,e){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`reorder n#${l._id}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push(),e=e||It.findPDOMTrails(l);for(let t=0;t<e.length;t++)e[t].pdomInstance.sortChildren();sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop()},createTree(l,e,t){sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`createTree ${l.toString()} parent:${t?t.toString():"null"}`),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.push();const i=l.lastNode(),n=i.getEffectiveChildren();sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.PDOMTree(`effectiveChildren: ${It.debugOrder(n)}`);let r,h=!1;i.hasPDOMContent&&(r=t.findChildWithTrail(l),r?h=!0:r=en.pool.create(t,e,l.copy()),t=r);const p=[];for(let S=0;S<n.length;S++)l.addDescendant(n[S],S),Array.prototype.push.apply(p,It.createTree(l,e,t)),l.removeDescendant();return r?(r.addConsecutiveInstances(p),sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop(),h?[]:[r]):(sceneryLog&&sceneryLog.PDOMTree&&sceneryLog.pop(),p)},beforeOp(){return Cl.blockFocusCallbacks=!0,jt.pdomFocusedNode},afterOp(l){l&&l.focusable&&l.focus(),Cl.blockFocusCallbacks=!1},findPDOMTrails(l){const e=[];return It.recursivePDOMTrailSearch(e,new ht(l)),e},recursivePDOMTrailSearch(l,e){const t=e.rootNode();let i;if(t.hasPDOMContent){const h=t.pdomInstances;for(i=0;i<h.length;i++)l.push(new vc(h[i],e.copy(),!1));return}else{const h=t.rootedDisplays;for(i=0;i<h.length;i++){const p=h[i];p._accessible&&l.push(new vc(p._rootPDOMInstance,e.copy(),!0))}}const n=t._pdomParent?[t._pdomParent]:t._parents,r=n.length;for(i=0;i<r;i++){const h=n[i];e.addAncestor(h),It.recursivePDOMTrailSearch(l,e),e.removeAncestor()}},auditPDOMDisplays(l){if(assertSlow)if(l._pdomDisplaysInfo.canHavePDOMDisplays()){let e;const t=[];for(e=0;e<l._parents.length;e++)Array.prototype.push.apply(t,l._parents[e]._pdomDisplaysInfo.pdomDisplays);for(e=0;e<l._rootedDisplays.length;e++){const r=l._rootedDisplays[e];r._accessible&&t.push(r)}const i=l._pdomDisplaysInfo.pdomDisplays.slice(),n=t.slice();for(assertSlow(i.length===n.length),e=0;e<n.length;e++)for(let r=0;r<i.length;r++)if(n[e]===i[r]){n.splice(e,1),i.splice(r,1),e--;break}assertSlow(i.length===0&&n.length===0,"Mismatch with accessible pdom displays")}else assertSlow(l._pdomDisplaysInfo.pdomDisplays.length===0,"Invisible/nonaccessible things should have no displays")},auditNodeForPDOMCycles(l){if(assert){const e=new ht(l);(function t(){const i=e.rootNode();assert(e.length<=1||i!==l,`Accessible PDOM graph cycle detected. The combined scene-graph DAG with pdomOrder defining additional parent-child relationships should still be a DAG. Cycle detected with the trail: ${e.toString()} path: ${e.toPathString()}`);const n=i._parents.length;for(let r=0;r<n;r++){const h=i._parents[r];e.addAncestor(h),t(),e.removeAncestor()}i._pdomParent&&!i._pdomParent.hasChild(i)&&(e.addAncestor(i._pdomParent),t(),e.removeAncestor())})()}},debugOrder(l){return l===null?"null":`[${l.map(e=>e===null?"null":e._id).join(",")}]`}};q.register("PDOMTree",It);const Rs=It;class g_{constructor(e,t,i){assert&&assert(e>=2),i=i||null,this.nodeCount=e,this.logToConsole=t,this.nodes=_.range(0,e).map(()=>new Ge),this.display=new Fi(this.nodes[0]),this.random=new qc({seed:i}),this.actionsTaken=[]}step(){const e=this.random.sample(this.enumerateActions());if(this.logToConsole&&console.log(e.text),this.actionsTaken.push(e),e.execute(),this.display._rootPDOMInstance.auditRoot(),Rs.auditPDOMDisplays(this.display.rootNode),this.logToConsole)for(let t=0;t<this.nodes.length;t++){const i=this.nodes[t];console.log(`${t}#${i.id} ${i.tagName} ch:${Rs.debugOrder(i.children)} or:${Rs.debugOrder(i.pdomOrder)} vis:${i.visible} avis:${i.pdomVisible}`)}}enumerateActions(){const e=[];return this.nodes.forEach(t=>{e.push({text:`#${t.id}.visible = ${!t.visible}`,execute:()=>{t.visible=!t.visible}}),e.push({text:`#${t.id}.pdomVisible = ${!t.pdomVisible}`,execute:()=>{t.pdomVisible=!t.pdomVisible}}),["span","div",null].forEach(i=>{t.tagName!==i&&e.push({text:`#${t.id}.tagName = ${i}`,execute:()=>{t.tagName=i}})}),this.powerSet(xr(this.nodes,[t]).concat([null])).forEach(i=>{my.forEachPermutation(i,n=>{this.isPDOMOrderChangeLegal(t,n)&&e.push({text:`#${t.id}.pdomOrder = ${Rs.debugOrder(n)}`,execute:()=>{t.pdomOrder=n}})})}),this.nodes.forEach(i=>{this.isAddChildLegal(t,i)&&_.range(0,t.children.length+1).forEach(n=>{e.push({text:`#${t.id}.insertChild(${n},#${i.id})`,execute:()=>{t.insertChild(n,i)}})}),t.hasChild(i)&&e.push({text:`#${t.id}.removeChild(#${i.id})`,execute:()=>{t.removeChild(i)}})})}),e}isAddChildLegal(e,t){return!e.hasChild(t)&&this.isAcyclic(e,t)}powerSet(e){if(e.length===0)return[[]];{const t=this.powerSet(e.slice(1));return t.concat(t.map(i=>[e[0]].concat(i)))}}isPDOMOrderChangeLegal(e,t){if(t===null&&(t=[]),t=t.filter(r=>r!==null),_.includes(t,e)||_.uniq(t).length<t.length)return!1;for(let r=0;r<t.length;r++)if(t[r]._pdomParent&&t[r]._pdomParent!==e)return!1;const i=(r,h)=>r===e?r.hasChild(h)||_.includes(t,h):r.hasChild(h)||!!r.pdomOrder&&_.includes(r.pdomOrder,h),n=e.children.concat(t);return _.every(n,r=>this.isAcyclic(e,r,i))}isAcyclic(e,t,i){if(e===t)return!1;const n=t.children.concat(t.pdomOrder).filter(r=>r!==null);for(;n.length;){const r=n.pop();if(r===e)return!1;i?this.nodes.forEach(h=>{i(r,h)&&n.push(h)}):(Array.prototype.push.apply(n,r.children),r.pdomOrder&&Array.prototype.push.apply(n,r.pdomOrder.filter(h=>h!==null)))}return!0}dispose(){this.display.dispose()}}q.register("PDOMFuzzer",g_);const Xn=class Xn extends Mr{};Xn.DRAG=new Xn,Xn.KEYBOARD_DRAG=new Xn,Xn.enumeration=new Nr(Xn,{phetioDocumentation:"entries when signifying Intent of the pointer"});let Bi=Xn;const go=class go{constructor(e,t){assert&&assert(e===null||e instanceof We),assert&&assert(Object.getPrototypeOf(this)!==go.prototype,"Pointer is an abstract class"),this.point=e,this.type=t,this.trail=null,this.inputEnabledTrail=null,this.isDownProperty=new Wt(!1),this.attachedProperty=new Wt(!1),this._listeners=[],this._attachedListener=null,this._cursor=null,this.lastEventContext=null,this._intents=[],this._pointerCaptured=!1,this._listenerForDragReserve=null,this._listenerForKeyboardDragReserve=null}setCursor(e){return this._cursor=e,this}set cursor(e){this.setCursor(e)}get cursor(){return this.getCursor()}getCursor(){return this._cursor}getListeners(){return this._listeners.slice()}get listeners(){return this.getListeners()}addInputListener(e,t){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`addInputListener to ${this.toString()} attach:${t}`),sceneryLog&&sceneryLog.Pointer&&sceneryLog.push(),assert&&assert(e,"A listener must be provided"),assert&&assert(t===void 0||typeof t=="boolean","If provided, the attach parameter should be a boolean value"),assert&&assert(!_.includes(this._listeners,e),"Attempted to add an input listener that was already added"),this._listeners.push(e),t&&(assert&&assert(e.interrupt,"Interrupt should exist on attached listeners"),this.attach(e)),sceneryLog&&sceneryLog.Pointer&&sceneryLog.pop()}removeInputListener(e){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`removeInputListener to ${this.toString()}`),sceneryLog&&sceneryLog.Pointer&&sceneryLog.push(),assert&&assert(e,"A listener must be provided");const t=_.indexOf(this._listeners,e);assert&&assert(t!==-1,"Could not find the input listener to remove"),this.isAttached()&&e===this._attachedListener&&this.detach(e),this._listeners.splice(t,1),sceneryLog&&sceneryLog.Pointer&&sceneryLog.pop()}getAttachedListener(){return this._attachedListener}get attachedListener(){return this.getAttachedListener()}isAttached(){return this.attachedProperty.value}isTouchLike(){return!1}set isDown(e){this.isDownProperty.value=e}get isDown(){return this.isDownProperty.value}interruptAttached(){this.isAttached()&&this._attachedListener.interrupt()}interruptAll(){const e=this._listeners.slice();for(let t=0;t<e.length;t++){const i=e[t];i.interrupt&&i.interrupt()}}attach(e){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Attaching to ${this.toString()}`),assert&&assert(!this.isAttached(),"Attempted to attach to an already attached pointer"),this.attachedProperty.value=!0,this._attachedListener=e}updatePoint(e,t="event"){const i=this.hasPointChanged(e);return e&&sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`pointer ${t} at ${e.toString()}`),this.point=e,i}down(e){this.isDown=!0}up(e,t){return this.isDown=!1,this.updatePoint(e,"up")}cancel(e){return this.isDown=!1,this.updatePoint(e,"cancel")}detach(e){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Detaching from ${this.toString()}`),assert&&assert(this.isAttached(),"Cannot detach a listener if one is not attached"),assert&&assert(this._attachedListener===e,"Cannot detach a different listener"),this.attachedProperty.value=!1,this._attachedListener=null}hasPointChanged(e){return this.point!==e&&(!e||!this.point||!this.point.equals(e))}addIntent(e){assert&&assert(Bi.enumeration.includes(e),"trying to set unsupported intent for Pointer"),this._intents.includes(e)||this._intents.push(e),assert&&assert(this._intents.length<=Bi.enumeration.values.length,"to many Intents saved, memory leak likely")}removeIntent(e){if(assert&&assert(Bi.enumeration.includes(e),"trying to set unsupported intent for Pointer"),this._intents.includes(e)){const t=this._intents.indexOf(e);this._intents.splice(t,1)}}hasIntent(e){return this._intents.includes(e)}reserveForDrag(){if(!this._intents.includes(Bi.DRAG)){this.addIntent(Bi.DRAG);const e={up:t=>{this.removeIntent(Bi.DRAG),this.removeInputListener(this._listenerForDragReserve),this._listenerForDragReserve=null}};assert&&assert(this._listenerForDragReserve===null,"still a listener to reserve pointer, memory leak likely"),this._listenerForDragReserve=e,this.addInputListener(this._listenerForDragReserve)}}reserveForKeyboardDrag(){if(!this._intents.includes(Bi.KEYBOARD_DRAG)){this.addIntent(Bi.KEYBOARD_DRAG);const e={keyup:i=>t(),blur:i=>t()},t=()=>{this.removeIntent(Bi.KEYBOARD_DRAG),this.removeInputListener(this._listenerForKeyboardDragReserve),this._listenerForKeyboardDragReserve=null};assert&&assert(this._listenerForDragReserve===null,"still a listener on Pointer for reserve, memory leak likely"),this._listenerForKeyboardDragReserve=e,this.addInputListener(this._listenerForKeyboardDragReserve)}}onGotPointerCapture(){this._pointerCaptured=!0}onLostPointerCapture(){this._pointerCaptured&&this.interruptAll(),this._pointerCaptured=!1}dispose(){sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Disposing ${this.toString()}`),this._listenerForDragReserve&&this._listeners.includes(this._listenerForDragReserve)&&this.removeInputListener(this._listenerForDragReserve),this._listenerForKeyboardDragReserve&&this._listeners.includes(this._listenerForKeyboardDragReserve)&&this.removeInputListener(this._listenerForKeyboardDragReserve),assert&&assert(this._attachedListener===null,"Attached listeners should be cleared before pointer disposal"),assert&&assert(this._listeners.length===0,"Should not have listeners when a pointer is disposed")}toString(){return`Pointer#${this.type}_at_${this.point}`}};go.PointerIO=new li("PointerIO",{valueType:go,toStateObject:e=>({point:e.point.toStateObject(),type:e.type}),stateSchema:{point:We.Vector2IO,type:si}});let cr=go;q.register("Pointer",cr);class bs extends cr{constructor(e){super(e,"mouse"),this.id=null,this.leftDown=!1,this.middleDown=!1,this.rightDown=!1,this.wheelDelta=new yy(0,0,0),this.wheelDeltaMode=0,sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Created ${this.toString()}`)}down(e){switch(assert&&assert(e instanceof MouseEvent),e.button){case 0:this.leftDown=!0;break;case 1:this.middleDown=!0;break;case 2:this.rightDown=!0;break}return super.down(e)}up(e,t){switch(assert&&assert(t instanceof MouseEvent),t.button){case 0:this.leftDown=!1;break;case 1:this.middleDown=!1;break;case 2:this.rightDown=!1;break}return super.up(e,t)}move(e){const t=this.hasPointChanged(e);return e&&sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`mouse move at ${e.toString()}`),this.point=e,t}over(e){const t=this.hasPointChanged(e);return e&&sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`mouse over at ${e.toString()}`),this.point=e,t}out(e){const t=this.hasPointChanged(e);return e&&sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`mouse out at ${e.toString()}`),t}wheel(e){assert&&assert(e instanceof WheelEvent);const t=e;this.wheelDelta.setXYZ(t.deltaX,t.deltaY,t.deltaZ),this.wheelDeltaMode=t.deltaMode}toString(){return"Mouse"}}q.register("Mouse",bs);class eo extends cr{constructor(e,t,i){super(t,"touch"),this.id=e,sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Created ${this.toString()}`)}move(e){const t=this.hasPointChanged(e);return this.point=e,t}toString(){return`Touch#${this.id}`}isTouchLike(){return!0}}q.register("Touch",eo);class Yf extends cr{constructor(e,t,i){super(t,"pen"),this.id=e,sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Created ${this.toString()}`)}move(e){const t=this.hasPointChanged(e);return this.point=e,t}toString(){return`Pen#${this.id}`}isTouchLike(){return!0}}q.register("Pen",Yf);class ya extends cr{constructor(e){super(We.ZERO,"pdom"),this.display=e,this.initializeListeners(),this.blockTrustedEvents=!1,this.keydownTargetNode=null,sceneryLog&&sceneryLog.Pointer&&sceneryLog.Pointer(`Created ${this.toString()}`)}initializeListeners(){this.addInputListener({focus:e=>{assert&&assert(this.trail,"trail should have been calculated for the focused node");const t=this.trail.lastNode();if(t.focusable){const i=en.guessVisualTrail(this.trail,this.display.rootNode);this.point=i.parentToGlobalPoint(t.center),isNaN(this.point.x)&&this.point.setXY(0,0)}},blur:e=>{this.trail=null,this.keydownTargetNode=null},keydown:e=>{this.blockTrustedEvents&&e.domEvent.isTrusted||(this.keydownTargetNode=e.target)},keyup:e=>{this.blockTrustedEvents&&e.domEvent.isTrusted||this.keydownTargetNode!==e.target&&e.abort()}})}updateTrail(e){return this.trail&&this.trail.equals(e)||(this.trail=e),this.trail}}q.register("PDOMPointer",ya);class ut{constructor(e){this.domEvent=e,this.activeElement=document.activeElement}static createSynthetic(){return new ut(new self.Event("synthetic"))}allowsDOMInput(){var t,i;const e=(t=this.domEvent)==null?void 0:t.target;if(e instanceof Element){let n=e;for(;n;){if(n instanceof HTMLElement&&((i=n.dataset)==null?void 0:i.sceneryAllowInput)==="true")return!0;n=n.parentNode}}return!1}}const Si=new li("EventContextIO",{valueType:ut,documentation:"A DOM event and its context",toStateObject:l=>({domEvent:On.serializeDomEvent(l.domEvent)}),fromStateObject:l=>new ut(On.deserializeDomEvent(l.domEvent)),stateSchema:()=>({domEvent:rr})});q.register("EventContext",ut);const Hl=class Hl{constructor(e,t,i,n){this.handled=!1,this.aborted=!1,this.trail=e,this.type=t,this.pointer=i,this.context=n,this.domEvent=n.domEvent,this.activeElement=n.activeElement,this.currentTarget=null,this.target=e.lastNode(),this.isPrimary=!(i instanceof bs)||!this.domEvent||this.domEvent.button===0,i.lastEventContext=n}handle(){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent("handled event"),this.handled=!0}abort(){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent("aborted event"),this.aborted=!0}isFromPDOM(){return this.pointer instanceof ya}canStartPress(){return!this.pointer.isAttached()&&(!(this.pointer instanceof bs)||this.domEvent.button===0)}};Hl.SceneryEventIO=new li("SceneryEventIO",{valueType:Hl,documentation:'An event, with a "point" field',toStateObject:e=>({type:e.type,domEventType:Lt(rr).toStateObject(e.domEvent),point:e.pointer&&e.pointer.point?We.Vector2IO.toStateObject(e.pointer.point):null}),stateSchema:{type:si,domEventType:Lt(rr),point:Lt(We.Vector2IO)}});let rs=Hl;q.register("SceneryEvent",rs);const Op=Mo(cr.PointerIO),f_=["altKey","button","charCode","clientX","clientY","code","ctrlKey","deltaMode","deltaX","deltaY","deltaZ","key","keyCode","metaKey","pageX","pageY","pointerId","pointerType","scale","shiftKey","target","type","relatedTarget","which"],Mp=["deltaMode","deltaX","deltaY","deltaZ","altKey","button","charCode","clientX","clientY","code","ctrlKey","key","keyCode","metaKey","pageX","pageY","pointerId","pointerType","shiftKey","type","relatedTarget","which"],m_=["target","relatedTarget"],y_=["focus","blur","focusin","focusout"],Ga="targetSubstitute",b_=80,Ht=class Ht extends yi{constructor(e,t,i,n,r,h){var S,C,B,U,k,Q,X,g,Z,ce,ye,Oe,de,se,fe,Fe,Se,ze,Re,Ke,Ze,Te,ft,Ce;const p=je()({phetioType:Ht.InputIO,phetioDocumentation:"Central point for user input events, such as mouse, touch"},h);super(p),this.currentSceneryEvent=null,this.display=e,this.rootNode=e.rootNode,this.attachToWindow=t,this.batchDOMEvents=i,this.assumeFullWindow=n,this.passiveEvents=r,this.batchedEvents=[],this.pdomPointer=null,this.mouse=null,this.pointers=[],this.pointerAddedEmitter=new zt,this.currentlyFiringEvents=!1,this.upTimeStamp=0,this.validatePointersAction=new xt(()=>{let De=this.pointers.length;for(;De--;){const Ve=this.pointers[De];Ve.point&&Ve!==this.pdomPointer&&this.branchChangeEvents(Ve,Ve.lastEventContext||ut.createSynthetic(),!1)}},{phetioPlayback:!0,tandem:(S=p.tandem)==null?void 0:S.createTandem("validatePointersAction"),phetioHighFrequency:!0}),this.mouseUpAction=new xt((De,Ve)=>{const Ae=this.ensureMouse(De);Ae.id=null,this.upEvent(Ae,Ve,De)},{phetioPlayback:!0,tandem:(C=p.tandem)==null?void 0:C.createTandem("mouseUpAction"),parameters:[{name:"point",phetioType:We.Vector2IO},{name:"context",phetioType:Si}],phetioEventType:Nt.USER,phetioDocumentation:"Emits when a mouse button is released."}),this.mouseDownAction=new xt((De,Ve,Ae)=>{const Xe=this.ensureMouse(Ve);Xe.id=De,this.downEvent(Xe,Ae,Ve)},{phetioPlayback:!0,tandem:(B=p.tandem)==null?void 0:B.createTandem("mouseDownAction"),parameters:[{name:"id",phetioType:Lt(Tt)},{name:"point",phetioType:We.Vector2IO},{name:"context",phetioType:Si}],phetioEventType:Nt.USER,phetioDocumentation:"Emits when a mouse button is pressed."}),this.mouseMoveAction=new xt((De,Ve)=>{const Ae=this.ensureMouse(De);Ae.move(De),this.moveEvent(Ae,Ve)},{phetioPlayback:!0,tandem:(U=p.tandem)==null?void 0:U.createTandem("mouseMoveAction"),parameters:[{name:"point",phetioType:We.Vector2IO},{name:"context",phetioType:Si}],phetioEventType:Nt.USER,phetioDocumentation:"Emits when the mouse is moved.",phetioHighFrequency:!0}),this.mouseOverAction=new xt((De,Ve)=>{this.ensureMouse(De).over(De)},{phetioPlayback:!0,tandem:(k=p.tandem)==null?void 0:k.createTandem("mouseOverAction"),parameters:[{name:"point",phetioType:We.Vector2IO},{name:"context",phetioType:Si}],phetioEventType:Nt.USER,phetioDocumentation:"Emits when the mouse is moved while on the sim."}),this.mouseOutAction=new xt((De,Ve)=>{this.ensureMouse(De).out(De)},{phetioPlayback:!0,tandem:(Q=p.tandem)==null?void 0:Q.createTandem("mouseOutAction"),parameters:[{name:"point",phetioType:We.Vector2IO},{name:"context",phetioType:Si}],phetioEventType:Nt.USER,phetioDocumentation:"Emits when the mouse moves out of the display."}),this.wheelScrollAction=new xt(De=>{const Ve=De.domEvent,Ae=this.ensureMouse(this.pointFromEvent(Ve));if(Ae.wheel(Ve),Ae.point){const Xe=this.rootNode.trailUnderPointer(Ae)||new ht(this.rootNode);this.dispatchEvent(Xe,"wheel",Ae,De,!0)}},{phetioPlayback:!0,tandem:(X=p.tandem)==null?void 0:X.createTandem("wheelScrollAction"),parameters:[{name:"context",phetioType:Si}],phetioEventType:Nt.USER,phetioDocumentation:"Emits when the mouse wheel scrolls.",phetioHighFrequency:!0}),this.touchStartAction=new xt((De,Ve,Ae)=>{const Xe=new eo(De,Ve,Ae.domEvent);this.addPointer(Xe),this.downEvent(Xe,Ae,Ve)},{phetioPlayback:!0,tandem:(g=p.tandem)==null?void 0:g.createTandem("touchStartAction"),parameters:[{name:"id",phetioType:Tt},{name:"point",phetioType:We.Vector2IO},{name:"context",phetioType:Si}],phetioEventType:Nt.USER,phetioDocumentation:"Emits when a touch begins."}),this.touchEndAction=new xt((De,Ve,Ae)=>{const Xe=this.findPointerById(De);Xe&&(assert&&assert(Xe instanceof eo),this.upEvent(Xe,Ae,Ve),this.removePointer(Xe))},{phetioPlayback:!0,tandem:(Z=p.tandem)==null?void 0:Z.createTandem("touchEndAction"),parameters:[{name:"id",phetioType:Tt},{name:"point",phetioType:We.Vector2IO},{name:"context",phetioType:Si}],phetioEventType:Nt.USER,phetioDocumentation:"Emits when a touch ends."}),this.touchMoveAction=new xt((De,Ve,Ae)=>{const Xe=this.findPointerById(De);Xe&&(assert&&assert(Xe instanceof eo),Xe.move(Ve),this.moveEvent(Xe,Ae))},{phetioPlayback:!0,tandem:(ce=p.tandem)==null?void 0:ce.createTandem("touchMoveAction"),parameters:[{name:"id",phetioType:Tt},{name:"point",phetioType:We.Vector2IO},{name:"context",phetioType:Si}],phetioEventType:Nt.USER,phetioDocumentation:"Emits when a touch moves.",phetioHighFrequency:!0}),this.touchCancelAction=new xt((De,Ve,Ae)=>{const Xe=this.findPointerById(De);Xe&&(assert&&assert(Xe instanceof eo),this.cancelEvent(Xe,Ae,Ve),this.removePointer(Xe))},{phetioPlayback:!0,tandem:(ye=p.tandem)==null?void 0:ye.createTandem("touchCancelAction"),parameters:[{name:"id",phetioType:Tt},{name:"point",phetioType:We.Vector2IO},{name:"context",phetioType:Si}],phetioEventType:Nt.USER,phetioDocumentation:"Emits when a touch is canceled."}),this.penStartAction=new xt((De,Ve,Ae)=>{const Xe=new Yf(De,Ve,Ae.domEvent);this.addPointer(Xe),this.downEvent(Xe,Ae,Ve)},{phetioPlayback:!0,tandem:(Oe=p.tandem)==null?void 0:Oe.createTandem("penStartAction"),parameters:[{name:"id",phetioType:Tt},{name:"point",phetioType:We.Vector2IO},{name:"context",phetioType:Si}],phetioEventType:Nt.USER,phetioDocumentation:"Emits when a pen touches the screen."}),this.penEndAction=new xt((De,Ve,Ae)=>{const Xe=this.findPointerById(De);Xe&&(this.upEvent(Xe,Ae,Ve),this.removePointer(Xe))},{phetioPlayback:!0,tandem:(de=p.tandem)==null?void 0:de.createTandem("penEndAction"),parameters:[{name:"id",phetioType:Tt},{name:"point",phetioType:We.Vector2IO},{name:"context",phetioType:Si}],phetioEventType:Nt.USER,phetioDocumentation:"Emits when a pen is lifted."}),this.penMoveAction=new xt((De,Ve,Ae)=>{const Xe=this.findPointerById(De);Xe&&(Xe.move(Ve),this.moveEvent(Xe,Ae))},{phetioPlayback:!0,tandem:(se=p.tandem)==null?void 0:se.createTandem("penMoveAction"),parameters:[{name:"id",phetioType:Tt},{name:"point",phetioType:We.Vector2IO},{name:"context",phetioType:Si}],phetioEventType:Nt.USER,phetioDocumentation:"Emits when a pen is moved.",phetioHighFrequency:!0}),this.penCancelAction=new xt((De,Ve,Ae)=>{const Xe=this.findPointerById(De);Xe&&(this.cancelEvent(Xe,Ae,Ve),this.removePointer(Xe))},{phetioPlayback:!0,tandem:(fe=p.tandem)==null?void 0:fe.createTandem("penCancelAction"),parameters:[{name:"id",phetioType:Tt},{name:"point",phetioType:We.Vector2IO},{name:"context",phetioType:Si}],phetioEventType:Nt.USER,phetioDocumentation:"Emits when a pen is canceled."}),this.gotPointerCaptureAction=new xt((De,Ve)=>{const Ae=this.findPointerById(De);Ae&&Ae.onGotPointerCapture()},{phetioPlayback:!0,tandem:(Fe=p.tandem)==null?void 0:Fe.createTandem("gotPointerCaptureAction"),parameters:[{name:"id",phetioType:Tt},{name:"context",phetioType:Si}],phetioEventType:Nt.USER,phetioDocumentation:"Emits when a pointer is captured (normally at the start of an interaction)",phetioHighFrequency:!0}),this.lostPointerCaptureAction=new xt((De,Ve)=>{const Ae=this.findPointerById(De);Ae&&Ae.onLostPointerCapture()},{phetioPlayback:!0,tandem:(Se=p.tandem)==null?void 0:Se.createTandem("lostPointerCaptureAction"),parameters:[{name:"id",phetioType:Tt},{name:"context",phetioType:Si}],phetioEventType:Nt.USER,phetioDocumentation:"Emits when a pointer loses its capture (normally at the end of an interaction)",phetioHighFrequency:!0}),this.focusinAction=new xt(De=>{const Ve=this.getPDOMEventTrail(De.domEvent,"focusin");Ve&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`focusin(${Ht.debugText(null,De.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(Ve,"focus",De,!1),this.dispatchPDOMEvent(Ve,"focusin",De,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(ze=p.tandem)==null?void 0:ze.createTandem("focusinAction"),parameters:[{name:"context",phetioType:Si}],phetioEventType:Nt.USER,phetioDocumentation:"Emits when the PDOM root gets the focusin DOM event."}),this.focusoutAction=new xt(De=>{const Ve=this.getPDOMEventTrail(De.domEvent,"focusout");Ve&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`focusOut(${Ht.debugText(null,De.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(Ve,"blur",De,!1),this.dispatchPDOMEvent(Ve,"focusout",De,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(Re=p.tandem)==null?void 0:Re.createTandem("focusoutAction"),parameters:[{name:"context",phetioType:Si}],phetioEventType:Nt.USER,phetioDocumentation:"Emits when the PDOM root gets the focusout DOM event."}),this.clickAction=new xt(De=>{const Ve=this.getPDOMEventTrail(De.domEvent,"click");Ve&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`click(${Ht.debugText(null,De.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(Ve,"click",De,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(Ke=p.tandem)==null?void 0:Ke.createTandem("clickAction"),parameters:[{name:"context",phetioType:Si}],phetioEventType:Nt.USER,phetioDocumentation:"Emits when the PDOM root gets the click DOM event."}),this.inputAction=new xt(De=>{const Ve=this.getPDOMEventTrail(De.domEvent,"input");Ve&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`input(${Ht.debugText(null,De.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(Ve,"input",De,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(Ze=p.tandem)==null?void 0:Ze.createTandem("inputAction"),parameters:[{name:"context",phetioType:Si}],phetioEventType:Nt.USER,phetioDocumentation:"Emits when the PDOM root gets the input DOM event."}),this.changeAction=new xt(De=>{const Ve=this.getPDOMEventTrail(De.domEvent,"change");Ve&&(sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`change(${Ht.debugText(null,De.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.dispatchPDOMEvent(Ve,"change",De,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop())},{phetioPlayback:!0,tandem:(Te=p.tandem)==null?void 0:Te.createTandem("changeAction"),parameters:[{name:"context",phetioType:Si}],phetioEventType:Nt.USER,phetioDocumentation:"Emits when the PDOM root gets the change DOM event."}),this.keydownAction=new xt(De=>{sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`keydown(${Ht.debugText(null,De.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push();const Ve=this.getPDOMEventTrail(De.domEvent,"keydown");Ve&&this.dispatchPDOMEvent(Ve,"keydown",De,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()},{phetioPlayback:!0,tandem:(ft=p.tandem)==null?void 0:ft.createTandem("keydownAction"),parameters:[{name:"context",phetioType:Si}],phetioEventType:Nt.USER,phetioDocumentation:"Emits when the PDOM root gets the keydown DOM event."}),this.keyupAction=new xt(De=>{sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`keyup(${Ht.debugText(null,De.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push();const Ve=this.getPDOMEventTrail(De.domEvent,"keydown");Ve&&this.dispatchPDOMEvent(Ve,"keyup",De,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()},{phetioPlayback:!0,tandem:(Ce=p.tandem)==null?void 0:Ce.createTandem("keyupAction"),parameters:[{name:"context",phetioType:Si}],phetioEventType:Nt.USER,phetioDocumentation:"Emits when the PDOM root gets the keyup DOM event."})}interruptPointers(e=null){_.each(this.pointers,t=>{t!==e&&t.interruptAll()})}batchEvent(e,t,i,n){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent("Input.batchEvent"),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.push(),this.display.interactive&&(this.batchedEvents.push(wl.pool.create(e,t,i)),(n||!this.batchDOMEvents)&&this.fireBatchedEvents()),this.passiveEvents!==!0&&(i!==this.mouseDown||_i.edge)&&t!==Ct.ALT_TYPE&&!e.allowsDOMInput()&&e.domEvent.preventDefault(),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.pop()}fireBatchedEvents(){if(sceneryLog&&sceneryLog.InputEvent&&this.currentlyFiringEvents&&sceneryLog.InputEvent("REENTRANCE DETECTED"),!this.currentlyFiringEvents&&this.batchedEvents.length){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`Input.fireBatchedEvents length:${this.batchedEvents.length}`),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.push(),this.currentlyFiringEvents=!0;const e=this.batchedEvents;for(let t=0;t<e.length;t++){const i=e[t];i.run(this),i.dispose()}Bt(e),this.currentlyFiringEvents=!1,sceneryLog&&sceneryLog.InputEvent&&sceneryLog.pop()}}clearBatchedEvents(){this.batchedEvents.length=0}validatePointers(){this.validatePointersAction.execute()}removeTemporaryPointers(){for(let e=this.pointers.length-1;e>=0;e--){const t=this.pointers[e];if(!(t instanceof bs)){this.pointers.splice(e,1);const i=t.trail||new ht(this.rootNode);this.exitEvents(t,ut.createSynthetic(),i,0,!0)}}}connectListeners(){Cl.addDisplay(this.display,this.attachToWindow,this.passiveEvents)}disconnectListeners(){Cl.removeDisplay(this.display,this.attachToWindow,this.passiveEvents)}pointFromEvent(e){const t=We.pool.create(e.clientX,e.clientY);if(!this.assumeFullWindow){const i=this.display.domElement.getBoundingClientRect();i.width>0&&i.height>0&&(t.subtractXY(i.left,i.top),(i.width!==this.display.width||i.height!==this.display.height)&&(t.x*=this.display.width/i.width,t.y*=this.display.height/i.height))}return t}addPointer(e){this.pointers.push(e),this.pointerAddedEmitter.emit(e)}removePointer(e){for(let t=this.pointers.length-1;t>=0;t--)this.pointers[t]===e&&this.pointers.splice(t,1);e.dispose()}findPointerById(e){let t=this.pointers.length;for(;t--;){const i=this.pointers[t];if(i.id===e)return i}return null}getPDOMEventTrail(e,t){if(!this.display.interactive)return null;const i=this.getTrailFromPDOMEvent(e);return i&&!(t==="click"&&_.some(i.nodes,r=>r.positionInPDOM)&&e.timeStamp-this.upTimeStamp<=b_)?i:null}initMouse(e){const t=new bs(e);return this.mouse=t,this.addPointer(t),t}ensureMouse(e){const t=this.mouse;return t||this.initMouse(e)}initPDOMPointer(){const e=new ya(this.display);return this.pdomPointer=e,this.addPointer(e),e}ensurePDOMPointer(){const e=this.pdomPointer;return e||this.initPDOMPointer()}dispatchPDOMEvent(e,t,i,n){this.ensurePDOMPointer().updateTrail(e),dt.USER_GESTURE_EVENTS.includes(t)&&Fi.userGestureEmitter.emit();const r=i.domEvent;r.target&&r.target.hasAttribute(dt.DATA_EXCLUDE_FROM_INPUT)||(e.isPickable()||y_.includes(t)||(e=new ht([])),assert&&assert(this.pdomPointer),this.dispatchEvent(e,t,this.pdomPointer,i,n))}getRelatedTargetTrail(e){const t=e.relatedTarget;if(t&&this.display.isElementUnderPDOM(t,!1)){const i=e.relatedTarget;assert&&assert(i instanceof self.Element);const n=i.getAttribute(dt.DATA_PDOM_UNIQUE_ID);return assert&&assert(n,"should not be null"),en.uniqueIdToTrail(this.display,n)}return null}getTrailFromPDOMEvent(e){if(assert&&assert(e.target||e[Ga],"need a way to get the target"),!this.display._accessible)return null;if(e[Ga]){const t=e[Ga].getAttribute(dt.DATA_PDOM_UNIQUE_ID);return en.uniqueIdToTrail(this.display,t)}else{const t=e.target;if(t&&t instanceof self.Element&&this.display.isElementUnderPDOM(t,!1)){const i=t.getAttribute(dt.DATA_PDOM_UNIQUE_ID);return assert&&assert(i,"should not be null"),en.uniqueIdToTrail(this.display,i)}}return null}mouseDown(e,t,i){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseDown('${e}', ${Ht.debugText(t,i.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseDownAction.execute(e,t,i),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}mouseUp(e,t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseUp(${Ht.debugText(e,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseUpAction.execute(e,t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}mouseMove(e,t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseMove(${Ht.debugText(e,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseMoveAction.execute(e,t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}mouseOver(e,t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseOver(${Ht.debugText(e,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseOverAction.execute(e,t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}mouseOut(e,t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`mouseOut(${Ht.debugText(e,t.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.mouseOutAction.execute(e,t),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}wheel(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`wheel(${Ht.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.wheelScrollAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}touchStart(e,t,i){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`touchStart('${e}',${Ht.debugText(t,i.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.touchStartAction.execute(e,t,i),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}touchEnd(e,t,i){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`touchEnd('${e}',${Ht.debugText(t,i.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.touchEndAction.execute(e,t,i),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}touchMove(e,t,i){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`touchMove('${e}',${Ht.debugText(t,i.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.touchMoveAction.execute(e,t,i),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}touchCancel(e,t,i){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`touchCancel('${e}',${Ht.debugText(t,i.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.touchCancelAction.execute(e,t,i),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}penStart(e,t,i){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`penStart('${e}',${Ht.debugText(t,i.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.penStartAction.execute(e,t,i),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}penEnd(e,t,i){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`penEnd('${e}',${Ht.debugText(t,i.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.penEndAction.execute(e,t,i),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}penMove(e,t,i){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`penMove('${e}',${Ht.debugText(t,i.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.penMoveAction.execute(e,t,i),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}penCancel(e,t,i){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`penCancel('${e}',${Ht.debugText(t,i.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.penCancelAction.execute(e,t,i),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}pointerDown(e,t,i,n){const r=this.attachToWindow?document.body:this.display.domElement;switch(r.setPointerCapture&&n.domEvent.pointerId&&!n.allowsDOMInput()&&r.setPointerCapture(n.domEvent.pointerId),t=this.handleUnknownPointerType(t,e),t){case"mouse":this.mouseDown(e,i,n);break;case"touch":this.touchStart(e,i,n);break;case"pen":this.penStart(e,i,n);break;default:if(assert)throw new Error(`Unknown pointer type: ${t}`)}}pointerUp(e,t,i,n){switch(this.upTimeStamp=n.domEvent.timeStamp,t=this.handleUnknownPointerType(t,e),t){case"mouse":this.mouseUp(i,n);break;case"touch":this.touchEnd(e,i,n);break;case"pen":this.penEnd(e,i,n);break;default:if(assert)throw new Error(`Unknown pointer type: ${t}`)}}pointerCancel(e,t,i,n){switch(t=this.handleUnknownPointerType(t,e),t){case"mouse":console&&console.log&&console.log("WARNING: Pointer mouse cancel was received");break;case"touch":this.touchCancel(e,i,n);break;case"pen":this.penCancel(e,i,n);break;default:console.log&&console.log(`Unknown pointer type: ${t}`)}}gotPointerCapture(e,t,i,n){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`gotPointerCapture('${e}',${Ht.debugText(null,n.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.gotPointerCaptureAction.execute(e,n),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}lostPointerCapture(e,t,i,n){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`lostPointerCapture('${e}',${Ht.debugText(null,n.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.lostPointerCaptureAction.execute(e,n),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}pointerMove(e,t,i,n){switch(t=this.handleUnknownPointerType(t,e),t){case"mouse":this.mouseMove(i,n);break;case"touch":this.touchMove(e,i,n);break;case"pen":this.penMove(e,i,n);break;default:console.log&&console.log(`Unknown pointer type: ${t}`)}}pointerOver(e,t,i,n){}pointerOut(e,t,i,n){}pointerEnter(e,t,i,n){}pointerLeave(e,t,i,n){}focusIn(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`focusIn('${Ht.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.focusinAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}focusOut(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`focusOut('${Ht.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.focusoutAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}input(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`input('${Ht.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.inputAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}change(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`change('${Ht.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.changeAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}click(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`click('${Ht.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.clickAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}keyDown(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`keyDown('${Ht.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.keydownAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}keyUp(e){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`keyUp('${Ht.debugText(null,e.domEvent)});`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.keyupAction.execute(e),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}handleUnknownPointerType(e,t){return e!==""?e:this.mouse&&this.mouse.id===t?"mouse":"touch"}getPointerTrail(e){return this.rootNode.trailUnderPointer(e)||new ht(this.rootNode)}upEvent(e,t,i){if(this.display.isElementUnderPDOM(t.domEvent.target,!0))return;const n=e.up(i,t.domEvent);sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`upEvent ${e.toString()} changed:${n}`),sceneryLog&&sceneryLog.Input&&sceneryLog.push();const r=this.branchChangeEvents(e,t,n);this.dispatchEvent(r,"up",e,t,!0),e.isTouchLike()&&this.exitEvents(e,t,r,0,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}downEvent(e,t,i){if(this.display.isElementUnderPDOM(t.domEvent.target,!0))return;const n=e.updatePoint(i);sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`downEvent ${e.toString()} changed:${n}`),sceneryLog&&sceneryLog.Input&&sceneryLog.push();const r=this.branchChangeEvents(e,t,n);e.down(t.domEvent),this.dispatchEvent(r,"down",e,t,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}moveEvent(e,t){sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`moveEvent ${e.toString()}`),sceneryLog&&sceneryLog.Input&&sceneryLog.push(),this.branchChangeEvents(e,t,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}cancelEvent(e,t,i){const n=e.cancel(i);sceneryLog&&sceneryLog.Input&&sceneryLog.Input(`cancelEvent ${e.toString()} changed:${n}`),sceneryLog&&sceneryLog.Input&&sceneryLog.push();const r=this.branchChangeEvents(e,t,n);this.dispatchEvent(r,"cancel",e,t,!0),e.isTouchLike()&&this.exitEvents(e,t,r,0,!0),sceneryLog&&sceneryLog.Input&&sceneryLog.pop()}branchChangeEvents(e,t,i){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`branchChangeEvents: ${e.toString()} sendMove:${i}`),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.push();const n=this.getPointerTrail(e),r=n.slice(0,Math.min(n.nodes.length,n.getLastInputEnabledIndex()+1)),h=e.inputEnabledTrail||new ht(this.rootNode),p=ht.branchIndex(r,h),S=h.lastNode()!==r.lastNode();if(sceneryLog&&sceneryLog.InputEvent){const C=e.trail||new ht(this.rootNode),B=ht.branchIndex(n,C);(B!==n.length||B!==C.length)&&sceneryLog.InputEvent(`changed from ${C.toString()} to ${n.toString()}`)}return i&&this.dispatchEvent(n,"move",e,t,!0),this.exitEvents(e,t,h,p,S),this.enterEvents(e,t,r,p,S),e.trail=n,e.inputEnabledTrail=r,sceneryLog&&sceneryLog.InputEvent&&sceneryLog.pop(),n}enterEvents(e,t,i,n,r){r&&this.dispatchEvent(i,"over",e,t,!0,!0);for(let h=n;h<i.length;h++)this.dispatchEvent(i.slice(0,h+1),"enter",e,t,!1)}exitEvents(e,t,i,n,r){for(let h=i.length-1;h>=n;h--)this.dispatchEvent(i.slice(0,h+1),"exit",e,t,!1,!0);r&&this.dispatchEvent(i,"out",e,t,!0)}dispatchEvent(e,t,i,n,r,h=!1){sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.EventDispatch(`${t} trail:${e.toString()} pointer:${i.toString()} at ${i.point?i.point.toString():"null"}`),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.push(),assert&&assert(e,"Falsy trail for dispatchEvent"),sceneryLog&&sceneryLog.EventPath&&sceneryLog.EventPath(`${t} ${e.toPathString()}`);const p=new rs(e,t,i,n);this.currentSceneryEvent=p,this.dispatchToListeners(i,i.getListeners(),t,p),this.dispatchToTargets(e,t,i,p,r,h),this.dispatchToListeners(i,this.display.getInputListeners(),t,p),Fi.inputListeners.length&&this.dispatchToListeners(i,Fi.inputListeners.slice(),t,p),this.currentSceneryEvent=null,sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.pop()}dispatchToListeners(e,t,i,n){if(n.handled)return;const r=e.type+i;for(let h=0;h<t.length;h++){const p=t[h];!n.aborted&&p[r]&&(sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.EventDispatch(r),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.push(),p[r](n),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.pop()),!n.aborted&&p[i]&&(sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.EventDispatch(i),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.push(),p[i](n),sceneryLog&&sceneryLog.EventDispatch&&sceneryLog.pop())}}dispatchToTargets(e,t,i,n,r,h=!1){if(n.aborted||n.handled)return;const p=e.getLastInputEnabledIndex();for(let S=e.nodes.length-1;S>=0;r?S--:S=-1){const C=e.nodes[S],B=p<S;if(!(C.isDisposed||!h&&B)&&(n.currentTarget=C,this.dispatchToListeners(i,C.getInputListeners(),t,n),n.aborted||n.handled))return}}static serializeDomEvent(e){const t={constructorName:e.constructor.name};return f_.forEach(i=>{const n=e[i];n==null?t[i]=null:n instanceof Element&&m_.includes(i)&&typeof n.getAttribute=="function"&&n.hasAttribute(dt.DATA_PDOM_UNIQUE_ID)?t[i]={[dt.DATA_PDOM_UNIQUE_ID]:n.getAttribute(dt.DATA_PDOM_UNIQUE_ID),id:n.getAttribute("id")}:t[i]=typeof n=="object"?{}:JSON.parse(JSON.stringify(n))}),t}static deserializeDomEvent(e){const t=e.constructorName||"Event",i=_.pick(e,Mp);if(i.relatedTarget){const r=document.getElementById(i.relatedTarget.id);assert&&assert(r,"cannot deserialize event when related target is not in the DOM."),i.relatedTarget=r}const n=new self[t](t,i);for(const r in e)if(e.hasOwnProperty(r)&&!Mp.includes(r))if(r==="target"){if(assert){const h=e.target;h&&h.id&&assert(document.getElementById(h.id),"target should exist in the PDOM to support playback.")}n[Ga]=_.clone(e[r])||{},n[Ga].getAttribute=function(h){return this[h]}}else n[r]=e[r];return n}static debugText(e,t){let i=`${t.timeStamp} ${t.type}`;return e!==null&&(i=`${e.x},${e.y} ${i}`),i}static msPointerType(e){return e.pointerType===self.MSPointerEvent.MSPOINTER_TYPE_TOUCH?"touch":e.pointerType===self.MSPointerEvent.MSPOINTER_TYPE_PEN?"pen":e.pointerType===self.MSPointerEvent.MSPOINTER_TYPE_MOUSE?"mouse":e.pointerType}};Ht.InputIO=new li("InputIO",{valueType:Ht,applyState:_.noop,toStateObject:e=>({pointers:Op.toStateObject(e.pointers)}),stateSchema:{pointers:Op}});let On=Ht;q.register("Input",On);const ts=class ts extends Mr{};ts.POINTER_TYPE=new ts,ts.MS_POINTER_TYPE=new ts,ts.TOUCH_TYPE=new ts,ts.MOUSE_TYPE=new ts,ts.WHEEL_TYPE=new ts,ts.ALT_TYPE=new ts,ts.enumeration=new Nr(ts,{phetioDocumentation:"The type of batched event"});let Ct=ts;const fo=class fo{constructor(e,t,i){this.initialize(e,t,i)}initialize(e,t,i){return assert&&assert(e.domEvent,"for some reason, there is no DOM event?"),this.eventContext=e,this.type=t,this.callback=i,this}run(e){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent("Running batched event"),sceneryLog&&sceneryLog.InputEvent&&sceneryLog.push();const t=this.callback;if(e.validatePointers(),this.type===Ct.POINTER_TYPE){const i=this.eventContext,n=i.domEvent;t.call(e,n.pointerId,n.pointerType,e.pointFromEvent(n),i)}else if(this.type===Ct.MS_POINTER_TYPE){const i=this.eventContext,n=i.domEvent;t.call(e,n.pointerId,On.msPointerType(n),e.pointFromEvent(n),i)}else if(this.type===Ct.TOUCH_TYPE){const i=this.eventContext,n=i.domEvent;for(let r=0;r<n.changedTouches.length;r++){const h=n.changedTouches.item(r);t.call(e,h.identifier,e.pointFromEvent(h),i)}}else if(this.type===Ct.MOUSE_TYPE){const i=this.eventContext,n=e.pointFromEvent(i.domEvent);t===e.mouseDown?t.call(e,null,n,i):t.call(e,n,i)}else if(this.type===Ct.WHEEL_TYPE||this.type===Ct.ALT_TYPE)t.call(e,this.eventContext);else throw new Error(`bad type value: ${this.type}`);sceneryLog&&sceneryLog.InputEvent&&sceneryLog.pop()}dispose(){this.eventContext=null,this.callback=null,this.freeToPool()}freeToPool(){fo.pool.freeToPool(this)}};fo.pool=new cs(fo);let wl=fo;q.register("BatchedDOMEvent",wl);const v_=()=>{};let Np=!1;const St={blockFocusCallbacks:!1,addDisplay(l,e,t){assert&&assert(l instanceof Fi),assert&&assert(typeof e=="boolean"),assert&&assert(!_.includes(this.attachedDisplays,l),"A display cannot be concurrently attached to events more than one time"),Np||(Np=!0,ys.attachToWindow(),jt.attachToWindow()),this.attachedDisplays.push(l),e?this.attachedDisplays.length===1&&this.connectWindowListeners(t):this.addOrRemoveListeners(l.domElement,!0,t),l.domElement.addEventListener("wheel",this.onwheel,St.getEventOptions(t,!0))},removeDisplay(l,e,t){assert&&assert(l instanceof Fi),assert&&assert(typeof e=="boolean"),assert&&assert(_.includes(this.attachedDisplays,l),"This display was not already attached to listen for self events"),Vs(this.attachedDisplays,l),e?this.attachedDisplays.length===0&&this.disconnectWindowListeners(t):this.addOrRemoveListeners(l.domElement,!1,t),l.domElement.removeEventListener("wheel",this.onwheel,St.getEventOptions(t,!0))},getEventOptions(l,e){if(Qe.passive&&l!==null){const i={passive:l};return e&&(i.capture=!1),assert&&assert(!i.capture,"Do not use capture without consulting globalKeyStateTracker, which expects have listeners called FIRST in keyboard-related cases."),i}else return!1},listenersAttachedToWindow:0,listenersAttachedToElement:0,attachedDisplays:[],canUsePointerEvents:!!(self.navigator&&self.navigator.pointerEnabled||self.PointerEvent)&&!_i.firefox,canUseMSPointerEvents:self.navigator&&self.navigator.msPointerEnabled,pointerListenerTypes:["pointerdown","pointerup","pointermove","pointerover","pointerout","pointercancel","gotpointercapture","lostpointercapture"],msPointerListenerTypes:["MSPointerDown","MSPointerUp","MSPointerMove","MSPointerOver","MSPointerOut","MSPointerCancel"],touchListenerTypes:["touchstart","touchend","touchmove","touchcancel"],mouseListenerTypes:["mousedown","mouseup","mousemove","mouseover","mouseout"],wheelListenerTypes:["wheel"],altListenerTypes:dt.DOM_EVENTS,getNonWheelUsedTypes(){let l;return this.canUsePointerEvents?(sceneryLog&&sceneryLog.Input&&sceneryLog.Input("Detected pointer events support, using that instead of mouse/touch events"),l=this.pointerListenerTypes):this.canUseMSPointerEvents?(sceneryLog&&sceneryLog.Input&&sceneryLog.Input("Detected MS pointer events support, using that instead of mouse/touch events"),l=this.msPointerListenerTypes):(sceneryLog&&sceneryLog.Input&&sceneryLog.Input("No pointer events support detected, using mouse/touch events"),l=this.touchListenerTypes.concat(this.mouseListenerTypes)),l=l.concat(this.altListenerTypes),l},connectWindowListeners(l){this.addOrRemoveListeners(self,!0,l)},disconnectWindowListeners(l){this.addOrRemoveListeners(self,!1,l)},addOrRemoveListeners(l,e,t){assert&&assert(typeof e=="boolean"),assert&&assert(typeof t=="boolean"||t===null);const i=l===window;assert&&assert(!i||this.listenersAttachedToWindow>0==!e,"Do not add listeners to the self when already attached, or remove listeners when none are attached");const n=e?1:-1;i?this.listenersAttachedToWindow+=n:this.listenersAttachedToElement+=n,assert&&assert(this.listenersAttachedToWindow===0||this.listenersAttachedToElement===0,"Listeners should not be added both with addDisplayToWindow and addDisplayToElement. Use only one.");const r=e?"addEventListener":"removeEventListener",h=this.getNonWheelUsedTypes();for(let p=0;p<h.length;p++){const S=h[p];i&&document[r](S,v_,St.getEventOptions(t,!1));const C=this[`on${S}`];assert&&assert(!!C),l[r](S,C,St.getEventOptions(t,!0))}},batchWindowEvent(l,e,t,i){for(let n=0;n<this.attachedDisplays.length;n++){const h=this.attachedDisplays[n]._input;(!St.blockFocusCallbacks||t!=="focusIn"&&t!=="focusOut")&&h.batchEvent(l,e,h[t],i)}},onpointerdown:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointerdown"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const t=new ut(e);e.pointerType==="mouse"&&Fi.userGestureEmitter.emit(),St.batchWindowEvent(t,Ct.POINTER_TYPE,"pointerDown",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointerup:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointerup"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const t=new ut(e);Fi.userGestureEmitter.emit(),St.batchWindowEvent(t,Ct.POINTER_TYPE,"pointerUp",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointermove:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointermove"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.POINTER_TYPE,"pointerMove",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointerover:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointerover"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.POINTER_TYPE,"pointerOver",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointerout:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointerout"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.POINTER_TYPE,"pointerOut",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onpointercancel:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("pointercancel"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.POINTER_TYPE,"pointerCancel",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ongotpointercapture:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("gotpointercapture"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.POINTER_TYPE,"gotPointerCapture",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onlostpointercapture:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("lostpointercapture"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.POINTER_TYPE,"lostPointerCapture",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerDown:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerDown"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.MS_POINTER_TYPE,"pointerDown",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerUp:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerUp"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.MS_POINTER_TYPE,"pointerUp",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerMove:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerMove"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.MS_POINTER_TYPE,"pointerMove",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerOver:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerOver"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.MS_POINTER_TYPE,"pointerOver",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerOut:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerOut"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.MS_POINTER_TYPE,"pointerOut",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onMSPointerCancel:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("MSPointerCancel"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.MS_POINTER_TYPE,"pointerCancel",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ontouchstart:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("touchstart"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.TOUCH_TYPE,"touchStart",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ontouchend:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("touchend"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const t=new ut(e);Fi.userGestureEmitter.emit(),St.batchWindowEvent(t,Ct.TOUCH_TYPE,"touchEnd",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ontouchmove:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("touchmove"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.TOUCH_TYPE,"touchMove",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},ontouchcancel:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("touchcancel"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.TOUCH_TYPE,"touchCancel",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmousedown:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mousedown"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const t=new ut(e);Fi.userGestureEmitter.emit(),St.batchWindowEvent(t,Ct.MOUSE_TYPE,"mouseDown",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmouseup:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mouseup"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push();const t=new ut(e);Fi.userGestureEmitter.emit(),St.batchWindowEvent(t,Ct.MOUSE_TYPE,"mouseUp",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmousemove:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mousemove"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.MOUSE_TYPE,"mouseMove",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmouseover:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mouseover"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.MOUSE_TYPE,"mouseOver",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onmouseout:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("mouseout"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.MOUSE_TYPE,"mouseOut",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onwheel:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("wheel"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.WHEEL_TYPE,"wheel",!1),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onfocusin:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("focusin"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),jt.updatePDOMFocusFromEvent(St.attachedDisplays,e,!0),St.batchWindowEvent(new ut(e),Ct.ALT_TYPE,"focusIn",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onfocusout:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("focusout"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),jt.updatePDOMFocusFromEvent(St.attachedDisplays,e,!1),St.batchWindowEvent(new ut(e),Ct.ALT_TYPE,"focusOut",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},oninput:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("input"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.ALT_TYPE,"input",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onchange:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("change"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.ALT_TYPE,"change",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onclick:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("click"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.ALT_TYPE,"click",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onkeydown:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("keydown"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.ALT_TYPE,"keyDown",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()},onkeyup:function(e){sceneryLog&&sceneryLog.OnInput&&sceneryLog.OnInput("keyup"),sceneryLog&&sceneryLog.OnInput&&sceneryLog.push(),St.batchWindowEvent(new ut(e),Ct.ALT_TYPE,"keyUp",!0),sceneryLog&&sceneryLog.OnInput&&sceneryLog.pop()}};q.register("BrowserEvents",St);const Cl=St;class Zl{constructor(e){this.callbacks=[],this._delay=400,this._interval=100,this.delayID=null,this.intervalID=null,this.fired=!1,(e==null?void 0:e.delay)!==void 0&&(this.delay=e.delay),(e==null?void 0:e.interval)!==void 0&&(this.interval=e.interval),e!=null&&e.callback&&this.callbacks.push(e.callback)}isRunning(){return this.delayID!==null||this.intervalID!==null}start(){this.isRunning()||(this.fired=!1,this.delayID=Gi.setTimeout(()=>{this.delayID=null,this.intervalID=Gi.setInterval(()=>this.fire(),this.interval),this.fire()},this.delay))}stop(e){this.isRunning()&&(this.delayID&&(Gi.clearTimeout(this.delayID),this.delayID=null),this.intervalID&&(Gi.clearInterval(this.intervalID),this.intervalID=null),e&&!this.fired&&this.fire())}addCallback(e){this.callbacks.includes(e)||this.callbacks.push(e)}removeCallback(e){const t=this.callbacks.indexOf(e);t!==-1&&this.callbacks.splice(t,1)}fire(){const e=this.callbacks.slice(0);for(let t=0;t<e.length;t++)e[t]();this.fired=!0}set delay(e){assert&&assert(e>=0,`bad value for delay: ${e}`),this._delay=e}get delay(){return this._delay}set interval(e){assert&&assert(e>0,`bad value for interval: ${e}`),this._interval=e}get interval(){return this._interval}dispose(){this.stop(!1),this.callbacks.length=0}}hs.register("CallbackTimer",Zl);class Kf extends Bo{constructor(e){assert&&assert(e.fireOnHoldTiming==="custom"||e.fireOnHoldCustomDelay===void 0&&e.fireOnHoldCustomInterval===void 0,"Cannot specify fireOnHoldCustomDelay / fireOnHoldCustomInterval if fireOnHoldTiming is not custom");const t=je()({modifierKeys:[],ignoredModifierKeys:[],fire:_.noop,press:_.noop,release:_.noop,fireOnDown:!0,fireOnHold:!1,fireOnHoldTiming:"browser",fireOnHoldCustomDelay:400,fireOnHoldCustomInterval:100,allowOverlap:!1,override:!1},e);super(t),this.isPressedProperty=new Wt(!1),this.interrupted=!1,this.key=t.key,this.modifierKeys=t.modifierKeys,this.ignoredModifierKeys=t.ignoredModifierKeys,this.fire=t.fire,this.press=t.press,this.release=t.release,this.fireOnDown=t.fireOnDown,this.fireOnHold=t.fireOnHold,this.fireOnHoldTiming=t.fireOnHoldTiming,this.allowOverlap=t.allowOverlap,this.override=t.override,this.keys=_.uniq([this.key,...this.modifierKeys]);for(const i of this.keys)assert&&assert(sa[i],`No codes for this key exists, do you need to add it to EnglishStringToCodeMap?: ${i}`);this.fireOnHold&&this.fireOnHoldTiming==="custom"&&(this.fireOnHoldTimer=new Zl({callback:this.fire.bind(this,null),delay:t.fireOnHoldCustomDelay,interval:t.fireOnHoldCustomInterval}),this.disposeEmitter.addListener(()=>this.fireOnHoldTimer.dispose()),this.isPressedProperty.link(i=>{this.fireOnHoldTimer.stop(!1),i&&this.fireOnHoldTimer.start()}))}onPress(e,t){this.interrupted=!1,this.isPressedProperty.value=!0,this.press(e),t&&this.fire(e)}onRelease(e,t,i){this.interrupted=t,this.isPressedProperty.value=!1,this.release(e),i&&this.fire(e)}interrupt(){this.isPressedProperty.value&&Bc.interruptHotkey(this)}getHotkeyString(){return[...this.modifierKeys,this.key].join("+")}dispose(){this.isPressedProperty.dispose(),super.dispose()}}q.register("Hotkey",Kf);class jf{constructor(){this.hotkeysProperty=new vt(new Set)}add(e){assert&&assert(!this.hotkeysProperty.value.has(e),"Hotkey already added"),this.hotkeysProperty.value=new Set([...this.hotkeysProperty.value,e])}remove(e){assert&&assert(this.hotkeysProperty.value.has(e),"Hotkey not found"),this.hotkeysProperty.value=new Set([...this.hotkeysProperty.value].filter(t=>t!==e))}}q.register("GlobalHotkeyRegistry",jf);const Rc=new jf,__=(l,e)=>l.length===e.length&&l.every((t,i)=>t===e[i]),L_=(l,e)=>l.size===e.size&&[...l].every(t=>e.has(t));class qf{constructor(){this.enabledHotkeysProperty=new vt([]),this.englishKeysDown=new Set,this.modifierKeys=[],this.activeHotkeys=new Set,this.availableHotkeysProperty=new Jt([Rc.hotkeysProperty,jt.pdomFocusProperty],(n,r)=>{const h=[];if(r)for(const p of r.trail.nodes.slice().reverse()){if(!p.isInputEnabled())break;p.inputListeners.forEach(S=>{var C;(C=S.hotkeys)==null||C.forEach(B=>{h.push(B)})})}return h.push(...n),_.uniq(h)},{valueComparisonStrategy:__});const e=()=>{this.availableHotkeysProperty.recomputeDerivation()};jt.pdomFocusProperty.link((n,r)=>{r&&r.trail.nodes.forEach(h=>{h.inputEnabledProperty.unlink(e)}),n&&n.trail.nodes.forEach(h=>{h.inputEnabledProperty.lazyLink(e)})});const t=()=>{const n=new Set,r=[];for(const h of this.availableHotkeysProperty.value)if(h.enabledProperty.value){const p=[...h.modifierKeys.slice().sort(),h.key].join("+");n.has(p)||(r.push(h),h.override&&n.add(p))}this.enabledHotkeysProperty.value=r},i=new Map;this.availableHotkeysProperty.link((n,r)=>{let h=!1;if(r){for(const p of r)if(!n.includes(p)){const S=i.get(p);i.delete(p),assert&&assert(S),p.enabledProperty.unlink(S),h=!0}}for(const p of n)if(!r||!r.includes(p)){const S=()=>t();i.set(p,S),p.enabledProperty.lazyLink(S),h=!0}h&&t()}),this.enabledHotkeysProperty.link((n,r)=>{if(this.modifierKeys=_.uniq([...Fy,...[...n].flatMap(h=>h.modifierKeys)]),r)for(const h of r)!n.includes(h)&&this.activeHotkeys.has(h)&&this.removeActiveHotkey(h,null,!1);this.updateHotkeyStatus(null)}),ys.keyDownStateChangedEmitter.addListener(n=>{const r=ys.getEnglishKeysDown();if(!L_(this.englishKeysDown,r))this.englishKeysDown=r,this.updateHotkeyStatus(n);else for(const p of[...this.activeHotkeys])p.fireOnHold&&p.fireOnHoldTiming==="browser"&&p.fire(n)})}updateHotkeysFromInputListenerChange(e){jt.pdomFocusProperty.value&&jt.pdomFocusProperty.value.trail.nodes.includes(e)&&this.availableHotkeysProperty.recomputeDerivation()}getHotkeysForMainKey(e){if(!this.englishKeysDown.has(e))return[];const t=[...this.enabledHotkeysProperty.value].filter(i=>i.key!==e?!1:this.modifierKeys.every(n=>this.englishKeysDown.has(n)===i.keys.includes(n)||i.ignoredModifierKeys.includes(n)));if(assert){const i=t.filter(n=>!n.allowOverlap);assert&&assert(i.length<2,`Key conflict detected: ${i.map(n=>n.getHotkeyString())}`)}return t}updateHotkeyStatus(e){const t=me.getEventCode(e),i=t?Fg(t):null;for(const n of this.enabledHotkeysProperty.value){const r=this.getHotkeysForMainKey(n.key).includes(n),h=!n.interrupted||e&&e.type==="keydown",p=r&&h,S=this.activeHotkeys.has(n);p&&!S?this.addActiveHotkey(n,e,n.key===i):!p&&S&&this.removeActiveHotkey(n,e,n.key===i)}}addActiveHotkey(e,t,i){this.activeHotkeys.add(e);const n=i&&e.fireOnDown;e.onPress(t,n)}removeActiveHotkey(e,t,i){this.activeHotkeys.delete(e);const n=i&&!e.fireOnDown,r=!i;e.onRelease(t,r,n)}interruptHotkey(e){assert&&assert(e.isPressedProperty.value,"hotkey must be pressed to be interrupted"),this.removeActiveHotkey(e,null,!1)}}q.register("HotkeyManager",qf);const P_=new qf,Bc=P_;class S_{constructor(e,t){this.display=e,this.touches=[],this.nextTouchID=1,this.isMouseDown=!1,this.mousePosition=new We(0,0),this.random=new qc({seed:t}),this.mouseToggleAction=()=>{this.mouseToggle()},this.mouseMoveAction=()=>{this.mouseMove()},this.touchStartAction=()=>{const i=this.createTouch(this.getRandomPosition());this.touchStart(i)},this.touchMoveAction=()=>{const i=this.random.sample(this.touches);this.touchMove(i)},this.touchEndAction=()=>{const i=this.random.sample(this.touches);this.touchEnd(i),this.removeTouch(i)},this.touchCancelAction=()=>{const i=this.random.sample(this.touches);this.touchCancel(i),this.removeTouch(i)}}fuzzEvents(e,t,i,n){for(assert&&assert(e>0,`averageEventCount must be positive: ${e}`),this.display._input.currentlyFiringEvents=!0;this.random.nextDouble()<1-1/(e+1);){const h=this.touches.length+(this.isMouseDown?1:0)<n,p=[];t&&(this.isMouseDown||h)&&(p.push(this.mouseToggleAction),p.push(this.mouseMoveAction)),i&&(h&&p.push(this.touchStartAction),this.touches.length&&(p.push(this.random.nextDouble()<.8?this.touchEndAction:this.touchCancelAction),p.push(this.touchMoveAction))),this.random.sample(p)()}this.display._input.currentlyFiringEvents=!1,this.display._input.fireBatchedEvents()}createTouchEvent(e,t){const i=this.display.domElement,n=t.map(r=>({identifier:r.id,target:i,clientX:r.position.x,clientY:r.position.y}));if(self.Touch!==void 0&&self.TouchEvent!==void 0&&self.Touch.length===1&&self.TouchEvent.length===1){const r=n.map(h=>new self.Touch(h));return new self.TouchEvent(e,{cancelable:!0,bubbles:!0,touches:r,targetTouches:[],changedTouches:r,shiftKey:!1})}else{const r=document.createEvent("CustomEvent");return r.initCustomEvent(e,!0,!0,{touches:n,targetTouches:[],changedTouches:n}),r}}getRandomPosition(){return new We(Math.floor(this.random.nextDouble()*this.display.width),Math.floor(this.random.nextDouble()*this.display.height))}createTouch(e){const t={id:this.nextTouchID++,position:e};return this.touches.push(t),t}removeTouch(e){this.touches.splice(this.touches.indexOf(e),1)}touchStart(e){const t=this.createTouchEvent("touchstart",[e]);this.display._input.validatePointers(),this.display._input.touchStart(e.id,e.position,new ut(t))}touchMove(e){e.position=this.getRandomPosition();const t=this.createTouchEvent("touchmove",[e]);this.display._input.validatePointers(),this.display._input.touchMove(e.id,e.position,new ut(t))}touchEnd(e){const t=this.createTouchEvent("touchend",[e]);this.display._input.validatePointers(),this.display._input.touchEnd(e.id,e.position,new ut(t))}touchCancel(e){const t=this.createTouchEvent("touchcancel",[e]);this.display._input.validatePointers(),this.display._input.touchCancel(e.id,e.position,new ut(t))}mouseToggle(){const e=document.createEvent("MouseEvent");e.initMouseEvent(this.isMouseDown?"mouseup":"mousedown",!0,!0,window,1,this.mousePosition.x,this.mousePosition.y,this.mousePosition.x,this.mousePosition.y,!1,!1,!1,!1,0,null),this.display._input.validatePointers(),this.isMouseDown?(this.display._input.mouseUp(this.mousePosition,new ut(e)),this.isMouseDown=!1):(this.display._input.mouseDown(null,this.mousePosition,new ut(e)),this.isMouseDown=!0)}mouseMove(){this.mousePosition=this.getRandomPosition();const e=document.createEvent("MouseEvent");e.initMouseEvent("mousemove",!0,!0,window,0,this.mousePosition.x,this.mousePosition.y,this.mousePosition.x,this.mousePosition.y,!1,!1,!1,!1,0,null),this.display._input.validatePointers(),this.display._input.mouseMove(this.mousePosition,new ut(e))}}q.register("InputFuzzer",S_);class Xf extends yi{constructor(e){assert&&Xs("DownUpListener is deprecated, please use PressListener instead"),e=ns({mouseButton:0},e),super(e),this.options=e,this.isDown=!1,this.downCurrentTarget=null,this.downTrail=null,this.pointer=null,this.interrupted=!1,this.downListener={up:t=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`DownUpListener (pointer) up for ${this.downTrail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(t.pointer===this.pointer),(!(t.pointer instanceof bs)||t.domEvent.button===this.options.mouseButton)&&this.buttonUp(t),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},interrupt:()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`DownUpListener (pointer) interrupt for ${this.downTrail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupt(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},cancel:t=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`DownUpListener (pointer) cancel for ${this.downTrail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(t.pointer===this.pointer),this.buttonUp(t),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}}}buttonDown(e){this.isDown||e.pointer instanceof bs&&e.domEvent.button!==this.options.mouseButton||(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DownUpListener buttonDown"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),e.pointer.addInputListener(this.downListener),this.isDown=!0,this.downCurrentTarget=e.currentTarget,this.downTrail=e.trail.subtrailTo(e.currentTarget,!1),this.pointer=e.pointer,this.options.down&&this.options.down(e,this.downTrail),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())}buttonUp(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DownUpListener buttonUp"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.isDown=!1,this.pointer.removeInputListener(this.downListener);const t=e.currentTarget;if(e.currentTarget=this.downCurrentTarget,this.options.upInside||this.options.upOutside){const n=e.trail.isExtensionOf(this.downTrail,!0)&&!this.interrupted;n&&this.options.upInside?this.options.upInside(e,this.downTrail):!n&&this.options.upOutside&&this.options.upOutside(e,this.downTrail)}this.options.up&&this.options.up(e,this.downTrail),e.currentTarget=t,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}down(e){this.buttonDown(e)}interrupt(){if(this.isDown){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DownUpListener interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupted=!0;const e=ut.createSynthetic(),t=new rs(new ht,"synthetic",this.pointer,e);t.currentTarget=this.downCurrentTarget,this.buttonUp(t),this.interrupted=!1,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}}}q.register("DownUpListener",Xf);class Ao extends Xf{constructor(e){assert&&Xs("ButtonListener is deprecated, please use FireListener instead"),e=ns({phetioType:Ao.ButtonListenerIO,phetioState:!1,phetioEventType:Nt.USER},e),super({tandem:e.tandem,phetioType:e.phetioType,phetioState:e.phetioState,mouseButton:e.mouseButton||0,down:(t,i)=>{this.setButtonState(t,"down")},up:(t,i)=>{this.setButtonState(t,this._overCount>0?"over":"up")}}),this.buttonState="up",this._overCount=0,this._buttonOptions=e}setButtonState(e,t){if(t!==this.buttonState){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`ButtonListener state change to ${t} from ${this.buttonState} for ${this.downTrail?this.downTrail.toString():this.downTrail}`);const i=this.buttonState;this.buttonState=t,this._buttonOptions[t]&&(this.phetioStartEvent(t),this._buttonOptions[t](e,i),this.phetioEndEvent()),this._buttonOptions.fire&&this._overCount>0&&!this.interrupted&&(this._buttonOptions.fireOnDown?t==="down":i==="down")&&(this.phetioStartEvent("fire"),this._buttonOptions.fire(e),this.phetioEndEvent())}}enter(e){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`ButtonListener enter for ${this.downTrail?this.downTrail.toString():this.downTrail}`),this._overCount++,this._overCount===1&&this.setButtonState(e,this.isDown?"down":"over")}exit(e){sceneryLog&&sceneryLog.InputEvent&&sceneryLog.InputEvent(`ButtonListener exit for ${this.downTrail?this.downTrail.toString():this.downTrail}`),assert&&assert(this._overCount>0,"Exit events not matched by an enter"),this._overCount--,this._overCount===0&&this.setButtonState(e,this.isDown?"out":"up")}focus(e){this.enter(e)}blur(e){this.exit(e)}click(e){this.setButtonState(e,"down"),this.setButtonState(e,"up")}}q.register("ButtonListener",Ao);Ao.ButtonListenerIO=new li("ButtonListenerIO",{valueType:Ao,documentation:"Button listener",events:["up","over","down","out","fire"]});class w_ extends yi{constructor(e){assert&&Xs("SimpleDragHandler is deprecated, please use DragListener instead"),e=ns({start:null,drag:null,end:null,translate:null,allowTouchSnag:!1,mouseButton:0,dragCursor:"pointer",attach:!0,tandem:Ft.REQUIRED,phetioState:!1,phetioEventType:Nt.USER,phetioReadOnly:!0},e),super(),this.options=e,this.isDraggingProperty=new Wt(!1,{phetioReadOnly:e.phetioReadOnly,phetioState:!1,tandem:e.tandem.createTandem("isDraggingProperty"),phetioDocumentation:"Indicates whether the object is dragging"}),this.pointer=null,this.trail=null,this.transform=null,this.node=null,this.lastDragPoint=null,this.startTransformMatrix=null,this.mouseButton=void 0,this.interrupted=!1,this.lastInterruptedTouchLikePointer=null,this._attach=e.attach,this.dragStartAction=new xt((t,i)=>{this.dragging||(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("SimpleDragHandler startDrag"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._attach&&(i.pointer.dragging=!0),i.pointer.cursor=this.options.dragCursor,i.pointer.addInputListener(this.dragListener,this.options.attach),i.pointer.reserveForDrag(),this.isDraggingProperty.set(!0),this.pointer=i.pointer,this.trail=i.trail.subtrailTo(i.currentTarget,!0),this.transform=this.trail.getTransform(),this.node=i.currentTarget,this.lastDragPoint=i.pointer.point,this.startTransformMatrix=i.currentTarget.getMatrix().copy(),this.mouseButton=i.pointer instanceof bs?i.domEvent.button:void 0,this.options.start&&this.options.start.call(null,i,this.trail),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())},{tandem:e.tandem.createTandem("dragStartAction"),phetioReadOnly:e.phetioReadOnly,parameters:[{name:"point",phetioType:We.Vector2IO,phetioDocumentation:"the position of the drag start in view coordinates"},{phetioPrivate:!0,valueType:[rs,null]}]}),this.dragAction=new xt((t,i)=>{if(!this.dragging||this.isDisposed)return;const n=this.pointer.point.minus(this.lastDragPoint);if(n.magnitudeSquared===0)return;const r=this.transform.inverseDelta2(n);if(assert&&assert(i.pointer===this.pointer,"Wrong pointer in move"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`SimpleDragHandler (pointer) move for ${this.trail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.options.translate){const h=this.node.getMatrix().getTranslation();this.options.translate.call(null,{delta:r,oldPosition:h,position:h.plus(r)})}if(this.lastDragPoint=this.pointer.point,this.options.drag){const h=i.currentTarget;i.currentTarget=this.node,this.options.drag.call(null,i,this.trail),i.currentTarget=h}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},{phetioHighFrequency:!0,phetioReadOnly:e.phetioReadOnly,tandem:e.tandem.createTandem("dragAction"),parameters:[{name:"point",phetioType:We.Vector2IO,phetioDocumentation:"the position of the drag in view coordinates"},{phetioPrivate:!0,valueType:[rs,null]}]}),this.dragEndAction=new xt((t,i)=>{this.dragging&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("SimpleDragHandler endDrag"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._attach&&(this.pointer.dragging=!1),this.pointer.cursor=null,this.pointer.removeInputListener(this.dragListener),this.isDraggingProperty.set(!1),this.options.end&&this.options.end.call(null,i,this.trail),this.pointer=null,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())},{tandem:e.tandem.createTandem("dragEndAction"),phetioReadOnly:e.phetioReadOnly,parameters:[{name:"point",phetioType:We.Vector2IO,phetioDocumentation:"the position of the drag end in view coordinates"},{phetioPrivate:!0,isValidValue:t=>t===null||t instanceof rs||t.pointer&&t.currentTarget}]}),this.transformListener={transform:t=>{if(!this.trail.isExtensionOf(t.trail,!0))return;const i=t.trail.getMatrix(),n=this.transform.getMatrix();this.node.prependMatrix(i.inverted().timesMatrix(n)),this.transform.setMatrix(i)}},this.dragListener={up:t=>{if(!(!this.dragging||this.isDisposed)){if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`SimpleDragHandler (pointer) up for ${this.trail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(t.pointer===this.pointer,"Wrong pointer in up"),!(t.pointer instanceof bs)||t.domEvent.button===this.mouseButton){const i=t.currentTarget;t.currentTarget=this.node,this.endDrag(t),t.currentTarget=i}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}},cancel:t=>{if(!this.dragging||this.isDisposed)return;sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`SimpleDragHandler (pointer) cancel for ${this.trail.toString()}`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(t.pointer===this.pointer,"Wrong pointer in cancel");const i=t.currentTarget;t.currentTarget=this.node,this.endDrag(t),t.currentTarget=i,this.transform||this.node.setMatrix(this.startTransformMatrix),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},move:t=>{this.dragAction.execute(t.pointer.point,t)},interrupt:()=>{this.interrupt()}},this.initializePhetioObject({},e)}get dragging(){return this.isDraggingProperty.get()}set dragging(e){assert&&assert(!1,"illegal call to set dragging on SimpleDragHandler")}startDrag(e){this.dragStartAction.execute(e.pointer.point,e)}endDrag(e){this.dragEndAction.execute(e?e.pointer.point:We.ZERO,e)}interrupt(){this.dragging&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("SimpleDragHandler interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupted=!0,this.pointer&&this.pointer.isTouchLike()&&(this.lastInterruptedTouchLikePointer=this.pointer),this.endDrag({pointer:this.pointer,currentTarget:this.node}),this.interrupted=!1,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())}tryToSnag(e){e.pointer instanceof bs&&e.domEvent&&this.options.mouseButton!==e.domEvent.button&&this.options.mouseButton!==-1||this.isDisposed||!this.dragging&&(!e.pointer.dragging||!this._attach)&&e.pointer!==this.lastInterruptedTouchLikePointer&&e.canStartPress()&&this.startDrag(e)}tryTouchToSnag(e){this.options.allowTouchSnag&&(this.options.allowTouchSnag===!0||this.options.allowTouchSnag(e))&&this.tryToSnag(e)}down(e){this.tryToSnag(e)}touchenter(e){this.tryTouchToSnag(e)}touchmove(e){this.tryTouchToSnag(e)}dispose(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("SimpleDragHandler dispose"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.dragging&&(this._attach&&(this.pointer.dragging=!1),this.pointer.cursor=null,this.pointer.removeInputListener(this.dragListener)),this.isDraggingProperty.dispose(),this.dragEndAction.dispose(),this.dragAction.dispose(),this.dragStartAction.dispose(),super.dispose(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}static createForwardingListener(e,t){return t=ns({allowTouchSnag:!1},t),{down:i=>{!i.pointer.dragging&&i.canStartPress()&&e(i)},touchenter:function(i){t.allowTouchSnag&&this.down(i)},touchmove:function(i){t.allowTouchSnag&&this.down(i)}}}}q.register("SimpleDragHandler",w_);const _u=l=>{var U,k,Q,X;Hi(l,["length"],["elements"]);const e=je()({hasListenerOrderDependencies:!1,length:0,elements:[],elementAddedEmitterOptions:{},elementRemovedEmitterOptions:{},lengthPropertyOptions:{}},l);let t=null;if(e.phetioType)assert&&assert(e.phetioType.typeName.startsWith("ObservableArrayIO")),t={name:"value",phetioType:e.phetioType.parameterTypes[0]};else if(Hs.getValidatorValidationError(e))t=ns({name:"value"},{isValidValue:_.stubTrue});else{const g=_.pick(e,Hs.VALIDATOR_KEYS);t=ns({name:"value"},g)}const i=new Yi(ii({tandem:(U=e.tandem)==null?void 0:U.createTandem("elementAddedEmitter"),parameters:[t],phetioReadOnly:!0,hasListenerOrderDependencies:e.hasListenerOrderDependencies},e.elementAddedEmitterOptions)),n=new Yi(ii({tandem:(k=e.tandem)==null?void 0:k.createTandem("elementRemovedEmitter"),parameters:[t],phetioReadOnly:!0,hasListenerOrderDependencies:e.hasListenerOrderDependencies},e.elementRemovedEmitterOptions)),r=new gn(0,ii({numberType:"Integer",tandem:(Q=e.tandem)==null?void 0:Q.createTandem("lengthProperty"),phetioReadOnly:!0,hasListenerOrderDependencies:e.hasListenerOrderDependencies},e.lengthPropertyOptions)),h=[];assert&&i.addListener(()=>{pa.value||assert&&assert(r.value===h.length,"lengthProperty out of sync while adding element")}),assert&&n.addListener(()=>{pa.value||assert&&assert(r.value===h.length,"lengthProperty out of sync while removing element")});const p=[],S=(g,Z)=>{C.notificationsDeferred?C.deferredActions.push(()=>g.emit(Z)):g.emit(Z)},C=new Proxy(h,{get:function(g,Z,ce){return assert&&assert(g===h,"array should match the targetArray"),Rp.hasOwnProperty(Z)?Rp[Z]:Reflect.get(g,Z,ce)},set:function(g,Z,ce){assert&&assert(g===h,"array should match the targetArray");const ye=g[Z];let Oe=null;Z==="length"&&(Oe=g.slice(ce));const de=Reflect.set(g,Z,ce),se=Number(Z);return Number.isInteger(se)&&se>=0&&ye!==ce?(r.value=g.length,ye!==void 0&&S(n,g[Z]),ce!==void 0&&S(i,ce)):Z==="length"&&(r.value=ce,assert&&assert(Oe,"removedElements should be defined for key===length"),Oe&&Oe.forEach(fe=>S(n,fe))),de},deleteProperty:function(g,Z){assert&&assert(g===h,"array should match the targetArray");const ce=Number(Z);let ye;Number.isInteger(ce)&&ce>=0&&(ye=g[Z]);const Oe=Reflect.deleteProperty(g,Z);return ye!==void 0&&S(n,ye),Oe}});C.targetArray=h,C.notificationsDeferred=!1,C.emitNotification=S,C.deferredActions=p,C.elementAddedEmitter=i,C.elementRemovedEmitter=n,C.lengthProperty=r;const B=()=>{e.length>=0&&(C.length=e.length),e.elements.length>0&&Array.prototype.push.apply(C,e.elements)};if(B(),C.reset=()=>{C.length=0,B()},(X=e.tandem)!=null&&X.supplied&&(assert&&assert(e.phetioType),C.phetioElementType=e.phetioType.parameterTypes[0],C._observableArrayPhetioObject=new Zf(C,e),Ft.PHET_IO_ENABLED)){assert&&assert(_.hasIn(self,"phet.phetio.phetioEngine.phetioStateEngine"),"PhET-iO Instrumented ObservableArrays must be created once phetioEngine has been constructed");const g=phet.phetio.phetioEngine.phetioStateEngine;g.clearDynamicElementsEmitter.addListener((Z,ce)=>{var ye;(ye=C._observableArrayPhetioObject)!=null&&ye.tandem.hasAncestor(ce)&&(C.length=0,C.setNotificationsDeferred(!0))}),g.undeferEmitter.addListener(()=>{C.notificationsDeferred&&C.setNotificationsDeferred(!1)}),g.addSetStateHelper(()=>C.deferredActions.length>0?(C.deferredActions.shift()(),!0):!1)}return C};class Zf extends yi{constructor(e,t){super(t),this.observableArray=e}}const Rp={pop(...l){const e=this,t=e.targetArray.length,i=Array.prototype.pop.apply(e.targetArray,l);return e.lengthProperty.value=e.length,t>0&&e.emitNotification(e.elementRemovedEmitter,i),i},shift(...l){const e=this,t=e.targetArray.length,i=Array.prototype.shift.apply(e.targetArray,l);return e.lengthProperty.value=e.length,t>0&&e.emitNotification(e.elementRemovedEmitter,i),i},push(...l){const e=this,t=Array.prototype.push.apply(e.targetArray,l);e.lengthProperty.value=e.length;for(let i=0;i<arguments.length;i++)e.emitNotification(e.elementAddedEmitter,l[i]);return t},unshift(...l){const e=this,t=Array.prototype.unshift.apply(e.targetArray,l);e.lengthProperty.value=e.length;for(let i=0;i<l.length;i++)e.emitNotification(e.elementAddedEmitter,l[i]);return t},splice(...l){const e=this,t=Array.prototype.splice.apply(e.targetArray,l);e.lengthProperty.value=e.length;const i=t;for(let n=2;n<l.length;n++)e.emitNotification(e.elementAddedEmitter,l[n]);return i.forEach(n=>e.emitNotification(e.elementRemovedEmitter,n)),t},copyWithin(...l){const e=this,t=e.targetArray.slice(),i=Array.prototype.copyWithin.apply(e.targetArray,l);return Bp(t,e),i},fill(...l){const e=this,t=e.targetArray.slice(),i=Array.prototype.fill.apply(e.targetArray,l);return Bp(t,e),i},get:function(l){return this[l]},addItemAddedListener:function(l){this.elementAddedEmitter.addListener(l)},removeItemAddedListener:function(l){this.elementAddedEmitter.removeListener(l)},addItemRemovedListener:function(l){this.elementRemovedEmitter.addListener(l)},removeItemRemovedListener:function(l){this.elementRemovedEmitter.removeListener(l)},add:function(l){this.push(l)},addAll:function(l){this.push(...l)},remove:function(l){Vs(this,l)},removeAll:function(l){l.forEach(e=>Vs(this,e))},clear:function(){for(;this.length>0;)this.pop()},count:function(l){let e=0;for(let t=0;t<this.length;t++)l(this[t])&&e++;return e},find:function(l,e){return assert&&e!==void 0&&assert(typeof e=="number","fromIndex must be numeric, if provided"),assert&&typeof e=="number"&&assert(e>=0&&e<this.length,`fromIndex out of bounds: ${e}`),_.find(this,l,e)},shuffle:function(l){assert&&assert(l,"random must be supplied");const e=l.shuffle(this);this.targetArray.length=0,Array.prototype.push.apply(this.targetArray,e)},getArrayCopy:function(){return this.slice()},dispose:function(){const l=this;l.elementAddedEmitter.dispose(),l.elementRemovedEmitter.dispose(),l.lengthProperty.dispose(),l._observableArrayPhetioObject&&l._observableArrayPhetioObject.dispose()},toStateObject:function(){return{array:this.map(l=>this.phetioElementType.toStateObject(l))}},applyState:function(l){assert&&assert(this.length===0,"ObservableArrays should be cleared at the beginning of state setting."),this.length=0;const e=l.array.map(t=>this.phetioElementType.fromStateObject(t));this.push(...e)},setNotificationsDeferred:function(l){if(!l)for(;this.deferredActions.length>0;)this.deferredActions.shift()();this.notificationsDeferred=l}},Bp=(l,e)=>{const t=l,i=e.targetArray.slice();for(let n=0;n<t.length;n++){const r=t[n],h=i.indexOf(r);h>=0&&(t.splice(n,1),i.splice(h,1),n--)}t.forEach(n=>e.emitNotification(e.elementRemovedEmitter,n)),i.forEach(n=>e.emitNotification(e.elementAddedEmitter,n))},jh=new va,C_=l=>(jh.has(l)||jh.set(l,new li(`ObservableArrayIO<${l.typeName}>`,{valueType:Zf,parameterTypes:[l],toStateObject:e=>e.observableArray.toStateObject(),applyState:(e,t)=>e.observableArray.applyState(t),stateSchema:{array:Mo(l)}})),jh.get(l));_u.ObservableArrayIO=C_;hs.register("createObservableArray",_u);let T_=0;const D_=_.constant(!0),I_=l=>l.isPressed,ud=class ud extends Bo{constructor(e){const t=je()({press:_.noop,release:_.noop,targetNode:null,drag:_.noop,attach:!0,mouseButton:0,pressCursor:"pointer",useInputListenerCursor:!1,canStartPress:D_,a11yLooksPressedInterval:100,collapseDragEvents:!1,phetioEnabledPropertyInstrumented:!1,tandem:Ft.REQUIRED,phetioReadOnly:!0,phetioFeatured:yi.DEFAULT_OPTIONS.phetioFeatured},e);assert&&assert(typeof t.mouseButton=="number"&&t.mouseButton>=0&&t.mouseButton%1===0,"mouseButton should be a non-negative integer"),assert&&assert(t.pressCursor===null||typeof t.pressCursor=="string","pressCursor should either be a string or null"),assert&&assert(typeof t.press=="function","The press callback should be a function"),assert&&assert(typeof t.release=="function","The release callback should be a function"),assert&&assert(typeof t.drag=="function","The drag callback should be a function"),assert&&assert(t.targetNode===null||t.targetNode instanceof Ge,"If provided, targetNode should be a Node"),assert&&assert(typeof t.attach=="boolean","attach should be a boolean"),assert&&assert(typeof t.a11yLooksPressedInterval=="number","a11yLooksPressedInterval should be a number"),super(t),this._id=T_++,sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} construction`),this._mouseButton=t.mouseButton,this._a11yLooksPressedInterval=t.a11yLooksPressedInterval,this._pressCursor=t.pressCursor,this._pressListener=t.press,this._releaseListener=t.release,this._dragListener=t.drag,this._canStartPress=t.canStartPress,this._targetNode=t.targetNode,this._attach=t.attach,this._collapseDragEvents=t.collapseDragEvents,this.overPointers=_u(),this.isPressedProperty=new Wt(!1,{reentrant:!0}),this.isOverProperty=new Wt(!1),this.looksOverProperty=new Wt(!1),this.isHoveringProperty=new Wt(!1),this.isHighlightedProperty=new Wt(!1),this.isFocusedProperty=new Wt(!1),this.cursorProperty=new Jt([this.enabledProperty],i=>t.useInputListenerCursor&&i&&this._attach?this._pressCursor:null),this.pointer=null,this.pressedTrail=null,this.interrupted=!1,this._pendingCollapsedDragEvent=null,this._listeningToPointer=!1,this._isHoveringListener=this.invalidateHovering.bind(this),this._isHighlightedListener=this.invalidateHighlighted.bind(this),this.pdomClickingProperty=new Wt(!1),this.looksPressedProperty=Jt.or([this.pdomClickingProperty,this.isPressedProperty]),this._pdomClickingTimeoutListener=null,this._pointerListener={up:this.pointerUp.bind(this),cancel:this.pointerCancel.bind(this),move:this.pointerMove.bind(this),interrupt:this.pointerInterrupt.bind(this),listener:this},this._pressAction=new xt(this.onPress.bind(this),{tandem:t.tandem.createTandem("pressAction"),phetioDocumentation:"Executes whenever a press occurs. The first argument when executing can be used to convey info about the SceneryEvent.",phetioReadOnly:!0,phetioFeatured:t.phetioFeatured,phetioEventType:Nt.USER,parameters:[{name:"event",phetioType:rs.SceneryEventIO},{phetioPrivate:!0,valueType:[Ge,null]},{phetioPrivate:!0,valueType:["function",null]}]}),this._releaseAction=new xt(this.onRelease.bind(this),{parameters:[{name:"event",phetioType:Lt(rs.SceneryEventIO)},{phetioPrivate:!0,valueType:["function",null]}],tandem:t.tandem.createTandem("releaseAction"),phetioDocumentation:"Executes whenever a release occurs.",phetioReadOnly:!0,phetioFeatured:t.phetioFeatured,phetioEventType:Nt.USER}),this.display=null,this.boundInvalidateOverListener=this.invalidateOver.bind(this),this.overPointers.lengthProperty.link(this.invalidateOver.bind(this)),this.isFocusedProperty.link(this.invalidateOver.bind(this)),this.overPointers.lengthProperty.link(this._isHoveringListener),this.isPressedProperty.link(this._isHoveringListener),this.overPointers.addItemAddedListener(i=>i.isDownProperty.link(this._isHoveringListener)),this.overPointers.addItemRemovedListener(i=>i.isDownProperty.unlink(this._isHoveringListener)),this.isHoveringProperty.link(this._isHighlightedListener),this.isPressedProperty.link(this._isHighlightedListener),this.enabledProperty.lazyLink(this.onEnabledPropertyChange.bind(this))}get isPressed(){return this.isPressedProperty.value}get cursor(){return this.cursorProperty.value}get attach(){return this._attach}get targetNode(){return this._targetNode}getCurrentTarget(){return assert&&assert(this.isPressed,"We have no currentTarget if we are not pressed"),this.pressedTrail.lastNode()}get currentTarget(){return this.getCurrentTarget()}canPress(e){return!!this.enabledProperty.value&&!this.isPressed&&this._canStartPress(e,this)&&(!(e.pointer instanceof bs)||e.domEvent.button===this._mouseButton)&&(!this._attach||!e.pointer.isAttached())}canClick(){return this.enabledProperty.value&&!this.isPressed&&this._canStartPress(null,this)}press(e,t,i){return assert&&assert(e,"An event is required"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} press`),this.canPress(e)?(this.flushCollapsedDrag(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} successful press`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._pressAction.execute(e,t||null,i||null),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop(),!0):(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} could not press`),!1)}release(e,t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} release`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.flushCollapsedDrag(),this._releaseAction.execute(e||null,t||null),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}drag(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} drag`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(this.isPressed,"Can only drag while pressed"),this._dragListener(e,this),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}interrupt(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} interrupt`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.pdomClickingProperty.value?(this.interrupted=!0,this._listeningToPointer?this.release():(this.isPressedProperty.value=!1,this._releaseListener(null,this)),Gi.hasListener(this._pdomClickingTimeoutListener)&&(Gi.clearTimeout(this._pdomClickingTimeoutListener),this.pdomClickingProperty.isDisposed||(this.pdomClickingProperty.value=!1))):this.isPressed&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} interrupting`),this.interrupted=!0,this.release()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}clearOverPointers(){this.overPointers.clear()}step(){this.flushCollapsedDrag()}setCreatePanTargetBounds(e){this._pointerListener.createPanTargetBounds=e}set createPanTargetBounds(e){this.setCreatePanTargetBounds(e)}setCreatePanTargetBoundsFromTrail(e){assert&&assert(e.length>0,"trail has no Nodes to provide localBounds"),this.setCreatePanTargetBounds(()=>e.localToGlobalBounds(e.lastNode().localBounds))}set createPanTargetBoundsFromTrail(e){this.setCreatePanTargetBoundsFromTrail(e)}flushCollapsedDrag(){this._pendingCollapsedDragEvent&&this.drag(this._pendingCollapsedDragEvent),this._pendingCollapsedDragEvent=null}invalidateOver(){let e=!1;if(this._listeningToPointer)e=!1;else for(let t=0;t<this.overPointers.length;t++)if(this.overPointers.get(t).isAttached()){e=!0;break}this.isOverProperty.value=this.overPointers.length>0&&!e,this.looksOverProperty.value=this.isOverProperty.value||this.isFocusedProperty.value&&!!this.display&&this.display.focusManager.pdomFocusHighlightsVisibleProperty.value}invalidateHovering(){for(let e=0;e<this.overPointers.length;e++){const t=this.overPointers[e];if(!t.isDown||t===this.pointer){this.isHoveringProperty.value=!0;return}}this.isHoveringProperty.value=!1}invalidateHighlighted(){this.isHighlightedProperty.value=this.isHoveringProperty.value||this.isPressedProperty.value}onEnabledPropertyChange(e){!e&&this.interrupt()}onPress(e,t,i){assert&&assert(!this.isDisposed,"Should not press on a disposed listener");const n=t||this._targetNode;this.pointer=e.pointer,this.pressedTrail=n?n.getUniqueTrail():e.trail.subtrailTo(e.currentTarget,!1),this.interrupted=!1,this.pointer.addInputListener(this._pointerListener,this._attach),this._listeningToPointer=!0,this.pointer.cursor=this.pressedTrail.lastNode().getEffectiveCursor()||this._pressCursor,this.isPressedProperty.value=!0,this._pressListener(e,this),i&&i()}onRelease(e,t){assert&&assert(this.isPressed,"This listener is not pressed");const i=this;i.pointer.removeInputListener(this._pointerListener),this._listeningToPointer=!1,this.isPressedProperty.value=!1,this._releaseListener(e,this),t&&t(),i.pointer.cursor=null,this.pointer=null,this.pressedTrail=null}down(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} down`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.press(e),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}up(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} up`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.invalidateOver(),this.invalidateHovering(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}enter(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} enter`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.overPointers.push(e.pointer),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}move(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} move`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.invalidateOver(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}exit(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} exit`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.overPointers.includes(e.pointer)&&this.overPointers.remove(e.pointer),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}pointerUp(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} pointer up`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.isPressed&&(assert&&assert(e.pointer===this.pointer),this.release(e)),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}pointerCancel(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} pointer cancel`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.isPressed&&(assert&&assert(e.pointer===this.pointer),this.interrupt()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}pointerMove(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} pointer move`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.isPressed&&(assert&&assert(e.pointer===this.pointer),this._collapseDragEvents?this._pendingCollapsedDragEvent=e:this.drag(e)),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}pointerInterrupt(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} pointer interrupt`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupt(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}click(e,t){return this.canClick()&&(this.interrupted=!1,this.pdomClickingProperty.value=!0,this.isFocusedProperty.value=!0,this.isPressedProperty.value=!0,this._pressListener(e,this),t&&t(),this.isPressedProperty.value=!1,this._releaseListener(e,this),Gi.clearTimeout(this._pdomClickingTimeoutListener),this._pdomClickingTimeoutListener=Gi.setTimeout(()=>{this.pdomClickingProperty.isDisposed||(this.pdomClickingProperty.value=!1)},this._a11yLooksPressedInterval)),!0}focus(e){const t=e.trail.rootNode().getRootedDisplays().filter(i=>i.isAccessible());assert&&assert(t.length===1,"cannot focus node with zero or multiple accessible displays attached"),this.display=t[0],this.display.focusManager.pdomFocusHighlightsVisibleProperty.hasListener(this.boundInvalidateOverListener)||this.display.focusManager.pdomFocusHighlightsVisibleProperty.link(this.boundInvalidateOverListener),this.isFocusedProperty.value=!0}blur(){this.display&&(this.display.focusManager.pdomFocusHighlightsVisibleProperty.hasListener(this.boundInvalidateOverListener)&&this.display.focusManager.pdomFocusHighlightsVisibleProperty.unlink(this.boundInvalidateOverListener),this.display=null),this.isFocusedProperty.value=!1}dispose(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener(`PressListener#${this._id} dispose`),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.overPointers.clear(),this._listeningToPointer&&I_(this)&&this.pointer.removeInputListener(this._pointerListener),this.isPressedProperty.isDisposed||(this.isPressedProperty.unlink(this._isHighlightedListener),this.isPressedProperty.unlink(this._isHoveringListener)),!this.isHoveringProperty.isDisposed&&this.isHoveringProperty.unlink(this._isHighlightedListener),this._pressAction.dispose(),this._releaseAction.dispose(),this.looksPressedProperty.dispose(),this.pdomClickingProperty.dispose(),this.cursorProperty.dispose(),this.isFocusedProperty.dispose(),this.isHighlightedProperty.dispose(),this.isHoveringProperty.dispose(),this.looksOverProperty.dispose(),this.isOverProperty.dispose(),this.isPressedProperty.dispose(),this.overPointers.dispose(),this.display&&(this.display.focusManager.pdomFocusHighlightsVisibleProperty.unlink(this.boundInvalidateOverListener),this.display=null),super.dispose(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}};ud.phetioAPI={pressAction:{phetioType:xt.PhetioActionIO([rs.SceneryEventIO])},releaseAction:{phetioType:xt.PhetioActionIO([Lt(rs.SceneryEventIO)])}};let mn=ud;q.register("PressListener",mn);class Fc extends mn{constructor(e){const t=je()({fire:_.noop,fireOnDown:!1,fireOnHold:!1,fireOnHoldDelay:400,fireOnHoldInterval:100,tandem:Ft.REQUIRED,phetioReadOnly:yi.DEFAULT_OPTIONS.phetioReadOnly},e);assert&&assert(typeof t.fire=="function","The fire callback should be a function"),assert&&assert(typeof t.fireOnDown=="boolean","fireOnDown should be a boolean"),super(t),this._fireOnDown=t.fireOnDown,this.firedEmitter=new Yi({tandem:t.tandem.createTandem("firedEmitter"),phetioEventType:Nt.USER,phetioReadOnly:t.phetioReadOnly,phetioDocumentation:"Emits at the time that the listener fires",parameters:[{name:"event",phetioType:Lt(rs.SceneryEventIO)}]}),this.firedEmitter.addListener(t.fire),t.fireOnHold&&(this._timer=new Zl({callback:this.fire.bind(this,null),delay:t.fireOnHoldDelay,interval:t.fireOnHoldInterval}))}fire(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("FireListener fire"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.firedEmitter.emit(e),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}press(e,t,i){return super.press(e,t,()=>{this._fireOnDown&&this.fire(e),this._timer&&this._timer.start(),i&&i()})}release(e,t){super.release(e,()=>{const i=!this._fireOnDown&&this.isHoveringProperty.value&&!this.interrupted;this._timer?this._timer.stop(i):i&&this.fire(e||null),t&&t()})}click(e,t){return super.click(e,()=>{this.interrupted||this.fire(e),t&&t()})}interrupt(){super.interrupt(),this._timer&&this._timer.stop(!1)}dispose(){this.firedEmitter.dispose(),this._timer&&this._timer.dispose(),super.dispose()}}q.register("FireListener",Fc);const qh=new We(0,0),Pn=l=>l.isPressed;class x_ extends mn{constructor(e){const t=je()({positionProperty:null,start:null,end:null,transform:null,dragBoundsProperty:null,allowTouchSnag:!0,applyOffset:!0,useParentOffset:!1,trackAncestors:!1,translateNode:!1,mapPosition:null,offsetPosition:null,canClick:!1,tandem:Ft.REQUIRED,phetioReadOnly:!0,phetioFeatured:yi.DEFAULT_OPTIONS.phetioFeatured},e);assert&&assert(!t.dragBounds,"options.dragBounds was removed in favor of options.dragBoundsProperty"),assert&&assert(!t.useParentOffset||t.positionProperty,"If useParentOffset is set, a positionProperty is required"),assert&&assert(!(t.mapPosition&&t.dragBoundsProperty),"Only one of mapPosition and dragBoundsProperty can be provided, as they handle mapping of the drag point"),super(t),this._allowTouchSnag=t.allowTouchSnag,this._applyOffset=t.applyOffset,this._useParentOffset=t.useParentOffset,this._trackAncestors=t.trackAncestors,this._translateNode=t.translateNode,this._transform=t.transform,this._positionProperty=t.positionProperty,this._mapPosition=t.mapPosition,this._offsetPosition=t.offsetPosition,this._dragBoundsProperty=t.dragBoundsProperty||new ei(null),this._start=t.start,this._end=t.end,this._canClick=t.canClick,this.isUserControlledProperty=this.isPressedProperty,this._globalPoint=new We(0,0),this._localPoint=new We(0,0),this._parentPoint=new We(0,0),this._modelPoint=new We(0,0),this._modelDelta=new We(0,0),this._parentOffset=new We(0,0),this._transformTracker=null,this._transformTrackerListener=this.ancestorTransformed.bind(this),this._lastInterruptedTouchLikePointer=null,this._dragAction=new xt(i=>{assert&&assert(Pn(this));const r=this.pointer.point;r&&(this._globalPoint.equals(r)||this.reposition(r)),mn.prototype.drag.call(this,i)},{parameters:[{name:"event",phetioType:rs.SceneryEventIO}],phetioFeatured:t.phetioFeatured,tandem:t.tandem.createTandem("dragAction"),phetioHighFrequency:!0,phetioDocumentation:"Emits whenever a drag occurs with an SceneryEventIO argument.",phetioReadOnly:t.phetioReadOnly,phetioEventType:Nt.USER})}press(e,t,i){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const n=super.press(e,t,()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener successful press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(Pn(this));const r=this;r.pointer.reserveForDrag(),this.attachTransformTracker(),assert&&assert(r.pointer.point!==null);const h=r.pointer.point,p=this.globalToParentPoint(this._localPoint.set(h));this._useParentOffset&&this.modelToParentPoint(this._parentOffset.set(this._positionProperty.value)).subtract(p),this.parentToLocalPoint(p),this.reposition(h),this._start&&this._start(e,r),i&&i(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()});return sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop(),n}release(e,t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener release"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),super.release(e,()=>{this.detachTransformTracker(),this._end&&this._end(e||null,this),t&&t()}),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}canClick(){return super.canClick()&&this._canClick}click(e,t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener click"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const i=super.click(e,()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener successful press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._start&&this._start(e,this),t&&t(),this._end&&this._end(e,this),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()});return sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop(),i}drag(e){assert&&assert(Pn(this));const i=this.pointer.point;!i||this._globalPoint.equals(i)||(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener drag"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._dragAction.execute(e),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())}tryTouchSnag(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener tryTouchSnag"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._allowTouchSnag&&(!this.attach||!e.pointer.isAttached())&&this.press(e),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}getGlobalPoint(){return this._globalPoint.copy()}get globalPoint(){return this.getGlobalPoint()}getLocalPoint(){return this._localPoint.copy()}get localPoint(){return this.getLocalPoint()}getParentPoint(){return this._parentPoint.copy()}get parentPoint(){return this.getParentPoint()}getModelPoint(){return this._modelPoint.copy()}get modelPoint(){return this.getModelPoint()}getModelDelta(){return this._modelDelta.copy()}get modelDelta(){return this.getModelDelta()}globalToParentPoint(e){assert&&assert(Pn(this));const t=this;let i;return assert&&(i=t.pressedTrail.globalToParentPoint(e)),t.pressedTrail.getParentTransform().getInverse().multiplyVector2(e),assert&&assert(e.equals(i)),e}parentToLocalPoint(e){assert&&assert(Pn(this));const t=this;let i;return assert&&(i=t.pressedTrail.lastNode().parentToLocalPoint(e)),t.pressedTrail.lastNode().getTransform().getInverse().multiplyVector2(e),assert&&assert(e.equals(i)),e}localToParentPoint(e){assert&&assert(Pn(this));const t=this;let i;return assert&&(i=t.pressedTrail.lastNode().localToParentPoint(e)),t.pressedTrail.lastNode().getMatrix().multiplyVector2(e),assert&&assert(e.equals(i)),e}parentToModelPoint(e){return this._transform&&(this._transform instanceof Fs?this._transform:this._transform.value).getInverse().multiplyVector2(e),e}modelToParentPoint(e){return this._transform&&(this._transform instanceof Fs?this._transform:this._transform.value).getMatrix().multiplyVector2(e),e}mapModelPoint(e){return this._mapPosition?this._mapPosition(e):this._dragBoundsProperty.value?this._dragBoundsProperty.value.closestPointTo(e):e}applyParentOffset(e){this._offsetPosition&&e.add(this._offsetPosition(e,this)),this._applyOffset&&(this._useParentOffset?e.add(this._parentOffset):(e.subtract(this.localToParentPoint(qh.set(this._localPoint))),e.add(this.localToParentPoint(qh.setXY(0,0)))))}reposition(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener reposition"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),assert&&assert(Pn(this));const t=this;this._globalPoint.set(e),this.applyParentOffset(this.globalToParentPoint(this._parentPoint.set(e))),this._modelDelta.set(this._modelPoint).negate(),this._modelPoint.set(this.mapModelPoint(this.parentToModelPoint(qh.set(this._parentPoint)))),this._modelDelta.add(this._modelPoint),this.modelToParentPoint(this._parentPoint.set(this._modelPoint)),this._translateNode&&(t.pressedTrail.lastNode().translation=this._parentPoint),this._positionProperty&&(this._positionProperty.value=this._modelPoint.copy()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}touchenter(e){e.pointer.isDownProperty.value&&this.tryTouchSnag(e)}touchmove(e){this.tryTouchSnag(e)}ancestorTransformed(){assert&&assert(Pn(this));const t=this.pointer.point;t&&this.reposition(t)}attachTransformTracker(){assert&&assert(Pn(this));const e=this;this._trackAncestors&&(this._transformTracker=new kr(e.pressedTrail.copy().removeDescendant()),this._transformTracker.addListener(this._transformTrackerListener))}detachTransformTracker(){this._transformTracker&&(this._transformTracker.removeListener(this._transformTrackerListener),this._transformTracker.dispose(),this._transformTracker=null)}getDragBounds(){return this._dragBoundsProperty.value}get dragBounds(){return this.getDragBounds()}setTransform(e){this._transform=e}set transform(e){this.setTransform(e)}get transform(){return this.getTransform()}getTransform(){return this._transform}interrupt(){this.pointer&&this.pointer.isTouchLike()&&(this._lastInterruptedTouchLikePointer=this.pointer),super.interrupt()}canPress(e){return e.pointer===this._lastInterruptedTouchLikePointer?!1:super.canPress(e)}dispose(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("DragListener dispose"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this._dragAction.dispose(),this.detachTransformTracker(),super.dispose(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}static createForwardingListener(e,t){const i=je()({allowTouchSnag:!0},t);return{down(n){n.canStartPress()&&e(n)},touchenter(n){i.allowTouchSnag&&this.down(n)},touchmove(n){i.allowTouchSnag&&this.down(n)}}}}q.register("DragListener",x_);class Qf{constructor(e,t){this.pointer=e,this.trail=t,this.interrupted=!1,this.initialPoint=e.point,this.localPoint=null,this.recomputeLocalPoint()}recomputeLocalPoint(){this.localPoint=this.trail.globalToLocalPoint(this.pointer.point)}get targetPoint(){return this.trail.globalToParentPoint(this.pointer.point)}}q.register("MultiListenerPress",Qf);const E_=25;class Jf{constructor(e,t){const i=je()({mouseButton:0,pressCursor:"pointer",allowScale:!0,allowRotation:!0,allowMultitouchInterruption:!1,allowMoveInterruption:!0,minScale:1,maxScale:4,tandem:Ft.REQUIRED},t);this._targetNode=e,this._minScale=i.minScale,this._maxScale=i.maxScale,this._mouseButton=i.mouseButton,this._pressCursor=i.pressCursor,this._allowScale=i.allowScale,this._allowRotation=i.allowRotation,this._allowMultitouchInterruption=i.allowMultitouchInterruption,this._allowMoveInterruption=i.allowMoveInterruption,this._presses=[],this._backgroundPresses=[],this.matrixProperty=new ei(e.matrix.copy(),{phetioValueType:$e.Matrix3IO,tandem:i.tandem.createTandem("matrixProperty"),phetioReadOnly:!0}),this.matrixProperty.link(n=>{this._targetNode.matrix=n}),this._interrupted=!1,this._pressListener={move:n=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener pointer move"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const r=this.findPress(n.pointer);assert&&assert(r,"Press should be found for move event"),this.movePress(r),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},up:n=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener pointer up"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const r=this.findPress(n.pointer);assert&&assert(r,"Press should be found for up event"),this.removePress(r),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},cancel:n=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener pointer cancel"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const r=this.findPress(n.pointer);assert&&assert(r,"Press should be found for cancel event"),r.interrupted=!0,this.removePress(r),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},interrupt:()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener pointer interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupt(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}},this._backgroundListener={up:n=>{if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener background up"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),!this._interrupted){const r=this.findBackgroundPress(n.pointer);assert&&assert(r,"Background press should be found for up event"),this.removeBackgroundPress(r)}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},move:n=>{const r=this._backgroundPresses.filter(h=>!h.pointer.hasIntent(Bi.DRAG)&&h.initialPoint.distance(h.pointer.point)>E_);(this.getCurrentScale()!==1||r.length>=2)&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener attached, interrupting for press"),r.forEach(h=>{this.removeBackgroundPress(h),this.interruptOtherListeners(h.pointer),this.addPress(h)}))},cancel:n=>{if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener background cancel"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),!this._interrupted){const r=this.findBackgroundPress(n.pointer);assert&&assert(r,"Background press should be found for cancel event"),this.removeBackgroundPress(r)}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()},interrupt:()=>{sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener background interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.interrupt(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}}}findPress(e){for(let t=0;t<this._presses.length;t++)if(this._presses[t].pointer===e)return this._presses[t];return null}findBackgroundPress(e){for(let t=0;t<this._backgroundPresses.length;t++)if(this._backgroundPresses[t].pointer===e)return this._backgroundPresses[t];return null}hasPress(e){return _.some(this._presses.concat(this._backgroundPresses),t=>t.pointer===e.pointer)}interruptOtherListeners(e){const t=e.getListeners();for(let i=0;i<t.length;i++){const n=t[i];n!==this._backgroundListener&&n.interrupt&&n.interrupt()}}down(e){if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener down"),e.pointer instanceof bs&&e.domEvent instanceof MouseEvent&&e.domEvent.button!==this._mouseButton){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener abort: wrong mouse button");return}this._interrupted=!1;let t;_.includes(e.trail.nodes,this._targetNode)?t=e.trail.subtrailTo(this._targetNode,!1):t=this._targetNode.getUniqueTrailTo(e.target),assert&&assert(_.includes(t.nodes,this._targetNode),"targetNode must be in the Trail for Press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const i=new Qf(e.pointer,t);!this._allowMoveInterruption&&!this._allowMultitouchInterruption?e.pointer.isAttached()||(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener unattached, using press"),this.addPress(i)):(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener attached, adding background press"),this.addBackgroundPress(i)),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}addPress(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener addPress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.hasPress(e)||(this._presses.push(e),e.pointer.cursor=this._pressCursor,e.pointer.addInputListener(this._pressListener,!0),this.recomputeLocals(),this.reposition()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}movePress(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener movePress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.reposition(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}removePress(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener removePress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),e.pointer.removeInputListener(this._pressListener),e.pointer.cursor=null,Vs(this._presses,e),this.recomputeLocals(),this.reposition(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}addBackgroundPress(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener addBackgroundPress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.hasPress(e)||(this._backgroundPresses.push(e),e.pointer.addInputListener(this._backgroundListener,!1)),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}removeBackgroundPress(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener removeBackgroundPress"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),e.pointer.removeInputListener(this._backgroundListener),Vs(this._backgroundPresses,e),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}reposition(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener reposition"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),this.matrixProperty.set(this.computeMatrix()),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}recomputeLocals(){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener recomputeLocals"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();for(let e=0;e<this._presses.length;e++)this._presses[e].recomputeLocalPoint();sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}interrupt(){for(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener interrupt"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();this._presses.length;)this.removePress(this._presses[this._presses.length-1]);for(;this._backgroundPresses.length;)this.removeBackgroundPress(this._backgroundPresses[this._backgroundPresses.length-1]);this._interrupted=!0,sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}computeMatrix(){return this._presses.length===0?this._targetNode.getMatrix():this._presses.length===1?this.computeSinglePressMatrix():this._allowScale&&this._allowRotation?this.computeTranslationRotationScaleMatrix():this._allowScale?this.computeTranslationScaleMatrix():this._allowRotation?this.computeTranslationRotationMatrix():this.computeTranslationMatrix()}computeSinglePressMatrix(){const e=this._presses[0].targetPoint,t=this._presses[0].localPoint;assert&&assert(t,"localPoint is not defined on the Press?");const i=this._targetNode.localToParentPoint(t),n=e.minus(i);return $e.translationFromVector(n).timesMatrix(this._targetNode.getMatrix())}computeTranslationMatrix(){const e=new We(0,0);for(let t=0;t<this._presses.length;t++){e.add(this._presses[t].targetPoint);const i=this._presses[t].localPoint;assert&&assert(i,"localPoint is not defined on the Press?"),e.subtract(i)}return $e.translationFromVector(e.dividedScalar(this._presses.length))}computeTranslationScaleMatrix(){const e=this._presses.map(B=>(assert&&assert(B.localPoint,"localPoint is not defined on the Press?"),B.localPoint)),t=this._presses.map(B=>B.targetPoint),i=new We(0,0),n=new We(0,0);e.forEach(B=>{i.add(B)}),t.forEach(B=>{n.add(B)}),i.divideScalar(this._presses.length),n.divideScalar(this._presses.length);let r=0,h=0;e.forEach(B=>{r+=B.distanceSquared(i)}),t.forEach(B=>{h+=B.distanceSquared(n)});let p=this.getCurrentScale();h!==0&&(p=this.limitScale(Math.sqrt(h/r)));const S=$e.translation(n.x,n.y),C=$e.translation(-i.x,-i.y);return S.timesMatrix($e.scaling(p)).timesMatrix(C)}limitScale(e){let t=Math.max(e,this._minScale);return t=Math.min(t,this._maxScale),t}computeTranslationRotationMatrix(){let e;const t=new Ea(2,this._presses.length),i=new Ea(2,this._presses.length),n=new We(0,0),r=new We(0,0);for(e=0;e<this._presses.length;e++){const U=this._presses[e].localPoint,k=this._presses[e].targetPoint;n.add(U),r.add(k),t.set(0,e,U.x),t.set(1,e,U.y),i.set(0,e,k.x),i.set(1,e,k.y)}for(n.divideScalar(this._presses.length),r.divideScalar(this._presses.length),e=0;e<this._presses.length;e++)t.set(0,e,t.get(0,e)-n.x),t.set(1,e,t.get(1,e)-n.y),i.set(0,e,i.get(0,e)-r.x),i.set(1,e,i.get(1,e)-r.y);const h=t.times(i.transpose()),p=new Id(h);let S=p.getV().times(p.getU().transpose());S.det()<0&&(S=p.getV().times(Ea.diagonalMatrix([1,-1])).times(p.getU().transpose()));const C=new $e().rowMajor(S.get(0,0),S.get(0,1),0,S.get(1,0),S.get(1,1),0,0,0,1),B=r.minus(C.timesVector2(n));return C.set02(B.x),C.set12(B.y),C}computeTranslationRotationScaleMatrix(){let e;const t=new Ea(this._presses.length*2,4);for(e=0;e<this._presses.length;e++){const C=this._presses[e].localPoint;t.set(2*e+0,0,C.x),t.set(2*e+0,1,C.y),t.set(2*e+0,2,1),t.set(2*e+1,0,C.y),t.set(2*e+1,1,-C.x),t.set(2*e+1,3,1)}const i=new Ea(this._presses.length*2,1);for(e=0;e<this._presses.length;e++){const C=this._presses[e].targetPoint;i.set(2*e+0,0,C.x),i.set(2*e+1,0,C.y)}const n=Id.pseudoinverse(t).times(i),r=n.get(0,0),h=n.get(1,0),p=n.get(2,0),S=n.get(3,0);return new $e().rowMajor(r,h,p,-h,r,S,0,0,1)}getCurrentScale(){return this._targetNode.getScaleVector().x}resetTransform(){this._targetNode.resetTransform(),this.matrixProperty.set(this._targetNode.matrix.copy())}}q.register("MultiListener",Jf);class qs extends Fs{modelToViewPosition(e){return this.transformPosition2(e)}modelToViewXY(e,t){return new We(this.modelToViewX(e),this.modelToViewY(t))}modelToViewX(e){return this.matrix.m00()*e+this.matrix.m02()}modelToViewY(e){return this.matrix.m11()*e+this.matrix.m12()}modelToViewDelta(e){return this.transformDelta2(e)}modelToViewNormal(e){return this.transformNormal2(e)}modelToViewDeltaX(e){return this.transformDeltaX(e)}modelToViewDeltaY(e){return this.transformDeltaY(e)}modelToViewBounds(e){return this.transformBounds2(e)}modelToViewShape(e){return this.transformShape(e)}modelToViewRay(e){return this.transformRay2(e)}viewToModelPosition(e){return this.inversePosition2(e)}viewToModelXY(e,t){return new We(this.viewToModelX(e),this.viewToModelY(t))}viewToModelX(e){const t=this.getInverse();return t.m00()*e+t.m02()}viewToModelY(e){const t=this.getInverse();return t.m11()*e+t.m12()}viewToModelDelta(e){return this.inverseDelta2(e)}viewToModelDeltaXY(e,t){return new We(this.viewToModelDeltaX(e),this.viewToModelDeltaY(t))}viewToModelNormal(e){return this.inverseNormal2(e)}viewToModelDeltaX(e){return this.inverseDeltaX(e)}viewToModelDeltaY(e){return this.inverseDeltaY(e)}viewToModelBounds(e){return this.inverseBounds2(e)}viewToModelShape(e){return this.inverseShape(e)}viewToModelRay(e){return this.inverseRay2(e)}validateMatrix(e){super.validateMatrix(e),assert&&assert(e.isAligned(),"matrix must be aligned, ModelViewTransform2 does not support arbitrary rotations")}setToRectangleMapping(e,t){const i=t.width/e.width,n=t.x-i*e.x,r=t.height/e.height,h=t.y-r*e.y;return this.setMatrix($e.affine(i,0,n,0,r,h)),this}setToRectangleInvertedYMapping(e,t){const i=t.width/e.width,n=t.x-i*e.x,r=-t.height/e.height,h=t.y-r*e.getMaxY();return this.setMatrix($e.affine(i,0,n,0,r,h)),this}static createIdentity(){return new qs($e.IDENTITY)}static createOffsetScaleMapping(e,t){return new qs($e.affine(t,0,e.x,0,t,e.y))}static createOffsetXYScaleMapping(e,t,i){return new qs($e.affine(t,0,e.x,0,i,e.y))}static createSinglePointXYScaleMapping(e,t,i,n){const r=t.x-e.x*i,h=t.y-e.y*n;return qs.createOffsetXYScaleMapping(new We(r,h),i,n)}static createSinglePointScaleMapping(e,t,i){return qs.createSinglePointXYScaleMapping(e,t,i,i)}static createSinglePointScaleInvertedYMapping(e,t,i){return qs.createSinglePointXYScaleMapping(e,t,i,-i)}static createRectangleMapping(e,t){return new qs().setToRectangleMapping(e,t)}static createRectangleInvertedYMapping(e,t){return new qs().setToRectangleInvertedYMapping(e,t)}}Of.register("ModelViewTransform2",qs);const Fp=new $e;class em extends Jf{constructor(e,t){var n;const i=je()({panBounds:Be.NOTHING,targetBounds:null,targetScale:1,allowRotation:!1},t);super(e,i),this._panBounds=i.panBounds,this._targetBounds=i.targetBounds||e.globalBounds.copy(),this._targetScale=i.targetScale,this.sourceFramePanBoundsProperty=new ei(Ft.API_GENERATION?new Be(0,0,0,0):this._panBounds,{tandem:(n=i.tandem)==null?void 0:n.createTandem("sourceFramePanBoundsProperty"),phetioReadOnly:!0,phetioValueType:Be.Bounds2IO}),this.sourceFramePanBoundsProperty.lazyLink(()=>{if(pa.value){const r=qs.createRectangleMapping(this.sourceFramePanBoundsProperty.get(),this._panBounds),h=this._targetNode.matrix.translation.componentMultiply(r.matrix.getScaleVector()),p=this.matrixProperty.get().getScaleVector();this.matrixProperty.set($e.translationFromVector(h).timesMatrix($e.scaling(p.x,p.y)))}},{phetioDependencies:[this.matrixProperty]})}correctReposition(){Fp.set(this._targetNode.matrix);const e=this._targetBounds.transformed(this._targetNode.getMatrix());e.left>this._panBounds.left&&(this._targetNode.left=this._panBounds.left-(e.left-this._targetNode.left)),e.top>this._panBounds.top&&(this._targetNode.top=this._panBounds.top-(e.top-this._targetNode.top)),e.right<this._panBounds.right&&(this._targetNode.right=this._panBounds.right+(this._targetNode.right-e.right)),e.bottom<this._panBounds.bottom&&(this._targetNode.bottom=this._panBounds.bottom+(this._targetNode.bottom-e.bottom)),Fp.equals(this._targetNode.matrix)||this.matrixProperty.set(this._targetNode.matrix.copy())}addPress(e){super.addPress(e);const i=this._targetBounds.transformed(this._targetNode.getMatrix()).equalsEpsilon(this._panBounds,1e-8);e.pointer.cursor=i?null:this._pressCursor}reposition(){super.reposition(),this.correctReposition()}resetTransform(){super.resetTransform(),this.correctReposition()}setPanBounds(e){this._panBounds=e,Ft.API_GENERATION||this.sourceFramePanBoundsProperty.set(this._panBounds),this.correctReposition()}setTargetBounds(e){this._targetBounds=e,this.correctReposition()}setTargetScale(e){this._targetScale=e}getTargetBounds(){return this._targetBounds}}q.register("PanZoomListener",em);const Hp="all-scroll",k_=150,A_=1e3,to=new We(0,0),za=new We(0,0),Vp=new We(0,0),Gp=new Be(0,0,0,0);class tm extends em{constructor(e,t){const i=je()({tandem:Ft.REQUIRED},t);super(e,i),this.trackpadGestureStartScale=1,this.animatingProperty=new Wt(!1),this._transformTracker=null,this._focusBoundsListener=null,this.sourcePosition=null,this.destinationPosition=null,this.sourceScale=this.getCurrentScale(),this.destinationScale=this.getCurrentScale(),this.scaleGestureTargetPosition=null,this.discreteScales=N_(this._minScale,this._maxScale),this.middlePress=null,this._dragBounds=null,this._transformedPanBounds=this._panBounds.transformed(this._targetNode.matrix.inverted()),this._draggingInDragBounds=!1,this._attachedPointers=[],this.boundsFinite=!1;let n=null,r=null;this.gestureStartAction=new xt(p=>{assert&&assert(p.pageX,"pageX required on DOMEvent"),assert&&assert(p.pageY,"pageY required on DOMEvent"),assert&&assert(p.scale,"scale required on DOMEvent"),p.preventDefault(),this.trackpadGestureStartScale=p.scale,this.scaleGestureTargetPosition=new We(p.pageX,p.pageY)},{phetioPlayback:!0,tandem:i.tandem.createTandem("gestureStartAction"),parameters:[{name:"event",phetioType:rr}],phetioEventType:Nt.USER,phetioDocumentation:"Action that executes whenever a gesture starts on a trackpad in macOS Safari."}),this.gestureChangeAction=new xt(p=>{assert&&assert(p.scale,"scale required on DOMEvent"),p.preventDefault();const S=this.sourceScale+p.scale-this.trackpadGestureStartScale;this.setDestinationScale(S)},{phetioPlayback:!0,tandem:i.tandem.createTandem("gestureChangeAction"),parameters:[{name:"event",phetioType:rr}],phetioEventType:Nt.USER,phetioDocumentation:"Action that executes whenever a gesture changes on a trackpad in macOS Safari."}),_i.safari&&!_i.mobileSafari&&(n=this.handleGestureStartEvent.bind(this),r=this.handleGestureChangeEvent.bind(this),this.trackpadGestureStartScale=this.getCurrentScale(),self.addEventListener("gesturestart",n),self.addEventListener("gesturechange",r)),ys.keydownEmitter.addListener(this.windowKeydown.bind(this));const h=this.handleFocusChange.bind(this);jt.pdomFocusProperty.link(h),this.sourceFramePanBoundsProperty.lazyLink(()=>{pa.value&&(this.initializePositions(),this.sourceScale=this.getCurrentScale(),this.setDestinationScale(this.sourceScale))},{phetioDependencies:[this.matrixProperty]}),this.disposeAnimatedPanZoomListener=()=>{n&&self.removeEventListener("gesturestart",n),r&&self.removeEventListener("gestureChange",r),this.animatingProperty.dispose(),this._transformTracker&&this._transformTracker.dispose(),jt.pdomFocusProperty.unlink(h)}}step(e){this.middlePress&&this.handleMiddlePress(e),this._attachedPointers.length>0&&this.getCurrentScale()>1&&(this._attachedPointers.length>0&&(this._attachedPointers=this._attachedPointers.filter(t=>t.attachedListener),assert&&assert(this._attachedPointers.length<=10,"Not clearing attachedPointers, there is probably a memory leak")),(this._draggingInDragBounds||this._attachedPointers.some(t=>t instanceof ya))&&this.repositionDuringDrag()),this.animateToTargets(e)}down(e){super.down(e),this._dragBounds!==null&&e.pointer.hasIntent(Bi.DRAG)&&(this._attachedPointers.length===0&&(this._draggingInDragBounds=this._dragBounds.containsPoint(e.pointer.point)),e.pointer.attachedListener&&(this._attachedPointers.includes(e.pointer)||this._attachedPointers.push(e.pointer))),e.pointer.type==="mouse"&&e.pointer instanceof bs&&e.pointer.middleDown&&!this.middlePress?(this.middlePress=new M_(e.pointer,e.trail),e.pointer.cursor=Hp):this.cancelMiddlePress()}cancelMiddlePress(){this.middlePress&&(this.middlePress.pointer.cursor=null,this.middlePress=null,this.stopInProgressAnimation())}movePress(e){this.middlePress||super.movePress(e)}move(e){if(this._attachedPointers.length>0&&this.getCurrentScale()>1)if(this._draggingInDragBounds){if(!this._attachedPointers.includes(e.pointer)){const t=this.hasDragIntent(e.pointer);e.currentTarget!==null&&t&&e.pointer.attachedListener&&this._attachedPointers.push(e.pointer)}}else this._dragBounds&&(this._draggingInDragBounds=this._dragBounds.containsPoint(e.pointer.point))}getTargetNodeDuringDrag(){if(this._attachedPointers.length>0){const e=this._attachedPointers[0].attachedListener;if(assert&&assert(e,"The attached Pointer is expected to have an attached listener."),e.listener instanceof mn||e.listener instanceof Wp){const t=e.listener;if(t.isPressed)return t.getCurrentTarget()}}return null}getGlobalBoundsToViewDuringDrag(){let e=null;if(this._attachedPointers.length>0){const t=this._attachedPointers[0].attachedListener;if(assert&&assert(t,"The attached Pointer is expected to have an attached listener."),t.createPanTargetBounds)e=t.createPanTargetBounds();else if(t.listener instanceof mn||t.listener instanceof Wp){const i=t.listener;if(i.isPressed){const n=i.getCurrentTarget();if(n.instances.length===1){const r=n.instances[0].trail;assert&&assert(r,"The target should be in one scene graph and have an instance with a trail."),e=r.parentToGlobalBounds(n.visibleBounds)}}}}return e}repositionDuringDrag(){const e=this.getGlobalBoundsToViewDuringDrag(),t=this.getTargetNodeDuringDrag();e&&this.keepBoundsInView(e,this._attachedPointers.some(i=>i instanceof ya),t==null?void 0:t.limitPanDirection)}cancelPanningDuringDrag(e){if(e){const t=this._attachedPointers.indexOf(e.pointer);t>-1&&this._attachedPointers.splice(t,1)}else this._attachedPointers=[];this._draggingInDragBounds=!1}up(e){this.cancelPanningDuringDrag(e)}wheel(e){if(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener wheel"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),!this.middlePress){const t=new O_(e,this._targetScale);this.repositionFromWheel(t,e)}sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}windowKeydown(e){this.cancelMiddlePress();const t=_.get(self,"phet.joist.sim",null);if((!t||!t.display._accessible||!t.display.pdomRootElement.contains(e.target))&&(this.handleZoomCommands(e),me.isArrowKey(e))){const i=new Xh(ys,this.getCurrentScale(),this._targetScale);this.repositionFromKeys(i)}}keydown(e){const t=e.domEvent;assert&&assert(t instanceof KeyboardEvent,"keydown event must be a KeyboardEvent"),this.cancelMiddlePress(),this.handleZoomCommands(t);const i=e.pointer.hasIntent(Bi.KEYBOARD_DRAG);if(me.isArrowKey(t)&&!i){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener handle arrow key down"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const n=new Xh(ys,this.getCurrentScale(),this._targetScale);this.repositionFromKeys(n),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}}handleFocusChange(e,t){if(this._transformTracker&&(this._transformTracker.dispose(),this._transformTracker=null),t&&t.trail.lastNode()&&t.trail.lastNode().focusPanTargetBoundsProperty){const i=t.trail.lastNode().focusPanTargetBoundsProperty;assert&&assert(this._focusBoundsListener&&i.hasListener(this._focusBoundsListener),"Focus bounds listener should be linked to the previous Node"),i.unlink(this._focusBoundsListener),this._focusBoundsListener=null}if(e){const i=e.trail.lastNode();let n=e.trail;if(e.trail.containsNode(this._targetNode)){const h=e.trail.nodes.indexOf(this._targetNode),p=e.trail.nodes.length;n=e.trail.slice(h,p)}this._transformTracker=new kr(n);const r=()=>{if(this.getCurrentScale()>1){let h;if(i.focusPanTargetBoundsProperty){const p=i.focusPanTargetBoundsProperty.value;h=e.trail.localToGlobalBounds(p)}else h=e.trail.localToGlobalBounds(e.trail.lastNode().localBounds);this.keepBoundsInView(h,!0,i.limitPanDirection)}};this._transformTracker.addListener(r),i.focusPanTargetBoundsProperty&&(this._focusBoundsListener=r,i.focusPanTargetBoundsProperty.link(this._focusBoundsListener)),this.keepTrailInView(e.trail,i.limitPanDirection)}}handleZoomCommands(e){const t=Ar.isZoomCommand(e,!0),i=Ar.isZoomCommand(e,!1);if(t||i){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiPanZoomListener keyboard zoom in"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),e.preventDefault();const n=this.getNextDiscreteScale(t),r=new Xh(ys,n,this._targetScale);this.repositionFromKeys(r)}else Ar.isZoomResetCommand(e)&&(sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener keyboard reset"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push(),e.preventDefault(),this.resetTransform(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop())}handleGestureStartEvent(e){this.gestureStartAction.execute(e)}handleGestureChangeEvent(e){this.gestureChangeAction.execute(e)}handleMiddlePress(e){const t=this.middlePress;assert&&assert(t,"MiddlePress must be defined to handle");const i=this.sourcePosition;if(assert&&assert(i,"sourcePosition must be defined to handle middle press, be sure to call initializePositions"),e>0){const r=t.pointer.point.minus(t.initialPoint),h=r.magnitude/100;h>0&&(r.setMagnitude(Math.min(h/e,k_*this._targetScale)),this.setDestinationPosition(i.plus(r)))}}translateScaleToTarget(e,t){const i=this._targetNode.globalToLocalPoint(e),n=this._targetNode.globalToParentPoint(e),r=$e.translation(-i.x,-i.y),h=$e.translation(n.x,n.y),p=this.limitScale(this.getCurrentScale()+t),S=h.timesMatrix($e.scaling(p)).timesMatrix(r);this.matrixProperty.set(S),this.correctReposition()}setTranslationScaleToTarget(e,t){const i=this._targetNode.globalToLocalPoint(e),n=this._targetNode.globalToParentPoint(e),r=$e.translation(-i.x,-i.y),h=$e.translation(n.x,n.y),p=this.limitScale(t),S=h.timesMatrix($e.scaling(p)).timesMatrix(r);this.matrixProperty.set(S),this.correctReposition()}translateDelta(e){const t=this._targetNode.globalToParentPoint(this._panBounds.center),i=t.plus(e);this.translateToTarget(i,t)}translateToTarget(e,t){const i=this._targetNode.globalToParentPoint(e),r=this._targetNode.globalToParentPoint(t).minus(i);this.matrixProperty.set($e.translationFromVector(r).timesMatrix(this._targetNode.getMatrix())),this.correctReposition()}repositionFromKeys(e){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener reposition from key press"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const t=this.sourcePosition;assert&&assert(t,"sourcePosition must be defined to handle key press, be sure to call initializePositions");const i=e.scale,n=this.getCurrentScale();i!==n?(this.setDestinationScale(i),this.scaleGestureTargetPosition=e.computeScaleTargetFromKeyPress()):e.translationVector.equals(We.ZERO)||this.setDestinationPosition(t.plus(e.translationVector)),this.correctReposition(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}repositionFromWheel(e,t){sceneryLog&&sceneryLog.InputListener&&sceneryLog.InputListener("MultiListener reposition from wheel"),sceneryLog&&sceneryLog.InputListener&&sceneryLog.push();const i=t.domEvent;assert&&assert(i instanceof WheelEvent,"wheel event must be a WheelEvent");const n=this.sourcePosition;if(assert&&assert(n,"sourcePosition must be defined to handle wheel, be sure to call initializePositions"),i.preventDefault(),e.isCtrlKeyDown){const r=this.limitScale(this.getCurrentScale()+e.scaleDelta);this.scaleGestureTargetPosition=e.targetPoint,this.setDestinationScale(r)}else this.setDestinationPosition(n.plus(e.translationVector));this.correctReposition(),sceneryLog&&sceneryLog.InputListener&&sceneryLog.pop()}correctReposition(){super.correctReposition(),this._panBounds.isFinite()&&(this._transformedPanBounds=this._panBounds.transformed(this._targetNode.matrix.inverted()),this.sourcePosition=this._transformedPanBounds.center,this.sourceScale=this.getCurrentScale())}addPress(e){super.addPress(e),this.stopInProgressAnimation()}removePress(e){super.removePress(e),this.middlePress&&(e.pointer.cursor=Hp),this._presses.length===0&&this.stopInProgressAnimation()}interrupt(){this.cancelPanningDuringDrag(),this.cancelMiddlePress(),super.interrupt()}cancel(){this.interrupt()}hasDragIntent(e){return e.hasIntent(Bi.KEYBOARD_DRAG)||e.hasIntent(Bi.DRAG)}panToNode(e,t,i){assert&&assert(this._panBounds.isFinite(),"panBounds should be defined when panning."),this.keepBoundsInView(e.globalBounds,t,i)}keepBoundsInView(e,t,i){assert&&assert(this._panBounds.isFinite(),"panBounds should be defined when panning.");const n=this.sourcePosition;assert&&assert(n,"sourcePosition must be defined to handle keepBoundsInView, be sure to call initializePositions");const r=this._targetNode.globalToLocalBounds(e),h=new We(0,0);let p=0,S=0,C=0,B=0;if(t)p=this._transformedPanBounds.centerX-r.centerX,S=this._transformedPanBounds.centerX-r.centerX,C=this._transformedPanBounds.centerY-r.centerY,B=this._transformedPanBounds.centerY-r.centerY;else if((i==="vertical"||r.width<this._transformedPanBounds.width)&&(i==="horizontal"||r.height<this._transformedPanBounds.height)){const Q=150/this.getCurrentScale();p=this._transformedPanBounds.left-r.left+Q,S=this._transformedPanBounds.right-r.right-Q,C=this._transformedPanBounds.top-r.top+Q,B=this._transformedPanBounds.bottom-r.bottom-Q}i!=="vertical"&&(S<0&&(h.x=-S),p>0&&(h.x=-p)),i!=="horizontal"&&(B<0&&(h.y=-B),C>0&&(h.y=-C)),this.setDestinationPosition(n.plus(h))}keepTrailInView(e,t){if(this._panBounds.isFinite()&&e.lastNode().bounds.isFinite()){const i=e.localToGlobalBounds(e.lastNode().localBounds);this._panBounds.containsBounds(i)||this.keepBoundsInView(i,!0,t)}}animateToTargets(e){assert&&assert(this.boundsFinite,"initializePositions must be called at least once before animating");const t=this.sourcePosition;assert&&assert(t,"sourcePosition must be defined to animate, be sure to all initializePositions"),assert&&assert(t.isFinite(),"How can the source position not be a finite Vector2?");const i=this.destinationPosition;assert&&assert(i,"destinationPosition must be defined to animate, be sure to all initializePositions"),assert&&assert(i.isFinite(),"How can the destination position not be a finite Vector2?");const n=!i.equalsEpsilon(t,.1),r=!Ui.equalsEpsilon(this.sourceScale,this.destinationScale,.001);if(this.animatingProperty.value=n||r,this._presses.length===0||this.middlePress!==null){if(n){const h=i.minus(t);let p=h;h.magnitude!==0&&(p=h.normalized());const S=this.getTranslationSpeed(h.magnitude);Vp.setXY(S,S);const C=Vp.multiplyScalar(e),B=p.componentTimes(C);B.magnitude>h.magnitude&&B.set(h),assert&&assert(B.isFinite(),"Trying to translate with a non-finite Vector2"),this.translateDelta(B)}if(r){assert&&assert(this.scaleGestureTargetPosition,"there must be a scale target point");const h=this.destinationScale-this.sourceScale;let p=h*e*6;Math.abs(p)>Math.abs(h)&&(p=h),this.translateScaleToTarget(this.scaleGestureTargetPosition,p),this.setDestinationPosition(t)}else this.destinationScale!==this.sourceScale&&(assert&&assert(this.scaleGestureTargetPosition,"there must be a scale target point"),this.setTranslationScaleToTarget(this.scaleGestureTargetPosition,this.destinationScale),this.setDestinationPosition(t))}}stopInProgressAnimation(){this.boundsFinite&&this.sourcePosition&&(this.setDestinationScale(this.sourceScale),this.setDestinationPosition(this.sourcePosition))}initializePositions(){this.boundsFinite=this._transformedPanBounds.isFinite(),this.boundsFinite?(this.sourcePosition=this._transformedPanBounds.center,this.setDestinationPosition(this.sourcePosition)):(this.sourcePosition=null,this.destinationPosition=null)}setPanBounds(e){super.setPanBounds(e),this.initializePositions(),this._dragBounds=e.erodedXY(e.width*.1,e.height*.1),assert&&assert(this._dragBounds.hasNonzeroArea(),"drag bounds must have some width and height")}setTargetBounds(e){super.setTargetBounds(e),this.initializePositions()}setDestinationPosition(e){assert&&assert(this.boundsFinite,"bounds must be finite before setting destination positions"),assert&&assert(e.isFinite(),"provided destination position is not defined");const t=this.sourcePosition;assert&&assert(t,"sourcePosition must be defined to set destination position, be sure to call initializePositions"),Gp.setMinMax(t.x-this._transformedPanBounds.left-this._panBounds.left,t.y-this._transformedPanBounds.top-this._panBounds.top,t.x+this._panBounds.right-this._transformedPanBounds.right,t.y+this._panBounds.bottom-this._transformedPanBounds.bottom),this.destinationPosition=Gp.closestPointTo(e)}setDestinationScale(e){this.destinationScale=this.limitScale(e)}getTranslationSpeed(e){assert&&assert(e>=0,"distance for getTranslationSpeed should be a non-negative number");const t=e*this.getCurrentScale(),i=5,n=t*(1/(Math.pow(t,2)-Math.pow(i,2))+i);return Math.min(Math.abs(n),A_*this.getCurrentScale())}resetTransform(){super.resetTransform(),this.stopInProgressAnimation()}getNextDiscreteScale(e){const t=this.getCurrentScale();let i=null,n=Number.POSITIVE_INFINITY;for(let h=0;h<this.discreteScales.length;h++){const p=Math.abs(this.discreteScales[h]-t);p<n&&(n=p,i=h)}i=i,assert&&assert(i!==null,"nearestIndex should have been found");let r=e?i+1:i-1;return r=Ui.clamp(r,0,this.discreteScales.length-1),this.discreteScales[r]}dispose(){this.disposeAnimatedPanZoomListener()}}class Xh{constructor(e,t,i,n){const r=je()({translationMagnitude:80},n);let h=0;h+=e.isKeyDown(me.KEY_RIGHT_ARROW)?1:0,h-=e.isKeyDown(me.KEY_LEFT_ARROW)?1:0;let p=0;if(p+=e.isKeyDown(me.KEY_DOWN_ARROW)?1:0,p-=e.isKeyDown(me.KEY_UP_ARROW)?1:0,to.setXY(h,p),!to.equals(We.ZERO)){const S=r.translationMagnitude*i;to.setMagnitude(S)}this.translationVector=to,this.scale=t}computeScaleTargetFromKeyPress(){za.setXY(0,0);const e=jt.pdomFocusProperty.value;if(e){const t=e.trail,i=t.lastNode();i.bounds.isFinite()&&za.set(t.parentToGlobalPoint(i.center))}else{const t=dt.getNextFocusable();if(t!==document.body){assert&&assert(document.body.contains(t),"focusable should be attached to the body");const i=t.offsetLeft+t.offsetWidth/2,n=t.offsetTop+t.offsetHeight/2;za.setXY(i,n)}}return assert&&assert(za.isFinite(),"target position not defined"),za}}class O_{constructor(e,t){const i=e.domEvent;assert&&assert(i instanceof WheelEvent,"SceneryEvent should have a DOMEvent from the wheel input"),this.isCtrlKeyDown=i.ctrlKey,this.scaleDelta=i.deltaY>0?-.5:.5,this.targetPoint=e.pointer.point;let n=i.deltaX*.5,r=i.deltaY*.5;i.deltaMode===self.WheelEvent.DOM_DELTA_LINE&&(n=n*25,r=r*25),this.translationVector=to.setXY(n*t,r*t)}}class M_{constructor(e,t){assert&&assert(e.type==="mouse","incorrect pointer type"),this.pointer=e,this.trail=t,this.initialPoint=e.point.copy()}}const N_=(l,e)=>{assert&&assert(l>=1,"min scales less than one are currently not supported");const t=8,i=[];for(let r=0;r<t;r++)i[r]=(e-l)/t*(r*r);const n=i[t-1];for(let r=0;r<i.length;r++)i[r]=l+i[r]*(e-l)/n;return i};q.register("AnimatedPanZoomListener",tm);class R_{constructor(){this._listener=null}initialize(e,t){this._listener=new tm(e,t)}dispose(){assert&&assert(this._listener,"No listener, call initialize first."),this._listener.dispose(),this._listener=null}get listener(){return assert&&assert(this._listener,"No listener, call initialize first."),this._listener}get initialized(){return!!this._listener}}const im=new R_;q.register("animatedPanZoomSingleton",im);const zp=im;class B_{down(e){e.handle()}}q.register("HandleDownlistener",B_);class Lu extends Bo{constructor(e){const t=je()({fire:_.noop,press:_.noop,release:_.noop,focus:_.noop,blur:_.noop,fireOnDown:!0,fireOnHold:!1,fireOnHoldTiming:"browser",fireOnHoldCustomDelay:400,fireOnHoldCustomInterval:100,allowOverlap:!1,override:!0,ignoredModifierKeys:[],phetioEnabledPropertyInstrumented:!1},e);super(t),this._fire=t.fire,this._press=t.press,this._release=t.release,this._focus=t.focus,this._blur=t.blur,this.fireOnDown=t.fireOnDown,this.fireOnHold=t.fireOnHold,this.fireOnHoldTiming=t.fireOnHoldTiming,this.fireOnHoldCustomDelay=t.fireOnHoldCustomDelay,this.fireOnHoldCustomInterval=t.fireOnHoldCustomInterval,this.allowOverlap=t.allowOverlap,this.ignoredModifierKeys=t.ignoredModifierKeys,this.override=t.override,this.hotkeys=this.createHotkeys(t.keys),this.isPressedProperty=Jt.or(this.hotkeys.map(i=>i.isPressedProperty)),this.pressedKeysProperty=new ei([]),this.interrupted=!1,this.enabledProperty.lazyLink(this.onEnabledPropertyChange.bind(this))}get isPressed(){return this.isPressedProperty.value}onEnabledPropertyChange(e){!e&&this.interrupt()}dispose(){this.hotkeys.forEach(e=>e.dispose()),this.isPressedProperty.dispose(),this.pressedKeysProperty.dispose(),super.dispose()}keydown(e){e.pointer.reserveForKeyboardDrag()}focusout(e){this.interrupt(),this._blur(this)}focusin(e){this._focus(this)}cancel(){this.handleInterrupt()}interrupt(){this.handleInterrupt()}handleInterrupt(){this.hotkeys.forEach(e=>e.interrupt())}createSyntheticEvent(e){const t=ut.createSynthetic();return new rs(new ht,"synthetic",e,t)}createHotkeys(e){return e.map(t=>{const i=t.split("+"),n=i.slice(0,i.length-1),r=i[i.length-1],h=new Kf({key:r,modifierKeys:n,ignoredModifierKeys:this.ignoredModifierKeys,fire:p=>{this._fire(p,t,this)},press:p=>{this.interrupted=!1,this._press(p,t,this),assert&&assert(!this.pressedKeysProperty.value.includes(t),"Key already pressed"),this.pressedKeysProperty.value=[...this.pressedKeysProperty.value,t]},release:p=>{this.interrupted=h.interrupted,this._release(p,t,this),assert&&assert(this.pressedKeysProperty.value.includes(t),"Key not pressed"),this.pressedKeysProperty.value=this.pressedKeysProperty.value.filter(S=>S!==t)},fireOnDown:this.fireOnDown,fireOnHold:this.fireOnHold,fireOnHoldTiming:this.fireOnHoldTiming,fireOnHoldCustomDelay:this.fireOnHoldTiming==="custom"?this.fireOnHoldCustomDelay:void 0,fireOnHoldCustomInterval:this.fireOnHoldTiming==="custom"?this.fireOnHoldCustomInterval:void 0,allowOverlap:this.allowOverlap,enabledProperty:this.enabledProperty,override:this.override});return h})}static createGlobal(e,t){return new F_(e,t)}}class F_ extends Lu{constructor(e,t){const i=new hu(e,{followPDOMOrder:!0,requirePDOMVisible:!0,requireEnabled:!0,requireInputEnabled:!0}),n=new Jt([i],h=>h.length>0),r=je()({enabledProperty:n},t);super(r),this.displayedTrailsProperty=i,this.globallyEnabledProperty=n,this.hotkeys.forEach(h=>{Rc.add(h)})}dispose(){this.hotkeys.forEach(e=>{Rc.remove(e)}),this.globallyEnabledProperty.dispose(),this.displayedTrailsProperty.dispose(),super.dispose()}}q.register("KeyboardListener",Lu);const H_=["arrowLeft","arrowRight","arrowUp","arrowDown","w","a","s","d"],V_=["arrowLeft","arrowRight","a","d"],G_=["arrowUp","arrowDown","w","s"],z_=new Map([["both",H_],["leftRight",V_],["upDown",G_]]);class sm extends Lu{constructor(e){assert&&Hi(e,["dragSpeed","shiftDragSpeed"],["dragDelta","shiftDragDelta"]),assert&&Hi(e,["dragSpeed"],["moveOnHoldDelay","moveOnHoldInterval"]),assert&&Hi(e,["mapPosition"],["dragBoundsProperty"]),assert&&assert(!e||!e.dragBoundsProperty||e.positionProperty||e.translateNode,"If you provide a dragBoundsProperty, you must provide either a positionProperty or use translateNode.");const t=je()({dragDelta:10,shiftDragDelta:5,dragSpeed:0,shiftDragSpeed:0,keyboardDragDirection:"both",positionProperty:null,transform:null,dragBoundsProperty:null,mapPosition:null,translateNode:!1,start:null,drag:null,end:null,moveOnHoldDelay:500,moveOnHoldInterval:400,tandem:Ft.REQUIRED,phetioReadOnly:!0},e);assert&&assert(t.shiftDragSpeed<=t.dragSpeed,"shiftDragSpeed should be less than or equal to shiftDragSpeed, it is intended to provide more fine-grained control"),assert&&assert(t.shiftDragDelta<=t.dragDelta,"shiftDragDelta should be less than or equal to dragDelta, it is intended to provide more fine-grained control");const i=z_.get(t.keyboardDragDirection);assert&&assert(i,"Invalid keyboardDragDirection");const n=je()({keys:i,ignoredModifierKeys:["shift"]},t);super(n),this.leftKeyDownProperty=new vt(!1),this.rightKeyDownProperty=new vt(!1),this.upKeyDownProperty=new vt(!1),this.downKeyDownProperty=new vt(!1),this.startNextKeyboardEvent=!1,this.restartTimerNextKeyboardEvent=!1,this.modelDelta=new We(0,0),this.modelPoint=new We(0,0),this.vectorDelta=new We(0,0),this.pressedKeysProperty.link(p=>{this.leftKeyDownProperty.value=p.includes("arrowLeft")||p.includes("a"),this.rightKeyDownProperty.value=p.includes("arrowRight")||p.includes("d"),this.upKeyDownProperty.value=p.includes("arrowUp")||p.includes("w"),this.downKeyDownProperty.value=p.includes("arrowDown")||p.includes("s")}),this._start=t.start,this._drag=t.drag,this._end=t.end,this._dragBoundsProperty=t.dragBoundsProperty||new ei(null),this._mapPosition=t.mapPosition,this._translateNode=t.translateNode,this._transform=t.transform,this._positionProperty=t.positionProperty,this._dragSpeed=t.dragSpeed,this._shiftDragSpeed=t.shiftDragSpeed,this._dragDelta=t.dragDelta,this._shiftDragDelta=t.shiftDragDelta,this._moveOnHoldDelay=t.moveOnHoldDelay,this.useDragSpeed=t.dragSpeed>0||t.shiftDragSpeed>0,this.dragStartAction=new xt(p=>{this._start&&this._start(p,this),this.useDragSpeed&&this.callbackTimer.start()},{parameters:[{name:"event",phetioType:rs.SceneryEventIO}],tandem:t.tandem.createTandem("dragStartAction"),phetioDocumentation:"Emits whenever a keyboard drag starts.",phetioReadOnly:t.phetioReadOnly,phetioEventType:Nt.USER}),this.dragAction=new xt(()=>{if(assert&&assert(this.isPressedProperty.value,"The listener should not be dragging if not pressed"),t.transform){const p=t.transform instanceof Fs?t.transform:t.transform.value;this.modelDelta=p.inverseDelta2(this.vectorDelta)}else this.modelDelta=this.vectorDelta;if(this._translateNode){let p=this.getCurrentTarget().translation.plus(this.vectorDelta);p=this.mapModelPoint(p),this.getCurrentTarget().translation=p,this.modelPoint=this.parentToModelPoint(p)}if(this._positionProperty){let p=this._positionProperty.value.plus(this.modelDelta);p=this.mapModelPoint(p),this.modelPoint=p,p.equals(this._positionProperty.value)||(this._positionProperty.value=p)}if(this._drag){assert&&assert(this._pointer,"the pointer must be assigned at the start of a drag action");const p=this.createSyntheticEvent(this._pointer);this._drag(p,this)}},{parameters:[],tandem:t.tandem.createTandem("dragAction"),phetioDocumentation:"Emits every time there is some input from a keyboard drag.",phetioHighFrequency:!0,phetioReadOnly:t.phetioReadOnly,phetioEventType:Nt.USER}),this.dragEndAction=new xt(()=>{this.callbackTimer.stop(!1);const p=this._pointer?this.createSyntheticEvent(this._pointer):null;this._end&&this._end(p,this),this.clearPointer()},{parameters:[],tandem:t.tandem.createTandem("dragEndAction"),phetioDocumentation:"Emits whenever a keyboard drag ends.",phetioReadOnly:t.phetioReadOnly,phetioEventType:Nt.USER}),this._pointerListener={listener:this,interrupt:this.interrupt.bind(this)},this._pointer=null;const r=this.useDragSpeed?1e3/60:t.moveOnHoldInterval,h=this.useDragSpeed?0:t.moveOnHoldDelay;if(this.callbackTimer=new Zl({delay:h,callback:()=>{let p=0,S=0;const C=ys.shiftKeyDown;let B;this.useDragSpeed?B=r/1e3*(C?t.shiftDragSpeed:t.dragSpeed):B=C?t.shiftDragDelta:t.dragDelta,this.leftKeyDownProperty.value&&(p-=B),this.rightKeyDownProperty.value&&(p+=B),this.upKeyDownProperty.value&&(S-=B),this.downKeyDownProperty.value&&(S+=B);const U=new We(p,S);U.equals(We.ZERO)||(this.vectorDelta=U,this.dragAction.execute())},interval:r}),this.isPressedProperty.lazyLink(p=>{p?this.startNextKeyboardEvent=!0:(this.startNextKeyboardEvent=!1,this.restartTimerNextKeyboardEvent=!1,this.isDragging()&&this.dragEndAction.execute())}),!this.useDragSpeed){const p=S=>{S.link(C=>{C&&(this.restartTimerNextKeyboardEvent=!0)})};p(this.leftKeyDownProperty),p(this.rightKeyDownProperty),p(this.upKeyDownProperty),p(this.downKeyDownProperty)}this._disposeKeyboardDragListener=()=>{this.leftKeyDownProperty.dispose(),this.rightKeyDownProperty.dispose(),this.upKeyDownProperty.dispose(),this.downKeyDownProperty.dispose(),this.callbackTimer.dispose()}}parentToModelPoint(e){return this.transform?(this.transform instanceof Fs?this.transform:this.transform.value).inverseDelta2(e):e}localToParentPoint(e){return this.getCurrentTarget().localToParentPoint(e)}getDragBounds(){return this._dragBoundsProperty.value}get dragBounds(){return this.getDragBounds()}setTransform(e){this._transform=e}set transform(e){this.setTransform(e)}get transform(){return this.getTransform()}getTransform(){return this._transform}get dragSpeed(){return this._dragSpeed}set dragSpeed(e){this._dragSpeed=e}get shiftDragSpeed(){return this._shiftDragSpeed}set shiftDragSpeed(e){this._shiftDragSpeed=e}get dragDelta(){return this._dragDelta}set dragDelta(e){this._dragDelta=e}get shiftDragDelta(){return this._shiftDragDelta}set shiftDragDelta(e){this._shiftDragDelta=e}movingLeft(){return this.leftKeyDownProperty.value&&!this.rightKeyDownProperty.value}movingRight(){return this.rightKeyDownProperty.value&&!this.leftKeyDownProperty.value}movingUp(){return this.upKeyDownProperty.value&&!this.downKeyDownProperty.value}movingDown(){return this.downKeyDownProperty.value&&!this.upKeyDownProperty.value}getCurrentTarget(){return assert&&assert(this.isPressedProperty.value,"We have no currentTarget if we are not pressed"),assert&&assert(this._pointer&&this._pointer.trail,"Must have a Pointer with an active trail if we are pressed"),this._pointer.trail.lastNode()}isDragging(){return!!this._pointer&&this._pointer.attachedListener===this._pointerListener}keydown(e){super.keydown(e);const t=e.domEvent;if(!t.metaKey&&me.isMovementKey(t)){if(_i.safari&&this.pressedKeysProperty.value.length>1){this.interrupt();return}t.preventDefault(),this.startNextKeyboardEvent&&!e.pointer.isAttached()&&(assert&&assert(this._pointer===null,"Pointer should be null at the start of a drag action"),this._pointer=e.pointer,e.pointer.addInputListener(this._pointerListener,!0),this.dragStartAction.execute(e),this.startNextKeyboardEvent=!1),this.restartTimerNextKeyboardEvent&&this.isDragging()&&(this.callbackTimer.stop(!1),this.callbackTimer.start(),this._moveOnHoldDelay>0&&this.callbackTimer.fire(),this.restartTimerNextKeyboardEvent=!1)}}mapModelPoint(e){return this._mapPosition?this._mapPosition(e):this._dragBoundsProperty.value?this._dragBoundsProperty.value.closestPointTo(e):e}clearPointer(){this._pointer&&(assert&&assert(this._pointer.listeners.includes(this._pointerListener),"A reference to the Pointer means it should have the pointerListener"),this._pointer.removeInputListener(this._pointerListener),this._pointer=null)}dispose(){this.interrupt(),this._disposeKeyboardDragListener(),super.dispose()}}q.register("KeyboardDragListener",sm);const Wp=sm,W_=Ai(l=>(assert&&assert(_.includes(vs(l),mn),"Only PressListener subtypes should mix SpriteListenable"),class extends l{constructor(...e){super(...e),this.spriteInstance=null}press(e,t,i){if(this.isPressed)return!1;if(this.spriteInstance=null,e.currentTarget instanceof fu){const n=e.currentTarget;this.spriteInstance=n.getSpriteInstanceFromPoint(n.globalToLocalPoint(e.pointer.point))}return this.spriteInstance?super.press(e,t,i):!1}}));q.register("SpriteListenable",W_);const $_=.75,$p=.6;class U_{constructor(e){this._pointer=null,this.downPoint=null,this.downEvent=null,this.enabled=!1,this.lastPoint=null,this.currentPoint=null,this.velocity=null,this.swipeDistance=null,this.firstUp=!1,this.timeSinceLastDown=0,this.downPointers=[],this.holdingTime=0,this.focusedNode=null,this.handleEventListener={down:t=>{t.handle(),t.abort(),this.handleDown(t)}},e.pointerAddedEmitter.addListener(t=>{this.enabled&&t.addInputListener(this.handleEventListener,!0)}),this._attachedPointerListener={up:t=>{this.focusedNode&&this.focusedNode.swipeEnd&&this.focusedNode.swipeEnd.bind(this.focusedNode)(t,this),this.focusedNode=null,this._pointer.removeInputListener(this._attachedPointerListener),this._pointer=null},move:t=>{this.focusedNode&&this.focusedNode.swipeMove&&this.focusedNode.swipeMove.bind(this.focusedNode)(t,this)},interrupt:t=>{this.focusedNode=null,this._pointer.removeInputListener(this._attachedPointerListener),this._pointer=null},cancel:t=>{this.focusedNode=null,this._pointer.removeInputListener(this._attachedPointerListener),this._pointer=null}},this._pointerListener={up:t=>{this.endSwipe(),this._pointer=null,this.swipeDistance=t.pointer.point.minus(this.downPoint);const i=this.swipeDistance.y,n=this.swipeDistance.x;if(Math.abs(n)>100&&Math.abs(i)<100)if(n>0){if(jt.pdomFocusedNode&&jt.pdomFocusedNode.innerContent==="Reset All")return;dt.getNextFocusable(document.body).focus()}else dt.getPreviousFocusable(document.body).focus();else if(this.firstUp){if(this.timeSinceLastDown<$p){this.firstUp=!1,this.timeSinceLastDown=0;const r=document.getElementsByClassName("a11y-pdom-root")[0];r&&r.contains(t.activeElement)&&t.activeElement.click()}}else this.firstUp=!0},move:t=>{this.lastPoint=this.currentPoint,this.currentPoint=t.pointer.point},interrupt:()=>{this.interrupt()},cancel:()=>{this.interrupt()}},Gi.addListener(this.step.bind(this))}handleDown(e){e.pointer.addIntent(Bi.DRAG),this.downPointers.push(e.pointer),this.downPointers.length>1&&(this.downPointers.forEach(t=>t.removeIntent(Bi.DRAG)),e.pointer.removeIntent(Bi.DRAG)),assert&&assert(e.pointer.attachedProperty.get(),"should be attached to the handle listener"),e.pointer.removeInputListener(this.handleEventListener),this._pointer===null&&e.pointer.type==="touch"&&(this._pointer=e.pointer,e.pointer.addInputListener(this._pointerListener,!0),e.abort(),this.downEvent=e,this.downPoint=e.pointer.point,this.currentPoint=this.downPoint.copy(),this.previousPoint=this.currentPoint.copy())}up(e){const t=this.downPointers.indexOf(e.pointer);t>-1&&this.downPointers.splice(t,1)}step(e){if(this.firstUp&&(this.timeSinceLastDown+=e,this.timeSinceLastDown>$p&&(this.firstUp=!1,this.timeSinceLastDown=0)),this._pointer&&!this._pointer.listeners.includes(this._attachedPointerListener))if(this.holdingTime>$_){const t=jt.pdomFocusedNode;t&&(this._pointer.removeInputListener(this._pointerListener),this.holdingTime=0,this.focusedNode=t,this._pointer.addInputListener(this._attachedPointerListener,!0),this.focusedNode.swipeStart&&this.focusedNode.swipeStart(this.downEvent,this),this.downEvent=null)}else this.holdingTime+=e;this.lastPoint!==null&&this.currentPoint!==null&&(this.velocity=this.lastPoint.minus(this.currentPoint).dividedScalar(e))}endSwipe(){this.holdingTime=0,this._pointer&&this._pointer.listeners.includes(this._pointerListener)&&this._pointer.removeInputListener(this._pointerListener)}detachPointerListener(){this._pointer.detach(this._attachedPointerListener)}interrupt(){this.endSwipe(),this._pointer=null,this.downEvent=null}}q.register("SwipeListener",U_);const Hc=["left","right","center","origin"],Vc=["top","bottom","center","origin"],gs=class gs extends Mr{constructor(e,t,i=Number.POSITIVE_INFINITY){super(),this.horizontal=e,this.vertical=t,this.padRatio=i}static getAllowedAligns(e){return[...e===ot.HORIZONTAL?Hc:Vc,null]}static alignToInternal(e,t){return e===ot.HORIZONTAL?gs.horizontalAlignToInternal(t):gs.verticalAlignToInternal(t)}static horizontalAlignToInternal(e){return e===null?null:(assert&&assert(Up[e]),Up[e])}static verticalAlignToInternal(e){return e===null?null:(assert&&assert(Yp[e]),Yp[e])}static internalToAlign(e,t){return t===null?null:e===ot.HORIZONTAL?t.horizontal:t.vertical}};gs.START=new gs("left","top",0),gs.END=new gs("right","bottom",1),gs.CENTER=new gs("center","center",.5),gs.ORIGIN=new gs("origin","origin"),gs.enumeration=new Nr(gs,{phetioDocumentation:"Alignment for layout containers"});let Zt=gs;const Up={left:Zt.START,right:Zt.END,center:Zt.CENTER,origin:Zt.ORIGIN},Yp={top:Zt.START,bottom:Zt.END,center:Zt.CENTER,origin:Zt.ORIGIN};q.register("LayoutAlign",Zt);const Y_=["left","right","center","spaceBetween","spaceAround","spaceEvenly"],K_=["top","bottom","center","spaceBetween","spaceAround","spaceEvenly"],is=class is extends Mr{constructor(e,t,i){super(),this.spacingFunctionFactory=e,this.horizontal=t,this.vertical=i}static getAllowedJustificationValues(e){return e===ot.HORIZONTAL?Y_:K_}static justifyToInternal(e,t){return e===ot.HORIZONTAL?(assert&&assert(Kp[t]),Kp[t]):(assert&&assert(jp[t]),jp[t])}static internalToJustify(e,t){return e===ot.HORIZONTAL?t.horizontal:t.vertical}};is.START=new is(()=>()=>0,"left","top"),is.END=new is(e=>t=>t===0?e:0,"right","bottom"),is.CENTER=new is(e=>t=>t===0?e/2:0,"center","center"),is.SPACE_BETWEEN=new is((e,t)=>i=>i!==0?e/(t-1):0,"spaceBetween","spaceBetween"),is.SPACE_AROUND=new is((e,t)=>i=>(i!==0?2:1)*e/(2*t),"spaceAround","spaceAround"),is.SPACE_EVENLY=new is((e,t)=>i=>e/(t+1),"spaceEvenly","spaceEvenly"),is.enumeration=new Nr(is,{phetioDocumentation:"Justify for layout containers"});let oi=is;const Kp={left:oi.START,right:oi.END,center:oi.CENTER,spaceBetween:oi.SPACE_BETWEEN,spaceAround:oi.SPACE_AROUND,spaceEvenly:oi.SPACE_EVENLY},jp={top:oi.START,bottom:oi.END,center:oi.CENTER,spaceBetween:oi.SPACE_BETWEEN,spaceAround:oi.SPACE_AROUND,spaceEvenly:oi.SPACE_EVENLY};q.register("LayoutJustification",oi);const j_={stretch:!0,isSeparator:!0};class Pu extends An{constructor(e){super(En()({},{layoutOptions:j_,stroke:"rgb(100,100,100)"},e))}}q.register("Separator",Pu);class nm extends pu(Pu){constructor(e){super(),this.localPreferredHeightProperty.link(t=>{t!==null&&(this.y2=t)}),this.mutate(e)}}q.register("VSeparator",nm);class rm extends Ul(Pu){constructor(e){super(),this.localPreferredWidthProperty.link(t=>{t!==null&&(this.x2=t)}),this.mutate(e)}}q.register("HSeparator",rm);const mo=class mo{constructor(e){this.initialize(e)}initialize(e){return this.trail=e,this}checkPreconditions(){assert&&assert(this.trail,"Should not be disposed"),assert&&assert(this.trail.getParentMatrix().isAxisAligned(),"Transforms with LayoutProxy need to be axis-aligned")}get node(){return assert&&this.checkPreconditions(),this.trail.lastNode()}get bounds(){return assert&&this.checkPreconditions(),this.trail.parentToGlobalBounds(this.node.bounds)}get visibleBounds(){return assert&&this.checkPreconditions(),this.trail.parentToGlobalBounds(this.node.visibleBounds)}get width(){return this.bounds.width}get height(){return this.bounds.height}get x(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformX(this.node.x)}set x(e){assert&&this.checkPreconditions(),this.node.x=this.trail.getParentTransform().inverseX(e)}get y(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformY(this.node.y)}set y(e){assert&&this.checkPreconditions(),this.node.y=this.trail.getParentTransform().inverseY(e)}get translation(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.translation)}set translation(e){assert&&this.checkPreconditions(),this.node.translation=this.trail.getParentTransform().inversePosition2(e)}get left(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformX(this.node.left)}set left(e){this.node.left=this.trail.getParentTransform().inverseX(e)}get right(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformX(this.node.right)}set right(e){assert&&this.checkPreconditions(),this.node.right=this.trail.getParentTransform().inverseX(e)}get centerX(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformX(this.node.centerX)}set centerX(e){assert&&this.checkPreconditions(),this.node.centerX=this.trail.getParentTransform().inverseX(e)}get top(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformY(this.node.top)}set top(e){assert&&this.checkPreconditions(),this.node.top=this.trail.getParentTransform().inverseY(e)}get bottom(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformY(this.node.bottom)}set bottom(e){assert&&this.checkPreconditions(),this.node.bottom=this.trail.getParentTransform().inverseY(e)}get centerY(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformY(this.node.centerY)}set centerY(e){assert&&this.checkPreconditions(),this.node.centerY=this.trail.getParentTransform().inverseY(e)}get leftTop(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.leftTop)}set leftTop(e){assert&&this.checkPreconditions(),this.node.leftTop=this.trail.getParentTransform().inversePosition2(e)}get centerTop(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.centerTop)}set centerTop(e){assert&&this.checkPreconditions(),this.node.centerTop=this.trail.getParentTransform().inversePosition2(e)}get rightTop(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.rightTop)}set rightTop(e){assert&&this.checkPreconditions(),this.node.rightTop=this.trail.getParentTransform().inversePosition2(e)}get leftCenter(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.leftCenter)}set leftCenter(e){assert&&this.checkPreconditions(),this.node.leftCenter=this.trail.getParentTransform().inversePosition2(e)}get center(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.center)}set center(e){assert&&this.checkPreconditions(),this.node.center=this.trail.getParentTransform().inversePosition2(e)}get rightCenter(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.rightCenter)}set rightCenter(e){assert&&this.checkPreconditions(),this.node.rightCenter=this.trail.getParentTransform().inversePosition2(e)}get leftBottom(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.leftBottom)}set leftBottom(e){assert&&this.checkPreconditions(),this.node.leftBottom=this.trail.getParentTransform().inversePosition2(e)}get centerBottom(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.centerBottom)}set centerBottom(e){assert&&this.checkPreconditions(),this.node.centerBottom=this.trail.getParentTransform().inversePosition2(e)}get rightBottom(){return assert&&this.checkPreconditions(),this.trail.getParentTransform().transformPosition2(this.node.rightBottom)}set rightBottom(e){assert&&this.checkPreconditions(),this.node.rightBottom=this.trail.getParentTransform().inversePosition2(e)}get widthSizable(){return this.node.widthSizable}get heightSizable(){return this.node.heightSizable}get preferredWidth(){assert&&this.checkPreconditions(),assert&&assert(aa(this.node));const e=this.node.preferredWidth;return e===null?null:Math.abs(this.trail.getParentTransform().transformDeltaX(e))}set preferredWidth(e){assert&&this.checkPreconditions(),assert&&assert(aa(this.node)),this.node.preferredWidth=e===null?null:Math.abs(this.trail.getParentTransform().inverseDeltaX(e))}get preferredHeight(){assert&&this.checkPreconditions(),assert&&assert(oa(this.node));const e=this.node.preferredHeight;return e===null?null:Math.abs(this.trail.getParentTransform().transformDeltaY(e))}set preferredHeight(e){assert&&this.checkPreconditions(),assert&&assert(oa(this.node)),this.node.preferredHeight=e===null?null:Math.abs(this.trail.getParentTransform().inverseDeltaY(e))}get minimumWidth(){assert&&this.checkPreconditions();const e=aa(this.node)?this.node.minimumWidth||0:this.node.width;return Math.abs(this.trail.getParentTransform().transformDeltaX(e))}get minimumHeight(){assert&&this.checkPreconditions();const e=oa(this.node)?this.node.minimumHeight||0:this.node.height;return Math.abs(this.trail.getParentTransform().transformDeltaY(e))}getMinimum(e){return e===ot.HORIZONTAL?this.minimumWidth:this.minimumHeight}get maxWidth(){return assert&&this.checkPreconditions(),this.node.maxWidth===null?null:Math.abs(this.trail.getParentTransform().transformDeltaX(this.node.maxWidth))}set maxWidth(e){assert&&this.checkPreconditions(),this.node.maxWidth=e===null?null:Math.abs(this.trail.getParentTransform().inverseDeltaX(e))}get maxHeight(){return assert&&this.checkPreconditions(),this.node.maxHeight===null?null:Math.abs(this.trail.getParentTransform().transformDeltaY(this.node.maxHeight))}set maxHeight(e){assert&&this.checkPreconditions(),this.node.maxHeight=e===null?null:Math.abs(this.trail.getParentTransform().inverseDeltaY(e))}getMax(e){return e===ot.HORIZONTAL?this.maxWidth:this.maxHeight}get visible(){return this.node.visible}set visible(e){this.node.visible=e}dispose(){this.trail=null,this.freeToPool()}freeToPool(){mo.pool.freeToPool(this)}};mo.pool=new cs(mo,{maxSize:1e3});let Oo=mo;q.register("LayoutProxy",Oo);class am extends Gg{constructor(e,t,i){const n=new yf(e,t);super([n],h=>h.length===1?Oo.pool.create(h[0].copy().removeAncestor()):null),this.transformTracker=null,this.trailsBetweenProperty=n,this.lazyLink((h,p)=>{p&&p.dispose()});const r=i==null?void 0:i.onTransformChange;r&&this.link(h=>{this.transformTracker&&(this.transformTracker.dispose(),this.transformTracker=null),h&&(this.transformTracker=new kr(h.trail.copy().addAncestor(e)),this.transformTracker.addListener(r))})}dispose(){this.trailsBetweenProperty.dispose(),this.transformTracker&&this.transformTracker.dispose(),super.dispose()}}q.register("LayoutProxyProperty",am);class Fo{constructor(e){this._layoutLockCount=0,this._layoutAttemptDuringLock=!1,this._enabled=!0,this._listenedNodes=new Set,this.finishedLayoutEmitter=new zt,this.ancestorNode=e,this._updateLayoutListener=this.updateLayoutAutomatically.bind(this)}addNode(e,t=!0){assert&&assert(!this._listenedNodes.has(e)),assert&&assert(!t||!e._activeParentLayoutConstraint,"This node is already managed by a layout container - make sure to wrap it in a Node if DAG, removing it from an old layout container, etc."),t&&(e._activeParentLayoutConstraint=this),e.boundsProperty.lazyLink(this._updateLayoutListener),e.visibleProperty.lazyLink(this._updateLayoutListener),ep(e)&&(e.minimumWidthProperty.lazyLink(this._updateLayoutListener),e.isWidthResizableProperty.lazyLink(this._updateLayoutListener)),tp(e)&&(e.minimumHeightProperty.lazyLink(this._updateLayoutListener),e.isHeightResizableProperty.lazyLink(this._updateLayoutListener)),this._listenedNodes.add(e)}removeNode(e){assert&&assert(this._listenedNodes.has(e)),e._activeParentLayoutConstraint===this&&(e._activeParentLayoutConstraint=null),e.boundsProperty.unlink(this._updateLayoutListener),e.visibleProperty.unlink(this._updateLayoutListener),ep(e)&&(e.minimumWidthProperty.unlink(this._updateLayoutListener),e.isWidthResizableProperty.unlink(this._updateLayoutListener)),tp(e)&&(e.minimumHeightProperty.unlink(this._updateLayoutListener),e.isHeightResizableProperty.unlink(this._updateLayoutListener)),this._listenedNodes.delete(e)}layout(){}get isLocked(){return this._layoutLockCount>0}lock(){this._layoutLockCount++}unlock(){this._layoutLockCount--}validateLocalPreferredWidth(e){assert&&e.localBounds.isFinite()&&!this._layoutAttemptDuringLock&&e.validateLocalPreferredWidth()}validateLocalPreferredHeight(e){assert&&e.localBounds.isFinite()&&!this._layoutAttemptDuringLock&&e.validateLocalPreferredHeight()}validateLocalPreferredSize(e){assert&&e.localBounds.isFinite()&&!this._layoutAttemptDuringLock&&e.validateLocalPreferredSize()}updateLayout(){let e=0;if(this.isLocked)assert&&e++,assert&&assert(++e<500,"Likely infinite loop detected, are we triggering layout within the layout?"),this._layoutAttemptDuringLock=!0;else{this.lock();do this._layoutAttemptDuringLock=!1,this.layout();while(this._layoutAttemptDuringLock);this.unlock()}}updateLayoutAutomatically(){this._enabled&&this.updateLayout()}createLayoutProxy(e){const t=e.getTrails(i=>i===this.ancestorNode);return t.length===1?Oo.pool.create(t[0].removeAncestor()):null}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e,this.updateLayoutAutomatically())}dispose(){const e=[...this._listenedNodes.keys()];for(let t=0;t<e.length;t++)this.removeNode(e[t]);this.finishedLayoutEmitter.dispose()}}q.register("LayoutConstraint",Fo);class Ql{constructor(e,t,i){i?(this.layoutProxyProperty=null,this._proxy=i):(this._proxy=null,this.layoutProxyProperty=new am(e.ancestorNode,t,{onTransformChange:()=>e.updateLayoutAutomatically()}),this.layoutProxyProperty.link(n=>{this._proxy=n,e.updateLayoutAutomatically()})),this._constraint=e,this._node=t,this.layoutOptionsListener=this.onLayoutOptionsChange.bind(this),this.node.layoutOptionsChangedEmitter.addListener(this.layoutOptionsListener)}onLayoutOptionsChange(){}get node(){return this._node}isConnected(){return this._proxy!==null}get proxy(){return assert&&assert(this._proxy),this._proxy}isSizable(e){return e===ot.HORIZONTAL?this.proxy.widthSizable:this.proxy.heightSizable}dispose(){this.layoutProxyProperty&&this.layoutProxyProperty.dispose(),this.node.layoutOptionsChangedEmitter.removeListener(this.layoutOptionsListener)}}q.register("LayoutCell",Ql);class Ho extends Ql{constructor(e,t,i){super(e,t,i),this.preferredSizeSet=new wr(!1,!1),this.lastAvailableBounds=Be.NOTHING.copy(),this.lastUsedBounds=Be.NOTHING.copy(),this._marginConstraint=e}reposition(e,t,i,n,r,h){const p=n&&this.isSizable(e)?t:this.getMinimumSize(e);if(assert){const C=e===ot.HORIZONTAL?this.node.maxWidth:this.node.maxHeight;assert(!this.isSizable(e)||C===null||Math.abs(C-p)>-1e-9,`Tried to set a preferred size ${p} larger than the specified max${e===ot.HORIZONTAL?"Width":"Height"} of ${C}. Ideally, try to avoid putting a maxWidth/maxHeight on a width/height-sizable Node (one that will resize to fit its preferred size) inside a layout container, particularly one that will try to expand the Node past its maximum size.`)}this.attemptPreferredSize(e,p),h===Zt.ORIGIN?this.positionOrigin(e,i+r):this.positionStart(e,i+(t-this.getCellBounds()[e.size])*h.padRatio);const S=this.getCellBounds();return assert&&assert(S.isFinite()),this.lastAvailableBounds[e.minCoordinate]=i,this.lastAvailableBounds[e.maxCoordinate]=i+t,this.lastUsedBounds.set(S),S}get effectiveLeftMargin(){return this._leftMargin!==null?this._leftMargin:this._marginConstraint._leftMargin}get effectiveRightMargin(){return this._rightMargin!==null?this._rightMargin:this._marginConstraint._rightMargin}get effectiveTopMargin(){return this._topMargin!==null?this._topMargin:this._marginConstraint._topMargin}get effectiveBottomMargin(){return this._bottomMargin!==null?this._bottomMargin:this._marginConstraint._bottomMargin}getEffectiveMinMargin(e){return e===ot.HORIZONTAL?this.effectiveLeftMargin:this.effectiveTopMargin}getEffectiveMaxMargin(e){return e===ot.HORIZONTAL?this.effectiveRightMargin:this.effectiveBottomMargin}get effectiveMinContentWidth(){return this._minContentWidth!==null?this._minContentWidth:this._marginConstraint._minContentWidth}get effectiveMinContentHeight(){return this._minContentHeight!==null?this._minContentHeight:this._marginConstraint._minContentHeight}getEffectiveMinContent(e){return e===ot.HORIZONTAL?this.effectiveMinContentWidth:this.effectiveMinContentHeight}get effectiveMaxContentWidth(){return this._maxContentWidth!==null?this._maxContentWidth:this._marginConstraint._maxContentWidth}get effectiveMaxContentHeight(){return this._maxContentHeight!==null?this._maxContentHeight:this._marginConstraint._maxContentHeight}getEffectiveMaxContent(e){return e===ot.HORIZONTAL?this.effectiveMaxContentWidth:this.effectiveMaxContentHeight}getMinimumSize(e){return this.getEffectiveMinMargin(e)+Math.max(this.proxy.getMinimum(e),this.getEffectiveMinContent(e)||0)+this.getEffectiveMaxMargin(e)}getMaximumSize(e){return this.getEffectiveMinMargin(e)+(this.getEffectiveMaxContent(e)||Number.POSITIVE_INFINITY)+this.getEffectiveMaxMargin(e)}attemptPreferredSize(e,t){if(this.proxy[e.sizable]){const i=this.getMinimumSize(e),n=this.getMaximumSize(e);assert&&assert(isFinite(i)),assert&&assert(n>=i),t=Ui.clamp(t,i,n);let r=t-this.getEffectiveMinMargin(e)-this.getEffectiveMaxMargin(e);const h=this.proxy.getMax(e);h!==null&&(r=Math.min(h,r)),this._marginConstraint.setProxyPreferredSize(e,this.proxy,r),this.preferredSizeSet.set(e,!0)}}unsetPreferredSize(e){this.proxy[e.sizable]&&this._marginConstraint.setProxyPreferredSize(e,this.proxy,null)}positionStart(e,t){const i=this.getEffectiveMinMargin(e)+t;this._marginConstraint.setProxyMinSide(e,this.proxy,i)}positionOrigin(e,t){this._marginConstraint.setProxyOrigin(e,this.proxy,t)}getOriginBounds(){return this.getCellBounds().shiftedXY(-this.proxy.x,-this.proxy.y)}getCellBounds(){return this.proxy.bounds.withOffsets(this.effectiveLeftMargin,this.effectiveTopMargin,this.effectiveRightMargin,this.effectiveBottomMargin)}dispose(){ot.enumeration.values.forEach(e=>{this.preferredSizeSet.get(e)&&this.unsetPreferredSize(e)}),super.dispose()}static createHelperNode(e,t,i){const n=new Ge,r=.4,h=yt.union(e.map(Q=>yt.bounds(Q.lastAvailableBounds))),p=yt.union(e.map(Q=>yt.bounds(Q.lastUsedBounds))),S=yt.union(e.map(Q=>yt.bounds(Q.proxy.bounds))),C=yt.bounds(t).shapeDifference(h),B=h.shapeDifference(p),U=p.shapeDifference(S),k=(Q,X,g)=>{const Z=new Vi(Q,{font:new ki({size:6,family:"monospace"}),fill:X}),ce=vi.bounds(Z.bounds,{fill:g,children:[Z]});return new lf(ce,4,Math.floor(ce.left),Math.ceil(ce.top+1),Math.floor(ce.width),Math.floor(ce.height-2),$e.rotation2(-Math.PI/4))};return n.addChild(new mi(C,{fill:k("spacing","#000","#fff"),opacity:.6})),n.addChild(new mi(B,{fill:k("empty","#aaa","#000"),opacity:.6})),n.addChild(new mi(U,{fill:k("margin","#600","#f00"),opacity:.6})),n.addChild(vi.bounds(t,{stroke:"white",lineDash:[2,2],lineDashOffset:2,lineWidth:r})),n.addChild(vi.bounds(t,{stroke:"black",lineDash:[2,2],lineWidth:r})),e.forEach(Q=>{n.addChild(vi.bounds(Q.getCellBounds(),{stroke:"rgba(0,255,0,1)",lineWidth:r}))}),e.forEach(Q=>{n.addChild(vi.bounds(Q.proxy.bounds,{stroke:"rgba(255,0,0,1)",lineWidth:r}))}),e.forEach(Q=>{const X=Q.getCellBounds(),g=new mn({tandem:Ft.OPT_OUT});n.addChild(vi.bounds(X,{inputListeners:[g]}));let Z=i(Q);Q.effectiveLeftMargin&&(Z+=`leftMargin: ${Q.effectiveLeftMargin}
`),Q.effectiveRightMargin&&(Z+=`rightMargin: ${Q.effectiveRightMargin}
`),Q.effectiveTopMargin&&(Z+=`topMargin: ${Q.effectiveTopMargin}
`),Q.effectiveBottomMargin&&(Z+=`bottomMargin: ${Q.effectiveBottomMargin}
`),Q.effectiveMinContentWidth&&(Z+=`minContentWidth: ${Q.effectiveMinContentWidth}
`),Q.effectiveMinContentHeight&&(Z+=`minContentHeight: ${Q.effectiveMinContentHeight}
`),Q.effectiveMaxContentWidth&&(Z+=`maxContentWidth: ${Q.effectiveMaxContentWidth}
`),Q.effectiveMaxContentHeight&&(Z+=`maxContentHeight: ${Q.effectiveMaxContentHeight}
`),Z+=`layoutOptions: ${JSON.stringify(Q.node.layoutOptions,null,2).replace(/ /g,"&nbsp;")}
`;const ce=new Mn(Z.trim().replace(/\n/g,"<br>"),{font:new ki({size:12})}),ye=vi.bounds(ce.bounds.dilated(3),{fill:"rgba(255,255,255,0.8)",children:[ce],leftTop:X.leftTop});n.addChild(ye),g.isOverProperty.link(Oe=>{ye.visible=Oe})}),n}}q.register("MarginLayoutCell",Ho);const om=["resize","layoutOrigin"];class Su extends Yl(Ge){constructor(e){super(e),this.layoutOriginProperty=new by(We.ZERO)}linkLayoutBounds(){this._constraint.layoutBoundsProperty.link(e=>{this.localBounds=e})}setExcludeInvisibleChildrenFromBounds(e){super.setExcludeInvisibleChildrenFromBounds(e),this._constraint.excludeInvisible=e}setChildren(e){if(this.constraint.isLocked)return super.setChildren(e);const t=this.getChildren();return this.constraint.lock(),super.setChildren(e),this.constraint.unlock(),_.isEqual(t,e)||this.constraint.updateLayoutAutomatically(),this}updateLayout(){this._constraint.updateLayout()}get resize(){return this._constraint.enabled}set resize(e){this._constraint.enabled=e}get layoutOrigin(){return this.layoutOriginProperty.value}set layoutOrigin(e){this.layoutOriginProperty.value=e}get constraint(){return this._constraint}dispose(){this._constraint.dispose(),super.dispose()}}q.register("LayoutNode",Su);class wu{initializeLayoutLine(){this.min=0,this.max=Number.POSITIVE_INFINITY,this.minOrigin=Number.POSITIVE_INFINITY,this.maxOrigin=Number.NEGATIVE_INFINITY,this.size=0,this.position=0}hasOrigin(){return isFinite(this.minOrigin)&&isFinite(this.maxOrigin)}}q.register("LayoutLine",wu);const qp=1e-9;class Cu extends Fo{constructor(e,t){const i=je()({preferredWidthProperty:new vt(null),preferredHeightProperty:new vt(null),minimumWidthProperty:new vt(null),minimumHeightProperty:new vt(null),layoutOriginProperty:new vt(We.ZERO)},t);super(e),this._excludeInvisible=!0,this.layoutBoundsProperty=new ei(Be.NOTHING,{valueComparisonStrategy:"equalsFunction"}),this.preferredWidthProperty=i.preferredWidthProperty,this.preferredHeightProperty=i.preferredHeightProperty,this.minimumWidthProperty=i.minimumWidthProperty,this.minimumHeightProperty=i.minimumHeightProperty,this.layoutOriginProperty=i.layoutOriginProperty,this.preferredWidthProperty.lazyLink(this._updateLayoutListener),this.preferredHeightProperty.lazyLink(this._updateLayoutListener),this.layoutOriginProperty.lazyLink(this._updateLayoutListener)}filterLayoutCells(e){return assert&&assert(_.every(e,t=>!t.node.isDisposed),"A cell's node should not be disposed when layout happens"),e.filter(t=>t.isConnected()&&t.proxy.bounds.isValid()&&(!this.excludeInvisible||t.node.visible))}get excludeInvisible(){return this._excludeInvisible}set excludeInvisible(e){this._excludeInvisible!==e&&(this._excludeInvisible=e,this.updateLayoutAutomatically())}setProxyPreferredSize(e,t,i){t[e.preferredSize]=i}setProxyMinSide(e,t,i){Math.abs(t[e.minSide]-i)>qp&&(t[e.minSide]=i)}setProxyOrigin(e,t,i){Math.abs(t[e.coordinate]-i)>qp&&(t[e.coordinate]=i)}dispose(){this.preferredWidthProperty.unlink(this._updateLayoutListener),this.preferredHeightProperty.unlink(this._updateLayoutListener),this.layoutOriginProperty.unlink(this._updateLayoutListener),super.dispose()}}q.register("NodeLayoutConstraint",Cu);const lm=["margin","xMargin","yMargin","leftMargin","rightMargin","topMargin","bottomMargin","minContentWidth","minContentHeight","maxContentWidth","maxContentHeight"],Tu=Ai(l=>class extends l{constructor(...t){super(...t),this._leftMargin=null,this._rightMargin=null,this._topMargin=null,this._bottomMargin=null,this._minContentWidth=null,this._minContentHeight=null,this._maxContentWidth=null,this._maxContentHeight=null,this.changedEmitter=new zt}mutateConfigurable(t){Hi(t,["margin"],["xMargin","yMargin"]),Hi(t,["xMargin"],["leftMargin","rightMargin"]),Hi(t,["yMargin"],["topMargin","bottomMargin"])}setConfigToBaseDefault(){this._leftMargin=0,this._rightMargin=0,this._topMargin=0,this._bottomMargin=0,this._minContentWidth=null,this._minContentHeight=null,this._maxContentWidth=null,this._maxContentHeight=null,this.changedEmitter.emit()}setConfigToInherit(t){(!t||t.leftMargin===void 0)&&(this._leftMargin=null),(!t||t.rightMargin===void 0)&&(this._rightMargin=null),(!t||t.topMargin===void 0)&&(this._topMargin=null),(!t||t.bottomMargin===void 0)&&(this._bottomMargin=null),(!t||t.minContentWidth===void 0)&&(this._minContentWidth=null),(!t||t.minContentHeight===void 0)&&(this._minContentHeight=null),(!t||t.maxContentWidth===void 0)&&(this._maxContentWidth=null),(!t||t.maxContentHeight===void 0)&&(this._maxContentHeight=null),this.changedEmitter.emit()}get leftMargin(){return this._leftMargin}set leftMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),this._leftMargin!==t&&(this._leftMargin=t,this.changedEmitter.emit())}get rightMargin(){return this._rightMargin}set rightMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),this._rightMargin!==t&&(this._rightMargin=t,this.changedEmitter.emit())}get topMargin(){return this._topMargin}set topMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),this._topMargin!==t&&(this._topMargin=t,this.changedEmitter.emit())}get bottomMargin(){return this._bottomMargin}set bottomMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),this._bottomMargin!==t&&(this._bottomMargin=t,this.changedEmitter.emit())}get xMargin(){return assert&&assert(this._leftMargin===this._rightMargin),this._leftMargin}set xMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),(this._leftMargin!==t||this._rightMargin!==t)&&(this._leftMargin=t,this._rightMargin=t,this.changedEmitter.emit())}get yMargin(){return assert&&assert(this._topMargin===this._bottomMargin),this._topMargin}set yMargin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),(this._topMargin!==t||this._bottomMargin!==t)&&(this._topMargin=t,this._bottomMargin=t,this.changedEmitter.emit())}get margin(){return assert&&assert(this._leftMargin===this._rightMargin&&this._leftMargin===this._topMargin&&this._leftMargin===this._bottomMargin),this._topMargin}set margin(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)),(this._leftMargin!==t||this._rightMargin!==t||this._topMargin!==t||this._bottomMargin!==t)&&(this._leftMargin=t,this._rightMargin=t,this._topMargin=t,this._bottomMargin=t,this.changedEmitter.emit())}get minContentWidth(){return this._minContentWidth}set minContentWidth(t){this._minContentWidth!==t&&(this._minContentWidth=t,this.changedEmitter.emit())}get minContentHeight(){return this._minContentHeight}set minContentHeight(t){this._minContentHeight!==t&&(this._minContentHeight=t,this.changedEmitter.emit())}get maxContentWidth(){return this._maxContentWidth}set maxContentWidth(t){this._maxContentWidth!==t&&(this._maxContentWidth=t,this.changedEmitter.emit())}get maxContentHeight(){return this._maxContentHeight}set maxContentHeight(t){this._maxContentHeight!==t&&(this._maxContentHeight=t,this.changedEmitter.emit())}});q.register("MarginLayoutConfigurable",Tu);const Du=["orientation","align","stretch","grow"].concat(lm),Iu=Ai(l=>class extends Tu(l){constructor(...t){super(...t),this._orientation=ot.HORIZONTAL,this._align=null,this._stretch=null,this._grow=null,this.orientationChangedEmitter=new zt}mutateConfigurable(t){super.mutateConfigurable(t),No(this,Du,t)}setConfigToBaseDefault(){this._align=Zt.CENTER,this._stretch=!1,this._grow=0,super.setConfigToBaseDefault()}setConfigToInherit(t){(!t||t.align===void 0)&&(this._align=null),(!t||t.stretch===void 0)&&(this._stretch=null),(!t||t.grow===void 0)&&(this._grow=null),super.setConfigToInherit(t)}get orientation(){return this._orientation===ot.HORIZONTAL?"horizontal":"vertical"}set orientation(t){assert&&assert(t==="horizontal"||t==="vertical");const i=t==="horizontal"?ot.HORIZONTAL:ot.VERTICAL;this._orientation!==i&&(this._orientation=i,this.orientationChangedEmitter.emit(),this.changedEmitter.emit())}get align(){const t=Zt.internalToAlign(this._orientation,this._align);return assert&&assert(t===null||typeof t=="string"),t}set align(t){assert&&assert(Zt.getAllowedAligns(this._orientation.opposite).includes(t),`align ${t} not supported, with the orientation ${this._orientation}, the valid values are ${Zt.getAllowedAligns(this._orientation.opposite)}`);const i=Zt.alignToInternal(this._orientation.opposite,t);assert&&assert(i===null||i instanceof Zt),this._align!==i&&(this._align=i,this.changedEmitter.emit())}get stretch(){return this._stretch}set stretch(t){this._stretch!==t&&(this._stretch=t,this.changedEmitter.emit())}get grow(){return this._grow}set grow(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)&&t>=0),this._grow!==t&&(this._grow=t,this.changedEmitter.emit())}});q.register("FlowConfigurable",Iu);const q_=[...Du,"isSeparator"];class hm extends Iu(Ho){constructor(e,t,i){super(e,t,i),this.size=0,this._isSeparator=!1,this.flowConstraint=e,this.orientation=e.orientation,this.onLayoutOptionsChange()}get effectiveAlign(){return this._align!==null?this._align:this.flowConstraint._align}get effectiveStretch(){return this._stretch!==null?this._stretch:this.flowConstraint._stretch}get effectiveGrow(){return this._grow!==null?this._grow:this.flowConstraint._grow}onLayoutOptionsChange(){this.node.layoutOptions&&this.setOptions(this.node.layoutOptions),super.onLayoutOptionsChange()}setOptions(e){const t=je()({isSeparator:!1},e);assert&&Object.keys(t).forEach(i=>{assert&&assert(q_.includes(i),`Cannot provide key ${i} to a FlowCell's layoutOptions. Perhaps this is a Grid-style layout option?`)}),this._isSeparator=t.isSeparator,this.setConfigToInherit(t),this.mutateConfigurable(t)}}q.register("FlowCell",hm);const yo=class yo extends wu{constructor(e,t){super(),this.initialize(e,t)}initialize(e,t){return this.orientation=e,this.cells=t,this.initializeLayoutLine(),this}getMinimumSize(e){return(this.cells.length-1)*e+_.sum(this.cells.map(t=>t.getMinimumSize(this.orientation)))}freeToPool(){yo.pool.freeToPool(this)}clean(){this.cells.length=0,this.freeToPool()}};yo.pool=new cs(yo,{defaultArguments:[ot.HORIZONTAL,[]]});let ha=yo;q.register("FlowLine",ha);const cm=[...Du,"spacing","lineSpacing","justify","justifyLines","wrap","excludeInvisible"];class Jl extends Iu(Cu){constructor(e,t){super(e,t),this.cells=[],this._justify=oi.SPACE_BETWEEN,this._justifyLines=null,this._wrap=!1,this._spacing=0,this._lineSpacing=0,this.displayedCells=[],this.setConfigToBaseDefault(),this.mutateConfigurable(t),No(this,cm,t),this.changedEmitter.addListener(this._updateLayoutListener),this.orientationChangedEmitter.addListener(()=>this.cells.forEach(i=>{i.orientation=this.orientation}))}updateSeparatorVisibility(){let e=0;for(;e<this.cells.length;e++){const i=this.cells[e];if(i._isSeparator)i.node.visible=!1;else if(i.node.visible)break}let t=!1;for(let i=this.cells.length-1;i>e;i--){const n=this.cells[i];n._isSeparator?(n.node.visible=t,t=!1):n.node.visible&&(t=!0)}}layout(){super.layout();const e=this._orientation,t=this._orientation.opposite;this.updateSeparatorVisibility();const i=this.filterLayoutCells(this.cells);if(this.displayedCells=i,!i.length){this.layoutBoundsProperty.value=Be.NOTHING,this.minimumWidthProperty.value=null,this.minimumHeightProperty.value=null;return}let n=this.getPreferredProperty(e).value;const r=this.getPreferredProperty(t).value,h=Math.max(...i.map(fe=>fe.getMinimumSize(e)||0));h>(n||Number.POSITIVE_INFINITY)&&(n=h);const p=[];if(this.wrap){let fe=[],Fe=n||Number.POSITIVE_INFINITY;for(;i.length;){const Se=i.shift(),ze=Se.getMinimumSize(e);fe.length===0?(fe.push(Se),Fe-=ze):this.spacing+ze<=Fe+1e-7?(fe.push(Se),Fe-=this.spacing+ze):(p.push(ha.pool.create(e,fe)),Fe=n||Number.POSITIVE_INFINITY,fe=[Se],Fe-=ze)}fe.length&&p.push(ha.pool.create(e,fe))}else p.push(ha.pool.create(e,i));p.forEach(fe=>{fe.cells.forEach(Fe=>{if(fe.min=Math.max(fe.min,Fe.getMinimumSize(t)),fe.max=Math.min(fe.max,Fe.getMaximumSize(t)),Fe.effectiveAlign===Zt.ORIGIN){const Se=Fe.getOriginBounds();fe.minOrigin=Math.min(Se[t.minCoordinate],fe.minOrigin),fe.maxOrigin=Math.max(Se[t.maxCoordinate],fe.maxOrigin)}}),isFinite(fe.minOrigin)&&isFinite(fe.maxOrigin)?fe.size=Math.max(fe.min,fe.maxOrigin-fe.minOrigin):fe.size=fe.min});const S=Math.max(...p.map(fe=>fe.getMinimumSize(this.spacing))),C=_.sum(p.map(fe=>fe.size))+(p.length-1)*this.lineSpacing,B=this.wrap?h:S,U=Math.max(S,n||0),k=Math.max(C,r||0),Q=this.layoutOriginProperty.value[e.coordinate],X=this.layoutOriginProperty.value[e.opposite.coordinate];p.forEach(fe=>{const Fe=_.sum(fe.cells.map(Te=>Te.getMinimumSize(e))),Se=this.spacing*(fe.cells.length-1);let ze=U-Fe-Se;fe.cells.forEach(Te=>{Te.size=Te.getMinimumSize(e)});let Re;for(;ze>1e-7&&(Re=fe.cells.filter(Te=>Te.effectiveGrow!==0&&Te.size<Te.getMaximumSize(e)-1e-7)).length;){const Te=_.sum(Re.map(Ce=>Ce.effectiveGrow)),ft=Math.min(Math.min(...Re.map(Ce=>(Ce.getMaximumSize(e)-Ce.size)/Ce.effectiveGrow)),ze/Te);assert&&assert(ft>1e-11),Re.forEach(Ce=>{Ce.size+=ft*Ce.effectiveGrow}),ze-=ft*Te}fe.cells.forEach(Te=>Te.attemptPreferredSize(e,Te.size));const Ke=this._justify.spacingFunctionFactory(ze,fe.cells.length);let Ze=Q;fe.cells.forEach((Te,ft)=>{Ze+=Ke(ft),ft>0&&(Ze+=this.spacing),Te.positionStart(e,Ze),Te.lastAvailableBounds[e.minCoordinate]=Ze,Te.lastAvailableBounds[e.maxCoordinate]=Ze+Te.size,Ze+=Te.size,assert&&assert(this.spacing>=0||Te.size>=-this.spacing-1e-7,"Negative spacing more than a cell's size causes issues with layout")})});const g=k-C,Z=(p[0].hasOrigin()?p[0].minOrigin:0)+X;let ce=Z;if(this._justifyLines===null)p.forEach(fe=>{fe.size+=g/p.length}),p.forEach(fe=>{fe.position=ce,ce+=fe.size+this.lineSpacing});else{const fe=this._justifyLines.spacingFunctionFactory(g,p.length);p.forEach((Fe,Se)=>{ce+=fe(Se),Fe.position=ce,ce+=Fe.size+this.lineSpacing})}p.forEach(fe=>fe.cells.forEach(Fe=>{Fe.reposition(t,fe.size,fe.position,Fe.effectiveStretch,-fe.minOrigin,Fe.effectiveAlign)}));const ye=Q,Oe=Q+U,de=Z,se=Z+k;this.layoutBoundsProperty.value=Be.oriented(e,ye,de,Oe,se),this.minimumWidthProperty.value=e===ot.HORIZONTAL?B:C,this.minimumHeightProperty.value=e===ot.HORIZONTAL?C:B,this.finishedLayoutEmitter.emit(),p.forEach(fe=>fe.clean())}get justify(){const e=oi.internalToJustify(this._orientation,this._justify);return assert&&assert(oi.getAllowedJustificationValues(this._orientation).includes(e)),e}set justify(e){assert&&assert(oi.getAllowedJustificationValues(this._orientation).includes(e),`justify ${e} not supported, with the orientation ${this._orientation}, the valid values are ${oi.getAllowedJustificationValues(this._orientation)}`);const t=oi.justifyToInternal(this._orientation,e);this._justify!==t&&(this._justify=t,this.updateLayoutAutomatically())}get justifyLines(){if(this._justifyLines===null)return null;{const e=oi.internalToJustify(this._orientation,this._justifyLines);return assert&&assert(oi.getAllowedJustificationValues(this._orientation).includes(e)),e}}set justifyLines(e){assert&&assert(e===null||oi.getAllowedJustificationValues(this._orientation.opposite).includes(e),`justify ${e} not supported, with the orientation ${this._orientation.opposite}, the valid values are ${oi.getAllowedJustificationValues(this._orientation.opposite)} or null`);const t=e===null?null:oi.justifyToInternal(this._orientation.opposite,e);assert&&assert(t===null||t instanceof oi),this._justifyLines!==t&&(this._justifyLines=t,this.updateLayoutAutomatically())}get wrap(){return this._wrap}set wrap(e){this._wrap!==e&&(this._wrap=e,this.updateLayoutAutomatically())}get spacing(){return this._spacing}set spacing(e){assert&&assert(isFinite(e)),this._spacing!==e&&(this._spacing=e,this.updateLayoutAutomatically())}get lineSpacing(){return this._lineSpacing}set lineSpacing(e){assert&&assert(isFinite(e)),this._lineSpacing!==e&&(this._lineSpacing=e,this.updateLayoutAutomatically())}insertCell(e,t){assert&&assert(e>=0),assert&&assert(e<=this.cells.length),assert&&assert(!_.includes(this.cells,t)),t.orientation=this.orientation,this.cells.splice(e,0,t),this.addNode(t.node),t.changedEmitter.addListener(this._updateLayoutListener),this.updateLayoutAutomatically()}removeCell(e){assert&&assert(_.includes(this.cells,e)),Vs(this.cells,e),this.removeNode(e.node),e.changedEmitter.removeListener(this._updateLayoutListener),this.updateLayoutAutomatically()}reorderCells(e,t,i){this.cells.splice(t,i-t+1,...e),this.updateLayoutAutomatically()}getPreferredProperty(e){return e===ot.HORIZONTAL?this.preferredWidthProperty:this.preferredHeightProperty}dispose(){this.lock(),this.cells.forEach(e=>this.removeCell(e)),this.displayedCells=[],super.dispose(),this.unlock()}static create(e,t){return new Jl(e,t)}}q.register("FlowConstraint",Jl);const X_=[...om,...cm.filter(l=>l!=="excludeInvisible")],Wa={orientation:"horizontal",spacing:0,align:"center",stretch:!1},dd=class dd extends Su{constructor(e){const t=je()({excludeInvisibleChildrenFromBounds:!0,resize:!0,disabledOpacity:Qn.DISABLED_OPACITY},e);super(),this._cellMap=new Map,this._constraint=new Jl(this,{preferredWidthProperty:this.localPreferredWidthProperty,preferredHeightProperty:this.localPreferredHeightProperty,minimumWidthProperty:this.localMinimumWidthProperty,minimumHeightProperty:this.localMinimumHeightProperty,layoutOriginProperty:this.layoutOriginProperty,orientation:Wa.orientation,spacing:Wa.spacing,align:Wa.align,stretch:Wa.stretch,excludeInvisible:!1}),this.onChildInserted=this.onFlowBoxChildInserted.bind(this),this.onChildRemoved=this.onFlowBoxChildRemoved.bind(this),this.onChildrenReordered=this.onFlowBoxChildrenReordered.bind(this),this.onChildrenChanged=this.onFlowBoxChildrenChanged.bind(this),this.childInsertedEmitter.addListener(this.onChildInserted),this.childRemovedEmitter.addListener(this.onChildRemoved),this.childrenReorderedEmitter.addListener(this.onChildrenReordered),this.childrenChangedEmitter.addListener(this.onChildrenChanged);const i=_.omit(t,kn),n=_.pick(t,kn);this._constraint.lock(),this.mutate(i),this._constraint.unlock(),this._constraint.updateLayout(),this.mutate(n),this.linkLayoutBounds()}onFlowBoxChildInserted(e,t){const i=new hm(this._constraint,e,this._constraint.createLayoutProxy(e));this._cellMap.set(e,i),this._constraint.insertCell(t,i)}onFlowBoxChildRemoved(e){const t=this._cellMap.get(e);assert&&assert(t),this._cellMap.delete(e),this._constraint.removeCell(t),t.dispose()}onFlowBoxChildrenReordered(e,t){this._constraint.reorderCells(this._children.slice(e,t+1).map(i=>this._cellMap.get(i)),e,t)}onFlowBoxChildrenChanged(){this._constraint.updateLayoutAutomatically()}getCell(e){const t=this._cellMap.get(e);return assert&&assert(t),t}get orientation(){return this._constraint.orientation}set orientation(e){this._constraint.orientation=e}get spacing(){return this._constraint.spacing}set spacing(e){this._constraint.spacing=e}get lineSpacing(){return this._constraint.lineSpacing}set lineSpacing(e){this._constraint.lineSpacing=e}get justify(){return this._constraint.justify}set justify(e){this._constraint.justify=e}get justifyLines(){return this._constraint.justifyLines}set justifyLines(e){this._constraint.justifyLines=e}get wrap(){return this._constraint.wrap}set wrap(e){this._constraint.wrap=e}get align(){return assert&&assert(typeof this._constraint.align=="string"),this._constraint.align}set align(e){this._constraint.align=e}get stretch(){return assert&&assert(typeof this._constraint.stretch=="boolean"),this._constraint.stretch}set stretch(e){this._constraint.stretch=e}get grow(){return this._constraint.grow}set grow(e){this._constraint.grow=e}get margin(){return this._constraint.margin}set margin(e){this._constraint.margin=e}get xMargin(){return this._constraint.xMargin}set xMargin(e){this._constraint.xMargin=e}get yMargin(){return this._constraint.yMargin}set yMargin(e){this._constraint.yMargin=e}get leftMargin(){return this._constraint.leftMargin}set leftMargin(e){this._constraint.leftMargin=e}get rightMargin(){return this._constraint.rightMargin}set rightMargin(e){this._constraint.rightMargin=e}get topMargin(){return this._constraint.topMargin}set topMargin(e){this._constraint.topMargin=e}get bottomMargin(){return this._constraint.bottomMargin}set bottomMargin(e){this._constraint.bottomMargin=e}get minContentWidth(){return this._constraint.minContentWidth}set minContentWidth(e){this._constraint.minContentWidth=e}get minContentHeight(){return this._constraint.minContentHeight}set minContentHeight(e){this._constraint.minContentHeight=e}get maxContentWidth(){return this._constraint.maxContentWidth}set maxContentWidth(e){this._constraint.maxContentWidth=e}get maxContentHeight(){return this._constraint.maxContentHeight}set maxContentHeight(e){this._constraint.maxContentHeight=e}dispose(){this._constraint.lock(),this.childInsertedEmitter.removeListener(this.onChildInserted),this.childRemovedEmitter.removeListener(this.onChildRemoved),this.childrenReorderedEmitter.removeListener(this.onChildrenReordered),this.childrenChangedEmitter.removeListener(this.onChildrenChanged);for(const e of this._cellMap.values())e.dispose();super.dispose()}setOrientation(e){return this.orientation=e,this}getOrientation(){return this.orientation}setSpacing(e){return this.spacing=e,this}getSpacing(){return this.spacing}setAlign(e){return this.align=e,this}getAlign(){return this.align}setResize(e){return this.resize=e,this}isResize(){return this.resize}getHelperNode(){return Ho.createHelperNode(this.constraint.displayedCells,this.constraint.layoutBoundsProperty.value,t=>{let i="";const n=ot.fromLayoutOrientation(t.orientation);return i+=`align: ${Zt.internalToAlign(n,t.effectiveAlign)}
`,i+=`stretch: ${t.effectiveStretch}
`,i+=`grow: ${t.effectiveGrow}
`,i})}mutate(e){return super.mutate(e)}};dd.DEFAULT_FLOW_BOX_OPTIONS=Wa;let ba=dd;ba.prototype._mutatorKeys=[...mf,...X_,...Ge.prototype._mutatorKeys];q.register("FlowBox",ba);const xu=["xAlign","yAlign","stretch","xStretch","yStretch","grow","xGrow","yGrow"].concat(lm),Eu=Ai(l=>class extends Tu(l){constructor(...t){super(...t),this._xAlign=null,this._yAlign=null,this._xStretch=null,this._yStretch=null,this._xGrow=null,this._yGrow=null}mutateConfigurable(t){super.mutateConfigurable(t),Hi(t,["stretch"],["xStretch","yStretch"]),Hi(t,["grow"],["xGrow","yGrow"]),No(this,xu,t)}setConfigToBaseDefault(){this._xAlign=Zt.CENTER,this._yAlign=Zt.CENTER,this._xStretch=!1,this._yStretch=!1,this._xGrow=0,this._yGrow=0,super.setConfigToBaseDefault()}setConfigToInherit(t){(!t||t.xAlign===void 0)&&(this._xAlign=null),(!t||t.yAlign===void 0)&&(this._yAlign=null),(!t||t.stretch===void 0&&t.xStretch===void 0)&&(this._xStretch=null),(!t||t.stretch===void 0&&t.yStretch===void 0)&&(this._yStretch=null),(!t||t.grow===void 0&&t.xGrow===void 0)&&(this._xGrow=null),(!t||t.grow===void 0&&t.yGrow===void 0)&&(this._yGrow=null),super.setConfigToInherit(t)}get xAlign(){const t=this._xAlign===null?null:this._xAlign.horizontal;return assert&&assert(t===null||typeof t=="string"),t}set xAlign(t){assert&&assert(t===null||Hc.includes(t),`align ${t} not supported, the valid values are ${Hc} or null`);const i=Zt.horizontalAlignToInternal(t);assert&&assert(i===null||i instanceof Zt),this._xAlign!==i&&(this._xAlign=i,this.changedEmitter.emit())}get yAlign(){const t=this._yAlign===null?null:this._yAlign.vertical;return assert&&assert(t===null||typeof t=="string"),t}set yAlign(t){assert&&assert(t===null||Vc.includes(t),`align ${t} not supported, the valid values are ${Vc} or null`);const i=Zt.verticalAlignToInternal(t);assert&&assert(i===null||i instanceof Zt),this._yAlign!==i&&(this._yAlign=i,this.changedEmitter.emit())}get grow(){return assert&&assert(this._xGrow===this._yGrow),this._xGrow}set grow(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)&&t>=0),(this._xGrow!==t||this._yGrow!==t)&&(this._xGrow=t,this._yGrow=t,this.changedEmitter.emit())}get xGrow(){return this._xGrow}set xGrow(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)&&t>=0),this._xGrow!==t&&(this._xGrow=t,this.changedEmitter.emit())}get yGrow(){return this._yGrow}set yGrow(t){assert&&assert(t===null||typeof t=="number"&&isFinite(t)&&t>=0),this._yGrow!==t&&(this._yGrow=t,this.changedEmitter.emit())}get stretch(){return assert&&assert(this._xStretch===this._yStretch),this._xStretch}set stretch(t){assert&&assert(t===null||typeof t=="boolean"),(this._xStretch!==t||this._yStretch!==t)&&(this._xStretch=t,this._yStretch=t,this.changedEmitter.emit())}get xStretch(){return this._xStretch}set xStretch(t){assert&&assert(t===null||typeof t=="boolean"),this._xStretch!==t&&(this._xStretch=t,this.changedEmitter.emit())}get yStretch(){return this._yStretch}set yStretch(t){assert&&assert(t===null||typeof t=="boolean"),this._yStretch!==t&&(this._yStretch=t,this.changedEmitter.emit())}});q.register("GridConfigurable",Eu);const Z_=[...xu,"row","column","horizontalSpan","verticalSpan"];class um extends Eu(Ho){constructor(e,t,i){super(e,t,i),this.gridConstraint=e,this.setOptions(t.layoutOptions),this.onLayoutOptionsChange()}get effectiveXAlign(){return this._xAlign!==null?this._xAlign:this.gridConstraint._xAlign}get effectiveYAlign(){return this._yAlign!==null?this._yAlign:this.gridConstraint._yAlign}getEffectiveAlign(e){return e===ot.HORIZONTAL?this.effectiveXAlign:this.effectiveYAlign}get effectiveXGrow(){return this._xGrow!==null?this._xGrow:this.gridConstraint._xGrow}get effectiveYGrow(){return this._yGrow!==null?this._yGrow:this.gridConstraint._yGrow}getEffectiveGrow(e){return e===ot.HORIZONTAL?this.effectiveXGrow:this.effectiveYGrow}get effectiveXStretch(){return this._xStretch!==null?this._xStretch:this.gridConstraint._xStretch}get effectiveYStretch(){return this._yStretch!==null?this._yStretch:this.gridConstraint._yStretch}getEffectiveStretch(e){return e===ot.HORIZONTAL?this.effectiveXStretch:this.effectiveYStretch}onLayoutOptionsChange(){this.setOptions(this.node.layoutOptions),super.onLayoutOptionsChange()}setOptions(e){const t=je()({column:0,row:0,horizontalSpan:1,verticalSpan:1},e);assert&&Object.keys(t).forEach(i=>{assert&&assert(Z_.includes(i),`Cannot provide key ${i} to a GridCell's layoutOptions. Perhaps this is a Flow-style layout option?`)}),assert&&assert(typeof t.column=="number"&&Number.isInteger(t.column)&&isFinite(t.column)&&t.column>=0),assert&&assert(typeof t.row=="number"&&Number.isInteger(t.row)&&isFinite(t.row)&&t.row>=0),assert&&assert(typeof t.horizontalSpan=="number"&&Number.isInteger(t.horizontalSpan)&&isFinite(t.horizontalSpan)&&t.horizontalSpan>=1),assert&&assert(typeof t.verticalSpan=="number"&&Number.isInteger(t.verticalSpan)&&isFinite(t.verticalSpan)&&t.verticalSpan>=1),this.setConfigToInherit(t),this.position=new wr(t.column,t.row),this.size=new wr(t.horizontalSpan,t.verticalSpan),this.mutateConfigurable(t)}containsIndex(e,t){const i=this.position.get(e),n=this.size.get(e);return t>=i&&t<i+n}containsRow(e){return this.containsIndex(ot.VERTICAL,e)}containsColumn(e){return this.containsIndex(ot.HORIZONTAL,e)}getIndices(e){const t=this.position.get(e),i=this.size.get(e);return _.range(t,t+i)}}q.register("GridCell",um);const bo=class bo extends wu{constructor(e,t,i){super(),this.initialize(e,t,i)}initialize(e,t,i){return this.index=e,this.cells=t,this.grow=i,this.initializeLayoutLine(),this}freeToPool(){bo.pool.freeToPool(this)}clean(){this.cells.length=0,this.freeToPool()}};bo.pool=new cs(bo,{defaultArguments:[0,[],0]});let Tl=bo;q.register("GridLine",Tl);const dm=[...xu,"excludeInvisible","spacing","xSpacing","ySpacing"];class eh extends Eu(Cu){constructor(e,t){super(e,t),this.cells=new Set,this.displayedCells=[],this.displayedLines=new wr(new Map,new Map),this._spacing=new wr(0,0),this.setConfigToBaseDefault(),this.mutateConfigurable(t),No(this,dm,t),this.changedEmitter.addListener(this._updateLayoutListener)}layout(){super.layout();const e=this.filterLayoutCells([...this.cells]);if(this.displayedCells=e,!e.length){this.layoutBoundsProperty.value=Be.NOTHING,this.minimumWidthProperty.value=null,this.minimumHeightProperty.value=null,this.displayedLines.forEach(r=>r.clear());return}const t=new wr(0,0),i=new wr(this.preferredWidthProperty.value,this.preferredHeightProperty.value),n=new Be(0,0,0,0);[ot.HORIZONTAL,ot.VERTICAL].forEach(r=>{const h=this._spacing.get(r),p=this.displayedLines.get(r);p.forEach(Z=>Z.clean()),p.clear();const C=_.sortedUniq(_.sortBy(_.flatten(e.map(Z=>Z.getIndices(r))))).map(Z=>{const ce=_.filter(e,de=>de.containsIndex(r,Z)),ye=Math.max(...ce.map(de=>de.getEffectiveGrow(r))),Oe=Tl.pool.create(Z,ce,ye);return p.set(Z,Oe),Oe}),B=C.slice(0,-1).map(Z=>typeof h=="number"?h:h[Z.index]);e.forEach(Z=>{if(Z.size.get(r)===1){const ce=p.get(Z.position.get(r));if(ce.min=Math.max(ce.min,Z.getMinimumSize(r)),ce.max=Math.min(ce.max,Z.getMaximumSize(r)),Z.getEffectiveAlign(r)===Zt.ORIGIN){const ye=Z.getOriginBounds();ce.minOrigin=Math.min(ye[r.minCoordinate],ce.minOrigin),ce.maxOrigin=Math.max(ye[r.maxCoordinate],ce.maxOrigin)}}}),e.forEach(Z=>{if(Z.size.get(r)>1){assert&&assert(Z.getEffectiveAlign(r)!==Zt.ORIGIN,"origin alignment cannot be specified for cells that span >1 width or height");const ce=Z.getIndices(r).map(de=>p.get(de)),ye=_.sum(ce.map(de=>de.min)),Oe=Z.getMinimumSize(r);if(Oe>ye){const de=(Oe-ye)/ce.length;ce.forEach(se=>{se.min+=de})}}}),C.forEach(Z=>{Z.hasOrigin()?Z.size=Math.max(Z.min,Z.maxOrigin-Z.minOrigin):Z.size=Z.min});const U=_.sum(C.map(Z=>Z.size))+_.sum(B);t.set(r,U);const k=Math.max(U,i.get(r)||0);let Q=k-U,X;for(;Q>1e-7&&(X=C.filter(Z=>Z.grow>0&&Z.size<Z.max-1e-7)).length;){const Z=_.sum(X.map(ye=>ye.grow)),ce=Math.min(Math.min(...X.map(ye=>(ye.max-ye.size)/ye.grow)),Q/Z);assert&&assert(ce>1e-11),X.forEach(ye=>{ye.size+=ce*ye.grow}),Q-=ce*Z}const g=(C[0].hasOrigin()?C[0].minOrigin:0)+this.layoutOriginProperty.value[r.coordinate];n[r.minCoordinate]=g,n[r.maxCoordinate]=g+k,C.forEach((Z,ce)=>{const ye=_.sum(C.slice(0,ce).map(de=>de.size)),Oe=_.sum(B.slice(0,ce));Z.position=g+ye+Oe}),e.forEach(Z=>{const ce=Z.position.get(r),ye=Z.size.get(r),Oe=ce+ye-1,de=Z.getIndices(r).map(Re=>p.get(Re)),se=p.get(ce);let fe=0;ce!==Oe&&C.slice(0,-1).forEach((Re,Ke)=>{Re.index>=ce&&Re.index<Oe&&(fe+=B[Ke])});const Fe=_.sum(de.map(Re=>Re.size))+fe,Se=se.position,ze=Z.reposition(r,Fe,Se,Z.getEffectiveStretch(r),-se.minOrigin,Z.getEffectiveAlign(r));n[r.minCoordinate]=Math.min(n[r.minCoordinate],ze[r.minCoordinate]),n[r.maxCoordinate]=Math.max(n[r.maxCoordinate],ze[r.maxCoordinate])})}),this.layoutBoundsProperty.value=n,this.minimumWidthProperty.value=t.horizontal,this.minimumHeightProperty.value=t.vertical,this.finishedLayoutEmitter.emit()}get spacing(){return assert&&assert(this.xSpacing===this.ySpacing),this.xSpacing}set spacing(e){assert&&assert(typeof e=="number"&&isFinite(e)&&e>=0||Array.isArray(e)&&_.every(e,t=>typeof t=="number"&&isFinite(t)&&t>=0)),(this._spacing.get(ot.HORIZONTAL)!==e||this._spacing.get(ot.VERTICAL)!==e)&&(this._spacing.set(ot.HORIZONTAL,e),this._spacing.set(ot.VERTICAL,e),this.updateLayoutAutomatically())}get xSpacing(){return this._spacing.get(ot.HORIZONTAL)}set xSpacing(e){assert&&assert(typeof e=="number"&&isFinite(e)&&e>=0||Array.isArray(e)&&_.every(e,t=>typeof t=="number"&&isFinite(t)&&t>=0)),this._spacing.get(ot.HORIZONTAL)!==e&&(this._spacing.set(ot.HORIZONTAL,e),this.updateLayoutAutomatically())}get ySpacing(){return this._spacing.get(ot.VERTICAL)}set ySpacing(e){assert&&assert(typeof e=="number"&&isFinite(e)&&e>=0||Array.isArray(e)&&_.every(e,t=>typeof t=="number"&&isFinite(t)&&t>=0)),this._spacing.get(ot.VERTICAL)!==e&&(this._spacing.set(ot.VERTICAL,e),this.updateLayoutAutomatically())}addCell(e){assert&&assert(!this.cells.has(e)),this.cells.add(e),this.addNode(e.node),e.changedEmitter.addListener(this._updateLayoutListener),this.updateLayoutAutomatically()}removeCell(e){assert&&assert(this.cells.has(e)),this.cells.delete(e),this.removeNode(e.node),e.changedEmitter.removeListener(this._updateLayoutListener),this.updateLayoutAutomatically()}dispose(){this.lock(),[...this.cells].forEach(e=>this.removeCell(e)),this.displayedLines.forEach(e=>e.clear()),this.displayedCells=[],super.dispose(),this.unlock()}getIndices(e){const t=[];return this.cells.forEach(i=>{t.push(...i.getIndices(e))}),_.sortedUniq(_.sortBy(t))}getCell(e,t){return _.find([...this.cells],i=>i.containsRow(e)&&i.containsColumn(t))||null}getCellFromNode(e){return _.find([...this.cells],t=>t.node===e)||null}getCells(e,t){return _.filter([...this.cells],i=>i.containsIndex(e,t))}static create(e,t){return new eh(e,t)}}q.register("GridConstraint",eh);const Q_=[...om,...dm.filter(l=>l!=="excludeInvisible"),"rows","columns","autoRows","autoColumns"];class pm extends Su{constructor(e){const t=je()({excludeInvisibleChildrenFromBounds:!0,resize:!0},e);super(),this._cellMap=new Map,this._autoRows=null,this._autoColumns=null,this._autoLockCount=0,this._constraint=new eh(this,{preferredWidthProperty:this.localPreferredWidthProperty,preferredHeightProperty:this.localPreferredHeightProperty,minimumWidthProperty:this.localMinimumWidthProperty,minimumHeightProperty:this.localMinimumHeightProperty,layoutOriginProperty:this.layoutOriginProperty,excludeInvisible:!1}),this.onChildInserted=this.onGridBoxChildInserted.bind(this),this.onChildRemoved=this.onGridBoxChildRemoved.bind(this),this.onChildVisibilityToggled=this.updateAllAutoLines.bind(this),this.childInsertedEmitter.addListener(this.onChildInserted),this.childRemovedEmitter.addListener(this.onChildRemoved);const i=_.omit(t,kn),n=_.pick(t,kn);this._constraint.lock(),this.mutate(i),this._constraint.unlock(),this._constraint.updateLayout(),this.mutate(n),this.linkLayoutBounds()}setLines(e,t){const i=[];for(let n=0;n<t.length;n++){const r=t[n];for(let h=0;h<r.length;h++){const p=r[h];p!==null&&(i.push(p),p.mutateLayoutOptions({[e.line]:n,[e.opposite.line]:h}))}}this.children=i}getLines(e){const t=[];for(const i of this._cellMap.values()){const n=i.position.get(e),r=i.position.get(e.opposite);for(;t.length<n+1;)t.push([]);for(;t[n].length<r+1;)t[n].push(null);t[n][r]=i.node}return t}set rows(e){this.setLines(ot.VERTICAL,e)}get rows(){return this.getLines(ot.VERTICAL)}set columns(e){this.setLines(ot.HORIZONTAL,e)}get columns(){return this.getLines(ot.HORIZONTAL)}getNodeAt(e,t){const i=this.constraint.getCell(e,t);return i?i.node:null}getRowOfNode(e){return assert&&assert(this.children.includes(e)),this.constraint.getCellFromNode(e).position.vertical}getColumnOfNode(e){return assert&&assert(this.children.includes(e)),this.constraint.getCellFromNode(e).position.horizontal}getNodesInRow(e){return this.constraint.getCells(ot.VERTICAL,e).map(t=>t.node)}getNodesInColumn(e){return this.constraint.getCells(ot.HORIZONTAL,e).map(t=>t.node)}addRow(e){return this.rows=[...this.rows,e],this}addColumn(e){return this.columns=[...this.columns,e],this}insertRow(e,t){return this.rows=[...this.rows.slice(0,e),t,...this.rows.slice(e)],this}insertColumn(e,t){return this.columns=[...this.columns.slice(0,e),t,...this.columns.slice(e)],this}removeRow(e){return this.rows=[...this.rows.slice(0,e),...this.rows.slice(e+1)],this}removeColumn(e){return this.columns=[...this.columns.slice(0,e),...this.columns.slice(e+1)],this}set autoRows(e){assert&&assert(e===null||typeof e=="number"&&isFinite(e)&&e>=1),this._autoRows!==e&&(this._autoRows=e,this.updateAutoRows())}get autoRows(){return this._autoRows}set autoColumns(e){assert&&assert(e===null||typeof e=="number"&&isFinite(e)&&e>=1),this._autoColumns!==e&&(this._autoColumns=e,this.updateAutoColumns())}get autoColumns(){return this._autoColumns}updateAutoLines(e,t){if(t!==null&&this._autoLockCount===0){let i=0;this.constraint.lock(),this.children.filter(n=>n.bounds.isValid()&&(!this._constraint.excludeInvisible||n.visible)).forEach((n,r)=>{const h=r%t,p=Math.floor(r/t);(!n.layoutOptions||n.layoutOptions[e.line]!==h||n.layoutOptions[e.opposite.line]!==p||n.layoutOptions.horizontalSpan!==1||n.layoutOptions.verticalSpan!==1)&&(i++,n.mutateLayoutOptions({[e.line]:r%t,[e.opposite.line]:Math.floor(r/t),horizontalSpan:1,verticalSpan:1}))}),this.constraint.unlock(),i>0&&this.constraint.updateLayoutAutomatically()}}updateAutoRows(){this.updateAutoLines(ot.VERTICAL,this.autoRows)}updateAutoColumns(){this.updateAutoLines(ot.HORIZONTAL,this.autoColumns)}updateAllAutoLines(){assert&&assert(this._autoRows===null||this._autoColumns===null,"autoRows and autoColumns should not both be set when updating children"),this.updateAutoRows(),this.updateAutoColumns()}setChildren(e){const t=this.getChildren();return this._autoLockCount++,super.setChildren(e),this._autoLockCount--,_.isEqual(t,e)||this.updateAllAutoLines(),this}onGridBoxChildInserted(e,t){e.visibleProperty.lazyLink(this.onChildVisibilityToggled);const i=new um(this._constraint,e,this._constraint.createLayoutProxy(e));this._cellMap.set(e,i),this._constraint.addCell(i),this.updateAllAutoLines()}onGridBoxChildRemoved(e){const t=this._cellMap.get(e);assert&&assert(t),this._cellMap.delete(e),this._constraint.removeCell(t),t.dispose(),this.updateAllAutoLines(),e.visibleProperty.unlink(this.onChildVisibilityToggled)}mutate(e){return Hi(e,["rows"],["columns"],["children","autoRows","autoColumns"]),e&&assert&&assert(typeof e.autoRows!="number"||typeof e.autoColumns!="number","autoRows and autoColumns should not be specified both as non-null at the same time"),super.mutate(e)}get spacing(){return this._constraint.spacing}set spacing(e){this._constraint.spacing=e}get xSpacing(){return this._constraint.xSpacing}set xSpacing(e){this._constraint.xSpacing=e}get ySpacing(){return this._constraint.ySpacing}set ySpacing(e){this._constraint.ySpacing=e}get xAlign(){return this._constraint.xAlign}set xAlign(e){this._constraint.xAlign=e}get yAlign(){return this._constraint.yAlign}set yAlign(e){this._constraint.yAlign=e}get grow(){return this._constraint.grow}set grow(e){this._constraint.grow=e}get xGrow(){return this._constraint.xGrow}set xGrow(e){this._constraint.xGrow=e}get yGrow(){return this._constraint.yGrow}set yGrow(e){this._constraint.yGrow=e}get stretch(){return this._constraint.stretch}set stretch(e){this._constraint.stretch=e}get xStretch(){return this._constraint.xStretch}set xStretch(e){this._constraint.xStretch=e}get yStretch(){return this._constraint.yStretch}set yStretch(e){this._constraint.yStretch=e}get margin(){return this._constraint.margin}set margin(e){this._constraint.margin=e}get xMargin(){return this._constraint.xMargin}set xMargin(e){this._constraint.xMargin=e}get yMargin(){return this._constraint.yMargin}set yMargin(e){this._constraint.yMargin=e}get leftMargin(){return this._constraint.leftMargin}set leftMargin(e){this._constraint.leftMargin=e}get rightMargin(){return this._constraint.rightMargin}set rightMargin(e){this._constraint.rightMargin=e}get topMargin(){return this._constraint.topMargin}set topMargin(e){this._constraint.topMargin=e}get bottomMargin(){return this._constraint.bottomMargin}set bottomMargin(e){this._constraint.bottomMargin=e}get minContentWidth(){return this._constraint.minContentWidth}set minContentWidth(e){this._constraint.minContentWidth=e}get minContentHeight(){return this._constraint.minContentHeight}set minContentHeight(e){this._constraint.minContentHeight=e}get maxContentWidth(){return this._constraint.maxContentWidth}set maxContentWidth(e){this._constraint.maxContentWidth=e}get maxContentHeight(){return this._constraint.maxContentHeight}set maxContentHeight(e){this._constraint.maxContentHeight=e}setExcludeInvisibleChildrenFromBounds(e){super.setExcludeInvisibleChildrenFromBounds(e),this.updateAllAutoLines()}dispose(){this._constraint.lock(),this.childInsertedEmitter.removeListener(this.onChildInserted),this.childRemovedEmitter.removeListener(this.onChildRemoved);for(const e of this._cellMap.values())e.dispose(),e.node.visibleProperty.unlink(this.onChildVisibilityToggled);super.dispose()}getHelperNode(){return Ho.createHelperNode(this.constraint.displayedCells,this.constraint.layoutBoundsProperty.value,t=>{let i="";return i+=`row: ${t.position.vertical}
`,i+=`column: ${t.position.horizontal}
`,t.size.horizontal>1&&(i+=`horizontalSpan: ${t.size.horizontal}
`),t.size.vertical>1&&(i+=`verticalSpan: ${t.size.vertical}
`),i+=`xAlign: ${Zt.internalToAlign(ot.HORIZONTAL,t.effectiveXAlign)}
`,i+=`yAlign: ${Zt.internalToAlign(ot.VERTICAL,t.effectiveYAlign)}
`,i+=`xStretch: ${t.effectiveXStretch}
`,i+=`yStretch: ${t.effectiveYStretch}
`,i+=`xGrow: ${t.effectiveXGrow}
`,i+=`yGrow: ${t.effectiveYGrow}
`,i})}}pm.prototype._mutatorKeys=[...mf,...Q_,...Ge.prototype._mutatorKeys];q.register("GridBox",pm);class J_ extends Ge{constructor(e,t){Hi(t,["createCellBackground"],["fill","stroke"]);const i=r=>vi.bounds(r.lastAvailableBounds,{fill:n.fill,stroke:n.stroke}),n=je()({fill:"white",stroke:"black",createCellBackground:i},t);super(),this.constraint=e,this.createCellBackground=n.createCellBackground,this.layoutListener=this.update.bind(this),this.constraint.finishedLayoutEmitter.addListener(this.layoutListener),this.update(),this.mutate(n)}update(){this.children=this.constraint.displayedCells.map(this.createCellBackground).filter(_.identity)}dispose(){this.constraint.finishedLayoutEmitter.removeListener(this.layoutListener),super.dispose()}}q.register("GridBackgroundNode",J_);class ku extends Fo{constructor(e,t,i){assert&&assert(Array.isArray(t)&&_.every(t,n=>n instanceof Ge)),super(e),this.lock(),this.nodes=t,this.cells=t.map(n=>new Ql(this,n,null)),this.layoutCallback=i,this.nodes.forEach(n=>this.addNode(n,!1)),this.unlock(),this.updateLayout()}layout(){if(super.layout(),assert&&assert(_.every(this.nodes,t=>!t.isDisposed)),!_.some(this.cells,t=>!t.isConnected())){const t=this.cells.map(i=>i.proxy);this.layoutCallback.apply(null,t),this.finishedLayoutEmitter.emit()}}dispose(){this.cells.forEach(e=>e.dispose()),super.dispose()}static create(e,t,i){return new ku(e,t,i)}}q.register("ManualConstraint",ku);class Au extends Fo{constructor(e,t,i){assert&&assert(Array.isArray(t)&&_.every(t,n=>n instanceof Ge)),super(e),this.lock(),this.nodes=t,this.cells=t.map(n=>new Ql(this,n,null)),this.layoutCallback=i,this.nodes.forEach(n=>this.addNode(n,!1)),this.unlock(),this.updateLayout()}layout(){super.layout(),assert&&assert(_.every(this.nodes,t=>!t.isDisposed));const e=this.cells.map(t=>t.isConnected()?t.proxy:null);this.layoutCallback.apply(null,e),this.finishedLayoutEmitter.emit()}dispose(){this.cells.forEach(e=>e.dispose()),super.dispose()}static create(e,t,i){return new Au(e,t,i)}}q.register("RelaxedManualConstraint",Au);const eL=["alignBounds","xAlign","yAlign","margin","xMargin","yMargin","leftMargin","rightMargin","topMargin","bottomMargin","group"],Xp=["left","center","right","stretch"],Zp=["top","center","bottom","stretch"],gm=Yl(Ge);class Ou extends gm{constructor(e,t){const i=je()({children:[e]},t),n={sizable:!1};super(n),this._xSet=!1,this._ySet=!1,this._contentBoundsListener=_.noop,assert&&assert(i===void 0||Object.getPrototypeOf(i)===Object.prototype,"Extra prototype on Node options object is a code smell"),this._content=e,this._alignBounds=null,this._xAlign="center",this._yAlign="center",this._leftMargin=0,this._rightMargin=0,this._topMargin=0,this._bottomMargin=0,this._group=null,this._contentBoundsListener=this.invalidateAlignment.bind(this),this._alignBoundsProperty=null,this._alignBoundsPropertyListener=_.noop,Hi(i,["alignBounds"],["alignBoundsProperty"]),t!=null&&t.alignBoundsProperty&&(this._alignBoundsProperty=t.alignBoundsProperty,i.alignBounds=this._alignBoundsProperty.value,this._alignBoundsPropertyListener=r=>{this.alignBounds=r},this._alignBoundsProperty.lazyLink(this._alignBoundsPropertyListener)),this.localBounds=new Be(0,0,0,0),this.constraint=new tL(this,e),this._content.boundsProperty.link(this._contentBoundsListener),this.mutate(i),tr.multilink([this.localPreferredWidthProperty,this.localPreferredHeightProperty],(r,h)=>{if(r!==null||h!==null){const p=this._alignBounds||new Be(0,0,0,0);r&&(p.minX=0,p.maxX=r,this._xSet=!0),h&&(p.minY=0,p.maxY=h,this._ySet=!0),this._alignBounds=p,this.constraint.updateLayout()}})}invalidateAlignment(){sceneryLog&&sceneryLog.AlignBox&&sceneryLog.AlignBox(`AlignBox#${this.id} invalidateAlignment`),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.push(),this._group&&this._group.onAlignBoxResized(this),this.constraint.updateLayout(),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.pop()}setAlignBounds(e){return assert&&assert(e===null||e instanceof Be&&!e.isEmpty()&&e.isFinite(),"alignBounds should be a non-empty finite Bounds2"),this._xSet=!0,this._ySet=!0,this._alignBounds!==e&&(!e||!this._alignBounds||!e.equals(this._alignBounds))&&(this._alignBounds=e,this.constraint.updateLayout()),this}set alignBounds(e){this.setAlignBounds(e)}get alignBounds(){return this.getAlignBounds()}getAlignBounds(){return this._alignBounds}setGroup(e){return assert&&assert(e===null||e instanceof fm,"group should be an AlignGroup"),this._group!==e&&(this._group&&this._group.removeAlignBox(this),this._group=e,this._group&&this._group.addAlignBox(this)),this}set group(e){this.setGroup(e)}get group(){return this.getGroup()}getGroup(){return this._group}setXAlign(e){return assert&&assert(Xp.includes(e),`xAlign should be one of: ${Xp}`),this._xAlign!==e&&(this._xAlign=e,this.invalidateAlignment()),this}set xAlign(e){this.setXAlign(e)}get xAlign(){return this.getXAlign()}getXAlign(){return this._xAlign}setYAlign(e){return assert&&assert(Zp.includes(e),`xAlign should be one of: ${Zp}`),this._yAlign!==e&&(this._yAlign=e,this.invalidateAlignment()),this}set yAlign(e){this.setYAlign(e)}get yAlign(){return this.getYAlign()}getYAlign(){return this._yAlign}setMargin(e){return assert&&assert(isFinite(e)&&e>=0,"margin should be a finite non-negative number"),(this._leftMargin!==e||this._rightMargin!==e||this._topMargin!==e||this._bottomMargin!==e)&&(this._leftMargin=this._rightMargin=this._topMargin=this._bottomMargin=e,this.invalidateAlignment()),this}set margin(e){this.setMargin(e)}get margin(){return this.getMargin()}getMargin(){return assert&&assert(this._leftMargin===this._rightMargin&&this._leftMargin===this._topMargin&&this._leftMargin===this._bottomMargin,"Getting margin does not have a unique result if the left and right margins are different"),this._leftMargin}setXMargin(e){return assert&&assert(isFinite(e)&&e>=0,"xMargin should be a finite non-negative number"),(this._leftMargin!==e||this._rightMargin!==e)&&(this._leftMargin=this._rightMargin=e,this.invalidateAlignment()),this}set xMargin(e){this.setXMargin(e)}get xMargin(){return this.getXMargin()}getXMargin(){return assert&&assert(this._leftMargin===this._rightMargin,"Getting xMargin does not have a unique result if the left and right margins are different"),this._leftMargin}setYMargin(e){return assert&&assert(isFinite(e)&&e>=0,"yMargin should be a finite non-negative number"),(this._topMargin!==e||this._bottomMargin!==e)&&(this._topMargin=this._bottomMargin=e,this.invalidateAlignment()),this}set yMargin(e){this.setYMargin(e)}get yMargin(){return this.getYMargin()}getYMargin(){return assert&&assert(this._topMargin===this._bottomMargin,"Getting yMargin does not have a unique result if the top and bottom margins are different"),this._topMargin}setLeftMargin(e){return assert&&assert(isFinite(e)&&e>=0,"leftMargin should be a finite non-negative number"),this._leftMargin!==e&&(this._leftMargin=e,this.invalidateAlignment()),this}set leftMargin(e){this.setLeftMargin(e)}get leftMargin(){return this.getLeftMargin()}getLeftMargin(){return this._leftMargin}setRightMargin(e){return assert&&assert(isFinite(e)&&e>=0,"rightMargin should be a finite non-negative number"),this._rightMargin!==e&&(this._rightMargin=e,this.invalidateAlignment()),this}set rightMargin(e){this.setRightMargin(e)}get rightMargin(){return this.getRightMargin()}getRightMargin(){return this._rightMargin}setTopMargin(e){return assert&&assert(isFinite(e)&&e>=0,"topMargin should be a finite non-negative number"),this._topMargin!==e&&(this._topMargin=e,this.invalidateAlignment()),this}set topMargin(e){this.setTopMargin(e)}get topMargin(){return this.getTopMargin()}getTopMargin(){return this._topMargin}setBottomMargin(e){return assert&&assert(isFinite(e)&&e>=0,"bottomMargin should be a finite non-negative number"),this._bottomMargin!==e&&(this._bottomMargin=e,this.invalidateAlignment()),this}set bottomMargin(e){this.setBottomMargin(e)}get bottomMargin(){return this.getBottomMargin()}getBottomMargin(){return this._bottomMargin}getContent(){return this._content}get content(){return this.getContent()}getContentBounds(){sceneryLog&&sceneryLog.AlignBox&&sceneryLog.AlignBox(`AlignBox#${this.id} getContentBounds`),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.push();const e=this._content.bounds;return sceneryLog&&sceneryLog.AlignBox&&sceneryLog.pop(),new Be(e.left-this._leftMargin,e.top-this._topMargin,e.right+this._rightMargin,e.bottom+this._bottomMargin)}setAdjustedLocalBounds(e){if(this._xSet&&this._ySet)this.localBounds=e;else if(this._xSet){const t=this.getContentBounds();this.localBounds=new Be(e.minX,t.minY,e.maxX,t.maxY)}else if(this._ySet){const t=this.getContentBounds();this.localBounds=new Be(t.minX,e.minY,t.maxX,e.maxY)}else this.localBounds=this.getContentBounds()}dispose(){this._alignBoundsProperty&&this._alignBoundsProperty.unlink(this._alignBoundsPropertyListener),this._content.boundsProperty.unlink(this._contentBoundsListener),this._content=new Ge,this.group=null,this.constraint.dispose(),super.dispose()}mutate(e){return super.mutate(e)}}class tL extends Fo{constructor(e,t){super(e),this.alignBox=e,this.content=t,this.addNode(t),e.isWidthResizableProperty.lazyLink(this._updateLayoutListener),e.isHeightResizableProperty.lazyLink(this._updateLayoutListener)}updateProperty(e,t){const i=this.content[e],n=this.alignBox.localBounds[e]+t;Math.abs(i-n)>1e-5&&(this.content[e]=n)}layout(){super.layout();const e=this.alignBox,t=this.content;if(sceneryLog&&sceneryLog.AlignBox&&sceneryLog.AlignBox(`AlignBoxConstraint#${this.alignBox.id} layout`),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.push(),!t.bounds.isValid())return;const i=e.leftMargin+e.rightMargin,n=e.topMargin+e.bottomMargin;if(e.alignBounds!==null)e.setAdjustedLocalBounds(e.alignBounds);else{const p=t.width+i,S=t.height+n;e.setAdjustedLocalBounds(new Be(0,0,p,S))}const r=isFinite(t.width)?(aa(t)?t.minimumWidth||0:t.width)+i:null,h=isFinite(t.height)?(oa(t)?t.minimumHeight||0:t.height)+n:null;t.localBounds.isEmpty()||(e.xAlign==="center"?this.updateProperty("centerX",(e.leftMargin-e.rightMargin)/2):e.xAlign==="left"?this.updateProperty("left",e.leftMargin):e.xAlign==="right"?this.updateProperty("right",-e.rightMargin):e.xAlign==="stretch"?(assert&&assert(aa(t),"xAlign:stretch can only be used if WidthSizable is mixed into the content"),t.preferredWidth=e.localWidth-e.leftMargin-e.rightMargin,this.updateProperty("left",e.leftMargin)):assert&&assert(`Bad xAlign: ${e.xAlign}`),e.yAlign==="center"?this.updateProperty("centerY",(e.topMargin-e.bottomMargin)/2):e.yAlign==="top"?this.updateProperty("top",e.topMargin):e.yAlign==="bottom"?this.updateProperty("bottom",-e.bottomMargin):e.yAlign==="stretch"?(assert&&assert(oa(t),"yAlign:stretch can only be used if HeightSizable is mixed into the content"),t.preferredHeight=e.localHeight-e.topMargin-e.bottomMargin,this.updateProperty("top",e.topMargin)):assert&&assert(`Bad yAlign: ${e.yAlign}`)),sceneryLog&&sceneryLog.AlignBox&&sceneryLog.pop(),e.localMinimumWidth=e.widthSizable?r:e.localWidth,e.localMinimumHeight=e.heightSizable?h:e.localHeight}}Ou.prototype._mutatorKeys=eL.concat(gm.prototype._mutatorKeys);q.register("AlignBox",Ou);let iL=1;const sL={matchHorizontal:!0,matchVertical:!0};class fm extends jc{constructor(e){assert&&assert(e===void 0||Object.getPrototypeOf(e)===Object.prototype,"Extra prototype on options object is a code smell");const t=En()({},sL,e);assert&&assert(typeof t.matchHorizontal=="boolean"),assert&&assert(typeof t.matchVertical=="boolean"),super(t),this._alignBoxes=[],this._matchHorizontal=t.matchHorizontal,this._matchVertical=t.matchVertical,this._resizeLock=!1,this._maxWidthProperty=new gn(0),this._maxHeightProperty=new gn(0),this.id=iL++}getMaxWidth(){return this._maxWidthProperty.value}get maxWidth(){return this.getMaxWidth()}getMaxWidthProperty(){return this._maxWidthProperty}get maxWidthProperty(){return this.getMaxWidthProperty()}getMaxHeight(){return this._maxHeightProperty.value}get maxHeight(){return this.getMaxHeight()}getMaxHeightProperty(){return this._maxHeightProperty}get maxHeightProperty(){return this.getMaxHeightProperty()}getMaxSizeProperty(e){return e===ot.HORIZONTAL?this._maxWidthProperty:this._maxHeightProperty}createBox(e,t){return new Ou(e,ii({group:this},t))}setMatchHorizontal(e){return this._matchHorizontal!==e&&(this._matchHorizontal=e,this.updateLayout()),this}set matchHorizontal(e){this.setMatchHorizontal(e)}get matchHorizontal(){return this.getMatchHorizontal()}getMatchHorizontal(){return this._matchHorizontal}setMatchVertical(e){return this._matchVertical!==e&&(this._matchVertical=e,this.updateLayout()),this}set matchVertical(e){this.setMatchVertical(e)}get matchVertical(){return this.getMatchVertical()}getMatchVertical(){return this._matchVertical}updateLayout(){if(this._resizeLock)return;this._resizeLock=!0,sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.AlignGroup(`AlignGroup#${this.id} updateLayout`),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.push(),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.AlignGroup("AlignGroup computing maximum dimension"),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.push();let e=0,t=0;for(let i=0;i<this._alignBoxes.length;i++){const r=this._alignBoxes[i].getContentBounds();r.isEmpty()||!r.isFinite()||(e=Math.max(e,r.width),t=Math.max(t,r.height))}if(sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.pop(),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.AlignGroup("AlignGroup applying to boxes"),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.push(),this._maxWidthProperty.value=e,this._maxHeightProperty.value=t,e>0&&t>0)for(let i=0;i<this._alignBoxes.length;i++)this.setBoxBounds(this._alignBoxes[i],e,t);sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.pop(),sceneryLog&&sceneryLog.AlignGroup&&sceneryLog.pop(),this._resizeLock=!1}setBoxBounds(e,t,i){let n;if(this._matchVertical&&this._matchHorizontal)n=new Be(0,0,t,i);else{const r=e.getContentBounds();this._matchVertical?n=new Be(0,0,isFinite(r.width)?r.width:t,i):this._matchHorizontal?n=new Be(0,0,t,isFinite(r.height)?r.height:i):n=r}e.alignBounds=n}onAlignBoxResized(e){this.updateLayout()}addAlignBox(e){this._alignBoxes.push(e),this.updateLayout()}removeAlignBox(e){Vs(this._alignBoxes,e),this.updateLayout()}dispose(){for(let e=this._alignBoxes.length-1;e>=0;e--)this._alignBoxes[e].dispose();super.dispose()}}q.register("AlignGroup",fm);class nL extends ba{constructor(e){assert&&assert(!e||!e.orientation,"HBox sets orientation"),super(je()({orientation:"horizontal"},e))}onFlowBoxChildInserted(e,t){assert&&assert(!(e instanceof rm),"HSeparator should not be used in an HBox. Use VSeparator instead"),super.onFlowBoxChildInserted(e,t)}mutate(e){return super.mutate(e)}}q.register("HBox",nL);class rL extends ba{constructor(e){assert&&assert(!e||!e.orientation,"VBox sets orientation"),super(je()({orientation:"vertical"},e))}onFlowBoxChildInserted(e,t){assert&&assert(!(e instanceof nm),"VSeparator should not be used in an VBox. Use HSeparator instead"),super.onFlowBoxChildInserted(e,t)}mutate(e){return super.mutate(e)}}q.register("VBox",rL);const Zh=l=>l.type.toLowerCase()==="element",Qh=l=>l.type.toLowerCase()==="text",fs={scratchText:new Vi(""),himalayaGetAttribute(l,e){if(!e)return null;const t=_.find(e.attributes,i=>i.key===l);return t&&t.value||null},himalayaStyleStringToMap(l){const e=l.split(";"),t={};return e.forEach(i=>{if(i.length>0){const n=i.split(":");assert&&assert(n.length===2,"too many colons"),t[n[0].trim()]=n[1].trim()}}),t}};q.register("RichTextUtils",fs);const La=Ai(l=>(assert&&assert(_.includes(vs(l),Ge),"Only Node subtypes should mix Paintable"),class extends l{get isCleanable(){return!0}clean(){const t=this;for(let i=t._children.length-1;i>=0;i--){const n=t._children[i];n.isCleanable&&(t.removeChild(n),n.clean())}t.matrix=$e.IDENTITY,t.freeToPool()}}));q.register("RichTextCleanable",La);const vo=class vo extends La(Ge){constructor(e){super(),this.initialize(e)}initialize(e){return this.localBounds=new Be(0,0,0,e),this}freeToPool(){vo.pool.freeToPool(this)}};vo.pool=new cs(vo);let Dl=vo;q.register("RichTextVerticalSpacer",Dl);const _o=class _o extends La(Ge){constructor(e){super(),this.initialize(e)}initialize(e){return this.isLTR=e,this.leftSpacing=0,this.rightSpacing=0,this}addElement(e){const t=this.children.length>0,i=e.width>0,n=e.getScaleVector().x,r=e.leftSpacing*n,h=e.rightSpacing*n;if(!t&&!i)return sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("No child or element, ignoring"),!1;if(t)if(!i)sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`No element, adding spacing, ltr:${this.isLTR}, spacing: ${r+h}`),this.isLTR?this.rightSpacing+=r+h:this.leftSpacing+=r+h;else return this.isLTR?(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`LTR add ${this.rightSpacing} + ${r}`),e.left=this.localRight+this.rightSpacing+r,this.rightSpacing=h):(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`RTL add ${this.leftSpacing} + ${h}`),e.right=this.localLeft-this.leftSpacing-h,this.leftSpacing=r),this.addChild(e),!0;else return sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`First child, ltr:${this.isLTR}, spacing: ${this.isLTR?h:r}`),this.isLTR?(e.left=0,this.leftSpacing=r,this.rightSpacing=h):(e.right=0,this.leftSpacing=r,this.rightSpacing=h),this.addChild(e),!0;return!1}addExtraBeforeSpacing(e){this.isLTR?this.leftSpacing+=e:this.rightSpacing+=e}freeToPool(){_o.pool.freeToPool(this)}};_o.pool=new cs(_o);let ca=_o;q.register("RichTextElement",ca);const Lo=class Lo extends La(Vi){constructor(e,t,i,n,r,h,p){super(""),this.initialize(e,t,i,n,r,h,p)}initialize(e,t,i,n,r,h,p){let S="";for(;e.startsWith(" ");)S+=" ",e=e.slice(1);let C="";for(;e.endsWith(" ");)C=" ",e=e.slice(0,e.length-1);this.string=Mn.contentToString(e,t),this.boundsMethod=n,this.font=i,this.fill=r,this.stroke=h,this.lineWidth=p;const B=S.length?fs.scratchText.setString(S).setFont(i).width:0,U=C.length?fs.scratchText.setString(C).setFont(i).width:0;return this.leftSpacing=t?B:U,this.rightSpacing=t?U:B,this}clean(){super.clean(),this.fill=null,this.stroke=null}fitsIn(e,t,i){return this.width+(t?i?this.leftSpacing:this.rightSpacing:0)<=e}freeToPool(){Lo.pool.freeToPool(this)}};Lo.pool=new cs(Lo);let Dr=Lo;q.register("RichTextLeaf",Dr);const Po=class Po extends La(Ge){constructor(e){super(),this.leftSpacing=0,this.rightSpacing=0,this.initialize(e)}initialize(e){return this.addChild(e),this}clean(){super.clean(),this.removeAllChildren()}fitsIn(e){return this.width<=e}freeToPool(){Po.pool.freeToPool(this)}};Po.pool=new cs(Po);let Il=Po;q.register("RichTextNode",Il);const So=class So extends tn(La(Ge)){constructor(e,t){super(),this.fireListener=null,this.accessibleInputListener=null,this.allowLinksListener=null,this.initialize(e,t,!1),this.mutate({cursor:"pointer",tagName:"a"})}initialize(e,t,i=!0){return i&&super.initialize(),this.innerContent=e,this.voicingNameResponse=e,typeof t=="function"?(this.fireListener=new Fc({fire:t,tandem:Ft.OPT_OUT}),this.addInputListener(this.fireListener),this.setPDOMAttribute("href","#"),this.setPDOMAttribute("target","_self"),this.accessibleInputListener={click:n=>{n.domEvent&&n.domEvent.preventDefault(),t()}},this.addInputListener(this.accessibleInputListener)):(this.fireListener=new Fc({fire:n=>{n.isFromPDOM()&&n.domEvent.preventDefault(),self._linkEventsHandled&&n.handle(),zg(t)},tandem:Ft.OPT_OUT}),this.addInputListener(this.fireListener),this.setPDOMAttribute("href",t),this.setPDOMAttribute("target","_blank"),this.allowLinksListener=n=>{this.visible=n},ua.link(this.allowLinksListener)),this}clean(){super.clean(),this.fireListener&&(this.removeInputListener(this.fireListener),this.fireListener.dispose()),this.fireListener=null,this.accessibleInputListener&&(this.removeInputListener(this.accessibleInputListener),this.accessibleInputListener=null),this.allowLinksListener&&(ua.unlink(this.allowLinksListener),this.allowLinksListener=null)}freeToPool(){So.pool.freeToPool(this)}};So.pool=new cs(So);let xl=So;q.register("RichTextLink",xl);const Gc=himalaya;assert&&assert(Gc,"himalaya dependency needed for RichText.");const aL=["boundsMethod","font","fill","stroke","lineWidth","subScale","subXSpacing","subYOffset","supScale","supXSpacing","supYOffset","capHeightScale","underlineLineWidth","underlineHeightScale","strikethroughLineWidth","strikethroughHeightScale","linkFill","linkEventsHandled","links","nodes","replaceNewlines","align","leading","lineWrap",Vi.STRING_PROPERTY_NAME,"string"],Qp=self.QueryStringMachine&&QueryStringMachine.containsKey("stringTest"),oL=new ki({size:20}),lL=["b","strong","i","em","sub","sup","u","s"],Ks={COMPLETE:"COMPLETE",INCOMPLETE:"INCOMPLETE",NONE:"NONE"},Jh=[],ec=[],mm={"font-family":"family","font-size":"size","font-stretch":"stretch","font-style":"style","font-variant":"variant","font-weight":"weight","line-height":"lineHeight"},zc=Object.keys(mm),hL=["color"].concat(zc),Ns=class Ns extends Ul(Ge){constructor(e,t){const i=je()({fill:"#000000",tandemNameSuffix:"Text",phetioType:Ns.RichTextIO,phetioVisiblePropertyInstrumented:!1},t);typeof e=="string"||typeof e=="number"?i.string=e:i.stringProperty=e,super(),this._font=oL,this._boundsMethod="hybrid",this._fill="#000000",this._stroke=null,this._lineWidth=1,this._subScale=.75,this._subXSpacing=0,this._subYOffset=0,this._supScale=.75,this._supXSpacing=0,this._supYOffset=0,this._capHeightScale=.75,this._underlineLineWidth=1,this._underlineHeightScale=.15,this._strikethroughLineWidth=1,this._strikethroughHeightScale=.3,this._linkFill="rgb(27,0,241)",this._linkEventsHandled=!1,this._links={},this._nodes={},this._replaceNewlines=!1,this._align="left",this._leading=0,this._lineWrap=null,this._linkItems=[],this._hasAddedLeafToLine=!1,this.needPendingMinimumWidth=!1,this.pendingMinimumWidth=0,this._stringProperty=new dn("",!0,this.onStringPropertyChange.bind(this)),this.lineContainer=new Ge({}),this.addChild(this.lineContainer),this.rebuildRichText(),this.localPreferredWidthProperty.lazyLink(()=>this.rebuildRichText()),this.mutate(i)}onStringPropertyChange(){this.rebuildRichText()}setStringProperty(e){return this._stringProperty.setTargetProperty(e,this,Ns.STRING_PROPERTY_TANDEM_NAME)}set stringProperty(e){this.setStringProperty(e)}get stringProperty(){return this.getStringProperty()}getStringProperty(){return this._stringProperty}getPhetioMouseHitTarget(e=!1){return gu.value==="string"?this.getStringPropertyPhetioMouseHitTarget(e):super.getPhetioMouseHitTarget(e)}getStringPropertyPhetioMouseHitTarget(e=!1){const t=this._stringProperty.getTargetProperty();return t instanceof yi?t.getPhetioMouseHitTarget(e):"phetioNotSelectable"}initializePhetioObject(e,t){const i=je()({},t),n=this.isPhetioInstrumented();super.initializePhetioObject(e,i),Ft.PHET_IO_ENABLED&&!n&&this.isPhetioInstrumented()&&this._stringProperty.initializePhetio(this,Ns.STRING_PROPERTY_TANDEM_NAME,()=>new $l(this.string,ii({phetioReadOnly:!0,tandem:this.tandem.createTandem(Ns.STRING_PROPERTY_TANDEM_NAME),phetioDocumentation:"Property for the displayed text"},i.stringPropertyOptions)))}rebuildRichText(){assert&&Bt(Jh),assert&&Bt(ec);const e=this._lineWrap==="stretch";this.widthSizable=e,this.pendingMinimumWidth=0,this.needPendingMinimumWidth=e;const t=this._lineWrap==="stretch"?this.localPreferredWidth:this._lineWrap;if(this.freeChildrenToPool(),this.string===""){this.appendEmptyLeaf();return}sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`RichText#${this.id} rebuild`),sceneryLog&&sceneryLog.RichText&&sceneryLog.push();let i=this.string.replace(/\u202a/g,'<span dir="ltr">').replace(/\u202b/g,'<span dir="rtl">').replace(/\u202c/g,"</span>");this._replaceNewlines&&(i=i.replace(/\n/g,"<br>"));let n;try{n=Gc.parse(i)}catch{n=Gc.parse("INVALID TRANSLATION")}this._linkItems.length=0;const r=t===null?Number.POSITIVE_INFINITY:t,h=!0;let p=ca.pool.create(h);for(this._hasAddedLeafToLine=!1;n.length;){const S=n[0],C=p.bounds.isValid()?p.width:0,B=this.appendElement(p,S,this._font,this._fill,h,r-C,1);sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`lineBreakState: ${B}`),B!==Ks.NONE&&(p.bounds.isValid()?(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("Adding line due to lineBreak"),this.appendLine(p)):this.appendLine(Dl.pool.create(fs.scratchText.setString("X").setFont(this._font).height)),p=ca.pool.create(h),this._hasAddedLeafToLine=!1),B!==Ks.INCOMPLETE&&(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("Finished root element"),n.splice(0,1))}for(p.bounds.isValid()&&(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("Adding final line"),this.appendLine(p)),this.lineContainer.getChildrenCount()===0&&this.appendEmptyLeaf(),this.alignLines();this._linkItems.length;)(()=>{const S=this._linkItems[0].element,C=this._linkItems[0].href;let B;const U=[];for(B=this._linkItems.length-1;B>=0;B--){const Q=this._linkItems[B];Q.element===S&&(U.push(Q.node),this._linkItems.splice(B,1))}const k=xl.pool.create(S.innerContent,C);for(this.lineContainer.addChild(k),B=0;B<U.length;B++){const Q=U[B],X=Q.getUniqueTrailTo(this.lineContainer).getMatrix();Q.detach(),Q.matrix=X,k.addChild(Q)}})();this._linkItems.length=0,assert&&(this._links&&this._links!==!0&&Object.keys(this._links).forEach(S=>{assert&&ua.value&&!Qp&&assert(Jh.includes(S),`Unused RichText link: ${S}`)}),this._nodes&&Object.keys(this._nodes).forEach(S=>{assert&&ua.value&&!Qp&&assert(ec.includes(S),`Unused RichText node: ${S}`)})),this.localMinimumWidth=e?this.pendingMinimumWidth:this.localBounds.width,sceneryLog&&sceneryLog.RichText&&sceneryLog.pop()}freeChildrenToPool(){for(;this.lineContainer._children.length;){const e=this.lineContainer._children[this.lineContainer._children.length-1];this.lineContainer.removeChild(e),e.clean()}}dispose(){this.freeChildrenToPool(),super.dispose(),this._stringProperty.dispose()}appendLine(e){this.lineContainer.bounds.isValid()&&(e.top=this.lineContainer.bottom+this._leading,e.left=0),this.lineContainer.addChild(e)}appendEmptyLeaf(){assert&&assert(this.lineContainer.getChildrenCount()===0),this.appendLine(Dr.pool.create("",!0,this._font,this._boundsMethod,this._fill,this._stroke,this._lineWidth))}alignLines(){const e=this._align==="center"?"centerX":this._align,t=this.lineContainer[e];for(let i=0;i<this.lineContainer.getChildrenCount();i++)this.lineContainer.getChildAt(i)[e]=t}appendElement(e,t,i,n,r,h,p){let S=Ks.NONE,C;const B=r?e.rightSpacing:e.leftSpacing,U=h-B;if(Qh(t)){if(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`appending leaf: ${t.content}`),sceneryLog&&sceneryLog.RichText&&sceneryLog.push(),C=Dr.pool.create(t.content,r,i,this._boundsMethod,n,this._stroke,this._lineWidth),this.needPendingMinimumWidth&&(this.pendingMinimumWidth=Math.max(this.pendingMinimumWidth,Math.max(...yc(t.content).map(k=>{const Q=t.content.slice(k.min,k.max),X=Dr.pool.create(Q,r,i,this._boundsMethod,n,this._stroke,this._lineWidth),g=X.width*p;return X.dispose(),g})))),!C.fitsIn(U,this._hasAddedLeafToLine,r)){const k=yc(t.content),Q=X=>X.length===0?"":t.content.slice(X[0].min,X[X.length-1].max);if(sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`Overflow leafAdded:${this._hasAddedLeafToLine}, words: ${k.length}`),this._hasAddedLeafToLine||k.length>1){sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("Skipping words");const X=[];let g=!1;for(X.unshift(k.pop());k.length;)if(C.clean(),C=Dr.pool.create(Q(k),r,i,this._boundsMethod,n,this._stroke,this._lineWidth),!C.fitsIn(U,this._hasAddedLeafToLine,r)&&(this._hasAddedLeafToLine||k.length>1))sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`Skipping word ${Q([k[k.length-1]])}`),X.unshift(k.pop());else{sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`Success with ${Q(k)}`),g=!0;break}if(g)S=Ks.INCOMPLETE,t.content=Q(X),sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText(`Remaining content: ${t.content}`);else return C.clean(),Ks.INCOMPLETE}}this._hasAddedLeafToLine=!0,sceneryLog&&sceneryLog.RichText&&sceneryLog.pop()}else if(Zh(t)){if(t.tagName==="br")return sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("manual line break"),Ks.COMPLETE;if(t.tagName==="span"){const X=fs.himalayaGetAttribute("dir",t);X&&(assert&&assert(X==="ltr"||X==="rtl","Span dir attributes should be ltr or rtl."),r=X==="ltr")}if(t.tagName==="node"){const X=fs.himalayaGetAttribute("id",t),g=X&&this._nodes[X]||null;if(assert&&assert(g,X?`Could not find a matching item in RichText's nodes for ${X}. It should be provided in the nodes option`:"No id attribute provided for a given <node> element"),g){if(assert&&ec.push(X),C=Il.pool.create(g),this._hasAddedLeafToLine&&!C.fitsIn(U))return C.clean(),Ks.INCOMPLETE;const Z=fs.himalayaGetAttribute("align",t);if(Z==="center"||Z==="top"||Z==="bottom"){const ce=fs.scratchText.setString("Test").setFont(i).bounds;Z==="center"?C.centerY=ce.centerY:Z==="top"?C.top=ce.top:Z==="bottom"&&(C.bottom=ce.bottom)}}else return S;this._hasAddedLeafToLine=!0}else C=ca.pool.create(r);sceneryLog&&sceneryLog.RichText&&sceneryLog.RichText("appending element"),sceneryLog&&sceneryLog.RichText&&sceneryLog.push();const k=fs.himalayaGetAttribute("style",t);if(k){const X=fs.himalayaStyleStringToMap(k);assert&&Object.keys(X).forEach(Z=>{assert(_.includes(hL,Z),"See supported style CSS keys")}),X.color&&(n=new Me(X.color));const g={};for(let Z=0;Z<zc.length;Z++){const ce=zc[Z];X[ce]&&(g[mm[ce]]=X[ce])}i=(typeof i=="string"?ki.fromCSS(i):i).copy(g)}if(t.tagName==="a"){let X=fs.himalayaGetAttribute("href",t);const g=X;if(X!==null&&this._links!==!0)if(X.startsWith("{{")&&X.indexOf("}}")===X.length-2){const Z=X.slice(2,-2);X=this._links[Z],assert&&Jh.push(Z)}else X=null;assert&&assert(X,`Could not find a matching item in RichText's links for ${g}. It should be provided in the links option, or links should be turned to true (to allow the string to create its own urls`),X&&(this._linkFill!==null&&(n=this._linkFill),t.innerContent||(t.innerContent=Ns.himalayaElementToAccessibleString(t,r)),this._linkItems.push({element:t,node:C,href:X}))}else t.tagName==="b"||t.tagName==="strong"?i=(typeof i=="string"?ki.fromCSS(i):i).copy({weight:"bold"}):t.tagName==="i"||t.tagName==="em"?i=(typeof i=="string"?ki.fromCSS(i):i).copy({style:"italic"}):t.tagName==="sub"?(C.scale(this._subScale),C.addExtraBeforeSpacing(this._subXSpacing),C.y+=this._subYOffset):t.tagName==="sup"&&(C.scale(this._supScale),C.addExtraBeforeSpacing(this._supXSpacing),C.y+=this._supYOffset);const Q=C.getScaleVector().x;if(t.tagName!=="node"){for(;S===Ks.NONE&&t.children.length;){const X=C.bounds.isValid()?C.width:0,g=t.children[0];S=this.appendElement(C,g,i,n,r,h/Q,p*Q),S!==Ks.INCOMPLETE&&t.children.splice(0,1);const Z=C.bounds.isValid()?C.width:0;h+=X-Z}S===Ks.COMPLETE&&t.children.length&&(S=Ks.INCOMPLETE)}if(t.tagName==="sub")isFinite(C.height)&&(C.centerY=0);else if(t.tagName==="sup")isFinite(C.height)&&(C.centerY=fs.scratchText.setString("X").setFont(i).top*this._capHeightScale);else if(t.tagName==="u"){const X=-C.top*this._underlineHeightScale;isFinite(C.top)&&C.addChild(new An(C.localLeft,X,C.localRight,X,{stroke:n,lineWidth:this._underlineLineWidth}))}else if(t.tagName==="s"){const X=C.top*this._strikethroughHeightScale;isFinite(C.top)&&C.addChild(new An(C.localLeft,X,C.localRight,X,{stroke:n,lineWidth:this._strikethroughLineWidth}))}sceneryLog&&sceneryLog.RichText&&sceneryLog.pop()}return C&&(e.addElement(C)||(this._linkItems=this._linkItems.filter(Q=>Q.node!==C),C.clean())),S}setString(e){return assert&&assert(e!=null,"String should be defined and non-null. Use the empty string if needed."),e=`${e}`,this._stringProperty.set(e),this}set string(e){this.setString(e)}get string(){return this.getString()}getString(){return this._stringProperty.value}setBoundsMethod(e){return assert&&assert(e==="fast"||e==="fastCanvas"||e==="accurate"||e==="hybrid","Unknown Text boundsMethod"),e!==this._boundsMethod&&(this._boundsMethod=e,this.rebuildRichText()),this}set boundsMethod(e){this.setBoundsMethod(e)}get boundsMethod(){return this.getBoundsMethod()}getBoundsMethod(){return this._boundsMethod}setFont(e){return this._font!==e&&(this._font=e,this.rebuildRichText()),this}set font(e){this.setFont(e)}get font(){return this.getFont()}getFont(){return this._font}setFill(e){return this._fill!==e&&(this._fill=e,this.rebuildRichText()),this}set fill(e){this.setFill(e)}get fill(){return this.getFill()}getFill(){return this._fill}setStroke(e){return this._stroke!==e&&(this._stroke=e,this.rebuildRichText()),this}set stroke(e){this.setStroke(e)}get stroke(){return this.getStroke()}getStroke(){return this._stroke}setLineWidth(e){return this._lineWidth!==e&&(this._lineWidth=e,this.rebuildRichText()),this}set lineWidth(e){this.setLineWidth(e)}get lineWidth(){return this.getLineWidth()}getLineWidth(){return this._lineWidth}setSubScale(e){return assert&&assert(isFinite(e)&&e>0),this._subScale!==e&&(this._subScale=e,this.rebuildRichText()),this}set subScale(e){this.setSubScale(e)}get subScale(){return this.getSubScale()}getSubScale(){return this._subScale}setSubXSpacing(e){return assert&&assert(isFinite(e)),this._subXSpacing!==e&&(this._subXSpacing=e,this.rebuildRichText()),this}set subXSpacing(e){this.setSubXSpacing(e)}get subXSpacing(){return this.getSubXSpacing()}getSubXSpacing(){return this._subXSpacing}setSubYOffset(e){return assert&&assert(isFinite(e)),this._subYOffset!==e&&(this._subYOffset=e,this.rebuildRichText()),this}set subYOffset(e){this.setSubYOffset(e)}get subYOffset(){return this.getSubYOffset()}getSubYOffset(){return this._subYOffset}setSupScale(e){return assert&&assert(isFinite(e)&&e>0),this._supScale!==e&&(this._supScale=e,this.rebuildRichText()),this}set supScale(e){this.setSupScale(e)}get supScale(){return this.getSupScale()}getSupScale(){return this._supScale}setSupXSpacing(e){return assert&&assert(isFinite(e)),this._supXSpacing!==e&&(this._supXSpacing=e,this.rebuildRichText()),this}set supXSpacing(e){this.setSupXSpacing(e)}get supXSpacing(){return this.getSupXSpacing()}getSupXSpacing(){return this._supXSpacing}setSupYOffset(e){return assert&&assert(isFinite(e)),this._supYOffset!==e&&(this._supYOffset=e,this.rebuildRichText()),this}set supYOffset(e){this.setSupYOffset(e)}get supYOffset(){return this.getSupYOffset()}getSupYOffset(){return this._supYOffset}setCapHeightScale(e){return assert&&assert(isFinite(e)&&e>0),this._capHeightScale!==e&&(this._capHeightScale=e,this.rebuildRichText()),this}set capHeightScale(e){this.setCapHeightScale(e)}get capHeightScale(){return this.getCapHeightScale()}getCapHeightScale(){return this._capHeightScale}setUnderlineLineWidth(e){return assert&&assert(isFinite(e)&&e>0),this._underlineLineWidth!==e&&(this._underlineLineWidth=e,this.rebuildRichText()),this}set underlineLineWidth(e){this.setUnderlineLineWidth(e)}get underlineLineWidth(){return this.getUnderlineLineWidth()}getUnderlineLineWidth(){return this._underlineLineWidth}setUnderlineHeightScale(e){return assert&&assert(isFinite(e)&&e>0),this._underlineHeightScale!==e&&(this._underlineHeightScale=e,this.rebuildRichText()),this}set underlineHeightScale(e){this.setUnderlineHeightScale(e)}get underlineHeightScale(){return this.getUnderlineHeightScale()}getUnderlineHeightScale(){return this._underlineHeightScale}setStrikethroughLineWidth(e){return assert&&assert(isFinite(e)&&e>0),this._strikethroughLineWidth!==e&&(this._strikethroughLineWidth=e,this.rebuildRichText()),this}set strikethroughLineWidth(e){this.setStrikethroughLineWidth(e)}get strikethroughLineWidth(){return this.getStrikethroughLineWidth()}getStrikethroughLineWidth(){return this._strikethroughLineWidth}setStrikethroughHeightScale(e){return assert&&assert(isFinite(e)&&e>0),this._strikethroughHeightScale!==e&&(this._strikethroughHeightScale=e,this.rebuildRichText()),this}set strikethroughHeightScale(e){this.setStrikethroughHeightScale(e)}get strikethroughHeightScale(){return this.getStrikethroughHeightScale()}getStrikethroughHeightScale(){return this._strikethroughHeightScale}setLinkFill(e){return this._linkFill!==e&&(this._linkFill=e,this.rebuildRichText()),this}set linkFill(e){this.setLinkFill(e)}get linkFill(){return this.getLinkFill()}getLinkFill(){return this._linkFill}setLinkEventsHandled(e){return this._linkEventsHandled!==e&&(this._linkEventsHandled=e,this.rebuildRichText()),this}set linkEventsHandled(e){this.setLinkEventsHandled(e)}get linkEventsHandled(){return this.getLinkEventsHandled()}getLinkEventsHandled(){return this._linkEventsHandled}setLinks(e){return assert&&assert(e===!0||Object.getPrototypeOf(e)===Object.prototype),this._links!==e&&(this._links=e,this.rebuildRichText()),this}getLinks(){return this._links}set links(e){this.setLinks(e)}get links(){return this.getLinks()}setNodes(e){return assert&&assert(Object.getPrototypeOf(e)===Object.prototype),this._nodes!==e&&(this._nodes=e,this.rebuildRichText()),this}getNodes(){return this._nodes}set nodes(e){this.setNodes(e)}get nodes(){return this.getNodes()}setReplaceNewlines(e){return this._replaceNewlines!==e&&(this._replaceNewlines=e,this.rebuildRichText()),this}set replaceNewlines(e){this.setReplaceNewlines(e)}get replaceNewlines(){return this.getReplaceNewlines()}getReplaceNewlines(){return this._replaceNewlines}setAlign(e){return assert&&assert(e==="left"||e==="center"||e==="right"),this._align!==e&&(this._align=e,this.rebuildRichText()),this}set align(e){this.setAlign(e)}get align(){return this.getAlign()}getAlign(){return this._align}setLeading(e){return assert&&assert(isFinite(e)),this._leading!==e&&(this._leading=e,this.rebuildRichText()),this}set leading(e){this.setLeading(e)}get leading(){return this.getLeading()}getLeading(){return this._leading}setLineWrap(e){return assert&&assert(e===null||e==="stretch"||isFinite(e)&&e>0),this._lineWrap!==e&&(this._lineWrap=e,this.rebuildRichText()),this}set lineWrap(e){this.setLineWrap(e)}get lineWrap(){return this.getLineWrap()}getLineWrap(){return this._lineWrap}mutate(e){return assert&&e&&e.hasOwnProperty("string")&&e.hasOwnProperty(Vi.STRING_PROPERTY_NAME)&&e.stringProperty&&assert&&assert(e.stringProperty.value===e.string,"If both string and stringProperty are provided, then values should match"),super.mutate(e)}static stringWithFont(e,t){return`<span style='font-style: ${t.style};font-variant: ${t.variant};font-weight: ${t.weight};font-stretch: ${t.stretch};font-size: ${t.size};font-family: ${t.family};line-height: ${t.lineHeight};'>${e}</span>`}static himalayaElementToString(e,t){if(Qh(e))return Ns.contentToString(e.content,t);if(Zh(e)){const i=fs.himalayaGetAttribute("dir",e);return e.tagName==="span"&&i&&(t=i==="ltr"),e.children.map(n=>Ns.himalayaElementToString(n,t)).join("")}else return""}static himalayaElementToAccessibleString(e,t){if(Qh(e))return Ns.contentToString(e.content,t);if(Zh(e)){const i=fs.himalayaGetAttribute("dir",e);e.tagName==="span"&&i&&(t=i==="ltr");const n=e.children.map(r=>Ns.himalayaElementToAccessibleString(r,t)).join("");return _.includes(lL,e.tagName)?`<${e.tagName}>${n}</${e.tagName}>`:n}else return""}static contentToString(e,t){const i=he.decode(e);return t?`${i}`:`${i}`}};Ns.STRING_PROPERTY_TANDEM_NAME=Vi.STRING_PROPERTY_TANDEM_NAME;let Mn=Ns;Mn.prototype._mutatorKeys=aL.concat(Ge.prototype._mutatorKeys);q.register("RichText",Mn);Mn.RichTextIO=new li("RichTextIO",{valueType:Mn,supertype:Ge.NodeIO,documentation:"The PhET-iO Type for the scenery RichText node"});class cL extends vu(Vi){constructor(e,t){const i=je()({readingBlockNameResponse:e,tagName:"p",innerContent:e},t);super(e),this.focusHighlight=new Xl(this),this.mutate(i)}}q.register("VoicingText",cL);class uL extends vu(Mn){constructor(e,t){const i=je()({readingBlockNameResponse:e,innerContent:e,readingBlockTagName:"button"},t);super(e,i),this.focusHighlight=new Xl(this)}}q.register("VoicingRichText",uL);const xi=l=>{if(l instanceof We)return{type:"Vector2",x:l.x,y:l.y};if(l instanceof $e)return{type:"Matrix3",m00:l.m00(),m01:l.m01(),m02:l.m02(),m10:l.m10(),m11:l.m11(),m12:l.m12(),m20:l.m20(),m21:l.m21(),m22:l.m22()};if(l instanceof Be){const e=l;return{type:"Bounds2",maxX:e.maxX,maxY:e.maxY,minX:e.minX,minY:e.minY}}else{if(l instanceof yt)return{type:"Shape",path:l.getSVGPath()};if(Array.isArray(l))return{type:"Array",value:l.map(xi)};if(l instanceof Me)return{type:"Color",red:l.red,green:l.green,blue:l.blue,alpha:l.alpha};if(l instanceof Is)return{type:"Property",value:xi(l.value)};if(l instanceof vt)return{type:"TinyProperty",value:xi(l.value)};if(Bs&&l instanceof Bs){const e={};return l.transformMatrix&&(e.transformMatrix=xi(l.transformMatrix)),ls&&(l instanceof ra||l instanceof na)&&(e.stops=l.stops.map(t=>({ratio:t.ratio,stop:xi(t.color)})),e.start=xi(l.start),e.end=xi(l.end),na&&l instanceof na?e.type="LinearGradient":ra&&l instanceof ra&&(e.type="RadialGradient",e.startRadius=l.startRadius,e.endRadius=l.endRadius)),or&&l instanceof or&&(e.type="Pattern",e.url=l.image.src),e}else if(l instanceof Ge){const e=l,t={},i={};["visible","opacity","disabledOpacity","pickable","inputEnabled","cursor","transformBounds","renderer","usesOpacity","layerSplit","cssTransform","excludeInvisible","webglScale","preventFit"].forEach(r=>{e[r]!==Ge.DEFAULT_NODE_OPTIONS[r]&&(t[r]=e[r])}),["tagName","innerContent","accessibleName","helpText"].forEach(r=>{e[r]!==null&&(t[r]=e[r])}),["maxWidth","maxHeight","clipArea","mouseArea","touchArea"].forEach(r=>{e[r]!==Ge.DEFAULT_NODE_OPTIONS[r]&&(i[r]=xi(e[r]))}),e.matrix.isIdentity()||(i.matrix=xi(e.matrix)),e._localBoundsOverridden&&(i.localBounds=xi(e.localBounds)),i.children=e.children.map(r=>r.id),i.hasInputListeners=e.inputListeners.length>0;const n={id:e.id,type:"Node",types:vs(e.constructor).map(r=>r.name).filter(r=>r&&r!=="Object"&&r!=="Node"),name:e.constructor.name,options:t,setup:i};if(mi&&e instanceof mi&&(n.type="Path",i.path=xi(e.shape),e.boundsMethod!==mi.DEFAULT_PATH_OPTIONS.boundsMethod&&(t.boundsMethod=e.boundsMethod)),ga&&e instanceof ga&&(n.type="Circle",t.radius=e.radius),An&&e instanceof An&&(n.type="Line",t.x1=e.x1,t.y1=e.y1,t.x2=e.x2,t.y2=e.y2),vi&&e instanceof vi&&(n.type="Rectangle",t.rectX=e.rectX,t.rectY=e.rectY,t.rectWidth=e.rectWidth,t.rectHeight=e.rectHeight,t.cornerXRadius=e.cornerXRadius,t.cornerYRadius=e.cornerYRadius),Vi&&e instanceof Vi&&(n.type="Text",e.boundsMethod!=="hybrid"&&(t.boundsMethod=e.boundsMethod),t.string=e.string,t.font=e.font),qi&&e instanceof qi&&(n.type="Image",["imageOpacity","initialWidth","initialHeight","mipmapBias","mipmapInitialLevel","mipmapMaxLevel"].forEach(r=>{e[r]!==qi.DEFAULT_IMAGE_OPTIONS[r]&&(t[r]=e[r])}),i.width=e.imageWidth,i.height=e.imageHeight,e._mipmapData?(i.imageType="mipmapData",i.mipmapData=e._mipmapData.map(r=>({url:r.url,width:r.width,height:r.height}))):(e._mipmap&&(i.generateMipmaps=!0),e._image instanceof HTMLImageElement?(i.imageType="image",i.src=e._image.src):e._image instanceof HTMLCanvasElement&&(i.imageType="canvas",i.src=e._image.toDataURL()))),Tr&&e instanceof Tr||pn&&e instanceof pn){n.type=Tr&&e instanceof Tr?"CanvasNode":"WebGLNode",i.canvasBounds=xi(e.canvasBounds);const r=1,h=document.createElement("canvas");h.width=Math.ceil(e.canvasBounds.width*r),h.height=Math.ceil(e.canvasBounds.height*r);const p=h.getContext("2d"),S=new sr(h,p),C=$e.scale(1/r);S.context.setTransform(r,0,0,r,-e.canvasBounds.left,-e.canvasBounds.top),e.renderToCanvasSelf(S,C),i.url=h.toDataURL(),i.scale=r,i.offset=xi(e.canvasBounds.leftTop)}return Io&&e instanceof Io&&(n.type="DOM",n.element=new self.XMLSerializer().serializeToString(e.element),e.element instanceof self.HTMLCanvasElement&&(n.dataURL=e.element.toDataURL()),t.preventTransform=e.preventTransform),(mi&&e instanceof mi||Vi&&e instanceof Vi)&&(["fillPickable","strokePickable","lineWidth","lineCap","lineJoin","lineDashOffset","miterLimit"].forEach(r=>{e[r]!==er[r]&&(t[r]=e[r])}),e.fill!==er.fill&&(i.fill=xi(e.fill)),e.stroke!==er.stroke&&(i.stroke=xi(e.stroke)),e.lineDash.length&&(i.lineDash=xi(e.lineDash))),n}else return l instanceof Fi?{type:"Display",width:l.width,height:l.height,backgroundColor:xi(l.backgroundColor),tree:{type:"Subtree",rootNodeId:l.rootNode.id,nodes:ym(l.rootNode)}}:{type:"value",value:l}}},ym=l=>l.getSubtreeNodes().map(xi);q.register("scenerySerialize",xi);const Ni=l=>{const e=["Node","Path","Circle","Line","Rectangle","Text","Image","CanvasNode","WebGLNode","DOM"];if(l.type==="Vector2")return new We(l.x,l.y);if(l.type==="Matrix3")return new $e().rowMajor(l.m00,l.m01,l.m02,l.m10,l.m11,l.m12,l.m20,l.m21,l.m22);if(l.type==="Bounds2")return new Be(l.minX,l.minY,l.maxX,l.maxY);if(l.type==="Shape")return new yt(l.path);if(l.type==="Array")return l.value.map(Ni);if(l.type==="Color")return new Me(l.red,l.green,l.blue,l.alpha);if(l.type==="Property")return new ei(Ni(l.value));if(l.type==="TinyProperty")return new vt(Ni(l.value));if(l.type==="Pattern"||l.type==="LinearGradient"||l.type==="RadialGradient"){let t;if(l.type==="Pattern"){const i=new self.Image;i.src=l.url,t=new or(i)}else{const i=Ni(l.start),n=Ni(l.end);l.type==="LinearGradient"?t=new na(i.x,i.y,n.x,n.y):l.type==="RadialGradient"&&(t=new ra(i.x,i.y,l.startRadius,n.x,n.y,l.endRadius)),l.stops.forEach(r=>{t.addColorStop(r.ratio,Ni(r.stop))})}return l.transformMatrix&&t.setTransformMatrix(Ni(l.transformMatrix)),t}else if(_.includes(e,l.type)){let t;const i=l.setup;if(l.type==="Node")t=new Ge;else if(l.type==="Path")t=new mi(Ni(i.path));else if(l.type==="Circle")t=new ga({});else if(l.type==="Line")t=new An({});else if(l.type==="Rectangle")t=new vi({});else if(l.type==="Text")t=new Vi("");else if(l.type==="Image"){if(i.imageType==="image"||i.imageType==="canvas")t=new qi(i.src),i.generateMipmaps&&(t.mipmap=!0);else if(i.imageType==="mipmapData"){const n=i.mipmapData.map(r=>{const h={width:r.width,height:r.height,url:r.url};h.img=new self.Image,h.img.src=r.url,h.canvas=document.createElement("canvas"),h.canvas.width=r.width,h.canvas.height=r.height;const p=h.canvas.getContext("2d");return h.updateCanvas=function(){h.img.complete&&(typeof h.img.naturalWidth>"u"||h.img.naturalWidth>0)&&(p.drawImage(h.img,0,0),delete h.updateCanvas)},h});t=new qi(n)}t.initialWidth=i.width,t.initialHeight=i.height}else if(l.type==="CanvasNode"||l.type==="WebGLNode")t=new Ge({children:[new qi(i.url,{translation:Ni(i.offset),scale:1/i.scale})]});else if(l.type==="DOM"){const n=document.createElement("div");n.innerHTML=l.element;const r=n.childNodes[0];if(n.removeChild(r),l.dataURL){const h=new self.Image;h.onload=()=>{r.getContext("2d").drawImage(h,0,0)},h.src=l.dataURL}t=new Io(r)}return i.clipArea&&(t.clipArea=Ni(i.clipArea)),i.mouseArea&&(t.mouseArea=Ni(i.mouseArea)),i.touchArea&&(t.touchArea=Ni(i.touchArea)),i.matrix&&(t.matrix=Ni(i.matrix)),i.localBounds&&(t.localBounds=Ni(i.localBounds)),i.fill&&(t.fill=Ni(i.fill)),i.stroke&&(t.stroke=Ni(i.stroke)),i.lineDash&&(t.lineDash=Ni(i.lineDash)),t.mutate(l.options),t._serialization=l,t}else if(l.type==="Subtree"){const t={},i=l.nodes.map(Ni);return i.forEach(n=>{t[n._serialization.id]=n}),i.forEach(n=>{n._serialization.setup.children.forEach(r=>{n.addChild(t[r])})}),t[l.rootNodeId]}else return l.type==="value"?l.value:null};q.register("sceneryDeserialize",Ni);const dL=l=>Ni(xi(l));q.register("sceneryCopy",dL);let pL=1;class Ii{initialize(e){return assert&&assert(!this.id||this.isDisposed,"If we previously existed, we need to have been disposed"),this.id=this.id||pL++,sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] initialize ${this.toString()}`),this.clean(),this.renderer=e,this.dirty=!0,this.isDisposed=!1,this.linksDirty=!1,this.visibleProperty=new vt(!0),this.fittableProperty=new vt(!0),this}clean(){this.parentDrawable=null,this.backbone=null,this.pendingParentDrawable=null,this.pendingBackbone=null,this.pendingAddition=!1,this.pendingRemoval=!1,assert&&assert(!this.previousDrawable&&!this.nextDrawable,"By cleaning (disposal or fresh creation), we should have disconnected from the linked list"),this.previousDrawable=null,this.nextDrawable=null,this.oldPreviousDrawable=null,this.oldNextDrawable=null,this.visibleProperty&&this.visibleProperty.removeAllListeners(),this.fittableProperty&&this.fittableProperty.removeAllListeners()}update(){let e=!1;return this.dirty&&!this.isDisposed&&(this.dirty=!1,e=!0),e}setVisible(e){this.visibleProperty.value=e}set visible(e){this.setVisible(e)}isVisible(){return this.visibleProperty.value}get visible(){return this.isVisible()}setFittable(e){this.fittableProperty.value=e}set fittable(e){this.setFittable(e)}isFittable(){return this.fittableProperty.value}get fittable(){return this.isFittable()}setBlockBackbone(e){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] setBlockBackbone ${this.toString()} with ${e.toString()}`),assert&&assert(this instanceof nr),this.parentDrawable=e,this.backbone=e,this.pendingParentDrawable=e,this.pendingBackbone=e,this.pendingAddition=!1,this.pendingRemoval=!1}notePendingAddition(e,t,i){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] notePendingAddition ${this.toString()} with ${t.toString()}, ${i?i.toString():"-"}`),assert&&assert(i!==void 0,"backbone can be either null or a backbone"),assert&&assert(t instanceof nr),this.pendingParentDrawable=t,this.pendingBackbone=i,this.pendingAddition=!0,this.pendingRemoval||e.markDrawableChangedBlock(this)}notePendingRemoval(e){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] notePendingRemoval ${this.toString()}`),this.pendingRemoval=!0,this.pendingAddition||e.markDrawableChangedBlock(this)}notePendingMove(e,t){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] notePendingMove ${this.toString()} with ${t.toString()}`),assert&&assert(t instanceof nr),this.pendingParentDrawable=t,(!this.pendingRemoval||!this.pendingAddition)&&e.markDrawableChangedBlock(this),this.pendingAddition=!0,this.pendingRemoval=!0}updateBlock(){sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] updateBlock ${this.toString()} with add:${this.pendingAddition} remove:${this.pendingRemoval} old:${this.parentDrawable?this.parentDrawable.toString():"-"} new:${this.pendingParentDrawable?this.pendingParentDrawable.toString():"-"}`),sceneryLog&&sceneryLog.Drawable&&sceneryLog.push();let e=!1;return(this.pendingRemoval||this.pendingAddition)&&(e=!this.pendingRemoval||!this.pendingAddition||this.parentDrawable!==this.pendingParentDrawable||this.backbone!==this.pendingBackbone,e?(this.pendingRemoval&&(sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`removing from ${this.parentDrawable.toString()}`),this.parentDrawable.removeDrawable(this),this.pendingAddition||(this.pendingParentDrawable=null,this.pendingBackbone=null)),this.parentDrawable=this.pendingParentDrawable,this.backbone=this.pendingBackbone,this.pendingAddition&&(sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`adding to ${this.parentDrawable.toString()}`),this.parentDrawable.addDrawable(this))):(sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable("unchanged"),this.pendingAddition&&ne.isCanvas(this.renderer)&&this.parentDrawable.onPotentiallyMovedDrawable(this)),this.pendingAddition=!1,this.pendingRemoval=!1),sceneryLog&&sceneryLog.Drawable&&sceneryLog.pop(),e}updateLinks(){this.oldNextDrawable=this.nextDrawable,this.oldPreviousDrawable=this.previousDrawable,this.linksDirty=!1}markDirty(){this.dirty||(this.dirty=!0,this.parentDrawable&&this.parentDrawable.markDirtyDrawable(this))}markLinksDirty(e){this.linksDirty||(this.linksDirty=!0,e.markDrawableForLinksUpdate(this))}markForDisposal(e){Ii.disconnectBefore(this,e),Ii.disconnectAfter(this,e),e.markDrawableForDisposal(this)}disposeImmediately(e){Ii.disconnectBefore(this,e),Ii.disconnectAfter(this,e),this.dispose()}dispose(){assert&&assert(!this.isDisposed,"We should not re-dispose drawables"),sceneryLog&&sceneryLog.Drawable&&sceneryLog.Drawable(`[${this.constructor.name}*] dispose ${this.toString()}`),sceneryLog&&sceneryLog.Drawable&&sceneryLog.push(),this.clean(),this.isDisposed=!0,this.freeToPool(),sceneryLog&&sceneryLog.Drawable&&sceneryLog.pop()}audit(e,t,i){assertSlow&&(assertSlow&&assertSlow(!this.isDisposed,"If we are being audited, we assume we are in the drawable display tree, and we should not be marked as disposed"),assertSlow&&assertSlow(this.renderer,"Should not have a 0 (no) renderer"),assertSlow&&assertSlow(!this.backbone||this.parentDrawable,"If we have a backbone reference, we must have a parentDrawable (our block)"),e||(assertSlow&&assertSlow(!this.pendingAddition),assertSlow&&assertSlow(!this.pendingRemoval),assertSlow&&assertSlow(this.parentDrawable===this.pendingParentDrawable,"Assure our parent and pending parent match, if we have updated blocks"),assertSlow&&assertSlow(this.backbone===this.pendingBackbone,"Assure our backbone and pending backbone match, if we have updated blocks")),t||(assertSlow&&assertSlow(this.oldPreviousDrawable===this.previousDrawable,"Pending linked-list references should be cleared by now"),assertSlow&&assertSlow(this.oldNextDrawable===this.nextDrawable,"Pending linked-list references should be cleared by now"),assertSlow&&assertSlow(!this.linksDirty,"Links dirty flag should be clean")),i||assertSlow&&assertSlow(!this.dirty,"Should not be dirty at this phase, if we are in the drawable display tree"))}toString(){return`${this.constructor.name}#${this.id}`}toDetailedString(){return this.toString()}static connectDrawables(e,t,i){e.nextDrawable!==t&&(e.nextDrawable&&(e.nextDrawable.markLinksDirty(i),e.nextDrawable.previousDrawable=null),t.previousDrawable&&(t.previousDrawable.markLinksDirty(i),t.previousDrawable.nextDrawable=null),e.nextDrawable=t,t.previousDrawable=e,e.markLinksDirty(i),t.markLinksDirty(i))}static disconnectBefore(e,t){e.previousDrawable&&(e.markLinksDirty(t),e.previousDrawable.markLinksDirty(t),e.previousDrawable.nextDrawable=null,e.previousDrawable=null)}static disconnectAfter(e,t){e.nextDrawable&&(e.markLinksDirty(t),e.nextDrawable.markLinksDirty(t),e.nextDrawable.previousDrawable=null,e.nextDrawable=null)}static listToArray(e,t){const i=[];for(let n=e;i.push(n),n!==t;n=n.nextDrawable);return i}static oldListToArray(e,t){const i=[];for(let n=e;i.push(n),n!==t;n=n.oldNextDrawable);return i}}q.register("Drawable",Ii);class _s extends Ii{constructor(e,t){assert&&assert(typeof e=="number"),assert&&assert(t),super(),this.initialize(e,t)}initialize(e,t){return super.initialize(e),this.drawableVisibilityListener=this.drawableVisibilityListener||this.updateSelfVisibility.bind(this),this.instance=t,this.node=t.trail.lastNode(),this.node.attachDrawable(this),this.instance.selfVisibleEmitter.addListener(this.drawableVisibilityListener),this.updateSelfVisibility(),this}dispose(){this.instance.selfVisibleEmitter.removeListener(this.drawableVisibilityListener),this.node.detachDrawable(this),this.instance=null,this.node=null,super.dispose()}updateSelfVisibility(){this.visible=this.instance.selfVisible}toDetailedString(){return`${this.toString()} (${this.instance.trail.toPathString()})`}}q.register("SelfDrawable",_s);const bm=Ai(l=>(assert&&assert(_.includes(vs(l),_s)),class extends l{initialize(e,t,...i){super.initialize(e,t,...i),this.fillCallback=this.fillCallback||this.markDirtyFill.bind(this),this.strokeCallback=this.strokeCallback||this.markDirtyStroke.bind(this),this.fillObserver=this.fillObserver||new fa(this.fillCallback),this.strokeObserver=this.strokeObserver||new fa(this.strokeCallback),this.fillObserver.setPrimary(t.node._fill),this.strokeObserver.setPrimary(t.node._stroke)}dispose(){this.fillObserver.clean(),this.strokeObserver.clean(),super.dispose()}markDirtyFill(){assert&&Me.checkPaint(this.instance.node._fill),this.markPaintDirty(),this.fillObserver.setPrimary(this.instance.node._fill)}markDirtyStroke(){assert&&Me.checkPaint(this.instance.node._stroke),this.markPaintDirty(),this.strokeObserver.setPrimary(this.instance.node._stroke)}markDirtyLineWidth(){this.markPaintDirty()}markDirtyLineOptions(){this.markPaintDirty()}markDirtyCachedPaints(){this.markPaintDirty()}}));q.register("PaintableStatelessDrawable",bm);const Vo=bm,Pa=Ai(l=>(assert&&assert(_.includes(vs(l),_s)),class extends l{initialize(e,t,...i){super.initialize(e,t,...i),this.dirtyFill=!0,this.hadStroke=!1,this.dirtyStroke=!0,this.dirtyLineWidth=!0,this.dirtyLineOptions=!0,this.dirtyCachedPaints=!0,this.lastCachedPaints=[],this.fillCallback=this.fillCallback||this.markDirtyFill.bind(this),this.strokeCallback=this.strokeCallback||this.markDirtyStroke.bind(this),this.fillObserver=this.fillObserver||new fa(this.fillCallback),this.strokeObserver=this.strokeObserver||new fa(this.strokeCallback),this.fillObserver.setPrimary(t.node._fill),this.strokeObserver.setPrimary(t.node._stroke)}cleanPaintableState(){this.dirtyFill=!1,this.dirtyStroke=!1,this.dirtyLineWidth=!1,this.dirtyLineOptions=!1,this.dirtyCachedPaints=!1,this.hadStroke=this.node.getStroke()!==null}dispose(){super.dispose(),this.fillObserver.clean(),this.strokeObserver.clean()}markDirtyFill(){assert&&Me.checkPaint(this.instance.node._fill),this.dirtyFill=!0,this.markPaintDirty(),this.fillObserver.setPrimary(this.instance.node._fill)}markDirtyStroke(){assert&&Me.checkPaint(this.instance.node._stroke),this.dirtyStroke=!0,this.markPaintDirty(),this.strokeObserver.setPrimary(this.instance.node._stroke)}markDirtyLineWidth(){this.dirtyLineWidth=!0,this.markPaintDirty()}markDirtyLineOptions(){this.dirtyLineOptions=!0,this.markPaintDirty()}markDirtyCachedPaints(){this.dirtyCachedPaints=!0,this.markPaintDirty()}}));q.register("PaintableStatefulDrawable",Pa);class Nn extends _s{initialize(e,t){super.initialize(e,t),this.transformListener=this.transformListener||this.markTransformDirty.bind(this),t.relativeTransform.addListener(this.transformListener),t.relativeTransform.addPrecompute()}markTransformDirty(){this.markDirty()}markPaintDirty(){this.markDirty()}updateSelfVisibility(){super.updateSelfVisibility(),this.markDirty()}dispose(){this.instance.relativeTransform.removeListener(this.transformListener),this.instance.relativeTransform.removePrecompute(),super.dispose()}}q.register("CanvasSelfDrawable",Nn);class Sa extends _s{initialize(e,t){return super.initialize(e,t),this.transformListener=this.transformListener||this.markTransformDirty.bind(this),this.markTransformDirty(),this.visibilityDirty=!0,t.relativeTransform.addListener(this.transformListener),t.relativeTransform.addPrecompute(),this}markTransformDirty(){this.transformDirty=!0,this.markDirty()}getTransformMatrix(){return this.instance.relativeTransform.validate(),this.instance.relativeTransform.matrix}update(){return super.update()?(this.updateDOM(),this.visibilityDirty&&(this.visibilityDirty=!1,this.domElement.style.visibility=this.visible?"":"hidden"),this.cleanPaintableState&&this.cleanPaintableState(),!0):!1}updateDOM(){}updateSelfVisibility(){super.updateSelfVisibility(),this.visibilityDirty||(this.visibilityDirty=!0,this.markDirty())}dispose(){this.instance.relativeTransform.removeListener(this.transformListener),this.instance.relativeTransform.removePrecompute(),super.dispose()}}q.register("DOMSelfDrawable",Sa);class Br extends _s{initialize(e,t,i,n){return assert&&assert(typeof i=="boolean"),assert&&assert(typeof n=="boolean"),super.initialize(e,t),this.usesPaint=i,this.keepElements=n,this.svgElement=null,this.svgBlock=null,this.usesPaint&&(this.paintState?this.paintState.initialize():this.paintState=new wf),this}update(){return super.update()?(this.updateSVG(),!0):!1}updateSVG(){if(this.paintDirty&&this.updateSVGSelf(this.node,this.svgElement),this.usesPaint&&this.dirtyCachedPaints){const e=this.node._cachedPaints.slice();let t,i;for(t=0;t<e.length;t++){const n=e[t];let r=!0;for(i=0;i<this.lastCachedPaints.length;i++)if(n===this.lastCachedPaints[i]){r=!1;break}r&&this.svgBlock.incrementPaint(n)}for(t=0;t<this.lastCachedPaints.length;t++){const n=this.lastCachedPaints[t];let r=!0;for(i=0;i<e.length;i++)if(n===e[i]){r=!1;break}r&&this.svgBlock.decrementPaint(n)}this.lastCachedPaints=e}this.setToCleanState()}updateFillStrokeStyle(e){if(!this.usesPaint)return;this.dirtyFill&&this.paintState.updateFill(this.svgBlock,this.node.getFillValue()),this.dirtyStroke&&this.paintState.updateStroke(this.svgBlock,this.node.getStrokeValue());const t=this.dirtyLineWidth||this.dirtyLineOptions;t&&this.paintState.updateStrokeDetailStyle(this.node),(this.dirtyFill||this.dirtyStroke||t)&&e.setAttribute("style",this.paintState.baseStyle+this.paintState.strokeDetailStyle),this.cleanPaintableState()}updateSVGBlock(e){const t=this.svgBlock;if(this.usesPaint&&t)for(let i=0;i<this.lastCachedPaints.length;i++)t.decrementPaint(this.lastCachedPaints[i]);if(this.svgBlock=e,this.usesPaint)for(let i=0;i<this.lastCachedPaints.length;i++)e.incrementPaint(this.lastCachedPaints[i]);this.updateDefsSelf&&this.updateDefsSelf(e),this.usesPaint&&this.paintState.updateSVGBlock(e),this.usesPaint&&this.markDirtyFill(),this.usesPaint&&this.markDirtyStroke()}dispose(){this.keepElements||(this.svgElement=null),this.updateDefsSelf&&this.updateDefsSelf(null),this.usesPaint&&this.paintState.dispose(),this.defs=null,this.svgBlock=null,super.dispose()}}q.register("SVGSelfDrawable",Br);class Go extends _s{initialize(e,t){return super.initialize(e,t),this.transformListener=this.transformListener||this.markTransformDirty.bind(this),t.relativeTransform.addListener(this.transformListener),t.relativeTransform.addPrecompute(),this}markTransformDirty(){this.markDirty()}updateSelfVisibility(){super.updateSelfVisibility(),this.markDirty()}dispose(){this.instance.relativeTransform.removeListener(this.transformListener),this.instance.relativeTransform.removePrecompute(),super.dispose()}}q.register("WebGLSelfDrawable",Go);const Mu=Ai(l=>(assert&&assert(_.includes(vs(l),_s)),class extends Pa(l){initialize(e,t,...i){super.initialize(e,t,...i),this.paintDirty=!0,this.dirtyRadius=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyRadius(){this.dirtyRadius=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyRadius=!1}}));q.register("CircleStatefulDrawable",Mu);const vm=Ai(l=>(assert&&assert(_.includes(vs(l),_s)),class extends l{initialize(e,t,...i){super.initialize(e,t,...i),this.paintDirty=!0,this.dirtyImage=!0,this.dirtyImageOpacity=!0,this.dirtyMipmap=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyImage(){this.dirtyImage=!0,this.markPaintDirty()}markDirtyImageOpacity(){this.dirtyImageOpacity=!0,this.markPaintDirty()}markDirtyMipmap(){this.dirtyMipmap=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyImage=!1,this.dirtyImageOpacity=!1,this.dirtyMipmap=!1}}));q.register("ImageStatefulDrawable",vm);const Nu=vm,_m=Ai(l=>(assert&&assert(_.includes(vs(l),_s)),class extends Vo(l){initialize(e,t,...i){super.initialize(e,t,...i),this.paintDirty=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyLine(){this.markPaintDirty()}markDirtyP1(){this.markPaintDirty()}markDirtyP2(){this.markPaintDirty()}markDirtyX1(){this.markPaintDirty()}markDirtyY1(){this.markPaintDirty()}markDirtyX2(){this.markPaintDirty()}markDirtyY2(){this.markPaintDirty()}}));q.register("LineStatelessDrawable",_m);const Lm=Ai(l=>(assert&&assert(_.includes(vs(l),_s)),class extends Pa(l){initialize(e,t,...i){super.initialize(e,t,...i),this.paintDirty=!0,this.dirtyX1=!0,this.dirtyY1=!0,this.dirtyX2=!0,this.dirtyY2=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyLine(){this.dirtyX1=!0,this.dirtyY1=!0,this.dirtyX2=!0,this.dirtyY2=!0,this.markPaintDirty()}markDirtyP1(){this.dirtyX1=!0,this.dirtyY1=!0,this.markPaintDirty()}markDirtyP2(){this.dirtyX2=!0,this.dirtyY2=!0,this.markPaintDirty()}markDirtyX1(){this.dirtyX1=!0,this.markPaintDirty()}markDirtyY1(){this.dirtyY1=!0,this.markPaintDirty()}markDirtyX2(){this.dirtyX2=!0,this.markPaintDirty()}markDirtyY2(){this.dirtyY2=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyX1=!1,this.dirtyY1=!1,this.dirtyX2=!1,this.dirtyY2=!1}}));q.register("LineStatefulDrawable",Lm);const Pm=Ai(l=>(assert&&assert(_.includes(vs(l),_s)),class extends Pa(l){initialize(e,t,...i){super.initialize(e,t,...i),this.paintDirty=!0,this.dirtyShape=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyShape(){this.dirtyShape=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyShape=!1}}));q.register("PathStatefulDrawable",Pm);const gL=Pm,th=Ai(l=>(assert&&assert(_.includes(vs(l),_s)),class extends Pa(l){initialize(e,t,...i){super.initialize(e,t,...i),this.paintDirty=!0,this.dirtyX=!0,this.dirtyY=!0,this.dirtyWidth=!0,this.dirtyHeight=!0,this.dirtyCornerXRadius=!0,this.dirtyCornerYRadius=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyRectangle(){this.dirtyX=!0,this.dirtyY=!0,this.dirtyWidth=!0,this.dirtyHeight=!0,this.dirtyCornerXRadius=!0,this.dirtyCornerYRadius=!0,this.markPaintDirty()}markDirtyX(){this.dirtyX=!0,this.markPaintDirty()}markDirtyY(){this.dirtyY=!0,this.markPaintDirty()}markDirtyWidth(){this.dirtyWidth=!0,this.markPaintDirty()}markDirtyHeight(){this.dirtyHeight=!0,this.markPaintDirty()}markDirtyCornerXRadius(){this.dirtyCornerXRadius=!0,this.markPaintDirty()}markDirtyCornerYRadius(){this.dirtyCornerYRadius=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyX=!1,this.dirtyY=!1,this.dirtyWidth=!1,this.dirtyHeight=!1,this.dirtyCornerXRadius=!1,this.dirtyCornerYRadius=!1}}));q.register("RectangleStatefulDrawable",th);const Sm=Ai(l=>(assert&&assert(_.includes(vs(l),_s)),class extends Pa(l){initialize(e,t,...i){super.initialize(e,t,...i),this.paintDirty=!0,this.dirtyText=!0,this.dirtyFont=!0,this.dirtyBounds=!0}markPaintDirty(){this.paintDirty=!0,this.markDirty()}markDirtyText(){this.dirtyText=!0,this.markPaintDirty()}markDirtyFont(){this.dirtyFont=!0,this.markPaintDirty()}markDirtyBounds(){this.dirtyBounds=!0,this.markPaintDirty()}setToCleanState(){this.paintDirty=!1,this.dirtyText=!1,this.dirtyFont=!1,this.dirtyBounds=!1}}));q.register("TextStatefulDrawable",Sm);const wm=Sm,fL=[];class Ru extends Nn{paintCanvas(e,t,i){if(assert&&assert(!t.selfBounds.isEmpty(),`CanvasNode should not be used with an empty canvasBounds. Please set canvasBounds (or use setCanvasBounds()) on ${t.constructor.name}`),!t.selfBounds.isEmpty()){const n=e.context;n.save(),n.fillStyle="black",n.strokeStyle="black",n.lineWidth=1,n.lineCap="butt",n.lineJoin="miter",n.lineDash=fL,n.lineDashOffset=0,n.miterLimit=10,t.paintCanvas(n),n.restore()}}}q.register("CanvasNodeDrawable",Ru);$t.mixInto(Ru);const mL=Ru;class Bu extends Vo(Nn){paintCanvas(e,t,i){assert&&assert(t instanceof Ge);const n=e.context;n.beginPath(),n.arc(0,0,t._radius,0,Math.PI*2,!1),n.closePath(),t.hasFill()&&(t.beforeCanvasFill(e),n.fill(),t.afterCanvasFill(e)),t.hasPaintableStroke()&&(t.beforeCanvasStroke(e),n.stroke(),t.afterCanvasStroke(e))}markDirtyRadius(){this.markPaintDirty()}dispose(){super.dispose()}}q.register("CircleCanvasDrawable",Bu);$t.mixInto(Bu);const Jp=Bu;class Fu extends Mu(Sa){constructor(e,t){super(e,t),Dt.prepareForTransform(this.domElement)}initialize(e,t){if(super.initialize(e,t),this.matrix=this.matrix||$e.pool.fetch(),!this.fillElement||!this.strokeElement){const i=document.createElement("div");this.fillElement=i;const n=document.createElement("div");this.strokeElement=n,i.style.display="block",i.style.position="absolute",i.style.left="0",i.style.top="0",i.style.pointerEvents="none",n.style.display="block",n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.pointerEvents="none",i.appendChild(n)}this.domElement=this.fillElement}updateDOM(){const e=this.node,t=this.fillElement,i=this.strokeElement;if(this.paintDirty&&(this.dirtyRadius&&(t.style.width=`${2*e._radius}px`,t.style.height=`${2*e._radius}px`,t.style[Qe.borderRadius]=`${e._radius}px`),this.dirtyFill&&(t.style.backgroundColor=e.getCSSFill()),this.dirtyStroke&&(e.hasStroke()?i.style.borderStyle="solid":i.style.borderStyle="none"),e.hasStroke())){const n=!this.hadStroke;(n||this.dirtyLineWidth||this.dirtyRadius)&&(i.style.width=`${2*e._radius-e.getLineWidth()}px`,i.style.height=`${2*e._radius-e.getLineWidth()}px`,i.style[Qe.borderRadius]=`${e._radius+e.getLineWidth()/2}px`),(n||this.dirtyLineWidth)&&(i.style.left=`${-e.getLineWidth()/2}px`,i.style.top=`${-e.getLineWidth()/2}px`,i.style.borderWidth=`${e.getLineWidth()}px`),(n||this.dirtyStroke)&&(i.style.borderColor=e.getSimpleCSSStroke())}if(this.transformDirty||this.dirtyRadius){this.matrix.set(this.getTransformMatrix());const n=$e.translation(-e._radius,-e._radius);this.matrix.multiplyMatrix(n),n.freeToPool(),Dt.applyPreparedTransform(this.matrix,this.fillElement)}this.setToCleanState(),this.cleanPaintableState(),this.transformDirty=!1}dispose(){super.dispose()}}q.register("CircleDOMDrawable",Fu);$t.mixInto(Fu);const yL=Fu,bL=!0;class Hu extends Mu(Br){initialize(e,t){super.initialize(e,t,!0,bL),this.svgElement=this.svgElement||document.createElementNS(Gt,"circle")}updateSVGSelf(){const e=this.svgElement;this.dirtyRadius&&e.setAttribute("r",this.node._radius),this.updateFillStrokeStyle(e)}}q.register("CircleSVGDrawable",Hu);$t.mixInto(Hu);const vL=Hu;class Vu extends Sa{constructor(e,t){super(e,t),Dt.prepareForTransform(this.domElement)}initialize(e,t){super.initialize(e,t),this.domElement=this.node._container}updateDOM(){this.transformDirty&&!this.node._preventTransform&&Dt.applyPreparedTransform(this.getTransformMatrix(),this.domElement),this.transformDirty=!1}dispose(){super.dispose(),this.domElement=null}}q.register("DOMDrawable",Vu);$t.mixInto(Vu);const Wc=Vu;class Gu extends Nn{paintCanvas(e,t,i){const n=t._imageOpacity!==1;if(t._image&&t._image.width!==0&&t._image.height!==0){if(n&&(e.context.save(),e.context.globalAlpha*=t._imageOpacity),t._mipmap&&t.hasMipmaps()){const r=t.getMipmapLevel(i,ms.CANVAS_MIPMAP_BIAS_ADJUSTMENT),h=t.getMipmapCanvas(r),p=Math.pow(2,r);e.context.drawImage(h,0,0,h.width*p,h.height*p)}else e.context.drawImage(t._image,0,0);n&&e.context.restore()}}markDirtyImage(){this.markPaintDirty()}markDirtyMipmap(){this.markPaintDirty()}markDirtyImageOpacity(){this.markPaintDirty()}}q.register("ImageCanvasDrawable",Gu);$t.mixInto(Gu);const eg=Gu;class zu extends Nu(Sa){constructor(e,t){super(e,t),Dt.prepareForTransform(this.domElement)}initialize(e,t){super.initialize(e,t),this.domElement||(this.domElement=document.createElement("img"),this.domElement.style.display="block",this.domElement.style.position="absolute",this.domElement.style.pointerEvents="none",this.domElement.style.left="0",this.domElement.style.top="0"),this.hasOpacity=!1}updateDOM(){const e=this.node,t=this.domElement;this.paintDirty&&this.dirtyImage&&(t.src=e._image?e._image.src:"//:0"),this.dirtyImageOpacity&&(e._imageOpacity===1?this.hasOpacity&&(this.hasOpacity=!1,t.style.opacity=""):(this.hasOpacity=!0,t.style.opacity=e._imageOpacity)),this.transformDirty&&Dt.applyPreparedTransform(this.getTransformMatrix(),this.domElement),this.setToCleanState(),this.transformDirty=!1}dispose(){super.dispose()}}q.register("ImageDOMDrawable",zu);$t.mixInto(zu);const _L=zu,LL=!0;class Wu extends Nu(Br){initialize(e,t){super.initialize(e,t,!1,LL),sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} initialized for ${t.toString()}`),this.svgElement=this.svgElement||document.createElementNS(Gt,"image"),this.svgElement.setAttribute("x","0"),this.svgElement.setAttribute("y","0"),this.hasOpacity=!1,this.usingMipmap=!1,this.mipmapLevel=-1,this._mipmapTransformListener=this._mipmapTransformListener||this.onMipmapTransform.bind(this),this._mipmapListener=this._mipmapListener||this.onMipmap.bind(this),this.node.mipmapEmitter.addListener(this._mipmapListener),this.updateMipmapStatus(t.node._mipmap)}updateSVGSelf(){const e=this.svgElement;this.dirtyImage?(sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Updating dirty image`),this.node._image?this.updateURL(e,!0):(e.setAttribute("width","0"),e.setAttribute("height","0"),e.setAttributeNS(ia,"xlink:href","//:0"))):this.dirtyMipmap&&this.node._image&&(sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Updating dirty mipmap`),this.updateURL(e,!1)),this.dirtyImageOpacity&&(this.node._imageOpacity===1?this.hasOpacity&&(this.hasOpacity=!1,e.removeAttribute("opacity")):(this.hasOpacity=!0,e.setAttribute("opacity",this.node._imageOpacity)))}updateURL(e,t){let i=-1;if(this.node._mipmap&&(i=this.node.getMipmapLevel(this.instance.relativeTransform.matrix),sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Mipmap level: ${i}`)),!(!t&&i===this.mipmapLevel))if(this.mipmapLevel>=0&&i===-1&&e.removeAttribute("transform"),this.mipmapLevel=i,this.node._mipmap&&this.node.hasMipmaps()){sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Setting image URL to mipmap level ${i}`);const n=this.node.getMipmapURL(i),r=this.node.getMipmapCanvas(i);e.setAttribute("width",`${r.width}px`),e.setAttribute("height",`${r.height}px`),e.setAttribute("transform",`scale(${Math.pow(2,i).toFixed(20)})`),e.setAttributeNS(ia,"xlink:href",n)}else sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Setting image URL`),e.setAttribute("width",`${this.node.getImageWidth()}px`),e.setAttribute("height",`${this.node.getImageHeight()}px`),e.setAttributeNS(ia,"xlink:href",this.node.getImageURL())}updateMipmapStatus(e){this.usingMipmap!==e&&(this.usingMipmap=e,e?(sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Adding mipmap compute/listener needs`),this.instance.relativeTransform.addListener(this._mipmapTransformListener),this.instance.relativeTransform.addPrecompute()):(sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Removing mipmap compute/listener needs`),this.instance.relativeTransform.removeListener(this._mipmapTransformListener),this.instance.relativeTransform.removePrecompute()),this.markDirtyMipmap())}onMipmap(){this.markDirtyMipmap(),this.updateMipmapStatus(this.node._mipmap)}onMipmapTransform(){sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} Transform dirties mipmap`),this.markDirtyMipmap()}dispose(){sceneryLog&&sceneryLog.ImageSVGDrawable&&sceneryLog.ImageSVGDrawable(`${this.id} disposing`),this.updateMipmapStatus(!1),this.node.mipmapEmitter.removeListener(this._mipmapListener),super.dispose()}}q.register("ImageSVGDrawable",Wu);$t.mixInto(Wu);const PL=Wu,Fr=5,$a=Fr*0,Ua=Fr*1,Ya=Fr*2,Ka=Fr*3,ja=Fr*4,qa=Fr*5,qr=0,Xr=1,Zr=2,Qr=3,Jr=4;class ih extends Nu(Go){initialize(e,t){super.initialize(e,t),this.vertexArray=this.vertexArray||new Float32Array(Fr*6),this.upperLeft=new We(0,0),this.lowerLeft=new We(0,0),this.upperRight=new We(0,0),this.lowerRight=new We(0,0),this.xyDirty=!0,this.uvDirty=!0,this.updatedOnce=!1,this.sprite=null}onAddToBlock(e){this.webglBlock=e,this.markDirty(),this.reserveSprite()}onRemoveFromBlock(e){this.unreserveSprite()}reserveSprite(){if(this.sprite){if(this.sprite.image===this.node._image)return;this.unreserveSprite()}const e=this.node.getImageWidth(),t=this.node.getImageHeight();this.sprite=e>0&&t>0?this.webglBlock.addSpriteSheetImage(this.node._image,e,t):null,this.xyDirty=!0,this.uvDirty=!0}unreserveSprite(){this.sprite&&this.webglBlock.removeSpriteSheetImage(this.sprite),this.sprite=null}markTransformDirty(){this.xyDirty=!0,super.markTransformDirty()}markPaintDirty(){this.xyDirty=!0,this.uvDirty=!0,this.markDirty()}update(){if(!super.update()||(this.reserveSprite(),(this.dirtyImageOpacity||!this.updatedOnce)&&(this.vertexArray[$a+Jr]=this.node._imageOpacity,this.vertexArray[Ua+Jr]=this.node._imageOpacity,this.vertexArray[Ya+Jr]=this.node._imageOpacity,this.vertexArray[Ka+Jr]=this.node._imageOpacity,this.vertexArray[ja+Jr]=this.node._imageOpacity,this.vertexArray[qa+Jr]=this.node._imageOpacity),this.updatedOnce=!0,!this.sprite))return!1;if(this.uvDirty){this.uvDirty=!1;const e=this.sprite.uvBounds;this.vertexArray[$a+Zr]=e.minX,this.vertexArray[$a+Qr]=e.minY,this.vertexArray[Ua+Zr]=e.minX,this.vertexArray[Ua+Qr]=e.maxY,this.vertexArray[Ya+Zr]=e.maxX,this.vertexArray[Ya+Qr]=e.minY,this.vertexArray[Ka+Zr]=e.maxX,this.vertexArray[Ka+Qr]=e.minY,this.vertexArray[ja+Zr]=e.minX,this.vertexArray[ja+Qr]=e.maxY,this.vertexArray[qa+Zr]=e.maxX,this.vertexArray[qa+Qr]=e.maxY}if(this.xyDirty){this.xyDirty=!1;const e=this.node.getImageWidth(),t=this.node.getImageHeight(),i=this.instance.relativeTransform.matrix;i.multiplyVector2(this.upperLeft.setXY(0,0)),i.multiplyVector2(this.lowerLeft.setXY(0,t)),i.multiplyVector2(this.upperRight.setXY(e,0)),i.multiplyVector2(this.lowerRight.setXY(e,t)),this.vertexArray[$a+qr]=this.upperLeft.x,this.vertexArray[$a+Xr]=this.upperLeft.y,this.vertexArray[Ua+qr]=this.lowerLeft.x,this.vertexArray[Ua+Xr]=this.lowerLeft.y,this.vertexArray[Ya+qr]=this.upperRight.x,this.vertexArray[Ya+Xr]=this.upperRight.y,this.vertexArray[Ka+qr]=this.upperRight.x,this.vertexArray[Ka+Xr]=this.upperRight.y,this.vertexArray[ja+qr]=this.lowerLeft.x,this.vertexArray[ja+Xr]=this.lowerLeft.y,this.vertexArray[qa+qr]=this.lowerRight.x,this.vertexArray[qa+Xr]=this.lowerRight.y}return!0}}ih.prototype.webglRenderer=ne.webglTexturedTriangles;q.register("ImageWebGLDrawable",ih);$t.mixInto(ih);const SL=ih;class $u extends _m(Nn){paintCanvas(e,t,i){assert&&assert(t instanceof Ge);const n=e.context;n.beginPath(),n.moveTo(t.x1,t.y1),n.lineTo(t.x2,t.y2),t.hasPaintableStroke()&&(t.beforeCanvasStroke(e),n.stroke(),t.afterCanvasStroke(e))}}q.register("LineCanvasDrawable",$u);$t.mixInto($u);const tg=$u,wL=!0;class Uu extends Lm(Br){initialize(e,t){super.initialize(e,t,!0,wL),this.svgElement=this.svgElement||document.createElementNS(Gt,"line")}updateSVGSelf(){const e=this.svgElement;this.dirtyX1&&e.setAttribute("x1",this.node.x1),this.dirtyY1&&e.setAttribute("y1",this.node.y1),this.dirtyX2&&e.setAttribute("x2",this.node.x2),this.dirtyY2&&e.setAttribute("y2",this.node.y2),this.updateFillStrokeStyle(e)}}q.register("LineSVGDrawable",Uu);$t.mixInto(Uu);const CL=Uu;class Yu extends Vo(Nn){paintCanvas(e,t,i){const n=e.context;t.hasShape()&&(n.beginPath(),t._shape.writeToContext(n),t.hasFill()&&(t.beforeCanvasFill(e),n.fill(),t.afterCanvasFill(e)),t.hasPaintableStroke()&&(t.beforeCanvasStroke(e),n.stroke(),t.afterCanvasStroke(e)))}markDirtyShape(){this.markPaintDirty()}}q.register("PathCanvasDrawable",Yu);$t.mixInto(Yu);const ig=Yu,TL=!0;class Ku extends gL(Br){initialize(e,t){super.initialize(e,t,!0,TL),this.svgElement=this.svgElement||document.createElementNS(Gt,"path")}updateSVGSelf(){assert&&assert(!this.node.requiresSVGBoundsWorkaround(),"No workaround for https://github.com/phetsims/scenery/issues/196 is provided at this time, please add an epsilon");const e=this.svgElement;if(this.dirtyShape){let t=this.node.hasShape()?this.node._shape.getSVGPath():"";t||(t="M0 0"),e.setAttribute("d",`${t}${_i.safari?" M0 0":""}`)}this.updateFillStrokeStyle(e)}}q.register("PathSVGDrawable",Ku);$t.mixInto(Ku);const DL=Ku;class ju extends Vo(Nn){writeRectangularPath(e,t){e.beginPath(),e.moveTo(t._rectX,t._rectY),e.lineTo(t._rectX+t._rectWidth,t._rectY),e.lineTo(t._rectX+t._rectWidth,t._rectY+t._rectHeight),e.lineTo(t._rectX,t._rectY+t._rectHeight),e.closePath()}paintCanvas(e,t,i){const n=e.context;if(t.isRounded()){n.beginPath();const r=t.getMaximumArcSize(),h=Math.min(t._cornerXRadius,r),p=Math.min(t._cornerYRadius,r),S=t._rectX+h,C=t._rectX+t._rectWidth-h,B=t._rectY+p,U=t._rectY+t._rectHeight-p;h===p?(n.arc(C,B,h,-Math.PI/2,0,!1),n.arc(C,U,h,0,Math.PI/2,!1),n.arc(S,U,h,Math.PI/2,Math.PI,!1),n.arc(S,B,h,Math.PI,Math.PI*3/2,!1)):(n.ellipse(C,B,h,p,0,-Math.PI/2,0,!1),n.ellipse(C,U,h,p,0,0,Math.PI/2,!1),n.ellipse(S,U,h,p,0,Math.PI/2,Math.PI,!1),n.ellipse(S,B,h,p,0,Math.PI,Math.PI*3/2,!1)),n.closePath(),t.hasFill()&&(t.beforeCanvasFill(e),n.fill(),t.afterCanvasFill(e)),t.hasPaintableStroke()&&(t.beforeCanvasStroke(e),n.stroke(),t.afterCanvasStroke(e))}else t.hasFill()&&(t.getFillValue().transformMatrix?(this.writeRectangularPath(n,t),t.beforeCanvasFill(e),n.fill(),t.afterCanvasFill(e)):(t.beforeCanvasFill(e),n.fillRect(t._rectX,t._rectY,t._rectWidth,t._rectHeight),t.afterCanvasFill(e))),t.hasPaintableStroke()&&(t.getStrokeValue().transformMatrix?(this.writeRectangularPath(n,t),t.beforeCanvasStroke(e),n.stroke(),t.afterCanvasStroke(e)):(t.beforeCanvasStroke(e),n.strokeRect(t._rectX,t._rectY,t._rectWidth,t._rectHeight),t.afterCanvasStroke(e)))}markDirtyRectangle(){this.markPaintDirty()}markDirtyX(){this.markDirtyRectangle()}markDirtyY(){this.markDirtyRectangle()}markDirtyWidth(){this.markDirtyRectangle()}markDirtyHeight(){this.markDirtyRectangle()}markDirtyCornerXRadius(){this.markDirtyRectangle()}markDirtyCornerYRadius(){this.markDirtyRectangle()}}q.register("RectangleCanvasDrawable",ju);$t.mixInto(ju);const sg=ju,tc=$e.pool.fetch();class qu extends th(Sa){constructor(e,t){super(e,t),Dt.prepareForTransform(this.domElement)}initialize(e,t){if(super.initialize(e,t),!this.fillElement||!this.strokeElement){const i=document.createElement("div");this.fillElement=i,i.style.display="block",i.style.position="absolute",i.style.left="0",i.style.top="0",i.style.pointerEvents="none";const n=document.createElement("div");this.strokeElement=n,n.style.display="block",n.style.position="absolute",n.style.left="0",n.style.top="0",n.style.pointerEvents="none",i.appendChild(n)}this.domElement=this.fillElement}updateDOM(){const e=this.node,t=this.fillElement,i=this.strokeElement;if(this.paintDirty){const n=Math.min(e._cornerXRadius,e._cornerYRadius),r=this.dirtyCornerXRadius||this.dirtyCornerYRadius;if(this.dirtyWidth&&(t.style.width=`${e._rectWidth}px`),this.dirtyHeight&&(t.style.height=`${e._rectHeight}px`),r&&(t.style[Qe.borderRadius]=`${n}px`),this.dirtyFill&&(t.style.backgroundColor=e.getCSSFill()),this.dirtyStroke&&(e.hasStroke()?i.style.borderStyle="solid":i.style.borderStyle="none"),e.hasStroke()){const h=!this.hadStroke;(h||this.dirtyWidth||this.dirtyLineWidth)&&(i.style.width=`${e._rectWidth-e.getLineWidth()}px`),(h||this.dirtyHeight||this.dirtyLineWidth)&&(i.style.height=`${e._rectHeight-e.getLineWidth()}px`),(h||this.dirtyLineWidth)&&(i.style.left=`${-e.getLineWidth()/2}px`,i.style.top=`${-e.getLineWidth()/2}px`,i.style.borderWidth=`${e.getLineWidth()}px`),(h||this.dirtyStroke)&&(i.style.borderColor=e.getSimpleCSSStroke()),(h||r||this.dirtyLineWidth||this.dirtyLineOptions)&&(i.style[Qe.borderRadius]=e.isRounded()||e.getLineJoin()==="round"?`${n+e.getLineWidth()/2}px`:"0")}}if(this.transformDirty||this.dirtyX||this.dirtyY){tc.set(this.getTransformMatrix());const n=$e.translation(e._rectX,e._rectY);tc.multiplyMatrix(n),n.freeToPool(),Dt.applyPreparedTransform(tc,this.fillElement)}this.setToCleanState(),this.cleanPaintableState(),this.transformDirty=!1}dispose(){super.dispose()}}q.register("RectangleDOMDrawable",qu);$t.mixInto(qu);const IL=qu,xL=!0;class Xu extends th(Br){initialize(e,t){super.initialize(e,t,!0,xL),this.lastArcW=-1,this.lastArcH=-1,this.svgElement=this.svgElement||document.createElementNS(Gt,"rect")}updateSVGSelf(){const e=this.svgElement;if(this.dirtyX&&e.setAttribute("x",this.node._rectX),this.dirtyY&&e.setAttribute("y",this.node._rectY),this.dirtyWidth&&e.setAttribute("width",this.node._rectWidth),this.dirtyHeight&&e.setAttribute("height",this.node._rectHeight),this.dirtyCornerXRadius||this.dirtyCornerYRadius||this.dirtyWidth||this.dirtyHeight){let t=0,i=0;if(this.node.isRounded()){const n=this.node.getMaximumArcSize();t=Math.min(this.node._cornerXRadius,n),i=Math.min(this.node._cornerYRadius,n)}t!==this.lastArcW&&(this.lastArcW=t,e.setAttribute("rx",t)),i!==this.lastArcH&&(this.lastArcH=i,e.setAttribute("ry",i))}this.updateFillStrokeStyle(e)}}q.register("RectangleSVGDrawable",Xu);$t.mixInto(Xu);const EL=Xu,kL=new Me("transparent");class sh extends th(Go){initialize(e,t){super.initialize(e,t),this.vertexArray||(this.vertexArray=new Float32Array(6*6)),this.upperLeft=new We(0,0),this.lowerLeft=new We(0,0),this.upperRight=new We(0,0),this.lowerRight=new We(0,0),this.transformDirty=!0,this.includeVertices=!0}onAddToBlock(e){this.webglBlock=e,this.markDirty()}onRemoveFromBlock(e){}markTransformDirty(){this.transformDirty=!0,super.markTransformDirty()}update(){if(!super.update())return!1;if(this.dirtyFill&&(this.includeVertices=this.node.hasFill(),this.includeVertices)){const e=it(this.node.fill)?this.node.fill.value:this.node.fill,t=kL.set(e),i=t.red/255,n=t.green/255,r=t.blue/255,h=t.alpha;for(let p=0;p<6;p++){const S=p*6;this.vertexArray[2+S]=i,this.vertexArray[3+S]=n,this.vertexArray[4+S]=r,this.vertexArray[5+S]=h}}if(this.transformDirty||this.dirtyX||this.dirtyY||this.dirtyWidth||this.dirtyHeight){this.transformDirty=!1;const e=this.node._rectX,t=this.node._rectY,i=this.node._rectWidth,n=this.node._rectHeight,r=this.instance.relativeTransform.matrix;r.multiplyVector2(this.upperLeft.setXY(e,t)),r.multiplyVector2(this.lowerLeft.setXY(e,t+n)),r.multiplyVector2(this.upperRight.setXY(e+i,t)),r.multiplyVector2(this.lowerRight.setXY(e+i,t+n)),this.vertexArray[0]=this.upperLeft.x,this.vertexArray[1]=this.upperLeft.y,this.vertexArray[6]=this.lowerLeft.x,this.vertexArray[7]=this.lowerLeft.y,this.vertexArray[12]=this.upperRight.x,this.vertexArray[13]=this.upperRight.y,this.vertexArray[18]=this.upperRight.x,this.vertexArray[19]=this.upperRight.y,this.vertexArray[24]=this.lowerLeft.x,this.vertexArray[25]=this.lowerLeft.y,this.vertexArray[30]=this.lowerRight.x,this.vertexArray[31]=this.lowerRight.y}return this.setToCleanState(),this.cleanPaintableState(),!0}}sh.prototype.webglRenderer=ne.webglVertexColorPolygons;q.register("RectangleWebGLDrawable",sh);$t.mixInto(sh);const AL=sh;class Zu extends Nn{paintCanvas(e,t,i){assert&&assert(t instanceof Ge);const n=ms.getApproximateMatrixScale(i)*(self.devicePixelRatio||1),r=t._spriteInstances.length;assert&&r>0&&assert(t.canvasBounds.isValid(),"Sprites canvasBounds should be set and have non-negative area if it renders sprites");for(let h=0;h<r;h++){const p=t._spriteInstances[h],S=p.sprite.imageProperty.value,C=p.alpha!==1||S.imageOpacity!==1,B=S._mipmap&&S.hasMipmaps();if(C&&(e.context.save(),e.context.globalAlpha*=p.alpha*S.imageOpacity),p.transformType===Cr.TRANSLATION&&i.isTranslation())if(B){const U=S.getMipmapLevelFromScale(n,ms.CANVAS_MIPMAP_BIAS_ADJUSTMENT),k=S.getMipmapCanvas(U),Q=Math.pow(2,U);e.context.drawImage(k,p.matrix.m02()-S.offset.x,p.matrix.m12()-S.offset.y,k.width*Q,k.height*Q)}else e.context.drawImage(S.image,p.matrix.m02()-S.offset.x,p.matrix.m12()-S.offset.y);else{if(e.context.save(),p.matrix.canvasAppendTransform(e.context),B){const U=S.getMipmapLevelFromScale(n*ms.getApproximateMatrixScale(p.matrix),ms.CANVAS_MIPMAP_BIAS_ADJUSTMENT),k=S.getMipmapCanvas(U),Q=Math.pow(2,U);e.context.drawImage(k,-S.offset.x,-S.offset.y,k.width*Q,k.height*Q)}else e.context.drawImage(S.image,-S.offset.x,-S.offset.y);e.context.restore()}C&&e.context.restore()}}}q.register("SpritesCanvasDrawable",Zu);$t.mixInto(Zu);const ng=Zu,$c=5,ic=$c*6,sc=new We(0,0),Xa=new We(0,0),Za=new We(0,0),nc=new We(0,0);class nh extends Go{initialize(e,t){super.initialize(e,t),this.contextChangeListener=this.onWebGLContextChange.bind(this),this.spriteSheet=new ar(!0),this.spriteImageUVMap={},this.vertexArray=new Float32Array(128*ic),this.transformMatrixArray=new Float32Array(9),this.spriteChangeListener=this.onSpriteChange.bind(this),this.node._sprites.forEach(i=>{i.imageProperty.lazyLink(this.spriteChangeListener),this.addSpriteImage(i.imageProperty.value)}),this.hasDrawn=!1}addSpriteImage(e){this.spriteImageUVMap[e.id]=this.spriteSheet.addImage(e.image,e.image.width,e.image.height).uvBounds}removeSpriteImage(e){this.spriteSheet.removeImage(e.image),delete this.spriteImageUVMap[e.id]}onSpriteChange(e,t){this.removeSpriteImage(t),this.addSpriteImage(e)}setup(){const e=this.webGLBlock.gl;this.spriteSheet.initializeContext(e),this.shaderProgram=new Wl(e,["attribute vec2 aVertex;","attribute vec2 aTextureCoord;","attribute float aAlpha;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform mat3 uProjectionMatrix;","uniform mat3 uTransformMatrix;","void main() {","  vTextureCoord = aTextureCoord;","  vAlpha = aAlpha;","  vec3 ndc = uProjectionMatrix * ( uTransformMatrix * vec3( aVertex, 1.0 ) );","  gl_Position = vec4( ndc.xy, 0.0, 1.0 );","}"].join(`
`),["precision mediump float;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform sampler2D uTexture;","void main() {","  vec4 color = texture2D( uTexture, vTextureCoord, -0.7 );","  color *= vAlpha;","  gl_FragColor = color;","}"].join(`
`),{attributes:["aVertex","aTextureCoord","aAlpha"],uniforms:["uTexture","uProjectionMatrix","uTransformMatrix"]}),this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.DYNAMIC_DRAW)}onWebGLContextChange(){this.setup()}onAddToBlock(e){this.webGLBlock=e,this.setup(),e.glChangedEmitter.addListener(this.contextChangeListener)}onRemoveFromBlock(e){e.glChangedEmitter.removeListener(this.contextChangeListener)}draw(){const e=this.node._spriteInstances.length;if(e===0)return 0;assert&&assert(this.node.canvasBounds.isValid(),"Sprites canvasBounds should be set and have non-negative area if it renders sprites"),this.spriteSheet.updateTexture(),this.shaderProgram.use();let t=0,i=!1;for(;ic*e>this.vertexArray.length;)this.vertexArray=new Float32Array(this.vertexArray.length*2),i=!0;for(let p=0;p<e;p++){const S=this.node._spriteInstances[p],C=S.sprite.imageProperty.value,B=S.alpha*C.imageOpacity,U=this.spriteImageUVMap[C.id],k=S.matrix,Q=C.offset,X=C.image.width,g=C.image.height;k.multiplyVector2(sc.setXY(-Q.x,-Q.y)),k.multiplyVector2(Xa.setXY(-Q.x,g-Q.y)),k.multiplyVector2(Za.setXY(X-Q.x,-Q.y)),k.multiplyVector2(nc.setXY(X-Q.x,g-Q.y)),this.vertexArray[t+0]=sc.x,this.vertexArray[t+1]=sc.y,this.vertexArray[t+2]=U.minX,this.vertexArray[t+3]=U.minY,this.vertexArray[t+4]=B,this.vertexArray[t+5]=Xa.x,this.vertexArray[t+6]=Xa.y,this.vertexArray[t+7]=U.minX,this.vertexArray[t+8]=U.maxY,this.vertexArray[t+9]=B,this.vertexArray[t+10]=Za.x,this.vertexArray[t+11]=Za.y,this.vertexArray[t+12]=U.maxX,this.vertexArray[t+13]=U.minY,this.vertexArray[t+14]=B,this.vertexArray[t+15]=Za.x,this.vertexArray[t+16]=Za.y,this.vertexArray[t+17]=U.maxX,this.vertexArray[t+18]=U.minY,this.vertexArray[t+19]=B,this.vertexArray[t+20]=Xa.x,this.vertexArray[t+21]=Xa.y,this.vertexArray[t+22]=U.minX,this.vertexArray[t+23]=U.maxY,this.vertexArray[t+24]=B,this.vertexArray[t+25]=nc.x,this.vertexArray[t+26]=nc.y,this.vertexArray[t+27]=U.maxX,this.vertexArray[t+28]=U.maxY,this.vertexArray[t+29]=B,t+=ic}const n=this.webGLBlock.gl;n.uniformMatrix3fv(this.shaderProgram.uniformLocations.uProjectionMatrix,!1,this.webGLBlock.projectionMatrixArray),this.instance.relativeTransform.matrix.copyToArray(this.transformMatrixArray),n.uniformMatrix3fv(this.shaderProgram.uniformLocations.uTransformMatrix,!1,this.transformMatrixArray),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),i?n.bufferData(n.ARRAY_BUFFER,this.vertexArray,n.DYNAMIC_DRAW):n.bufferSubData(n.ARRAY_BUFFER,0,this.vertexArray.subarray(0,t));const r=Float32Array.BYTES_PER_ELEMENT,h=$c*r;return n.vertexAttribPointer(this.shaderProgram.attributeLocations.aVertex,2,n.FLOAT,!1,h,0*r),n.vertexAttribPointer(this.shaderProgram.attributeLocations.aTextureCoord,2,n.FLOAT,!1,h,2*r),n.vertexAttribPointer(this.shaderProgram.attributeLocations.aAlpha,1,n.FLOAT,!1,h,4*r),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this.spriteSheet.texture),n.uniform1i(this.shaderProgram.uniformLocations.uTexture,0),n.drawArrays(n.TRIANGLES,0,t/$c),n.bindTexture(n.TEXTURE_2D,null),this.shaderProgram.unuse(),!this.hasDrawn&&_i.safari&&vy.setTimeout(()=>this.markDirty(),0),this.hasDrawn=!0,1}dispose(){this.node._sprites.forEach(e=>{e.imageProperty.unlink(this.spriteChangeListener)}),this.webGLBlock&&(this.webGLBlock=null),super.dispose()}markPaintDirty(){this.markDirty()}}nh.prototype.webglRenderer=ne.webglCustom;q.register("SpritesWebGLDrawable",nh);$t.mixInto(nh);const OL=nh;class Qu extends Vo(Nn){paintCanvas(e,t,i){const n=e.context;(t.hasFill()||t.hasPaintableStroke())&&(e.setFont(t._font.getFont()),e.setDirection("ltr")),t.hasFill()&&(t.beforeCanvasFill(e),n.fillText(t.renderedText,0,0),t.afterCanvasFill(e)),t.hasPaintableStroke()&&(t.beforeCanvasStroke(e),n.strokeText(t.renderedText,0,0),t.afterCanvasStroke(e))}markDirtyText(){this.markPaintDirty()}markDirtyFont(){this.markPaintDirty()}markDirtyBounds(){this.markPaintDirty()}}q.register("TextCanvasDrawable",Qu);$t.mixInto(Qu);const rg=Qu,rc=$e.pool.fetch();class Ju extends wm(Sa){constructor(e,t){super(e,t),Dt.prepareForTransform(this.domElement)}initialize(e,t){super.initialize(e,t),this.domElement||(this.domElement=document.createElement("div"),this.domElement.style.display="block",this.domElement.style.position="absolute",this.domElement.style.pointerEvents="none",this.domElement.style.left="0",this.domElement.style.top="0",this.domElement.setAttribute("dir","ltr"))}updateDOM(){const e=this.node,t=this.domElement;if(this.paintDirty&&(this.dirtyFont&&(t.style.font=e.getFont()),this.dirtyStroke&&(t.style.color=e.getCSSFill()),this.dirtyBounds&&(t.style.width=`${e.getSelfBounds().width}px`,t.style.height=`${e.getSelfBounds().height}px`),this.dirtyText&&(t.textContent=e.renderedText)),this.transformDirty||this.dirtyText||this.dirtyFont||this.dirtyBounds){const i=e.getSelfBounds().minY;rc.set(this.getTransformMatrix());const n=$e.translation(0,i);rc.multiplyMatrix(n),n.freeToPool(),Dt.applyPreparedTransform(rc,t)}this.setToCleanState(),this.cleanPaintableState(),this.transformDirty=!1}dispose(){super.dispose()}}q.register("TextDOMDrawable",Ju);$t.mixInto(Ju);const ML=Ju,NL=!0,RL=!_i.edge,ag=_i.safari;class ed extends wm(Br){initialize(e,t){if(super.initialize(e,t,!0,NL),this.hasLength=!1,!this.svgElement){const i=document.createElementNS(Gt,"text");if(this.text=i,ag){const n=document.createElementNS(Gt,"g");n.appendChild(i),this.svgElement=n,this.workaroundRect=document.createElementNS(Gt,"rect"),this.workaroundRect.setAttribute("fill","transparent"),n.appendChild(this.workaroundRect)}else this.svgElement=i;i.appendChild(document.createTextNode("")),i.setAttribute("dominant-baseline","alphabetic"),i.setAttribute("text-rendering","geometricPrecision"),i.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),i.setAttribute("direction","ltr")}}updateSVGSelf(){const e=this.text;if(this.dirtyFont&&(e.setAttribute("font-family",this.node._font.getFamily()),e.setAttribute("font-size",this.node._font.getSize()),e.setAttribute("font-style",this.node._font.getStyle()),e.setAttribute("font-weight",this.node._font.getWeight()),e.setAttribute("font-stretch",this.node._font.getStretch())),this.dirtyText&&(e.lastChild.nodeValue=Dt.safariEmbeddingMarkWorkaround(this.node.renderedText)),this.dirtyBounds&&RL&&(this.node._boundsMethod!=="accurate"&&isFinite(this.node.selfBounds.width)?(this.hasLength||(this.hasLength=!0,e.setAttribute("lengthAdjust","spacingAndGlyphs")),e.setAttribute("textLength",this.node.selfBounds.width)):this.hasLength&&(this.hasLength=!1,e.removeAttribute("lengthAdjust"),e.removeAttribute("textLength")),ag)){const n=this.node.selfBounds.width*.2,r=this.node.selfBounds.height*.2;this.workaroundRect.setAttribute("x",this.node.selfBounds.minX-n),this.workaroundRect.setAttribute("y",this.node.selfBounds.minY-r),this.workaroundRect.setAttribute("width",this.node.selfBounds.width+2*n),this.workaroundRect.setAttribute("height",this.node.selfBounds.height+2*r)}this.updateFillStrokeStyle(e)}}q.register("TextSVGDrawable",ed);$t.mixInto(ed);const BL=ed;class rh extends Go{initialize(e,t){super.initialize(e,t),this.contextChangeListener=this.contextChangeListener||this.onWebGLContextChange.bind(this),this.painter=null}createPainter(){const e=this.node.painterType;return new e(this.webGLBlock.gl,this.node)}onWebGLContextChange(){this.painter=this.createPainter()}onAddToBlock(e){this.webGLBlock=e,this.painter=this.createPainter(),e.glChangedEmitter.addListener(this.contextChangeListener)}onRemoveFromBlock(e){e.glChangedEmitter.removeListener(this.contextChangeListener)}draw(){const e=this.instance.relativeTransform.matrix,t=this.painter.paint(e,this.webGLBlock.projectionMatrix);return assert&&assert(t===pn.PAINTED_SOMETHING||t===pn.PAINTED_NOTHING),assert&&assert(pn.PAINTED_NOTHING===0&&pn.PAINTED_SOMETHING===1,"Ensure we can pass the value through directly to indicate whether draw calls were made"),t}dispose(){this.painter.dispose(),this.painter=null,this.webGLBlock&&(this.webGLBlock=null),super.dispose()}markPaintDirty(){this.markDirty()}get shaderAttributes(){return this.node.shaderAttributes}}rh.prototype.webglRenderer=ne.webglCustom;q.register("WebGLNodeDrawable",rh);$t.mixInto(rh);const FL=rh;class Cm extends Ii{constructor(e,t){super(),this.initialize(e,t)}initialize(e,t){super.initialize(e),this.instance=t}stitch(e,t,i,n){}}q.register("InlineCanvasCacheDrawable",Cm);class Tm extends Ii{constructor(e,t,i,n){super(),this.initialize(e,t,i,n)}initialize(e,t,i,n){super.initialize(t),this.instance=i,this.sharedInstance=n}}q.register("SharedCanvasCacheDrawable",Tm);class Dm{constructor(e){this.instance=e}initialize(e,t){return this.display=e,this.trail=t,this.node=t&&t.lastNode(),this.transformDirty=!0,this.nodeTransformListener=this.nodeTransformListener||this.onNodeTransformDirty.bind(this),this.matrix=this.matrix||$e.identity(),this.relativeSelfDirty=!0,this.relativeChildrenListenersCount=0,this.relativePrecomputeCount=0,this.relativeChildrenPrecomputeCount=0,this.relativeFrameId=-1,this.relativeChildDirtyFrame=e?e._frameId:0,this.relativeTransformListeners=Bt(this.relativeTransformListeners),this}get parent(){return this.instance.parent?this.instance.parent.relativeTransform:null}addInstance(e){e.stateless?(assert&&assert(!e.relativeTransform.hasAncestorListenerNeed(),"We only track changes properly if stateless instances do not have needs"),assert&&assert(!e.relativeTransform.hasAncestorComputeNeed(),"We only track changes properly if stateless instances do not have needs")):(e.relativeTransform.hasAncestorListenerNeed()&&this.incrementTransformListenerChildren(),e.relativeTransform.hasAncestorComputeNeed()&&this.incrementTransformPrecomputeChildren()),e.relativeTransform.forceMarkTransformDirty()}removeInstance(e){e.relativeTransform.hasAncestorListenerNeed()&&this.decrementTransformListenerChildren(),e.relativeTransform.hasAncestorComputeNeed()&&this.decrementTransformPrecomputeChildren()}attachNodeListeners(){this.node.transformEmitter.addListener(this.nodeTransformListener)}detachNodeListeners(){this.node.transformEmitter.removeListener(this.nodeTransformListener)}hasDescendantListenerNeed(){return this.instance.isTransformed?this.relativeChildrenListenersCount>0:this.relativeChildrenListenersCount>0||this.relativeTransformListeners.length>0}hasAncestorListenerNeed(){return this.instance.isTransformed?this.relativeTransformListeners.length>0:this.relativeChildrenListenersCount>0||this.relativeTransformListeners.length>0}hasSelfListenerNeed(){return this.relativeTransformListeners.length>0}incrementTransformListenerChildren(){const e=this.hasAncestorListenerNeed();this.relativeChildrenListenersCount++,e!==this.hasAncestorListenerNeed()&&(assert&&assert(!this.instance.isTransformed,"Should not be a change in need if we have the isTransformed flag"),this.parent&&this.parent.incrementTransformListenerChildren())}decrementTransformListenerChildren(){const e=this.hasAncestorListenerNeed();this.relativeChildrenListenersCount--,e!==this.hasAncestorListenerNeed()&&(assert&&assert(!this.instance.isTransformed,"Should not be a change in need if we have the isTransformed flag"),this.parent&&this.parent.decrementTransformListenerChildren())}addListener(e){const t=this.hasAncestorListenerNeed();this.relativeTransformListeners.push(e),t!==this.hasAncestorListenerNeed()&&(this.parent&&this.parent.incrementTransformListenerChildren(),this.hasAncestorComputeNeed()||this.forceMarkTransformDirty())}removeListener(e){const t=this.hasAncestorListenerNeed();this.relativeTransformListeners.splice(_.indexOf(this.relativeTransformListeners,e),1),t!==this.hasAncestorListenerNeed()&&this.parent&&this.parent.decrementTransformListenerChildren()}hasDescendantComputeNeed(){return this.instance.isTransformed?this.relativeChildrenPrecomputeCount>0:this.relativeChildrenPrecomputeCount>0||this.relativePrecomputeCount>0}hasAncestorComputeNeed(){return this.instance.isTransformed?this.relativePrecomputeCount>0:this.relativeChildrenPrecomputeCount>0||this.relativePrecomputeCount>0}hasSelfComputeNeed(){return this.relativePrecomputeCount>0}incrementTransformPrecomputeChildren(){const e=this.hasAncestorComputeNeed();this.relativeChildrenPrecomputeCount++,e!==this.hasAncestorComputeNeed()&&(assert&&assert(!this.instance.isTransformed,"Should not be a change in need if we have the isTransformed flag"),this.parent&&this.parent.incrementTransformPrecomputeChildren())}decrementTransformPrecomputeChildren(){const e=this.hasAncestorComputeNeed();this.relativeChildrenPrecomputeCount--,e!==this.hasAncestorComputeNeed()&&(assert&&assert(!this.instance.isTransformed,"Should not be a change in need if we have the isTransformed flag"),this.parent&&this.parent.decrementTransformPrecomputeChildren())}addPrecompute(){const e=this.hasAncestorComputeNeed();this.relativePrecomputeCount++,e!==this.hasAncestorComputeNeed()&&(this.parent&&this.parent.incrementTransformPrecomputeChildren(),this.hasAncestorListenerNeed()||this.forceMarkTransformDirty())}removePrecompute(){const e=this.hasAncestorComputeNeed();this.relativePrecomputeCount--,e!==this.hasAncestorComputeNeed()&&this.parent&&this.parent.decrementTransformPrecomputeChildren()}onNodeTransformDirty(){this.transformDirty||this.forceMarkTransformDirty()}forceMarkTransformDirty(){this.transformDirty=!0,this.relativeSelfDirty=!0;const e=this.display._frameId;let t=this.instance.parent;for(;t&&t.relativeTransform.relativeChildDirtyFrame!==e;){const i=t.parent,n=t.isTransformed;if(t.relativeTransform.relativeChildDirtyFrame=e,i===null){this.display.markTransformRootDirty(t,n);break}else if(n){this.display.markTransformRootDirty(t,!0);break}t=i}}computeRelativeTransform(){const e=this.node.getMatrix();this.instance.parent&&!this.instance.parent.isTransformed?(this.matrix.set(this.parent.matrix),this.matrix.multiplyMatrix(e)):this.matrix.set(e),this.relativeFrameId=this.display._frameId,this.relativeSelfDirty=!1}isValidationNotNeeded(){return this.hasAncestorComputeNeed()||this.relativeFrameId===this.display._frameId}validate(){if(!this.isValidationNotNeeded()&&(this.instance.parent&&!this.instance.parent.isTransformed&&this.parent.validate(),this.relativeSelfDirty)){this.computeRelativeTransform();const e=this.instance.children.length;for(let t=0;t<e;t++)this.instance.children[t].relativeTransform.relativeSelfDirty=!0}}updateTransformListenersAndCompute(e,t,i,n){sceneryLog&&sceneryLog.RelativeTransform&&sceneryLog.RelativeTransform(`update/compute: ${this.toString()} ${e} => ${t}${n?" passTransform":""}`),sceneryLog&&sceneryLog.RelativeTransform&&sceneryLog.push();let r,h;if(n)for(r=this.instance.children.length,h=0;h<r;h++)this.instance.children[h].relativeTransform.updateTransformListenersAndCompute(!1,!1,i,!1);else{const p=e||this.relativeSelfDirty,S=p||this.relativeChildDirtyFrame===i,C=this.hasDescendantComputeNeed(),B=this.hasDescendantListenerNeed(),U=this.hasSelfComputeNeed(),k=this.hasSelfListenerNeed();if(!C&&p&&!t&&(this.relativeSelfDirty=!0),!S||!C&&!B&&!U&&!k){sceneryLog&&sceneryLog.RelativeTransform&&sceneryLog.pop();return}if(p&&(C||U)&&this.computeRelativeTransform(),this.transformDirty&&(this.transformDirty=!1),this.notifyRelativeTransformListeners(),!this.instance.isTransformed||n){const Q=p&&!(C||U);for(r=this.instance.children.length,h=0;h<r;h++)this.instance.children[h].relativeTransform.updateTransformListenersAndCompute(p,Q,i,!1)}}sceneryLog&&sceneryLog.RelativeTransform&&sceneryLog.pop()}notifyRelativeTransformListeners(){const e=this.relativeTransformListeners.length;for(let t=0;t<e;t++)this.relativeTransformListeners[t]()}audit(e,t){function i(r){const h=$e.pool.fetch(),p=r.node.getMatrix();return r.parent?r.parent.isTransformed?h.set(p):(h.set(i(r.parent)),h.multiplyMatrix(p)):h.set($e.IDENTITY),h}function n(r){return t&&r.isValidationNotNeeded()?!1:r.relativeSelfDirty||r.parent&&n(r.parent)}if(assertSlow){let r=0,h=0;for(let p=0;p<this.instance.children.length;p++){const S=this.instance.children[p];S.relativeTransform.hasAncestorListenerNeed()&&r++,S.relativeTransform.hasAncestorComputeNeed()&&h++}if(assertSlow(r===this.relativeChildrenListenersCount,"Relative listener count invariant"),assertSlow(h===this.relativeChildrenPrecomputeCount,"Relative precompute count invariant"),assertSlow(!this.parent||this.instance.isTransformed||this.relativeChildDirtyFrame!==e||this.parent.relativeChildDirtyFrame===e,"If we have a parent, we need to hold the invariant this.relativeChildDirtyFrame => parent.relativeChildDirtyFrame"),!t&&!n(this)){const p=i(this);assertSlow(p.equals(this.matrix),"If there is no relativeSelfDirty flag set here or in our ancestors, our matrix should be up-to-date")}}}}q.register("RelativeTransform",Dm);class Cs{constructor(e,t){this.initialize(e,t)}initialize(e,t){assert&&assert(e===null||e instanceof Ii,"drawableBefore can either be null to indicate that there is no un-changed drawable before our changes, or it can reference an un-changed drawable"),assert&&assert(t===null||t instanceof Ii,"drawableAfter can either be null to indicate that there is no un-changed drawable after our changes, or it can reference an un-changed drawable"),this.nextChangeInterval=null,this.drawableBefore=e,this.drawableAfter=t,this.collapsedEmpty=!1}dispose(){this.nextChangeInterval=null,this.drawableBefore=null,this.drawableAfter=null,this.freeToPool()}constrict(){let e=!1;if(this.isEmpty())return!0;for(;this.drawableBefore&&this.drawableBefore.nextDrawable===this.drawableBefore.oldNextDrawable;)if(this.drawableBefore=this.drawableBefore.nextDrawable,e=!0,this.drawableBefore||(assert&&assert(!this.drawableAfter),this.collapsedEmpty=!0),this.isEmpty())return!0;for(;this.drawableAfter&&this.drawableAfter.previousDrawable===this.drawableAfter.oldPreviousDrawable;)if(this.drawableAfter=this.drawableAfter.previousDrawable,e=!0,this.drawableAfter||(assert&&assert(!this.drawableBefore),this.collapsedEmpty=!0),this.isEmpty())return!0;return e}isEmpty(){return this.collapsedEmpty||this.drawableBefore!==null&&this.drawableBefore===this.drawableAfter}getOldInternalDrawableCount(e,t){const i=this.drawableBefore?this.drawableBefore.oldNextDrawable:e,n=this.drawableAfter;let r=0;for(let h=i;h!==n;h=h.oldNextDrawable)r++;return r}getNewInternalDrawableCount(e,t){const i=this.drawableBefore?this.drawableBefore.nextDrawable:e,n=this.drawableAfter;let r=0;for(let h=i;h!==n;h=h.nextDrawable)r++;return r}static newForDisplay(e,t,i){const n=Cs.createFromPool(e,t);return i.markChangeIntervalToDispose(n),n}}q.register("ChangeInterval",Cs);$t.mixInto(Cs);class Im{constructor(e){this.instance=e}initialize(e,t){return this.display=e,this.trail=t,this.node=t&&t.lastNode(),this.selfFittable=!!t&&this.isSelfFitSupported(),this.ancestorsFittable=this.selfFittable,this.subtreeUnfittableCount=this.selfFittable?0:1,this.subtreeFittabilityChangeEmitter=this.subtreeFittabilityChangeEmitter||new zt,this}get parent(){return this.instance.parent?this.instance.parent.fittability:null}checkSelfFittability(){const e=this.isSelfFitSupported();this.selfFittable!==e&&this.updateSelfFittable()}isSelfFitSupported(){return this.display._allowLayerFitting&&!this.node.isPreventFit()}markSubtreeFittable(){if(!this.selfFittable)return;this.ancestorsFittable=!0;const e=this.instance.children;for(let t=0;t<e.length;t++)e[t].fittability.markSubtreeFittable();this.instance.updateDrawableFittability(!0)}markSubtreeUnfittable(){if(!this.ancestorsFittable)return;this.ancestorsFittable=!1;const e=this.instance.children;for(let t=0;t<e.length;t++)e[t].fittability.markSubtreeUnfittable();this.instance.updateDrawableFittability(!1)}updateSelfFittable(){const e=this.isSelfFitSupported();assert&&assert(this.selfFittable!==e),this.selfFittable=e,this.selfFittable&&(!this.parent||this.parent.ancestorsFittable)?this.markSubtreeFittable():this.selfFittable||this.markSubtreeUnfittable(),this.selfFittable?this.decrementSubtreeUnfittableCount():this.incrementSubtreeUnfittableCount()}incrementSubtreeUnfittableCount(){this.subtreeUnfittableCount++,this.subtreeUnfittableCount===1&&(this.parent&&this.parent.incrementSubtreeUnfittableCount(),this.subtreeFittabilityChangeEmitter.emit())}decrementSubtreeUnfittableCount(){this.subtreeUnfittableCount--,this.subtreeUnfittableCount===0&&(this.parent&&this.parent.decrementSubtreeUnfittableCount(),this.subtreeFittabilityChangeEmitter.emit())}onInsert(e){this.ancestorsFittable||e.markSubtreeUnfittable(),e.subtreeUnfittableCount>0&&this.incrementSubtreeUnfittableCount()}onRemove(e){this.ancestorsFittable||e.markSubtreeFittable(),e.subtreeUnfittableCount>0&&this.decrementSubtreeUnfittableCount()}audit(){if(assertSlow){assertSlow(this.selfFittable===this.isSelfFitSupported(),"selfFittable diverged from isSelfFitSupported()"),assertSlow(this.ancestorsFittable===((this.parent?this.parent.ancestorsFittable:!0)&&this.selfFittable),"Our ancestorsFittable should be false if our parent or our self is not fittable.");let e=0;this.selfFittable||e++,_.each(this.instance.children,t=>{t.fittability.subtreeUnfittableCount>0&&e++}),assertSlow(this.subtreeUnfittableCount===e,"Incorrect subtreeUnfittableCount")}}}q.register("Fittability",Im);let HL=1,VL=1;class Qs{constructor(e,t,i){this.id=`group${HL++}`,this.initialize(e,t,i)}initialize(e,t,i){sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`initializing ${this.toString()}`),this.block=e,this.instance=t,this.node=t.trail.lastNode(),this.parent=i,this.children=Bt(this.children),this.hasSelfDrawable=!1,this.selfDrawable=null,this.dirty=!0,this.willApplyTransforms=this.block.transformRootInstance.trail.nodes.length<this.instance.trail.nodes.length,this.willApplyFilters=this.block.filterRootInstance.trail.nodes.length<this.instance.trail.nodes.length,this.transformDirty=!0,this.hasTransform=this.hasTransform!==void 0?this.hasTransform:!1,this.transformDirtyListener=this.transformDirtyListener||this.markTransformDirty.bind(this),this.willApplyTransforms&&this.node.transformEmitter.addListener(this.transformDirtyListener),this.filterDirty=!0,this.visibilityDirty=!0,this.clipDirty=!0,this.filterElement=this.filterElement||null,this.hasOpacity=this.hasOpacity!==void 0?this.hasOpacity:!1,this.hasFilter=!1,this.clipDefinition=this.clipDefinition!==void 0?this.clipDefinition:null,this.clipPath=this.clipPath!==void 0?this.clipPath:null,this.filterChangeListener=this.filterChangeListener||this.onFilterChange.bind(this),this.visibilityDirtyListener=this.visibilityDirtyListener||this.onVisibleChange.bind(this),this.clipDirtyListener=this.clipDirtyListener||this.onClipChange.bind(this),this.node.visibleProperty.lazyLink(this.visibilityDirtyListener),this.willApplyFilters&&this.node.filterChangeEmitter.addListener(this.filterChangeListener),this.node.clipAreaProperty.lazyLink(this.clipDirtyListener),this.orderDirty=!0,this.orderDirtyListener=this.orderDirtyListener||this.markOrderDirty.bind(this),this.node.childrenChangedEmitter.addListener(this.orderDirtyListener),this.svgGroup||(this.svgGroup=document.createElementNS(Gt,"g")),this.instance.addSVGGroup(this),this.block.markDirtyGroup(this)}addSelfDrawable(e){this.selfDrawable=e,this.svgGroup.insertBefore(e.svgElement,this.children.length?this.children[0].svgGroup:null),this.hasSelfDrawable=!0}removeSelfDrawable(e){this.hasSelfDrawable=!1,this.svgGroup.removeChild(e.svgElement),this.selfDrawable=null}addChildGroup(e){this.markOrderDirty(),e.parent=this,this.children.push(e),this.svgGroup.appendChild(e.svgGroup)}removeChildGroup(e){this.markOrderDirty(),e.parent=null,this.children.splice(_.indexOf(this.children,e),1),this.svgGroup.removeChild(e.svgGroup)}markDirty(){this.dirty||(this.dirty=!0,this.block.markDirtyGroup(this))}markOrderDirty(){this.orderDirty||(this.orderDirty=!0,this.markDirty())}markTransformDirty(){this.transformDirty||(this.transformDirty=!0,this.markDirty())}onFilterChange(){this.filterDirty||(this.filterDirty=!0,this.markDirty())}onVisibleChange(){this.visibilityDirty||(this.visibilityDirty=!0,this.markDirty())}onClipChange(){this.clipDirty||(this.clipDirty=!0,this.markDirty())}update(){if(sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`update: ${this.toString()}`),!this.block)return;sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.push();const e=this.svgGroup;if(this.dirty=!1,this.transformDirty&&(this.transformDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`transform update: ${this.toString()}`),this.willApplyTransforms?this.node.transform.isIdentity()?this.hasTransform&&(this.hasTransform=!1,e.removeAttribute("transform")):(this.hasTransform=!0,e.setAttribute("transform",this.node.transform.getMatrix().getSVGTransform())):this.hasTransform&&(this.hasTransform=!1,e.removeAttribute("transform"))),this.visibilityDirty&&(this.visibilityDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`visibility update: ${this.toString()}`),e.style.display=this.node.isVisible()?"":"none"),this.filterDirty){this.filterDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`filter update: ${this.toString()}`);const t=this.node.effectiveOpacity;this.willApplyFilters&&t!==1?(this.hasOpacity=!0,e.setAttribute("opacity",t)):this.hasOpacity&&(this.hasOpacity=!1,e.removeAttribute("opacity"));const i=this.willApplyFilters&&this.node._filters.length,n=`filter-${this.id}`;if(i){for(this.filterElement||(this.filterElement=document.createElementNS(Gt,"filter"),this.filterElement.setAttribute("id",n));this.filterElement.firstChild;)this.filterElement.removeChild(this.filterElement.lastChild);let r=50,h="SourceGraphic";const p=this.node._filters.length;for(let B=0;B<p;B++){const U=this.node._filters[B],k=B===p-1?void 0:`e${B}`;U.applySVGFilter(this.filterElement,h,k),r+=U.filterRegionPercentageIncrease,h=k}const S=`-${Rt(r)}%`,C=`${Rt(2*r+100)}%`;this.filterElement.setAttribute("x",S),this.filterElement.setAttribute("y",S),this.filterElement.setAttribute("width",C),this.filterElement.setAttribute("height",C)}i&&(this.hasFilter||this.block.defs.appendChild(this.filterElement),e.setAttribute("filter",`url(#${n})`),this.hasFilter=!0),this.hasFilter&&!i&&(e.removeAttribute("filter"),this.hasFilter=!1,this.block.defs.removeChild(this.filterElement))}if(this.clipDirty)if(this.clipDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`clip update: ${this.toString()}`),this.node.clipArea){if(!this.clipDefinition){const t=`clip${VL++}`;this.clipDefinition=document.createElementNS(Gt,"clipPath"),this.clipDefinition.setAttribute("id",t),this.clipDefinition.setAttribute("clipPathUnits","userSpaceOnUse"),this.block.defs.appendChild(this.clipDefinition),this.clipPath=document.createElementNS(Gt,"path"),this.clipDefinition.appendChild(this.clipPath),e.setAttribute("clip-path",`url(#${t})`)}this.clipPath.setAttribute("d",this.node.clipArea.getSVGPath())}else this.clipDefinition&&(e.removeAttribute("clip-path"),this.block.defs.removeChild(this.clipDefinition),this.clipDefinition=null,this.clipPath=null);if(this.orderDirty){this.orderDirty=!1,sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`order update: ${this.toString()}`),sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.push();let t=this.children.length-1;const i=this.instance.children;for(let n=i.length-1;n>=0;n--){const r=i[n].lookupSVGGroup(this.block);if(r){if(this.children[t]!==r){sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`group out of order: ${t} for ${r.toString()}`),e.insertBefore(r.svgGroup,t+1>=this.children.length?null:this.children[t+1].svgGroup);const h=_.indexOf(this.children,r);assert&&assert(h<t,"The item we are moving backwards to location [idx] should not have an index greater than that"),this.children.splice(h,1),this.children.splice(t,0,r)}else sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`group in place: ${t} for ${r.toString()}`);t--}}sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.pop()}sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.pop()}isReleasable(){return!this.hasSelfDrawable&&!this.children.length&&this.parent}dispose(){sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.SVGGroup(`dispose ${this.toString()}`),sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.push(),assert&&assert(this.children.length===0,"Should be empty by now"),this.hasFilter&&(this.svgGroup.removeAttribute("filter"),this.hasFilter=!1,this.block.defs.removeChild(this.filterElement)),this.willApplyTransforms&&this.node.transformEmitter.removeListener(this.transformDirtyListener),this.node.visibleProperty.unlink(this.visibilityDirtyListener),this.willApplyFilters&&this.node.filterChangeEmitter.removeListener(this.filterChangeListener),this.node.clipAreaProperty.unlink(this.clipDirtyListener),this.node.childrenChangedEmitter.removeListener(this.orderDirtyListener),this.instance.active&&this.instance.removeSVGGroup(this),this.clipDefinition&&(this.svgGroup.removeAttribute("clip-path"),this.block.defs.removeChild(this.clipDefinition),this.clipDefinition=null,this.clipPath=null),this.parent=null,this.block=null,this.instance=null,this.node=null,Bt(this.children),this.selfDrawable=null,this.freeToPool(),sceneryLog&&sceneryLog.SVGGroup&&sceneryLog.pop()}toString(){return`SVGGroup:${this.block.toString()}_${this.instance.toString()}`}static addDrawable(e,t){assert&&assert(t.instance,"Instance is required for a drawable to be grouped correctly in SVG"),Qs.ensureGroupsToInstance(e,t.instance).addSelfDrawable(t)}static removeDrawable(e,t){t.instance.lookupSVGGroup(e).removeSelfDrawable(t),Qs.releaseGroupsToInstance(e,t.instance)}static ensureGroupsToInstance(e,t){let i=t.lookupSVGGroup(e);if(!i){assert&&assert(t!==e.rootGroup.instance,"Making sure we do not walk past our rootGroup");const n=Qs.ensureGroupsToInstance(e,t.parent);i=Qs.createFromPool(e,t,n),n.addChildGroup(i)}return i}static releaseGroupsToInstance(e,t){const i=t.lookupSVGGroup(e);if(i.isReleasable()){const n=i.parent;n.removeChildGroup(i),Qs.releaseGroupsToInstance(e,n.instance),i.dispose()}}}q.register("SVGGroup",Qs);$t.mixInto(Qs);class xm extends Ii{initialize(e,t){assert&&assert(!e._isDisposing,"Should not create a block for a Display that is being disposed of"),assert&&assert(!e._isDisposed,"Should not create a block for a disposed Display"),super.initialize(t),this.display=e,this.drawableCount=0,this.used=!0,this.firstDrawable=null,this.lastDrawable=null,this.pendingFirstDrawable=null,this.pendingLastDrawable=null,this.previousBlock=null,this.nextBlock=null,this.zIndex=0,assertSlow&&(this.drawableList=Bt(this.drawableList))}dispose(){assert&&assert(this.drawableCount===0,"There should be no drawables on a block when it is disposed"),this.display=null,this.firstDrawable=null,this.lastDrawable=null,this.pendingFirstDrawable=null,this.pendingLastDrawable=null,this.previousBlock=null,this.nextBlock=null,assertSlow&&Bt(this.drawableList),super.dispose()}addDrawable(e){if(this.drawableCount++,this.markDirtyDrawable(e),assertSlow){const t=_.indexOf(this.drawableList,e);assertSlow&&assertSlow(t===-1,"Drawable should not be added when it has not been removed"),this.drawableList.push(e),assertSlow&&assertSlow(this.drawableCount===this.drawableList.length,"Count sanity check, to make sure our assertions are not buggy")}}removeDrawable(e){if(this.drawableCount--,this.markDirty(),assertSlow){const t=_.indexOf(this.drawableList,e);assertSlow&&assertSlow(t!==-1,"Drawable should be already added when it is removed"),this.drawableList.splice(t,1),assertSlow&&assertSlow(this.drawableCount===this.drawableList.length,"Count sanity check, to make sure our assertions are not buggy")}}onIntervalChange(e,t){}updateInterval(){(this.pendingFirstDrawable!==this.firstDrawable||this.pendingLastDrawable!==this.lastDrawable)&&(this.onIntervalChange(this.pendingFirstDrawable,this.pendingLastDrawable),this.firstDrawable=this.pendingFirstDrawable,this.lastDrawable=this.pendingLastDrawable)}notifyInterval(e,t){this.pendingFirstDrawable=e,this.pendingLastDrawable=t,this.updateInterval()}audit(e,t,i){if(assertSlow){super.audit(e,t,i);let n=0;if(!t){for(let r=this.firstDrawable;r!==null&&(r.audit(e,t,i),n++,r!==this.lastDrawable);r=r.nextDrawable);if(!e){assertSlow&&assertSlow(n===this.drawableCount,"drawableCount should match"),assertSlow&&assertSlow(this.firstDrawable===this.pendingFirstDrawable,"No pending first drawable"),assertSlow&&assertSlow(this.lastDrawable===this.pendingLastDrawable,"No pending last drawable");for(let r=this.firstDrawable;r!==null&&(assertSlow&&assertSlow(r.renderer===this.renderer,"Renderers should match"),assertSlow&&assertSlow(r.parentDrawable===this,"This block should be this drawable's parent"),assertSlow&&assertSlow(_.indexOf(this.drawableList,r)>=0),r!==this.lastDrawable);r=r.nextDrawable);}}}}}q.register("Block",xm);const nr=xm,og=Be.NOTHING.copy();class Ei extends nr{initialize(e,t,i,n){return super.initialize(e,t),this.transformRootInstance=i,assert&&assert(typeof i.isDisplayRoot=="boolean"),this.canBeFullDisplay=i.isDisplayRoot,assert&&assert(n===Ei.FULL_DISPLAY||n===Ei.COMMON_ANCESTOR),this.preferredFit=n,this.fit=n,this.dirtyFit=!0,this.commonFitInstance=null,this.fitBounds=Be.NOTHING.copy(),this.oldFitBounds=Be.NOTHING.copy(),this.unfittableDrawableCount=0,this.dirtyFitListener=this.dirtyFitListener||this.markDirtyFit.bind(this),this.fittableListener=this.fittableListener||this.onFittabilityChange.bind(this),this.display.sizeProperty.lazyLink(this.dirtyFitListener),this}setFit(e){!this.canBeFullDisplay&&e===Ei.FULL_DISPLAY&&(e=Ei.COMMON_ANCESTOR),this.fit!==e&&(this.fit=e,this.markDirtyFit(),this.oldFitBounds.set(Be.NOTHING),e===Ei.COMMON_ANCESTOR&&this.removeCommonFitInstance())}markDirtyFit(){sceneryLog&&sceneryLog.dirty&&sceneryLog.dirty(`markDirtyFit on FittedBlock#${this.id}`),this.dirtyFit=!0,this.markDirty()}updateFit(){if(assert&&assert(this.fit===Ei.FULL_DISPLAY||this.fit===Ei.COMMON_ANCESTOR,"Unsupported fit"),!(!this.dirtyFit&&this.fit===Ei.FULL_DISPLAY))if(sceneryLog&&sceneryLog.FittedBlock&&sceneryLog.FittedBlock(`updateFit #${this.id}`),this.dirtyFit=!1,this.fit===Ei.COMMON_ANCESTOR&&this.commonFitInstance===null&&this.addCommonFitInstance(this.computeCommonAncestorInstance()),this.fit===Ei.COMMON_ANCESTOR&&this.commonFitInstance.fittability.subtreeUnfittableCount>0&&this.canBeFullDisplay&&(this.oldFitBounds.set(Be.NOTHING),this.fit=Ei.FULL_DISPLAY),this.fit===Ei.FULL_DISPLAY)this.fitBounds.set(Be.NOTHING),this.setSizeFullDisplay();else if(this.fit===Ei.COMMON_ANCESTOR){assert&&assert(this.commonFitInstance.trail.length>=this.transformRootInstance.trail.length),this.fitBounds.set(this.commonFitInstance.node.getLocalBounds());let e=this.commonFitInstance;for(;e!==this.transformRootInstance;)this.fitBounds.transform(e.node.getMatrix()),e=e.parent;this.fitBounds.roundOut(),this.fitBounds.dilate(4),this.transformRootInstance.isDisplayRoot&&(og.setMinMax(0,0,this.display.width,this.display.height),this.fitBounds.constrainBounds(og)),this.fitBounds.isValid()||this.fitBounds.setMinMax(0,0,0,0),this.fitBounds.equals(this.oldFitBounds)||(this.oldFitBounds.set(this.fitBounds),this.setSizeFitBounds())}else throw new Error("unknown fit")}setSizeFullDisplay(){}setSizeFitBounds(){}addCommonFitInstance(e){assert&&assert(this.commonFitInstance===null),e&&(this.commonFitInstance=e,this.commonFitInstance.fittability.subtreeFittabilityChangeEmitter.addListener(this.dirtyFitListener))}removeCommonFitInstance(){this.commonFitInstance&&(this.commonFitInstance.fittability.subtreeFittabilityChangeEmitter.removeListener(this.dirtyFitListener),this.commonFitInstance=null)}dispose(){sceneryLog&&sceneryLog.FittedBlock&&sceneryLog.FittedBlock(`dispose #${this.id}`),this.display.sizeProperty.unlink(this.dirtyFitListener),this.removeCommonFitInstance(),this.transformRootInstance=null,super.dispose()}addDrawable(e){super.addDrawable(e),e.fittableProperty.lazyLink(this.fittableListener),e.fittable||this.incrementUnfittable()}removeDrawable(e){super.removeDrawable(e),e.fittableProperty.unlink(this.fittableListener),e.fittable||this.decrementUnfittable()}onFittabilityChange(e){e?this.decrementUnfittable():this.incrementUnfittable()}incrementUnfittable(){this.unfittableDrawableCount++,this.unfittableDrawableCount===1&&this.checkFitConstraints()}decrementUnfittable(){this.unfittableDrawableCount--,this.unfittableDrawableCount===0&&this.checkFitConstraints()}checkFitConstraints(){this.unfittableDrawableCount>0&&this.canBeFullDisplay?this.setFit(Ei.FULL_DISPLAY):this.setFit(this.preferredFit)}computeCommonAncestorInstance(){assert&&assert(this.firstDrawable.instance&&this.lastDrawable.instance,"For common-ancestor fits, we need the first and last drawables to have direct instance references");let e=this.firstDrawable.instance,t=this.lastDrawable.instance;const i=Math.min(e.trail.length,t.trail.length);for(;e.trail.length>i;)e=e.parent;for(;t.trail.length>i;)t=t.parent;for(;e!==t;)e=e.parent,t=t.parent;const n=e;return assert&&assert(n.trail.length>=this.transformRootInstance.trail.length),n}onIntervalChange(e,t){sceneryLog&&sceneryLog.FittedBlock&&sceneryLog.FittedBlock(`#${this.id}.onIntervalChange ${e.toString()} to ${t.toString()}`),super.onIntervalChange(e,t),this.fit===Ei.COMMON_ANCESTOR&&(this.removeCommonFitInstance(),this.markDirtyFit())}}q.register("FittedBlock",Ei);Ei.FULL_DISPLAY=1;Ei.COMMON_ANCESTOR=2;Ei.fitString={1:"fullDisplay",2:"commonAncestor"};const fn=Ei,lg=new $e,hg=new $e;class td extends fn{constructor(e,t,i,n){super(),this.initialize(e,t,i,n)}initialize(e,t,i,n){super.initialize(e,t,i,fn.COMMON_ANCESTOR),this.filterRootInstance=n,this.dirtyDrawables=Bt(this.dirtyDrawables),this.domElement||(this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.left="0",this.canvas.style.top="0",this.canvas.style.pointerEvents="none",this.canvasId=this.canvas.id=`scenery-canvas${this.id}`,this.context=this.canvas.getContext("2d"),this.context.save(),this.context.miterLimit=20,this.context.miterLimit=10,this.wrapper=new sr(this.canvas,this.context),this.domElement=this.canvas,this.wrapperStack=[this.wrapper]),this.wrapperStackIndex=0,this.filterListenerCountMap=this.filterListenerCountMap||{},Dt.prepareForTransform(this.canvas),Dt.unsetTransform(this.canvas),this.canvasDrawOffset=new We(0,0),this.currentDrawable=null,this.clipDirty=!0,this.clipCount=0,this.backingScale=t&ne.bitmaskCanvasLowResolution?1:Dt.backingScale(this.context),this.clipDirtyListener=this.markDirty.bind(this),this.opacityDirtyListener=this.markDirty.bind(this),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`initialized #${this.id}`)}setSizeFullDisplay(){const e=this.display.getSize();this.canvas.width=e.width*this.backingScale,this.canvas.height=e.height*this.backingScale,this.canvas.style.width=`${e.width}px`,this.canvas.style.height=`${e.height}px`,this.wrapper.resetStyles(),this.canvasDrawOffset.setXY(0,0),Dt.unsetTransform(this.canvas)}setSizeFitBounds(){const e=this.fitBounds.minX,t=this.fitBounds.minY;this.canvasDrawOffset.setXY(-e,-t),Dt.setTransform(`matrix(1,0,0,1,${e},${t})`,this.canvas),this.canvas.width=this.fitBounds.width*this.backingScale,this.canvas.height=this.fitBounds.height*this.backingScale,this.canvas.style.width=`${this.fitBounds.width}px`,this.canvas.style.height=`${this.fitBounds.height}px`,this.wrapper.resetStyles()}update(){if(!super.update())return!1;for(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`update #${this.id}`),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.push();this.dirtyDrawables.length;)this.dirtyDrawables.pop().update();this.updateFit(),this.context.restore(),this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.save(),this.wrapper.resetStyles(),this.currentDrawable=null;for(let e=this.firstDrawable;e!==null&&(this.renderDrawable(e),e!==this.lastDrawable);e=e.nextDrawable);return this.currentDrawable&&this.walkDown(this.currentDrawable.instance.trail,0),assert&&assert(this.clipCount===0,"clipCount should be zero after walking back down"),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.pop(),!0}applyClip(e){this.clipDirty=!1,sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Apply clip ${e.instance.trail.toDebugString()}`),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.push();const t=this.wrapperStack[this.wrapperStackIndex],i=t.context;if(i.restore(),i.save(),t.resetStyles(),this.clipCount){const r=e.instance.trail;lg.rowMajor(this.backingScale,0,this.canvasDrawOffset.x*this.backingScale,0,this.backingScale,this.canvasDrawOffset.y*this.backingScale,0,0,1),hg.set(this.transformRootInstance.trail.getMatrix()).invert(),hg.multiplyMatrix(lg).canvasSetTransform(i);for(let h=0;h<r.length;h++){const p=r.nodes[h];p.getMatrix().canvasAppendTransform(i),p.hasClipArea()&&(i.beginPath(),p.clipArea.writeToContext(i),i.clip())}}sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.pop()}pushWrapper(){if(this.wrapperStackIndex++,this.clipDirty=!0,this.wrapperStackIndex===this.wrapperStack.length){const i=document.createElement("canvas"),n=i.getContext("2d");n.save(),this.wrapperStack.push(new sr(i,n))}const e=this.wrapperStack[this.wrapperStackIndex],t=e.context;e.setDimensions(this.canvas.width,this.canvas.height),t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,this.canvas.width,this.canvas.height)}popWrapper(){this.wrapperStackIndex--,this.clipDirty=!0}walkDown(e,t){const i=this.filterRootInstance.trail.length-1;for(let n=e.length-1;n>=t;n--){const r=e.nodes[n];if(r.hasClipArea()&&(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Pop clip ${e.subtrailTo(r).toDebugString()}`),this.clipCount--,this.clipDirty=!0),n>i){if(r._filters.length){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Pop filters ${e.subtrailTo(r).toDebugString()}`);const h=this.wrapperStack[this.wrapperStackIndex],p=this.wrapperStack[this.wrapperStackIndex-1];this.popWrapper(),p.context.setTransform(1,0,0,1,0,0);const S=r._filters;let C=Qe.canvasFilter;for(let B=0;B<S.length;B++)C=C&&S[B].isDOMCompatible();if(C){let B="";for(let U=0;U<S.length;U++)B+=`${B?" ":""}${S[U].getCSSFilterString()}`;p.context.filter=B,p.context.drawImage(h.canvas,0,0),p.context.filter="none"}else{for(let B=0;B<S.length;B++)S[B].applyCanvasFilter(h);p.context.drawImage(h.canvas,0,0)}}if(r.getEffectiveOpacity()!==1){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Pop opacity ${e.subtrailTo(r).toDebugString()}`);const h=this.wrapperStack[this.wrapperStackIndex],p=this.wrapperStack[this.wrapperStackIndex-1];this.popWrapper(),p.context.setTransform(1,0,0,1,0,0),p.context.globalAlpha=r.getEffectiveOpacity(),p.context.drawImage(h.canvas,0,0),p.context.globalAlpha=1}}}}walkUp(e,t){const i=this.filterRootInstance.trail.length-1;for(let n=t;n<e.length;n++){const r=e.nodes[n];n>i&&(r.getEffectiveOpacity()!==1&&(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Push opacity ${e.subtrailTo(r).toDebugString()}`),this.pushWrapper()),r._filters.length&&(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Push filters ${e.subtrailTo(r).toDebugString()}`),this.pushWrapper())),r.hasClipArea()&&(sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`Push clip ${e.subtrailTo(r).toDebugString()}`),this.clipCount++,this.clipDirty=!0)}}renderDrawable(e){if(!e.visible||this.canvas.width===0||this.canvas.height===0)return;sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`renderDrawable #${e.id} ${e.instance.trail.toDebugString()}`),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.push();const t=this.currentDrawable?e.instance.getBranchIndexTo(this.currentDrawable.instance):0;this.currentDrawable&&this.walkDown(this.currentDrawable.instance.trail,t),this.walkUp(e.instance.trail,t);const i=this.wrapperStack[this.wrapperStackIndex],n=i.context;this.clipDirty&&this.applyClip(e),assert&&assert(e.instance.relativeTransform.isValidationNotNeeded());const r=e.instance.relativeTransform.matrix;n.setTransform(this.backingScale,0,0,this.backingScale,this.canvasDrawOffset.x*this.backingScale,this.canvasDrawOffset.y*this.backingScale),e.instance!==this.transformRootInstance&&r.canvasAppendTransform(n),e.paintCanvas(i,e.instance.node,e.instance.relativeTransform.matrix),this.currentDrawable=e,sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.pop()}dispose(){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`dispose #${this.id}`),this.transformRootInstance=null,Bt(this.dirtyDrawables),this.canvas.width=0,this.canvas.height=0,super.dispose()}markDirtyDrawable(e){sceneryLog&&sceneryLog.dirty&&sceneryLog.dirty(`markDirtyDrawable on CanvasBlock#${this.id} with ${e.toString()}`),assert&&assert(e),assert&&this.display.ensureNotPainting(),this.dirtyDrawables.push(e),this.markDirty()}addDrawable(e){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`#${this.id}.addDrawable ${e.toString()}`),super.addDrawable(e);for(let t=e.instance;t&&t!==this.filterRootInstance;t=t.parent){const i=t.node;this.filterListenerCountMap[i.id]?this.filterListenerCountMap[i.id]++:(this.filterListenerCountMap[i.id]=1,i.filterChangeEmitter.addListener(this.opacityDirtyListener),i.clipAreaProperty.lazyLink(this.clipDirtyListener))}}removeDrawable(e){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`#${this.id}.removeDrawable ${e.toString()}`);for(let t=e.instance;t&&t!==this.filterRootInstance;t=t.parent){const i=t.node;assert&&assert(this.filterListenerCountMap[i.id]>0),this.filterListenerCountMap[i.id]--,this.filterListenerCountMap[i.id]===0&&(delete this.filterListenerCountMap[i.id],i.clipAreaProperty.unlink(this.clipDirtyListener),i.filterChangeEmitter.removeListener(this.opacityDirtyListener))}super.removeDrawable(e)}onIntervalChange(e,t){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`#${this.id}.onIntervalChange ${e.toString()} to ${t.toString()}`),super.onIntervalChange(e,t),this.markDirty()}onPotentiallyMovedDrawable(e){sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.CanvasBlock(`#${this.id}.onPotentiallyMovedDrawable ${e.toString()}`),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.push(),assert&&assert(e.parentDrawable===this),e.markDirty(),sceneryLog&&sceneryLog.CanvasBlock&&sceneryLog.pop()}toString(){return`CanvasBlock#${this.id}-${fn.fitString[this.fit]}`}}q.register("CanvasBlock",td);$t.mixInto(td);const id=td;class sd extends nr{constructor(e,t){super(),this.initialize(e,t)}initialize(e,t){return super.initialize(e,t.renderer),this.domDrawable=t,this.domElement=t.domElement,this}update(){return super.update()?(this.domDrawable.update(),!0):!1}dispose(){this.domDrawable=null,this.domElement=null,super.dispose()}markDirtyDrawable(e){this.markDirty()}addDrawable(e){sceneryLog&&sceneryLog.DOMBlock&&sceneryLog.DOMBlock(`#${this.id}.addDrawable ${e.toString()}`),assert&&assert(this.domDrawable===e,"DOMBlock should only be used with one drawable for now (the one it was initialized with)"),super.addDrawable(e)}removeDrawable(e){sceneryLog&&sceneryLog.DOMBlock&&sceneryLog.DOMBlock(`#${this.id}.removeDrawable ${e.toString()}`),assert&&assert(this.domDrawable===e,"DOMBlock should only be used with one drawable for now (the one it was initialized with)"),super.removeDrawable(e)}}q.register("DOMBlock",sd);$t.mixInto(sd);const Em=sd;class nd extends fn{constructor(e,t,i,n){super(),this.initialize(e,t,i,n)}initialize(e,t,i,n){super.initialize(e,t,i,fn.COMMON_ANCESTOR),this.filterRootInstance=n,this.dirtyGradients=Bt(this.dirtyGradients),this.dirtyGroups=Bt(this.dirtyGroups),this.dirtyDrawables=Bt(this.dirtyDrawables),this.paintCountMap=this.paintCountMap||new Vg(this.onAddPaint.bind(this),this.onRemovePaint.bind(this)),this.areReferencesReduced=!0,this.domElement||(this.svg=document.createElementNS(Gt,"svg"),this.svg.style.pointerEvents="none",this.svg.style.position="absolute",this.svg.style.left="0",this.svg.style.top="0",this.svg.setAttribute("focusable",!1),this.defs=document.createElementNS(Gt,"defs"),this.svg.appendChild(this.defs),this.baseTransformGroup=document.createElementNS(Gt,"g"),this.svg.appendChild(this.baseTransformGroup),this.domElement=this.svg),this.forceRefreshListener=()=>{if(!this.workaroundRect){const C=document.createElementNS(Gt,"g");this.svg.appendChild(C),this.workaroundRect=document.createElementNS(Gt,"rect"),this.workaroundRect.setAttribute("width","0"),this.workaroundRect.setAttribute("height","0"),this.workaroundRect.setAttribute("fill","none"),C.appendChild(this.workaroundRect)}const h=io.nextIntBetween(0,255),p=io.nextIntBetween(0,255),S=io.nextIntBetween(0,255);this.workaroundRect.setAttribute("fill",`rgba(${h},${p},${S},0.02)`)},this.display._refreshSVGEmitter.addListener(this.forceRefreshListener),Dt.prepareForTransform(this.svg),Dt.unsetTransform(this.svg),this.baseTransformGroup.setAttribute("transform","");const r=i.trail.nodes.length>n.trail.nodes.length?n:i;return this.rootGroup=Qs.createFromPool(this,r,null),this.baseTransformGroup.appendChild(this.rootGroup.svgGroup),sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`initialized #${this.id}`),this}onAddPaint(e){const t=e.createSVGPaint(this);return t.definition.setAttribute("id",`${e.id}-${this.id}`),this.defs.appendChild(t.definition),t}onRemovePaint(e,t){this.defs.removeChild(t.definition),t.dispose()}incrementPaint(e){assert&&assert(e.isPaint),sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`incrementPaint ${this} ${e}`),this.paintCountMap.increment(e)}decrementPaint(e){assert&&assert(e.isPaint),sceneryLog&&sceneryLog.Paints&&sceneryLog.Paints(`decrementPaint ${this} ${e}`),this.paintCountMap.decrement(e)}markDirtyGradient(e){this.dirtyGradients.push(e),this.markDirty()}markDirtyGroup(e){this.dirtyGroups.push(e),this.markDirty(),this.areReferencesReduced&&this.display.markForReducedReferences(this),this.areReferencesReduced=!1}markDirtyDrawable(e){sceneryLog&&sceneryLog.dirty&&sceneryLog.dirty(`markDirtyDrawable on SVGBlock#${this.id} with ${e.toString()}`),this.dirtyDrawables.push(e),this.markDirty(),this.areReferencesReduced&&this.display.markForReducedReferences(this),this.areReferencesReduced=!1}setSizeFullDisplay(){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`setSizeFullDisplay #${this.id}`),this.baseTransformGroup.removeAttribute("transform"),Dt.unsetTransform(this.svg);const e=this.display.getSize();this.svg.setAttribute("width",e.width),this.svg.setAttribute("height",e.height)}setSizeFitBounds(){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`setSizeFitBounds #${this.id} with ${this.fitBounds.toString()}`);const e=this.fitBounds.minX,t=this.fitBounds.minY;assert&&assert(isFinite(e)&&isFinite(t),"Invalid SVG transform for SVGBlock"),assert&&assert(this.fitBounds.isValid(),"Invalid fitBounds"),this.baseTransformGroup.setAttribute("transform",`translate(${-e},${-t})`),Dt.setTransform(`matrix(1,0,0,1,${e},${t})`,this.svg),this.svg.setAttribute("width",this.fitBounds.width),this.svg.setAttribute("height",this.fitBounds.height)}update(){if(!super.update())return!1;for(sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`update #${this.id}`);this.dirtyGroups.length;){const e=this.dirtyGroups.pop();e.block===this&&e.update()}for(;this.dirtyGradients.length;)this.dirtyGradients.pop().update();for(;this.dirtyDrawables.length;){const e=this.dirtyDrawables.pop();e.parentDrawable===this&&e.update()}return this.areReferencesReduced=!0,this.updateFit(),!0}reduceReferences(){if(this.areReferencesReduced)return;let e=0,t=0;for(;e<this.dirtyGroups.length;){const i=this.dirtyGroups[e];i.block===this&&(t!==e&&(this.dirtyGroups[t]=i),t++),e++}for(;this.dirtyGroups.length>t;)this.dirtyGroups.pop();for(e=0,t=0;e<this.dirtyDrawables.length;){const i=this.dirtyDrawables[e];i.parentDrawable===this&&(t!==e&&(this.dirtyDrawables[t]=i),t++),e++}for(;this.dirtyDrawables.length>t;)this.dirtyDrawables.pop();this.areReferencesReduced=!0}dispose(){for(sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`dispose #${this.id}`),this.svg.setAttribute("width","0"),this.svg.setAttribute("height","0"),this.filterRootInstance=null,Bt(this.dirtyGradients),Bt(this.dirtyGroups),Bt(this.dirtyDrawables),this.paintCountMap.clear(),this.display._refreshSVGEmitter.removeListener(this.forceRefreshListener),this.baseTransformGroup.removeChild(this.rootGroup.svgGroup),this.rootGroup.dispose(),this.rootGroup=null;this.defs.childNodes.length;)this.defs.removeChild(this.defs.childNodes[0]);super.dispose()}addDrawable(e){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`#${this.id}.addDrawable ${e.toString()}`),super.addDrawable(e),Qs.addDrawable(this,e),e.updateSVGBlock(this)}removeDrawable(e){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`#${this.id}.removeDrawable ${e.toString()}`),Qs.removeDrawable(this,e),super.removeDrawable(e)}onIntervalChange(e,t){sceneryLog&&sceneryLog.SVGBlock&&sceneryLog.SVGBlock(`#${this.id}.onIntervalChange ${e.toString()} to ${t.toString()}`),super.onIntervalChange(e,t)}toString(){return`SVGBlock#${this.id}-${fn.fitString[this.fit]}`}}q.register("SVGBlock",nd);$t.mixInto(nd);class rd extends fn{constructor(e,t,i,n){super(),this.initialize(e,t,i,n)}initialize(e,t,i,n){return sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`initialize #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),super.initialize(e,t,i,fn.FULL_DISPLAY),this.filterRootInstance=n,this.preserveDrawingBuffer=e._preserveDrawingBuffer,this.dirtyDrawables=Bt(this.dirtyDrawables),this.spriteSheets=this.spriteSheets||[],this.projectionMatrix=this.projectionMatrix||new $e,this.projectionMatrixArray=new Float32Array(9),this.customProcessor=this.customProcessor||new GL,this.vertexColorPolygonsProcessor=this.vertexColorPolygonsProcessor||new zL(this.projectionMatrixArray),this.texturedTrianglesProcessor=this.texturedTrianglesProcessor||new WL(this.projectionMatrixArray),this.glChangedEmitter=new zt,this.isContextLost=!1,this.contextLostListener=this.onContextLoss.bind(this),this.contextRestoreListener=this.onContextRestoration.bind(this),this.domElement||(this.domElement=document.createElement("div"),this.domElement.className="webgl-container",this.domElement.style.position="absolute",this.domElement.style.left="0",this.domElement.style.top="0",this.rebuildCanvas()),this.gl.clear(this.gl.COLOR_BUFFER_BIT),Dt.prepareForTransform(this.canvas),Dt.unsetTransform(this.canvas),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop(),this}rebuildCanvas(){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`rebuildCanvas #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push();const e=document.createElement("canvas"),t=this.getContextFromCanvas(e);assert&&assert(t||this.canvas,"We should have a WebGL context by now"),t&&(this.canvas&&(this.domElement.removeChild(this.canvas),this.canvas.removeEventListener("webglcontextlost",this.contextLostListener,!1),this.canvas.removeEventListener("webglcontextrestored",this.contextRestoreListener,!1)),this.canvas=e,this.canvas.style.pointerEvents="none",this.canvasId=this.canvas.id=`scenery-webgl${this.id}`,this.canvas.addEventListener("webglcontextlost",this.contextLostListener,!1),this.canvas.addEventListener("webglcontextrestored",this.contextRestoreListener,!1),this.domElement.appendChild(this.canvas),this.setupContext(t)),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()}setupContext(e){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`setupContext #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),assert&&assert(e,"Should have an actual context if this is called"),this.isContextLost=!1,this.gl=e,this.backingScale=Dt.backingScale(this.gl),this.display._allowBackingScaleAntialiasing&&e.getParameter(e.SAMPLES)===0&&(this.backingScale*=2),this.originalBackingScale=this.backingScale,Dt.applyWebGLContextDefaults(this.gl),this.markDirty(),this.dirtyFit=!0,this.customProcessor.initializeContext(this.gl),this.vertexColorPolygonsProcessor.initializeContext(this.gl),this.texturedTrianglesProcessor.initializeContext(this.gl);for(let t=0;t<this.spriteSheets.length;t++)this.spriteSheets[t].initializeContext(this.gl);this.glChangedEmitter.emit(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()}delayedRebuildCanvas(){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`Delaying rebuilding of Canvas #${this.id}`);const e=this;e.setTimeout(function(){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`Executing delayed rebuilding #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),e.rebuildCanvas(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()})}onContextLoss(e){this.isContextLost||(sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`Context lost #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),this.isContextLost=!0,e.preventDefault(),this.canvas.style.display="none",this.markDirty(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop())}onContextRestoration(e){if(this.isContextLost){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`Context restored #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push();const t=this.getContextFromCanvas(this.canvas);assert&&assert(t,"We were told the context was restored, so this should work"),this.setupContext(t),this.canvas.style.display="",sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()}}getContextFromCanvas(e){const t={antialias:!0,preserveDrawingBuffer:this.preserveDrawingBuffer};return e.getContext("webgl",t)||e.getContext("experimental-webgl",t)}setSizeFullDisplay(){const e=this.display.getSize();this.canvas.width=Math.ceil(e.width*this.backingScale),this.canvas.height=Math.ceil(e.height*this.backingScale),this.canvas.style.width=`${e.width}px`,this.canvas.style.height=`${e.height}px`}setSizeFitBounds(){throw new Error("setSizeFitBounds unimplemented for WebGLBlock")}update(){if(!super.update())return!1;sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`update #${this.id}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push();const e=this.gl;for(this.isContextLost&&this.display._aggressiveContextRecreation&&this.delayedRebuildCanvas();this.dirtyDrawables.length;)this.dirtyDrawables.pop().update();const t=this.spriteSheets.length;for(let r=0;r<t;r++)this.spriteSheets[r].updateTexture();this.firstDrawable&&this.firstDrawable===this.lastDrawable&&this.firstDrawable.node&&this.firstDrawable.node._webglScale!==null&&this.backingScale!==this.originalBackingScale*this.firstDrawable.node._webglScale&&(this.backingScale=this.originalBackingScale*this.firstDrawable.node._webglScale,this.dirtyFit=!0),this.updateFit(),this.projectionMatrix.rowMajor(2/this.display.width,0,-1,0,-2/this.display.height,1,0,0,1),this.projectionMatrix.copyToArray(this.projectionMatrixArray),this.preserveDrawingBuffer&&e.clear(e.COLOR_BUFFER_BIT),e.viewport(0,0,this.canvas.width,this.canvas.height);let i=null,n=0;for(let r=this.firstDrawable;r!==null;r=r.nextDrawable){if(r.visible){let h=null;r.webglRenderer===ne.webglTexturedTriangles?h=this.texturedTrianglesProcessor:r.webglRenderer===ne.webglCustom?h=this.customProcessor:r.webglRenderer===ne.webglVertexColorPolygons&&(h=this.vertexColorPolygonsProcessor),assert&&assert(h),h!==i&&(i&&(n+=i.deactivate()),i=h,i.activate()),i.processDrawable(r)}if(r===this.lastDrawable)break}return i&&(n+=i.deactivate()),n===0&&!this.preserveDrawingBuffer&&e.clear(e.COLOR_BUFFER_BIT),e.flush(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop(),!0}dispose(){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`dispose #${this.id}`),Bt(this.dirtyDrawables),super.dispose()}markDirtyDrawable(e){sceneryLog&&sceneryLog.dirty&&sceneryLog.dirty(`markDirtyDrawable on WebGLBlock#${this.id} with ${e.toString()}`),assert&&assert(e),assert&&assert(!e.isDisposed),this.dirtyDrawables.push(e),this.markDirty()}addDrawable(e){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`#${this.id}.addDrawable ${e.toString()}`),super.addDrawable(e),e.onAddToBlock(this)}removeDrawable(e){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`#${this.id}.removeDrawable ${e.toString()}`);let t=0;for(;(t=this.dirtyDrawables.indexOf(e,t))>=0;)this.dirtyDrawables.splice(t,1);e.onRemoveFromBlock(this),super.removeDrawable(e)}addSpriteSheetImage(e,t,i){let n=null;const r=this.spriteSheets.length;for(let h=0;h<r&&(n=this.spriteSheets[h].addImage(e,t,i),!n);h++);if(!n){const h=new ar(!0);if(n=h.addImage(e,t,i),h.initializeContext(this.gl),this.spriteSheets.push(h),!n)throw new Error("Attempt to load image that is too large for sprite sheets")}return n}removeSpriteSheetImage(e){e.spriteSheet.removeImage(e.image)}onIntervalChange(e,t){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`#${this.id}.onIntervalChange ${e.toString()} to ${t.toString()}`),super.onIntervalChange(e,t),this.markDirty()}onPotentiallyMovedDrawable(e){sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.WebGLBlock(`#${this.id}.onPotentiallyMovedDrawable ${e.toString()}`),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.push(),assert&&assert(e.parentDrawable===this),this.markDirty(),sceneryLog&&sceneryLog.WebGLBlock&&sceneryLog.pop()}toString(){return`WebGLBlock#${this.id}-${fn.fitString[this.fit]}`}}q.register("WebGLBlock",rd);class ad{activate(){}initializeContext(e){}processDrawable(e){}deactivate(){}}class GL extends ad{constructor(){super(),this.drawable=null}activate(){this.drawCount=0}processDrawable(e){assert&&assert(e.webglRenderer===ne.webglCustom),this.drawable=e,this.draw()}deactivate(){return this.drawCount}draw(){if(this.drawable){const e=this.drawable.draw();assert&&assert(typeof e=="number"),this.drawCount+=e,this.drawable=null}}}class zL extends ad{constructor(e){assert&&assert(e instanceof Float32Array),super(),this.projectionMatrixArray=e,this.lastArrayLength=128,this.vertexArray=new Float32Array(this.lastArrayLength)}initializeContext(e){assert&&assert(e,"Should be an actual context"),this.gl=e,this.shaderProgram=new Wl(e,["attribute vec2 aVertex;","attribute vec4 aColor;","varying vec4 vColor;","uniform mat3 uProjectionMatrix;","void main() {","  vColor = aColor;","  vec3 ndc = uProjectionMatrix * vec3( aVertex, 1.0 );","  gl_Position = vec4( ndc.xy, 0.0, 1.0 );","}"].join(`
`),["precision mediump float;","varying vec4 vColor;","void main() {","  gl_FragColor = vec4( vColor.rgb * vColor.a, vColor.a );","}"].join(`
`),{attributes:["aVertex","aColor"],uniforms:["uProjectionMatrix"]}),this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.DYNAMIC_DRAW)}activate(){this.shaderProgram.use(),this.vertexArrayIndex=0,this.drawCount=0}processDrawable(e){if(e.includeVertices){const t=e.vertexArray;for(;t.length+this.vertexArrayIndex>this.vertexArray.length;){const i=new Float32Array(this.vertexArray.length*2);i.set(this.vertexArray),this.vertexArray=i}this.vertexArray.set(t,this.vertexArrayIndex),this.vertexArrayIndex+=t.length,this.drawCount++}}deactivate(){return this.drawCount&&this.draw(),this.shaderProgram.unuse(),this.drawCount}draw(){const e=this.gl;e.uniformMatrix3fv(this.shaderProgram.uniformLocations.uProjectionMatrix,!1,this.projectionMatrixArray),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray.length>this.lastArrayLength?e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.DYNAMIC_DRAW):e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray.subarray(0,this.vertexArrayIndex));const t=Float32Array.BYTES_PER_ELEMENT,i=6*t;e.vertexAttribPointer(this.shaderProgram.attributeLocations.aVertex,2,e.FLOAT,!1,i,0*t),e.vertexAttribPointer(this.shaderProgram.attributeLocations.aColor,4,e.FLOAT,!1,i,2*t),e.drawArrays(e.TRIANGLES,0,this.vertexArrayIndex/6),this.vertexArrayIndex=0}}class WL extends ad{constructor(e){assert&&assert(e instanceof Float32Array),super(),this.projectionMatrixArray=e,this.lastArrayLength=128,this.vertexArray=new Float32Array(this.lastArrayLength)}initializeContext(e){assert&&assert(e,"Should be an actual context"),this.gl=e,this.shaderProgram=new Wl(e,["attribute vec2 aVertex;","attribute vec2 aTextureCoord;","attribute float aAlpha;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform mat3 uProjectionMatrix;","void main() {","  vTextureCoord = aTextureCoord;","  vAlpha = aAlpha;","  vec3 ndc = uProjectionMatrix * vec3( aVertex, 1.0 );","  gl_Position = vec4( ndc.xy, 0.0, 1.0 );","}"].join(`
`),["precision mediump float;","varying vec2 vTextureCoord;","varying float vAlpha;","uniform sampler2D uTexture;","void main() {","  vec4 color = texture2D( uTexture, vTextureCoord, -0.7 );","  color.a *= vAlpha;","  gl_FragColor = color;","}"].join(`
`),{attributes:["aVertex","aTextureCoord","aAlpha"],uniforms:["uTexture","uProjectionMatrix"]}),this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.DYNAMIC_DRAW)}activate(){this.shaderProgram.use(),this.currentSpriteSheet=null,this.vertexArrayIndex=0,this.drawCount=0}processDrawable(e){if(!e.sprite)return;assert&&assert(e.webglRenderer===ne.webglTexturedTriangles),this.currentSpriteSheet&&e.sprite.spriteSheet!==this.currentSpriteSheet&&this.draw(),this.currentSpriteSheet=e.sprite.spriteSheet;const t=e.vertexArray;for(;t.length+this.vertexArrayIndex>this.vertexArray.length;){const i=new Float32Array(this.vertexArray.length*2);i.set(this.vertexArray),this.vertexArray=i}this.vertexArray.set(t,this.vertexArrayIndex),this.vertexArrayIndex+=t.length}deactivate(){return this.currentSpriteSheet&&this.draw(),this.shaderProgram.unuse(),this.drawCount}draw(){assert&&assert(this.currentSpriteSheet);const e=this.gl;e.uniformMatrix3fv(this.shaderProgram.uniformLocations.uProjectionMatrix,!1,this.projectionMatrixArray),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray.length>this.lastArrayLength?e.bufferData(e.ARRAY_BUFFER,this.vertexArray,e.DYNAMIC_DRAW):e.bufferSubData(e.ARRAY_BUFFER,0,this.vertexArray.subarray(0,this.vertexArrayIndex));const t=5,i=Float32Array.BYTES_PER_ELEMENT,n=t*i;e.vertexAttribPointer(this.shaderProgram.attributeLocations.aVertex,2,e.FLOAT,!1,n,0*i),e.vertexAttribPointer(this.shaderProgram.attributeLocations.aTextureCoord,2,e.FLOAT,!1,n,2*i),e.vertexAttribPointer(this.shaderProgram.attributeLocations.aAlpha,1,e.FLOAT,!1,n,4*i),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this.currentSpriteSheet.texture),e.uniform1i(this.shaderProgram.uniformLocations.uTexture,0),e.drawArrays(e.TRIANGLES,0,this.vertexArrayIndex/t),e.bindTexture(e.TEXTURE_2D,null),this.drawCount++,this.currentSpriteSheet=null,this.vertexArrayIndex=0}}$t.mixInto(rd);const km=rd;class ur{initialize(e,t,i,n,r,h,p){assert&&assert(h&&p,"We are guaranteed at least one change interval"),assert&&assert(!t||t.previousDrawable===null,"End boundary of drawable linked list should link to null"),assert&&assert(!i||i.nextDrawable===null,"End boundary of drawable linked list should link to null"),sceneryLog&&sceneryLog.Stitch&&(sceneryLog.Stitch(`stitch ${e.toString()} first:${t?t.toString():"null"} last:${i?i.toString():"null"} oldFirst:${n?n.toString():"null"} oldLast:${r?r.toString():"null"}`),sceneryLog.push()),sceneryLog&&sceneryLog.StitchDrawables&&(sceneryLog.StitchDrawables("Before:"),sceneryLog.push(),ur.debugDrawables(n,r,h,p,!1),sceneryLog.pop(),sceneryLog.StitchDrawables("After:"),sceneryLog.push(),ur.debugDrawables(t,i,h,p,!0),sceneryLog.pop()),this.backbone=e,this.firstDrawable=t,this.lastDrawable=i,this.touchedBlocks=Bt(this.touchedBlocks),assertSlow&&(assertSlow(!this.initialized,"We should not be already initialized (clean should be called)"),this.initialized=!0,this.reindexed=!1,this.pendingAdditions=[],this.pendingRemovals=[],this.pendingMoves=[],this.createdBlocks=[],this.disposedBlocks=[],this.intervalsNotified=[],this.boundariesRecorded=!1,this.previousBlocks=e.blocks.slice(0))}clean(){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch("clean"),sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch("-----------------------------------"),assertSlow&&(this.auditStitch(),this.initialized=!1),this.backbone=null,this.firstDrawable=null,this.lastDrawable=null,sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}recordBackboneBoundaries(){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`recording backbone boundaries: ${this.firstDrawable?this.firstDrawable.toString():"null"} to ${this.lastDrawable?this.lastDrawable.toString():"null"}`),this.backbone.previousFirstDrawable=this.firstDrawable,this.backbone.previousLastDrawable=this.lastDrawable,assertSlow&&(this.boundariesRecorded=!0)}notePendingAddition(e,t){assert&&assert(e.renderer===t.renderer),sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`pending add: ${e.toString()} to ${t.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),e.notePendingAddition(this.backbone.display,t,this.backbone),assertSlow&&this.pendingAdditions.push({drawable:e,block:t}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}notePendingMove(e,t){assert&&assert(e.renderer===t.renderer),sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`pending move: ${e.toString()} to ${t.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),e.notePendingMove(this.backbone.display,t),assertSlow&&this.pendingMoves.push({drawable:e,block:t}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}notePendingRemoval(e){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`pending remove: ${e.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),e.notePendingRemoval(this.backbone.display),assertSlow&&this.pendingRemovals.push({drawable:e}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}markBlockForDisposal(e){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`block for disposal: ${e.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),e.domElement.parentNode===this.backbone.domElement&&this.backbone.domElement.removeChild(e.domElement),e.markForDisposal(this.backbone.display),assertSlow&&this.disposedBlocks.push({block:e}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}removeAllBlocks(){for(sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`marking all blocks for disposal (count ${this.backbone.blocks.length})`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push();this.backbone.blocks.length;){const e=this.backbone.blocks[0];this.removeBlock(e),this.markBlockForDisposal(e)}sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}notifyInterval(e,t,i){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`notify interval: ${e.toString()} ${t.toString()} to ${i.toString()}`),sceneryLog&&sceneryLog.Stitch&&sceneryLog.push(),e.notifyInterval(t,i),this.backbone.markDirtyDrawable(e),assertSlow&&this.intervalsNotified.push({block:e,firstDrawable:t,lastDrawable:i}),sceneryLog&&sceneryLog.Stitch&&sceneryLog.pop()}markBeforeBlock(e,t){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`marking block first drawable ${e.toString()} with ${t.toString()}`),e.pendingFirstDrawable=t,this.touchedBlocks.push(e)}markAfterBlock(e,t){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`marking block last drawable ${e.toString()} with ${t.toString()}`),e.pendingLastDrawable=t,this.touchedBlocks.push(e)}updateBlockIntervals(){for(;this.touchedBlocks.length;){const e=this.touchedBlocks.pop();e.used?(sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`update interval: ${e.toString()} ${e.pendingFirstDrawable.toString()} to ${e.pendingLastDrawable.toString()}`),e.updateInterval(),this.backbone.markDirtyDrawable(e),assertSlow&&this.intervalsNotified.push({block:e,firstDrawable:e.pendingFirstDrawable,lastDrawable:e.pendingLastDrawable})):sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`skipping update interval: ${e.toString()}, unused`)}}createBlock(e,t){const i=this.backbone;let n;if(ne.isCanvas(e))n=id.createFromPool(i.display,e,i.transformRootInstance,i.backboneInstance);else if(ne.isSVG(e))n=nd.createFromPool(i.display,e,i.transformRootInstance,i.backboneInstance);else if(ne.isDOM(e))n=Em.createFromPool(i.display,t);else if(ne.isWebGL(e))n=km.createFromPool(i.display,e,i.transformRootInstance,i.backboneInstance);else throw new Error(`unsupported renderer for createBlock: ${e}`);return sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`created block: ${n.toString()} with renderer: ${e} for drawable: ${t.toString()}`),n.setBlockBackbone(i),i.domElement.appendChild(n.domElement),i.isDisplayRoot&&n.domElement.setAttribute("aria-hidden",!0),i.markDirtyDrawable(n),assertSlow&&this.createdBlocks.push({block:n,renderer:e,drawable:t}),n}appendBlock(e){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`appending block: ${e.toString()}`),this.backbone.blocks.push(e),assertSlow&&(this.reindexed=!1)}removeBlock(e){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch(`removing block: ${e.toString()}`);const t=_.indexOf(this.backbone.blocks,e);assert&&assert(t>=0,`Cannot remove block, not attached: ${e.toString()}`),this.backbone.blocks.splice(t,1),assertSlow&&(this.reindexed=!1)}useNoBlocks(){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch("using no blocks"),Bt(this.backbone.blocks)}reindex(){sceneryLog&&sceneryLog.Stitch&&sceneryLog.Stitch("reindexing blocks"),this.backbone.reindexBlocks(),assertSlow&&(this.reindexed=!0)}auditStitch(){if(assertSlow){const e=this.backbone.blocks,t=this.previousBlocks;if(assertSlow(this.initialized,"We seem to have finished a stitch without proper initialization"),assertSlow(this.boundariesRecorded,"Our stitch API requires recordBackboneBoundaries() to be called before it is finished."),assertSlow(this.reindexed||e.length===0||t.length===e.length&&_.every(_.zip(t,e),i=>i[0]===i[1]),"Did not reindex on a block change where we are left with blocks"),_.each(this.createdBlocks,i=>{assertSlow(_.some(this.intervalsNotified,n=>i.block===n.block),`Created block does not seem to have an interval notified: ${i.block.toString()}`)}),_.each(this.disposedBlocks,i=>{assertSlow(!_.some(this.intervalsNotified,n=>i.block===n.block),`Removed block seems to have an interval notified: ${i.block.toString()}`)}),_.each(this.disposedBlocks,i=>{const n=i.block;_.each(Ii.oldListToArray(n.firstDrawable,n.lastDrawable),r=>{assertSlow(_.some(this.pendingRemovals,h=>h.drawable===r)||_.some(this.pendingMoves,h=>h.drawable===r),`Drawable ${r.toString()} originally listed for disposed block ${n.toString()} does not seem to be marked for pending removal or move!`)})}),_.each(this.createdBlocks,i=>{const n=i.block;_.each(Ii.listToArray(n.pendingFirstDrawable,n.pendingLastDrawable),r=>{assertSlow(_.some(this.pendingAdditions,h=>h.drawable===r&&h.block===n)||_.some(this.pendingMoves,h=>h.drawable===r&&h.block===n),`Drawable ${r.toString()} now listed for created block ${n.toString()} does not seem to be marked for pending addition or move!`)})}),_.each(this.disposedBlocks,i=>{const n=_.indexOf(e,i.block);assertSlow(n<0,`Disposed block ${i.block.toString()} still present at index ${n}`)}),_.each(this.createdBlocks,i=>{const n=_.indexOf(e,i.block);assertSlow(n>=0,`Created block ${i.block.toString()} is not in the blocks array`)}),_.each(e,i=>{assertSlow(i.used,"All current blocks should be marked as used")}),assertSlow(e.length-t.length===this.createdBlocks.length-this.disposedBlocks.length,`The count of unmodified blocks should be constant (equal differences):
created: ${_.map(this.createdBlocks,i=>i.block.id).join(",")}
disposed: ${_.map(this.disposedBlocks,i=>i.block.id).join(",")}
before: ${_.map(t,i=>i.id).join(",")}
after: ${_.map(e,i=>i.id).join(",")}`),assertSlow(this.touchedBlocks.length===0,"If we marked any blocks for changes, we should have called updateBlockIntervals"),e.length){assertSlow(this.backbone.previousFirstDrawable!==null&&this.backbone.previousLastDrawable!==null,"If we are left with at least one block, we must be tracking at least one drawable"),assertSlow(e[0].pendingFirstDrawable===this.backbone.previousFirstDrawable,"Our first drawable should match the first drawable of our first block"),assertSlow(e[e.length-1].pendingLastDrawable===this.backbone.previousLastDrawable,"Our last drawable should match the last drawable of our last block");for(let i=0;i<e.length-1;i++)assertSlow(e[i].pendingLastDrawable.nextDrawable===e[i+1].pendingFirstDrawable&&e[i].pendingLastDrawable===e[i+1].pendingFirstDrawable.previousDrawable,"Consecutive blocks should have boundary drawables that are also consecutive in the linked list")}else assertSlow(this.backbone.previousFirstDrawable===null&&this.backbone.previousLastDrawable===null,"If we are left with no blocks, it must mean we are tracking precisely zero drawables")}}static debugIntervals(e){if(sceneryLog&&sceneryLog.Stitch)for(let t=e;t!==null;t=t.nextChangeInterval)sceneryLog.Stitch(`  interval: ${t.isEmpty()?"(empty) ":""}${t.drawableBefore?t.drawableBefore.toString():"-"} to ${t.drawableAfter?t.drawableAfter.toString():"-"}`)}static debugDrawables(e,t,i,n,r){if(sceneryLog&&sceneryLog.StitchDrawables){if(e===null){sceneryLog.StitchDrawables("nothing","color: #666;");return}let h=i.drawableBefore===null,p=i;for(let S=e;;S=r?S.nextDrawable:S.oldNextDrawable){h&&S===p.drawableAfter&&(h=!1,p=p.nextChangeInterval);const C=`${S.renderer} ${!r&&S.parentDrawable?S.parentDrawable.toString():""} ${S.toDetailedString()}`;if(sceneryLog.StitchDrawables(C,h?r?"color: #0a0;":"color: #a00;":"color: #666"),!h&&p&&p.drawableBefore===S&&(h=!0),S===t)break}}}}q.register("Stitcher",ur);function El(l,e){return l.renderer!==e.renderer||ne.isDOM(l.renderer)||ne.isDOM(e.renderer)}function ac(l){return l.previousDrawable!==null&&!El(l.previousDrawable,l)}function oc(l){return l.nextDrawable!==null&&!El(l,l.nextDrawable)}function $L(l,e,t){return l.drawableBefore?l.drawableBefore.nextDrawable!==l.drawableAfter:l.drawableAfter?l.drawableAfter.previousDrawable!==l.drawableBefore:e!==null}function UL(l,e,t){return l.drawableBefore?l.drawableBefore.oldNextDrawable!==l.drawableAfter:l.drawableAfter?l.drawableAfter.oldPreviousDrawable!==l.drawableBefore:e!==null}function YL(l,e,t){const i=l.drawableBefore?l.drawableBefore.parentDrawable:null,n=l.drawableAfter?l.drawableAfter.parentDrawable:null;return i&&n&&i===n?!1:i?i.nextBlock!==n:n?n.previousBlock!==i:e!==null}function KL(l){const e=l.drawableAfter;if(e){const t=e.renderer,i=l.nextChangeInterval?l.nextChangeInterval.drawableBefore.nextDrawable:null;let n=e;for(;;){const r=n.nextDrawable;if(r!==i&&r.renderer===t)n=r;else break}return n}else return null}class Am extends ur{stitch(e,t,i,n,r,h,p){this.initialize(e,t,i,n,r,h,p),this.blockOrderChanged=!1,this.reusableBlocks=Bt(this.reusableBlocks),this.blockWasAdded=!1;let S;if(this.recordBackboneBoundaries(),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher("phase 1: old linked list"),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),e.blocks.length){const C=e.blocks[0];for(e.blocks[e.blocks.length-1],S=h;S!==null;S=S.nextChangeInterval){if(assert&&assert(!S.isEmpty(),"We now guarantee that the intervals are non-empty"),UL(S,n)){const B=S.drawableBefore?S.drawableBefore.oldNextDrawable:n,U=S.drawableAfter?S.drawableAfter.oldPreviousDrawable:r;for(let k=B;this.notePendingRemoval(k),k!==U;k=k.oldNextDrawable);}if(YL(S,C)){const B=S.drawableBefore===null?e.blocks[0]:S.drawableBefore.parentDrawable.nextBlock,U=S.drawableAfter===null?e.blocks[e.blocks.length-1]:S.drawableAfter.parentDrawable.previousBlock;for(let k=B;this.unuseBlock(k),k!==U;k=k.nextBlock);}}}if(sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop(),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher("phase 2: new linked list"),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),t)for(S=h;S!==null;S=S.nextChangeInterval)this.processInterval(e,S,t,i);sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop(),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher("phase 3: cleanup"),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),this.removeUnusedBlocks(),this.updateBlockIntervals(),t===null?this.useNoBlocks():this.blockOrderChanged&&(this.processBlockLinkedList(e,t.pendingParentDrawable,i.pendingParentDrawable),this.reindex()),this.clean(),Bt(this.reusableBlocks),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop()}processInterval(e,t,i,n){if(assert&&assert(t instanceof Cs),assert&&assert(i instanceof Ii,"We assume we have a non-null remaining section"),assert&&assert(n instanceof Ii,"We assume we have a non-null remaining section"),assert&&assert(!t.isEmpty(),"We now guarantee that the intervals are non-empty"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`interval: ${t.drawableBefore?t.drawableBefore.toString():"null"} to ${t.drawableAfter?t.drawableAfter.toString():"null"}`),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),$L(t,i)){let r=t.drawableBefore?t.drawableBefore.nextDrawable:i,h=null,p=null,S=!0;for(;;){const C=r.nextDrawable,B=C===t.drawableAfter;if(assert&&assert(C!==null||B,"If our nextDrawable is null, isLast must be true"),h||(h=r),p===null&&r.parentDrawable&&!r.parentDrawable.used&&r.backbone===e&&r.parentDrawable.parentDrawable===e&&(p=r.parentDrawable,sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`matching at ${r.toString()} with ${p}`)),(B||El(r,C))&&(S&&this.processEdgeCases(t,ac(h),oc(r)),this.processSubBlock(t,h,r,p,S,B),h=null,p=null,S=!1),B)break;r=C}}else{if(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("no current internal drawables in interval"),t.drawableBefore&&t.drawableAfter){assert&&assert(t.drawableBefore.nextDrawable===t.drawableAfter);const r=!El(t.drawableBefore,t.drawableAfter);this.processEdgeCases(t,r,r)}t.drawableBefore&&!oc(t.drawableBefore)?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("closed-after collapsed link:"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.linkAfterDrawable(t.drawableBefore),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()):t.drawableAfter&&!ac(t.drawableAfter)&&(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("closed-before collapsed link:"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.linkBeforeDrawable(t.drawableAfter),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop())}sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()}processSubBlock(e,t,i,n,r,h){sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`sub-block: ${t.toString()} to ${i.toString()} ${n?`with matched: ${n.toString()}`:"with no match"}`),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push();const p=ac(t),S=oc(i);assert&&assert(!p||r,"openBefore implies isFirst"),assert&&assert(!S||h,"openAfter implies isLast"),assert&&assert(!p||!S||t.previousDrawable.pendingParentDrawable===i.nextDrawable.pendingParentDrawable,"If we would use both the before and after blocks, make sure any gluing "),p&&(n=t.previousDrawable.pendingParentDrawable,sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`combining into before block: ${n.toString()}`)),S&&(n=i.nextDrawable.pendingParentDrawable,sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`combining into after block: ${n.toString()}`)),n=this.ensureUsedBlock(n,t);for(let C=t;this.notePendingAddition(C,n),C!==i;C=C.nextDrawable);p||(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("closed-before link:"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.linkBeforeDrawable(t),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()),h&&!S&&(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("last closed-after link:"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.linkAfterDrawable(i),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()}processEdgeCases(e,t,i){if(e.drawableBefore!==null&&e.drawableAfter!==null){const n=e.drawableBefore.pendingParentDrawable,r=e.drawableAfter.pendingParentDrawable,h=e.nextChangeInterval&&e.nextChangeInterval.drawableAfter?e.nextChangeInterval.drawableAfter.pendingParentDrawable:null;n===r&&(this.blockWasAdded=!0),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`edge case: ${t?"open-before ":""}${i?"open-after ":""}${n.toString()} to ${r.toString()}`),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push();let p;t&&i?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`glue using ${n.toString()}`),p=n):this.blockWasAdded||n===r?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("split with fresh block"),p=this.createBlock(e.drawableAfter.renderer,e.drawableAfter),this.blockOrderChanged=!0):(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`split with same afterBlock ${r.toString()}`),p=r),r===p?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("no externals change here (blockWasAdded => true)"),this.blockWasAdded=!0):(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("moving externals"),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.push(),this.changeExternals(e,p),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()),h!==r&&(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("end of afterBlock stretch"),this.blockWasAdded||(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`unusing ${r.toString()}`),this.unuseBlock(r)),this.blockWasAdded=!1),sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.pop()}}changeExternals(e,t){const i=KL(e);this.notePendingMoves(t,e.drawableAfter,i),(!e.nextChangeInterval||e.nextChangeInterval.drawableBefore!==i)&&this.linkAfterDrawable(i)}notePendingMoves(e,t,i){for(let n=t;assert&&assert(!n.pendingAddition&&!n.pendingRemoval,"Moved drawables should be thought of as unchanged, and thus have nothing pending yet"),this.notePendingMove(n,e),n!==i;n=n.nextDrawable);}ensureUsedBlock(e,t){return e?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`using existing block: ${e.toString()}`),e.used||this.useBlock(e)):(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose("searching for block"),e=this.getBlockForRenderer(t.renderer,t)),e}getBlockForRenderer(e,t){let i;if(!ne.isDOM(e))for(let n=this.reusableBlocks.length-1;n>=0;n--){const r=this.reusableBlocks[n];if(assert&&assert(!r.used),r.renderer===e){this.useBlockAtIndex(r,n),i=r;break}}return i||(i=this.createBlock(e,t)),this.blockOrderChanged=!0,i}unuseBlock(e){e.used?(sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`unusing block: ${e.toString()}`),e.used=!1,this.reusableBlocks.push(e)):sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`not using already-unused block: ${e.toString()}`)}useBlock(e){this.useBlockAtIndex(e,_.indexOf(this.reusableBlocks,e))}useBlockAtIndex(e,t){sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`using reusable block: ${e.toString()} with renderer: ${e.renderer}`),assert&&assert(t>=0&&this.reusableBlocks[t]===e,`bad index for useBlockAtIndex: ${t}`),assert&&assert(!e.used,"Should be called on an unused (reusable) block"),this.reusableBlocks.splice(t,1),e.used=!0}removeUnusedBlocks(){for(sceneryLog&&sceneryLog.GreedyStitcher&&this.reusableBlocks.length&&sceneryLog.GreedyStitcher("removeUnusedBlocks"),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push();this.reusableBlocks.length;){const e=this.reusableBlocks.pop();this.markBlockForDisposal(e),this.blockOrderChanged=!0}sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop()}linkBeforeDrawable(e){sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`link before ${e.toString()}`);const t=e.previousDrawable;this.linkBlocks(t?t.pendingParentDrawable:null,e.pendingParentDrawable,t,e)}linkAfterDrawable(e){sceneryLog&&sceneryLog.GreedyVerbose&&sceneryLog.GreedyVerbose(`link after ${e.toString()}`);const t=e.nextDrawable;this.linkBlocks(e.pendingParentDrawable,t?t.pendingParentDrawable:null,e,t)}linkBlocks(e,t,i,n){sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher(`linking blocks: ${e?`${e.toString()} (${i.toString()})`:"null"} to ${t?`${t.toString()} (${n.toString()})`:"null"}`),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),assert&&assert(e===null&&i===null||e instanceof nr&&i instanceof Ii),assert&&assert(t===null&&n===null||t instanceof nr&&n instanceof Ii),e&&(e.nextBlock!==t&&(this.blockOrderChanged=!0,e.nextBlock&&(e.nextBlock.previousBlock=null),e.nextBlock=t),this.markAfterBlock(e,i)),t&&(t.previousBlock!==e&&(this.blockOrderChanged=!0,t.previousBlock&&(t.previousBlock.nextBlock=null),t.previousBlock=e),this.markBeforeBlock(t,n)),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop()}processBlockLinkedList(e,t,i){for(;e.blocks.length;)e.blocks.pop();if(sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher(`processBlockLinkedList: ${t.toString()} to ${i.toString()}`),sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.push(),t)for(let n=t;sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.GreedyStitcher(n.toString()),e.blocks.push(n),n!==i;n=n.nextBlock);sceneryLog&&sceneryLog.GreedyStitcher&&sceneryLog.pop()}}q.register("GreedyStitcher",Am);class jL extends ur{stitch(e,t,i,n,r,h,p){this.initialize(e,t,i,n,r,h,p);for(let U=e.previousFirstDrawable;U!==null&&(this.notePendingRemoval(U),U!==e.previousLastDrawable);U=U.oldNextDrawable);this.recordBackboneBoundaries(),this.removeAllBlocks();let S=null,C=0,B=null;for(let U=t;U!==null&&((!S||U.renderer!==C)&&(S&&this.notifyInterval(S,B,U.previousDrawable),C=U.renderer,S=this.createBlock(C,U),ne.isDOM(C)&&(C=0),this.appendBlock(S),B=U),this.notePendingAddition(U,S),U!==i);U=U.nextDrawable);S&&this.notifyInterval(S,B,i),this.reindex(),this.clean()}}q.register("RebuildStitcher",jL);class zo extends Ii{constructor(e,t,i,n,r){super(),this.initialize(e,t,i,n,r)}initialize(e,t,i,n,r){if(super.initialize(n),this.display=e,this.backboneInstance=t,this.transformRootInstance=i,this.filterRootAncestorInstance=t.parent?t.parent.getFilterRootInstance():t,this.transformRootAncestorInstance=t.parent?t.parent.getTransformRootInstance():t,this.willApplyTransform=this.transformRootAncestorInstance!==this.transformRootInstance,this.willApplyFilters=this.filterRootAncestorInstance!==this.backboneInstance,this.transformListener=this.transformListener||this.markTransformDirty.bind(this),this.willApplyTransform&&(this.backboneInstance.relativeTransform.addListener(this.transformListener),this.backboneInstance.relativeTransform.addPrecompute()),this.backboneVisibilityListener=this.backboneVisibilityListener||this.updateBackboneVisibility.bind(this),this.backboneInstance.relativeVisibleEmitter.addListener(this.backboneVisibilityListener),this.updateBackboneVisibility(),this.visibilityDirty=!0,this.renderer=n,this.domElement=r?e.domElement:zo.createDivBackbone(),this.isDisplayRoot=r,this.dirtyDrawables=Bt(this.dirtyDrawables),Dt.prepareForTransform(this.domElement),this.watchedFilterNodes=Bt(this.watchedFilterNodes),this.filterDirty=!0,this.clipDirty=!0,this.filterDirtyListener=this.filterDirtyListener||this.onFilterDirty.bind(this),this.clipDirtyListener=this.clipDirtyListener||this.onClipDirty.bind(this),this.willApplyFilters){assert&&assert(this.filterRootAncestorInstance.trail.nodes.length<this.backboneInstance.trail.nodes.length,"Our backboneInstance should be deeper if we are applying filters");for(let h=this.backboneInstance;h!==this.filterRootAncestorInstance;h=h.parent){const p=h.node;this.watchedFilterNodes.push(p),p.filterChangeEmitter.addListener(this.filterDirtyListener),p.clipAreaProperty.lazyLink(this.clipDirtyListener)}}this.lastZIndex=0,this.blocks=this.blocks||[],this.previousFirstDrawable=null,this.previousLastDrawable=null,this.removedDrawables=!1,this.stitcher=this.stitcher||new Am,sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.BackboneDrawable(`initialized ${this.toString()}`)}dispose(){for(sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.BackboneDrawable(`dispose ${this.toString()}`),sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.push();this.watchedFilterNodes.length;){const e=this.watchedFilterNodes.pop();e.filterChangeEmitter.removeListener(this.filterDirtyListener),e.clipAreaProperty.unlink(this.clipDirtyListener)}if(this.backboneInstance.relativeVisibleEmitter.removeListener(this.backboneVisibilityListener),!this.removedDrawables)for(let e=this.previousFirstDrawable;e!==null&&(e.parentDrawable.removeDrawable(e),e!==this.previousLastDrawable);e=e.nextDrawable);this.markBlocksForDisposal(),this.willApplyTransform&&(this.backboneInstance.relativeTransform.removeListener(this.transformListener),this.backboneInstance.relativeTransform.removePrecompute()),this.backboneInstance=null,this.transformRootInstance=null,this.filterRootAncestorInstance=null,this.transformRootAncestorInstance=null,Bt(this.dirtyDrawables),Bt(this.watchedFilterNodes),this.previousFirstDrawable=null,this.previousLastDrawable=null,super.dispose(),sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.pop()}markBlocksForDisposal(){for(;this.blocks.length;){const e=this.blocks.pop();sceneryLog&&sceneryLog.BackboneDrawable&&sceneryLog.BackboneDrawable(`${this.toString()} removing block: ${e.toString()}`),e.domElement.parentNode===this.domElement&&this.domElement.removeChild(e.domElement),e.markForDisposal(this.display)}}updateBackboneVisibility(){this.visible=this.backboneInstance.relativeVisible,this.visibilityDirty||(this.visibilityDirty=!0,this.markDirty())}markForDisposal(e){for(let t=this.previousFirstDrawable;t!==null&&(t.notePendingRemoval(this.display),t!==this.previousLastDrawable);t=t.oldNextDrawable);this.removedDrawables=!0,super.markForDisposal(e)}markDirtyDrawable(e){assert&&this.display.ensureNotPainting(),this.dirtyDrawables.push(e),this.markDirty()}markTransformDirty(){assert&&assert(this.willApplyTransform,"Sanity check for willApplyTransform"),Dt.applyPreparedTransform(this.backboneInstance.relativeTransform.matrix,this.domElement)}onFilterDirty(){this.filterDirty||(this.filterDirty=!0,this.markDirty())}onClipDirty(){this.clipDirty||(this.clipDirty=!0,this.markDirty())}update(){if(!super.update())return!1;for(;this.dirtyDrawables.length;)this.dirtyDrawables.pop().update();if(this.filterDirty){this.filterDirty=!1;let e="";const t=this.watchedFilterNodes.length;for(let i=0;i<t;i++){const n=this.watchedFilterNodes[i],r=n.getEffectiveOpacity();for(let h=0;h<n._filters.length;h++)e+=`${e?" ":""}${n._filters[h].getCSSFilterString()}`;r!==1&&(e+=`${e?" ":""}opacity(${Rt(r)})`)}this.domElement.style.filter=e}return this.visibilityDirty&&(this.visibilityDirty=!1,this.domElement.style.display=this.visible?"":"none"),this.clipDirty&&(this.clipDirty=!1),!0}getFilterVisibility(){const e=this.watchedFilterNodes.length;for(let t=0;t<e;t++)if(!this.watchedFilterNodes[t].isVisible())return!1;return!0}getFilterClip(){return""}reindexBlocks(){let e=0;for(let t=0;t<this.blocks.length;t++){const i=this.blocks[t];if(i.zIndex<=e){const n=t+1<this.blocks.length&&this.blocks[t+1].zIndex-1>e?Math.ceil((e+this.blocks[t+1].zIndex)/2):e+20;i.domElement.style.zIndex=i.zIndex=n}e=i.zIndex,assert&&(assert(this.blocks[t].zIndex%1===0,"z-indices should be integers"),assert(this.blocks[t].zIndex>0,"z-indices should be greater than zero for our needs (see spec)"),t>0&&assert(this.blocks[t-1].zIndex<this.blocks[t].zIndex,"z-indices should be strictly increasing"))}this.lastZIndex=e+1}stitch(e,t,i,n){if(i===null||n===null){assert&&assert(i===null),assert&&assert(n===null);return}assert&&assert(n.nextChangeInterval===null,"This allows us to have less checks in the loop"),sceneryLog&&sceneryLog.Stitch&&(sceneryLog.Stitch(`Stitch intervals before constricting: ${this.toString()}`),sceneryLog.push(),ur.debugIntervals(i),sceneryLog.pop());let r=null,h=i,p=!1;for(;h;)p=h.constrict()||p,h.isEmpty()?(assert&&assert(p),r&&(r.nextChangeInterval=h.nextChangeInterval)):(r||(i=h),r=h),h=h.nextChangeInterval;if(r){if(n=r,n.nextChangeInterval=null,sceneryLog&&sceneryLog.Stitch&&p&&(sceneryLog.Stitch(`Stitch intervals after constricting: ${this.toString()}`),sceneryLog.push(),ur.debugIntervals(i),sceneryLog.pop()),sceneryLog&&q.isLoggingPerformance()){this.display.perfStitchCount++;let S=i;for(;S;)this.display.perfIntervalCount++,this.display.perfDrawableOldIntervalCount+=S.getOldInternalDrawableCount(this.previousFirstDrawable,this.previousLastDrawable),this.display.perfDrawableNewIntervalCount+=S.getNewInternalDrawableCount(e,t),S=S.nextChangeInterval}this.stitcher.stitch(this,e,t,this.previousFirstDrawable,this.previousLastDrawable,i,n)}}audit(e,t,i){if(assertSlow){super.audit(e,t,i),assertSlow&&assertSlow(this.backboneInstance.isBackbone,"We should reference an instance that requires a backbone"),assertSlow&&assertSlow(this.transformRootInstance.isTransformed,"Transform root should be transformed");for(let n=0;n<this.blocks.length;n++)this.blocks[n].audit(e,t,i)}}static createDivBackbone(){const e=document.createElement("div");return e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.width="0",e.style.height="0",e}static repurposeBackboneContainer(e){return(e.style.position!=="relative"||e.style.position!=="absolute")&&(e.style.position="relative"),e.style.left="0",e.style.top="0",e}}q.register("BackboneDrawable",zo);$t.mixInto(zo);const ea=zo;class Wo{constructor(e,t,i){this.display=e,this.rootNode=t;const n=document.createElementNS(Gt,"svg");n.style.position="absolute",n.setAttribute("class",i),n.style.top="0",n.style.left="0",n.style["pointer-events"]="none",this.svg=n;function r(h,p){n.setAttribute("width",""+h),n.setAttribute("height",""+p),n.style.clip=`rect(0px,${h}px,${p}px,0px)`}e.sizeProperty.link(h=>{r(h.width,h.height)}),this.domElement=n}addShape(e,t,i){const n=document.createElementNS(Gt,"path");let r=e.getSVGPath();r||(r="M0 0"),r?n.setAttribute("d",r):n.hasAttribute("d")&&n.removeAttribute("d"),n.setAttribute("style",`fill: none; stroke: ${t}; stroke-dasharray: 5, 3; stroke-dashoffset: ${i?5:0}; stroke-width: 3;`),this.svg.appendChild(n)}update(){for(;this.svg.childNodes.length;)this.svg.removeChild(this.svg.childNodes[this.svg.childNodes.length-1]);this.addShapes()}dispose(){}}q.register("ShapeBasedOverlay",Wo);class Om extends Wo{constructor(e,t){super(e,t,"canvasNodeBoundsOverlay")}addShapes(){new ht(this.rootNode).eachTrailUnder(e=>{const t=e.lastNode();if(!t.isVisible())return!0;if(t instanceof Tr&&e.isVisible()){const i=e.getTransform();this.addShape(i.transformShape(yt.bounds(t.selfBounds)),"rgba(0,255,0,0.8)",!0)}return!1})}}q.register("CanvasNodeBoundsOverlay",Om);class Mm extends Wo{constructor(e,t){super(e,t,"canvasNodeBoundsOverlay")}addShapes(){const e=this;function t(r,h){r.willApplyTransform&&(h=h.timesMatrix(r.backboneInstance.relativeTransform.matrix)),r.blocks.forEach(p=>{i(p,h)})}function i(r,h){if(r instanceof fn&&!r.fitBounds.isEmpty()&&e.addShape(yt.bounds(r.fitBounds).transformed(h),"rgba(255,0,0,0.8)",!0),r.firstDrawable&&r.lastDrawable){for(let p=r.firstDrawable;p!==r.lastDrawable;p=p.nextDrawable)n(p,h);n(r.lastDrawable,h)}}function n(r,h){r instanceof ea&&t(r,h)}t(this.display.rootBackbone,$e.IDENTITY)}}q.register("FittedBlockBoundsOverlay",Mm);let cg=fi.OUTER_FOCUS_COLOR,ug=fi.INNER_FOCUS_COLOR,dg=fi.INNER_LIGHT_GROUP_FOCUS_COLOR,pg=fi.OUTER_LIGHT_GROUP_FOCUS_COLOR;class os{constructor(e,t,i){this.trail=null,this.node=null,this.activeHighlight=null,this.mode=null,this.groupMode=null,this.groupHighlightNode=null,this.transformTracker=null,this.groupTransformTracker=null,this.nodeModeHighlight=null,this.nodeModeHighlightLayered=!1,this.transformDirty=!0,this.highlightNode=new Ge,this.readingBlockHighlightNode=new Ge,this.addedReadingBlockHighlight=null,this.activeReadingBlockNode=null,this.readingBlockTrail=null,this.readingBlockTransformDirty=!0,this.readingBlockTransformTracker=null;const n=je()({pdomFocusHighlightsVisibleProperty:new Wt(!0),interactiveHighlightsVisibleProperty:new Wt(!1),readingBlockHighlightsVisibleProperty:new Wt(!1)},i);this.display=e,this.focusRootNode=t,this.focusRootNode.addChild(this.highlightNode),this.focusRootNode.addChild(this.readingBlockHighlightNode),this.pdomFocusHighlightsVisibleProperty=n.pdomFocusHighlightsVisibleProperty,this.interactiveHighlightsVisibleProperty=n.interactiveHighlightsVisibleProperty,this.readingBlockHighlightsVisibleProperty=n.readingBlockHighlightsVisibleProperty,this.focusDisplay=new Fi(this.focusRootNode,{allowWebGL:e.isWebGLAllowed(),allowCSSHacks:!1,accessibility:!1,interactive:!1,allowLayerFitting:!0}),this.domElement=this.focusDisplay.domElement,this.domElement.style.pointerEvents="none",this.shapeFocusHighlightPath=new fi(null),this.boundsFocusHighlightPath=new ko(null,{useLocalBounds:!0}),this.highlightNode.addChild(this.shapeFocusHighlightPath),this.highlightNode.addChild(this.boundsFocusHighlightPath),this.groupFocusHighlightPath=new ko(null,{useLocalBounds:!0,useGroupDilation:!0,outerLineWidth:fi.GROUP_OUTER_LINE_WIDTH,innerLineWidth:fi.GROUP_INNER_LINE_WIDTH,innerStroke:fi.OUTER_FOCUS_COLOR}),this.groupFocusHighlightParent=new Ge({children:[this.groupFocusHighlightPath]}),this.focusRootNode.addChild(this.groupFocusHighlightParent),this.readingBlockHighlightPath=new n_(null),this.readingBlockHighlightNode.addChild(this.readingBlockHighlightPath),this.boundsListener=this.onBoundsChange.bind(this),this.transformListener=this.onTransformChange.bind(this),this.domFocusListener=this.onFocusChange.bind(this),this.readingBlockTransformListener=this.onReadingBlockTransformChange.bind(this),this.focusHighlightListener=this.onFocusHighlightChange.bind(this),this.interactiveHighlightListener=this.onInteractiveHighlightChange.bind(this),this.focusHighlightsVisibleListener=this.onFocusHighlightsVisibleChange.bind(this),this.voicingHighlightsVisibleListener=this.onVoicingHighlightsVisibleChange.bind(this),this.pointerFocusListener=this.onPointerFocusChange.bind(this),this.lockedPointerFocusListener=this.onLockedPointerFocusChange.bind(this),this.readingBlockFocusListener=this.onReadingBlockFocusChange.bind(this),this.readingBlockHighlightChangeListener=this.onReadingBlockHighlightChange.bind(this),jt.pdomFocusProperty.link(this.domFocusListener),e.focusManager.pointerFocusProperty.link(this.pointerFocusListener),e.focusManager.readingBlockFocusProperty.link(this.readingBlockFocusListener),e.focusManager.lockedPointerFocusProperty.link(this.lockedPointerFocusListener),this.pdomFocusHighlightsVisibleProperty.link(this.focusHighlightsVisibleListener),this.interactiveHighlightsVisibleProperty.link(this.voicingHighlightsVisibleListener)}dispose(){this.hasHighlight()&&this.deactivateHighlight(),jt.pdomFocusProperty.unlink(this.domFocusListener),this.pdomFocusHighlightsVisibleProperty.unlink(this.focusHighlightsVisibleListener),this.interactiveHighlightsVisibleProperty.unlink(this.voicingHighlightsVisibleListener),this.display.focusManager.pointerFocusProperty.unlink(this.pointerFocusListener),this.display.focusManager.readingBlockFocusProperty.unlink(this.readingBlockFocusListener),this.focusDisplay.dispose()}hasHighlight(){return!!this.trail}hasReadingBlockHighlight(){return!!this.readingBlockTrail}activateHighlight(e,t,i,n,r){this.trail=e,this.node=t;const h=i;this.activeHighlight=h;let p=e;if(h==="invisible")this.mode="invisible";else if(h instanceof yt)this.mode="shape",this.shapeFocusHighlightPath.visible=!0,this.shapeFocusHighlightPath.setShape(h);else if(h instanceof Ge){if(this.mode="node",h instanceof fi){const S=h;assert&&assert(h.shape!==null,"The shape of the Node highlight should be set by now. Does it have bounds?"),S.transformSourceNode&&(p=h.getUniqueHighlightTrail(this.trail))}this.nodeModeHighlight=h,n?(this.nodeModeHighlightLayered=!0,this.nodeModeHighlight.visible=r.get()):(this.nodeModeHighlight.visible=!0,this.highlightNode.addChild(this.nodeModeHighlight))}else this.mode="bounds",this.boundsFocusHighlightPath.setShapeFromNode(this.node,this.trail),this.boundsFocusHighlightPath.visible=!0,this.node.localBoundsProperty.lazyLink(this.boundsListener),this.onBoundsChange();this.transformTracker=new kr(p,{isStatic:!0}),this.transformTracker.addListener(this.transformListener),this.activateGroupHighlights(),this.updateHighlightColors(),this.transformDirty=!0}activateFocusHighlight(e,t){this.activateHighlight(e,t,t.focusHighlight,t.focusHighlightLayerable,this.pdomFocusHighlightsVisibleProperty),t.focusHighlightChangedEmitter.addListener(this.focusHighlightListener)}activateInteractiveHighlight(e,t){this.activateHighlight(e,t,t.interactiveHighlight||t.focusHighlight,t.interactiveHighlightLayerable,this.interactiveHighlightsVisibleProperty),assert&&assert(t.isInteractiveHighlighting,"Node does not support any kind of interactive highlighting."),t.interactiveHighlightChangedEmitter.addListener(this.interactiveHighlightListener),t.focusHighlightChangedEmitter.addListener(this.interactiveHighlightListener)}activateReadingBlockHighlight(e){this.readingBlockTrail=e;const t=e.lastNode();assert&&assert(t.isReadingBlock,"should not activate a reading block highlight for a Node that is not a ReadingBlock"),this.activeReadingBlockNode=t;const i=this.activeReadingBlockNode.readingBlockActiveHighlight;this.addedReadingBlockHighlight=i,i==="invisible"||(i instanceof yt?(this.readingBlockHighlightPath.setShape(i),this.readingBlockHighlightPath.visible=!0):i instanceof Ge?this.readingBlockHighlightNode.addChild(i):(this.readingBlockHighlightPath.setShapeFromNode(this.activeReadingBlockNode,this.readingBlockTrail),this.readingBlockHighlightPath.visible=!0)),this.readingBlockTransformTracker=new kr(this.readingBlockTrail,{isStatic:!0}),this.readingBlockTransformTracker.addListener(this.readingBlockTransformListener),this.activeReadingBlockNode.readingBlockActiveHighlightChangedEmitter.addListener(this.readingBlockHighlightChangeListener),this.readingBlockTransformDirty=!0}deactivateReadingBlockHighlight(){this.readingBlockHighlightPath.visible=!1,this.addedReadingBlockHighlight instanceof Ge&&this.readingBlockHighlightNode.removeChild(this.addedReadingBlockHighlight),assert&&assert(this.readingBlockTransformTracker,"How can we deactivate the TransformTracker if it wasnt assigned.");const e=this.readingBlockTransformTracker;e.removeListener(this.readingBlockTransformListener),e.dispose(),this.readingBlockTransformTracker=null,assert&&assert(this.activeReadingBlockNode,"How can we deactivate the activeReadingBlockNode if it wasnt assigned."),this.activeReadingBlockNode.readingBlockActiveHighlightChangedEmitter.removeListener(this.readingBlockHighlightChangeListener),this.activeReadingBlockNode=null,this.readingBlockTrail=null,this.addedReadingBlockHighlight=null}deactivateHighlight(){assert&&assert(this.node,"Need an active Node to deactivate highlights");const e=this.node;if(this.mode==="shape")this.shapeFocusHighlightPath.visible=!1;else if(this.mode==="node"){assert&&assert(this.nodeModeHighlight,"How can we deactivate if nodeModeHighlight is not assigned");const i=this.nodeModeHighlight;this.nodeModeHighlightLayered?this.nodeModeHighlightLayered=!1:this.highlightNode.removeChild(i),i.visible=!1,this.nodeModeHighlight=null}else this.mode==="bounds"&&(this.boundsFocusHighlightPath.visible=!1,e.localBoundsProperty.unlink(this.boundsListener));e.focusHighlightChangedEmitter.hasListener(this.focusHighlightListener)&&e.focusHighlightChangedEmitter.removeListener(this.focusHighlightListener);const t=e;t.isInteractiveHighlighting&&(t.interactiveHighlightChangedEmitter.hasListener(this.interactiveHighlightListener)&&t.interactiveHighlightChangedEmitter.removeListener(this.interactiveHighlightListener),t.focusHighlightChangedEmitter.hasListener(this.interactiveHighlightListener)&&t.focusHighlightChangedEmitter.removeListener(this.interactiveHighlightListener)),this.deactivateGroupHighlights(),this.trail=null,this.node=null,this.mode=null,this.activeHighlight=null,this.transformTracker.removeListener(this.transformListener),this.transformTracker.dispose(),this.transformTracker=null}activateGroupHighlights(){assert&&assert(this.trail,"must have an active trail to activate group highlights");const e=this.trail;for(let t=0;t<e.length;t++){const i=e.nodes[t],n=i.groupFocusHighlight;if(n){const r=e.upToNode(i);this.groupTransformTracker=new kr(r),this.groupTransformTracker.addListener(this.transformListener),typeof n=="boolean"?(this.groupFocusHighlightPath.setShapeFromNode(i,r),this.groupFocusHighlightPath.visible=!0,this.groupHighlightNode=this.groupFocusHighlightPath,this.groupMode="bounds"):n instanceof Ge&&(this.groupHighlightNode=n,this.groupFocusHighlightParent.addChild(n),this.groupMode="node");break}}}updateHighlightColors(){this.mode==="shape"?(this.shapeFocusHighlightPath.innerHighlightColor!==os.getInnerHighlightColor()&&this.shapeFocusHighlightPath.setInnerHighlightColor(os.getInnerHighlightColor()),this.shapeFocusHighlightPath.outerHighlightColor!==os.getOuterHighlightColor()&&this.shapeFocusHighlightPath.setOuterHighlightColor(os.getOuterHighlightColor())):this.mode==="bounds"&&(this.boundsFocusHighlightPath.innerHighlightColor!==os.getInnerHighlightColor()&&this.boundsFocusHighlightPath.setInnerHighlightColor(os.getInnerHighlightColor()),this.boundsFocusHighlightPath.outerHighlightColor!==os.getOuterHighlightColor()&&this.boundsFocusHighlightPath.setOuterHighlightColor(os.getOuterHighlightColor())),this.groupMode&&(this.groupFocusHighlightPath.innerHighlightColor!==os.getInnerGroupHighlightColor()&&this.groupFocusHighlightPath.setInnerHighlightColor(os.getInnerGroupHighlightColor()),this.groupFocusHighlightPath.outerHighlightColor!==os.getOuterGroupHighlightColor()&&this.groupFocusHighlightPath.setOuterHighlightColor(os.getOuterGroupHighlightColor()))}deactivateGroupHighlights(){this.groupMode&&(this.groupMode==="bounds"?this.groupFocusHighlightPath.visible=!1:this.groupMode==="node"&&(assert&&assert(this.groupHighlightNode,"Need a groupHighlightNode to deactivate this mode"),this.groupFocusHighlightParent.removeChild(this.groupHighlightNode)),this.groupMode=null,this.groupHighlightNode=null,assert&&assert(this.groupTransformTracker,"Need a groupTransformTracker to dispose"),this.groupTransformTracker.removeListener(this.transformListener),this.groupTransformTracker.dispose(),this.groupTransformTracker=null)}afterTransform(){assert&&assert(this.transformTracker,"Must have an active transformTracker to adjust from transformation.");const e=this.transformTracker.getMatrix().timesMatrix(fi.getCorrectiveScalingMatrix());this.mode==="shape"?this.shapeFocusHighlightPath.updateLineWidth(e):this.mode==="bounds"?this.boundsFocusHighlightPath.updateLineWidth(e):this.mode==="node"&&this.activeHighlight instanceof fi&&this.activeHighlight.updateLineWidth&&this.activeHighlight.updateLineWidth(e),this.groupHighlightNode&&(this.groupMode==="bounds"?this.groupFocusHighlightPath.updateLineWidth(e):this.groupMode==="node"&&this.groupHighlightNode instanceof fi&&this.groupHighlightNode.updateLineWidth&&this.groupHighlightNode.updateLineWidth(e)),this.readingBlockTrail&&this.readingBlockHighlightPath.updateLineWidth(e)}onTransformChange(){this.transformDirty=!0}onReadingBlockTransformChange(){this.readingBlockTransformDirty=!0}onBoundsChange(){assert&&assert(this.node,"Must have an active node when bounds are changing"),assert&&assert(this.trail,"Must have an active trail when updating default bounds highlight"),this.boundsFocusHighlightPath.setShapeFromNode(this.node,this.trail)}onFocusChange(e){const t=e&&e.display===this.display?e.trail:null;if(this.hasHighlight()&&this.deactivateHighlight(),t&&this.pdomFocusHighlightsVisibleProperty.value){const i=t.lastNode();this.activateFocusHighlight(t,i)}else this.display.focusManager.pointerFocusProperty.value&&this.interactiveHighlightsVisibleProperty.value&&this.updateInteractiveHighlight(this.display.focusManager.pointerFocusProperty.value)}onPointerFocusChange(e){!this.display.focusManager.lockedPointerFocusProperty.value&&!this.display.focusManager.pdomFocusHighlightsVisibleProperty.value&&this.updateInteractiveHighlight(e)}updateInteractiveHighlight(e){const t=e&&e.display===this.display?e.trail:null;this.hasHighlight()&&this.deactivateHighlight();let i=!1;if(t&&!this.display.focusManager.pdomFocusHighlightsVisibleProperty.value){const n=t.lastNode();(n.isReadingBlock&&this.readingBlockHighlightsVisibleProperty.value||!n.isReadingBlock&&this.interactiveHighlightsVisibleProperty.value)&&(this.activateInteractiveHighlight(t,n),i=!0)}!i&&jt.pdomFocus&&this.pdomFocusHighlightsVisibleProperty.value&&this.onFocusChange(jt.pdomFocus)}onLockedPointerFocusChange(e){this.updateInteractiveHighlight(e||this.display.focusManager.pointerFocusProperty.value)}onReadingBlockFocusChange(e){this.hasReadingBlockHighlight()&&this.deactivateReadingBlockHighlight();const t=e&&e.display===this.display?e.trail:null;t&&this.activateReadingBlockHighlight(t)}onFocusHighlightChange(){assert&&assert(this.node&&this.node.focused,"update should only be necessary if node already has focus"),this.onFocusChange(jt.pdomFocus)}onInteractiveHighlightChange(){if(assert){const e=this.node,t=this.display.focusManager.lockedPointerFocusProperty.value;assert(e||t&&t.trail.lastNode()===this.node,"Update should only be necessary if Node is activated with a Pointer or pointer focus is locked during interaction")}this.updateInteractiveHighlight(this.display.focusManager.lockedPointerFocusProperty.value||this.display.focusManager.pointerFocusProperty.value)}onReadingBlockHighlightChange(){assert&&assert(this.activeReadingBlockNode,"Update should only be necessary when there is an active ReadingBlock Node"),assert&&assert(this.activeReadingBlockNode.readingBlockActivated,"Update should only be necessary while the ReadingBlock is activated"),this.onReadingBlockFocusChange(this.display.focusManager.readingBlockFocusProperty.value)}onFocusHighlightsVisibleChange(){this.onFocusChange(jt.pdomFocus)}onVoicingHighlightsVisibleChange(){this.onPointerFocusChange(this.display.focusManager.pointerFocusProperty.value)}update(){this.hasHighlight()&&this.transformDirty&&(this.transformDirty=!1,assert&&assert(this.transformTracker,"The transformTracker must be available on update if transform is dirty"),this.highlightNode.setMatrix(this.transformTracker.matrix),this.groupHighlightNode&&(assert&&assert(this.groupTransformTracker,"The groupTransformTracker must be available on update if transform is dirty"),this.groupHighlightNode.setMatrix(this.groupTransformTracker.matrix)),this.afterTransform()),this.hasReadingBlockHighlight()&&this.readingBlockTransformDirty&&(this.readingBlockTransformDirty=!1,assert&&assert(this.readingBlockTransformTracker,"The groupTransformTracker must be available on update if transform is dirty"),this.readingBlockHighlightNode.setMatrix(this.readingBlockTransformTracker.matrix)),this.display.size.equals(this.focusDisplay.size)||this.focusDisplay.setWidthHeight(this.display.width,this.display.height),this.focusDisplay.updateDisplay()}static setInnerHighlightColor(e){ug=e}static getInnerHighlightColor(){return ug}static setOuterHilightColor(e){cg=e}static getOuterHighlightColor(){return cg}static setInnerGroupHighlightColor(e){dg=e}static getInnerGroupHighlightColor(){return dg}static setOuterGroupHighlightColor(e){pg=e}static getOuterGroupHighlightColor(){return pg}}q.register("HighlightOverlay",os);class Ir extends Wo{constructor(e,t){super(e,t,"hitAreaOverlay")}addShapes(){new ht(this.rootNode).eachTrailUnder(e=>{const t=e.lastNode();if(!t.isVisible()||t.pickable===!1)return!0;if(t.inputListeners.length&&e.isVisible()){const i=Ir.getLocalMouseShape(t),n=Ir.getLocalTouchShape(t),r=e.getMatrix();i.bounds.isEmpty()||this.addShape(i.transformed(r),"rgba(0,0,255,0.8)",!0),n.bounds.isEmpty()||this.addShape(n.transformed(r),"rgba(255,0,0,0.8)",!1)}return!1})}static getLocalMouseShape(e){let t=yt.union([e.mouseArea?e.mouseArea instanceof yt?e.mouseArea:yt.bounds(e.mouseArea):e.getSelfShape(),...e.children.filter(i=>e.visible&&e.pickable!==!1).map(i=>Ir.getLocalMouseShape(i).transformed(i.matrix))]);return e.hasClipArea()&&(t=t.shapeIntersection(e.clipArea)),t}static getLocalTouchShape(e){let t=yt.union([e.touchArea?e.touchArea instanceof yt?e.touchArea:yt.bounds(e.touchArea):e.getSelfShape(),...e.children.filter(i=>e.visible&&e.pickable!==!1).map(i=>Ir.getLocalTouchShape(i).transformed(i.matrix))]);return e.hasClipArea()&&(t=t.shapeIntersection(e.clipArea)),t}}q.register("HitAreaOverlay",Ir);class Nm extends Wo{constructor(e,t){super(e,t,"mouseTouchAreaOverlay")}addShapes(){new ht(this.rootNode).eachTrailUnder(e=>{const t=e.lastNode();if(!t.isVisible())return!0;if((t.mouseArea||t.touchArea)&&e.isVisible()){const i=e.getTransform();t.mouseArea&&this.addShape(i.transformShape(t.mouseArea instanceof Be?yt.bounds(t.mouseArea):t.mouseArea),"rgba(0,0,255,0.8)",!0),t.touchArea&&this.addShape(i.transformShape(t.touchArea instanceof Be?yt.bounds(t.touchArea):t.touchArea),"rgba(255,0,0,0.8)",!1)}return!1})}}q.register("PointerAreaOverlay",Nm);class Rm{constructor(e,t){this.display=e,this.rootNode=t,this.pointerSVGContainer=document.createElement("div"),this.pointerSVGContainer.style.position="absolute",this.pointerSVGContainer.style.top="0",this.pointerSVGContainer.style.left="0",this.pointerSVGContainer.style["pointer-events"]="none";const i=10,n=1,r=(i+n/2)*2,h=r/2;e.sizeProperty.lazyLink(S=>{this.pointerSVGContainer.setAttribute("width",""+S.width),this.pointerSVGContainer.setAttribute("height",""+S.height),this.pointerSVGContainer.style.clip=`rect(0px,${S.width}px,${S.height}px,0px)`});const p=$e.IDENTITY.copy();this.pointerAdded=S=>{const C=document.createElementNS(Gt,"svg");C.style.position="absolute",C.style.top="0",C.style.left="0",C.style["pointer-events"]="none",Dt.prepareForTransform(C),C.setAttribute("width",""+r),C.setAttribute("height",""+r);const B=document.createElementNS(Gt,"circle");B.setAttribute("cx",""+(i+n/2)),B.setAttribute("cy",""+(i+n/2)),B.setAttribute("r",""+i),B.setAttribute("style","fill:black;"),B.setAttribute("style","stroke:white;"),B.setAttribute("opacity","0.4");const U=X=>Dt.applyPreparedTransform(p.setToTranslation(X.x-h,X.y-h),C),k=()=>{S.isTouchLike()&&(this.pointerSVGContainer.removeChild(C),S.removeInputListener(Q))},Q={move:()=>{S.point&&U(S.point)},up:k,cancel:k,focus:()=>{S instanceof ya&&S.point&&(U(S.point),this.pointerSVGContainer.appendChild(C))},blur:()=>{this.pointerSVGContainer.contains(C)&&this.pointerSVGContainer.removeChild(C)}};S.addInputListener(Q),Q.move(),C.appendChild(B),this.pointerSVGContainer.appendChild(C)},e._input.pointerAddedEmitter.addListener(this.pointerAdded),e._input&&e._input.mouse&&this.pointerAdded(e._input.mouse),this.domElement=this.pointerSVGContainer}dispose(){this.display._input.pointerAddedEmitter.removeListener(this.pointerAdded)}update(){}}q.register("PointerOverlay",Rm);let qL=1;const XL=ne.createOrderBitmask(ne.bitmaskSVG,ne.bitmaskCanvas,ne.bitmaskDOM,ne.bitmaskWebGL);class un{constructor(e,t,i,n){Cd(this,"display",null);this.active=!1,this.initialize(e,t,i,n)}initialize(e,t,i,n){return assert&&assert(!this.active,"We should never try to initialize an already active object"),t.setImmutable(),this.id=this.id||qL++,this.isWebGLSupported=e.isWebGLAllowed()&&Dt.isWebGLSupported,this.relativeTransform=this.relativeTransform||new Dm(this),this.fittability=this.fittability||new Im(this),this.visible=!0,this.relativeVisible=!0,this.selfVisible=!0,this.visibilityDirty=!0,this.childVisibilityDirty=!0,this.voicingVisible=!0,this.branchIndexMap=this.branchIndexMap||{},this.branchIndexReferences=Bt(this.branchIndexReferences),this.addRemoveCounter=0,this.stitchChangeFrame=e._frameId,this.stitchChangeBefore=0,this.stitchChangeAfter=0,this.stitchChangeOnChildren=0,this.stitchChangeIncluded=!1,this.childInsertedListener=this.childInsertedListener||this.onChildInserted.bind(this),this.childRemovedListener=this.childRemovedListener||this.onChildRemoved.bind(this),this.childrenReorderedListener=this.childrenReorderedListener||this.onChildrenReordered.bind(this),this.visibilityListener=this.visibilityListener||this.onVisibilityChange.bind(this),this.markRenderStateDirtyListener=this.markRenderStateDirtyListener||this.markRenderStateDirty.bind(this),this.visibleEmitter=new zt,this.relativeVisibleEmitter=new zt,this.selfVisibleEmitter=new zt,this.canVoiceEmitter=new zt,this.cleanInstance(e,t),this.node.addInstance(this),this.externalReferenceCount=0,this.stateless=!0,this.isDisplayRoot=i,this.isSharedCanvasCacheRoot=n,this.preferredRenderers=0,this.isUnderCanvasCache=n,this.isBackbone=!1,this.isTransformed=!1,this.isVisibilityApplied=!1,this.isInstanceCanvasCache=!1,this.isSharedCanvasCachePlaceholder=!1,this.isSharedCanvasCacheSelf=n,this.selfRenderer=0,this.groupRenderer=0,this.sharedCacheRenderer=0,this.renderStateDirtyFrame=e._frameId,this.skipPruningFrame=e._frameId,sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`initialized ${this.toString()}`),this.active=!0,this}cleanInstance(e,t){this.display=e,this.trail=t,this.node=t?t.lastNode():null,this.parent=null,this.oldParent=null,this.children=Bt(this.children),this.sharedCacheInstance=null,this.relativeTransform.initialize(e,t),this.fittability.initialize(e,t),this.instanceRemovalCheckList=Bt(this.instanceRemovalCheckList),this.selfDrawable=null,this.groupDrawable=null,this.sharedCacheDrawable=null,this.firstDrawable=null,this.lastDrawable=null,this.firstInnerDrawable=null,this.lastInnerDrawable=null,this.svgGroups=Bt(this.svgGroups),this.cleanSyncTreeResults()}cleanSyncTreeResults(){this.beforeStableIndex=this.children.length,this.afterStableIndex=-1,this.firstChangeInterval=null,this.lastChangeInterval=null,this.incompatibleStateChange=!1,this.groupChanged=!1,this.cascadingStateChange=!1,this.anyStateChange=!1}updateRenderingState(){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`updateRenderingState ${this.toString()}${this.stateless?" (stateless)":""}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`old: ${this.getStateString()}`);const e=this.isBackbone,t=this.isTransformed,i=this.isVisibilityApplied,n=this.isInstanceCanvasCache,r=this.isSharedCanvasCacheSelf,h=this.isSharedCanvasCachePlaceholder,p=this.isUnderCanvasCache,S=this.selfRenderer,C=this.groupRenderer,B=this.sharedCacheRenderer,U=this.preferredRenderers;this.isBackbone=!1,this.isTransformed=!1,this.isVisibilityApplied=!1,this.isInstanceCanvasCache=!1,this.isSharedCanvasCacheSelf=!1,this.isSharedCanvasCachePlaceholder=!1,this.selfRenderer=0,this.groupRenderer=0,this.sharedCacheRenderer=0;const k=this.node;this.isUnderCanvasCache=this.isSharedCanvasCacheRoot||(this.parent?this.parent.isUnderCanvasCache||this.parent.isInstanceCanvasCache||this.parent.isSharedCanvasCacheSelf:!1),this.preferredRenderers=this.parent?this.parent.preferredRenderers:XL,k._renderer&&(this.preferredRenderers=ne.pushOrderBitmask(this.preferredRenderers,k._renderer));const Q=this.node.hasClipArea(),X=this.node.effectiveOpacity!==1||k._usesOpacity||this.node._filters.length>0;let g=!1,Z=!1;if(X)for(let se=0;se<this.node._filters.length;se++){const fe=this.node._filters[se];fe.isSVGCompatible()||(g=!0),fe.isCanvasCompatible()||(Z=!0)}const ce=k._cssTransform||k._layerSplit,ye=this.isDisplayRoot||!this.isUnderCanvasCache&&ce,Oe=!ye&&(X||Q)&&(!g&&this.node._rendererSummary.isSubtreeRenderedExclusivelySVG(this.preferredRenderers)||!Z&&this.node._rendererSummary.isSubtreeRenderedExclusivelyCanvas(this.preferredRenderers));if((Oe?!1:ye||X||Q)?(this.isBackbone=!0,this.isVisibilityApplied=!0,this.isTransformed=this.isDisplayRoot||!!k._cssTransform,this.groupRenderer=ne.bitmaskDOM):!Oe&&(X||Q||k._canvasCache)&&(assert&&assert(this.node._rendererSummary.isSingleCanvasSupported(),`Node canvasCache provided, but not all node contents can be rendered with Canvas under ${this.node.constructor.name}`),k._singleCache?this.isSharedCanvasCacheRoot?(this.isSharedCanvasCacheSelf=!0,this.sharedCacheRenderer=this.isWebGLSupported?ne.bitmaskWebGL:ne.bitmaskCanvas):(assert&&assert(this.node._rendererSummary.areBoundsValid(),`Node singleCache provided, but not all node contents have valid bounds under ${this.node.constructor.name}`),this.isSharedCanvasCachePlaceholder=!0):(this.isInstanceCanvasCache=!0,this.isUnderCanvasCache=!0,this.groupRenderer=this.isWebGLSupported?ne.bitmaskWebGL:ne.bitmaskCanvas)),this.node.isPainted())if(this.isUnderCanvasCache)this.selfRenderer=ne.bitmaskCanvas;else{let se=this.node._rendererBitmask;if(!this.isWebGLSupported){const fe=ne.bitmaskWebGL;se=se^se&fe}this.selfRenderer=se&ne.bitmaskOrder(this.preferredRenderers,0)||se&ne.bitmaskOrder(this.preferredRenderers,1)||se&ne.bitmaskOrder(this.preferredRenderers,2)||se&ne.bitmaskOrder(this.preferredRenderers,3)||se&ne.bitmaskSVG||se&ne.bitmaskCanvas||se&ne.bitmaskDOM||se&ne.bitmaskWebGL||0,assert&&assert(this.selfRenderer,"setSelfRenderer failure?")}this.groupChanged=e!==this.isBackbone||n!==this.isInstanceCanvasCache||r!==this.isSharedCanvasCacheSelf,this.cascadingStateChange=p!==this.isUnderCanvasCache||U!==this.preferredRenderers,this.incompatibleStateChange=this.isTransformed!==t||this.isSharedCanvasCachePlaceholder!==h,this.anyStateChange=this.groupChanged||this.cascadingStateChange||this.incompatibleStateChange||S!==this.selfRenderer||C!==this.groupRenderer||B!==this.sharedCacheRenderer,i!==this.isVisibilityApplied&&(this.visibilityDirty=!0,this.parent&&this.parent.markChildVisibilityDirty()),this.fittability.checkSelfFittability(),sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`new: ${this.getStateString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}getStateString(){return`${`S[ ${this.isDisplayRoot?"displayRoot ":""}${this.isBackbone?"backbone ":""}${this.isInstanceCanvasCache?"instanceCache ":""}${this.isSharedCanvasCachePlaceholder?"sharedCachePlaceholder ":""}${this.isSharedCanvasCacheSelf?"sharedCacheSelf ":""}${this.isTransformed?"TR ":""}${this.isVisibilityApplied?"VIS ":""}${this.selfRenderer?this.selfRenderer.toString(16):"-"},${this.groupRenderer?this.groupRenderer.toString(16):"-"},${this.sharedCacheRenderer?this.sharedCacheRenderer.toString(16):"-"} `}]`}baseSyncTree(){assert&&assert(this.isDisplayRoot,"baseSyncTree() should only be called on the root instance"),sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`-------- START baseSyncTree ${this.toString()} --------`),this.syncTree(),sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`-------- END baseSyncTree ${this.toString()} --------`),this.cleanSyncTreeResults()}syncTree(){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`syncTree ${this.toString()} ${this.getStateString()}${this.stateless?" (stateless)":""}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),sceneryLog&&q.isLoggingPerformance()&&this.display.perfSyncTreeCount++,assert&&assert(!this.parent||!this.parent.stateless,"We should not have a stateless parent instance");const e=this.stateless;if(e||this.parent&&this.parent.cascadingStateChange||this.renderStateDirtyFrame===this.display._frameId?this.updateRenderingState():assertSlow&&(this.updateRenderingState(),assertSlow(!this.anyStateChange)),!e&&this.incompatibleStateChange)return sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`incompatible instance ${this.toString()} ${this.getStateString()}, aborting`),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop(),!1;if(this.stateless=!1,assert&&assert(!e||this.children.length===0,"We should not have child instances on an instance without state"),e&&(this.isTransformed&&this.display.markTransformRootDirty(this,!0),this.attachNodeListeners()),this.isSharedCanvasCachePlaceholder)this.sharedSyncTree();else if(e||this.skipPruningFrame===this.display._frameId||this.anyStateChange){this.prepareChildInstances(e);const t=this.firstDrawable,i=this.lastDrawable,n=this.firstInnerDrawable,r=this.lastInnerDrawable,h=this.updateSelfDrawable();this.localSyncTree(h),assertSlow&&this.auditChangeIntervals(n,r,this.firstInnerDrawable,this.lastInnerDrawable),this.groupSyncTree(e),assertSlow&&this.auditChangeIntervals(t,i,this.firstDrawable,this.lastDrawable)}else sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance("pruned");return sceneryLog&&sceneryLog.Instance&&sceneryLog.pop(),!0}localSyncTree(e){const t=this.display._frameId;let i=this.selfDrawable,n=i;assert&&assert(this.firstChangeInterval===null&&this.lastChangeInterval===null,"sanity checks that cleanSyncTreeResults were called");let r=null;e&&(sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval("self"),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.push(),r=Cs.newForDisplay(null,null,this.display),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.pop());let h=r,p=e?null:this.selfDrawable;for(let S=0;S<this.children.length;S++){let C=this.children[S];C.syncTree()||(C=this.updateIncompatibleChildInstance(C,S),C.syncTree());const U=C.shouldIncludeInParentDrawables();U&&C.firstDrawable&&(n?Ii.connectDrawables(n,C.firstDrawable,this.display):i=C.firstDrawable,n=C.lastDrawable),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval(`changes for ${C.toString()} in ${this.toString()}`),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.push();const k=C.stitchChangeIncluded,Q=U;C.stitchChangeIncluded=Q,sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval(`included: ${k} => ${Q}`),C.stitchChangeFrame===t?(sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval("stitchChangeFrame full change interval"),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.push(),C.firstChangeInterval=C.lastChangeInterval=Cs.newForDisplay(null,null,this.display),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.pop()):assert&&assert(k===Q,"If we do not have stitchChangeFrame activated, our inclusion should not have changed");const X=C.firstChangeInterval;let g=h&&h.drawableAfter===null;const Z=X&&X.drawableBefore===null;if(C.stitchChangeBefore===t&&!g&&!Z){sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.ChangeInterval("bridge"),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.push();const ye=Cs.newForDisplay(p,null,this.display);h&&(h.nextChangeInterval=ye),h=ye,r=r||h,g=!0,sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.pop()}if((k||Q)&&(g?X?X.drawableBefore===null?(h.drawableAfter=X.drawableAfter,h.nextChangeInterval=X.nextChangeInterval,h=C.lastChangeInterval===X?h:C.lastChangeInterval):(h.drawableAfter=C.firstDrawable,h.nextChangeInterval=X,h=C.lastChangeInterval):h.drawableAfter=C.firstDrawable:X&&(r=r||X,X.drawableBefore===null&&(assert&&assert(!h||p,"If we have a current change interval, we should be guaranteed a non-null lastUnchangedDrawable"),X.drawableBefore=p),h&&(h.nextChangeInterval=X),h=C.lastChangeInterval),p=h&&h.drawableAfter===null?null:C.lastDrawable?C.lastDrawable:p),S===this.children.length-1&&C.stitchChangeAfter===t&&!(h&&h.drawableAfter===null)){const ye=Cs.newForDisplay(p,null,this.display);h&&(h.nextChangeInterval=ye),h=ye,r=r||h}C.cleanSyncTreeResults(),sceneryLog&&sceneryLog.ChangeInterval&&sceneryLog.pop()}if(assert&&assert(!!r==!!h,"Presence of first and current change intervals should be equal"),!r&&this.stitchChangeOnChildren===this.display._frameId&&this.children.length===0&&(r=h=Cs.newForDisplay(null,null,this.display)),this.firstChangeInterval=r,this.lastChangeInterval=h,this.firstDrawable=this.firstInnerDrawable=i,this.lastDrawable=this.lastInnerDrawable=n,assertSlow){let S=null;for(let B=0;B<this.children.length;B++)if(this.children[B].shouldIncludeInParentDrawables()&&this.children[B].firstDrawable){S=this.children[B].firstDrawable;break}this.selfDrawable&&(S=this.selfDrawable);let C=this.selfDrawable;for(let B=this.children.length-1;B>=0;B--)if(this.children[B].shouldIncludeInParentDrawables()&&this.children[B].lastDrawable){C=this.children[B].lastDrawable;break}assertSlow(S===this.firstDrawable),assertSlow(C===this.lastDrawable)}}updateSelfDrawable(){if(this.node.isPainted()){const e=this.selfRenderer;if(!this.selfDrawable||!(this.selfDrawable.renderer&e&ne.bitmaskRendererArea))return this.selfDrawable&&(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`replacing old drawable ${this.selfDrawable.toString()} with new renderer`),this.selfDrawable.markForDisposal(this.display)),this.selfDrawable=ne.createSelfDrawable(this,this.node,e,this.fittability.ancestorsFittable),assert&&assert(this.selfDrawable),!0}else assert&&assert(this.selfDrawable===null,"Non-painted nodes should not have a selfDrawable");return!1}updateIncompatibleChildInstance(e,t){if(sceneryLog&&q.isLoggingPerformance()){const n=e.getDescendantCount()+1;n>100?sceneryLog.PerfCritical&&sceneryLog.PerfCritical(`incompatible instance rebuild at ${this.trail.toPathString()}: ${n}`):n>40?sceneryLog.PerfMajor&&sceneryLog.PerfMajor(`incompatible instance rebuild at ${this.trail.toPathString()}: ${n}`):n>0&&sceneryLog.PerfMinor&&sceneryLog.PerfMinor(`incompatible instance rebuild at ${this.trail.toPathString()}: ${n}`)}this.display.markInstanceRootForDisposal(e);const i=un.createFromPool(this.display,this.trail.copy().addDescendant(e.node,t),!1,!1);return this.replaceInstanceWithIndex(e,i,t),i}groupSyncTree(e){const t=this.groupRenderer;assert&&assert((this.isBackbone?1:0)+(this.isInstanceCanvasCache?1:0)+(this.isSharedCanvasCacheSelf?1:0)==(t?1:0),"We should have precisely one of these flags set for us to have a groupRenderer");const i=!!t!=!!this.groupDrawable||!e&&this.groupChanged||this.groupDrawable&&this.groupDrawable.renderer!==t;i&&(this.groupDrawable&&(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`replacing group drawable ${this.groupDrawable.toString()}`),this.groupDrawable.markForDisposal(this.display),this.groupDrawable=null),this.firstChangeInterval=this.lastChangeInterval=Cs.newForDisplay(null,null,this.display)),t&&(this.firstDrawable&&Ii.disconnectBefore(this.firstDrawable,this.display),this.lastDrawable&&Ii.disconnectAfter(this.lastDrawable,this.display),this.isBackbone?(i&&(this.groupDrawable=ea.createFromPool(this.display,this,this.getTransformRootInstance(),t,this.isDisplayRoot),this.isTransformed&&this.display.markTransformRootDirty(this,!0)),this.firstChangeInterval&&this.groupDrawable.stitch(this.firstDrawable,this.lastDrawable,this.firstChangeInterval,this.lastChangeInterval)):this.isInstanceCanvasCache?(i&&(this.groupDrawable=Cm.createFromPool(t,this)),this.firstChangeInterval&&this.groupDrawable.stitch(this.firstDrawable,this.lastDrawable,this.firstChangeInterval,this.lastChangeInterval)):this.isSharedCanvasCacheSelf&&i&&(this.groupDrawable=id.createFromPool(t,this)),this.groupDrawable.setFittable(this.fittability.ancestorsFittable),this.firstDrawable=this.lastDrawable=this.groupDrawable),i?this.firstChangeInterval=this.lastChangeInterval=Cs.newForDisplay(null,null,this.display):t&&(this.firstChangeInterval=this.lastChangeInterval=null)}sharedSyncTree(){this.ensureSharedCacheInitialized();const e=this.sharedCacheRenderer;(!this.sharedCacheDrawable||this.sharedCacheDrawable.renderer!==e)&&(this.sharedCacheDrawable&&(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`replacing shared cache drawable ${this.sharedCacheDrawable.toString()}`),this.sharedCacheDrawable.markForDisposal(this.display)),this.sharedCacheDrawable=new Tm(this.trail,e,this,this.sharedCacheInstance),this.firstDrawable=this.sharedCacheDrawable,this.lastDrawable=this.sharedCacheDrawable,this.firstChangeInterval=this.lastChangeInterval=Cs.newForDisplay(null,null,this.display))}prepareChildInstances(e){for(;this.instanceRemovalCheckList.length;){const t=this.instanceRemovalCheckList.pop();t.addRemoveCounter===-1&&(t.addRemoveCounter=0,this.display.markInstanceRootForDisposal(t))}if(e)for(let t=0;t<this.node.children.length;t++){const i=this.node.children[t];this.appendInstance(un.createFromPool(this.display,this.trail.copy().addDescendant(i,t),!1,!1))}}ensureSharedCacheInitialized(){if(!this.sharedCacheInstance){const e=this.node.getId();this.sharedCacheInstance=this.display._sharedCanvasInstances[e],this.sharedCacheInstance||(this.sharedCacheInstance=un.createFromPool(this.display,new ht(this.node),!1,!0),this.sharedCacheInstance.syncTree(),this.display._sharedCanvasInstances[e]=this.sharedCacheInstance,this.display.markTransformRootDirty(this.sharedCacheInstance,!0)),this.sharedCacheInstance.externalReferenceCount++,this.isTransformed&&this.display.markTransformRootDirty(this,!0)}}shouldIncludeInParentDrawables(){return this.node.isVisible()||!this.node.isExcludeInvisible()}findPreviousDrawable(e){for(let t=e-1;t>=0;t--){const i=this.children[t].lastDrawable;if(i!==null)return i}return null}findNextDrawable(e){const t=this.children.length;for(let i=e+1;i<t;i++){const n=this.children[i].firstDrawable;if(n!==null)return n}return null}appendInstance(e){this.insertInstance(e,this.children.length)}insertInstance(e,t){assert&&assert(e instanceof un),assert&&assert(t>=0&&t<=this.children.length,`Instance insertion bounds check for index ${t} with previous children length ${this.children.length}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.InstanceTree(`inserting ${e.toString()} into ${this.toString()}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.push(),e.stitchChangeFrame=this.display._frameId,this.stitchChangeOnChildren=this.display._frameId,this.children.splice(t,0,e),e.parent=this,e.oldParent=this,t<=this.beforeStableIndex&&(this.beforeStableIndex=t-1),t>this.afterStableIndex?this.afterStableIndex=t+1:this.afterStableIndex++,this.fittability.onInsert(e.fittability),this.relativeTransform.addInstance(e),this.markChildVisibilityDirty(),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.pop()}removeInstance(e){this.removeInstanceWithIndex(e,_.indexOf(this.children,e))}removeInstanceWithIndex(e,t){assert&&assert(e instanceof un),assert&&assert(t>=0&&t<this.children.length,`Instance removal bounds check for index ${t} with previous children length ${this.children.length}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.InstanceTree(`removing ${e.toString()} from ${this.toString()}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.push();const i=this.display._frameId;e.stitchChangeFrame=i,this.stitchChangeOnChildren=i,t-1>=0&&(this.children[t-1].stitchChangeAfter=i),t+1<this.children.length&&(this.children[t+1].stitchChangeBefore=i),this.children.splice(t,1),e.parent=null,e.oldParent=this,t<=this.beforeStableIndex&&(this.beforeStableIndex=t-1),t>=this.afterStableIndex?this.afterStableIndex=t:this.afterStableIndex--,this.fittability.onRemove(e.fittability),this.relativeTransform.removeInstance(e),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.pop()}replaceInstanceWithIndex(e,t,i){this.removeInstanceWithIndex(e,i),this.insertInstance(t,i)}reorderInstances(e,t){assert&&assert(typeof e=="number"),assert&&assert(typeof t=="number"),assert&&assert(e<=t),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.InstanceTree(`Reordering ${this.toString()}`),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.push();const i=this.display._frameId;this.children.splice(e,t-e+1);for(let n=e;n<=t;n++){const r=this.findChildInstanceOnNode(this.node._children[n]);this.children.splice(n,0,r),r.stitchChangeFrame=i,n>e&&(r.stitchChangeAfter=i),n<t&&(r.stitchChangeBefore=i)}this.stitchChangeOnChildren=i,this.beforeStableIndex=Math.min(this.beforeStableIndex,e-1),this.afterStableIndex=Math.max(this.afterStableIndex,t+1),sceneryLog&&sceneryLog.InstanceTree&&sceneryLog.pop()}findChildInstanceOnNode(e){const t=e.getInstances();for(let i=0;i<t.length;i++)if(t[i].oldParent===this)return t[i];return null}onChildInserted(e,t){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`inserting child node ${e.constructor.name}#${e.id} into ${this.toString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),assert&&assert(!this.stateless,"If we are stateless, we should not receive these notifications");let i=this.findChildInstanceOnNode(e);i?(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance("instance already exists"),i.addRemoveCounter+=1,assert&&assert(i.addRemoveCounter===0)):(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance("creating stub instance"),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),i=un.createFromPool(this.display,this.trail.copy().addDescendant(e,t),!1,!1),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()),this.insertInstance(i,t),this.markSkipPruning(),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}onChildRemoved(e,t){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`removing child node ${e.constructor.name}#${e.id} from ${this.toString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),assert&&assert(!this.stateless,"If we are stateless, we should not receive these notifications"),assert&&assert(this.children[t].node===e,"Ensure that our instance matches up");const i=this.findChildInstanceOnNode(e);assert&&assert(i!==null,"We should always have a reference to a removed instance"),i.addRemoveCounter-=1,assert&&assert(i.addRemoveCounter===-1),this.instanceRemovalCheckList.push(i),this.removeInstanceWithIndex(i,t),this.markSkipPruning(),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}onChildrenReordered(e,t){sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`reordering children for ${this.toString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),this.reorderInstances(e,t),this.markSkipPruning(),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}onVisibilityChange(){assert&&assert(!this.stateless,"If we are stateless, we should not receive these notifications"),this.stitchChangeFrame=this.display._frameId,this.parent&&this.parent.markSkipPruning(),this.visibilityDirty=!0,this.parent&&this.parent.markChildVisibilityDirty()}onOpacityChange(){assert&&assert(!this.stateless,"If we are stateless, we should not receive these notifications"),this.markRenderStateDirty()}markChildVisibilityDirty(){this.childVisibilityDirty||(this.childVisibilityDirty=!0,this.parent&&this.parent.markChildVisibilityDirty())}updateDrawableFittability(e){this.selfDrawable&&this.selfDrawable.setFittable(e),this.groupDrawable&&this.groupDrawable.setFittable(e)}updateVisibility(e,t,i,n){this.visibilityDirty&&(n=!0);const r=this.node.isVisible(),h=this.visible,p=this.relativeVisible,S=this.selfVisible,C=this.node.voicingVisibleProperty.value,B=this.voicingVisible,U=h&&B;this.visible=e&&r,this.voicingVisible=t&&C,this.relativeVisible=i&&r,this.selfVisible=this.isVisibilityApplied?!0:this.relativeVisible;const k=this.children.length;for(let X=0;X<k;X++){const g=this.children[X];(n||g.visibilityDirty||g.childVisibilityDirty)&&g.updateVisibility(this.visible,this.voicingVisible,this.isVisibilityApplied?!0:this.relativeVisible,n)}this.visibilityDirty=!1,this.childVisibilityDirty=!1,this.visible!==h&&this.visibleEmitter.emit(),this.relativeVisible!==p&&this.relativeVisibleEmitter.emit(),this.selfVisible!==S&&this.selfVisibleEmitter.emit();const Q=this.voicingVisible&&this.visible;Q!==U&&this.canVoiceEmitter.emit(Q)}getDescendantCount(){let e=this.children.length;for(let t=0;t<this.children.length;t++)e+=this.children[t].getDescendantCount();return e}addSVGGroup(e){this.svgGroups.push(e)}removeSVGGroup(e){Vs(this.svgGroups,e)}lookupSVGGroup(e){const t=this.svgGroups.length;for(let i=0;i<t;i++){const n=this.svgGroups[i];if(n.block===e)return n}return null}getFilterRootInstance(){return this.isBackbone||this.isInstanceCanvasCache||!this.parent?this:this.parent.getFilterRootInstance()}getTransformRootInstance(){return this.isTransformed||!this.parent?this:this.parent.getTransformRootInstance()}getVisibilityRootInstance(){return this.isVisibilityApplied||!this.parent?this:this.parent.getVisibilityRootInstance()}attachNodeListeners(){this.relativeTransform.attachNodeListeners(),this.isSharedCanvasCachePlaceholder||(this.node.childInsertedEmitter.addListener(this.childInsertedListener),this.node.childRemovedEmitter.addListener(this.childRemovedListener),this.node.childrenReorderedEmitter.addListener(this.childrenReorderedListener),this.node.visibleProperty.lazyLink(this.visibilityListener),this.node.voicingVisibleProperty.lazyLink(this.visibilityListener),this.node.filterChangeEmitter.addListener(this.markRenderStateDirtyListener),this.node.clipAreaProperty.lazyLink(this.markRenderStateDirtyListener),this.node.instanceRefreshEmitter.addListener(this.markRenderStateDirtyListener))}detachNodeListeners(){this.relativeTransform.detachNodeListeners(),this.isSharedCanvasCachePlaceholder||(this.node.childInsertedEmitter.removeListener(this.childInsertedListener),this.node.childRemovedEmitter.removeListener(this.childRemovedListener),this.node.childrenReorderedEmitter.removeListener(this.childrenReorderedListener),this.node.visibleProperty.unlink(this.visibilityListener),this.node.voicingVisibleProperty.unlink(this.visibilityListener),this.node.filterChangeEmitter.removeListener(this.markRenderStateDirtyListener),this.node.clipAreaProperty.unlink(this.markRenderStateDirtyListener),this.node.instanceRefreshEmitter.removeListener(this.markRenderStateDirtyListener))}markRenderStateDirty(){this.renderStateDirtyFrame=this.display._frameId,this.parent&&this.parent.markSkipPruning()}markSkipPruning(){this.skipPruningFrame=this.display._frameId,this.parent&&this.parent.markSkipPruning()}getBranchIndexTo(e){const t=this.branchIndexMap[e.id];if(t!==void 0)return t;const i=this.trail.getBranchIndexTo(e.trail);return this.branchIndexMap[e.id]=i,e.branchIndexMap[this.id]=i,this.branchIndexReferences.push(e),e.branchIndexReferences.push(this),i}dispose(){for(sceneryLog&&sceneryLog.Instance&&sceneryLog.Instance(`dispose ${this.toString()}`),sceneryLog&&sceneryLog.Instance&&sceneryLog.push(),assert&&assert(this.active,"Seems like we tried to dispose this Instance twice, it is not active"),this.active=!1;this.branchIndexReferences.length;){const t=this.branchIndexReferences.pop();delete this.branchIndexMap[t.id],delete t.branchIndexMap[this.id],Vs(t.branchIndexReferences,this)}this.groupDrawable&&this.groupDrawable.disposeImmediately(this.display),this.sharedCacheDrawable&&this.sharedCacheDrawable.disposeImmediately(this.display),this.selfDrawable&&this.selfDrawable.disposeImmediately(this.display);const e=this.children.length;for(let t=0;t<e;t++)this.children[t].dispose();for(;this.instanceRemovalCheckList.length;){const t=this.instanceRemovalCheckList.pop();t.active&&t.dispose()}this.stateless||this.detachNodeListeners(),this.node.removeInstance(this),this.sharedCacheInstance&&(this.sharedCacheInstance.externalReferenceCount--,this.sharedCacheInstance.externalReferenceCount===0&&(delete this.display._sharedCanvasInstances[this.node.getId()],this.sharedCacheInstance.dispose())),this.cleanInstance(null,null),this.visibleEmitter.removeAllListeners(),this.relativeVisibleEmitter.removeAllListeners(),this.selfVisibleEmitter.removeAllListeners(),this.canVoiceEmitter.removeAllListeners(),this.freeToPool(),sceneryLog&&sceneryLog.Instance&&sceneryLog.pop()}audit(e,t){if(assertSlow){e===void 0&&(e=this.display._frameId),assertSlow(!this.stateless,"State is required for all display instances"),assertSlow(this.firstDrawable===null==(this.lastDrawable===null),"First/last drawables need to both be null or non-null"),assertSlow(!this.isBackbone&&!this.isSharedCanvasCachePlaceholder||this.groupDrawable,"If we are a backbone or shared cache, we need to have a groupDrawable reference"),assertSlow(!this.isSharedCanvasCachePlaceholder||!this.node.isPainted()||this.selfDrawable,"We need to have a selfDrawable if we are painted and not a shared cache"),assertSlow(!this.isTransformed&&!this.isCanvasCache||this.groupDrawable,"We need to have a groupDrawable if we are a backbone or any type of canvas cache"),assertSlow(!this.isSharedCanvasCachePlaceholder||this.sharedCacheDrawable,"We need to have a sharedCacheDrawable if we are a shared cache"),assertSlow(this.addRemoveCounter===0,"Our addRemoveCounter should always be 0 at the end of syncTree");for(let i=0;i<this.children.length;i++)this.children[i].audit(e,t);this.relativeTransform.audit(e,t),this.fittability.audit()}}auditVisibility(e){if(assertSlow){const t=e&&this.node.isVisible(),i=this.trail.isVisible();assertSlow(t===i,"Trail visibility failure"),assertSlow(t===this.visible,"Visible flag failure"),assertSlow(this.voicingVisible===_.reduce(this.trail.nodes,(n,r)=>n&&r.voicingVisibleProperty.value,!0),"When this Instance is voicingVisible: true, all Trail Nodes must also be voicingVisible: true");for(let n=0;n<this.children.length;n++)this.children[n].auditVisibility(t)}}auditChangeIntervals(e,t,i,n){if(e){let h=e;for(;h!==t;)h=h.oldNextDrawable}if(i){let h=i;for(;h!==n;)h=h.nextDrawable}function r(h,p){if(assertSlow)for(assertSlow(h!==null),assertSlow(p!==null);h!==p;)assertSlow(h.nextDrawable===h.oldNextDrawable,"Change interval mismatch"),h=h.nextDrawable}if(assertSlow){const h=this.firstChangeInterval,p=this.lastChangeInterval;if((!h||h.drawableBefore!==null)&&assertSlow(e===i,"If we have no changes, or our first change interval is not open, our firsts should be the same"),(!p||p.drawableAfter!==null)&&assertSlow(t===n,"If we have no changes, or our last change interval is not open, our lasts should be the same"),!h)assertSlow(!p,"We should not be missing only one change interval"),e&&r(e,t);else{assertSlow(p,"We should not be missing only one change interval"),h.drawableBefore!==null&&r(e,h.drawableBefore),p.drawableAfter!==null&&r(p.drawableAfter,t);let S=h;for(;S&&S.nextChangeInterval;){const C=S.nextChangeInterval;assertSlow(S.drawableAfter!==null),assertSlow(C.drawableBefore!==null),r(S.drawableAfter,C.drawableBefore),S=C}}}}toString(){return`${this.id}#${this.node?`${this.node.constructor.name?this.node.constructor.name:"?"}#${this.node.id}`:"-"}`}}q.register("Instance",un);$t.mixInto(un);const ZL=un;class Bm{constructor(e){this.display=e;const t=document.createElementNS(Gt,"svg");this.domElement=t,t.style.position="absolute",t.setAttribute("class","safari-workaround"),t.style.top="0",t.style.left="0",t.style["pointer-events"]="none",e.sizeProperty.link(i=>{t.setAttribute("width",""+i.width),t.setAttribute("height",""+i.height),t.style.clip=`rect(0px,${i.width}px,${i.height}px,0px)`}),this.rect=document.createElementNS(Gt,"rect"),t.appendChild(this.rect),this.update()}update(){const e=io.nextDouble();this.rect.setAttribute("x",""+e),this.rect.setAttribute("y",""+e),this.rect.setAttribute("style","fill: rgba(255,200,100,0); stroke: none;"),this.display.width&&this.rect.setAttribute("width",""+(this.display.width-e*2)),this.display.height&&this.rect.setAttribute("height",""+(this.display.height-e*2))}}q.register("SafariWorkaroundOverlay",Bm);const QL={"scenery-grab-pointer":["grab","-moz-grab","-webkit-grab","pointer"],"scenery-grabbing-pointer":["grabbing","-moz-grabbing","-webkit-grabbing","pointer"]};let JL=1;const ws=class ws{constructor(e,t){this._refreshSVGEmitter=new Yi,this._refreshSVGPending=!1,assert&&assert(e,"rootNode is a required parameter");const i=je()({width:t&&t.container&&t.container.clientWidth||640,height:t&&t.container&&t.container.clientHeight||480,allowCSSHacks:!0,allowSafariRedrawWorkaround:!1,allowSceneOverflow:!1,allowLayerFitting:!1,forceSVGRefresh:!1,defaultCursor:"default",backgroundColor:null,preserveDrawingBuffer:!1,allowWebGL:!0,accessibility:!0,supportsInteractiveHighlights:!1,interactive:!0,listenToOnlyElement:!1,batchDOMEvents:!1,assumeFullWindow:!1,aggressiveContextRecreation:!0,passiveEvents:_i.safari?!1:null,allowBackingScaleAntialiasing:!0},t);this.id=JL++,this._accessible=i.accessibility,this._preserveDrawingBuffer=i.preserveDrawingBuffer,this._allowWebGL=i.allowWebGL,this._allowCSSHacks=i.allowCSSHacks,this._allowSceneOverflow=i.allowSceneOverflow,this._defaultCursor=i.defaultCursor,this.sizeProperty=new vt(new Zs(i.width,i.height)),this._currentSize=new Zs(-1,-1),this._rootNode=e,this._rootNode.addRootedDisplay(this),this._rootBackbone=null,this._domElement=i.container?ea.repurposeBackboneContainer(i.container):ea.createDivBackbone(),this._sharedCanvasInstances={},this._baseInstance=null,this._frameId=0,this._dirtyTransformRoots=[],this._dirtyTransformRootsWithoutPass=[],this._instanceRootsToDispose=[],this._reduceReferencesNeeded=[],this._drawablesToDispose=[],this._drawablesToChangeBlock=[],this._drawablesToUpdateLinks=[],this._changeIntervalsToDispose=[],this._lastCursor=null,this._currentBackgroundCSS=null,this._backgroundColor=null,this._requestAnimationFrameID=0,this._input=null,this._inputListeners=[],this._interactive=i.interactive,this._listenToOnlyElement=i.listenToOnlyElement,this._batchDOMEvents=i.batchDOMEvents,this._assumeFullWindow=i.assumeFullWindow,this._passiveEvents=i.passiveEvents,this._aggressiveContextRecreation=i.aggressiveContextRecreation,this._allowBackingScaleAntialiasing=i.allowBackingScaleAntialiasing,this._allowLayerFitting=i.allowLayerFitting,this._forceSVGRefresh=i.forceSVGRefresh,this._overlays=[],this._pointerOverlay=null,this._pointerAreaOverlay=null,this._hitAreaOverlay=null,this._canvasAreaBoundsOverlay=null,this._fittedBlockBoundsOverlay=null,assert&&(this._isPainting=!1,this._isDisposing=!1,this._isDisposed=!1),this.applyCSSHacks(),this.setBackgroundColor(i.backgroundColor);const n=new Ff;if(this.descriptionUtteranceQueue=new Vf(n,{initialize:this._accessible,featureSpecificAnnouncingControlPropertyName:"descriptionCanAnnounceProperty"}),_i.safari&&i.allowSafariRedrawWorkaround&&this.addOverlay(new Bm(this)),this.focusManager=new jt,(this._accessible||i.supportsInteractiveHighlights)&&(this._focusRootNode=new Ge,this._focusOverlay=new os(this,this._focusRootNode,{pdomFocusHighlightsVisibleProperty:this.focusManager.pdomFocusHighlightsVisibleProperty,interactiveHighlightsVisibleProperty:this.focusManager.interactiveHighlightsVisibleProperty,readingBlockHighlightsVisibleProperty:this.focusManager.readingBlockHighlightsVisibleProperty}),this.addOverlay(this._focusOverlay)),this._accessible){this._rootPDOMInstance=en.pool.create(null,this,new ht),sceneryLog&&sceneryLog.PDOMInstance&&sceneryLog.PDOMInstance(`Display root instance: ${this._rootPDOMInstance.toString()}`),Rs.rebuildInstanceTree(this._rootPDOMInstance),assert&&assert(this._rootPDOMInstance.peer,"Peer should be created from createFromPool"),this._domElement.appendChild(this._rootPDOMInstance.peer.primarySibling);const r=n.ariaLiveContainer;this._domElement.appendChild(r),r.style[Qe.userSelect]="none",this._boundHandleFullScreenNavigation=this.handleFullScreenNavigation.bind(this),ys.keydownEmitter.addListener(this._boundHandleFullScreenNavigation)}}getDOMElement(){return this._domElement}get domElement(){return this.getDOMElement()}updateDisplay(){sceneryLog&&q.isLoggingPerformance()&&(this.perfSyncTreeCount=0,this.perfStitchCount=0,this.perfIntervalCount=0,this.perfDrawableBlockChangeCount=0,this.perfDrawableOldIntervalCount=0,this.perfDrawableNewIntervalCount=0),assert&&ws.assertSubtreeDisposed(this._rootNode),sceneryLog&&sceneryLog.Display&&sceneryLog.Display(`updateDisplay frame ${this._frameId}`),sceneryLog&&sceneryLog.Display&&sceneryLog.push();const e=!!this._baseInstance;for(this._input&&this._input.validatePointers(),this._accessible&&this._rootPDOMInstance.peer.updateSubtreePositioning(),this._rootNode.validateWatchedBounds(),assertSlow&&this._accessible&&this._rootPDOMInstance.auditRoot(),assertSlow&&this._rootNode._picker.audit(),this._baseInstance=this._baseInstance||ZL.createFromPool(this,new ht(this._rootNode),!0,!1),this._baseInstance.baseSyncTree(),e&&this.markTransformRootDirty(this._baseInstance,this._baseInstance.isTransformed);this._drawablesToUpdateLinks.length;)this._drawablesToUpdateLinks.pop().updateLinks();for(;this._changeIntervalsToDispose.length;)this._changeIntervalsToDispose.pop().dispose();for(this._rootBackbone=this._rootBackbone||this._baseInstance.groupDrawable,assert&&assert(this._rootBackbone,"We are guaranteed a root backbone as the groupDrawable on the base instance"),assert&&assert(this._rootBackbone===this._baseInstance.groupDrawable,"We don't want the base instance's groupDrawable to change"),assertSlow&&this._rootBackbone.audit(!0,!1,!0),sceneryLog&&sceneryLog.Display&&sceneryLog.Display("drawable block change phase"),sceneryLog&&sceneryLog.Display&&sceneryLog.push();this._drawablesToChangeBlock.length;){const t=this._drawablesToChangeBlock.pop().updateBlock();sceneryLog&&q.isLoggingPerformance()&&t&&this.perfDrawableBlockChangeCount++}for(sceneryLog&&sceneryLog.Display&&sceneryLog.pop(),assertSlow&&this._rootBackbone.audit(!1,!1,!0),assertSlow&&this._baseInstance.audit(this._frameId,!1),this.updateDirtyTransformRoots(),this._baseInstance.updateVisibility(!0,!0,!0,!1),assertSlow&&this._baseInstance.auditVisibility(!0),assertSlow&&this._baseInstance.audit(this._frameId,!0),sceneryLog&&sceneryLog.Display&&sceneryLog.Display("instance root disposal phase"),sceneryLog&&sceneryLog.Display&&sceneryLog.push();this._instanceRootsToDispose.length;)this._instanceRootsToDispose.pop().dispose();for(sceneryLog&&sceneryLog.Display&&sceneryLog.pop(),assertSlow&&this._rootNode.auditInstanceSubtreeForDisplay(this),sceneryLog&&sceneryLog.Display&&sceneryLog.Display("drawable disposal phase"),sceneryLog&&sceneryLog.Display&&sceneryLog.push();this._drawablesToDispose.length;)this._drawablesToDispose.pop().dispose();if(sceneryLog&&sceneryLog.Display&&sceneryLog.pop(),assertSlow&&this._baseInstance.audit(this._frameId,!1),assert&&(assert(!this._isPainting,"Display was already updating paint, may have thrown an error on the last update"),this._isPainting=!0),sceneryLog&&sceneryLog.Display&&sceneryLog.Display("repaint phase"),sceneryLog&&sceneryLog.Display&&sceneryLog.push(),this._rootBackbone.update(),sceneryLog&&sceneryLog.Display&&sceneryLog.pop(),assert&&(this._isPainting=!1),assertSlow&&this._rootBackbone.audit(!1,!1,!1),assertSlow&&this._baseInstance.audit(this._frameId,!1),this.updateCursor(),this.updateBackgroundColor(),this.updateSize(),this._overlays.length){let t=this._rootBackbone.lastZIndex;for(let i=0;i<this._overlays.length;i++){const n=this._overlays[i];n.domElement.style.zIndex=""+t++,n.update()}}for(;this._reduceReferencesNeeded.length;)this._reduceReferencesNeeded.pop().reduceReferences();if(this._frameId++,sceneryLog&&q.isLoggingPerformance()){const t=`syncTree count: ${this.perfSyncTreeCount}`;this.perfSyncTreeCount>500?sceneryLog.PerfCritical&&sceneryLog.PerfCritical(t):this.perfSyncTreeCount>100?sceneryLog.PerfMajor&&sceneryLog.PerfMajor(t):this.perfSyncTreeCount>20?sceneryLog.PerfMinor&&sceneryLog.PerfMinor(t):this.perfSyncTreeCount>0&&sceneryLog.PerfVerbose&&sceneryLog.PerfVerbose(t);const i=`drawable block changes: ${this.perfDrawableBlockChangeCount} for -${this.perfDrawableOldIntervalCount} +${this.perfDrawableNewIntervalCount}`;this.perfDrawableBlockChangeCount>200?sceneryLog.PerfCritical&&sceneryLog.PerfCritical(i):this.perfDrawableBlockChangeCount>60?sceneryLog.PerfMajor&&sceneryLog.PerfMajor(i):this.perfDrawableBlockChangeCount>10?sceneryLog.PerfMinor&&sceneryLog.PerfMinor(i):this.perfDrawableBlockChangeCount>0&&sceneryLog.PerfVerbose&&sceneryLog.PerfVerbose(i)}Rs.auditPDOMDisplays(this.rootNode),(this._forceSVGRefresh||this._refreshSVGPending)&&(this._refreshSVGPending=!1,this.refreshSVG()),sceneryLog&&sceneryLog.Display&&sceneryLog.pop()}getPhetioElementAt(e){const t=this._rootNode.getPhetioMouseHit(e);return t==="phetioNotSelectable"?null:(t&&assert&&assert(t.isPhetioInstrumented(),"a PhetioMouseHit should be instrumented"),t)}updateSize(){let e=!1;this.size.width!==this._currentSize.width&&(e=!0,this._currentSize.width=this.size.width,this._domElement.style.width=`${this.size.width}px`),this.size.height!==this._currentSize.height&&(e=!0,this._currentSize.height=this.size.height,this._domElement.style.height=`${this.size.height}px`),e&&!this._allowSceneOverflow&&(this._domElement.style.clip=`rect(0px,${this.size.width}px,${this.size.height}px,0px)`)}isWebGLAllowed(){return this._allowWebGL}get webglAllowed(){return this.isWebGLAllowed()}getRootNode(){return this._rootNode}get rootNode(){return this.getRootNode()}getRootBackbone(){return assert&&assert(this._rootBackbone),this._rootBackbone}get rootBackbone(){return this.getRootBackbone()}getSize(){return this.sizeProperty.value}get size(){return this.getSize()}getBounds(){return this.size.toBounds()}get bounds(){return this.getBounds()}setSize(e){assert&&assert(e.width%1===0,"Display.width should be an integer"),assert&&assert(e.width>0,"Display.width should be greater than zero"),assert&&assert(e.height%1===0,"Display.height should be an integer"),assert&&assert(e.height>0,"Display.height should be greater than zero"),this.sizeProperty.value=e}setWidthHeight(e,t){this.setSize(new Zs(e,t))}getWidth(){return this.size.width}get width(){return this.getWidth()}set width(e){this.setWidth(e)}setWidth(e){return this.getWidth()!==e&&this.setSize(new Zs(e,this.getHeight())),this}getHeight(){return this.size.height}get height(){return this.getHeight()}set height(e){this.setHeight(e)}setHeight(e){return this.getHeight()!==e&&this.setSize(new Zs(this.getWidth(),e)),this}setBackgroundColor(e){return assert&&assert(e===null||typeof e=="string"||e instanceof Me),this._backgroundColor=e,this}set backgroundColor(e){this.setBackgroundColor(e)}get backgroundColor(){return this.getBackgroundColor()}getBackgroundColor(){return this._backgroundColor}get interactive(){return this._interactive}set interactive(e){this._accessible&&e!==this._interactive&&this._rootPDOMInstance.peer.recursiveDisable(!e),this._interactive=e,!this._interactive&&this._input&&(this._input.interruptPointers(),this._input.clearBatchedEvents(),this._input.removeTemporaryPointers(),this._rootNode.interruptSubtreeInput(),this.interruptInput())}addOverlay(e){this._overlays.push(e),this._domElement.appendChild(e.domElement),e.domElement.setAttribute("aria-hidden","true")}removeOverlay(e){this._domElement.removeChild(e.domElement),this._overlays.splice(_.indexOf(this._overlays,e),1)}getPDOMRootElement(){return this._accessible?this._rootPDOMInstance.peer.primarySibling:null}get pdomRootElement(){return this.getPDOMRootElement()}isAccessible(){return this._accessible}isElementUnderPDOM(e,t){if(!this._accessible)return!1;const i=this.pdomRootElement.contains(e),n=e!==this.pdomRootElement;return t?i:i&&n}handleFullScreenNavigation(e){if(assert&&assert(this.pdomRootElement,"There must be a PDOM to support keyboard navigation"),Gy.isFullScreen()&&me.isKeyEvent(e,me.KEY_TAB)){const t=this.pdomRootElement;(e.shiftKey?dt.getPreviousFocusable(t||void 0):dt.getNextFocusable(t||void 0))===e.target&&e.preventDefault()}}getUsedRenderersBitmask(){function e(t){let i=0;return _.each(t.blocks,n=>{n instanceof Em&&n.domDrawable instanceof ea?i=i|e(n.domDrawable):i=i|n.renderer}),i}return e(this._rootBackbone)&ne.bitmaskRendererArea}markTransformRootDirty(e,t){t?this._dirtyTransformRoots.push(e):this._dirtyTransformRootsWithoutPass.push(e)}updateDirtyTransformRoots(){for(sceneryLog&&sceneryLog.transformSystem&&sceneryLog.transformSystem("updateDirtyTransformRoots"),sceneryLog&&sceneryLog.transformSystem&&sceneryLog.push();this._dirtyTransformRoots.length;)this._dirtyTransformRoots.pop().relativeTransform.updateTransformListenersAndCompute(!1,!1,this._frameId,!0);for(;this._dirtyTransformRootsWithoutPass.length;)this._dirtyTransformRootsWithoutPass.pop().relativeTransform.updateTransformListenersAndCompute(!1,!1,this._frameId,!1);sceneryLog&&sceneryLog.transformSystem&&sceneryLog.pop()}markDrawableChangedBlock(e){sceneryLog&&sceneryLog.Display&&sceneryLog.Display(`markDrawableChangedBlock: ${e.toString()}`),this._drawablesToChangeBlock.push(e)}markForReducedReferences(e){assert&&assert(!!e.reduceReferences),this._reduceReferencesNeeded.push(e)}markInstanceRootForDisposal(e){sceneryLog&&sceneryLog.Display&&sceneryLog.Display(`markInstanceRootForDisposal: ${e.toString()}`),this._instanceRootsToDispose.push(e)}markDrawableForDisposal(e){sceneryLog&&sceneryLog.Display&&sceneryLog.Display(`markDrawableForDisposal: ${e.toString()}`),this._drawablesToDispose.push(e)}markDrawableForLinksUpdate(e){this._drawablesToUpdateLinks.push(e)}markChangeIntervalToDispose(e){this._changeIntervalsToDispose.push(e)}updateBackgroundColor(){assert&&assert(this._backgroundColor===null||typeof this._backgroundColor=="string"||this._backgroundColor instanceof Me);const e=this._backgroundColor===null?"":this._backgroundColor.toCSS?this._backgroundColor.toCSS():this._backgroundColor;e!==this._currentBackgroundCSS&&(this._currentBackgroundCSS=e,this._domElement.style.backgroundColor=e)}updateCursor(){if(this._input&&this._input.mouse&&this._input.mouse.point){if(this._input.mouse.cursor){sceneryLog&&sceneryLog.Cursor&&sceneryLog.Cursor(`set on pointer: ${this._input.mouse.cursor}`),this.setSceneCursor(this._input.mouse.cursor);return}const e=this._rootNode.trailUnderPointer(this._input.mouse);if(e)for(let t=e.getCursorCheckIndex();t>=0;t--){const i=e.nodes[t],n=i.getEffectiveCursor();if(n){sceneryLog&&sceneryLog.Cursor&&sceneryLog.Cursor(`${n} on ${i.constructor.name}#${i.id}`),this.setSceneCursor(n);return}}sceneryLog&&sceneryLog.Cursor&&sceneryLog.Cursor(`--- for ${e?e.toString():"(no hit)"}`)}this.setSceneCursor(this._defaultCursor)}setElementCursor(e){this._domElement.style.cursor=e,this._assumeFullWindow&&(document.body.style.cursor=e)}setSceneCursor(e){if(e!==this._lastCursor){this._lastCursor=e;const t=QL[e];if(t)for(let i=t.length-1;i>=0;i--)this.setElementCursor(t[i]);else this.setElementCursor(e)}}applyCSSHacks(){this._allowSceneOverflow||(this._domElement.style.overflow="hidden"),this._domElement.style.msTouchAction="none",Qe.setStyle(this._domElement,Qe.fontSmoothing,"antialiased"),this._allowCSSHacks&&(document.onselectstart=()=>!1,document.body.style.msContentZooming="none",Qe.setStyle(this._domElement,Qe.userDrag,"none"),Qe.setStyle(this._domElement,Qe.userSelect,"none"),Qe.setStyle(this._domElement,Qe.touchAction,"none"),Qe.setStyle(this._domElement,Qe.touchCallout,"none"),Qe.setStyle(this._domElement,Qe.tapHighlightColor,"rgba(0,0,0,0)"))}canvasDataURL(e){this.canvasSnapshot(t=>{e(t.toDataURL())})}canvasSnapshot(e){const t=document.createElement("canvas");t.width=this.size.width,t.height=this.size.height;const i=t.getContext("2d");this._rootNode.renderToCanvas(t,i,()=>{e(t,i.getImageData(0,0,t.width,t.height))},this.domElement.style.backgroundColor)}setPointerDisplayVisible(e){const t=!!this._pointerOverlay;e!==t&&(e?(this._pointerOverlay=new Rm(this,this._rootNode),this.addOverlay(this._pointerOverlay)):(this.removeOverlay(this._pointerOverlay),this._pointerOverlay.dispose(),this._pointerOverlay=null))}setPointerAreaDisplayVisible(e){const t=!!this._pointerAreaOverlay;e!==t&&(e?(this._pointerAreaOverlay=new Nm(this,this._rootNode),this.addOverlay(this._pointerAreaOverlay)):(this.removeOverlay(this._pointerAreaOverlay),this._pointerAreaOverlay.dispose(),this._pointerAreaOverlay=null))}setHitAreaDisplayVisible(e){const t=!!this._hitAreaOverlay;e!==t&&(e?(this._hitAreaOverlay=new Ir(this,this._rootNode),this.addOverlay(this._hitAreaOverlay)):(this.removeOverlay(this._hitAreaOverlay),this._hitAreaOverlay.dispose(),this._hitAreaOverlay=null))}setCanvasNodeBoundsVisible(e){const t=!!this._canvasAreaBoundsOverlay;e!==t&&(e?(this._canvasAreaBoundsOverlay=new Om(this,this._rootNode),this.addOverlay(this._canvasAreaBoundsOverlay)):(this.removeOverlay(this._canvasAreaBoundsOverlay),this._canvasAreaBoundsOverlay.dispose(),this._canvasAreaBoundsOverlay=null))}setFittedBlockBoundsVisible(e){const t=!!this._fittedBlockBoundsOverlay;e!==t&&(e?(this._fittedBlockBoundsOverlay=new Mm(this,this._rootNode),this.addOverlay(this._fittedBlockBoundsOverlay)):(this.removeOverlay(this._fittedBlockBoundsOverlay),this._fittedBlockBoundsOverlay.dispose(),this._fittedBlockBoundsOverlay=null))}resizeOnWindowResize(){const e=()=>{this.setWidthHeight(self.innerWidth,self.innerHeight)};self.addEventListener("resize",e),e()}updateOnRequestAnimationFrame(e){let t=0,i=0;const n=this;(function r(){self._requestAnimationFrameID=self.requestAnimationFrame(r,self._domElement);const h=Date.now();t!==0&&(i=(h-t)/1e3),t=h,Gi.emit(i),e&&e(i),n.updateDisplay()})()}cancelUpdateOnRequestAnimationFrame(){self.cancelAnimationFrame(this._requestAnimationFrameID)}initializeEvents(e){assert&&assert(!this._input,"Events cannot be attached twice to a display (for now)");const t=new On(this,!this._listenToOnlyElement,this._batchDOMEvents,this._assumeFullWindow,this._passiveEvents,e);this._input=t,t.connectListeners()}detachEvents(){assert&&assert(this._input,"detachEvents() should be called only when events are attached"),this._input.disconnectListeners(),this._input=null}addInputListener(e){return assert&&assert(!_.includes(this._inputListeners,e),"Input listener already registered on this Display"),_.includes(this._inputListeners,e)||this._inputListeners.push(e),this}removeInputListener(e){return assert&&assert(_.includes(this._inputListeners,e)),this._inputListeners.splice(_.indexOf(this._inputListeners,e),1),this}hasInputListener(e){for(let t=0;t<this._inputListeners.length;t++)if(this._inputListeners[t]===e)return!0;return!1}getInputListeners(){return this._inputListeners.slice(0)}get inputListeners(){return this.getInputListeners()}interruptInput(){const e=this.inputListeners;for(let t=0;t<e.length;t++){const i=e[t];i.interrupt&&i.interrupt()}return this}interruptPointers(){return this._input&&this._input.interruptPointers(),this}interruptOtherPointers(e=null){var t;return this._input&&this._input.interruptPointers(e||((t=this._input.currentSceneryEvent)==null?void 0:t.pointer)||null),this}ensureNotPainting(){assert&&assert(!this._isPainting,"This should not be run in the call tree of updateDisplay(). If you see this, it is likely that either the last updateDisplay() had a thrown error and it is trying to be run again (in which case, investigate that error), OR code was run/triggered from inside an updateDisplay() that has the potential to cause an infinite loop, e.g. CanvasNode paintCanvas() call manipulating another Node, or a bounds listener that Scenery missed.")}loseWebGLContexts(){(function e(t){t.blocks&&t.blocks.forEach(i=>{const n=i.gl;n&&Dt.loseContext(n);for(let r=i.firstDrawable;r!==null&&(e(r),r!==i.lastDrawable);r=r.nextDrawable);})})(this._rootBackbone)}inspect(){localStorage.scenerySnapshot=JSON.stringify(xi(this))}getDebugHTML(){const e="font-weight: bold; font-size: 120%; margin-top: 5px;";let t=0,i="";i+=`<div style="${e}">Display (${this.id}) Summary</div>`,i+=`${this.size.toString()} frame:${this._frameId} input:${!!this._input} cursor:${this._lastCursor}<br/>`;function n(g){let Z=1;for(let ce=0;ce<g.children.length;ce++)Z+=n(g.children[ce]);return Z}i+=`Nodes: ${n(this._rootNode)}<br/>`;function r(g){let Z=1;for(let ce=0;ce<g.children.length;ce++)Z+=r(g.children[ce]);return Z}i+=this._baseInstance?`Instances: ${r(this._baseInstance)}<br/>`:"";function h(g){let Z=1;if(g.blocks)_.each(g.blocks,ce=>{Z+=h(ce)});else if(g.firstDrawable&&g.lastDrawable){for(let ce=g.firstDrawable;ce!==g.lastDrawable;ce=ce.nextDrawable)Z+=h(ce);Z+=h(g.lastDrawable)}return Z}i+=this._rootBackbone?`Drawables: ${h(this._rootBackbone)}<br/>`:"";const p={};function S(g){const Z=g.constructor.name;p[Z]?p[Z]++:p[Z]=1}function C(g){let Z=0;g.selfDrawable&&(S(g.selfDrawable),Z++),g.groupDrawable&&(S(g.groupDrawable),Z++),g.sharedCacheDrawable&&(S(g.sharedCacheDrawable),Z++);for(let ce=0;ce<g.children.length;ce++)Z+=C(g.children[ce]);return Z}i+=this._baseInstance?`Retained Drawables: ${C(this._baseInstance)}<br/>`:"";for(const g in p)i+=`&nbsp;&nbsp;&nbsp;&nbsp;${g}: ${p[g]}<br/>`;function B(g){if(!g.firstDrawable||!g.lastDrawable)return"";const Z=g.domDrawable&&g.domDrawable.blocks;let ce=`<div style="margin-left: ${t*20}px">`;if(ce+=g.toString(),Z||(ce+=` (${g.drawableCount} drawables)`),ce+="</div>",t+=1,Z)for(let ye=0;ye<g.domDrawable.blocks.length;ye++)ce+=B(g.domDrawable.blocks[ye]);return t-=1,ce}if(this._rootBackbone){i+=`<div style="${e}">Block Summary</div>`;for(let g=0;g<this._rootBackbone.blocks.length;g++)i+=B(this._rootBackbone.blocks[g])}function U(g){let Z="";function ce(de){Z+=` <span style="color: #008">${de}</span>`}const ye=g.node;Z+=g.id,Z+=` ${ye.constructor.name?ye.constructor.name:"?"}`,Z+=` <span style="font-weight: ${ye.isPainted()?"bold":"normal"}">${ye.id}</span>`,Z+=ye.getDebugHTMLExtras(),ye.visible||ce("invis"),g.visible||ce("I-invis"),g.relativeVisible||ce("I-rel-invis"),g.selfVisible||ce("I-self-invis"),g.fittability.ancestorsFittable||ce("nofit-ancestor"),g.fittability.selfFittable||ce("nofit-self"),ye.pickable===!0&&ce("pickable"),ye.pickable===!1&&ce("unpickable"),g.trail.isPickable()&&ce('<span style="color: #808">hits</span>'),ye.getEffectiveCursor()&&ce(`effectiveCursor:${ye.getEffectiveCursor()}`),ye.clipArea&&ce("clipArea"),ye.mouseArea&&ce("mouseArea"),ye.touchArea&&ce("touchArea"),ye.getInputListeners().length&&ce("inputListeners"),ye.getRenderer()&&ce(`renderer:${ye.getRenderer()}`),ye.isLayerSplit()&&ce("layerSplit"),ye.opacity<1&&ce(`opacity:${ye.opacity}`),ye.disabledOpacity<1&&ce(`disabledOpacity:${ye.disabledOpacity}`),ye._boundsEventCount>0&&ce(`<span style="color: #800">boundsListen:${ye._boundsEventCount}:${ye._boundsEventSelfCount}</span>`);let Oe="";switch(ye.transform.getMatrix().type){case ka.IDENTITY:Oe="";break;case ka.TRANSLATION_2D:Oe="translated";break;case ka.SCALING:Oe="scale";break;case ka.AFFINE:Oe="affine";break;case ka.OTHER:Oe="other";break;default:throw new Error(`invalid matrix type: ${ye.transform.getMatrix().type}`)}return Oe&&(Z+=` <span style="color: #88f" title="${ye.transform.getMatrix().toString().replace(`
`,"&#10;")}">${Oe}</span>`),Z+=` <span style="color: #888">[Trail ${g.trail.indices.join(".")}]</span>`,Z+=` <span style="color: #8c8">${ye._rendererSummary.bitmask.toString(16)}${ye._rendererBitmask!==ne.bitmaskNodeDefault?` (${ye._rendererBitmask.toString(16)})`:""}</span>`,Z}function k(g){let Z=g.toString();return g.visible&&(Z=`<strong>${Z}</strong>`),g.dirty&&(Z+=g.dirty?' <span style="color: #c00;">[x]</span>':""),g.fittable||(Z+=g.dirty?' <span style="color: #0c0;">[no-fit]</span>':""),Z}function Q(g){let Z=`<div style="margin-left: ${t*20}px">`;function ce(ye,Oe){Z+=` <span style="color: #888">${ye}:${k(Oe)}</span>`}Z+=U(g),g.selfDrawable&&ce("self",g.selfDrawable),g.groupDrawable&&ce("group",g.groupDrawable),g.sharedCacheDrawable&&ce("sharedCache",g.sharedCacheDrawable),Z+="</div>",i+=Z,t+=1,_.each(g.children,ye=>{Q(ye)}),t-=1}this._baseInstance&&(i+=`<div style="${e}">Root Instance Tree</div>`,Q(this._baseInstance)),_.each(this._sharedCanvasInstances,g=>{i+=`<div style="${e}">Shared Canvas Instance Tree</div>`,Q(g)});function X(g){let Z=`<div style="margin-left: ${t*20}px">`;if(Z+=k(g),g.instance?(Z+=` <span style="color: #0a0;">(${g.instance.trail.toPathString()})</span>`,Z+=`&nbsp;&nbsp;&nbsp;${U(g.instance)}`):g.backboneInstance&&(Z+=` <span style="color: #a00;">(${g.backboneInstance.trail.toPathString()})</span>`,Z+=`&nbsp;&nbsp;&nbsp;${U(g.backboneInstance)}`),Z+="</div>",i+=Z,g.blocks)t+=1,_.each(g.blocks,ce=>{X(ce)}),t-=1;else if(g.firstDrawable&&g.lastDrawable){t+=1;for(let ce=g.firstDrawable;ce!==g.lastDrawable;ce=ce.nextDrawable)X(ce);X(g.lastDrawable),t-=1}}return this._rootBackbone&&(i+='<div style="font-weight: bold;">Root Drawable Tree</div>',X(this._rootBackbone)),i}getDebugURI(){return`data:text/html;charset=utf-8,${encodeURIComponent(`<!DOCTYPE html><html lang="en"><head><title>Scenery Debug Snapshot</title></head><body style="font-size: 12px;">${this.getDebugHTML()}</body></html>`)}`}popupDebug(){self.open(this.getDebugURI())}iframeDebug(){const e=document.createElement("iframe");e.width=""+self.innerWidth,e.height=""+self.innerHeight,e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.zIndex="10000",document.body.appendChild(e),e.contentWindow.document.open(),e.contentWindow.document.write(this.getDebugHTML()),e.contentWindow.document.close(),e.contentWindow.document.body.style.background="white";const t=document.createElement("button");t.style.position="absolute",t.style.top="0",t.style.right="0",t.style.zIndex="10001",document.body.appendChild(t),t.textContent="close",["pointerdown","click","touchdown"].forEach(i=>{t.addEventListener(i,()=>{document.body.removeChild(e),document.body.removeChild(t)},!0)})}getPDOMDebugHTML(){let e="";const t="font-weight: bold; font-size: 120%; margin-top: 5px;",i="&nbsp;&nbsp;&nbsp;&nbsp;";e+=`<div style="${t}">Accessible Instances</div><br>`,n(this._rootPDOMInstance,"");function n(S,C){e+=`${C+hc(`${S.isRootInstance?"":S.node.tagName} ${S.toString()}`)}<br>`,S.children.forEach(B=>{n(B,C+i)})}e+=`<br><div style="${t}">Parallel DOM</div><br>`;let r=this._rootPDOMInstance.peer.primarySibling.outerHTML;r=r.replace(/></g,`>
<`);const h=r.split(`
`);let p="";for(let S=0;S<h.length;S++){const C=h[S],B=C.startsWith("</");B&&(p=p.slice(i.length)),e+=`${p+hc(C)}<br>`,B||(p+=i)}return e}foreignObjectRasterization(e){const t={};let i=0;function n(X){X.id||(X.id=`unknown-canvas-${i++}`),t[X.id]=X.toDataURL()}function r(X){if(X instanceof ea)_.each(X.blocks,g=>{r(g)});else if(X instanceof nr&&X.firstDrawable&&X.lastDrawable){for(let g=X.firstDrawable;g!==X.lastDrawable;g=g.nextDrawable)r(g);r(X.lastDrawable),(X instanceof id||X instanceof km)&&X.canvas&&X.canvas instanceof self.HTMLCanvasElement&&n(X.canvas)}Wc&&X instanceof Wc&&(X.domElement instanceof self.HTMLCanvasElement&&n(X.domElement),Array.prototype.forEach.call(X.domElement.getElementsByTagName("canvas"),g=>{n(g)}))}r(this._rootBackbone);const h=document.implementation.createHTMLDocument("");h.documentElement.innerHTML=this.domElement.outerHTML,h.documentElement.setAttribute("xmlns",h.documentElement.namespaceURI),h.documentElement.appendChild(document.createElement("style")).innerHTML=`.${cu.ROOT_CLASS_NAME} { display:none; } `;let p=h.documentElement.getElementsByTagName("canvas");p=Array.prototype.slice.call(p);for(let X=0;X<p.length;X++){const g=p[X],Z=g.style.cssText,ce=h.createElement("img"),ye=t[g.id];assert&&assert(ye,"Must have missed a toDataURL() on a Canvas"),ce.src=ye,ce.setAttribute("style",Z),g.parentNode.replaceChild(ce,g)}const S=this.width,C=this.height,B=()=>{ws.elementToSVGDataURL(h.documentElement,S,C,e)};let U=0,k=!1;const Q=Array.prototype.slice.call(h.documentElement.getElementsByTagName("image"));for(let X=0;X<Q.length;X++){const g=Q[X],Z=g.getAttribute("xlink:href");Z.slice(0,5)!=="data:"&&(U++,k=!0,(()=>{const ce=new self.Image,ye=g;ce.onload=()=>{const Oe=document.createElement("canvas");Oe.width=ce.width,Oe.height=ce.height,Oe.getContext("2d").drawImage(ce,0,0),ye.setAttribute("xlink:href",Oe.toDataURL()),--U===0&&B(),assert&&assert(U>=0)},ce.onerror=()=>{--U===0&&B(),assert&&assert(U>=0)},ce.src=Z})())}k||B()}popupRasterization(){this.foreignObjectRasterization(e=>{e&&self.open(e)})}getTrailFromPDOMIndicesString(e){if(!this._rootPDOMInstance)return null;let t=this._rootPDOMInstance;const i=e.split(dt.PDOM_UNIQUE_ID_SEPARATOR);for(let n=0;n<i.length;n++){const r=Number(i[n]);if(t=t.children[r],!t)return null}return t&&t.trail?t.trail:null}refreshSVG(){this._refreshSVGEmitter.emit()}refreshSVGOnNextFrame(){this._refreshSVGPending=!0}dispose(){assert&&(assert(!this._isDisposing),assert(!this._isDisposed),this._isDisposing=!0),this._input&&this.detachEvents(),this._rootNode.removeRootedDisplay(this),this._accessible&&(assert&&assert(this._boundHandleFullScreenNavigation,"_boundHandleFullScreenNavigation was not added to the keyStateTracker"),ys.keydownEmitter.removeListener(this._boundHandleFullScreenNavigation),this._rootPDOMInstance.dispose()),this._focusOverlay&&this._focusOverlay.dispose(),this.sizeProperty.dispose(),this._baseInstance&&this._baseInstance.dispose(),this.descriptionUtteranceQueue.dispose(),this.focusManager&&this.focusManager.dispose(),assert&&(this._isDisposing=!1,this._isDisposed=!0)}static elementToSVGDataURL(e,t,i,n){const r=document.createElement("canvas"),h=r.getContext("2d");r.width=t,r.height=i;const p=new self.XMLSerializer().serializeToString(e),S=`<svg xmlns="http://www.w3.org/2000/svg" width="${t}" height="${i}"><foreignObject width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml">${p}</div></foreignObject></svg>`,C=new self.Image;C.onload=()=>{h.drawImage(C,0,0),n(r.toDataURL())},C.onerror=()=>{n(null)};const B=new self.TextEncoderLite("utf-8").encode(S),U=self.fromByteArray(B);C.src=`data:image/svg+xml;base64,${U}`}static assertSubtreeDisposed(e){if(assert&&assert(!e.isDisposed,"Disposed nodes should not be included in a scene graph to display."),assert)for(let t=0;t<e.children.length;t++)ws.assertSubtreeDisposed(e.children[t])}static addInputListener(e){assert&&assert(!_.includes(ws.inputListeners,e),"Input listener already registered"),_.includes(ws.inputListeners,e)||ws.inputListeners.push(e)}static removeInputListener(e){assert&&assert(_.includes(ws.inputListeners,e)),ws.inputListeners.splice(_.indexOf(ws.inputListeners,e),1)}static interruptInput(){const e=ws.inputListeners.slice(0);for(let t=0;t<e.length;t++){const i=e[t];i.interrupt&&i.interrupt()}}};ws.INTERRUPT_OTHER_POINTERS=e=>{var t,i;(i=(t=phet==null?void 0:phet.joist)==null?void 0:t.display)==null||i.interruptOtherPointers(e==null?void 0:e.pointer)};let Fi=ws;q.register("Display",Fi);Fi.userGestureEmitter=new Yi;Fi.inputListeners=[];const Uc={};let gg=0;function eP(l){l._parents.forEach(e=>Fm(e,l,1))}function tP(l){l._parents.forEach(e=>Fm(e,l,-1))}function fg(l){const e=Uc[l];assert&&assert(this.parents.length===1,"IndexedNodeIO only supports nodes with a single parent"),this.parents[0].childrenChangedEmitter.removeListener(e),delete Uc[l]}function Fm(l,e,t){let n=l.indexOfChild(e)+t;for(;n>0&&n<l.children.length&&!l.children[n].visible;)n+=t;n>=0&&n<l.children.length&&l.moveChildToIndex(e,n),l.onIndexedNodeIOChildMoved&&l.onIndexedNodeIOChildMoved(e)}const iP=new li("IndexedNodeIO",{valueType:Ge,documentation:"Node that can be moved forward/back by index, which specifies z-order and/or layout order",supertype:Ge.NodeIO,toStateObject:l=>{const e={index:null};return l.parents[0]&&(assert&&assert(l.parents.length===1,"IndexedNodeIO only supports nodes with a single parent"),e.index=l.parents[0].indexOfChild(l)),e},applyState:(l,e)=>{const t=l.parents[0];if(t&&e.index){assert&&assert(l.parents.length===1,"IndexedNodeIO only supports nodes with a single parent");const i=t.children,n=t.indexOfChild(l);i[n]=i[e.index],i[e.index]=l,t.setChildren(i)}},stateSchema:{index:Lt(Tt)},methods:{linkIndex:{returnType:Tt,parameterTypes:[lc(Ds,[Tt])],documentation:"Following the PropertyIO.link pattern, subscribe for notifications when the index in the parent changes, and receive a callback with the current value.  The return value is a numeric ID for use with clearLinkIndex.",implementation:function(l){const e=()=>{assert&&assert(this.parents.length===1,"IndexedNodeIO only supports nodes with a single parent");const i=this.parents[0].indexOfChild(this);l(i)};assert&&assert(this.parents.length===1,"IndexedNodeIO only supports nodes with a single parent"),this.parents[0].childrenChangedEmitter.addListener(e),e();const t=gg;return Uc[t]=e,gg++,t}},unlinkIndex:{returnType:Ds,parameterTypes:[Tt],documentation:"Unlink a listener that has been added using linkIndex, by its numerical ID (like setTimeout/clearTimeout)",implementation:fg},clearLinkIndex:{returnType:Ds,parameterTypes:[Tt],documentation:'Deprecated, see "unlinkIndex".',implementation:function(l){assert&&Xs("clearLinkIndex is deprecated, use unlinkIndex instead.",!0),fg.call(this,l)}},moveForward:{returnType:Ds,parameterTypes:[],implementation:function(){return eP(this)},documentation:"Move this Node one index forward in each of its parents, skipping invisible Nodes. If the Node is already at the front, this is a no-op."},moveBackward:{returnType:Ds,parameterTypes:[],implementation:function(){return tP(this)},documentation:"Move this Node one index backward in each of its parents, skipping invisible Nodes. If the Node is already at the back, this is a no-op."}}});q.register("IndexedNodeIO",iP);class sP extends Jt{constructor(e,t,i){i=ns({nodeTandem:Ft.REQUIRED},i);const n=new Wt(!0,{tandem:i.nodeTandem.createTandem("visibleProperty"),phetioFeatured:!0});super([n,...e],(r,...h)=>r&&t(...h))}}q.register("PhetioControlledVisibilityProperty",sP);export{Fo as $,tm as A,Wt as B,ga as C,Fi as D,tn as E,Fc as F,pm as G,nL as H,qi as I,Qn as J,Lu as K,An as L,tr as M,Ge as N,Yi as O,mi as P,xt as Q,vi as R,Yl as S,Vi as T,xs as U,rL as V,Ul as W,x_ as X,Tc as Y,Cc as Z,Dc as _,na as a,oa as a0,oP as a1,Bo as a2,ko as a3,Cn as a4,bu as a5,ba as a6,me as a7,lP as a8,Zl as a9,iP as aa,Pu as ab,rs as ac,Hb as ad,jt as ae,dv as af,bs as ag,_a as ah,dt as ai,zp as aj,ys as ak,gc as al,hf as am,cn as an,Gy as ao,fi as ap,hP as aq,ra as b,Jt as c,Ou as d,fm as e,gn as f,rm as g,Af as h,ku as i,$l as j,ki as k,Me as l,Mn as m,mn as n,uv as o,uu as p,wn as q,aa as r,Gi as s,ep as t,Wp as u,it as v,cp as w,_u as x,Ky as y,pa as z};
