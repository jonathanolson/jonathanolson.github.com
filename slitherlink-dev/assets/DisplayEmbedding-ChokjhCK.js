var $e=Object.defineProperty;var Qe=(p,r,e)=>r in p?$e(p,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):p[r]=e;var E=(p,r,e)=>(Qe(p,typeof r!="symbol"?r+"":r,e),e);import{c as _,h as F,B as ce,F as pe,N as b,P as D,L as et,n as Fe,R as tt,H as We,M as te,T as je,G as ot,C as Xe,o as rt}from"./PhetioControlledVisibilityProperty-C4xreNPS.js";import{h as he,i as V,E as W,V as st,B as Le,C as nt,F as it,b as at}from"./BasicPuzzle-qCypyw3t.js";import{T as s,P as fe,E as Ye,d as Ue,o as Ce,V as j,l as ye,D as lt,c as _e,C as ct,B as Se}from"./UnivariatePolynomial-B1fo8xe7.js";import{b as dt,L as Ve,a as pt,c as ht,P as qe}from"./TextPushButton-gLDghw4s.js";import{i as xe,S as N,L as ke,_ as ve,ab as ut,e as M,f as R,ac as Je,l as ft,n as wt,m as gt,d as mt}from"./patternBoards-D316jvfQ.js";import{Q as yt,R as Ct,S as Pt,f as St,g as Et,h as Oe,K as vt,s as Ae,i as Vt,j as bt,v as Ie,k as Tt,m as Be,w as Nt,n as K,q as Ft,x as Lt,y as xt,z as kt,J as G,H as Ot,F as At,B as It,D as Bt,c as $,T as Mt,r as Rt,u as Dt,U as be}from"./Theme-D414G__S.js";import{S as Ht,H as Wt,J as jt,O as Xt,R as Yt,Y as Ut,G as ie,a1 as _t,D as qt,E as Jt,K as Zt,L as zt,M as Kt,U as Te,P as Gt,i as $t,a2 as Qt,g as we}from"./autoSolver-CHqufOu6.js";import{A as eo}from"./SpinningIndicatorNode-DOFXt6Ex.js";import{a as to,B as oo,R as ro,b as so,c as no,d as io,S as ao,e as lo}from"./PatternRule-CbsljjHG.js";const Ze=(p,r,e,t)=>(o,n,d)=>{const a=[new Ht(o,n),new Wt(o,n)];return(p||r||e||t)&&(a.push(new jt(o,n)),(r||e||t)&&(a.push(new Xt(o,n)),(e||t)&&(a.push(new Yt(o,n)),t&&a.push(new Ut(o,n))))),new ie(a)},co={allowEdgeEditProperty:yt,allowFaceColorEditProperty:Ct,allowSectorEditProperty:Pt,edgesVisibleProperty:St,edgesHaveColorsProperty:Et,faceColorsVisibleProperty:Oe,faceColorThresholdProperty:vt,sectorsVisibleProperty:Ae,sectorsNextToEdgesVisibleProperty:Vt,sectorsTrivialVisibleProperty:bt,vertexStateVisibleProperty:Ie,allVertexStateVisibleProperty:Tt,faceStateVisibleProperty:Be,whiteLineVisibleProperty:Nt,redLineVisibleProperty:K,verticesVisibleProperty:Ft,smallVertexProperty:Lt,redXsVisibleProperty:xt,redXsAlignedProperty:kt,faceValueStyleProperty:G,redLineStyleProperty:Ot,vertexStyleProperty:At,joinedLinesJoinProperty:It,joinedLinesCapProperty:Bt,safeSolverFactoryProperty:new _([Oe,Ae,Ie,Be],(p,r,e,t)=>Ze(p,r,e,t)),autoSolverFactoryProperty:_t,theme:$},oe=(p,r,e,t,o)=>{const n=Ze(p,r,e,t);return{faceColorsVisibleProperty:new ce(p),sectorsVisibleProperty:new ce(r),vertexStateVisibleProperty:new ce(e),faceStateVisibleProperty:new ce(t),safeSolverFactoryProperty:new fe(n),autoSolverFactoryProperty:o?new _([o],d=>(a,c,h)=>new ie([n(a,c,h),d(a,c,h)])):new fe(n)}},ae=new _([qt,Jt],(p,r)=>(e,t,o)=>new ie([new Zt(e,t,{solveJointToRed:!0,solveForcedLineToBlack:p,solveAlmostEmptyToRed:!0},o?void 0:[]),new zt(e,t,{solveToRed:!0,solveToBlack:p},o?void 0:[]),...r?[new Kt(e,t,{solveToRed:!0,solveToBlack:p,resolveAllRegions:!1},o?void 0:[])]:[]])),po=new _([ae],p=>(r,e,t)=>new ie([p(r,e,t),new Te(r,e,{solveToRed:!0,solveToBlack:!0})])),ze=new _([ae],p=>(r,e,t)=>new ie([p(r,e,t),new Gt(r,e,t?void 0:[])])),ho=new _([ze],p=>(r,e,t)=>new ie([p(r,e,t),new Te(r,e,{solveToRed:!0,solveToBlack:!0})])),uo=p=>({...oe(!0,!1,!1,!1,ae),theme:p,allowEdgeEditProperty:new s(!0),allowFaceColorEditProperty:new s(!1),allowSectorEditProperty:new s(!1),edgesVisibleProperty:new s(!0),edgesHaveColorsProperty:new s(!0),faceColorThresholdProperty:new s(Number.POSITIVE_INFINITY),sectorsNextToEdgesVisibleProperty:new s(!1),sectorsTrivialVisibleProperty:new s(!1),allVertexStateVisibleProperty:new s(!1),whiteLineVisibleProperty:new s(!0),redLineVisibleProperty:K,verticesVisibleProperty:new s(!1),smallVertexProperty:new s(!1),redXsVisibleProperty:new s(!1),redXsAlignedProperty:new s(!1),faceValueStyleProperty:G,redLineStyleProperty:new s("middle"),vertexStyleProperty:new s("round"),joinedLinesJoinProperty:new s("round"),joinedLinesCapProperty:new s("round")}),fo=p=>({...oe(!0,!1,!1,!1,po),theme:p,allowEdgeEditProperty:new s(!0),allowFaceColorEditProperty:new s(!0),allowSectorEditProperty:new s(!1),edgesVisibleProperty:new s(!0),edgesHaveColorsProperty:new s(!1),faceColorThresholdProperty:new s(2),sectorsNextToEdgesVisibleProperty:new s(!1),sectorsTrivialVisibleProperty:new s(!1),allVertexStateVisibleProperty:new s(!1),whiteLineVisibleProperty:new s(!0),redLineVisibleProperty:K,verticesVisibleProperty:new s(!1),smallVertexProperty:new s(!1),redXsVisibleProperty:new s(!1),redXsAlignedProperty:new s(!1),faceValueStyleProperty:G,redLineStyleProperty:new s("middle"),vertexStyleProperty:new s("round"),joinedLinesJoinProperty:new s("round"),joinedLinesCapProperty:new s("round")}),wo=p=>({...oe(!0,!1,!1,!1,new fe((r,e,t)=>new ie([new Te(r,e,{solveToRed:!0,solveToBlack:!0},t?void 0:[])]))),theme:p,allowEdgeEditProperty:new s(!1),allowFaceColorEditProperty:new s(!0),allowSectorEditProperty:new s(!1),edgesVisibleProperty:new s(!1),edgesHaveColorsProperty:new s(!1),faceColorThresholdProperty:new s(2),sectorsNextToEdgesVisibleProperty:new s(!1),sectorsTrivialVisibleProperty:new s(!1),allVertexStateVisibleProperty:new s(!1),whiteLineVisibleProperty:new s(!1),redLineVisibleProperty:K,verticesVisibleProperty:new s(!1),smallVertexProperty:new s(!1),redXsVisibleProperty:new s(!1),redXsAlignedProperty:new s(!1),faceValueStyleProperty:G,redLineStyleProperty:new s("middle"),vertexStyleProperty:new s("round"),joinedLinesJoinProperty:new s("round"),joinedLinesCapProperty:new s("round")}),go=p=>({...oe(!1,!1,!1,!1,ae),theme:p,allowEdgeEditProperty:new s(!0),allowFaceColorEditProperty:new s(!1),allowSectorEditProperty:new s(!1),edgesVisibleProperty:new s(!0),edgesHaveColorsProperty:new s(!1),faceColorThresholdProperty:new s(Number.POSITIVE_INFINITY),sectorsNextToEdgesVisibleProperty:new s(!1),sectorsTrivialVisibleProperty:new s(!1),allVertexStateVisibleProperty:new s(!1),whiteLineVisibleProperty:new s(!1),redLineVisibleProperty:K,verticesVisibleProperty:new s(!0),smallVertexProperty:new s(!1),redXsVisibleProperty:new s(!0),redXsAlignedProperty:new s(!1),faceValueStyleProperty:G,redLineStyleProperty:new s("middle"),vertexStyleProperty:new s("square"),joinedLinesJoinProperty:new s("miter"),joinedLinesCapProperty:new s("square")}),dr=p=>({...oe(!1,!0,!1,!1,ae),theme:p,allowEdgeEditProperty:new s(!0),allowFaceColorEditProperty:new s(!1),allowSectorEditProperty:new s(!0),edgesVisibleProperty:new s(!0),edgesHaveColorsProperty:new s(!1),faceColorThresholdProperty:new s(Number.POSITIVE_INFINITY),sectorsNextToEdgesVisibleProperty:new s(!1),sectorsTrivialVisibleProperty:new s(!1),allVertexStateVisibleProperty:new s(!1),whiteLineVisibleProperty:new s(!1),redLineVisibleProperty:K,verticesVisibleProperty:new s(!0),smallVertexProperty:new s(!1),redXsVisibleProperty:new s(!0),redXsAlignedProperty:new s(!1),faceValueStyleProperty:G,redLineStyleProperty:new s("middle"),vertexStyleProperty:new s("square"),joinedLinesJoinProperty:new s("miter"),joinedLinesCapProperty:new s("square")}),mo=p=>({...oe(!0,!0,!1,!1,ze),theme:p,allowEdgeEditProperty:new s(!0),allowFaceColorEditProperty:new s(!1),allowSectorEditProperty:new s(!0),edgesVisibleProperty:new s(!0),edgesHaveColorsProperty:new s(!0),faceColorThresholdProperty:new s(Number.POSITIVE_INFINITY),sectorsNextToEdgesVisibleProperty:new s(!1),sectorsTrivialVisibleProperty:new s(!1),allVertexStateVisibleProperty:new s(!1),whiteLineVisibleProperty:new s(!0),redLineVisibleProperty:K,verticesVisibleProperty:new s(!1),smallVertexProperty:new s(!1),redXsVisibleProperty:new s(!1),redXsAlignedProperty:new s(!1),faceValueStyleProperty:G,redLineStyleProperty:new s("middle"),vertexStyleProperty:new s("round"),joinedLinesJoinProperty:new s("round"),joinedLinesCapProperty:new s("round")}),yo=p=>({...oe(!0,!0,!1,!1,ho),theme:p,allowEdgeEditProperty:new s(!0),allowFaceColorEditProperty:new s(!0),allowSectorEditProperty:new s(!0),edgesVisibleProperty:new s(!0),edgesHaveColorsProperty:new s(!1),faceColorThresholdProperty:new s(2),sectorsNextToEdgesVisibleProperty:new s(!1),sectorsTrivialVisibleProperty:new s(!1),allVertexStateVisibleProperty:new s(!1),whiteLineVisibleProperty:new s(!0),redLineVisibleProperty:K,verticesVisibleProperty:new s(!1),smallVertexProperty:new s(!1),redXsVisibleProperty:new s(!1),redXsAlignedProperty:new s(!1),faceValueStyleProperty:G,redLineStyleProperty:new s("middle"),vertexStyleProperty:new s("round"),joinedLinesJoinProperty:new s("round"),joinedLinesCapProperty:new s("round")}),Co=p=>({...oe(!0,!1,!0,!1,ae),theme:p,allowEdgeEditProperty:new s(!0),allowFaceColorEditProperty:new s(!0),allowSectorEditProperty:new s(!1),edgesVisibleProperty:new s(!0),edgesHaveColorsProperty:new s(!1),faceColorThresholdProperty:new s(2),sectorsNextToEdgesVisibleProperty:new s(!1),sectorsTrivialVisibleProperty:new s(!1),allVertexStateVisibleProperty:new s(!1),whiteLineVisibleProperty:new s(!0),redLineVisibleProperty:K,verticesVisibleProperty:new s(!1),smallVertexProperty:new s(!1),redXsVisibleProperty:new s(!1),redXsAlignedProperty:new s(!1),faceValueStyleProperty:G,redLineStyleProperty:new s("middle"),vertexStyleProperty:new s("round"),joinedLinesJoinProperty:new s("round"),joinedLinesCapProperty:new s("round")}),Po=p=>({...oe(!0,!1,!1,!0,ae),theme:p,allowEdgeEditProperty:new s(!0),allowFaceColorEditProperty:new s(!0),allowSectorEditProperty:new s(!1),edgesVisibleProperty:new s(!0),edgesHaveColorsProperty:new s(!1),faceColorThresholdProperty:new s(2),sectorsNextToEdgesVisibleProperty:new s(!1),sectorsTrivialVisibleProperty:new s(!1),allVertexStateVisibleProperty:new s(!1),whiteLineVisibleProperty:new s(!0),redLineVisibleProperty:K,verticesVisibleProperty:new s(!1),smallVertexProperty:new s(!1),redXsVisibleProperty:new s(!1),redXsAlignedProperty:new s(!1),faceValueStyleProperty:G,redLineStyleProperty:new s("middle"),vertexStyleProperty:new s("round"),joinedLinesJoinProperty:new s("round"),joinedLinesCapProperty:new s("round")}),So=uo($),Eo=fo($),vo=wo($),Ke=go($),Vo=mo($),bo=yo($),To=Co($),No=Po($),Ee={basicLines:So,basicFaceColoring:Eo,pureFaceColor:vo,classic:Ke,basicSectors:Vo,sectorsWithColors:bo,vertexState:To,faceState:No,custom:co},Me=Ke,Fo=p=>({allowEdgeEditProperty:new F(p,{derive:"allowEdgeEditProperty"}),allowFaceColorEditProperty:new F(p,{derive:"allowFaceColorEditProperty"}),allowSectorEditProperty:new F(p,{derive:"allowSectorEditProperty"}),edgesVisibleProperty:new F(p,{derive:"edgesVisibleProperty"}),edgesHaveColorsProperty:new F(p,{derive:"edgesHaveColorsProperty"}),faceColorsVisibleProperty:new F(p,{derive:"faceColorsVisibleProperty"}),faceColorThresholdProperty:new F(p,{derive:"faceColorThresholdProperty"}),sectorsVisibleProperty:new F(p,{derive:"sectorsVisibleProperty"}),sectorsNextToEdgesVisibleProperty:new F(p,{derive:"sectorsNextToEdgesVisibleProperty"}),sectorsTrivialVisibleProperty:new F(p,{derive:"sectorsTrivialVisibleProperty"}),vertexStateVisibleProperty:new F(p,{derive:"vertexStateVisibleProperty"}),allVertexStateVisibleProperty:new F(p,{derive:"allVertexStateVisibleProperty"}),faceStateVisibleProperty:new F(p,{derive:"faceStateVisibleProperty"}),whiteLineVisibleProperty:new F(p,{derive:"whiteLineVisibleProperty"}),redLineVisibleProperty:new F(p,{derive:"redLineVisibleProperty"}),verticesVisibleProperty:new F(p,{derive:"verticesVisibleProperty"}),smallVertexProperty:new F(p,{derive:"smallVertexProperty"}),redXsVisibleProperty:new F(p,{derive:"redXsVisibleProperty"}),redXsAlignedProperty:new F(p,{derive:"redXsAlignedProperty"}),faceValueStyleProperty:new F(p,{derive:"faceValueStyleProperty"}),redLineStyleProperty:new F(p,{derive:"redLineStyleProperty"}),vertexStyleProperty:new F(p,{derive:"vertexStyleProperty"}),joinedLinesJoinProperty:new F(p,{derive:"joinedLinesJoinProperty"}),joinedLinesCapProperty:new F(p,{derive:"joinedLinesCapProperty"}),safeSolverFactoryProperty:new F(p,{derive:"safeSolverFactoryProperty"}),autoSolverFactoryProperty:new F(p,{derive:"autoSolverFactoryProperty"}),theme:Mt(new _([p],r=>r.theme))}),Lo=new dt("puzzleStyle",{serialize:p=>Object.keys(Ee).find(r=>Ee[r]===p),deserialize:p=>p?Ee[p]??Me:Me}),Q=Fo(Lo),pr=new Ve("showPuzzleStyleProperty",!0),hr=new Ve("showPuzzleTimerProperty",!1),O=class O extends Ye{constructor(r){super(),this.isEnabledProperty=r}};E(O,"EDGE_STATE",new O(Q.allowEdgeEditProperty)),E(O,"EDGE_STATE_REVERSED",new O(Q.allowEdgeEditProperty)),E(O,"FACE_COLOR_MATCH",new O(Q.allowFaceColorEditProperty)),E(O,"FACE_COLOR_OPPOSITE",new O(Q.allowFaceColorEditProperty)),E(O,"SECTOR_STATE",new O(Q.allowSectorEditProperty)),E(O,"VERTEX_STATE",new O(Q.vertexStateVisibleProperty)),E(O,"FACE_STATE",new O(Q.faceStateVisibleProperty)),E(O,"FACE_VALUE",new O(new ce(!1))),E(O,"DELETE_FACE",new O(new ce(!1))),E(O,"enumeration",new Ue(O));let Y=O;const re=new pt("editModeProperty",Y.EDGE_STATE);Y.enumeration.values.forEach(p=>{p.isEnabledProperty.lazyLink(r=>{if(!re.value.isEnabledProperty.value){const e=Y.enumeration.values.find(t=>t.isEnabledProperty.value)??null;e&&(re.value=e)}})});const ur=new Ve("eraserEnabledProperty",!1),fr=p=>{p.isEnabledProperty.value&&(re.value=p)},xo=new _([re],p=>p===Y.EDGE_STATE||p===Y.EDGE_STATE_REVERSED),Ge=new _([re],p=>p===Y.FACE_COLOR_MATCH||p===Y.FACE_COLOR_OPPOSITE),ko=new _([re],p=>p===Y.SECTOR_STATE),Oo=new _([re],p=>p===Y.VERTEX_STATE),Ao=new _([re,Ge],(p,r)=>r||p===Y.FACE_STATE||p===Y.FACE_VALUE||p===Y.DELETE_FACE),Io=(p,r,e)=>{const t=new pe({mouseButton:0,fire:d=>{var a;return e&&e(p,(a=d.domEvent)!=null&&a.shiftKey?2:0)}}),o=new pe({mouseButton:2,fire:d=>{var a;return e&&e(p,(a=d.domEvent)!=null&&a.shiftKey?0:2)}}),n=new pe({mouseButton:1,fire:d=>e&&e(p,1)});r.addInputListener(t),r.addInputListener(o),r.addInputListener(n),r.cursor="pointer",r.disposeEmitter.addListener(()=>{t.dispose(),o.dispose(),n.dispose()})};class Pe extends b{constructor(r,e,t,o){const n=Ce()({useBackgroundOffsetStroke:!1,backgroundOffsetDistance:.3,facePressListener:()=>{},noninteractive:!1},o);super({pickableProperty:Ge}),this.outerBoundary=r,this.innerBoundaries=e,this.style=t,!n.noninteractive&&Io(null,this,n.facePressListener);const d=r.map(m=>m.start.viewCoordinates),a=n.useBackgroundOffsetStroke,c=n.backgroundOffsetDistance,l=xe(d)>0?-c:c,i=m=>{const u=new ut;u.addShape(0,m),u.computeSimplifiedFaces(),u.computeFaceInclusion(P=>P[0]>0);const y=u.createFilledSubGraph(),w=y.facesToShape();return u.dispose(),y.dispose(),w},g=Pe.getOffsetBackgroundShape(r,a,c),f=e.map(m=>{const u=m.map(w=>w.start.viewCoordinates),y=N.polygon(u);if(a)return i(y.getOffsetShape(l));{const P=y.getStrokedShape(new ke({lineWidth:2*c})).subpaths.map(C=>new N([C]));return i(ve.minBy(P,C=>C.getArea()))}});this.children=[new D(g,{fill:t.theme.puzzleBackgroundColorProperty,stroke:t.theme.puzzleBackgroundStrokeColorProperty,lineWidth:.03}),...f.map(m=>new D(m,{fill:t.theme.playAreaBackgroundColorProperty,stroke:t.theme.puzzleBackgroundStrokeColorProperty,lineWidth:.03}))]}static getOffsetBackgroundShape(r,e,t){const o=r.map(c=>c.start.viewCoordinates),n=N.polygon(o),a=xe(o)>0?-t:t;if(e)return n.getOffsetShape(a).getSimplifiedAreaShape();{const c=n.getStrokedShape(new ke({lineWidth:2*t})),h=c.subpaths.map(l=>new N([l]));try{return c.bounds.width===9.718028227819117?N.bounds(c.bounds):ve.maxBy(h,l=>l.getArea()).getSimplifiedAreaShape()}catch{return N.bounds(c.bounds)}}}}class Bo extends b{constructor(e,t,o){super({pickable:!1,visibleProperty:o.edgesVisibleProperty});E(this,"simpleRegionNodeMap",new Map);E(this,"regionIdMap",new Map);E(this,"weirdEdgeNodeMap",new Map);E(this,"regionContainer",new b);E(this,"weirdEdgeContainer",new b);E(this,"adjacentFacesMap",new Map);this.board=e,this.style=o,e.faces.forEach(a=>{this.adjacentFacesMap.set(a,a.edges.map(c=>c.getOtherFace(a)).filter(c=>c!==null))}),this.children=[this.weirdEdgeContainer,this.regionContainer],t.value.getSimpleRegions().forEach(a=>this.addRegion(a)),t.value.getWeirdEdges().forEach(a=>this.addWeirdEdge(a)),this.updateHues();const n=(a,c)=>{const h=c.getSimpleRegions(),l=a.getSimpleRegions(),i=c.getWeirdEdges(),g=a.getWeirdEdges(),f=[],m=[];Je(h,l,f,m,[]);const y=new Set(f);for(const w of m)if(this.regionIdMap.has(w.id)){const P=this.regionIdMap.get(w.id);this.replaceRegion(P,w),y.delete(P)}else this.addRegion(w);for(const w of y)this.removeRegion(w);for(const w of i)g.includes(w)||this.removeWeirdEdge(w);for(const w of g)i.includes(w)||this.addWeirdEdge(w);(m.length||f.length)&&this.updateHues()};t.lazyLink(n),this.disposeEmitter.addListener(()=>t.unlink(n)),this.disposeEmitter.addListener(()=>{for(;this.simpleRegionNodeMap.size;)this.removeRegion(this.simpleRegionNodeMap.keys().next().value)});const d=()=>this.updateHues();o.theme.simpleRegionHueLUTProperty.link(d),o.edgesHaveColorsProperty.lazyLink(d),this.disposeEmitter.addListener(()=>{o.theme.simpleRegionHueLUTProperty.unlink(d),o.edgesHaveColorsProperty.unlink(d)})}addRegion(e){const t=new de(e,this.style);this.simpleRegionNodeMap.set(e,t),this.regionIdMap.set(e.id,e),this.regionContainer.addChild(t)}replaceRegion(e,t){M()&&R(e.id===t.id);const o=this.simpleRegionNodeMap.get(e);o.updateRegion(t),this.simpleRegionNodeMap.delete(e),this.simpleRegionNodeMap.set(t,o),this.regionIdMap.delete(e.id),this.regionIdMap.set(t.id,t)}removeRegion(e){const t=this.simpleRegionNodeMap.get(e);this.regionContainer.removeChild(t),this.simpleRegionNodeMap.delete(e),this.regionIdMap.delete(e.id),t.dispose()}addWeirdEdge(e){const t=e.start.viewCoordinates,o=e.end.viewCoordinates,n=new et(t.x,t.y,o.x,o.y,{lineWidth:.1,stroke:this.style.theme.edgeWeirdColorProperty,lineCap:"square"});this.weirdEdgeNodeMap.set(e,n),this.weirdEdgeContainer.addChild(n)}removeWeirdEdge(e){const t=this.weirdEdgeNodeMap.get(e);this.weirdEdgeContainer.removeChild(t),this.weirdEdgeNodeMap.delete(e)}updateHues(){const e=[...this.simpleRegionNodeMap.values()];if(e.length<2)return;const t=new j(0,0),o=()=>{for(const l of e)l.hueVector.getMagnitude()>1e-6?l.hueVector.normalize():l.hueVector.setXY(1,0)},n=new Map,d=[];this.board.faces.forEach(l=>{n.set(l,[])});for(const l of e){const i=new Set;for(const f of l.simpleRegion.edges)for(const m of f.faces)i.add(m);const g=new Set;for(const f of i){g.add(f);for(const m of this.adjacentFacesMap.get(f))g.add(m)}for(const f of g){const m=n.get(f);if(m.length)for(const u of m){let y=!1;for(const w of d)if(w.a===u&&w.b===l){w.weight++,y=!0;break}y||d.push({a:u,b:l,weight:1})}m.push(l)}}const a=new Map;for(const l of e)a.set(l,j.ZERO.copy());const c=(l,i,g)=>{const f=a.get(l),m=a.get(i),u=l.hueVector.dot(i.hueVector),y=t.set(i.hueVector).subtract(l.hueVector);if(y.magnitude>1e-9){y.normalize();const w=.3,P=g*((Math.max(w,u)-w)/(1-w))**3;y.multiplyScalar(P),f.subtract(y),m.add(y)}};let h=1;for(let l=0;l<100;l++){h*=.99;for(const i of e)a.get(i).setXY(0,0);for(const i of d){const g=i.a,f=i.b,m=i.weight;c(g,f,m)}if(e.length<8)for(let i=0;i<e.length;i++){const g=e[i];for(let f=i+1;f<e.length;f++)c(g,e[f],.2)}for(const i of e){const g=a.get(i);g.multiplyScalar(h/i.edgeCount),i.hueVector.add(g),a.get(i).setXY(0,0)}o()}for(const l of e)l.updateHue()}}class de extends D{constructor(e,t){const o=j.createPolar(1,ye.nextDoubleBetween(0,2*Math.PI));super(de.toShape(e),{stroke:de.hueVectorToPaint(o,t),lineWidth:.1,lineCap:"square",lineJoin:"round"});E(this,"hueVector");E(this,"edgeCount");this.simpleRegion=e,this.style=t,this.hueVector=o,this.edgeCount=e.edges.length;const n=a=>{this.lineJoin=a};t.joinedLinesJoinProperty.link(n),this.disposeEmitter.addListener(()=>t.joinedLinesJoinProperty.unlink(n));const d=a=>{this.lineCap=a};t.joinedLinesCapProperty.link(d),this.disposeEmitter.addListener(()=>t.joinedLinesCapProperty.unlink(d))}updateHue(){this.stroke=de.hueVectorToPaint(this.hueVector.getMagnitude()>1e-6?this.hueVector:j.X_UNIT,this.style)}updateRegion(e){this.simpleRegion=e,this.shape=de.toShape(e),this.edgeCount=e.edges.length}static hueVectorToPaint(e,t){const o=t.theme.simpleRegionHueLUTProperty.value,n=(Math.round(e.getAngle()*180/Math.PI)+360)%360;return M()&&R(n>=0&&n<o.length),t.edgesHaveColorsProperty.value?o[n]:t.theme.blackLineColorProperty}static toShape(e){const t=new N;let o=!0;for(const n of e.halfEdges)o&&(o=!1,t.moveToPoint(n.start.viewCoordinates)),t.lineToPoint(n.end.viewCoordinates);return e.isSolved&&t.close(),t.makeImmutable()}}class Mo extends b{constructor(e,t,o){const n=new b;super({pickable:!1,children:[n]});E(this,"faceColorNodeMap",new Map);E(this,"faceColorIdMap",new Map);E(this,"adjacentFacesMap",new Map);E(this,"faceColorNodeContainer");E(this,"dualColorViews",new Set);this.board=e,this.stateProperty=t,this.style=o,this.faceColorNodeContainer=n,e.faces.forEach(h=>{this.adjacentFacesMap.set(h,h.edges.map(l=>l.getOtherFace(h)).filter(l=>l!==null))});{const h=t.value.getFaceColors();for(const l of h)this.addFaceColor(l,t.value.getFacesWithColor(l));this.addDualColorViews(t.value,h)}this.updateHues();let d=t.value.clone();const a=h=>{const l=d;d=h.clone();const i=l.getFaceColors(),g=h.getFaceColors(),f=[],m=[],u=[];Je(i,g,f,m,u);const y=new Set(f),w=this.removeInvalidDualColorViews(h),P=[...w];for(const C of m)if(w.add(C),this.faceColorIdMap.has(C.id)){const S=this.faceColorIdMap.get(C.id);this.replaceFaceColor(S,C,h.getFacesWithColor(C)),y.delete(S)}else this.addFaceColor(C,h.getFacesWithColor(C));for(const C of u)this.updateFaceColor(C,h.getFacesWithColor(C));for(const C of y)w.delete(C),this.removeFaceColor(C);this.addDualColorViews(h,[...w]),(m.length||f.length||P.length)&&this.updateHues()};t.lazyLink(a),this.disposeEmitter.addListener(()=>t.unlink(a)),this.disposeEmitter.addListener(()=>{for(;this.faceColorNodeMap.size;)this.removeFaceColor(this.faceColorNodeMap.keys().next().value)});const c=()=>this.updateHues();o.theme.faceColorBasicHueLUTProperty.lazyLink(c),o.theme.faceColorLightHueLUTProperty.lazyLink(c),o.theme.faceColorDarkHueLUTProperty.lazyLink(c),o.theme.faceColorInsideColorProperty.lazyLink(c),o.theme.faceColorOutsideColorProperty.lazyLink(c),o.theme.faceColorDefaultColorProperty.lazyLink(c),o.faceColorThresholdProperty.lazyLink(c),this.updateHues(),this.disposeEmitter.addListener(()=>{o.theme.faceColorBasicHueLUTProperty.unlink(c),o.theme.faceColorLightHueLUTProperty.unlink(c),o.theme.faceColorDarkHueLUTProperty.unlink(c),o.theme.faceColorInsideColorProperty.unlink(c),o.theme.faceColorOutsideColorProperty.unlink(c),o.theme.faceColorDefaultColorProperty.unlink(c),o.faceColorThresholdProperty.unlink(c)})}addFaceColor(e,t){const o=new ue(e,t,this.style);this.faceColorNodeMap.set(e,o),this.faceColorIdMap.set(e.id,e),this.faceColorNodeContainer.addChild(o)}replaceFaceColor(e,t,o){M()&&R(e.id===t.id);const n=this.faceColorNodeMap.get(e);n.updateFaceColor(t,o),this.faceColorNodeMap.delete(e),this.faceColorNodeMap.set(t,n),this.faceColorIdMap.delete(e.id),this.faceColorIdMap.set(t.id,t)}updateFaceColor(e,t){const o=this.faceColorNodeMap.get(e);let n=o.faces.length!==t.length;if(!n)for(let d=0;d<t.length;d++){const a=o.faces[d],c=t[d];if(a!==c){n=!0;break}}n&&o.updateFaceColor(e,t)}removeFaceColor(e){const t=this.faceColorNodeMap.get(e);this.faceColorNodeContainer.removeChild(t),this.faceColorNodeMap.delete(e),this.faceColorIdMap.delete(e.id),t.dispose()}addDualColorViews(e,t){const o=new Set(t);for(;o.size;){const n=o.values().next().value;o.delete(n);const d=this.faceColorNodeMap.get(n);M()&&R(d);const a=e.getOppositeFaceColor(n);if(a){M()&&R(o.has(a)),o.delete(a);const c=this.faceColorNodeMap.get(a);M()&&R(c),this.dualColorViews.add(new Re([d,c],this.style))}else this.dualColorViews.add(new Re([d],this.style))}}removeInvalidDualColorViews(e){const t=new Set,o=new Set(e.getFaceColors());for(const n of[...this.dualColorViews])if(!n.isStillValidInState(this.stateProperty.value,o)){for(const d of n.colorNodes)t.add(d.faceColor);this.dualColorViews.delete(n),n.dispose()}return t}updateHues(){const e=[...this.dualColorViews].filter(t=>t.colorNodes[0].faceColor.colorState!==he.UNDECIDED&&this.style.theme.faceColorOutsideColorProperty.value.alpha===1&&this.style.theme.faceColorInsideColorProperty.value.alpha===1?!1:t.faceCount>=this.style.faceColorThresholdProperty.value);if(e.length>=2){const t=new j(0,0),o=()=>{for(const l of e)l.hueVector.getMagnitude()>1e-6?l.hueVector.normalize():l.hueVector.setXY(ye.nextDouble()-.5,ye.nextDouble()-.5).normalize()},n=new Map,d=[];this.board.faces.forEach(l=>{n.set(l,[])});for(const l of e){const i=new Set;for(const f of l.faces)i.add(f);const g=new Set;for(const f of i){g.add(f);for(const m of this.adjacentFacesMap.get(f))g.add(m)}for(const f of g){const m=n.get(f);if(m){if(m.length)for(const u of m){let y=!1;for(const w of d)if(w.a===u&&w.b===l){w.weight++,y=!0;break}y||d.push({a:u,b:l,weight:1})}m.push(l)}}}const a=new Map;for(const l of e)a.set(l,j.ZERO.copy());const c=(l,i,g)=>{const f=a.get(l),m=a.get(i),u=l.hueVector.dot(i.hueVector),y=t.set(i.hueVector).subtract(l.hueVector);y.magnitudeSquared>1e-11&&y.normalize();const w=.2,P=Math.abs(u),C=g*((Math.max(w,P)-w)/(1-w))**3;y.multiplyScalar(C),f.subtract(y),m.add(y)};let h=1;for(let l=0;l<100;l++){h*=.99;for(const i of e)a.get(i).setXY(0,0);for(const i of d){const g=i.a,f=i.b,m=i.weight;c(g,f,m)}if(e.length<8)for(let i=0;i<e.length;i++){const g=e[i];for(let f=i+1;f<e.length;f++)c(g,e[f],.2)}for(const i of e){const g=a.get(i);g.multiplyScalar(h/i.faceCount),i.hueVector.add(g),a.get(i).setXY(0,0)}o()}}for(const t of this.dualColorViews)t.updateHue()}}const z=class z extends Ye{};E(z,"BASIC",new z),E(z,"PRIMARY",new z),E(z,"SECONDARY",new z),E(z,"enumeration",new Ue(z));let q=z;class Re{constructor(r,e){E(this,"hueVector");E(this,"faceCount");if(this.colorNodes=r,this.style=e,M()&&R(r.length===1||r.length===2),this.faceCount=ve.sum(this.colorNodes.map(t=>t.faceCount)),r.forEach(t=>{t.dualColorView=this}),r.length===1)r[0].type=q.BASIC,this.hueVector=r[0].hueVector.copy();else{const t=r[0].faceCount>r[1].faceCount?r[0]:r[1],o=t===r[0]?r[1]:r[0];let n;t.type===q.PRIMARY?n=t:o.type===q.PRIMARY||t.type===q.SECONDARY?n=o:(o.type,q.SECONDARY,n=t);const d=n===t?o:t;this.hueVector=t.hueVector.copy(),n.type=q.PRIMARY,d.type=q.SECONDARY}}get faces(){return this.colorNodes.flatMap(r=>r.faces)}isStillValidInState(r,e){for(const t of this.colorNodes)if(!e.has(t.faceColor))return!1;return this.colorNodes.length===1?r.getOppositeFaceColor(this.colorNodes[0].faceColor)===null:r.getOppositeFaceColor(this.colorNodes[0].faceColor)===this.colorNodes[1].faceColor}updateHue(){for(const r of this.colorNodes)r.hueVector.set(this.hueVector),r.updateHue(this.faceCount>=this.style.faceColorThresholdProperty.value)}dispose(){for(const r of this.colorNodes)r.dualColorView=null}}class ue extends D{constructor(e,t,o){const n=j.createPolar(1,ye.nextDoubleBetween(0,2*Math.PI));super(ue.toShape(t));E(this,"hueVector");E(this,"faceCount");E(this,"dualColorView",null);E(this,"type",q.BASIC);this.faceColor=e,this.faces=t,this.style=o,this.hueVector=n,this.faceCount=t.length}updateHue(e){e||this.faceColor.colorState!==he.UNDECIDED?this.fill=ue.hueVectorToPaint(this.hueVector.getMagnitude()>1e-6?this.hueVector:j.X_UNIT,this.faceColor.colorState,this.type,this.style):this.fill=this.style.theme.faceColorDefaultColorProperty}updateFaceColor(e,t){const o=t.length-this.faceCount;this.faceColor=e,this.faces=t,this.shape=ue.toShape(t),this.faceCount=t.length,this.dualColorView&&(this.dualColorView.faceCount+=o)}static hueVectorToPaint(e,t,o,n){const d=o===q.BASIC?n.theme.faceColorBasicHueLUTProperty.value:o===q.PRIMARY?n.theme.faceColorLightHueLUTProperty.value:n.theme.faceColorDarkHueLUTProperty.value,a=(Math.round(e.getAngle()*180/Math.PI)+360)%360;M()&&R(a>=0&&a<d.length);const c=d[a];if(t===he.UNDECIDED)return c;{const l=(t===he.INSIDE?n.theme.faceColorInsideColorProperty:n.theme.faceColorOutsideColorProperty).value,i=l.alpha,g=new Fe(c);return new Fe((1-i)*g.red+i*l.red,(1-i)*g.green+i*l.green,(1-i)*g.blue+i*l.blue).toCSS()}}static toShape(e){const t=new N;for(const o of e)t.polygon(o.vertices.map(n=>n.viewCoordinates));return t.makeImmutable()}}class Ro extends b{constructor(r,e,t,o){let n=[];try{let d=new N;for(const c of r.faces)d.polygon(c.vertices.map(h=>h.viewCoordinates));if(r.faceColor.colorState===he.OUTSIDE)try{const c=N.polygon(e.outerBoundary.map(i=>i.start.viewCoordinates)),l=Pe.getOffsetBackgroundShape(e.outerBoundary,o.useBackgroundOffsetStroke,o.backgroundOffsetDistance).shapeDifference(c);d=d.shapeUnion(l)}catch(c){console.error(c)}const a=new D(d.getOffsetShape(-.07).getSimplifiedAreaShape(),{stroke:t.theme.selectedFaceColorHighlightColorProperty,lineWidth:.03});n.push(a)}catch(d){console.error(d)}super({children:n}),this.selectedFaceColorHighlight=r}}class ee extends b{static getSectorBaseShape(r,e){const t=r.start.viewCoordinates,o=r.end.viewCoordinates,n=r.next.end.viewCoordinates,d=t.minus(o),a=n.minus(o),c=d.normalized(),l=a.normalized().minus(c).angle+Math.PI/2,i=r.face?r.face.viewCoordinates:j.createPolar(e,l).plus(o),g=t.average(o),f=n.average(o);return N.polygon([g,o,f,i]).makeImmutable()}static getSectorArcShape(r,e){const t=r.start.viewCoordinates,o=r.end.viewCoordinates,n=r.next.end.viewCoordinates,d=t.minus(o),a=n.minus(o),c=d.normalized(),h=d.angle;let l=a.angle;return l<h&&(l+=2*Math.PI),new N().moveToPoint(o).lineToPoint(c.timesScalar(e).plus(o)).arcPoint(o,e,h,l,!0).close().makeImmutable()}static getStrokeFromStyle(r,e){return r===V.ONLY_ONE?e.theme.sectorOnlyOneColorProperty:r===V.NOT_ZERO?e.theme.sectorNotZeroColorProperty:r===V.NOT_ONE?e.theme.sectorNotOneColorProperty:r===V.NOT_TWO?e.theme.sectorNotTwoColorProperty:e.theme.sectorOtherColorProperty}}E(ee,"nameMap",new Map([[V.NONE,"Invalid"],[V.ONLY_ZERO,"No Lines"],[V.ONLY_ONE,"Only One Line"],[V.ONLY_TWO,"Both Lines"],[V.NOT_ZERO,"At Least One Line"],[V.NOT_ONE,"Zero or Two Lines"],[V.NOT_TWO,"Less Than Two Lines"],[V.ANY,"Any Lines"]]));class Do extends b{constructor(r,e,t,o){const n=[],d=[],a=r.sector,c=r.currentState,h=ee.getSectorArcShape(a,.5),l=new D(h.getOffsetShape(.05),{stroke:t.theme.selectedSectorEditColorProperty,lineWidth:.02});n.push(l);const i=[];if(c===V.ANY&&(i.push(V.NOT_ZERO),i.push(V.NOT_ONE),i.push(V.NOT_TWO)),c.one&&c!==V.ONLY_ONE&&i.push(V.ONLY_ONE),i.length){const g=i.map(u=>{const y=ee.getStrokeFromStyle(u,t);return new ht({accessibleName:ee.nameMap.get(u),content:new tt(0,0,25,25),listener:()=>{o.sectorSetListener&&o.sectorSetListener(a,u)},buttonAppearanceStrategy:Rt,baseColor:y,xMargin:10.4,yMargin:6.5,mouseAreaXDilation:5,mouseAreaYDilation:5,touchAreaXDilation:5,touchAreaYDilation:5})});d.push(...g);const f=new qe(new We({children:g,spacing:10}),{xMargin:10,yMargin:10,fill:t.theme.uiBackgroundColorProperty,stroke:t.theme.uiForegroundColorProperty,scale:.01});d.push(f);const m=.1;n.push(f),f.centerBottom=l.centerTop.plusXY(0,-.15),f.top<e.top+m&&(f.centerTop=l.centerBottom.plusXY(0,.15)),f.left<e.left+m&&(f.left=e.left+m),f.right>e.right-m&&(f.right=e.right-m)}super({children:n}),this.selectedSectorEdit=r,this.disposeEmitter.addListener(()=>{d.forEach(g=>g.dispose())})}}class Ho extends b{constructor(r,e,t,o){const n=new D(null,{lineWidth:.02,stroke:o.theme.whiteLineColorProperty}),d=new D(null,{stroke:o.theme.xColorProperty,lineWidth:.025}),a=new D(null,{lineWidth:.02,fill:o.theme.redLineColorProperty});super({children:[n,d,a],pickable:!1});const c=r.edges.map(u=>W.BLACK);let h=!1,l=!1,i=!1,g=!1,f=null;const m=te.multilink([e,t,o.whiteLineVisibleProperty,o.redXsVisibleProperty,o.redXsAlignedProperty,o.redLineVisibleProperty,o.redLineStyleProperty],(u,y,w,P,C,S,x)=>{if(this.visible=!y,n.visible=w,d.visible=P,a.visible=S,this.visible){let T=!1;for(let v=0;v<r.edges.length;v++){const k=u.getEdgeState(r.edges[v]);k!==c[v]&&(T=!0,c[v]=k)}if(h!==C&&(T=!0,h=C),l!==w&&(T=!0,l=w),i!==P&&(T=!0,i=P),g!==S&&(T=!0,g=S),f!==x&&(T=!0,f=x),T){const v=new N,k=new N,J=new N;for(let B=0;B<r.edges.length;B++){const se=c[B];if(w&&se===W.WHITE){const A=r.edges[B];v.moveTo(A.start.viewCoordinates.x,A.start.viewCoordinates.y),v.lineTo(A.end.viewCoordinates.x,A.end.viewCoordinates.y)}if(se===W.RED){if(P){const A=r.edges[B],L=.07;let I=A.start.viewCoordinates.blend(A.end.viewCoordinates,.5);if(C){const X=A.end.viewCoordinates.minus(A.start.viewCoordinates).getAngle(),H=new j(-L,-L).rotate(X).add(I),U=new j(L,L).rotate(X).add(I),Z=new j(-L,L).rotate(X).add(I),ne=new j(L,-L).rotate(X).add(I);k.moveTo(H.x,H.y),k.lineTo(U.x,U.y),k.moveTo(Z.x,Z.y),k.lineTo(ne.x,ne.y)}else k.moveTo(I.x-L,I.y-L),k.lineTo(I.x+L,I.y+L),k.moveTo(I.x-L,I.y+L),k.lineTo(I.x+L,I.y-L)}if(S){const A=r.edges[B],L=.4,I=.017,X=A.start.viewCoordinates.blend(A.end.viewCoordinates,.5),H=X.blend(A.start.viewCoordinates,L),U=X.blend(A.end.viewCoordinates,L);for(let Z=0;Z<5;Z++){const ne=H.blend(U,Z/4);J.moveTo(ne.x+I,ne.y),J.arc(ne.x,ne.y,I,0,2*Math.PI,!1)}}}}v.makeImmutable(),k.makeImmutable(),J.makeImmutable(),n.shape=v,d.shape=k,a.shape=J}}});this.disposeEmitter.addListener(()=>m.dispose())}}class Ne extends b{constructor(r,e,t){super();const o=new N,n=r.map(i=>{const g=e(i);return g.makeImmutable(),o.subpaths.push(...g.subpaths),g});this.mouseArea=this.touchArea=o.makeImmutable();const d=i=>{const g=i.trail.globalToLocalPoint(i.pointer.point);for(let f=0;f<n.length;f++){const m=n[f];if(m.bounds.containsPoint(g)&&m.containsPoint(g))return r[f]}return null},a=(i,g)=>{const f=d(i);f&&t(f,g)},c=new pe({mouseButton:0,fire:i=>{var g;return a(i,(g=i.domEvent)!=null&&g.shiftKey?2:0)}}),h=new pe({mouseButton:2,fire:i=>{var g;return a(i,(g=i.domEvent)!=null&&g.shiftKey?0:2)}}),l=new pe({mouseButton:1,fire:i=>a(i,1)});this.addInputListener(c),this.addInputListener(h),this.addInputListener(l),this.cursor="pointer",this.disposeEmitter.addListener(()=>{c.dispose(),h.dispose(),l.dispose()})}}class Wo extends Ne{constructor(r,e){super(r.edges,t=>{const o=t.start.viewCoordinates,n=t.end.viewCoordinates,d=new N;let a;if(t.faces.length===2)a=[o,t.faces[0].viewCoordinates,n,t.faces[1].viewCoordinates];else{M()&&R(t.faces.length===1,"EdgeNode only supports edges with 1 or 2 faces");const c=t.forwardHalf.face===null?t.forwardHalf:t.reversedHalf;M()&&R(c.previous.face===null),M()&&R(c.next.face===null);const h=c.start.viewCoordinates,l=c.end.viewCoordinates,i=c.previous.start.viewCoordinates,g=c.next.end.viewCoordinates,f=(y,w,P)=>{const C=w.minus(y).normalized(),S=P.minus(w).normalized();let x=C.minus(S);return x.getMagnitude()<1e-6?x=C.getPerpendicular():x=x.normalized(),lt.triangleAreaSigned(y,w,w.plus(x))<0&&(x=x.negated()),x},m=f(i,h,l),u=f(h,l,g);a=[h,t.faces[0].viewCoordinates,l,l.plus(u.times(e.backgroundOffsetDistance)),h.plus(m.times(e.backgroundOffsetDistance))]}return d.polygon(a),d.makeImmutable(),d},e.edgePressListener)}}const De=[.02,.02],le=.2,ge=.02;class jo extends b{constructor(r,e,t){const o=new D(null,{lineWidth:.025,lineCap:"butt",stroke:ee.getStrokeFromStyle(V.NOT_ZERO,t)}),n=new D(null,{lineWidth:.025,lineCap:"butt",stroke:ee.getStrokeFromStyle(V.NOT_ONE,t)}),d=new D(null,{lineWidth:.025,lineCap:"butt",stroke:ee.getStrokeFromStyle(V.NOT_TWO,t)}),a=new D(null,{lineWidth:.025,lineCap:"butt",stroke:ee.getStrokeFromStyle(V.ONLY_ONE,t)});super({pickable:!1,visibleProperty:t.sectorsVisibleProperty,children:[o,n,d,a]}),this.board=r;const c=r.halfEdges.map(i=>V.NONE),h=r.edges.map(i=>W.BLACK),l=te.multilink([e,t.sectorsVisibleProperty],(i,g)=>{if(g){let f=!1;for(let m=0;m<r.halfEdges.length;m++){const u=i.getSectorState(r.halfEdges[m]);u!==c[m]&&(f=!0,c[m]=u)}for(let m=0;m<r.edges.length;m++){const u=i.getEdgeState(r.edges[m]);u!==h[m]&&(f=!0,h[m]=u)}if(f){const m=new N,u=new N,y=new N,w=new N;for(let P=0;P<r.halfEdges.length;P++){const C=c[P];if(C!==V.NOT_ZERO&&C!==V.NOT_ONE&&C!==V.NOT_TWO&&C!==V.ONLY_ONE)continue;const S=r.halfEdges[P],x=i.getEdgeState(S.edge),T=i.getEdgeState(S.next.edge);if(x!==W.WHITE||T!==W.WHITE)continue;if(C===V.NOT_ONE){const H=S.end.edges.filter(Z=>i.getEdgeState(Z)===W.BLACK),U=S.end.edges.filter(Z=>i.getEdgeState(Z)===W.WHITE);if(H.length===0&&U.length===2)continue}const v=S.start.viewCoordinates,k=S.end.viewCoordinates,J=S.next.end.viewCoordinates,B=v.minus(k),se=J.minus(k),A=B.normalized(),L=B.angle;let I=se.angle;I<L&&(I+=2*Math.PI);const X=(H,U)=>(H.moveToPoint(A.timesScalar(U).add(k)),H.arcPoint(k,U,L,I,!0),H);if(C===V.ONLY_ONE)X(w,le);else if(C===V.NOT_ONE)X(u,le-ge),X(u,le+ge);else if(C===V.NOT_ZERO){const H=new N;X(H,le-ge),X(H,le+ge);const U=H.getDashedShape(De,0);m.subpaths.push(...U.subpaths)}else if(C===V.NOT_TWO){const H=new N;X(H,le);const U=H.getDashedShape(De,0);y.subpaths.push(...U.subpaths)}}o.shape=m.makeImmutable(),n.shape=u.makeImmutable(),d.shape=y.makeImmutable(),a.shape=w.makeImmutable()}}});this.disposeEmitter.addListener(()=>l.dispose())}}class Xo extends Ne{constructor(r,e){super(r.halfEdges,t=>ee.getSectorBaseShape(t,e.backgroundOffsetDistance),e.sectorPressListener)}}class Yo extends je{constructor(r,e){const t=Ce()({font:Dt,fill:$.uiForegroundColorProperty},e);super(r,t)}}class Uo extends b{constructor(r,e,t){super({translation:r.viewCoordinates}),this.face=r;const n=e.value.getFaceState(r),d=n.possibilityCount===0||n.possibilityCount>9;let a;const c=n.possibilityCount===1?t.theme.faceValueCompletedColorProperty:t.theme.faceValueColorProperty;if(d)a=new Yo(n.possibilityCount,{font:be,maxWidth:.4,maxHeight:.4});else{const h=new Set(r.vertices);a=new ot({spacing:1.5,autoColumns:Math.ceil(Math.sqrt(n.possibilityCount)),children:n.getAllowedCombinations().map(l=>{const i=new b,g=new Set(l.map(u=>u.start)),f=new Set(l.map(u=>u.end)),m=u=>u.minus(r.viewCoordinates);if(i.addChild(new D(N.polygon(r.vertices.map(u=>m(u.viewCoordinates))),{stroke:c,lineWidth:.03,opacity:.2})),g.size){const u=new N;if(l.length===r.edges.length)u.polygon(r.vertices.map(y=>m(y.viewCoordinates)));else{const y=new Set(l);for(;y.size;){const w=[...h].find(S=>[...y].filter(x=>x.start===S||x.end===S).length===1);M()&&R(w);let P=w,C=[...y].find(S=>S.start===P||S.end===P)??null;for(u.moveToPoint(m(P.viewCoordinates));C;)y.delete(C),P=C.getOtherVertex(P),u.lineToPoint(m(P.viewCoordinates)),C=[...y].find(S=>S.start===P||S.end===P)??null}}i.addChild(new D(u,{stroke:c,lineWidth:.15,lineCap:"round",lineJoin:"round"}))}for(const u of r.vertices)!g.has(u)&&!f.has(u)&&i.addChild(new Xe(.1,{fill:c,translation:m(u.viewCoordinates)}));return i}),maxWidth:.6,maxHeight:.6})}a.center=j.ZERO,this.addChild(a)}}class _o extends b{constructor(r,e,t,o){super({pickable:!1});const n=te.multilink([e,o.faceStateVisibleProperty],(a,c)=>{this.children.forEach(h=>h.dispose()),this.children=[],c&&r.faces.forEach(h=>{this.addChild(new Uo(h,e,o))})});this.disposeEmitter.addListener(()=>n.dispose());const d=a=>{this.visible=!a};t.link(d),this.disposeEmitter.addListener(()=>{t.unlink(d),this.children.forEach(a=>a.dispose())})}}class qo extends Ne{constructor(r,e){super(r.faces,t=>t?N.polygon(t.vertices.map(o=>o.viewCoordinates)):new N,e.facePressListener)}}class Jo extends b{constructor(r,e,t,o){super({pickable:!1}),this.board=r;const n=r.faces.map(h=>null),d=()=>{const h=[],l=t.faceValueStyleProperty.value,i=t.theme.faceValueColorProperty.value,g=t.theme.faceValueCompletedColorProperty.value,f=t.theme.faceValueErrorColorProperty.value,m=t.theme.faceValueRatioColorProperty.value,u=t.faceStateVisibleProperty.value;this.visible=!u;for(let y=0;y<r.faces.length;y++){const w=n[y];if(w!==null){const P=r.faces[y],C=new rt("",_e({subScale:.7},o==null?void 0:o.textOptions)),S=te.multilink([e],x=>{let T,v,k=!1,J=!1;if(w===null)T="",v=null;else{let B=0,se=0;for(const A of P.edges){const L=x.getEdgeState(A);L===W.BLACK?B++:L===W.WHITE&&se++}if(l==="static"||w===0)T=`${w}`;else if(l==="remaining")T=`${w-B}`,k=B>0;else if(l==="ratio")w-B===0?T="0":(T=`${w-B}<sub style="color: ${m.toCSS()};">/<sub>${se}</sub></sub>`,J=!0),k=B>0;else throw new Error(`unhandled faceValueStyle: ${l}`);B<w?v=i:B===w?v=g:v=f}C.string=T,C.fill=v,C.maxWidth=J?.8:.9,C.maxHeight=J?.8:.9,C.center=P.viewCoordinates});C.disposeEmitter.addListener(()=>S.dispose()),h.push(C)}}this.children.forEach(y=>y.dispose()),this.children=h},a=te.multilink([e],h=>{let l=!1;for(let i=0;i<r.faces.length;i++){const g=h.getFaceValue(r.faces[i]);g!==n[i]&&(l=!0,n[i]=g)}l&&d()}),c=te.multilinkAny([t.faceValueStyleProperty,t.theme.faceValueColorProperty,t.theme.faceValueCompletedColorProperty,t.theme.faceValueErrorColorProperty,t.theme.faceValueRatioColorProperty,t.faceStateVisibleProperty],d);this.disposeEmitter.addListener(()=>{a.dispose(),c.dispose(),this.children.forEach(h=>h.dispose())})}}class Zo extends b{constructor(r,e,t){super({pickable:!1}),this.vertex=r;const o=.12,d=r.edges.map(f=>f.getOtherVertex(r).viewCoordinates.minus(r.viewCoordinates).normalized()).map(f=>f.times(o)),c=N.polygon(ct.grahamScan([j.ZERO,...d],!1)).getOffsetShape(-.05),h=new D(null,{stroke:t.theme.vertexStateLineProperty,lineWidth:.01}),l=new D(c,{translation:r.viewCoordinates,fill:t.theme.vertexStateBackgroundProperty,stroke:t.theme.vertexStateOutlineProperty,lineWidth:.01,children:[h,...d.map(f=>new Xe({radius:.02,translation:f,fill:t.theme.vertexStatePointProperty}))]});let i=null;const g=te.multilink([e,t.vertexStateVisibleProperty,t.allVertexStateVisibleProperty],(f,m,u)=>{const y=()=>{this.children=[]};if(!m){y();return}const w=f.getVertexState(r);if(!u){let P=!1,C=!1;const S=new Set;for(const T of r.edges){const v=f.getEdgeState(T);P=P||v===W.BLACK,C=C||v===W.WHITE,v===W.WHITE&&S.add(T)}if(P||!C){y();return}if(st.fromLookup(r,(T,v)=>S.has(T)&&S.has(v),!0).equals(w)){y();return}}if(!i||!i.equals(w)){i=w;const P=new N;for(const C of w.getAllowedPairs()){const S=x=>x.getOtherVertex(r).viewCoordinates.minus(r.viewCoordinates).normalized().times(o);P.moveToPoint(S(C[0])),P.lineToPoint(S(C[1]))}w.allowsEmpty()&&(P.moveTo(.03,0),P.circle(j.ZERO,.03),P.close()),P.makeImmutable(),h.shape=P}this.children=[l]});this.disposeEmitter.addListener(()=>g.dispose())}}class zo extends b{constructor(r,e,t,o){super({pickable:!1});const n=te.multilink([e,o.vertexStateVisibleProperty],(a,c)=>{this.children.forEach(h=>h.dispose()),this.children=[],c&&r.vertices.forEach(h=>{this.addChild(new Zo(h,e,o))})});this.disposeEmitter.addListener(()=>n.dispose());const d=a=>{this.visible=!a};t.link(d),this.disposeEmitter.addListener(()=>{t.unlink(d),this.children.forEach(a=>a.dispose())})}}const Ko=.03,Go=.05;class $o extends D{constructor(r,e,t,o){super(null,{pickable:!1,fill:o.theme.vertexColorProperty});const n=r.edges.map(h=>W.BLACK);let d=o.vertexStyleProperty.value,a=o.smallVertexProperty.value;const c=te.multilink([e,t,o.verticesVisibleProperty,o.vertexStyleProperty,o.smallVertexProperty],(h,l,i,g,f)=>{if(this.visible=!l&&i,this.visible){let m=!1;for(let u=0;u<r.edges.length;u++){const y=h.getEdgeState(r.edges[u]);y!==n[u]&&(m=!0,n[u]=y)}if(d!==g&&(d=g,m=!0),a!==f&&(a=f,m=!0),m){const u=new N;for(let y=0;y<r.vertices.length;y++){const w=r.vertices[y];if(w.edges.every(P=>h.getEdgeState(P)!==W.BLACK)){const P=w.viewCoordinates,C=f?Ko:Go;g==="round"?(u.moveTo(P.x+C,P.y),u.arc(P.x,P.y,C,0,2*Math.PI,!1)):g==="square"?u.rect(P.x-C,P.y-C,2*C,2*C):M()&&R(!1,`unhandled vertex style: ${g}`)}}this.shape=u}}});this.disposeEmitter.addListener(()=>c.dispose())}}class He extends b{constructor(e,t){const o=Ce()({textOptions:{font:be,maxWidth:.9,maxHeight:.9},edgePressListener:()=>{},facePressListener:()=>{},sectorPressListener:()=>{},sectorSetListener:()=>{},backgroundOffsetDistance:.3,selectedFaceColorHighlightProperty:new fe(null),selectedSectorEditProperty:new fe(null),style:Q,noninteractive:!1},t),n=o.style,d=new b({visibleProperty:n.faceColorsVisibleProperty}),a=new b({pickableProperty:Ao}),c=new b({pickableProperty:ko}),h=new b({pickableProperty:xo}),l=new b({pickableProperty:Oo}),i=new b,g=new b({pickable:!1}),f=new b({pickable:!1}),m=new b({renderer:ft.chromium?"canvas":null,pickable:null}),u=new b({pickable:!1}),y=new b,w=new _([e.stateProperty],T=>{if(T.getWeirdEdges().length||T.hasInvalidFaceColors())return!1;const v=T.getSimpleRegions();return v.length===1&&v[0].isSolved}),P=T=>{T?d.addChild(new Mo(e.board,e.stateProperty,n)):d.children.forEach(v=>v.dispose())};n.faceColorsVisibleProperty.link(P),a.addChild(new Jo(e.board,e.stateProperty,n,o)),o.noninteractive||a.addChild(new qo(e.board,o)),f.addChild(new _o(e.board,e.stateProperty,w,n));const C=new Pe(e.board.outerBoundary,e.board.innerBoundaries,n,o);l.addChild(new $o(e.board,e.stateProperty,w,n)),g.addChild(new zo(e.board,e.stateProperty,w,n)),h.addChild(new Ho(e.board,e.stateProperty,w,n)),o.noninteractive||h.addChild(new Wo(e.board,o)),c.addChild(new jo(e.board,e.stateProperty,n)),o.noninteractive||c.addChild(new Xo(e.board,o)),i.addChild(new Bo(e.board,e.stateProperty,n));super(_e({children:[C,d,a,c,h,l,i,g,f,u,y,m]},o));E(this,"annotationContainer");E(this,"backgroundNode");this.puzzle=e,this.annotationContainer=m;const S=T=>{u.children.forEach(v=>v.dispose()),T&&u.addChild(new Ro(T,e.board,n,o))};o.selectedFaceColorHighlightProperty.link(S),this.disposeEmitter.addListener(()=>o.selectedFaceColorHighlightProperty.unlink(S));const x=T=>{y.children.forEach(v=>v.dispose()),T&&y.addChild(new Do(T,C,n,o))};o.selectedSectorEditProperty.link(x),this.disposeEmitter.addListener(()=>o.selectedSectorEditProperty.unlink(x)),this.disposeEmitter.addListener(()=>{n.faceColorsVisibleProperty.unlink(P),[d,a,h,l,i,g,f,c].forEach(v=>{v.children.forEach(k=>k.dispose()),v.dispose()}),w.dispose(),C.dispose()}),this.backgroundNode=C}addAnnotationNode(e){this.annotationContainer.addChild(e)}removeAnnotationNode(e){this.annotationContainer.removeChild(e)}clearAnnotationNodes(){this.annotationContainer.removeAllChildren()}getBackgroundBounds(){return this.backgroundNode.bounds}}class wr extends b{constructor(r,e,t){const o=Ce()({style:Q},t),n=e.getEmbeddedCompleteData(r.inputFeatureSet),d=e.getEmbeddedCompleteData(r.outputFeatureSet),a=new He(new Le(e.smallBoard,n),{noninteractive:!0,style:o.style}),c=new He(new Le(e.smallBoard,d),{noninteractive:!0,style:o.style}),h=r.highlander?new b({children:e.getEmbeddedQuestionFaces(r.inputFeatureSet).map(w=>new je("?",{font:be,maxWidth:.9,maxHeight:.9,opacity:.5,fill:r.highlander?o.style.theme.faceValueColorProperty:o.style.theme.faceValueCompletedColorProperty,center:w.viewCoordinates}))}):new b,i=e.tightBounds.dilated(.5),g=.5,f=N.roundRectangle(i.x,i.y,i.width,i.height,g,g),m=new b({children:[a,h],clipArea:f,localBounds:i}),u=new b({children:[c,h],clipArea:f,localBounds:i}),y=new qe(new We({spacing:.2,children:[m,new eo(0,0,20,0,{fill:o.style.theme.uiForegroundColorProperty,stroke:o.style.theme.uiForegroundColorProperty,headHeight:7,headWidth:7,tailWidth:1,layoutOptions:{align:"center"},opacity:.6,scale:1/30}),u]}),{cornerRadius:g*1.4,xMargin:.3,yMargin:.3,lineWidth:.05,stroke:null,fill:o.style.theme.patternAnnotationBackgroundColorProperty});o.children=[y],super(o),this.rule=r,this.displayEmbedding=e,this.disposeEmitter.addListener(()=>{a.dispose(),c.dispose()})}}const Qo=(p,r)=>{$t(Qt,p,r,!0)};class me{constructor(r,e,t,o,n,d,a,c,h,l){this.sourcePatternBoard=r,this.boardPatternBoard=e,this.largeBoard=t,this.embedding=o,this.smallBoard=n,this.toSmallFaceMap=d,this.toSmallEdgeMap=a,this.toSmallSectorMap=c,this.tightBounds=h,this.expandedBounds=l}mapFace(r){const e=this.embedding.mapFace(r),t=this.boardPatternBoard.getFace(e);if(t){const o=this.toSmallFaceMap.get(t);return M()&&R(o),o}else return null}mapEdge(r){return(r.isExit?this.embedding.mapExitEdges(r):[this.embedding.mapNonExitEdge(r)]).map(o=>this.boardPatternBoard.getEdge(o)).map(o=>{const n=this.toSmallEdgeMap.get(o);return M()&&R(n),n})}mapSector(r){const e=this.embedding.mapSector(r),t=this.boardPatternBoard.getSector(e),o=this.toSmallSectorMap.get(t);return M()&&R(o),o}getEmbeddedQuestionFaces(r){const e=new Set;for(const t of r.patternBoard.faces)if(r.getFaceValue(t)!==void 0){const o=this.mapFace(t);o&&e.add(o)}return this.smallBoard.faces.filter(t=>!e.has(t))}getEmbeddedCompleteData(r){const e=nt.empty(this.smallBoard);for(const t of r.getFeaturesArray())if(t instanceof to)t.value!==null&&e.setFaceValue(this.mapFace(t.face),t.value);else if(t instanceof oo)this.mapEdge(t.edge).forEach(o=>e.setEdgeState(o,W.BLACK));else if(t instanceof ro)this.mapEdge(t.edge).forEach(o=>e.setEdgeState(o,W.RED));else if(t instanceof so)e.setSectorState(this.mapSector(t.sector),V.NOT_ZERO);else if(t instanceof no)e.setSectorState(this.mapSector(t.sector),V.NOT_ONE);else if(t instanceof io)e.setSectorState(this.mapSector(t.sector),V.NOT_TWO);else if(t instanceof ao)e.setSectorState(this.mapSector(t.sector),V.ONLY_ONE);else if(t instanceof lo){const o=(d,a)=>{const c=this.mapFace(d),h=this.mapFace(a),l=c?e.getFaceColor(c):e.getOutsideColor(),i=h?e.getFaceColor(h):e.getOutsideColor();new it(we(e,l),we(e,i)).apply(e)},n=(d,a)=>{const c=this.mapFace(d),h=this.mapFace(a),l=c?e.getFaceColor(c):e.getOutsideColor(),i=h?e.getFaceColor(h):e.getOutsideColor();new at(we(e,l),we(e,i)).apply(e)};for(let d=1;d<t.primaryFaces.length;d++)o(t.primaryFaces[d-1],t.primaryFaces[d]);for(let d=1;d<t.secondaryFaces.length;d++)o(t.secondaryFaces[d-1],t.secondaryFaces[d]);t.secondaryFaces.length&&n(t.primaryFaces[0],t.secondaryFaces[0])}else throw new Error(`unhandled feature: ${t}`);return Qo(this.smallBoard,e),e}static getEmbeddingBounds(r,e,t){const o=Se.NOTHING.copy(),n=a=>{o.addPoint(e.getVertex(t.mapVertex(a)).viewCoordinates)};r.vertices.forEach(n);const d=a=>{const c=e.getFace(t.mapFace(a));c&&c.vertices.forEach(h=>o.addPoint(h.viewCoordinates))};return r.faces.forEach(d),r.edges.forEach(a=>{let c;a.isExit?c=t.mapExitEdges(a).map(h=>e.getEdge(h)):c=[e.getEdge(t.mapNonExitEdge(a))],c.forEach(h=>{o.addPoint(h.start.viewCoordinates),o.addPoint(h.end.viewCoordinates)})}),o}static findBestEmbedding(r,e,t){const o=wt(r,e);if(o.length===0)return null;const n=Se.NOTHING.copy();t.vertices.forEach(h=>n.addPoint(h.viewCoordinates));const d=n.center;let a=null,c=Number.POSITIVE_INFINITY;for(let h=0;h<o.length;h++){const l=o[h],g=me.getEmbeddingBounds(r,e,l).center,f=d.distance(g);f<c&&(c=f,a=l)}return a}static getDisplayEmbedding(r,e,t,o){const n=me.getEmbeddingBounds(r,e,o),d=n.dilated(.5),a=t.faces.filter(u=>{const y=Se.NOTHING.copy();return u.vertices.forEach(w=>y.addPoint(w.viewCoordinates)),d.intersectsBounds(y)}),c=t.vertices.filter(u=>u.faces.some(y=>a.includes(y))),h=gt({vertices:c.map(u=>({logicalCoordinates:u.logicalCoordinates,viewCoordinates:u.viewCoordinates})),faces:a.map(u=>({logicalCoordinates:u.logicalCoordinates,vertices:u.vertices.map(y=>({logicalCoordinates:y.logicalCoordinates,viewCoordinates:y.viewCoordinates}))}))}),l=new mt(h),i=1e-6,g=new Map(a.map((u,y)=>{const w=l.faces.find(P=>P.viewCoordinates.equalsEpsilon(u.viewCoordinates,i));return M()&&R(w),[u,w]})),f=new Map(t.edges.map(u=>{const y=l.edges.find(w=>w.start.viewCoordinates.equalsEpsilon(u.start.viewCoordinates,i)&&w.end.viewCoordinates.equalsEpsilon(u.end.viewCoordinates,i)||w.start.viewCoordinates.equalsEpsilon(u.end.viewCoordinates,i)&&w.end.viewCoordinates.equalsEpsilon(u.start.viewCoordinates,i))??null;return y?[u,y]:null}).filter(u=>u!==null)),m=new Map(t.halfEdges.map(u=>{const y=l.halfEdges.find(w=>w.start.viewCoordinates.equalsEpsilon(u.start.viewCoordinates,i)&&w.end.viewCoordinates.equalsEpsilon(u.end.viewCoordinates,i))??null;return y?[u,y]:null}).filter(u=>u!==null));return M()&&R(o),new me(r,e,t,o,l,g,f,m,n,d)}}export{Fo as A,me as D,wr as E,Uo as F,He as P,Yo as U,Zo as V,dr as a,uo as b,fo as c,wo as d,yo as e,Q as f,go as g,Io as h,Ao as i,re as j,Y as k,Ke as l,So as m,Eo as n,vo as o,Lo as p,Vo as q,bo as r,Qo as s,No as t,co as u,To as v,pr as w,hr as x,ur as y,fr as z};
