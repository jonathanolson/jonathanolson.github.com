import{o as O,a as Q}from"./UnivariatePolynomial-B7u1WGdr.js";import{N as F,V as x,d as f,H as m,T as v,D as G}from"./PhetioControlledVisibilityProperty-DLWPAyRL.js";import{I as K,F as z,a as N,B as U,R as X,P as _}from"./PatternRule-CDRs6Hn3.js";import{P as $}from"./TextPushButton-jnVfkaQ5.js";import{p as J,e as P,f as R,_ as Y}from"./patternBoards-DsO5TEFU.js";import{P as Z}from"./PatternRuleNode-BQF-oKKk.js";import{P as W}from"./PatternBoardSolver-BpeZ3tu0.js";import{B as ee,R as te}from"./RichSolution-DXoJllUY.js";import{H as M}from"./Highlander-iuAp_GQQ.js";import{P as B}from"./PatternNode-C1rgMsi8.js";import{g as ae,e as ne,E as ie}from"./DisplayEmbedding-Cthdqix5.js";import{D,g as T}from"./getBestDisplayEmbedding-D2u3p2J9.js";import{l as se,P as re}from"./Theme-tmTDxZc0.js";import"./ShadedSphereNode-CnO3WBko.js";import"./BasicPuzzle-DmOtz3tZ.js";import"./autoSolver-C98O43Em.js";const A=.5,oe=ae(se),le=ne(re);class de extends F{constructor(t,I){const h=O()({layoutWidth:1e3},I),c=new x({x:10,y:10,align:"left"}),V=d=>{c.addChild(new f(d,{margin:5}))},i=t.patternBoard,p=J.get(i);P()&&R(p);const g=(d,u=20)=>{c.addChild(new f(new v(d,{font:"bold 20px Arial",fill:"#ccc",tagName:"h1"}),{topMargin:u}))};g(`Generic Rule${t.highlander?" (Highlander)":""}`,0),V(new Z(t,p,{scale:1.5}));{const d=W.getSolutions(i,t.inputFeatureSet.getFeaturesArray()),u=n=>{const s=z.empty(i);return t.inputFeatureSet.getFeaturesArray().forEach(a=>{a instanceof N&&s.addFeature(a)}),i.edges.forEach(a=>{a.isExit||(n.includes(a)?s.addBlackEdge(a):s.addRedEdge(a))}),s};if(t.highlander){const n=new ee(i,{solveEdges:!0,solveSectors:!1,solveFaceColors:!1}),a=W.getSolutions(i,t.inputFeatureSet.getHighlanderFeaturesArray()).map(e=>new te(i,n,e,!0)),l=M.filterWithFeatureSet(a,t.inputFeatureSet).filter(e=>e.isCompatibleWithFeatureSet(t.inputFeatureSet)),C=d.slice();l.forEach(e=>{const r=C.find(o=>o.length===e.solution.length&&o.every(L=>e.solutionSet.has(L)));P()&&R(r),Q(C,r)});const w=new Map;a.forEach(e=>{const r=M.getHighlanderKeyWithFeatureSet(e,t.inputFeatureSet);w.has(r)?w.get(r).push(e):w.set(r,[e])});const H=Y.sortBy([...w.values()],e=>-e.length),j=H.filter(e=>e.length>1),q=H.filter(e=>e.length===1).map(e=>e[0]),k=[];q.forEach(e=>{const r=t.inputFeatureSet.clone();try{e.solution.forEach(o=>{r.addBlackEdge(o)}),i.edges.forEach(o=>{e.solutionSet.has(o)||r.addRedEdge(o)}),k.push(e)}catch(o){if(!(o instanceof K))throw o}}),g("Valid Solutions"),c.addChild(new f(new m({spacing:5,wrap:!0,justify:"left",lineSpacing:30,preferredWidth:h.layoutWidth,children:[...k.map(e=>new B(i,u(e.solution),p,{scale:A}))]}),{margin:5})),g("Highlander Duplicates (Invalid)"),c.addChild(new f(new m({spacing:40,wrap:!0,justify:"left",lineSpacing:30,preferredWidth:h.layoutWidth,children:j.map(e=>new m({spacing:5,children:[...e.map(r=>new B(i,u(r.solution),p,{scale:A}))]}))}),{margin:5}))}else{const s=W.getSolutions(i,t.inputFeatureSet.getFeaturesArray()).map(l=>z.fromSolution(i,l)),a=[],b=[];for(const l of s)t.outputFeatureSet.isCompatibleWith(l)?a.push(l):b.push(l);P()&&R(b.length===0),g("Valid Solutions"),c.addChild(new f(new m({spacing:5,wrap:!0,justify:"left",lineSpacing:30,preferredWidth:h.layoutWidth,children:[...a.map(l=>new B(i,l,p,{scale:A}))]}),{margin:5}))}}{const d=(n,s,a)=>new x({spacing:10,children:[new v(n,{font:"16px Arial",fill:"#ccc"}),new ie(t,s,{cursor:"pointer",scale:30,style:a})]}),u=D.enumeration.values.map(n=>{const s=T(t.patternBoard,n);return s?d(n.displayName,s,le):null}).filter(n=>!!n);{const n=T(t.patternBoard,D.SQUARE);n&&t.inputFeatureSet.getFeaturesArray().every(a=>a instanceof N||a instanceof U||a instanceof X)&&u.unshift(d("Classic Square",n,oe))}g("Example Embeddings"),c.addChild(new F({layoutOptions:{topMargin:20},children:[new m({spacing:30,align:"top",wrap:!0,justify:"left",lineSpacing:30,preferredWidth:h.layoutWidth,children:u})]}))}h.children=[new $(c,{fill:"#333",stroke:null})],super(h),this.rule=t}}self.assertions.enableAssert();const ce=QueryStringMachine.getAll({r:{type:"string",defaultValue:"square-1-0/AQcODxARIib/ExkbIRwe/w=="}}),S=new F,ue=new F({renderer:"svg",children:[S]}),y=new G(ue,{allowWebGL:!0,allowBackingScaleAntialiasing:!0,allowSceneOverflow:!1});document.body.appendChild(y.domElement);y.setWidthHeight(self.innerWidth,self.innerHeight);console.log("test");(async()=>{const E=_.fromBinaryIdentifier(ce.r);if(console.log(E.serialize()),S.addChild(new de(E,{left:10,top:10})),S.bounds.isValid()){y.setWidthHeight(Math.ceil(S.right+10),Math.ceil(S.bottom+10)),y.updateDisplay();const t=new self.XMLSerializer().serializeToString(y.getRootBackbone().blocks[0].domElement);console.log(t)}})();
