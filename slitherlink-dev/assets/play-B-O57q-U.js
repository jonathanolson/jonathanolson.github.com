var Po=Object.defineProperty;var mo=(i,o,e)=>o in i?Po(i,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[o]=e;var P=(i,o,e)=>(mo(i,typeof o!="symbol"?o+"":o,e),e);import{c as Q,a as B,V as ie,D as fe,M as tt,S as vo,b as Wt,P as yt,o as re,B as Ge,E as wt,d as Pt,T as K,e as So,f as lt,g as Re}from"./UnivariatePolynomial-B1fo8xe7.js";import{s as Co}from"./scanURL-Cgwi09F1.js";import{B as Eo,a as bo,b as ko,c as Fo,d as Lo,e as k,f as z,g as ot,h as Se,_ as Pe,i as ct,j as zo,S as H,k as Ao,H as No,P as xo,l as To}from"./patternBoards-D316jvfQ.js";import{N,L as Gt,T as V,S as Io,R as Z,A as Bo,M as mt,a as Ro,b as Oo,c as J,d as Ve,V as W,H as X,P as _,s as Lt,e as Ho,G as zt,B as Je,f as At,g as dt,I as Nt,h as pe,D as Mo,i as Do}from"./PhetioControlledVisibilityProperty-BeZpyzqE.js";import{L as Ke,a as Ye,P as ze,C as Vo,V as qo,T as qe,O as Uo,R as Wo,b as Go,c as ye}from"./TextPushButton-DTnDa4k5.js";import{s as Xo,S as Ze,g as Jo,a as ut}from"./SATSolver-CD-nXHqk.js";import{P as me,s as Fe,i as Ko,h as Yo,f as le,j as de,k as I,U as O,p as Xt,l as Jt,m as Kt,n as Yt,o as Zt,q as Qt,r as jt,v as pt,t as ht,u as $t,V as Zo,F as Qo,w as _t,x as eo,y as ae}from"./DisplayEmbedding-EBvkzhr2.js";import{A as jo,C as $o,s as to,p as Oe,g as _o,a as er,i as tr,w as or}from"./polygonGenerators-B9PFyC-y.js";import{E as T,C as oo,U as rt,a as xt,F as rr,b as nr,S as sr,s as ro,c as Tt,d as ar,B as he}from"./BasicPuzzle-BUUdWhMz.js";import{c as y,o as ir,u as j,a as gt,r as Le,t as lr,b as Ce,d as It,e as cr,p as dr,f as Bt,g as ur,h as pr,s as nt,i as hr,j as gr,v as Rt,k as fr,m as yr,w as wr,n as Ot,q as Pr,x as mr,y as vr,z as Sr,A as Cr,B as Er,C as br,D as kr,E as Fr,F as Lr,G as zr,H as Ar,I as Nr,J as xr,K as Tr,L as Ir,M as st,N as Br,O as at}from"./Theme-TdJtppFU.js";import{A as Rr,N as He,S as Or}from"./SpinningIndicatorNode-BsuzSx0f.js";import{i as Xe,a as Ue,w as Ht,I as it,g as Me,b as Hr,c as Mr,d as Dr,e as Vr,f as qr,h as Ur,j as Wr,k as Gr,l as Xr,m as Jr,n as Kr,o as Yr,p as Zr,q as Qr,r as jr,s as $r,t as _r,u as en,v as tn,x as on,y as rn,z as nn,A as sn,B as an,C as ln,D as cn,E as dn}from"./autoSolver-DLTpSuNf.js";import{c as un}from"./compression-L63-wCoo.js";import{p as no}from"./puzzleFromCompressedString-C29bYsrB.js";import{U as pn}from"./UIAquaRadioButtonGroup-g66esRUe.js";import"./PatternBoardSolver-JIwhRtt1.js";import"./PatternRule-CbsljjHG.js";class hn extends N{constructor(o,e){const t=new me(o.puzzle,{edgePressListener:(l,s)=>{o.onUserEdgePress(l,s)},facePressListener:(l,s)=>{o.onUserFacePress(l,s)},sectorPressListener:(l,s)=>{o.onUserSectorPress(l,s)},sectorSetListener:(l,s)=>{o.onUserSectorSet(l,s)},selectedFaceColorHighlightProperty:o.selectedFaceColorHighlightProperty,selectedSectorEditProperty:o.selectedSectorEditProperty,style:o.style});super(Q({children:[t]},e)),this.puzzleModel=o,this.disposeEmitter.addListener(()=>t.dispose());let r=null;const n=l=>{if(t.clearAnnotationNodes(),r&&(r.dispose(),r=null),l){const s=new jo(o.puzzle.board,l,o.style,t.getBackgroundBounds());t.addAnnotationNode(s),r=s}};this.disposeEmitter.addListener(()=>{r&&(r.dispose(),r=null)}),o.displayedAnnotationProperty.link(n),this.disposeEmitter.addListener(()=>o.displayedAnnotationProperty.unlink(n))}}const vt=new Ke("showLayoutTestProperty",!1);class De extends Eo{constructor(o,e,t){super(o,e,t)}}class Mt extends bo{constructor(e,t){super(e,t);P(this,"originalEdges",new Set)}}class Dt extends ko{constructor(e,t){super(e.copy(),t.copy());P(this,"originalFace",null)}}class gn extends Fo{constructor(o,e){super(o.copy(),e.copy())}}class Vt{constructor(o,e){this.faces=o,this.boundaryHalfEdges=e}}class fn{constructor(o,e,t){this.faces=o,this.boundaryHalfEdges=e,this.boundarySegments=t}}class yn extends Lo{constructor(e,t){const r=new Map,n=new Map,l=new Map,s=new Map,a=new Map,c=new Map,u=new Map,h=new Map,E=g=>{const w=r.get(g);return k()&&z(w),w},L=g=>{const w=n.get(g);return k()&&z(w),w},v=g=>{const w=l.get(g);return k()&&z(w),w},f=g=>{const w=s.get(g);return k()&&z(w),w},C=g=>{const w=a.get(g);return k()&&z(w),w},d=g=>{const w=c.get(g);return k()&&z(w),w},p=g=>{const w=u.get(g);return k()&&z(w),w},b=g=>{const w=h.get(g);return k()&&z(w),w},m=e.vertices.map(g=>{const w=new gn(g.logicalCoordinates,g.viewCoordinates);return r.set(g,w),a.set(w,g),w}),S=e.faces.map(g=>{const w=new Dt(g.logicalCoordinates,g.viewCoordinates);return n.set(g,w),c.set(w,g),w.originalFace=g,w}),A=[],x=e.edges.map(g=>{const w=r.get(g.start),ne=r.get(g.end);k()&&z(w),k()&&z(ne);const se=new Mt(w,ne);se.originalEdges.add(g),l.set(g,se),u.set(se,g);const R=new De(w,ne,!1);s.set(g.forwardHalf,R),h.set(R,g.forwardHalf),A.push(R);const M=new De(ne,w,!0);return s.set(g.reversedHalf,M),h.set(M,g.reversedHalf),A.push(M),se});m.forEach(g=>{const w=C(g);g.incomingHalfEdges=w.incomingHalfEdges.map(f),g.outgoingHalfEdges=w.outgoingHalfEdges.map(f),g.edges=w.edges.map(v),g.faces=w.faces.map(L)}),S.forEach(g=>{const w=d(g);g.halfEdges=w.halfEdges.map(f),g.edges=w.edges.map(v),g.vertices=w.vertices.map(E)}),x.forEach(g=>{const w=p(g);g.forwardHalf=f(w.forwardHalf),g.reversedHalf=f(w.reversedHalf),g.forwardFace=w.forwardFace?L(w.forwardFace):null,g.reversedFace=w.reversedFace?L(w.reversedFace):null,g.vertices=w.vertices.map(E),g.faces=w.faces.map(L)}),A.forEach(g=>{const w=b(g);g.edge=v(w.edge),g.reversed=f(w.reversed),g.next=f(w.next),g.previous=f(w.previous),g.face=w.face?L(w.face):null});super({edges:x,vertices:m,faces:S,halfEdges:A,outerBoundary:e.outerBoundary.map(f),innerBoundaries:e.innerBoundaries.map(g=>g.map(f))});P(this,"edgeStateMap",new Map);P(this,"faceValueMap",new Map);this.originalBoard=e,this.originalState=t,x.forEach(g=>{this.edgeStateMap.set(g,t.getEdgeState(p(g)))}),S.forEach(g=>{this.faceValueMap.set(g,t.getFaceValue(d(g)))}),k()&&ot(this)}getFaceValue(e){const t=this.faceValueMap.get(e);return k()&&z(t!==void 0),t}getEdgeState(e){const t=this.edgeStateMap.get(e);return k()&&z(t!==void 0),t}clearSatisfiedFaces(){this.faces.forEach(e=>{const t=this.getFaceValue(e);if(t===null)return;let r=0,n=0;e.edges.forEach(l=>{const s=this.getEdgeState(l);s===T.WHITE?r++:s===T.BLACK&&n++}),r===0&&n===t&&this.faceValueMap.set(e,null)})}removeDeadRedEdges(){const e=new Set(this.edges.filter(s=>this.getEdgeState(s)===T.RED&&s.faces.every(a=>a===null||this.getFaceValue(a)===null))),t=new Set(this.vertices.filter(s=>s.edges.every(a=>e.has(a)))),r=new Set(this.faces.filter(s=>s.edges.some(a=>e.has(a)))),n=[],l=new Set(r);for(;l.size;){const s=l.values().next().value;l.delete(s);const a=[s];let c=!1;for(let d=0;d<a.length;d++){const p=a[d];p.edges.forEach(b=>{e.has(b)&&[b.forwardFace,b.reversedFace].forEach(m=>{if(m!==p){if(m===null){c=!0;return}l.has(m)&&(l.delete(m),a.push(m))}})})}const u=new Set(a.flatMap(d=>d.halfEdges)),h=new Set(a.flatMap(d=>d.halfEdges.map(p=>p.reversed))),E=new Set([...u].filter(d=>!h.has(d))),L=d=>{let p=d.next;for(;p!==d&&!E.has(p);)p=p.reversed.next;return k()&&z(p!==d),p},v=E.values().next().value,f=[v];let C=L(v);for(;C!==v;)f.push(C),C=L(C);if(k()&&z(f.length===E.size),c){const d=[];for(let p=0;p<f.length;p++){const b=f[p],m=f[(p+f.length-1)%f.length];if(k()&&z(m.end===b.start),!e.has(b.edge)&&e.has(m.edge)){const S=[b];for(let A=p+1;;A++){const x=f[A%f.length];if(e.has(x.edge))break;S.push(x)}d.push(S)}}n.push(new fn(a,f,d))}else n.push(new Vt(a,f))}n.forEach(s=>{if(s instanceof Vt){const a=s.boundaryHalfEdges.map(h=>h.start),c=s.boundaryHalfEdges.map(h=>h.edge),u=new Dt(Se(a.map(h=>h.viewCoordinates)),Se(a.map(h=>h.logicalCoordinates)));this.faces.push(u),this.faceValueMap.set(u,null),u.halfEdges=s.boundaryHalfEdges,u.edges=c,u.vertices=a;for(let h=0;h<s.boundaryHalfEdges.length;h++){const E=s.boundaryHalfEdges[h],L=E.face;E.face=u;const v=E.edge;E.isReversed?v.reversedFace=u:v.forwardFace=u,k()&&z(L),L&&B(v.faces,L),v.faces.push(u)}}else s.boundarySegments.forEach(a=>{a.forEach(c=>{const u=c.edge,h=c.face;h&&(c.face=null,B(u.faces,h)),c.isReversed?u.reversedFace=null:u.forwardFace=null})})}),e.forEach(s=>{B(this.edges,s),B(this.halfEdges,s.forwardHalf),B(this.halfEdges,s.reversedHalf)}),t.forEach(s=>{B(this.vertices,s)}),r.forEach(s=>{B(this.faces,s)}),this.vertices.forEach(s=>{s.edges=s.edges.filter(a=>!e.has(a)),s.incomingHalfEdges=s.incomingHalfEdges.filter(a=>!e.has(a.edge)),s.outgoingHalfEdges=s.outgoingHalfEdges.filter(a=>!e.has(a.edge)),s.faces=s.incomingHalfEdges.map(a=>a.face).filter(a=>a!==null);for(let a=0;a<s.incomingHalfEdges.length;a++){const c=s.outgoingHalfEdges[a],u=s.incomingHalfEdges[(a+1)%s.incomingHalfEdges.length];u.next=c,c.previous=u}}),k()&&ot(this)}removeSimpleForced(){this.vertices.slice().forEach(e=>{if(e.edges.length!==2||Pe.uniq(e.edges.flatMap(b=>b.faces)).some(b=>this.getFaceValue(b)!==null))return;const r=e.edges[0],n=e.edges[1],l=this.getEdgeState(r),s=this.getEdgeState(n);if(l!==s)return;const a=r.getOtherVertex(e),c=n.getOtherVertex(e);if(a===c)return;const u=r.forwardHalf.end===e?r.forwardHalf:r.reversedHalf,h=r.forwardHalf.end===e?r.reversedHalf:r.forwardHalf,E=n.forwardHalf.start===e?n.forwardHalf:n.reversedHalf,L=n.forwardHalf.start===e?n.reversedHalf:n.forwardHalf,v=u.face,f=h.face,C=new Mt(a,c);r.originalEdges.forEach(b=>C.originalEdges.add(b)),n.originalEdges.forEach(b=>C.originalEdges.add(b)),this.edgeStateMap.set(C,l),this.edges.push(C);const d=new De(a,c,!1);this.halfEdges.push(d);const p=new De(c,a,!0);if(this.halfEdges.push(p),C.forwardHalf=d,C.reversedHalf=p,C.forwardFace=v,C.reversedFace=f,C.vertices=[a,c],C.faces=[v,f].filter(b=>b!==null),d.edge=C,d.reversed=p,d.next=E.next,d.previous=u.previous,d.face=v,p.edge=C,p.reversed=d,p.next=h.next,p.previous=L.previous,p.face=f,v){const b=v.halfEdges.indexOf(u),m=v.edges.indexOf(r);k()&&z(b!==-1),k()&&z(m!==-1),v.halfEdges[b]=d,B(v.halfEdges,E),v.edges[m]=C,B(v.edges,n),B(v.vertices,e)}if(f){const b=f.halfEdges.indexOf(L),m=f.edges.indexOf(n);k()&&z(b!==-1),k()&&z(m!==-1),f.halfEdges[b]=p,B(f.halfEdges,h),f.edges[m]=C,B(f.edges,r),B(f.vertices,e)}{const b=a.incomingHalfEdges.indexOf(h),m=a.outgoingHalfEdges.indexOf(u),S=a.edges.indexOf(r);k()&&z(b!==-1),k()&&z(m!==-1),k()&&z(S!==-1),a.incomingHalfEdges[b]=p,a.outgoingHalfEdges[m]=d,a.edges[S]=C}{const b=c.incomingHalfEdges.indexOf(E),m=c.outgoingHalfEdges.indexOf(L),S=c.edges.indexOf(n);k()&&z(b!==-1),k()&&z(m!==-1),k()&&z(S!==-1),c.incomingHalfEdges[b]=d,c.outgoingHalfEdges[m]=p,c.edges[S]=C}d.previous.next=d,d.next.previous=d,p.previous.next=p,p.next.previous=p,B(this.edges,r),B(this.edges,n),B(this.halfEdges,r.forwardHalf),B(this.halfEdges,r.reversedHalf),B(this.halfEdges,n.forwardHalf),B(this.halfEdges,n.reversedHalf),B(this.vertices,e)}),k()&&ot(this)}simplify(){this.clearSatisfiedFaces(),this.removeDeadRedEdges(),this.removeSimpleForced()}fixOuterBoundary(){const e=new Set(this.halfEdges.filter(n=>n.face===null)),t=[],r=[];for(;e.size;){const n=e.values().next().value;e.delete(n);const l=[n];let s=n.next;for(;s!==n;)l.push(s),e.delete(s),s=s.next;ct(l.map(a=>a.start.viewCoordinates))<0?t.push(l):r.push(l)}k()&&z(t.length===1),this.outerBoundary.length=0,this.outerBoundary.push(...t[0]),this.innerBoundaries.length=0,this.innerBoundaries.push(...r)}getCompleteState(){this.fixOuterBoundary();const e=oo.fromFacesEdges(this,t=>this.getFaceValue(t),t=>this.getEdgeState(t));return Fe(this,e),e}getCompletePuzzle(){return{board:this,state:this.getCompleteState()}}getSignedArea(){let e=0;return this.faces.forEach(t=>{e+=ct(t.vertices.map(r=>r.viewCoordinates))}),e}getCentroid(){let e=0,t=0,r=0;return this.halfEdges.forEach(n=>{if(n.face===null){const l=n.end.viewCoordinates,s=n.start.viewCoordinates;e+=(s.x+l.x)*(s.y-l.y);const a=l.x*(2*l.y+s.y)+s.x*(l.y+2*s.y);t+=(l.x-s.x)*a,r+=(s.y-l.y)*a}}),e*=.5,new ie(t,r).timesScalar(1/(6*e))}applyDerivative(e){this.vertices.forEach(t=>{const r=e.derivatives.get(t);k()&&z(r),k()&&z(r.isFinite()),t.viewCoordinates.add(r)}),this.fixFaceCoordinates()}fixFaceCoordinates(){this.faces.forEach(e=>{e.viewCoordinates.set(Se(e.halfEdges.map(t=>t.start.viewCoordinates)))})}getDebugNode(){const e=new N;return this.edges.forEach(t=>{const r=t.start.viewCoordinates,n=t.end.viewCoordinates;let l,s;const a=this.edgeStateMap.get(t);a===T.WHITE?(l=y.blackLineColorProperty,s=.02):a===T.BLACK?(l=ir(Math.random()*360,.7,.55),s=.1):(l=null,s=.02),e.addChild(new Gt(r,n,{stroke:l,lineWidth:s,lineCap:"round"}))}),this.faces.forEach(t=>{const r=this.faceValueMap.get(t)??null;r!==null&&e.addChild(new V(r,{maxWidth:.9,maxHeight:.9,center:t.viewCoordinates,fill:y.faceValueColorProperty}))}),e}}class G{constructor(o,e){this.layoutPuzzle=o,this.derivatives=e}plus(o){const e=new Map;return this.derivatives.forEach((t,r)=>{e.set(r,t.plus(o.derivatives.get(r)))}),new G(this.layoutPuzzle,e)}minus(o){const e=new Map;return this.derivatives.forEach((t,r)=>{e.set(r,t.minus(o.derivatives.get(r)))}),new G(this.layoutPuzzle,e)}timesScalar(o){const e=new Map;return this.derivatives.forEach((t,r)=>{e.set(r,t.timesScalar(o))}),new G(this.layoutPuzzle,e)}getMaxMagnitude(){let o=0;return this.derivatives.forEach(e=>{o=Math.max(o,e.getMagnitude())}),o}getAreaCorrectedDerivative(){let o=this;for(let e=0;e<5;e++)o=o.getAreaCorrectedDerivativeOnce();return o}getAreaCorrectedDerivativeOnce(){return this.plus(G.getAreaScaledDeltas(this.layoutPuzzle,-this.getAreaDerivative()/this.layoutPuzzle.getSignedArea()))}getAreaDerivative(){let o=0;return this.layoutPuzzle.faces.forEach(e=>{o+=zo(e.vertices.map(t=>t.viewCoordinates),e.vertices.map(t=>this.derivatives.get(t)))}),o}getDebugNode(){const o=new N;return this.layoutPuzzle.vertices.forEach(e=>{const t=this.derivatives.get(e),r=e.viewCoordinates,n=new Rr(r.x,r.y,r.x+t.x,r.y+t.y,{lineWidth:.01,headHeight:.05,headWidth:.05,tailWidth:.005,fill:"green",stroke:"green"});o.addChild(n)}),o}static getAreaScaledDeltas(o,e){const t=o.getCentroid(),r=new Map;return o.vertices.forEach(n=>{const l=n.viewCoordinates.minus(t).timesScalar(e);k()&&z(l.isFinite()),r.set(n,l)}),new G(o,r)}static getHookesAttraction(o,e,t){const r=new Map;return o.vertices.forEach(n=>{r.set(n,ie.ZERO.copy())}),o.edges.forEach(n=>{const l=n.start.viewCoordinates,a=n.end.viewCoordinates.minus(l),c=a.getMagnitude(),u=a.timesScalar((c-e)*t/c);k()&&z(u.isFinite()),r.get(n.start).add(u),r.get(n.end).subtract(u)}),new G(o,r)}static getRegularPolygonDeltas(o,e,t,r){const n=new Map;o.vertices.forEach(s=>{n.set(s,ie.ZERO.copy())});const l=s=>e/(2*Math.sin(Math.PI/s));return o.faces.forEach(s=>{if(s.vertices.length<3)return;const a=.2,c=.3,u=s.vertices.map(m=>m.viewCoordinates);let h=0;const E=ct(u);E<0?h=1:E<a&&(h=Math.max(h,(a-E)/a));for(let m=0;m<u.length&&!(h>=1);m++){const S=m,A=(m+1)%u.length,x=u[S],g=u[A];for(let w=m+2;w<u.length-(m===0?1:0)&&!(h>=1);w++){const ne=w%u.length,se=(w+1)%u.length,R=u[ne],M=u[se];if(fe.lineSegmentIntersection(x.x,x.y,g.x,g.y,R.x,R.y,M.x,M.y))k()&&z(u.length>=4),h=1;else{const Te=Math.min(fe.distToSegment(x,R,M),fe.distToSegment(g,R,M),fe.distToSegment(R,x,g),fe.distToSegment(M,x,g));Te<c&&(h=Math.max(h,(c-Te)/c))}}}if(h===0&&t&&o.getFaceValue(s)===null)return;const L=Se(u);k()&&z(L.isFinite());const v=l(u.length),f=u.map(m=>m.minus(L)),C=u.map((m,S)=>ie.createPolar(v,2*Math.PI*S/u.length)),d=G.getLeastSquares(f,C),p=r+(2-r)*h,b=u.map((m,S)=>d[S].minus(f[S]).timesScalar(p));s.vertices.forEach((m,S)=>{const A=b[S];k()&&z(A.isFinite()),n.get(m).add(A)})}),new G(o,n)}static getBarycentricDeltas(o){const e=new Map;return o.vertices.forEach(t=>{const r=t.edges.map(s=>s.getOtherVertex(t)),n=new ie(0,0);r.forEach(s=>n.add(s.viewCoordinates)),n.multiplyScalar(1/r.length);const l=n.subtract(t.viewCoordinates);k()&&z(l.isFinite()),e.set(t,l)}),new G(o,e)}static getAngularDeltas(o,e){const t=new Map;return o.vertices.forEach(r=>{t.set(r,ie.ZERO.copy())}),o.vertices.forEach(r=>{const n=r.edges.map(f=>f.getOtherVertex(r));let l=Pe.sortBy(n,f=>f.viewCoordinates.minus(r.viewCoordinates).getAngle());if(l[0]!==n[0]){const f=l.indexOf(n[0]);l=[...l.slice(f),...l.slice(0,f)]}const s=Pe.range(0,n.length).every(f=>l[f]===n[f]),a=n.map(f=>f.viewCoordinates.minus(r.viewCoordinates).normalized()),c=G.getUnitLeastSquares(a),u=Math.max(...Pe.range(0,n.length).map(f=>c[f].dot(c[(f+1)%n.length]))),h=Math.max(...Pe.range(0,n.length).map(f=>a[f].dot(a[(f+1)%n.length]))),E=(f,C)=>C<=.5?.5*Math.pow(2*C,f):1-E(f,1-C),L=s?fe.linear(u,1,0,1,h):1,v=.75;if(L>v){const f=(L-v)/(1-v),C=E(2,f),d=new ie(0,0);for(let p=0;p<n.length;p++){const b=n[p],m=a[p],S=c[p],A=S.minus(m.timesScalar(S.dot(m))).timesScalar(C*e);d.add(A),k()&&z(A.isFinite()),t.get(b).add(A)}d.multiplyScalar(1/n.length);for(const p of n)k()&&z(d),t.get(p).subtract(d)}}),new G(o,t)}static getUnitLeastSquares(o){const e=o.length,t=Pe.range(0,e).map(r=>ie.createPolar(1,2*Math.PI*r/e));return G.getLeastSquares(o,t)}static getLeastSquares(o,e){const t=o.length,r=new tt(2,t,[...e.map(u=>u.x),...e.map(u=>u.y)]),n=new tt(2,t,[...o.map(u=>u.x),...o.map(u=>u.y)]),l=r.times(n.transpose()),s=new vo(l);let a=s.getV().times(s.getU().transpose());a.det()<0&&(a=s.getV().times(tt.diagonalMatrix([1,-1])).times(s.getU().transpose()));const c=new Wt().rowMajor(a.get(0,0),a.get(0,1),0,a.get(1,0),a.get(1,1),0,0,0,1);return e.map(u=>{const h=c.timesVector2(u);return k()&&z(h.isFinite()),h})}}const wn=i=>({board:i.board,stateProperty:new yt(i.state)});class Pn extends N{constructor(o,e){const t=new N;let r=null;const n=()=>{const s=o.puzzle.board,a=o.puzzle.stateProperty.value;if(a.getSimpleRegions().some(C=>C.isSolved))return;const c=new yn(s,a);c.simplify();const u=()=>G.getAngularDeltas(c,.2).plus(G.getHookesAttraction(c,1,.1)).plus(G.getRegularPolygonDeltas(c,1,!0,.2));let h=.3;for(let C=0;C<40;C++){C%10===0&&(h*=.95);let d=u();{let p=d.getMaxMagnitude(),b=h;h*p>1.5&&(b=1.5/p),d=d.timesScalar(b)}if(c.applyDerivative(d),d.getMaxMagnitude()<.015)break}const E=c.getCompletePuzzle();r&&r.dispose();const L=new me(wn(E),{edgePressListener:(C,d)=>{const p=C.originalEdges;p&&o.onUserEdgePress(p.values().next().value,d)},facePressListener:(C,d)=>{if(C===null)o.onUserFacePress(null,d);else{const p=C.originalFace;p&&o.onUserFacePress(p,d)}}});r=L;const v=new N({children:[L]}),f=600;v.scale(Math.min(f/v.width,f/v.height)),v.left=20,v.top=130,t.children=[v]},l=()=>{t.children=[],n()};o.puzzle.stateProperty.link(l),super(Q({children:[t]},e)),this.puzzleModel=o,this.disposeEmitter.addListener(()=>o.puzzle.stateProperty.unlink(l)),this.disposeEmitter.addListener(()=>t.dispose()),this.disposeEmitter.addListener(()=>r&&r.dispose())}}class so extends Io(N){constructor(e,t=le,r){const n=re()({topological:!1},r);super(n);P(this,"backgroundRect");P(this,"rectangularGradientRect");P(this,"circularGradientRect");P(this,"puzzleWrapper");P(this,"puzzleNode",null);P(this,"zoomListener");this.puzzleModelProperty=e,this.style=t,this.backgroundRect=new Z({fill:t.theme.playAreaBackgroundColorProperty,pickableProperty:Ko}),Yo(null,this.backgroundRect,(s,a)=>{var c;(c=e.value)==null||c.onUserFacePress(s,a)}),this.rectangularGradientRect=new Z({pickable:!1}),this.circularGradientRect=new Z({pickable:!1}),this.puzzleWrapper=new N({children:[this.backgroundRect,this.rectangularGradientRect,this.circularGradientRect]}),this.zoomListener=new Bo(this.puzzleWrapper,{maxScale:10}),this.addInputListener(this.zoomListener),this.addChild(this.puzzleWrapper);const l=this.updateLayout.bind(this);this.localPreferredWidthProperty.lazyLink(l),this.localPreferredHeightProperty.lazyLink(l),n.topological&&this.puzzleWrapper.localBoundsProperty.lazyLink(l),mt.multilink([e,vt],(s,a)=>{this.puzzleNode&&(this.puzzleNode.dispose(),this.puzzleNode=null),s&&(n.topological?a&&(this.puzzleNode=new Pn(s)):this.puzzleNode=new hn(s),this.puzzleNode&&(this.updatePuzzleNodeLayout(this.puzzleNode),this.puzzleWrapper.children=[this.backgroundRect,this.rectangularGradientRect,this.circularGradientRect,this.puzzleNode])),this.zoomListener.resetTransform(),this.updateLayout()})}step(e){this.zoomListener.step(e)}updateLayout(){const e=this.localPreferredWidth,t=this.localPreferredHeight;if(e!==null&&(this.backgroundRect.rectWidth=e,this.rectangularGradientRect.rectWidth=e,this.circularGradientRect.rectWidth=e),t!==null&&(this.backgroundRect.rectHeight=t,this.rectangularGradientRect.rectHeight=t,this.circularGradientRect.rectHeight=t),this.puzzleNode&&this.updatePuzzleNodeLayout(this.puzzleNode),e!==null&&t!==null&&e>0&&t>0){const r=new Ge(0,0,e,t),n=r.center,l=n.getMagnitude();this.rectangularGradientRect.fill=new Ro(0,0,0,t).addColorStop(0,this.style.theme.playAreaLinearTopColorProperty).addColorStop(.5,this.style.theme.playAreaLinearMiddleColorProperty).addColorStop(1,this.style.theme.playAreaLinearBottomColorProperty),this.circularGradientRect.fill=new Oo(n.x,n.y,l,n.x,n.y,0).addColorStop(0,this.style.theme.playAreaRadialOutsideColorProperty).addColorStop(1,this.style.theme.playAreaRadialInsideColorProperty),this.clipArea=H.bounds(r),this.zoomListener.setTargetBounds(r),this.zoomListener.setPanBounds(r)}else{const r=new Ge(0,0,5,5);this.zoomListener.setTargetBounds(r),this.zoomListener.setPanBounds(r)}}updatePuzzleNodeLayout(e){const t=this.localPreferredWidth,r=this.localPreferredHeight;if(t!==null&&r!==null&&t>0&&r>0){const l=t-40,s=r-20*2;if(e.localBounds.isValid()){const a=e.localBounds.width,c=e.localBounds.height,u=Math.min(l/a,s/c);e.setScaleMagnitude(u),e.center=new ie(t/2,r/2)}}}}const D=class D extends wt{constructor(o,e,t){super(),this.fromWhite=o,this.fromBlack=e,this.fromRed=t}apply(o){return o===T.WHITE?this.fromWhite:o===T.BLACK?this.fromBlack:this.fromRed}};P(D,"CYCLE",new D(T.BLACK,T.RED,T.WHITE)),P(D,"REVERSE_CYCLE",new D(T.RED,T.WHITE,T.BLACK)),P(D,"WHITE_SET",new D(T.WHITE,T.WHITE,T.WHITE)),P(D,"BLACK_SET",new D(T.BLACK,T.BLACK,T.BLACK)),P(D,"RED_SET",new D(T.RED,T.RED,T.RED)),P(D,"BLACK_TOGGLE",new D(T.BLACK,T.WHITE,T.BLACK)),P(D,"RED_TOGGLE",new D(T.RED,T.RED,T.WHITE)),P(D,"enumeration",new Pt(D));let Ae=D;const mn=new Ye("pressStyle0",Ae.CYCLE),vn=new Ye("pressStyle1",Ae.WHITE_SET),Sn=new Ye("pressStyle2",Ae.REVERSE_CYCLE),Cn=i=>{switch(i){case 0:return mn.value;case 1:return vn.value;case 2:return Sn.value}},qt=(i,o,e)=>{Xe(e,i,o,!0)};class En{constructor(o){this.hintAction=o}get annotation(){return this.hintAction.annotation}apply(o){this.hintAction.apply(o)}getUndo(o){throw new Error("unimplemented")}isEmpty(){return this.hintAction.isEmpty()}serializeAction(){throw new Error("unimplemented")}static deserializeAction(o,e){throw new Error("unimplemented")}}const bn=i=>i instanceof Ao?{type:"SquareBoard",width:i.width,height:i.height}:i instanceof No?{type:"HexagonalBoard",radius:i.radius,scale:i.scale,isPointyTop:i.isPointyTop,holeRadius:i.holeRadius}:{type:"BaseBoard",vertices:i.vertices.map(o=>({x:o.logicalCoordinates.x,y:o.logicalCoordinates.y,vx:o.viewCoordinates.x,vy:o.viewCoordinates.y})),faces:i.faces.map(o=>({x:o.logicalCoordinates.x,y:o.logicalCoordinates.y,vertices:o.vertices.map(e=>i.vertices.indexOf(e))}))},ao=i=>({version:1,board:bn(i.board),state:i.stateProperty.value.serializeState(i.board)}),io=i=>{const o=ao(i);return un(JSON.stringify(o))};function kn(i){return new Worker(""+new URL("hintWorker-CVZ9o6xx.js",import.meta.url).href,{name:i==null?void 0:i.name})}let we=null;const We=new K(!1),Fn=()=>(we||(we=new kn,we==null||we.addEventListener("message",i=>{i.data.type==="hint-worker-loaded"&&(We.value=!0)})),we),Ln=i=>{const o=ao(i),e=i.solution.cleanState.serializeState(i.board),t=i.solution.solvedState.serializeState(i.board),r=[...i.solution.blackEdges].map(n=>i.board.edges.indexOf(n));return{puzzle:o,cleanState:e,solvedState:t,blackEdges:r}},Y=class Y extends wt{};P(Y,"DEFAULT",new Y),P(Y,"LOADING",new Y),P(Y,"SEARCHING",new Y),P(Y,"FOUND",new Y),P(Y,"NOT_FOUND",new Y),P(Y,"enumeration",new Pt(Y));let U=Y;const lo=new Ke("uiHintUsesBuiltInSolve",!1),ft=new Ke("showUndoRedoAllProperty",!1);class co extends So{constructor(e,t){const r=re()({style:le,initialTimeElapsed:0},t),n=r.style;super();P(this,"timeElapsedProperty",new K(0));P(this,"hintStateProperty",new K(U.DEFAULT));P(this,"stack");P(this,"stackLengthProperty",new K(0));P(this,"stackPositionProperty",new K(0));P(this,"undoPossibleProperty");P(this,"redoPossibleProperty");P(this,"currentSnapshotProperty");P(this,"hasErrorProperty");P(this,"isSolvedProperty");P(this,"hintWorkerMessageID",0);P(this,"addedHintListener",!1);P(this,"pendingHintActionProperty",new K(null));P(this,"displayedAnnotationProperty");P(this,"pendingActionFaceColorProperty",new K(null));P(this,"pendingActionSectorProperty",new K(null));P(this,"selectedFaceColorHighlightProperty");P(this,"selectedSectorEditProperty");P(this,"autoSolverFactoryProperty");P(this,"style");this.puzzle=e,this.style=n,this.timeElapsedProperty.value=r.initialTimeElapsed,this.autoSolverFactoryProperty=new J([Ue,n.safeSolverFactoryProperty,n.autoSolverFactoryProperty],(a,c,u)=>a?u:c),this.displayedAnnotationProperty=new J([this.pendingHintActionProperty],a=>a?a.annotation:null);const l=this.clearPendingAction.bind(this);this.stackPositionProperty.lazyLink(l),de.lazyLink(l),this.disposeEmitter.addListener(()=>de.unlink(l)),this.selectedFaceColorHighlightProperty=new J([e.stateProperty,de,this.pendingActionFaceColorProperty],(a,c,u)=>{if((c===I.FACE_COLOR_MATCH||c===I.FACE_COLOR_OPPOSITE)&&u){const h=a.getFacesWithColor(u.color);return{faceColor:u.color,face:u.face,faces:h}}return null}),this.disposeEmitter.addListener(()=>this.selectedFaceColorHighlightProperty.dispose()),this.selectedSectorEditProperty=new J([e.stateProperty,de,this.pendingActionSectorProperty],(a,c,u)=>c===I.SECTOR_STATE&&u?{sector:u,currentState:a.getSectorState(u)}:null),this.disposeEmitter.addListener(()=>this.selectedSectorEditProperty.dispose());{const a=e.stateProperty.value.clone();qt(e.board,a,this.style.safeSolverFactoryProperty.value),e.stateProperty.value=a}this.stack=[new ke(this.puzzle.board,null,e.stateProperty.value)],this.stackLengthProperty.value=1,this.currentSnapshotProperty=new J([this.stackLengthProperty,this.stackPositionProperty],()=>this.stack[this.stackPositionProperty.value]),this.hasErrorProperty=new J([this.currentSnapshotProperty],a=>a.errorDetected),this.isSolvedProperty=new J([this.currentSnapshotProperty],a=>{if(a.state.getWeirdEdges().length||a.state.hasInvalidFaceColors())return!1;const c=a.state.getSimpleRegions();return c.length===1&&c[0].isSolved}),this.addAutoSolveDelta(),this.updateState(),this.undoPossibleProperty=new J([this.stackPositionProperty],a=>a>0),this.redoPossibleProperty=new J([this.stackPositionProperty,this.stackLengthProperty],(a,c)=>a<c-1);const s=()=>this.onAutoSolveChange();this.autoSolverFactoryProperty.lazyLink(s),this.style.safeSolverFactoryProperty.lazyLink(s),this.disposeEmitter.addListener(()=>{this.autoSolverFactoryProperty.unlink(s),this.style.safeSolverFactoryProperty.unlink(s)})}clearPendingAction(){this.pendingActionFaceColorProperty.value=null,this.pendingActionSectorProperty.value=null}step(e){this.timeElapsedProperty.value+=e,localStorage.setItem("timeElapsedProperty",JSON.stringify(this.timeElapsedProperty.value))}updateState(){this.clearPendingHint(),this.puzzle.stateProperty.value=this.stack[this.stackPositionProperty.value].state,setTimeout(()=>{localStorage.setItem("puzzleString",io(this.puzzle))},0)}wipeStackTop(){for(;this.stack.length>this.stackPositionProperty.value+1;)this.stack.pop();this.stackLengthProperty.value=this.stack.length}pushTransitionAtCurrentPosition(e){this.wipeStackTop(),this.stack.push(e),this.stackLengthProperty.value=this.stack.length,this.stackPositionProperty.value++}applyUserActionToStack(e,t){const r=(t==null?void 0:t.forceDirty)||e instanceof rt,l=this.stack[this.stackPositionProperty.value].state;let s=!1;const a=new $o(this.puzzle.board,l,this.puzzle.solution.solvedState);try{e.apply(a)}catch{s=!0}let c=l.createDelta();try{if(Ht(this.autoSolverFactoryProperty.value,this.puzzle.board,c,()=>{e.apply(c)},r),t!=null&&t.checkAutoSolve&&!(t!=null&&t.checkAutoSolve(c)))throw new it("Auto-solver did not respect user action")}catch(h){if(s=!0,h instanceof it)console.log("error"),c=l.createDelta(),Ht(this.style.safeSolverFactoryProperty.value,this.puzzle.board,c,()=>{e.apply(c)},r);else throw h}const u=l.clone();c.apply(u),this.pushTransitionAtCurrentPosition(new ke(this.puzzle.board,e,u,s))}addAutoSolveDelta(){const e=this.puzzle.stateProperty.value.createDelta();try{if(Xe(this.autoSolverFactoryProperty.value,this.puzzle.board,e,!0),!e.isEmpty()){const t=this.puzzle.stateProperty.value.clone();e.apply(t),this.pushTransitionAtCurrentPosition(new ke(this.puzzle.board,new rt,t))}}catch(t){if(!(t instanceof it))throw t}}onAutoSolveChange(){const e=this.stack[this.stackPositionProperty.value];e.action&&this.stackPositionProperty.value--,this.applyUserActionToStack(e.action||new rt,{forceDirty:!0}),this.updateState()}onUserUndo(){this.stackPositionProperty.value>0&&(this.stackPositionProperty.value--,this.updateState())}onUserRedo(){this.stackPositionProperty.value<this.stackLengthProperty.value-1&&(this.stackPositionProperty.value++,this.updateState())}onUserUndoAll(){this.stackPositionProperty.value>0&&(this.stackPositionProperty.value=0,this.updateState())}onUserRedoAll(){this.stackPositionProperty.value<this.stackLengthProperty.value-1&&(this.stackPositionProperty.value=this.stackLengthProperty.value-1,this.updateState())}onUserEscape(){this.clearPendingAction(),this.clearPendingHint()}getNewEdgeState(e,t){const r=de.value===I.EDGE_STATE_REVERSED;return Cn(r?2-t:t).apply(e)}onUserEdgePress(e,t){const r=this.puzzle.stateProperty.value.getEdgeState(e),n=this.getNewEdgeState(r,t);if(r!==n){const l=this.stack[this.stackPositionProperty.value];l.action&&l.action instanceof xt&&l.action.edge===e&&this.stackPositionProperty.value--;const s=new xt(e,n);this.applyUserActionToStack(s,{checkAutoSolve:a=>a.getEdgeState(e)===n}),this.updateState()}}onUserFacePress(e,t){let r=de.value===I.FACE_COLOR_MATCH;t===2&&(r=!r);const n=e?this.puzzle.stateProperty.value.getFaceColor(e):this.puzzle.stateProperty.value.getOutsideColor(),l=this.pendingActionFaceColorProperty.value;if(l){if(e!==l.face){const s=l.color;s!==n&&(r?this.applyUserActionToStack(new rr(Me(this.puzzle.stateProperty.value,n),Me(this.puzzle.stateProperty.value,s))):this.applyUserActionToStack(new nr(Me(this.puzzle.stateProperty.value,n),Me(this.puzzle.stateProperty.value,s))))}this.pendingActionFaceColorProperty.value=null,this.updateState()}else this.pendingActionFaceColorProperty.value={face:e,color:n}}onUserSectorPress(e,t){this.pendingActionSectorProperty.value=e}onUserSectorSet(e,t){this.applyUserActionToStack(new sr(e,t)),this.pendingActionSectorProperty.value=null,this.updateState()}onUserRequestSolve(){const e=this.puzzle.stateProperty.value;if(!ro(e))if(lo.value){const t=e.clone();Xe(to,this.puzzle.board,t,!0),this.pushTransitionAtCurrentPosition(new ke(this.puzzle.board,new Tt,t,!1)),this.updateState()}else{const t=Xo(this.puzzle.board,this.puzzle.stateProperty.value,{maxIterations:1e4,failOnMultipleSolutions:!0});if(t.length===1){const r=this.puzzle.stateProperty.value.clone();t[0].forEach(n=>{r.setEdgeState(n,T.BLACK)}),qt(this.puzzle.board,r,this.style.safeSolverFactoryProperty.value),this.pushTransitionAtCurrentPosition(new ke(this.puzzle.board,new Tt,r,!1)),this.updateState()}else t.length===0?console.log("No solution found"):console.log("Multiple solution found?!?")}}clearPendingHint(){this.hintStateProperty.value=U.DEFAULT,this.pendingHintActionProperty.value=null,this.hintWorkerMessageID=0}onHintReceived(e){this.hintStateProperty.value=e?U.FOUND:U.NOT_FOUND,e&&(this.pendingHintActionProperty.value=e)}onUserRequestHint(){if(this.clearPendingAction(),this.isSolvedProperty.value||this.pendingHintActionProperty.value)return;const e=le.allowEdgeEditProperty.value,t=le.allowFaceColorEditProperty.value,r=le.allowSectorEditProperty.value,n=le.vertexStateVisibleProperty.value,l=le.faceStateVisibleProperty.value;this.hintWorkerMessageID=Math.random();const s=Fn();if(!this.addedHintListener){this.addedHintListener=!0;const a=c=>{if(c.data.type==="hint-response"&&c.data.id===this.hintWorkerMessageID){const u=c.data.action?ar(this.puzzle.board,c.data.action):null;this.onHintReceived(u)}};s.addEventListener("message",a),this.disposeEmitter.addListener(()=>self.removeEventListener("message",a))}if(s.postMessage({type:"hint-request",id:this.hintWorkerMessageID,solveEdges:e,solveColors:t,solveSectors:r,solveVertexState:n,solveFaceState:l,serializedSolvablePuzzle:Ln(this.puzzle)}),We.value)this.hintStateProperty.value=U.SEARCHING;else{this.hintStateProperty.value=U.LOADING;const a=c=>{c&&(this.hintStateProperty.value===U.LOADING&&(this.hintStateProperty.value=U.SEARCHING),We.unlink(a))};We.link(a)}}onUserApplyHint(){const e=this.pendingHintActionProperty.value;e&&(this.clearPendingHint(),this.applyUserActionToStack(new En(e)),this.updateState())}}class ke{constructor(o,e,t,r=!1){this.board=o,this.action=e,this.state=t,this.errorDetected=r}}class Qe extends N{constructor(o,e,t){const r=re()({allowBarrierClickToHide:!0,panelOptions:{xMargin:15,yMargin:15,fill:y.uiBackgroundColorProperty,stroke:y.uiForegroundColorProperty}},t);super(),this.content=o,this.viewContext=e;const n=new Z({fill:y.barrierColorProperty});this.addChild(n),e.layoutBoundsProperty.link(s=>{n.rectBounds=s}),r.allowBarrierClickToHide&&n.addInputListener({down:()=>{this.hide()}});const l=new ze(o,r.panelOptions);e.layoutBoundsProperty.link(s=>{l.maxWidth=s.width*.9,l.maxHeight=s.height*.9}),this.addChild(new Ve(l,{alignBoundsProperty:e.layoutBoundsProperty,yAlign:"top",topMargin:50}))}show(){this.viewContext.glassPane.hasChild(this)||(this.reset(),this.viewContext.glassPane.addChild(this))}hide(){this.viewContext.glassPane.hasChild(this)&&this.viewContext.glassPane.removeChild(this)}reset(){}}class F extends Vo{constructor(o,e,t){const r=re()({advanced:!1,accessibleName:o,checkboxColor:y.uiForegroundColorProperty,checkboxColorBackground:y.uiBackgroundColorProperty},t),n=new V(o,{font:j,fill:y.uiForegroundColorProperty});r.advanced&&(r.visibleProperty=q),r.boxWidth=n.height,super(e,n,r)}}const oe=(i,o,e,t)=>{const r=new qo(o,e,{spacing:8,radioButtonOptions:{selectedColor:y.uiButtonBaseColorProperty,deselectedColor:y.uiBackgroundColorProperty,stroke:y.uiForegroundColorProperty}}),n=re()({stretch:!0,align:"left",spacing:10,children:[new V(i,{font:gt,fill:y.uiForegroundColorProperty}),r]},t);return new W(n)};class ge extends qe{constructor(o,e){const t=re()({advanced:!1,textFill:y.uiButtonForegroundProperty,baseColor:y.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:j,buttonAppearanceStrategy:Le},e);t.advanced&&(t.visibleProperty=q),super(o,t)}}class zn extends X{constructor(o,e,t,r){const n=re()({advanced:!1,onOffSwitchOptions:{size:new lt(40,20),trackFillLeft:y.uiButtonDisabledColorProperty,trackFillRight:y.uiButtonBaseColorProperty,accessibleName:e},spacing:10},r),l=new Uo(o,n.onOffSwitchOptions);n.children=[t,l],n.advanced&&(n.visibleProperty=q),super(n)}}class te extends zn{constructor(o,e,t){const r=re()({textOptions:{}},t),n=new O(e,r.textOptions);super(o,e,n,r)}}class uo extends Wo{constructor(o,e,t){super(o,e,Q({orientation:"horizontal",touchAreaYDilation:5,radioButtonOptions:{baseColor:y.uiButtonBaseColorProperty,disabledColor:y.uiButtonDisabledColorProperty,xMargin:8*1.3,yMargin:5*1.3,buttonAppearanceStrategyOptions:{selectedStroke:y.uiButtonSelectedStrokeColorProperty,deselectedStroke:y.uiButtonDeselectedStrokeColorProperty}}},t))}}const An=new H("M1024 640q0 106 -75 181t-181 75t-181 -75t-75 -181t75 -181t181 -75t181 75t75 181zM1536 749v-222q0 -12 -8 -23t-20 -13l-185 -28q-19 -54 -39 -91q35 -50 107 -138q10 -12 10 -25t-9 -23q-27 -37 -99 -108t-94 -71q-12 0 -26 9l-138 108q-44 -23 -91 -38q-16 -136 -29 -186q-7 -28 -36 -28h-222q-14 0 -24.5 8.5t-11.5 21.5l-28 184q-49 16 -90 37l-141 -107q-10 -9 -25 -9q-14 0 -25 11q-126 114 -165 168q-7 10 -7 23q0 12 8 23q15 21 51 66.5t54 70.5q-27 50 -41 99l-183 27q-13 2 -21 12.5t-8 23.5v222q0 12 8 23t19 13l186 28q14 46 39 92q-40 57 -107 138q-10 12 -10 24q0 10 9 23q26 36 98.5 107.5t94.5 71.5q13 0 26 -10l138 -107q44 23 91 38q16 136 29 186q7 28 36 28h222q14 0 24.5 -8.5t11.5 -21.5l28 -184q49 -16 90 -37l142 107q9 9 24 9q13 0 25 -10q129 -119 165 -170q7 -8 7 -22q0 -12 -8 -23q-15 -21 -51 -66.5t-54 -70.5q26 -50 41 -98l183 -28q13 -2 21 -12.5t8 -23.5z").makeImmutable(),Nn=new H("M979 1395q19 19 32 13t13 -32v-1472q0 -26 -13 -32t-32 13l-710 710q-9 9 -13 19v-678q0 -26 -19 -45t-45 -19h-128q-26 0 -45 19t-19 45v1408q0 26 19 45t45 19h128q26 0 45 -19t19 -45v-678q4 10 13 19z").makeImmutable(),xn=new H("M45 -115q-19 -19 -32 -13t-13 32v1472q0 26 13 32t32 -13l710 -710q9 -9 13 -19v678q0 26 19 45t45 19h128q26 0 45 -19t19 -45v-1408q0 -26 -19 -45t-45 -19h-128q-26 0 -45 19t-19 45v678q-4 -10 -13 -19z").makeImmutable(),Tn=new H("M1619 1395q19 19 32 13t13 -32v-1472q0 -26 -13 -32t-32 13l-710 710q-9 9 -13 19v-710q0 -26 -13 -32t-32 13l-710 710q-19 19 -19 45t19 45l710 710q19 19 32 13t13 -32v-710q4 10 13 19z").makeImmutable(),In=new H("M45 -115q-19 -19 -32 -13t-13 32v1472q0 26 13 32t32 -13l710 -710q9 -9 13 -19v710q0 26 13 32t32 -13l710 -710q19 -19 19 -45t-19 -45l-710 -710q-19 -19 -32 -13t-13 32v710q-4 -10 -13 -19z").makeImmutable(),Bn=new H("M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z").makeImmutable(),Rn=new H("M363 0l91 91l-235 235l-91 -91v-107h128v-128h107zM886 928q0 22 -22 22q-10 0 -17 -7l-542 -542q-7 -7 -7 -17q0 -22 22 -22q10 0 17 7l542 542q7 7 7 17zM832 1120l416 -416l-832 -832h-416v416zM1515 1024q0 -53 -37 -90l-166 -166l-416 416l166 165q36 38 90 38q53 0 91 -38l235 -234q37 -39 37 -91z").makeImmutable(),ue=(i,o)=>new _(i,Q({maxWidth:20,maxHeight:20,fill:"black"},o));class Ne{constructor(o,e){P(this,"timerListener",null);P(this,"tooltipNode",null);this.viewContext=o,this.tooltipTextOverride=e}showTooltip(o,e,t){if(!this.tooltipNode){this.tooltipNode=new ze(new V(o,{font:lr}),{cornerRadius:1,xMargin:2,yMargin:2});const r=this.viewContext.glassPane.globalToLocalPoint(t.point);this.tooltipNode.leftTop=r.plusXY(0,this.viewContext.glassPane.getUniqueTransform().transformDeltaY(20)),this.tooltipNode.bottom>this.viewContext.layoutBoundsProperty.value.bottom&&(this.tooltipNode.bottom=r.y-2),this.tooltipNode.left<this.viewContext.layoutBoundsProperty.value.left&&(this.tooltipNode.left=this.viewContext.layoutBoundsProperty.value.left+2),this.tooltipNode.right>this.viewContext.layoutBoundsProperty.value.right&&(this.tooltipNode.right=this.viewContext.layoutBoundsProperty.value.right-2),this.viewContext.glassPane.addChild(this.tooltipNode)}}hideTooltip(){this.tooltipNode&&(this.tooltipNode.dispose(),this.tooltipNode=null)}clearListener(){this.timerListener&&(Lt.clearTimeout(this.timerListener),this.timerListener=null)}enter(o){const e=o.currentTarget,t=this.tooltipTextOverride??(e==null?void 0:e.labelContent)??(e==null?void 0:e.accessibleName),r=o.pointer;e&&t&&this.timerListener===null&&(this.timerListener=Lt.setTimeout(()=>{this.showTooltip(t,e,r)},200))}exit(o){this.clearListener(),this.hideTooltip()}dispose(){this.clearListener(),this.hideTooltip()}}class je extends uo{constructor(o){const{basicLinesIcon:e,basicFaceColoringIcon:t,pureFaceColoringIcon:r,classicIcon:n,basicSectorsIcon:l,sectorsWithColorsIcon:s,vertexStateIcon:a,faceStateIcon:c,customIcon:u}=je.getIcons(),h=new Ne(o);super(Xt,[{value:Jt,createNode:()=>n,labelContent:"Classic",options:{}},{value:Kt,createNode:()=>e,labelContent:"Lines",options:{}},{value:Yt,createNode:()=>t,labelContent:"Lines and Colors",options:{}},{value:Zt,createNode:()=>r,labelContent:"Colors",options:{}},{value:Qt,createNode:()=>l,labelContent:"Sectors",options:{visibleProperty:q}},{value:jt,createNode:()=>s,labelContent:"Sectors and Colors",options:{visibleProperty:q}},{value:pt,createNode:()=>a,labelContent:"Vertex State",options:{visibleProperty:q}},{value:ht,createNode:()=>c,labelContent:"Face State",options:{visibleProperty:q}},{value:$t,createNode:()=>u,labelContent:"Custom",options:{visibleProperty:q}}]),this.children.forEach(E=>E.addInputListener(h)),o.layoutBoundsProperty.link(E=>{this.maxWidth=Math.max(1,E.width-2*Ce)})}static getIcons(){const o=new Z(0,0,15,15,{stroke:y.whiteLineColorProperty,fill:y.faceColorDefaultColorProperty}),e=new Z(0,0,15,15,{stroke:y.whiteLineColorProperty,fill:new J([y.faceColorBasicTargetColorProperty],S=>S.withAlpha(1))}),t=new _(new H().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:new J([y.simpleRegionTargetColorProperty],S=>S.withAlpha(1)),lineWidth:4,lineCap:"round",lineJoin:"round"}),r=new _(new H().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:y.blackLineColorProperty,lineWidth:4,lineCap:"round",lineJoin:"round"}),n=new _(new H().arc(0,0,9,0,Math.PI/2,!1),{stroke:y.sectorOnlyOneColorProperty}),l=new N({children:[o,t]}),s=new N({children:[e,r]}),a=new N({children:[new Z(0,0,15,15,{fill:y.uiForegroundColorProperty})]}),c=3,u=new H().moveTo(-c,-c).lineTo(c,c).moveTo(-c,c).lineTo(c,-c),h=new N({children:[new Z(0,0,15,15,{fill:y.puzzleBackgroundColorProperty}),new _(new H().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:y.blackLineColorProperty,lineWidth:3,lineCap:"square",lineJoin:"miter"}),new _(u,{stroke:y.xColorProperty,lineWidth:2,x:15,y:7.5})]}),E=new N({children:[o,n,t]}),L=new N({children:[e,n,r]}),v=no("eJytV11v2jAU/S9+9oOvv4PUh7VQqS+dNtZK08RDVlwUjQIiKWuF8t9nJw2JjWGJygtKfE7OuR/Oxdmjndnm2XqFRoDR73W6naPRHhXvG4NG6DrNzXW1hh2vyJ5Mjka/9ugNjQhG79Xvrr7ZubsSdzCoMYhh1MPAw5in6WO8xmhMU3iY/5ysMRZ7TnmY/5z24qQelnhx+hgQL5gABM8xAP3SMB/0axOAfnECUHierJxh9JxG+9k2mmDAFLPZhxJEKIA5Fpg2FBqhcCyxwqKhsAiFWRuNk4bCIxRqbWxVdcMREY6wPra4QBqSjJAS62SLDIe0VISknZctKBwy07HkSWVnA+Oz0hJRXqSF6bxAN+uXzdIUZpwWKaoL/pguX+v7lnbrrXcb464csW1Q61Lt1A5BhAQWEFRIoAFBHyu4rMx8YaZuIQh7Ytc/InYUF3FVhMwl/d0s7FgJnpiGkM+uFDD6a7LtfNJRdCHerJfrbaRu7TpGT+66Llxm5xiTIhESGNdaccnZB2Fa54a+PvyY3o0nnXpb7/Vms86zwhyk76yQ1QBOOFeESZ0w5cqWRdYDg7v7nvphoI0+EEEJIcIaJIoyCPQf7seTG+swRvF3uTzlt3pdLhsPRmXCtdAEEkpUfw8Y4KEp1ZpwpaWQjBHR14MOyQMEkTQhYK2EpL092AAPxaRilJKEckbFUb9PevAhHoqDtG2XTNreJ737IYb0I1ECqOBCJMDtzu3rIQd4cHBdUEwntlCgeuehhtTKblhCpSB2byXWp6+H7uNhwWy1S5fZ/ICh0XO6zI2bceap+DAKR1yANNzavL52dDtht8XRaDerubcGZTuMpUv7nABEBOgQARoRYEMEWESADBEQEQHVEeD/rUGsimKIgoq1AQbFEGsEkE+nMTAK/vkoookMqibEOmpD60q4v3h3qjJvsRfqMUCCT5H6wVNnJPTty9UVckFGeNDh5Wd4tMNji9M81lNPdPXO8FSHx8/l0U2YniNCX0Xel9jNZVERmwNbrJe33nrfg+6+PThX546XtNhmloh+OkM7pvMvq/dmNgdHWjgr5gZ9R6/VKravR1L0clLsclL8clJHHxCeFOutIy8X0tEniydFe+scfdmcTO1PbE/NyrL8B0eOKVk=");k()&&z(v);const f=new Zo(v.board.vertices[5],v.stateProperty,{...pt,allVertexStateVisibleProperty:new K(!0)}),C=new N({children:[f],scale:60}),d=new Qo(v.board.faces[5],v.stateProperty,ht),p=new N({children:[d],scale:30}),b=ue(Rn,{fill:y.uiForegroundColorProperty,matrix:new Wt().rowMajor(.75,0,0,0,-.75,0,0,0,1)}),m=new Ho;return{basicLinesIcon:m.createBox(l),basicFaceColoringIcon:m.createBox(s),pureFaceColoringIcon:m.createBox(a),classicIcon:m.createBox(h),basicSectorsIcon:m.createBox(E),sectorsWithColorsIcon:m.createBox(L),vertexStateIcon:m.createBox(C),faceStateIcon:m.createBox(p),customIcon:m.createBox(b)}}}const q=new Ke("advancedSettingsVisibleProperty",!1);class On extends Qe{constructor(o){const e=new Ne(o),t=new W({stretch:!0,align:"left",spacing:8,children:[new V("Solve After Every Move",{font:gt,fill:y.uiForegroundColorProperty}),new zt({xAlign:"left",yAlign:"top",xSpacing:20,ySpacing:8,columns:[[new F("Vertex Joint X",Hr),new F("Vertex Forced Line",Mr),new F("Vertex Forced X",Dr),new F("Completed Face X",Vr),new F("Completed Face Lines",qr),new F("Simple Loop X",Ur),new F("Simple Loop Lines",Wr),new F("Double Minus One Faces",Gr),new F("1/N-1 Sectors",Xr),new F("Simple Sectors",Jr),new F("Vertex X",Kr),new F("Vertex Lines",Yr),new F("Vertex Sectors",Zr),new F("Vertex Faces",Qr)],[new F("Color X",jr),new F("Color Lines",$r),new F("Color Parity X",_r),new F("Color Parity Lines",en),new F("Color Parity Colors",tn),new F("Color Parity Partial",on),new F("Vertex/Color To Face",rn),new F("Face X",nn),new F("Face Lines",sn),new F("Face Sectors",an),new F("Face Color",ln)]]})]}),r=oe("Theme",cr,It.map(d=>({value:d,createNode:()=>new V(d.name,{font:j,fill:y.uiForegroundColorProperty}),a11yName:d.name}))),n=new W({spacing:15,stretch:!0,visible:Ze.debugColors,children:It.filter(d=>d.isEditable).map(d=>new ge(`Edit ${d.name} Theme`,{listener:()=>{dr(d)}}))}),l=new W({stretch:!0,align:"left",spacing:8,children:[new V("Puzzle Display",{font:gt,fill:y.uiForegroundColorProperty}),new zt({xAlign:"left",yAlign:"top",xSpacing:20,ySpacing:8,columns:[[new F("Lines Visible",Bt),new F("Color Lines",ur,{enabledProperty:Bt,layoutOptions:{leftMargin:20}}),new F("Face Colors Visible",pr),new F("Sectors Visible",nt),new F("Sectors Next to Edges",hr,{advanced:!0,enabledProperty:nt,layoutOptions:{leftMargin:20}}),new F("Trivial Sectors",gr,{advanced:!0,enabledProperty:nt,layoutOptions:{leftMargin:20}}),new F("Vertex State",Rt),new F("All Vertex State",fr,{advanced:!0,enabledProperty:Rt,layoutOptions:{leftMargin:20}}),new F("Face State",yr,{advanced:!0})],[new F("Possible Line Visible",wr),new F("Impossible Line Visible",Ot),new F("Vertices Visible",Pr),new F("Vertices Small",mr),new F("Red X Visible",vr),new F("Red X Aligned",Sr)]]}),new X({spacing:20,visibleProperty:q,children:[oe("Line Join",Er,Cr.map(d=>({value:d,createNode:()=>new V(d,{font:j,fill:y.uiForegroundColorProperty}),labelContent:d}))),oe("Line Cap",kr,br.map(d=>({value:d,createNode:()=>new V(d,{font:j,fill:y.uiForegroundColorProperty}),labelContent:d}))),oe("Vertex Style",Lr,Fr.map(d=>({value:d,createNode:()=>new V(d,{font:j,fill:y.uiForegroundColorProperty}),labelContent:d}))),oe("Impossible Line Style",Ar,zr.map(d=>({value:d,createNode:()=>new V(d,{font:j,fill:y.uiForegroundColorProperty}),labelContent:d}))),oe("Face Value Style",xr,Nr.map(d=>({value:d,createNode:()=>new V(d,{font:j,fill:y.uiForegroundColorProperty}),labelContent:d})))]})]}),s=oe("Face Color Threshold",Tr,[{value:1,createNode:()=>new O("Show All"),labelContent:"Show All"},{value:2,createNode:()=>new O("2+"),labelContent:"2+"},{value:3,createNode:()=>new O("3+"),labelContent:"3+"},{value:5,createNode:()=>new O("5+"),labelContent:"5+"},{value:10,createNode:()=>new O("10+"),labelContent:"10+"},{value:Number.POSITIVE_INFINITY,createNode:()=>new O("Only Outside"),labelContent:"Only Outside"}]),a=new W({spacing:8,align:"left",stretch:!0,children:[new te(Ue,"Auto-Solve"),new te(cn,"Add Lines",{layoutOptions:{leftMargin:20},enabledProperty:Ue}),new te(dn,"Simple Loops",{layoutOptions:{leftMargin:20},enabledProperty:Ue}),new te(_t,"Show View Style Controls"),new te(Ot,"Show Impossible Lines"),new te(eo,"Show Elapsed Time"),new te(ft,"Show Undo-All / Redo-All",{advanced:!0}),new te(vt,"Show Layout Test",{advanced:!0}),new te(lo,"Solve Uses Built-In",{advanced:!0})]}),c=new Je(!1),u=J.and([q,c]),h=je.getIcons(),E=(d,p)=>new X({spacing:5,children:[new O(p),d]}),L=oe("View Style",Xt,[{value:Jt,createNode:()=>E(h.classicIcon,"Classic"),labelContent:"Classic"},{value:Kt,createNode:()=>E(h.basicLinesIcon,"Lines"),labelContent:"Lines"},{value:Yt,createNode:()=>E(h.basicFaceColoringIcon,"Lines and Colors"),labelContent:"Lines and Colors"},{value:Zt,createNode:()=>E(h.pureFaceColoringIcon,"Colors"),labelContent:"Colors"},{value:Qt,createNode:()=>E(h.basicSectorsIcon,"Sectors"),labelContent:"Sectors",options:{visibleProperty:q}},{value:jt,createNode:()=>E(h.sectorsWithColorsIcon,"Sectors and Colors"),labelContent:"Sectors and Colors",options:{visibleProperty:q}},{value:pt,createNode:()=>E(h.vertexStateIcon,"Vertex State"),labelContent:"Vertex State",options:{visibleProperty:q}},{value:ht,createNode:()=>E(h.faceStateIcon,"Face State"),labelContent:"Face State",options:{visibleProperty:q}},{value:$t,createNode:()=>E(h.customIcon,"Custom"),labelContent:"Custom",options:{visibleProperty:q}}]),v=new te(c,"Show Custom Options",{advanced:!0}),f=new W({spacing:20,align:"left",children:[new X({spacing:20,children:[t,s]}),l],visibleProperty:u}),C=new ge("Reload to Defaults",{accessibleName:"Clear all settings/data, and reload the page",listener:()=>{localStorage.clear(),self.location.reload()},advanced:!0});C.addInputListener(e),super(new W({spacing:20,align:"left",stretch:!0,children:[a,new X({align:"top",spacing:30,children:[L,r,n]}),v,f,C,new te(q,"Show Advanced Settings")]}),o)}}class Hn extends Qe{constructor(e){const t=new Je(!1),r=new ge("Copy URL",{accessibleName:"Copy Shareable URL to Clipboard",listener:()=>{if(this.puzzle){const n=location.protocol+"//"+location.host+location.pathname;let l=this.puzzle;this.includeStateProperty.value||(l=new he(l.board,oo.fromFaceValueData(l.board,l.stateProperty.value)));const s=io(l);Ir(n+"?p="+encodeURIComponent(s))}}});r.addInputListener(new Ne(e));super(new W({spacing:20,align:"left",stretch:!0,children:[r,new F("Include Solve Progress",t)]}),e);P(this,"includeStateProperty");P(this,"puzzle",null);this.includeStateProperty=t}setPuzzle(e){this.puzzle=e}reset(){super.reset(),this.includeStateProperty.reset()}}const ce=class ce extends wt{constructor(o){super(),this.canSolve=o}};P(ce,"STANDARD",new ce((o,e)=>(e=e.clone(),Xe(to,o,e,!0),ro(e)))),P(ce,"NO_LIMIT",new ce(()=>!0)),P(ce,"enumeration",new Pt(ce));let Ee=ce;const Ut=new Ye("canSolveDifficulty",Ee.STANDARD),Mn=i=>{const o=i.cleanState.clone();for(const e of i.board.faces)o.getFaceValue(e)===null&&o.setFaceValue(e,e.edges.filter(t=>i.blackEdges.has(t)).length);return Jo(i.board,o,i.blackEdges)};class Dn extends X{constructor(o,e){const t=new Go("polygonGeneratorProperty",{serialize:d=>d.name,deserialize:d=>Oe.find(p=>p.name===d)??Oe[0]}),r=localStorage.getItem("polygonGeneratorParameters")?JSON.parse(localStorage.getItem("polygonGeneratorParameters")):null;let n=!1;const l=oe("Patterns",t,Oe.map(d=>({value:d,createNode:()=>new V(d.name,{font:j,fill:y.uiForegroundColorProperty}),labelContent:d.name})),{layoutOptions:{align:"top",grow:0},justify:"top"}),s=new X({spacing:10,align:"center",layoutOptions:{grow:0},grow:1}),a=new X({spacing:10,align:"center",layoutOptions:{grow:0},children:[new O("Solver Difficulty"),new pn(Ut,[{value:Ee.STANDARD,createNode:()=>new O("Standard"),labelContent:"Standard"},{value:Ee.NO_LIMIT,createNode:()=>new O("No Limit"),labelContent:"No Limit"}],{orientation:"horizontal",align:"center",spacing:30})]}),c=new X({spacing:10,align:"center",justify:"spaceEvenly",layoutOptions:{grow:0}}),u=new N,h=new N,E=new Re;E.addListener(()=>{h.children=[]});const L=new N({children:[u,h]}),v=(d,p)=>{const b=d.generate(p),m=new H;b.forEach(S=>m.polygon(S)),u.children=[new _(m,{fill:y.puzzleBackgroundColorProperty,stroke:y.blackLineColorProperty,lineWidth:.05})],E.emit()};v(Oe[0],{width:5,height:5}),t.link(d=>{c.children.forEach(S=>S.dispose()),s.children.forEach(S=>S.dispose());const p={},b=S=>r&&!n&&S in r?r[S]:d.defaultParameterValues[S],m=()=>{localStorage.setItem("polygonGeneratorParameters",JSON.stringify(p)),v(d,p)};for(const[S,A]of Object.entries(d.parameters))if(A.type==="integer"){const x=new At(b(S));x.link(g=>{p[S]=g,m()}),c.addChild(new He(A.label,x,A.range,{layoutFunction:He.createLayoutFunction4(),titleNodeOptions:{font:j,fill:y.uiForegroundColorProperty},sliderOptions:{trackSize:new lt(100,5),labelTagName:"label",keyboardStep:1,labelContent:A.label},arrowButtonOptions:{touchAreaXDilation:5,touchAreaYDilation:25},numberDisplayOptions:{decimalPlaces:0},delta:1,visibleProperty:A.advanced?q:null}))}else if(A.type==="float"){const x=new At(b(S));x.link(g=>{p[S]=g,m()}),c.addChild(new He(A.label,x,A.range,{layoutFunction:He.createLayoutFunction4(),titleNodeOptions:{font:j,fill:y.uiForegroundColorProperty},sliderOptions:{trackSize:new lt(100,5),labelTagName:"label",keyboardStep:.1,labelContent:A.label},numberDisplayOptions:{decimalPlaces:2},delta:.01,visibleProperty:A.advanced?q:null}))}else if(A.type==="boolean"){const x=new Je(b(S));x.link(g=>{p[S]=g,m()}),c.addChild(new F(A.label,x,{advanced:A.advanced}))}else if(A.type==="choice"){const x=new yt(b(S));x.link(g=>{p[S]=g,m()}),c.addChild(oe(A.label,x,A.choices.map(g=>({value:g.value,createNode:()=>new V(g.label,{font:j,fill:y.uiForegroundColorProperty}),labelContent:g.label}))))}n=!0,s.addChild(new ge("Generate",{font:st,layoutOptions:{align:"center"},listener:async()=>{E.emit();const S=d.generate(p),A=new xo(S,d.scale??1),x=new K(!1),g=()=>{x.value=!0};E.addListener(g);const w=new Re,ne=new Re,se=new Re;se.addListener(()=>{h.children=[]}),w.addListener((R,M)=>{h.addChild(new _(H.polygon(S[R]),{fill:y.generateAddedFaceColorProperty,stroke:y.blackLineColorProperty,lineWidth:.05})),M!==null&&h.addChild(new V(`${M}`,{font:st,fill:y.faceValueColorProperty,maxWidth:.9,maxHeight:.9,center:Se(S[R])}))}),ne.addListener((R,M)=>{h.addChild(new _(H.polygon(S[R]),{fill:y.generateMinimizedFaceColorProperty,stroke:y.blackLineColorProperty,lineWidth:.05})),M!==null&&h.addChild(new V(`${M}`,{font:st,fill:y.faceValueColorProperty,maxWidth:.9,maxHeight:.9,center:Se(S[R])}))});try{const R=Ut.value,M=R.canSolve,Te=async()=>await _o(A,x,w),kt=async()=>{let et=await Te();if(R===Ee.NO_LIMIT)return et;{const wo=A.faces.filter(Be=>et.cleanState.getFaceValue(Be)===null),Ft=Mn(et);return wo.forEach(Be=>{w.emit(A.faces.indexOf(Be),Ft.cleanState.getFaceValue(Be))}),Ft}};let Ie=await kt();for(;!M(Ie.board,Ie.cleanState.clone());)se.emit(),Ie=await kt();const yo=await er(Ie,M,x,ne);tr(17,x),x.value||(h.children=[],C.loadPuzzle(he.fromSolvedPuzzle(yo)))}catch{}E.hasListener(g)&&E.removeListener(g)}}))});const f=new Z({fill:y.playAreaBackgroundColorProperty,sizable:!0,layoutOptions:{grow:1},children:[L]});mt.multilink([f.localPreferredWidthProperty,f.localPreferredHeightProperty,L.localBoundsProperty],(d,p,b)=>{if(d!==null&&p!==null&&b.isFinite()){const S=d-30,A=p-2*15,x=Math.min(S/b.width,A/b.height);L.setScaleMagnitude(x),L.centerX=d/2,L.centerY=p/2}});const C=re()({spacing:10,stretch:!0,children:[l,new W({spacing:10,stretch:!0,layoutOptions:{grow:1},children:[f,s,new dt,a,new dt,c]})]},e);super(C)}}const Vn="#444",qn="#fa0",Un="#888",Wn="#fff",Gn="#f00",Xn="#ff0",Jn="#ff0",Kn="#0f0",Yn="#0ff",Zn="#0af",Qn="#f0f";class jn extends Qe{constructor(e){const t=new X({children:[new V("Loading image...",{font:j,fill:y.uiForegroundColorProperty})]}),r=new N({children:[t]});super(r,e);P(this,"scanContentNode");P(this,"imageContainer");P(this,"solutionContainer");P(this,"blackImageLayer");P(this,"originalImageLayer");P(this,"thresholdImageLayer");P(this,"contourLayer");P(this,"puzzle",null);P(this,"rootContour",null);P(this,"contours",[]);P(this,"contourNodeMap",new Map);this.scanContentNode=r,this.blackImageLayer=new N,this.originalImageLayer=new N({visible:!1}),this.thresholdImageLayer=new N({visible:!1}),this.contourLayer=new N,this.imageContainer=new N({children:[this.blackImageLayer,this.originalImageLayer,this.thresholdImageLayer,this.contourLayer]}),this.solutionContainer=new N}getScanOptions(){return{originalImageCallback:e=>this.onOriginalImage(e),thresholdedImageCallback:e=>this.onThresholdedImage(e),rootContourCallback:e=>this.onRootContour(e),widestSubtreeCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeWidestContour()},dotContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeDotContour()},lineContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeLineContour()},zeroOuterContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeZeroOuterContour()},zeroInnerContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeZeroInnerContour()},oneContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeOneContour()},twoContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeTwoContour()},threeContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeThreeContour()},xContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeXContour()},unknownContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeUnknownContour()},debugImageCallback:e=>{},puzzleCallback:e=>this.onPuzzle(e),solutionsCallback:e=>this.onSolutions(e)}}onOriginalImage(e){this.originalImageLayer.addChild(new Nt(e)),this.blackImageLayer.addChild(Z.bounds(this.originalImageLayer.bounds,{fill:"black"})),this.scanContentNode.children=[new W({spacing:10,children:[this.imageContainer,this.solutionContainer]})]}onThresholdedImage(e){this.thresholdImageLayer.addChild(new Nt(e))}onRootContour(e){this.rootContour=e,this.contours=e.getDescendantContours();for(const t of this.contours){const r=new $n(t);this.contourNodeMap.set(t,r),this.contourLayer.addChild(r)}}onPuzzle(e){this.puzzle=e}onSolutions(e){if(e.length===1)this.hide();else{const t=this.puzzle;k()&&z(t);const r=t.board;if(e.length===0){Fe(r,t.stateProperty.value);const n=new me(t,{scale:20});this.solutionContainer.children=[new W({spacing:10,children:[new O("No Solutions Found"),n]})]}else{const n=new he(r,t.stateProperty.value.clone()),l=new he(r,t.stateProperty.value.clone()),s=new he(r,t.stateProperty.value.clone());e[0].forEach(h=>n.stateProperty.value.setEdgeState(h,T.BLACK)),e[1].forEach(h=>l.stateProperty.value.setEdgeState(h,T.BLACK)),r.edges.forEach(h=>{n.stateProperty.value.getEdgeState(h)!==l.stateProperty.value.getEdgeState(h)&&s.stateProperty.value.setEdgeState(h,T.BLACK)}),Fe(r,n.stateProperty.value),Fe(r,l.stateProperty.value),Fe(r,s.stateProperty.value);const a=new me(n,{scale:10}),c=new me(l,{scale:10}),u=new me(s,{scale:10});this.solutionContainer.children=[new W({spacing:10,children:[new O("Multiple Solutions Found"),new X({spacing:10,children:[new W({spacing:10,children:[a,new O("Solution A")]}),new W({spacing:10,children:[c,new O("Solution B")]}),new W({spacing:10,children:[u,new O("Difference")]})]})]})]}}}}class $n extends N{constructor(e){const t=new _(e.shape,{stroke:Vn});super({children:[t]});P(this,"path");this.contour=e,this.path=t}makeWidestContour(){this.path.stroke=qn}makeDotContour(){this.path.stroke=Un}makeLineContour(){this.path.stroke=Wn}makeXContour(){this.path.stroke=Gn}makeZeroOuterContour(){this.path.stroke=Xn}makeZeroInnerContour(){this.path.stroke=Jn}makeOneContour(){this.path.stroke=Kn}makeTwoContour(){this.path.stroke=Yn}makeThreeContour(){this.path.stroke=Zn}makeUnknownContour(){this.path.stroke=Qn}}class _n extends Qe{constructor(o,e){super(new W({spacing:20,align:"left",stretch:!0,children:[new N({children:[new Dn(o,{loadPuzzle:t=>{this.hide(),e.loadPuzzle(t)},preferredWidth:700,preferredHeight:300})]}),new dt,new X({spacing:15,grow:1,children:[new ge("Load String",{listener:()=>{this.hide();const t=prompt("Enter puzzle string");t&&e.loadPuzzle(he.loadDeprecatedScalaString(t))}}),new ge("Load Image (Rectangular Only)",{listener:()=>{this.hide();const t=document.createElement("input");t.type="file",t.onchange=r=>{const n=r.target.files[0];var l=new FileReader;l.readAsDataURL(n),l.onloadend=async()=>{const s=l.result,a=new jn(o);a.show();const c=await Co(s,a.getScanOptions());e.loadPuzzle(c)}},t.click()}})]})]}),o)}}class es extends V{constructor(o,e){const t=re()({font:Br,fill:y.uiForegroundColorProperty},e),r=60,n=60*r,l=24*n,s=new J([o],a=>{a=Math.ceil(a);const c=Math.floor(a/l);a-=c*l;const u=Math.floor(a/n);a-=u*n;const h=Math.floor(a/r);a-=h*r;const E=a,L=u<10?`0${u}`:`${u}`,v=h<10?`0${h}`:`${h}`,f=E<10?`0${E}`:`${E}`;return c?`${c}d ${L}:${v}:${f}`:u?`${L}:${v}:${f}`:`${v}:${f}`});super(s,t),this.timerProperty=o,this.disposeEmitter.addListener(()=>{s.dispose()})}}class ts extends X{constructor(o,e,t){const r=new Ne(e),n=new K(!1),l=new K(0),s=new K(U.NOT_FOUND),a=new pe(o,{derive:p=>p?p.undoPossibleProperty:n}),c=new pe(o,{derive:p=>p?p.redoPossibleProperty:n}),u=new pe(o,{derive:p=>p?p.isSolvedProperty:n}),h=new pe(o,{derive:p=>p?p.timeElapsedProperty:l}),E=new pe(o,{derive:p=>p?p.hintStateProperty:s}),L=new J([u],p=>!p);let v=null,f=null,C=null;const d={buttonAppearanceStrategy:Le,baseColor:y.uiButtonBaseColorProperty,disabledColor:y.uiButtonDisabledColorProperty,xMargin:8*1.3,yMargin:5*1.3,mouseAreaXDilation:5,mouseAreaYDilation:5,touchAreaXDilation:5,touchAreaYDilation:5};super({spacing:10,stretch:!0,children:[new qe("New",Q({},d,{accessibleName:"New",listener:()=>{v=v||new _n(e,{loadPuzzle:t.loadPuzzle}),v.show()},textFill:y.uiButtonForegroundProperty,baseColor:y.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:at,buttonAppearanceStrategy:Le})),new ye(Q({},d,{accessibleName:"Undo All",content:ue(Tn),listener:()=>{o.value&&o.value.onUserUndoAll()},enabledProperty:a,visibleProperty:ft})),new ye(Q({},d,{accessibleName:"Undo",content:ue(Nn),listener:()=>{o.value&&o.value.onUserUndo()},enabledProperty:a,fireOnHold:!0})),new es(h,{visibleProperty:eo}),new ye(Q({},d,{accessibleName:"Redo",content:ue(xn),listener:()=>{o.value&&o.value.onUserRedo()},enabledProperty:c,fireOnHold:!0})),new ye(Q({},d,{accessibleName:"Redo All",content:ue(In),listener:()=>{o.value&&o.value.onUserRedoAll()},enabledProperty:c,visibleProperty:ft})),new ye(Q({},d,{accessibleName:"Settings",content:ue(An),listener:()=>{C=C||new On(e),C.show()}})),new ye(Q({},d,{accessibleName:"Share",content:ue(Bn),listener:()=>{const p=o.value;p&&(f=f||new Hn(e),f.setPuzzle(p.puzzle),f.show())}})),new qe("Solve",Q({},d,{accessibleName:"Solve",listener:()=>{o.value&&o.value.onUserRequestSolve()},enabledProperty:L,textFill:y.uiButtonForegroundProperty,baseColor:y.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:at,buttonAppearanceStrategy:Le})),new qe("Hint",Q({},d,{accessibleName:"Hint",listener:()=>{o.value&&o.value.onUserRequestHint()},enabledProperty:new J([L,E],(p,b)=>p&&b===U.DEFAULT),textFill:y.uiButtonForegroundProperty,baseColor:y.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:at,buttonAppearanceStrategy:Le}))]}),this.puzzleModelProperty=o,this.children.forEach(p=>p.addInputListener(r)),e.layoutBoundsProperty.link(p=>{this.maxWidth=Math.max(1,p.width-2*Ce)})}}const xe=new N,St=new N,os=()=>{const i=Ze.p||localStorage.getItem("puzzleString"),o=he.loadDefaultPuzzle();let e=null,t=0;try{let r=o;if(i){const n=no(i);if(n){r=n;const l=localStorage.getItem("timeElapsedProperty");t=l?JSON.parse(l):0}}e=ut(r.board,r.stateProperty.value)}catch(r){console.error(r)}return e||(e=ut(o.board,o.stateProperty.value)),k()&&z(e),new co(e,{initialTimeElapsed:t})};class rs extends N{constructor(e,t,r){super({});P(this,"spinningIndicatorNode");this.spinningIndicatorNode=new Or({diameter:20});const n={xMargin:5,yMargin:5,fill:y.uiBackgroundColorProperty,stroke:y.uiForegroundColorProperty},l=new ze(new X({spacing:10,children:[new N({children:[this.spinningIndicatorNode]}),new O("Loading Hint Solver...")]}),n),s=new ze(new X({spacing:10,children:[new N({children:[this.spinningIndicatorNode]}),new O("Searching for Hint...")]}),n),a=new ge("Apply Hint",{listener:r}),c=new ze(new O("No Hint Found"),n);s.pickable=!1,c.pickable=!1;const u=h=>{this.children=[...h===U.LOADING?[l]:[],...h===U.SEARCHING?[s]:[],...h===U.FOUND?[a]:[],...h===U.NOT_FOUND?[c]:[]]};t.link(u),this.disposeEmitter.addListener(()=>t.unlink(u))}step(e){this.spinningIndicatorNode.step(e)}}class ns extends uo{constructor(o){const e=new Gt(0,0,15,0,{stroke:y.uiButtonForegroundProperty,lineWidth:4,lineCap:"round"}),t=6,r=new H().moveTo(-t,-t).lineTo(t,t).moveTo(-t,t).lineTo(t,-t),n=new _(r,{stroke:y.uiButtonForegroundProperty,lineWidth:2}),l=new N({children:[new Z(0,0,7,7,{stroke:y.uiButtonForegroundProperty,fill:y.uiForegroundColorProperty}),new Z(7,7,7,7,{stroke:y.uiButtonForegroundProperty,fill:y.uiForegroundColorProperty})]}),s=new N({children:[new Z(0,0,7,7,{stroke:y.uiButtonForegroundProperty,fill:y.uiForegroundColorProperty}),new Z(7,7,7,7,{stroke:y.uiButtonForegroundProperty,fill:y.uiBackgroundColorProperty})]}),a=new N({children:[new _(new H().moveTo(0,14).lineTo(0,0).lineTo(14,0),{stroke:y.uiButtonForegroundProperty}),new _(new H().arc(0,0,7,0,Math.PI/2,!1),{stroke:y.uiButtonForegroundProperty})]}),c=new Ne(o);super(de,[{value:I.EDGE_STATE,labelContent:"Edge Edit Mode",createNode:()=>e,options:{visibleProperty:I.EDGE_STATE.isEnabledProperty}},{value:I.EDGE_STATE_REVERSED,labelContent:"Edge Reversed Edit Mode",createNode:()=>n,options:{visibleProperty:I.EDGE_STATE_REVERSED.isEnabledProperty}},{value:I.FACE_COLOR_MATCH,labelContent:"Face Color Match Edit Mode",createNode:()=>l,options:{visibleProperty:I.FACE_COLOR_MATCH.isEnabledProperty}},{value:I.FACE_COLOR_OPPOSITE,labelContent:"Face Color Opposite Edit Mode",createNode:()=>s,options:{visibleProperty:I.FACE_COLOR_OPPOSITE.isEnabledProperty}},{value:I.SECTOR_STATE,labelContent:"Sector Edit Mode",createNode:()=>a,options:{visibleProperty:I.SECTOR_STATE.isEnabledProperty}}]),this.children.forEach(u=>u.addInputListener(c)),o.layoutBoundsProperty.link(u=>{this.maxWidth=Math.max(1,u.width-2*Ce)})}}class ss{constructor(o,e){this.layoutBoundsProperty=o,this.glassPane=e}}self.assertions;const as=new N({renderer:"svg",children:[xe]}),be=new Mo(as,{allowWebGL:!0,allowBackingScaleAntialiasing:!0,allowSceneOverflow:!1,accessibility:!0,backgroundColor:"#eee",assumeFullWindow:!0,listenToOnlyElement:Ze.debugColors});document.body.appendChild(be.domElement);be.setPointerAreaDisplayVisible(Ze.showPointerAreas);self.oncontextmenu=i=>i.preventDefault();const $e=new yt(new Ge(0,0,self.innerWidth,self.innerHeight)),ee=new K(os()),po=new so(ee,le,{layoutOptions:{stretch:!0,grow:1}}),ho=new so(ee,le,{layoutOptions:{stretch:!0,grow:1},topological:!0,visibleProperty:vt}),is=new Je(!1),ls=new pe(ee,{derive:i=>i?i.hasErrorProperty:is}),cs=new pe(ee,{derive:i=>i?i.hintStateProperty:new K(U.DEFAULT)});mt.multilink([ls,y.navbarBackgroundColorProperty,y.navbarErrorBackgroundColorProperty],(i,o,e)=>{be.backgroundColor=i?e:o});const Ct=new ss($e,St),go=new ts(ee,Ct,{loadPuzzle:i=>{const o=ut(i.board,i.stateProperty.value);o&&(ee.value=new co(o))}}),ds=new ns(Ct),us=new je({layoutBoundsProperty:$e,glassPane:St}),Et=new rs(Ct,cs,()=>{var i;(i=ee.value)==null||i.onUserApplyHint()}),ve=new W({stretch:!0,children:[new Ve(go,{margin:Ce}),new X({grow:1,stretch:!0,layoutOptions:{grow:1},children:[po,ho]}),new Ve(us,{margin:Ce,visibleProperty:_t}),new Ve(ds,{margin:Ce})]});$e.lazyLink(i=>{ve.preferredWidth=i.width,ve.preferredHeight=i.height,ve.x=i.left,ve.y=i.top});xe.addChild(ve);xe.addChild(Et);xe.addChild(St);Do.create(xe,[go,Et],(i,o)=>{o.centerTop=i.centerBottom.plusXY(0,5)});be.initializeEvents();let bt=!0;const fo=()=>{bt=!1;const i=new Ge(0,0,self.innerWidth,self.innerHeight);be.setWidthHeight(i.width,i.height),$e.value=i,To.mobileSafari&&self.scrollTo(0,0)},_e=()=>{bt=!0};$(self).resize(_e);self.addEventListener("resize",_e);self.addEventListener("orientationchange",_e);self.visualViewport&&self.visualViewport.addEventListener("resize",_e);fo();be.updateOnRequestAnimationFrame(i=>{var o;or(),bt&&fo(),ve.validateBounds(),po.step(i),ho.step(i),(o=ee.value)==null||o.step(i),Et.step(i)});document.addEventListener("keydown",i=>{var o,e,t,r;i.ctrlKey||i.metaKey?(i.key==="z"&&(i.shiftKey?(o=ee.value)==null||o.onUserRedo():(e=ee.value)==null||e.onUserUndo()),i.key==="y"&&((t=ee.value)==null||t.onUserRedo())):i.key==="1"?ae(I.EDGE_STATE):i.key==="2"?ae(I.EDGE_STATE_REVERSED):i.key==="3"?ae(I.FACE_COLOR_MATCH):i.key==="4"?ae(I.FACE_COLOR_OPPOSITE):i.key==="5"?ae(I.SECTOR_STATE):i.key==="6"?ae(I.VERTEX_STATE):i.key==="7"?ae(I.FACE_STATE):i.key==="8"?ae(I.FACE_VALUE):i.key==="9"?ae(I.DELETE_FACE):i.key==="Escape"&&((r=ee.value)==null||r.onUserEscape())});ee.lazyLink((i,o)=>{o&&o.dispose()});
