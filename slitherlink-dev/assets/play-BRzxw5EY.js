var lo=Object.defineProperty;var co=(u,o,e)=>o in u?lo(u,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[o]=e;var x=(u,o,e)=>co(u,typeof o!="symbol"?o+"":o,e);import{c as X,o as j,D as nt,T as pe,M as qe,E as uo,a as po,b as Ie,P as pt,V as te,d as fe,e as je,S as ho,f as M,B as Ue}from"./Vector2Property-mpypjo8N.js";import{s as go}from"./scanURL-BbaI4Qwa.js";import{P as U,N as k,R,A as De,T as q,s as vt,H as A,a as ge,b as zt,V as z,G as St,B as ht,c as bt,M as Ge,d as rt,I as Et,e as kt,f as fo,L as st,g as wo,h as we,i as yo,S as mo,j as Co,k as Po,l as vo,D as So,m as bo,n as We}from"./PhetioControlledVisibilityProperty-C-W8fgEx.js";import{L as Mt,P as Ne,C as Eo,T as Ve,O as ko,R as Io,V as Fo,M as No,a as Lo,b as xo,c as ne,B as ve,d as Bo}from"./localStorage-B8VWGy9j.js";import{B as Ao,a as To,b as Oo,c as zo,d as I,e as N,S as O,P as Mo,g as Se,L as Ro,f as Ho,h as at,_ as ye,i as Do,j as Qe,k as Vo}from"./patternBoards-59tNjMFd.js";import{S as Xe}from"./SlitherQueryParameters-D2_k1AAl.js";import{f as Rt,U as H,p as Ht,h as Dt,i as Vt,j as qt,k as Ut,l as Wt,s as ce,m as Gt,v as it,n as lt,o as Xt,V as qo,F as Uo,q as Wo,r as Go,t as ct,u as Xo,w as Yo,S as $e,x as Yt,y as Jt,z as dt,A as Jo,B as Ko,C as Fe,P as me,D as Zo,G as Y,H as gt,I as Ce,J as ae,K as jo,L as de,M as Qo,N as $o,O as _o,Q as ft,R as en}from"./DisplayEmbedding-Byxzyfzn.js";import{g as ut,a as tn,b as on,c as nn,d as rn,e as sn,f as an,h as ln,i as cn,j as dn,k as un,l as pn,m as hn,n as gn,o as fn,p as wn,q as yn,r as mn,s as Cn,t as Pn,u as vn,v as Sn,w as bn,x as En,y as kn,z as In,A as _e,B as Fn,C as Nn,D as Ln,E as xn}from"./SATSolver-I2LwIpNX.js";import{B as he,s as Bn,E as ie,C as Kt}from"./BasicPuzzle-D1EmEwC1.js";import{p as Zt}from"./puzzleFromCompressedString-oWwNtxBE.js";import{p as Me,g as An,a as Tn,i as On,A as zn,w as Mn}from"./AnnotationNode-wYz4OXLp.js";import{c as p,t as Rn,u as K,r as ue,a as be,b as le,d as It,e as Hn,p as Dn,f as Ft,g as Vn,h as qn,s as et,i as Un,j as Wn,v as Nt,k as Gn,m as Xn,w as Yn,n as Lt,o as Jn,q as Kn,x as Zn,y as jn,z as Qn,A as $n,B as _n,C as er,D as tr,E as or,F as nr,G as rr,H as sr,I as ar,J as ir,K as tt,L as lr,M as cr,N as dr,O as ot,P as ur}from"./Theme-D5xBVTq4.js";import{U as pr}from"./UIAquaRadioButtonGroup-DRiHdGZS.js";import{N as Re,S as hr,A as gr}from"./SpinningIndicatorNode-BFgzh9_P.js";import"./PatternRule-DfusC3Hu.js";import"./PatternBoardSolver-By-2anvW.js";const wt=new Mt("showLayoutTestProperty",!1);class He extends Ao{constructor(o,e,t){super(o,e,t)}}class xt extends To{constructor(e,t){super(e,t);x(this,"originalEdges",new Set)}}class Bt extends Oo{constructor(e,t){super(e.copy(),t.copy());x(this,"originalFace",null)}}class fr extends zo{constructor(o,e){super(o.copy(),e.copy())}}class At{constructor(o,e){this.faces=o,this.boundaryHalfEdges=e}}class wr{constructor(o,e,t){this.faces=o,this.boundaryHalfEdges=e,this.boundarySegments=t}}const yr=()=>{const u=Xe.p||localStorage.getItem("puzzleString"),o=he.loadDefaultPuzzle();let e=null,t=0;try{let n=o;if(u){const r=Zt(u);if(r){n=r;const a=localStorage.getItem("timeElapsedProperty");t=a?JSON.parse(a):0}}e=ut(n.board,n.stateProperty.value)}catch(n){console.error(n)}return e||(e=ut(o.board,o.stateProperty.value)),I()&&N(e),new Rt(e,{initialTimeElapsed:t})},mr=new O("M1024 640q0 106 -75 181t-181 75t-181 -75t-75 -181t75 -181t181 -75t181 75t75 181zM1536 749v-222q0 -12 -8 -23t-20 -13l-185 -28q-19 -54 -39 -91q35 -50 107 -138q10 -12 10 -25t-9 -23q-27 -37 -99 -108t-94 -71q-12 0 -26 9l-138 108q-44 -23 -91 -38q-16 -136 -29 -186q-7 -28 -36 -28h-222q-14 0 -24.5 8.5t-11.5 21.5l-28 184q-49 16 -90 37l-141 -107q-10 -9 -25 -9q-14 0 -25 11q-126 114 -165 168q-7 10 -7 23q0 12 8 23q15 21 51 66.5t54 70.5q-27 50 -41 99l-183 27q-13 2 -21 12.5t-8 23.5v222q0 12 8 23t19 13l186 28q14 46 39 92q-40 57 -107 138q-10 12 -10 24q0 10 9 23q26 36 98.5 107.5t94.5 71.5q13 0 26 -10l138 -107q44 23 91 38q16 136 29 186q7 28 36 28h222q14 0 24.5 -8.5t11.5 -21.5l28 -184q49 -16 90 -37l142 107q9 9 24 9q13 0 25 -10q129 -119 165 -170q7 -8 7 -22q0 -12 -8 -23q-15 -21 -51 -66.5t-54 -70.5q26 -50 41 -98l183 -28q13 -2 21 -12.5t8 -23.5z").makeImmutable(),Cr=new O("M979 1395q19 19 32 13t13 -32v-1472q0 -26 -13 -32t-32 13l-710 710q-9 9 -13 19v-678q0 -26 -19 -45t-45 -19h-128q-26 0 -45 19t-19 45v1408q0 26 19 45t45 19h128q26 0 45 -19t19 -45v-678q4 10 13 19z").makeImmutable(),Pr=new O("M45 -115q-19 -19 -32 -13t-13 32v1472q0 26 13 32t32 -13l710 -710q9 -9 13 -19v678q0 26 19 45t45 19h128q26 0 45 -19t19 -45v-1408q0 -26 -19 -45t-45 -19h-128q-26 0 -45 19t-19 45v678q-4 -10 -13 -19z").makeImmutable(),vr=new O("M1619 1395q19 19 32 13t13 -32v-1472q0 -26 -13 -32t-32 13l-710 710q-9 9 -13 19v-710q0 -26 -13 -32t-32 13l-710 710q-19 19 -19 45t19 45l710 710q19 19 32 13t13 -32v-710q4 10 13 19z").makeImmutable(),Sr=new O("M45 -115q-19 -19 -32 -13t-13 32v1472q0 26 13 32t32 -13l710 -710q9 -9 13 -19v710q0 26 13 32t32 -13l710 -710q19 -19 19 -45t-19 -45l-710 -710q-19 -19 -32 -13t-13 32v710q-4 -10 -13 -19z").makeImmutable(),br=new O("M503.691 189.836L327.687 37.851C312.281 24.546 288 35.347 288 56.015v80.053C127.371 137.907 0 170.1 0 322.326c0 61.441 39.581 122.309 83.333 154.132 13.653 9.931 33.111-2.533 28.077-18.631C66.066 312.814 132.917 274.316 288 272.085V360c0 20.7 24.3 31.453 39.687 18.164l176.004-152c11.071-9.562 11.086-26.753 0-36.328z").makeImmutable(),jt=new O("M363 0l91 91l-235 235l-91 -91v-107h128v-128h107zM886 928q0 22 -22 22q-10 0 -17 -7l-542 -542q-7 -7 -7 -17q0 -22 22 -22q10 0 17 7l542 542q7 7 7 17zM832 1120l416 -416l-832 -832h-416v416zM1515 1024q0 -53 -37 -90l-166 -166l-416 416l166 165q36 38 90 38q53 0 91 -38l235 -234q37 -39 37 -91z").makeImmutable(),Er=new O("M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 448c-110.532 0-200-89.431-200-200 0-110.495 89.472-200 200-200 110.491 0 200 89.471 200 200 0 110.53-89.431 200-200 200zm107.244-255.2c0 67.052-72.421 68.084-72.421 92.863V300c0 6.627-5.373 12-12 12h-45.647c-6.627 0-12-5.373-12-12v-8.659c0-35.745 27.1-50.034 47.579-61.516 17.561-9.845 28.324-16.541 28.324-29.579 0-17.246-21.999-28.693-39.784-28.693-23.189 0-33.894 10.977-48.942 29.969-4.057 5.12-11.46 6.071-16.666 2.124l-27.824-21.098c-5.107-3.872-6.251-11.066-2.644-16.363C184.846 131.491 214.94 112 261.794 112c49.071 0 101.45 38.304 101.45 88.8zM298 368c0 23.159-18.841 42-42 42s-42-18.841-42-42 18.841-42 42-42 42 18.841 42 42z").makeImmutable(),kr=new O("M352.201 425.775l-79.196 79.196c-9.373 9.373-24.568 9.373-33.941 0l-79.196-79.196c-15.119-15.119-4.411-40.971 16.971-40.97h51.162L228 284H127.196v51.162c0 21.382-25.851 32.09-40.971 16.971L7.029 272.937c-9.373-9.373-9.373-24.569 0-33.941L86.225 159.8c15.119-15.119 40.971-4.411 40.971 16.971V228H228V127.196h-51.23c-21.382 0-32.09-25.851-16.971-40.971l79.196-79.196c9.373-9.373 24.568-9.373 33.941 0l79.196 79.196c15.119 15.119 4.411 40.971-16.971 40.971h-51.162V228h100.804v-51.162c0-21.382 25.851-32.09 40.97-16.971l79.196 79.196c9.373 9.373 9.373 24.569 0 33.941L425.773 352.2c-15.119 15.119-40.971 4.411-40.97-16.971V284H284v100.804h51.23c21.382 0 32.09 25.851 16.971 40.971z").makeImmutable(),re=(u,o)=>new U(u,X({maxWidth:20,maxHeight:20,fill:"black"},o));class Le extends k{constructor(o,e,t){const n=j()({allowBarrierClickToHide:!0,panelOptions:{xMargin:15,yMargin:15,fill:p.uiBackgroundColorProperty,stroke:p.uiForegroundColorProperty}},t);super(),this.content=o,this.viewContext=e;const r=new R({fill:p.barrierColorProperty});this.addChild(r),e.layoutBoundsProperty.link(s=>{r.rectBounds=s}),n.allowBarrierClickToHide&&r.addInputListener({down:()=>{this.hide()}});const a=new Ne(o,n.panelOptions);e.layoutBoundsProperty.link(s=>{a.maxWidth=s.width*.9,a.maxHeight=s.height*.9}),this.addChild(new De(a,{alignBoundsProperty:e.layoutBoundsProperty,yAlign:"top",topMargin:50}))}show(){this.viewContext.glassPane.hasChild(this)||(this.reset(),this.viewContext.glassPane.addChild(this))}hide(){this.viewContext.glassPane.hasChild(this)&&this.viewContext.glassPane.removeChild(this)}reset(){}}class xe{constructor(o,e){x(this,"timerListener",null);x(this,"tooltipNode",null);this.viewContext=o,this.tooltipTextOverride=e}showTooltip(o,e,t){if(!this.tooltipNode){this.tooltipNode=new Ne(new q(o,{font:Rn}),{cornerRadius:1,xMargin:2,yMargin:2});const n=this.viewContext.glassPane.globalToLocalPoint(t.point);this.tooltipNode.leftTop=n.plusXY(0,this.viewContext.glassPane.getUniqueTransform().transformDeltaY(20)),this.tooltipNode.bottom>this.viewContext.layoutBoundsProperty.value.bottom&&(this.tooltipNode.bottom=n.y-2),this.tooltipNode.left<this.viewContext.layoutBoundsProperty.value.left&&(this.tooltipNode.left=this.viewContext.layoutBoundsProperty.value.left+2),this.tooltipNode.right>this.viewContext.layoutBoundsProperty.value.right&&(this.tooltipNode.right=this.viewContext.layoutBoundsProperty.value.right-2),this.viewContext.glassPane.addChild(this.tooltipNode)}}hideTooltip(){this.tooltipNode&&(this.tooltipNode.dispose(),this.tooltipNode=null)}clearListener(){this.timerListener&&(vt.clearTimeout(this.timerListener),this.timerListener=null)}enter(o){const e=o.currentTarget,t=o.pointer;if(e&&this.timerListener===null){const n=()=>{const r=this.tooltipTextOverride??(e==null?void 0:e.labelContent)??(e==null?void 0:e.accessibleName);if(r){this.showTooltip(r,e,t);let a=this.tooltipNode;const s=()=>{this.tooltipNode===a&&(this.hideTooltip(),n())};e.rendererSummaryRefreshEmitter.addListener(s),a.disposeEmitter.addListener(()=>{e.rendererSummaryRefreshEmitter.removeListener(s)})}};this.timerListener=vt.setTimeout(()=>{n()},200)}}exit(o){this.clearListener(),this.hideTooltip()}dispose(){this.clearListener(),this.hideTooltip()}}class F extends Eo{constructor(o,e,t){const n=j()({advanced:!1,accessibleName:o,checkboxColor:p.uiForegroundColorProperty,checkboxColorBackground:p.uiBackgroundColorProperty},t),r=new q(o,{font:K,fill:p.uiForegroundColorProperty});n.advanced&&(n.visibleProperty=J),n.boxWidth=r.height,super(e,r,n)}}class oe extends Ve{constructor(o,e){const t=j()({advanced:!1,textFill:p.uiButtonForegroundProperty,baseColor:p.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:K,buttonAppearanceStrategy:ue},e);t.advanced&&(t.visibleProperty=J),super(o,t)}}class Ir extends A{constructor(o,e,t,n){const r=j()({advanced:!1,onOffSwitchOptions:{size:new nt(40,20),trackFillLeft:p.uiButtonDisabledColorProperty,trackFillRight:p.uiButtonBaseColorProperty,accessibleName:e},spacing:10},n),a=new ko(o,r.onOffSwitchOptions);r.children=[t,a],r.advanced&&(r.visibleProperty=J),super(r)}}class W extends Ir{constructor(o,e,t){const n=j()({textOptions:{}},t),r=new H(e,n.textOptions);super(o,e,r,n)}}class Qt extends Io{constructor(o,e,t){super(o,e,X({orientation:"horizontal",touchAreaYDilation:5,radioButtonOptions:{baseColor:p.uiButtonBaseColorProperty,disabledColor:p.uiButtonDisabledColorProperty,xMargin:8*1.3,yMargin:5*1.3,buttonAppearanceStrategyOptions:{selectedStroke:p.uiButtonSelectedStrokeColorProperty,deselectedStroke:p.uiButtonDeselectedStrokeColorProperty}}},t))}}class Be extends Qt{constructor(o){const{basicLinesIcon:e,basicFaceColoringIcon:t,pureFaceColoringIcon:n,classicIcon:r,basicSectorsIcon:a,sectorsWithColorsIcon:s,vertexStateIcon:c,faceStateIcon:i,customIcon:l}=Be.getIcons(),g=new xe(o);super(Ht,[{value:Dt,createNode:()=>r,labelContent:"Classic",options:{}},{value:Vt,createNode:()=>e,labelContent:"Lines",options:{}},{value:qt,createNode:()=>t,labelContent:"Lines and Colors",options:{}},{value:Ut,createNode:()=>n,labelContent:"Colors",options:{}},{value:Wt,createNode:()=>a,labelContent:"Sectors",options:{visibleProperty:ce}},{value:Gt,createNode:()=>s,labelContent:"Sectors and Colors",options:{visibleProperty:ce}},{value:it,createNode:()=>c,labelContent:"Vertex State",options:{visibleProperty:J}},{value:lt,createNode:()=>i,labelContent:"Face State",options:{visibleProperty:J}},{value:Xt,createNode:()=>l,labelContent:"Custom",options:{visibleProperty:J}}]),this.children.forEach(C=>C.addInputListener(g)),o.layoutBoundsProperty.link(C=>{this.maxWidth=Math.max(1,C.width-2*be)})}static getIcons(){const o=new R(0,0,15,15,{stroke:p.whiteLineColorProperty,fill:p.faceColorDefaultColorProperty}),e=new R(0,0,15,15,{stroke:p.whiteLineColorProperty,fill:new ge([p.faceColorBasicTargetColorProperty],S=>S.withAlpha(1))}),t=new U(new O().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:new ge([p.simpleRegionTargetColorProperty],S=>S.withAlpha(1)),lineWidth:4,lineCap:"round",lineJoin:"round"}),n=new U(new O().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:p.blackLineColorProperty,lineWidth:4,lineCap:"round",lineJoin:"round"}),r=new U(new O().arc(0,0,9,0,Math.PI/2,!1),{stroke:p.sectorOnlyOneColorProperty}),a=new k({children:[o,t]}),s=new k({children:[e,n]}),c=new k({children:[new R(0,0,15,15,{fill:p.uiForegroundColorProperty})]}),i=3,l=new O().moveTo(-i,-i).lineTo(i,i).moveTo(-i,i).lineTo(i,-i),g=new k({children:[new R(0,0,15,15,{fill:p.puzzleBackgroundColorProperty}),new U(new O().moveTo(0,15).lineTo(0,0).lineTo(15,0).makeImmutable(),{stroke:p.blackLineColorProperty,lineWidth:3,lineCap:"square",lineJoin:"miter"}),new U(l,{stroke:p.xColorProperty,lineWidth:2,x:15,y:7.5})]}),C=new k({children:[o,r,t]}),E=new k({children:[e,r,n]}),P=Zt("eJytV11v2jAU/S9+9oOvv4PUh7VQqS+dNtZK08RDVlwUjQIiKWuF8t9nJw2JjWGJygtKfE7OuR/Oxdmjndnm2XqFRoDR73W6naPRHhXvG4NG6DrNzXW1hh2vyJ5Mjka/9ugNjQhG79Xvrr7ZubsSdzCoMYhh1MPAw5in6WO8xmhMU3iY/5ysMRZ7TnmY/5z24qQelnhx+hgQL5gABM8xAP3SMB/0axOAfnECUHierJxh9JxG+9k2mmDAFLPZhxJEKIA5Fpg2FBqhcCyxwqKhsAiFWRuNk4bCIxRqbWxVdcMREY6wPra4QBqSjJAS62SLDIe0VISknZctKBwy07HkSWVnA+Oz0hJRXqSF6bxAN+uXzdIUZpwWKaoL/pguX+v7lnbrrXcb464csW1Q61Lt1A5BhAQWEFRIoAFBHyu4rMx8YaZuIQh7Ytc/InYUF3FVhMwl/d0s7FgJnpiGkM+uFDD6a7LtfNJRdCHerJfrbaRu7TpGT+66Llxm5xiTIhESGNdaccnZB2Fa54a+PvyY3o0nnXpb7/Vms86zwhyk76yQ1QBOOFeESZ0w5cqWRdYDg7v7nvphoI0+EEEJIcIaJIoyCPQf7seTG+swRvF3uTzlt3pdLhsPRmXCtdAEEkpUfw8Y4KEp1ZpwpaWQjBHR14MOyQMEkTQhYK2EpL092AAPxaRilJKEckbFUb9PevAhHoqDtG2XTNreJ737IYb0I1ECqOBCJMDtzu3rIQd4cHBdUEwntlCgeuehhtTKblhCpSB2byXWp6+H7uNhwWy1S5fZ/ICh0XO6zI2bceap+DAKR1yANNzavL52dDtht8XRaDerubcGZTuMpUv7nABEBOgQARoRYEMEWESADBEQEQHVEeD/rUGsimKIgoq1AQbFEGsEkE+nMTAK/vkoookMqibEOmpD60q4v3h3qjJvsRfqMUCCT5H6wVNnJPTty9UVckFGeNDh5Wd4tMNji9M81lNPdPXO8FSHx8/l0U2YniNCX0Xel9jNZVERmwNbrJe33nrfg+6+PThX546XtNhmloh+OkM7pvMvq/dmNgdHWjgr5gZ9R6/VKravR1L0clLsclL8clJHHxCeFOutIy8X0tEniydFe+scfdmcTO1PbE/NyrL8B0eOKVk=");I()&&N(P);const w=new qo(P.board.vertices[5],P.stateProperty,{...it,allVertexStateVisibleProperty:new pe(!0)}),b=new k({children:[w],scale:60}),d=new Uo(P.board.faces[5],P.stateProperty,lt),h=new k({children:[d],scale:30}),y=re(jt,{fill:p.uiForegroundColorProperty,matrix:new qe().rowMajor(.75,0,0,0,-.75,0,0,0,1)}),v=new zt;return{basicLinesIcon:v.createBox(a),basicFaceColoringIcon:v.createBox(s),pureFaceColoringIcon:v.createBox(c),classicIcon:v.createBox(g),basicSectorsIcon:v.createBox(C),sectorsWithColorsIcon:v.createBox(E),vertexStateIcon:v.createBox(b),faceStateIcon:v.createBox(h),customIcon:v.createBox(y)}}}const Q=(u,o,e,t)=>{const n=new Fo(o,e,{spacing:8,radioButtonOptions:{selectedColor:p.uiButtonBaseColorProperty,deselectedColor:p.uiBackgroundColorProperty,stroke:p.uiForegroundColorProperty}}),r=j()({stretch:!0,align:"left",spacing:10,children:[new q(u,{font:le,fill:p.uiForegroundColorProperty}),n]},t);return new z(r)},J=new Mt("advancedSettingsVisibleProperty",!1);class Fr extends Le{constructor(o){const e=new xe(o),t=new z({stretch:!0,align:"left",spacing:8,children:[new q("Solve After Every Move",{font:le,fill:p.uiForegroundColorProperty}),new St({xAlign:"left",yAlign:"top",xSpacing:20,ySpacing:8,columns:[[new F("Vertex Joint X",tn),new F("Vertex Forced Line",on),new F("Vertex Forced X",nn),new F("Completed Face X",rn),new F("Completed Face Lines",sn),new F("Simple Loop X",an),new F("Simple Loop Lines",ln),new F("Double Minus One Faces",cn),new F("1/N-1 Sectors",dn),new F("Simple Sectors",un),new F("Vertex X",pn),new F("Vertex Lines",hn),new F("Vertex Sectors",gn),new F("Vertex Faces",fn)],[new F("Color X",wn),new F("Color Lines",yn),new F("Color Parity X",mn),new F("Color Parity Lines",Cn),new F("Color Parity Colors",Pn),new F("Color Parity Partial",vn),new F("Vertex/Color To Face",Sn),new F("Face X",bn),new F("Face Lines",En),new F("Face Sectors",kn),new F("Face Color",In)]]})]}),n=Q("Theme",Hn,It.map(d=>({value:d,createNode:()=>new q(d.name,{font:K,fill:p.uiForegroundColorProperty}),a11yName:d.name}))),r=new z({spacing:15,stretch:!0,visible:Xe.debugColors,children:It.filter(d=>d.isEditable).map(d=>new oe(`Edit ${d.name} Theme`,{listener:()=>{Dn(d)}}))}),a=new z({stretch:!0,align:"left",spacing:8,children:[new q("Puzzle Display",{font:le,fill:p.uiForegroundColorProperty}),new St({xAlign:"left",yAlign:"top",xSpacing:20,ySpacing:8,columns:[[new F("Lines Visible",Ft),new F("Color Lines",Vn,{enabledProperty:Ft,layoutOptions:{leftMargin:20}}),new F("Face Colors Visible",qn),new F("Sectors Visible",et),new F("Sectors Next to Edges",Un,{advanced:!0,enabledProperty:et,layoutOptions:{leftMargin:20}}),new F("Trivial Sectors",Wn,{advanced:!0,enabledProperty:et,layoutOptions:{leftMargin:20}}),new F("Vertex State",Nt),new F("All Vertex State",Gn,{advanced:!0,enabledProperty:Nt,layoutOptions:{leftMargin:20}}),new F("Face State",Xn,{advanced:!0})],[new F("Possible Line Visible",Yn),new F("Impossible Line Visible",Lt),new F("Vertices Visible",Jn),new F("Vertices Small",Kn),new F("Red X Visible",Zn),new F("Red X Aligned",jn)]]}),new A({spacing:20,visibleProperty:J,children:[Q("Line Join",$n,Qn.map(d=>({value:d,createNode:()=>new q(d,{font:K,fill:p.uiForegroundColorProperty}),labelContent:d}))),Q("Line Cap",er,_n.map(d=>({value:d,createNode:()=>new q(d,{font:K,fill:p.uiForegroundColorProperty}),labelContent:d}))),Q("Vertex Style",or,tr.map(d=>({value:d,createNode:()=>new q(d,{font:K,fill:p.uiForegroundColorProperty}),labelContent:d}))),Q("Impossible Line Style",rr,nr.map(d=>({value:d,createNode:()=>new q(d,{font:K,fill:p.uiForegroundColorProperty}),labelContent:d}))),Q("Face Value Style",ar,sr.map(d=>({value:d,createNode:()=>new q(d,{font:K,fill:p.uiForegroundColorProperty}),labelContent:d})))]})]}),s=Q("Face Color Threshold",ir,[{value:1,createNode:()=>new H("Show All"),labelContent:"Show All"},{value:2,createNode:()=>new H("2+"),labelContent:"2+"},{value:3,createNode:()=>new H("3+"),labelContent:"3+"},{value:5,createNode:()=>new H("5+"),labelContent:"5+"},{value:10,createNode:()=>new H("10+"),labelContent:"10+"},{value:Number.POSITIVE_INFINITY,createNode:()=>new H("Only Outside"),labelContent:"Only Outside"}]),c=new z({spacing:8,align:"left",stretch:!0,children:[new W(_e,"Auto-Solve"),new W(Fn,"Add Lines",{layoutOptions:{leftMargin:20},enabledProperty:_e}),new W(Nn,"Simple Loops",{layoutOptions:{leftMargin:20},enabledProperty:_e}),new H("Highlights"),new W(Wo,"Dim Completed Numbers",{layoutOptions:{leftMargin:20}}),new W(Go,"Highlight Incorrect Numbers",{layoutOptions:{leftMargin:20}}),new W(ct,"Highlight Incorrect Moves",{layoutOptions:{leftMargin:20}}),new W(Xo,"Highlight Intersecting Lines",{layoutOptions:{leftMargin:20}}),new W(new No(Yo,{bidirectional:!0,map:d=>d===$e.CYCLIC,inverseMap:d=>d?$e.CYCLIC:$e.TOGGLE}),"Cycle Between States"),new W(Yt,"Show View Style Controls"),new W(Lt,"Show Impossible Lines"),new W(Jt,"Show Elapsed Time"),new W(ce,"Enable Sector View Styles"),new W(dt,"Show Undo-All / Redo-All",{advanced:!0}),new W(wt,"Show Layout Test",{advanced:!0}),new W(Jo,"Solve Uses Built-In",{advanced:!0})]}),i=new ht(!1),l=ge.and([J,i]),g=Be.getIcons(),C=(d,h)=>new A({spacing:5,children:[new H(h),d]}),E=Q("View Style",Ht,[{value:Dt,createNode:()=>C(g.classicIcon,"Classic"),labelContent:"Classic"},{value:Vt,createNode:()=>C(g.basicLinesIcon,"Lines"),labelContent:"Lines"},{value:qt,createNode:()=>C(g.basicFaceColoringIcon,"Lines and Colors"),labelContent:"Lines and Colors"},{value:Ut,createNode:()=>C(g.pureFaceColoringIcon,"Colors"),labelContent:"Colors"},{value:Wt,createNode:()=>C(g.basicSectorsIcon,"Sectors"),labelContent:"Sectors",options:{visibleProperty:ce}},{value:Gt,createNode:()=>C(g.sectorsWithColorsIcon,"Sectors and Colors"),labelContent:"Sectors and Colors",options:{visibleProperty:ce}},{value:it,createNode:()=>C(g.vertexStateIcon,"Vertex State"),labelContent:"Vertex State",options:{visibleProperty:J}},{value:lt,createNode:()=>C(g.faceStateIcon,"Face State"),labelContent:"Face State",options:{visibleProperty:J}},{value:Xt,createNode:()=>C(g.customIcon,"Custom"),labelContent:"Custom",options:{visibleProperty:J}}]),P=new W(i,"Show Custom Options",{advanced:!0}),w=new z({spacing:20,align:"left",children:[new A({spacing:20,children:[t,s]}),a],visibleProperty:l}),b=new oe("Reload to Defaults",{accessibleName:"Clear all settings/data, and reload the page",listener:()=>{localStorage.clear(),self.location.reload()},advanced:!0});b.addInputListener(e),super(new z({spacing:20,align:"left",stretch:!0,children:[c,new A({align:"top",spacing:30,children:[E,n,r]}),P,w,b,new W(J,"Show Advanced Settings")]}),o)}}const se=class se extends uo{constructor(o){super(),this.canSolve=o}};x(se,"STANDARD",new se((o,e)=>(e=e.clone(),Ln(Ko,o,e,!0),Bn(e)))),x(se,"NO_LIMIT",new se(()=>!0)),x(se,"enumeration",new po(se));let Ee=se;const Tt=new Lo("canSolveDifficulty",Ee.STANDARD),Nr=u=>{const o=u.cleanState.clone();for(const e of u.board.faces)o.getFaceValue(e)===null&&o.setFaceValue(e,e.edges.filter(t=>u.blackEdges.has(t)).length);return xn(u.board,o,u.blackEdges)};class Lr extends A{constructor(o,e){const t=new xo("polygonGeneratorProperty",{serialize:d=>d.name,deserialize:d=>Me.find(h=>h.name===d)??Me[0]}),n=localStorage.getItem("polygonGeneratorParameters")?JSON.parse(localStorage.getItem("polygonGeneratorParameters")):null;let r=!1;const a=Q("Patterns",t,Me.map(d=>({value:d,createNode:()=>new q(d.name,{font:K,fill:p.uiForegroundColorProperty}),labelContent:d.name})),{layoutOptions:{align:"top",grow:0},justify:"top"}),s=new A({spacing:10,align:"center",layoutOptions:{grow:0},grow:1}),c=new A({spacing:10,align:"center",layoutOptions:{grow:0},children:[new H("Solver Difficulty"),new pr(Tt,[{value:Ee.STANDARD,createNode:()=>new H("Standard"),labelContent:"Standard"},{value:Ee.NO_LIMIT,createNode:()=>new H("No Limit"),labelContent:"No Limit"}],{orientation:"horizontal",align:"center",spacing:30})]}),i=new A({spacing:10,align:"center",justify:"spaceEvenly",layoutOptions:{grow:0}}),l=new k,g=new k,C=new Ie;C.addListener(()=>{g.children=[]});const E=new k({children:[l,g]}),P=(d,h)=>{const y=d.generate(h),v=new O;y.forEach(S=>v.polygon(S)),l.children=[new U(v,{fill:p.puzzleBackgroundColorProperty,stroke:p.blackLineColorProperty,lineWidth:.05})],C.emit()};P(Me[0],{width:5,height:5}),t.link(d=>{i.children.forEach(S=>S.dispose()),s.children.forEach(S=>S.dispose());const h={},y=S=>n&&!r&&S in n?n[S]:d.defaultParameterValues[S],v=()=>{localStorage.setItem("polygonGeneratorParameters",JSON.stringify(h)),P(d,h)};for(const[S,L]of Object.entries(d.parameters))if(L.type==="integer"){const B=new bt(y(S));B.link(f=>{h[S]=f,v()}),i.addChild(new Re(L.label,B,L.range,{layoutFunction:Re.createLayoutFunction4(),titleNodeOptions:{font:K,fill:p.uiForegroundColorProperty},sliderOptions:{trackSize:new nt(100,5),labelTagName:"label",keyboardStep:1,labelContent:L.label},arrowButtonOptions:{touchAreaXDilation:5,touchAreaYDilation:25},numberDisplayOptions:{decimalPlaces:0},delta:1,visibleProperty:L.advanced?J:null}))}else if(L.type==="float"){const B=new bt(y(S));B.link(f=>{h[S]=f,v()}),i.addChild(new Re(L.label,B,L.range,{layoutFunction:Re.createLayoutFunction4(),titleNodeOptions:{font:K,fill:p.uiForegroundColorProperty},sliderOptions:{trackSize:new nt(100,5),labelTagName:"label",keyboardStep:.1,labelContent:L.label},numberDisplayOptions:{decimalPlaces:2},delta:.01,visibleProperty:L.advanced?J:null}))}else if(L.type==="boolean"){const B=new ht(y(S));B.link(f=>{h[S]=f,v()}),i.addChild(new F(L.label,B,{advanced:L.advanced}))}else if(L.type==="choice"){const B=new pt(y(S));B.link(f=>{h[S]=f,v()}),i.addChild(Q(L.label,B,L.choices.map(f=>({value:f.value,createNode:()=>new q(f.label,{font:K,fill:p.uiForegroundColorProperty}),labelContent:f.label}))))}r=!0,s.addChild(new oe("Generate",{font:tt,layoutOptions:{align:"center"},listener:async()=>{C.emit();const S=d.generate(h),L=new Mo(S,d.scale??1),B=new pe(!1),f=()=>{B.value=!0};C.addListener(f);const m=new Ie,_=new Ie,ee=new Ie;ee.addListener(()=>{g.children=[]}),m.addListener((D,V)=>{g.addChild(new U(O.polygon(S[D]),{fill:p.generateAddedFaceColorProperty,stroke:p.blackLineColorProperty,lineWidth:.05})),V!==null&&g.addChild(new q(`${V}`,{font:tt,fill:p.faceValueColorProperty,maxWidth:.9,maxHeight:.9,center:Se(S[D])}))}),_.addListener((D,V)=>{g.addChild(new U(O.polygon(S[D]),{fill:p.generateMinimizedFaceColorProperty,stroke:p.blackLineColorProperty,lineWidth:.05})),V!==null&&g.addChild(new q(`${V}`,{font:tt,fill:p.faceValueColorProperty,maxWidth:.9,maxHeight:.9,center:Se(S[D])}))});try{const D=Tt.value,V=D.canSolve,Te=async()=>await An(L,B,m),Ct=async()=>{let Ze=await Te();if(D===Ee.NO_LIMIT)return Ze;{const io=L.faces.filter(ze=>Ze.cleanState.getFaceValue(ze)===null),Pt=Nr(Ze);return io.forEach(ze=>{m.emit(L.faces.indexOf(ze),Pt.cleanState.getFaceValue(ze))}),Pt}};let Oe=await Ct();for(;!V(Oe.board,Oe.cleanState.clone());)ee.emit(),Oe=await Ct();const ao=await Tn(Oe,V,B,_);On(17,B),B.value||(g.children=[],b.loadPuzzle(he.fromSolvedPuzzle(ao)))}catch{}C.hasListener(f)&&C.removeListener(f)}}))});const w=new R({fill:p.playAreaBackgroundColorProperty,sizable:!0,layoutOptions:{grow:1},children:[E]});Ge.multilink([w.localPreferredWidthProperty,w.localPreferredHeightProperty,E.localBoundsProperty],(d,h,y)=>{if(d!==null&&h!==null&&y.isFinite()){const S=d-30,L=h-2*15,B=Math.min(S/y.width,L/y.height);E.setScaleMagnitude(B),E.centerX=d/2,E.centerY=h/2}});const b=j()({spacing:10,stretch:!0,children:[a,new z({spacing:10,stretch:!0,layoutOptions:{grow:1},children:[w,s,new rt,c,new rt,i]})]},e);super(b)}}const xr="#444",Br="#fa0",Ar="#888",Tr="#fff",Or="#f00",zr="#ff0",Mr="#ff0",Rr="#0f0",Hr="#0ff",Dr="#0af",Vr="#f0f";class qr extends Le{constructor(e){const t=new A({children:[new q("Loading image...",{font:K,fill:p.uiForegroundColorProperty})]}),n=new k({children:[t]});super(n,e);x(this,"scanContentNode");x(this,"imageContainer");x(this,"solutionContainer");x(this,"blackImageLayer");x(this,"originalImageLayer");x(this,"thresholdImageLayer");x(this,"contourLayer");x(this,"puzzle",null);x(this,"rootContour",null);x(this,"contours",[]);x(this,"contourNodeMap",new Map);this.scanContentNode=n,this.blackImageLayer=new k,this.originalImageLayer=new k({visible:!1}),this.thresholdImageLayer=new k({visible:!1}),this.contourLayer=new k,this.imageContainer=new k({children:[this.blackImageLayer,this.originalImageLayer,this.thresholdImageLayer,this.contourLayer]}),this.solutionContainer=new k}getScanOptions(){return{originalImageCallback:e=>this.onOriginalImage(e),thresholdedImageCallback:e=>this.onThresholdedImage(e),rootContourCallback:e=>this.onRootContour(e),widestSubtreeCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeWidestContour()},dotContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeDotContour()},lineContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeLineContour()},zeroOuterContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeZeroOuterContour()},zeroInnerContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeZeroInnerContour()},oneContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeOneContour()},twoContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeTwoContour()},threeContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeThreeContour()},xContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeXContour()},unknownContourCallback:e=>{var t;return(t=this.contourNodeMap.get(e))==null?void 0:t.makeUnknownContour()},debugImageCallback:e=>{},puzzleCallback:e=>this.onPuzzle(e),solutionsCallback:e=>this.onSolutions(e)}}onOriginalImage(e){this.originalImageLayer.addChild(new Et(e)),this.blackImageLayer.addChild(R.bounds(this.originalImageLayer.bounds,{fill:"black"})),this.scanContentNode.children=[new z({spacing:10,children:[this.imageContainer,this.solutionContainer]})]}onThresholdedImage(e){this.thresholdImageLayer.addChild(new Et(e))}onRootContour(e){this.rootContour=e,this.contours=e.getDescendantContours();for(const t of this.contours){const n=new Ur(t);this.contourNodeMap.set(t,n),this.contourLayer.addChild(n)}}onPuzzle(e){this.puzzle=e}onSolutions(e){if(e.length===1)this.hide();else{const t=this.puzzle;I()&&N(t);const n=t.board;if(e.length===0){Fe(n,t.stateProperty.value);const r=new me(t,{scale:20});this.solutionContainer.children=[new z({spacing:10,children:[new H("No Solutions Found"),r]})]}else{const r=new he(n,t.stateProperty.value.clone()),a=new he(n,t.stateProperty.value.clone()),s=new he(n,t.stateProperty.value.clone());e[0].forEach(g=>r.stateProperty.value.setEdgeState(g,ie.BLACK)),e[1].forEach(g=>a.stateProperty.value.setEdgeState(g,ie.BLACK)),n.edges.forEach(g=>{r.stateProperty.value.getEdgeState(g)!==a.stateProperty.value.getEdgeState(g)&&s.stateProperty.value.setEdgeState(g,ie.BLACK)}),Fe(n,r.stateProperty.value),Fe(n,a.stateProperty.value),Fe(n,s.stateProperty.value);const c=new me(r,{scale:10}),i=new me(a,{scale:10}),l=new me(s,{scale:10});this.solutionContainer.children=[new z({spacing:10,children:[new H("Multiple Solutions Found"),new A({spacing:10,children:[new z({spacing:10,children:[c,new H("Solution A")]}),new z({spacing:10,children:[i,new H("Solution B")]}),new z({spacing:10,children:[l,new H("Difference")]})]})]})]}}}}class Ur extends k{constructor(e){const t=new U(e.shape,{stroke:xr});super({children:[t]});x(this,"path");this.contour=e,this.path=t}makeWidestContour(){this.path.stroke=Br}makeDotContour(){this.path.stroke=Ar}makeLineContour(){this.path.stroke=Tr}makeXContour(){this.path.stroke=Or}makeZeroOuterContour(){this.path.stroke=zr}makeZeroInnerContour(){this.path.stroke=Mr}makeOneContour(){this.path.stroke=Rr}makeTwoContour(){this.path.stroke=Hr}makeThreeContour(){this.path.stroke=Dr}makeUnknownContour(){this.path.stroke=Vr}}class Wr extends Le{constructor(o,e){super(new z({spacing:20,align:"left",stretch:!0,children:[new k({children:[new Lr(o,{loadPuzzle:t=>{this.hide(),e.loadPuzzle(t)},preferredWidth:700,preferredHeight:300})]}),new rt,new A({spacing:15,grow:1,children:[new oe("Load String",{listener:()=>{this.hide();const t=prompt("Enter puzzle string");t&&e.loadPuzzle(he.loadDeprecatedScalaString(t))}}),new oe("Load Image (Rectangular Only)",{listener:()=>{this.hide();const t=document.createElement("input");t.type="file",t.onchange=n=>{const r=n.target.files[0];var a=new FileReader;a.readAsDataURL(r),a.onloadend=async()=>{const s=a.result,c=new qr(o);c.show();const i=await go(s,c.getScanOptions());e.loadPuzzle(i)}},t.click()}})]})]}),o)}}class Gr extends ne{constructor(o){const e=j()({advanced:!1,baseColor:p.uiButtonBaseColorProperty,xMargin:5,yMargin:5,buttonAppearanceStrategy:ue},o);e.advanced&&(e.visibleProperty=J),super(e)}}class Xr{constructor(o,e,t,n){x(this,"maxLineWidth");x(this,"disposeFlatAppearanceStrategy");const r=new kt(t,{luminanceFactor:-.3}),a=new kt(t,{luminanceFactor:-.6}),s=r,c=a,i=X({stroke:a},n),l=1.5;o.stroke=i.stroke||a,o.lineWidth=l,this.maxLineWidth=1.5,o.cachedPaints=[t,s,c];function g(C){let E=1,P=1;switch(C){case ve.IDLE:o.fill=t,o.stroke=r,E=.3;break;case ve.OVER:o.fill=t,o.stroke=r,E=.5;break;case ve.PRESSED:o.fill=t,o.stroke=p.uiButtonSelectedStrokeColorProperty,P=1.5;break;default:throw new Error(`unsupported interactionState: ${C}`)}o.opacity=E,o.lineWidth=P}e.link(g),this.disposeFlatAppearanceStrategy=()=>{e.hasListener(g)&&e.unlink(g),r.dispose(),a.dispose()}}dispose(){this.disposeFlatAppearanceStrategy()}}class Yr{constructor(o,e,t){x(this,"dispose");function n(r){let a=1;switch(r){case ve.IDLE:a=.6;break;case ve.OVER:break;case ve.PRESSED:break;default:throw new Error(`unsupported interactionState: ${r}`)}o.opacity=a}e.link(n),this.dispose=()=>{e.hasListener(n)&&e.unlink(n)}}}class Ye extends A{constructor(o){const e=new xe(o),t=S=>new k({scale:1.3,children:[S]}),{edgeIcon:n,edgeReversedIcon:r,faceColorInsideIcon:a,faceColorOutsideIcon:s,faceColorMatchIcon:c,faceColorOppositeIcon:i,sectorIcon:l,eraserIcon:g,panIcon:C,dragIcon:E}=Ye.getIcons(),P=new Qt(Zo,[{value:Y.EDGE_STATE,labelContent:"Edge Edit Mode",createNode:()=>t(n),options:{visibleProperty:Y.EDGE_STATE.isEnabledProperty}},{value:Y.EDGE_STATE_REVERSED,labelContent:"Edge Reversed Edit Mode",createNode:()=>t(r),options:{visibleProperty:Y.EDGE_STATE_REVERSED.isEnabledProperty}},{value:Y.FACE_COLOR_INSIDE,labelContent:"Face Color Inside Edit Mode",createNode:()=>t(a),options:{visibleProperty:Y.FACE_COLOR_INSIDE.isEnabledProperty}},{value:Y.FACE_COLOR_OUTSIDE,labelContent:"Face Color Outside Edit Mode",createNode:()=>t(s),options:{visibleProperty:Y.FACE_COLOR_OUTSIDE.isEnabledProperty}},{value:Y.FACE_COLOR_MATCH,labelContent:"Face Color Match Edit Mode",createNode:()=>t(c),options:{visibleProperty:Y.FACE_COLOR_MATCH.isEnabledProperty}},{value:Y.FACE_COLOR_OPPOSITE,labelContent:"Face Color Opposite Edit Mode",createNode:()=>t(i),options:{visibleProperty:Y.FACE_COLOR_OPPOSITE.isEnabledProperty}},{value:Y.SECTOR_STATE,labelContent:"Sector Edit Mode",createNode:()=>t(l),options:{visibleProperty:Y.SECTOR_STATE.isEnabledProperty}}],{spacing:15,layoutOptions:{grow:1}});P.children.forEach(S=>S.addInputListener(e));const w={buttonAppearanceStrategy:ue,baseColor:p.uiButtonBaseColorProperty,disabledColor:p.uiButtonDisabledColorProperty,mouseAreaXDilation:5,mouseAreaYDilation:5,touchAreaXDilation:5,touchAreaYDilation:5},b=new Bo(gt,X({},w,{accessibleName:"Eraser Mode (Toggle)",content:t(g),buttonAppearanceStrategy:Xr,contentAppearanceStrategy:Yr}));b.addInputListener(e);const d=t(C),h=t(E),y=new k;Ce.link(S=>{y.children=[S===ae.PAN_ONLY?d:h]});const v=new Gr({content:y,listener:()=>{Ce.value=Ce.value===ae.PAN_ONLY?ae.DRAG_ONLY:ae.PAN_ONLY}});Ce.link(S=>{v.accessibleName=S===ae.PAN_ONLY?"Pan Mode (toggle)":"Drag Input Mode (toggle)"}),v.addInputListener(e),super({spacing:13,stretch:!0,children:[P,new fo,b,v]}),o.layoutBoundsProperty.link(S=>{this.maxWidth=Math.max(1,S.width-2*be)})}static getIcons(){const o=new st(0,0,15,0,{stroke:p.uiButtonForegroundProperty,lineWidth:4,lineCap:"round"}),e=6,t=new O().moveTo(-e,-e).lineTo(e,e).moveTo(-e,e).lineTo(e,-e),n=new U(t,{stroke:p.uiButtonForegroundProperty,lineWidth:2}),r=new k({children:[new R(0,0,14,14,{stroke:p.uiButtonForegroundProperty,fill:p.uiButtonFaceOutsideColorProperty})]}),a=new k({children:[new R(0,0,14,14,{stroke:p.uiButtonForegroundProperty,fill:p.uiButtonFaceInsideColorProperty})]}),s=new k({children:[new R(0,0,7,7,{stroke:p.uiButtonForegroundProperty,fill:p.uiForegroundColorProperty}),new R(7,7,7,7,{stroke:p.uiButtonForegroundProperty,fill:p.uiForegroundColorProperty})]}),c=new k({children:[new R(0,0,7,7,{stroke:p.uiButtonForegroundProperty,fill:p.uiForegroundColorProperty}),new R(7,7,7,7,{stroke:p.uiButtonForegroundProperty,fill:p.uiBackgroundColorProperty})]}),i=new k({children:[new U(new O().moveTo(0,14).lineTo(0,0).lineTo(14,0),{stroke:p.uiButtonForegroundProperty}),new U(new O().arc(0,0,7,0,Math.PI/2,!1),{stroke:p.uiButtonForegroundProperty})]}),l=17,g=6,C=7,E=2,P=C/Math.sqrt(2),w=new k({children:[new k({rotation:-Math.PI/4,children:[new R(0,0,l,C,{stroke:p.uiButtonForegroundProperty,fill:p.uiButtonInvertedForegroundProperty,cornerRadius:E}),new R(g,0,l-g,C,{fill:p.uiButtonForegroundProperty,cornerRadius:E})]}),new st(P,P-.5,P+12,P-.5,{stroke:p.uiButtonForegroundProperty,lineDash:[5,1,3,1,2]})]}),b=new U(kr.transformed(qe.rotationZ(Math.PI/4)),{fill:p.uiButtonForegroundProperty,maxWidth:14,maxHeight:14}),d=new k({children:[new U(jt,{fill:p.uiButtonForegroundProperty,matrix:qe.Y_REFLECTION,maxWidth:14,maxHeight:14}),new U(new O().moveTo(0,1.5).lineTo(12,1.5),{stroke:p.uiButtonForegroundProperty,lineDash:[9,1,2]})]}),h=new zt;return{edgeIcon:h.createBox(o),edgeReversedIcon:h.createBox(n),faceColorInsideIcon:h.createBox(a),faceColorOutsideIcon:h.createBox(r),faceColorMatchIcon:h.createBox(s),faceColorOppositeIcon:h.createBox(c),sectorIcon:h.createBox(i),eraserIcon:h.createBox(w),panIcon:h.createBox(b),dragIcon:h.createBox(d)}}}class T extends wo{constructor(o,e){const t=j()({font:K,fill:p.uiForegroundColorProperty},e);super(o,t)}}class Jr extends Le{constructor(o){self.phet.chipper.isFuzzEnabled=()=>!1;const e=Ye.getIcons(),t=Be.getIcons(),n=a=>new k({children:[R.bounds(a.bounds.dilated(3),{fill:p.uiButtonBaseColorProperty,stroke:p.uiButtonSelectedStrokeColorProperty,cornerRadius:3}),a]}),r=650;super(new z({spacing:10,align:"left",children:[new T("Slitherlink",{font:le}),new T("Slitherlink is a logic puzzle where you draw a <strong>single continuous loop</strong> on a grid. The goal is to connect dots without crossing or overlapping, creating a loop that adheres to specific rules based on the numbers in some cells.",{lineWrap:r}),new z({spacing:2,align:"left",children:[new T("The loop must satisfy the following rules:"),new T("The loop cannot cross or touch itself.",{layoutOptions:{leftMargin:20}}),new T("Each numbered cell must have exactly that number of sides in the loop.",{layoutOptions:{leftMargin:20}})]}),new T("Solving",{font:le}),new T('<a href="{{solvingGuide}}">See the Solving Guide</a>',{font:lr,links:{solvingGuide:"./"},layoutOptions:{align:"center"}}),new T("Edit Modes",{font:le}),new z({spacing:5,align:"left",children:[new A({spacing:10,children:[n(e.edgeIcon),new T("Click/tap adds a line")]}),new A({spacing:10,children:[n(e.edgeReversedIcon),new T("Click/tap adds an X (marking where a line will not go)")]}),new A({spacing:10,children:[n(e.faceColorInsideIcon),new T("Sets the color of a cell to the inside color")]}),new A({spacing:10,children:[n(e.faceColorOutsideIcon),new T("Sets the color of a cell to the outside color")]}),new A({spacing:10,children:[n(e.faceColorMatchIcon),new T("Click/tap on one cell, then click/tap on another to make them the same color")]}),new A({spacing:10,children:[n(e.sectorIcon),new T("Click/tap to pop up a selector, then select the sector color")],visibleProperty:ce}),new A({spacing:10,children:[n(e.eraserIcon),new T("When activated, the line/cell/sector (from the modes above) will be erased")]})]}),new T("The number keys (1-9) can switch between edit modes. E will activate the eraser when pressed."),new T("The line/X and inside/outside color controls will cycle through the states (e.g. blank => line => X => blank) by default, but can be changed to toggle (e.g. blank => line, line => blank, X => line) in settings.",{lineWrap:r}),new T(`Right-click or shift-click will activate the "opposite" mode (e.g. in line mode, shift-click will set an X). This will work for lines <=> X's, inside <=> outside colors, and the final click for make same <=> make opposite colors.`,{lineWrap:r}),new T("View Styles",{font:le}),new z({spacing:5,align:"left",children:[new A({spacing:10,children:[n(t.classicIcon),new T("Classic Slitherlink style, just lines/X's.")]}),new A({spacing:10,children:[n(t.basicLinesIcon),new T(`Cleaner lines (missing lines are X's, thin lines are "blank"), inside/outside colors`)]}),new A({spacing:10,children:[n(t.basicFaceColoringIcon),new T("Cleaner with face coloring (lighter/darker color pairs are inside/outside or outside/inside)")]}),new A({spacing:10,children:[n(t.pureFaceColoringIcon),new T("Similar to above, but without showing lines at all")]}),new A({spacing:10,children:[n(t.basicSectorsIcon),new T("Cleaner lines, with sectors (see the solving guide)")],visibleProperty:ce}),new A({spacing:10,children:[n(t.sectorsWithColorsIcon),new T("Cleaner lines with colors and sectors (see the solving guide)")],visibleProperty:ce})]}),new T("About / Contact",{font:le}),new T('My name is Jonathan Olson, and I created this Slitherlink interface to explore the limits of solving techniques and to provide a seamless experience on both desktop and mobile. I value your feedback and would love to hear any questions, comments, or suggestions. Please reach out to me at <a href="{{email}}">jonathan.olson@colorado.edu</a>.',{lineWrap:r,links:{email:"mailto:jonathan.olson@colorado.edu"}})]}),o)}}class Kr extends Le{constructor(e){const t=new ht(!1),n=new oe("Copy URL",{accessibleName:"Copy Shareable URL to Clipboard",listener:()=>{if(this.puzzle){const r=location.protocol+"//"+location.host+location.pathname;let a=this.puzzle;this.includeStateProperty.value||(a=new he(a.board,Kt.fromFaceValueData(a.board,a.stateProperty.value)));const s=jo(a);cr(r+"?p="+encodeURIComponent(s))}}});n.addInputListener(new xe(e));super(new z({spacing:20,align:"left",stretch:!0,children:[n,new F("Include Solve Progress",t)]}),e);x(this,"includeStateProperty");x(this,"puzzle",null);this.includeStateProperty=t}setPuzzle(e){this.puzzle=e}reset(){super.reset(),this.includeStateProperty.reset()}}class Zr extends q{constructor(o,e){const t=j()({font:dr,fill:p.timerColorProperty},e),n=60,r=60*n,a=24*r,s=new ge([o],c=>{c=Math.ceil(c);const i=Math.floor(c/a);c-=i*a;const l=Math.floor(c/r);c-=l*r;const g=Math.floor(c/n);c-=g*n;const C=c,E=l<10?`0${l}`:`${l}`,P=g<10?`0${g}`:`${g}`,w=C<10?`0${C}`:`${C}`;return i?`${i}d ${E}:${P}:${w}`:l?`${E}:${P}:${w}`:`${P}:${w}`});super(s,t),this.timerProperty=o,this.disposeEmitter.addListener(()=>{s.dispose()})}}class jr extends A{constructor(o,e,t){const n=new xe(e),r=new pe(!1),a=new pe(0),s=new pe(de.NOT_FOUND),c=new we(o,{derive:y=>y?y.undoPossibleProperty:r}),i=new we(o,{derive:y=>y?y.redoPossibleProperty:r}),l=new we(o,{derive:y=>y?y.isSolvedProperty:r}),g=new we(o,{derive:y=>y?y.timeElapsedProperty:a}),C=new we(o,{derive:y=>y?y.hintStateProperty:s}),E=new ge([l],y=>!y);let P=null,w=null,b=null,d=null;const h={buttonAppearanceStrategy:ue,baseColor:p.uiButtonBaseColorProperty,disabledColor:p.uiButtonDisabledColorProperty,xMargin:8*1.3,yMargin:5*1.3,mouseAreaXDilation:5,mouseAreaYDilation:5,touchAreaXDilation:5,touchAreaYDilation:5};super({spacing:10,stretch:!0,children:[new Ve("New",X({},h,{accessibleName:"New",listener:()=>{P=P||new Wr(e,{loadPuzzle:t.loadPuzzle}),P.show()},textFill:p.uiButtonForegroundProperty,baseColor:p.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:ot,buttonAppearanceStrategy:ue})),new ne(X({},h,{accessibleName:"Undo All",content:re(vr),listener:()=>{o.value&&o.value.onUserUndoAll()},enabledProperty:c,visibleProperty:dt})),new ne(X({},h,{accessibleName:"Undo",content:re(Cr),listener:()=>{o.value&&o.value.onUserUndo()},enabledProperty:c,fireOnHold:!0})),new Zr(g,{visibleProperty:Jt}),new ne(X({},h,{accessibleName:"Redo",content:re(Pr),listener:()=>{o.value&&o.value.onUserRedo()},enabledProperty:i,fireOnHold:!0})),new ne(X({},h,{accessibleName:"Redo All",content:re(Sr),listener:()=>{o.value&&o.value.onUserRedoAll()},enabledProperty:i,visibleProperty:dt})),new ne(X({},h,{accessibleName:"Settings",content:re(mr),listener:()=>{b=b||new Fr(e),b.show()}})),new ne(X({},h,{accessibleName:"Share",content:re(br),listener:()=>{const y=o.value;y&&(w=w||new Kr(e),w.setPuzzle(y.puzzle),w.show())}})),new Ve("Solve",X({},h,{accessibleName:"Solve",listener:()=>{o.value&&o.value.onUserRequestSolve()},enabledProperty:E,textFill:p.uiButtonForegroundProperty,baseColor:p.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:ot,buttonAppearanceStrategy:ue})),new Ve("Hint",X({},h,{accessibleName:"Hint",listener:()=>{o.value&&o.value.onUserRequestHint()},enabledProperty:new ge([E,C],(y,v)=>y&&v===de.DEFAULT),textFill:p.uiButtonForegroundProperty,baseColor:p.uiButtonBaseColorProperty,xMargin:5,yMargin:5,font:ot,buttonAppearanceStrategy:ue})),new ne(X({},h,{accessibleName:"Help",content:re(Er),listener:()=>{d=d||new Jr(e),d.show()}}))]}),this.puzzleModelProperty=o,this.children.forEach(y=>y.addInputListener(n)),e.layoutBoundsProperty.link(y=>{this.maxWidth=Math.max(1,y.width-2*be)})}}const Qr=p.uiForegroundColorProperty,$r=new ge([p.uiForegroundColorProperty],u=>u.withAlpha(.15));class _r extends k{constructor(o,e,t,n){super({});const r=new hr({diameter:20,activeColor:Qr,inactiveColor:$r});this.disposeEmitter.addListener(()=>r.dispose());const a={xMargin:5,yMargin:5,fill:p.uiBackgroundColorProperty,stroke:p.uiForegroundColorProperty},s=new Ne(new A({spacing:10,children:[new k({children:[r]}),new H("Loading Hint Solver...")]}),a),c=new A({spacing:10,children:[new Ne(new A({spacing:10,children:[new k({children:[r]}),new H("Searching for Hint...")]}),a),new oe("Cancel",{listener:n})]}),i=new A({spacing:10,children:[new oe("Apply Hint",{listener:t}),new oe("Hide Hint",{listener:n})]}),l=new Ne(new H("No Hint Found"),a);l.pickable=!1;const g=E=>{this.children=[...E===de.LOADING?[s]:[],...E===de.SEARCHING?[c]:[],...E===de.FOUND?[i]:[],...E===de.NOT_FOUND?[l]:[]]};e.link(g),this.disposeEmitter.addListener(()=>e.unlink(g));const C=E=>{r.step(E)};o.stepEmitter.addListener(C),this.disposeEmitter.addListener(()=>o.stepEmitter.removeListener(C))}}class es extends k{constructor(o,e){const t=[],n=[],r=i=>{const l=i.getStrokedShape(new Ro({lineWidth:.3,lineCap:"round",lineJoin:"round"}));t.push(...l.subpaths)},a=i=>{const l=i.getOffsetShape(-.1);n.push(...l.subpaths)},s=i=>{r(new O().moveToPoint(i.start.viewCoordinates).lineToPoint(i.end.viewCoordinates))},c=i=>{i.edges.every(l=>!e.incorrectEdges.has(l))&&a(O.polygon(i.vertices.map(l=>l.viewCoordinates)))};e.incorrectEdges.forEach(s),e.incorrectFaces.forEach(c),super({children:[new U(new O(t),{fill:p.incorrectEdgeColorProperty}),new U(new O(n),{fill:p.incorrectFaceColorProperty})],pickable:!1,filters:[new yo(.1)]})}}class ts extends k{constructor(o,e){const t=j()({focusNodeCallback:()=>{}},e),n=new me(o.puzzle,{edgePressListener:(i,l)=>o.onUserEdgePress(i,l),onEdgeDragStart:(i,l)=>o.onUserEdgeDragStart(i,l),onEdgeDrag:(i,l)=>o.onUserEdgeDrag(i,l),onEdgeDragEnd:()=>o.onUserEdgeDragEnd(),facePressListener:(i,l)=>o.onUserFacePress(i,l),onFaceDragStart:(i,l)=>o.onUserFaceDragStart(i,l),onFaceDrag:(i,l)=>o.onUserFaceDrag(i,l),onFaceDragEnd:()=>o.onUserFaceDragEnd(),sectorPressListener:(i,l)=>o.onUserSectorPress(i,l),sectorSetListener:(i,l)=>o.onUserSectorSet(i,l),selectedFaceColorHighlightProperty:o.selectedFaceColorHighlightProperty,selectedSectorEditProperty:o.selectedSectorEditProperty,style:o.style,delayEdgeInteractionEmitter:o.edgeAutoSolvedEmitter}),r=new k;super(X({children:[n,r]},t)),this.puzzleModel=o,this.disposeEmitter.addListener(()=>n.dispose());let a=null;const s=i=>{if(n.clearAnnotationNodes(),a&&(a.dispose(),a=null),i){const l=new zn(o.puzzle.board,i,o.style,n.getBackgroundBounds());n.addAnnotationNode(l),a=l,t.focusNodeCallback(l)}};this.disposeEmitter.addListener(()=>{a&&(a.dispose(),a=null)}),o.displayedAnnotationProperty.link(s),this.disposeEmitter.addListener(()=>o.displayedAnnotationProperty.unlink(s));const c=Ge.multilink([ct,o.correctnessStateProperty],(i,l)=>{const g=()=>{r.children.forEach(C=>C.dispose())};i&&!l.isCorrect()?setTimeout(()=>{if(ct.value&&l===o.correctnessStateProperty.value){const C=new es(o.puzzle.board,l);g(),r.children=[C],console.log("showing error")}},Math.ceil(Qo.value*1e3)):g()});this.disposeEmitter.addListener(()=>c.dispose())}}class G{constructor(o,e){this.layoutPuzzle=o,this.derivatives=e}plus(o){const e=new Map;return this.derivatives.forEach((t,n)=>{e.set(n,t.plus(o.derivatives.get(n)))}),new G(this.layoutPuzzle,e)}minus(o){const e=new Map;return this.derivatives.forEach((t,n)=>{e.set(n,t.minus(o.derivatives.get(n)))}),new G(this.layoutPuzzle,e)}timesScalar(o){const e=new Map;return this.derivatives.forEach((t,n)=>{e.set(n,t.timesScalar(o))}),new G(this.layoutPuzzle,e)}getMaxMagnitude(){let o=0;return this.derivatives.forEach(e=>{o=Math.max(o,e.getMagnitude())}),o}getAreaCorrectedDerivative(){let o=this;for(let e=0;e<5;e++)o=o.getAreaCorrectedDerivativeOnce();return o}getAreaCorrectedDerivativeOnce(){return this.plus(G.getAreaScaledDeltas(this.layoutPuzzle,-this.getAreaDerivative()/this.layoutPuzzle.getSignedArea()))}getAreaDerivative(){let o=0;return this.layoutPuzzle.faces.forEach(e=>{o+=Ho(e.vertices.map(t=>t.viewCoordinates),e.vertices.map(t=>this.derivatives.get(t)))}),o}getDebugNode(){const o=new k;return this.layoutPuzzle.vertices.forEach(e=>{const t=this.derivatives.get(e),n=e.viewCoordinates,r=new gr(n.x,n.y,n.x+t.x,n.y+t.y,{lineWidth:.01,headHeight:.05,headWidth:.05,tailWidth:.005,fill:"green",stroke:"green"});o.addChild(r)}),o}static getAreaScaledDeltas(o,e){const t=o.getCentroid(),n=new Map;return o.vertices.forEach(r=>{const a=r.viewCoordinates.minus(t).timesScalar(e);I()&&N(a.isFinite()),n.set(r,a)}),new G(o,n)}static getHookesAttraction(o,e,t){const n=new Map;return o.vertices.forEach(r=>{n.set(r,te.ZERO.copy())}),o.edges.forEach(r=>{const a=r.start.viewCoordinates,c=r.end.viewCoordinates.minus(a),i=c.getMagnitude(),l=c.timesScalar((i-e)*t/i);I()&&N(l.isFinite()),n.get(r.start).add(l),n.get(r.end).subtract(l)}),new G(o,n)}static getRegularPolygonDeltas(o,e,t,n){const r=new Map;o.vertices.forEach(s=>{r.set(s,te.ZERO.copy())});const a=s=>e/(2*Math.sin(Math.PI/s));return o.faces.forEach(s=>{if(s.vertices.length<3)return;const c=.2,i=.3,l=s.vertices.map(v=>v.viewCoordinates);let g=0;const C=at(l);C<0?g=1:C<c&&(g=Math.max(g,(c-C)/c));for(let v=0;v<l.length&&!(g>=1);v++){const S=v,L=(v+1)%l.length,B=l[S],f=l[L];for(let m=v+2;m<l.length-(v===0?1:0)&&!(g>=1);m++){const _=m%l.length,ee=(m+1)%l.length,D=l[_],V=l[ee];if(fe.lineSegmentIntersection(B.x,B.y,f.x,f.y,D.x,D.y,V.x,V.y))I()&&N(l.length>=4),g=1;else{const Te=Math.min(fe.distToSegment(B,D,V),fe.distToSegment(f,D,V),fe.distToSegment(D,B,f),fe.distToSegment(V,B,f));Te<i&&(g=Math.max(g,(i-Te)/i))}}}if(g===0&&t&&o.getFaceValue(s)===null)return;const E=Se(l);I()&&N(E.isFinite());const P=a(l.length),w=l.map(v=>v.minus(E)),b=l.map((v,S)=>te.createPolar(P,2*Math.PI*S/l.length)),d=G.getLeastSquares(w,b),h=n+(2-n)*g,y=l.map((v,S)=>d[S].minus(w[S]).timesScalar(h));s.vertices.forEach((v,S)=>{const L=y[S];I()&&N(L.isFinite()),r.get(v).add(L)})}),new G(o,r)}static getBarycentricDeltas(o){const e=new Map;return o.vertices.forEach(t=>{const n=t.edges.map(s=>s.getOtherVertex(t)),r=new te(0,0);n.forEach(s=>r.add(s.viewCoordinates)),r.multiplyScalar(1/n.length);const a=r.subtract(t.viewCoordinates);I()&&N(a.isFinite()),e.set(t,a)}),new G(o,e)}static getAngularDeltas(o,e){const t=new Map;return o.vertices.forEach(n=>{t.set(n,te.ZERO.copy())}),o.vertices.forEach(n=>{const r=n.edges.map(w=>w.getOtherVertex(n));let a=ye.sortBy(r,w=>w.viewCoordinates.minus(n.viewCoordinates).getAngle());if(a[0]!==r[0]){const w=a.indexOf(r[0]);a=[...a.slice(w),...a.slice(0,w)]}const s=ye.range(0,r.length).every(w=>a[w]===r[w]),c=r.map(w=>w.viewCoordinates.minus(n.viewCoordinates).normalized()),i=G.getUnitLeastSquares(c),l=Math.max(...ye.range(0,r.length).map(w=>i[w].dot(i[(w+1)%r.length]))),g=Math.max(...ye.range(0,r.length).map(w=>c[w].dot(c[(w+1)%r.length]))),C=(w,b)=>b<=.5?.5*Math.pow(2*b,w):1-C(w,1-b),E=s?fe.linear(l,1,0,1,g):1,P=.75;if(E>P){const w=(E-P)/(1-P),b=C(2,w),d=new te(0,0);for(let h=0;h<r.length;h++){const y=r[h],v=c[h],S=i[h],L=S.minus(v.timesScalar(S.dot(v))).timesScalar(b*e);d.add(L),I()&&N(L.isFinite()),t.get(y).add(L)}d.multiplyScalar(1/r.length);for(const h of r)I()&&N(d),t.get(h).subtract(d)}}),new G(o,t)}static getUnitLeastSquares(o){const e=o.length,t=ye.range(0,e).map(n=>te.createPolar(1,2*Math.PI*n/e));return G.getLeastSquares(o,t)}static getLeastSquares(o,e){const t=o.length,n=new je(2,t,[...e.map(l=>l.x),...e.map(l=>l.y)]),r=new je(2,t,[...o.map(l=>l.x),...o.map(l=>l.y)]),a=n.times(r.transpose()),s=new ho(a);let c=s.getV().times(s.getU().transpose());c.det()<0&&(c=s.getV().times(je.diagonalMatrix([1,-1])).times(s.getU().transpose()));const i=new qe().rowMajor(c.get(0,0),c.get(0,1),0,c.get(1,0),c.get(1,1),0,0,0,1);return e.map(l=>{const g=i.timesVector2(l);return I()&&N(g.isFinite()),g})}}class os extends Do{constructor(e,t){const n=new Map,r=new Map,a=new Map,s=new Map,c=new Map,i=new Map,l=new Map,g=new Map,C=f=>{const m=n.get(f);return I()&&N(m),m},E=f=>{const m=r.get(f);return I()&&N(m),m},P=f=>{const m=a.get(f);return I()&&N(m),m},w=f=>{const m=s.get(f);return I()&&N(m),m},b=f=>{const m=c.get(f);return I()&&N(m),m},d=f=>{const m=i.get(f);return I()&&N(m),m},h=f=>{const m=l.get(f);return I()&&N(m),m},y=f=>{const m=g.get(f);return I()&&N(m),m},v=e.vertices.map(f=>{const m=new fr(f.logicalCoordinates,f.viewCoordinates);return n.set(f,m),c.set(m,f),m}),S=e.faces.map(f=>{const m=new Bt(f.logicalCoordinates,f.viewCoordinates);return r.set(f,m),i.set(m,f),m.originalFace=f,m}),L=[],B=e.edges.map(f=>{const m=n.get(f.start),_=n.get(f.end);I()&&N(m),I()&&N(_);const ee=new xt(m,_);ee.originalEdges.add(f),a.set(f,ee),l.set(ee,f);const D=new He(m,_,!1);s.set(f.forwardHalf,D),g.set(D,f.forwardHalf),L.push(D);const V=new He(_,m,!0);return s.set(f.reversedHalf,V),g.set(V,f.reversedHalf),L.push(V),ee});v.forEach(f=>{const m=b(f);f.incomingHalfEdges=m.incomingHalfEdges.map(w),f.outgoingHalfEdges=m.outgoingHalfEdges.map(w),f.edges=m.edges.map(P),f.faces=m.faces.map(E)}),S.forEach(f=>{const m=d(f);f.halfEdges=m.halfEdges.map(w),f.edges=m.edges.map(P),f.vertices=m.vertices.map(C)}),B.forEach(f=>{const m=h(f);f.forwardHalf=w(m.forwardHalf),f.reversedHalf=w(m.reversedHalf),f.forwardFace=m.forwardFace?E(m.forwardFace):null,f.reversedFace=m.reversedFace?E(m.reversedFace):null,f.vertices=m.vertices.map(C),f.faces=m.faces.map(E)}),L.forEach(f=>{const m=y(f);f.edge=P(m.edge),f.reversed=w(m.reversed),f.next=w(m.next),f.previous=w(m.previous),f.face=m.face?E(m.face):null});super({edges:B,vertices:v,faces:S,halfEdges:L,outerBoundary:e.outerBoundary.map(w),innerBoundaries:e.innerBoundaries.map(f=>f.map(w))});x(this,"edgeStateMap",new Map);x(this,"faceValueMap",new Map);this.originalBoard=e,this.originalState=t,B.forEach(f=>{this.edgeStateMap.set(f,t.getEdgeState(h(f)))}),S.forEach(f=>{this.faceValueMap.set(f,t.getFaceValue(d(f)))}),I()&&Qe(this)}getFaceValue(e){const t=this.faceValueMap.get(e);return I()&&N(t!==void 0),t}getEdgeState(e){const t=this.edgeStateMap.get(e);return I()&&N(t!==void 0),t}clearSatisfiedFaces(){this.faces.forEach(e=>{const t=this.getFaceValue(e);if(t===null)return;let n=0,r=0;e.edges.forEach(a=>{const s=this.getEdgeState(a);s===ie.WHITE?n++:s===ie.BLACK&&r++}),n===0&&r===t&&this.faceValueMap.set(e,null)})}removeDeadRedEdges(){const e=new Set(this.edges.filter(s=>this.getEdgeState(s)===ie.RED&&s.faces.every(c=>c===null||this.getFaceValue(c)===null))),t=new Set(this.vertices.filter(s=>s.edges.every(c=>e.has(c)))),n=new Set(this.faces.filter(s=>s.edges.some(c=>e.has(c)))),r=[],a=new Set(n);for(;a.size;){const s=a.values().next().value;a.delete(s);const c=[s];let i=!1;for(let d=0;d<c.length;d++){const h=c[d];h.edges.forEach(y=>{e.has(y)&&[y.forwardFace,y.reversedFace].forEach(v=>{if(v!==h){if(v===null){i=!0;return}a.has(v)&&(a.delete(v),c.push(v))}})})}const l=new Set(c.flatMap(d=>d.halfEdges)),g=new Set(c.flatMap(d=>d.halfEdges.map(h=>h.reversed))),C=new Set([...l].filter(d=>!g.has(d))),E=d=>{let h=d.next;for(;h!==d&&!C.has(h);)h=h.reversed.next;return I()&&N(h!==d),h},P=C.values().next().value,w=[P];let b=E(P);for(;b!==P;)w.push(b),b=E(b);if(I()&&N(w.length===C.size),i){const d=[];for(let h=0;h<w.length;h++){const y=w[h],v=w[(h+w.length-1)%w.length];if(I()&&N(v.end===y.start),!e.has(y.edge)&&e.has(v.edge)){const S=[y];for(let L=h+1;;L++){const B=w[L%w.length];if(e.has(B.edge))break;S.push(B)}d.push(S)}}r.push(new wr(c,w,d))}else r.push(new At(c,w))}r.forEach(s=>{if(s instanceof At){const c=s.boundaryHalfEdges.map(g=>g.start),i=s.boundaryHalfEdges.map(g=>g.edge),l=new Bt(Se(c.map(g=>g.viewCoordinates)),Se(c.map(g=>g.logicalCoordinates)));this.faces.push(l),this.faceValueMap.set(l,null),l.halfEdges=s.boundaryHalfEdges,l.edges=i,l.vertices=c;for(let g=0;g<s.boundaryHalfEdges.length;g++){const C=s.boundaryHalfEdges[g],E=C.face;C.face=l;const P=C.edge;C.isReversed?P.reversedFace=l:P.forwardFace=l,I()&&N(E),E&&M(P.faces,E),P.faces.push(l)}}else s.boundarySegments.forEach(c=>{c.forEach(i=>{const l=i.edge,g=i.face;g&&(i.face=null,M(l.faces,g)),i.isReversed?l.reversedFace=null:l.forwardFace=null})})}),e.forEach(s=>{M(this.edges,s),M(this.halfEdges,s.forwardHalf),M(this.halfEdges,s.reversedHalf)}),t.forEach(s=>{M(this.vertices,s)}),n.forEach(s=>{M(this.faces,s)}),this.vertices.forEach(s=>{s.edges=s.edges.filter(c=>!e.has(c)),s.incomingHalfEdges=s.incomingHalfEdges.filter(c=>!e.has(c.edge)),s.outgoingHalfEdges=s.outgoingHalfEdges.filter(c=>!e.has(c.edge)),s.faces=s.incomingHalfEdges.map(c=>c.face).filter(c=>c!==null);for(let c=0;c<s.incomingHalfEdges.length;c++){const i=s.outgoingHalfEdges[c],l=s.incomingHalfEdges[(c+1)%s.incomingHalfEdges.length];l.next=i,i.previous=l}}),I()&&Qe(this)}removeSimpleForced(){this.vertices.slice().forEach(e=>{if(e.edges.length!==2||ye.uniq(e.edges.flatMap(y=>y.faces)).some(y=>this.getFaceValue(y)!==null))return;const n=e.edges[0],r=e.edges[1],a=this.getEdgeState(n),s=this.getEdgeState(r);if(a!==s)return;const c=n.getOtherVertex(e),i=r.getOtherVertex(e);if(c===i)return;const l=n.forwardHalf.end===e?n.forwardHalf:n.reversedHalf,g=n.forwardHalf.end===e?n.reversedHalf:n.forwardHalf,C=r.forwardHalf.start===e?r.forwardHalf:r.reversedHalf,E=r.forwardHalf.start===e?r.reversedHalf:r.forwardHalf,P=l.face,w=g.face,b=new xt(c,i);n.originalEdges.forEach(y=>b.originalEdges.add(y)),r.originalEdges.forEach(y=>b.originalEdges.add(y)),this.edgeStateMap.set(b,a),this.edges.push(b);const d=new He(c,i,!1);this.halfEdges.push(d);const h=new He(i,c,!0);if(this.halfEdges.push(h),b.forwardHalf=d,b.reversedHalf=h,b.forwardFace=P,b.reversedFace=w,b.vertices=[c,i],b.faces=[P,w].filter(y=>y!==null),d.edge=b,d.reversed=h,d.next=C.next,d.previous=l.previous,d.face=P,h.edge=b,h.reversed=d,h.next=g.next,h.previous=E.previous,h.face=w,P){const y=P.halfEdges.indexOf(l),v=P.edges.indexOf(n);I()&&N(y!==-1),I()&&N(v!==-1),P.halfEdges[y]=d,M(P.halfEdges,C),P.edges[v]=b,M(P.edges,r),M(P.vertices,e)}if(w){const y=w.halfEdges.indexOf(E),v=w.edges.indexOf(r);I()&&N(y!==-1),I()&&N(v!==-1),w.halfEdges[y]=h,M(w.halfEdges,g),w.edges[v]=b,M(w.edges,n),M(w.vertices,e)}{const y=c.incomingHalfEdges.indexOf(g),v=c.outgoingHalfEdges.indexOf(l),S=c.edges.indexOf(n);I()&&N(y!==-1),I()&&N(v!==-1),I()&&N(S!==-1),c.incomingHalfEdges[y]=h,c.outgoingHalfEdges[v]=d,c.edges[S]=b}{const y=i.incomingHalfEdges.indexOf(C),v=i.outgoingHalfEdges.indexOf(E),S=i.edges.indexOf(r);I()&&N(y!==-1),I()&&N(v!==-1),I()&&N(S!==-1),i.incomingHalfEdges[y]=d,i.outgoingHalfEdges[v]=h,i.edges[S]=b}d.previous.next=d,d.next.previous=d,h.previous.next=h,h.next.previous=h,M(this.edges,n),M(this.edges,r),M(this.halfEdges,n.forwardHalf),M(this.halfEdges,n.reversedHalf),M(this.halfEdges,r.forwardHalf),M(this.halfEdges,r.reversedHalf),M(this.vertices,e)}),I()&&Qe(this)}simplify(){this.clearSatisfiedFaces(),this.removeDeadRedEdges(),this.removeSimpleForced()}fixOuterBoundary(){const e=new Set(this.halfEdges.filter(r=>r.face===null)),t=[],n=[];for(;e.size;){const r=e.values().next().value;e.delete(r);const a=[r];let s=r.next;for(;s!==r;)a.push(s),e.delete(s),s=s.next;at(a.map(c=>c.start.viewCoordinates))<0?t.push(a):n.push(a)}I()&&N(t.length===1),this.outerBoundary.length=0,this.outerBoundary.push(...t[0]),this.innerBoundaries.length=0,this.innerBoundaries.push(...n)}getCompleteState(){this.fixOuterBoundary();const e=Kt.fromFacesEdges(this,t=>this.getFaceValue(t),t=>this.getEdgeState(t));return Fe(this,e),e}getCompletePuzzle(){return{board:this,state:this.getCompleteState()}}getSignedArea(){let e=0;return this.faces.forEach(t=>{e+=at(t.vertices.map(n=>n.viewCoordinates))}),e}getCentroid(){let e=0,t=0,n=0;return this.halfEdges.forEach(r=>{if(r.face===null){const a=r.end.viewCoordinates,s=r.start.viewCoordinates;e+=(s.x+a.x)*(s.y-a.y);const c=a.x*(2*a.y+s.y)+s.x*(a.y+2*s.y);t+=(a.x-s.x)*c,n+=(s.y-a.y)*c}}),e*=.5,new te(t,n).timesScalar(1/(6*e))}applyDerivative(e){this.vertices.forEach(t=>{const n=e.derivatives.get(t);I()&&N(n),I()&&N(n.isFinite()),t.viewCoordinates.add(n)}),this.fixFaceCoordinates()}fixFaceCoordinates(){this.faces.forEach(e=>{e.viewCoordinates.set(Se(e.halfEdges.map(t=>t.start.viewCoordinates)))})}getDebugNode(){const e=new k;return this.edges.forEach(t=>{const n=t.start.viewCoordinates,r=t.end.viewCoordinates;let a,s;const c=this.edgeStateMap.get(t);c===ie.WHITE?(a=p.blackLineColorProperty,s=.02):c===ie.BLACK?(a=ur(Math.random()*360,.7,.55),s=.1):(a=null,s=.02),e.addChild(new st(n,r,{stroke:a,lineWidth:s,lineCap:"round"}))}),this.faces.forEach(t=>{const n=this.faceValueMap.get(t)??null;n!==null&&e.addChild(new q(n,{maxWidth:.9,maxHeight:.9,center:t.viewCoordinates,fill:p.faceValueColorProperty}))}),e}}const ns=u=>({board:u.board,stateProperty:new pt(u.state)});class rs extends k{constructor(o,e){const t=new k;let n=null;const r=()=>{const s=o.puzzle.board,c=o.puzzle.stateProperty.value;if(c.getSimpleRegions().some(b=>b.isSolved))return;const i=new os(s,c);i.simplify();const l=()=>G.getAngularDeltas(i,.2).plus(G.getHookesAttraction(i,1,.1)).plus(G.getRegularPolygonDeltas(i,1,!0,.2));let g=.3;for(let b=0;b<40;b++){b%10===0&&(g*=.95);let d=l();{let h=d.getMaxMagnitude(),y=g;g*h>1.5&&(y=1.5/h),d=d.timesScalar(y)}if(i.applyDerivative(d),d.getMaxMagnitude()<.015)break}const C=i.getCompletePuzzle();n&&n.dispose();const E=new me(ns(C),{edgePressListener:(b,d)=>{const h=b.originalEdges;h&&o.onUserEdgePress(h.values().next().value,d)},facePressListener:(b,d)=>{if(b===null)o.onUserFacePress(null,d);else{const h=b.originalFace;h&&o.onUserFacePress(h,d)}}});n=E;const P=new k({children:[E]}),w=600;P.scale(Math.min(w/P.width,w/P.height)),P.left=20,P.top=130,t.children=[P]},a=()=>{t.children=[],r()};o.puzzle.stateProperty.link(a),super(X({children:[t]},e)),this.puzzleModel=o,this.disposeEmitter.addListener(()=>o.puzzle.stateProperty.unlink(a)),this.disposeEmitter.addListener(()=>t.dispose()),this.disposeEmitter.addListener(()=>n&&n.dispose())}}class $t extends mo(k){constructor(e,t=ft,n){const r=j()({topological:!1},n);super(r);x(this,"backgroundRect");x(this,"facePressRect");x(this,"rectangularGradientRect");x(this,"circularGradientRect");x(this,"puzzleWrapper");x(this,"puzzleNode",null);x(this,"zoomListener");this.puzzleModelProperty=e,this.style=t,this.backgroundRect=new R({fill:t.theme.playAreaBackgroundColorProperty,pickable:!0}),this.facePressRect=new R({fill:null,pickableProperty:$o}),_o(null,this.facePressRect,(s,c)=>{var i;(i=e.value)==null||i.onUserFacePress(s,c)}),this.rectangularGradientRect=new R({pickable:!1}),this.circularGradientRect=new R({pickable:!1}),this.puzzleWrapper=new k({children:[this.backgroundRect,this.facePressRect,this.rectangularGradientRect,this.circularGradientRect]}),this.zoomListener=new Co(this.puzzleWrapper,{maxScale:10}),this.addInputListener(this.zoomListener),this.addChild(this.puzzleWrapper);const a=this.updateLayout.bind(this);this.localPreferredWidthProperty.lazyLink(a),this.localPreferredHeightProperty.lazyLink(a),r.topological&&this.puzzleWrapper.localBoundsProperty.lazyLink(a),Ge.multilink([e,wt],(s,c)=>{this.puzzleNode&&(this.puzzleNode.dispose(),this.puzzleNode=null),s&&(r.topological?c&&(this.puzzleNode=new rs(s)):this.puzzleNode=new ts(s,{focusNodeCallback:i=>{this.zoomListener.panToNode(i,!0)}}),this.puzzleNode&&(this.updatePuzzleNodeLayout(this.puzzleNode),this.puzzleWrapper.children=[this.backgroundRect,this.facePressRect,this.rectangularGradientRect,this.circularGradientRect,this.puzzleNode])),this.zoomListener.resetTransform(),this.updateLayout()})}step(e){this.zoomListener.step(2*e)}updateLayout(){const e=this.localPreferredWidth,t=this.localPreferredHeight;if(e!==null&&(this.backgroundRect.rectWidth=e,this.facePressRect.rectWidth=e,this.rectangularGradientRect.rectWidth=e,this.circularGradientRect.rectWidth=e),t!==null&&(this.backgroundRect.rectHeight=t,this.facePressRect.rectHeight=t,this.rectangularGradientRect.rectHeight=t,this.circularGradientRect.rectHeight=t),this.puzzleNode&&this.updatePuzzleNodeLayout(this.puzzleNode),e!==null&&t!==null&&e>0&&t>0){const n=new Ue(0,0,e,t),r=n.center,a=r.getMagnitude();this.rectangularGradientRect.fill=new Po(0,0,0,t).addColorStop(0,this.style.theme.playAreaLinearTopColorProperty).addColorStop(.5,this.style.theme.playAreaLinearMiddleColorProperty).addColorStop(1,this.style.theme.playAreaLinearBottomColorProperty),this.circularGradientRect.fill=new vo(r.x,r.y,a,r.x,r.y,0).addColorStop(0,this.style.theme.playAreaRadialOutsideColorProperty).addColorStop(1,this.style.theme.playAreaRadialInsideColorProperty),this.clipArea=O.bounds(n),this.zoomListener.setTargetBounds(n),this.zoomListener.setPanBounds(n)}else{const n=new Ue(0,0,5,5);this.zoomListener.setTargetBounds(n),this.zoomListener.setPanBounds(n)}}updatePuzzleNodeLayout(e){const t=this.localPreferredWidth,n=this.localPreferredHeight;if(t!==null&&n!==null&&t>0&&n>0){const a=t-40,s=n-20*2;if(e.localBounds.isValid()){const c=e.localBounds.width,i=e.localBounds.height,l=Math.min(a/c,s/i);e.setScaleMagnitude(l),e.center=new te(t/2,n/2)}}}}class ss{constructor(o,e,t){this.layoutBoundsProperty=o,this.glassPane=e,this.stepEmitter=t}}const _t=new k,Ae=new k;self.assertions;const as=new k({renderer:"svg",children:[Ae]}),ke=new So(as,{allowWebGL:!0,allowBackingScaleAntialiasing:!0,allowSceneOverflow:!1,accessibility:!0,backgroundColor:"#eee",assumeFullWindow:!0,listenToOnlyElement:Xe.debugColors});document.body.appendChild(ke.domElement);ke.setPointerAreaDisplayVisible(Xe.showPointerAreas);self.oncontextmenu=u=>u.preventDefault();const yt=new pt(new Ue(0,0,self.innerWidth,self.innerHeight)),Z=new pe(yr()),eo=new $t(Z,ft,{layoutOptions:{stretch:!0,grow:1}}),to=new $t(Z,ft,{layoutOptions:{stretch:!0,grow:1},topological:!0,visibleProperty:wt}),is=new we(Z,{derive:u=>u?u.hintStateProperty:new pe(de.DEFAULT)});Ge.multilink([p.navbarBackgroundColorProperty],u=>{ke.backgroundColor=u});const oo=new Ie,Je=new ss(yt,_t,oo),no=new jr(Z,Je,{loadPuzzle:u=>{const o=ut(u.board,u.stateProperty.value);o&&(Z.value=new Rt(o))}}),ls=new Ye(Je),cs=new Be(Je),ro=new _r(Je,is,()=>{var u;(u=Z.value)==null||u.onUserApplyHint()},()=>{var u;(u=Z.value)==null||u.onUserClearHint()}),Pe=new z({stretch:!0,children:[new De(no,{margin:be}),new A({grow:1,stretch:!0,layoutOptions:{grow:1},children:[eo,to]}),new De(cs,{margin:be,visibleProperty:Yt}),new De(ls,{margin:be})]});yt.lazyLink(u=>{Pe.preferredWidth=u.width,Pe.preferredHeight=u.height,Pe.x=u.left,Pe.y=u.top});Ae.addChild(Pe);Ae.addChild(ro);Ae.addChild(_t);bo.create(Ae,[no,ro],(u,o)=>{o.centerTop=u.centerBottom.plusXY(0,5)});ke.initializeEvents();let mt=!0;const so=()=>{mt=!1;const u=new Ue(0,0,self.innerWidth,self.innerHeight);ke.setWidthHeight(u.width,u.height),yt.value=u,Vo.mobileSafari&&self.scrollTo(0,0)},Ke=()=>{mt=!0};$(self).resize(Ke);self.addEventListener("resize",Ke);self.addEventListener("orientationchange",Ke);self.visualViewport&&self.visualViewport.addEventListener("resize",Ke);so();ke.updateOnRequestAnimationFrame(u=>{var o;Mn(),mt&&so(),Pe.validateBounds(),eo.step(u),to.step(u),(o=Z.value)==null||o.step(u),oo.emit(u)});document.addEventListener("keydown",u=>{var o,e,t,n;if(u.ctrlKey||u.metaKey)u.key==="z"&&(u.shiftKey?(o=Z.value)==null||o.onUserRedo():(e=Z.value)==null||e.onUserUndo()),u.key==="y"&&((t=Z.value)==null||t.onUserRedo());else if(["1","2","3","4","5","6","7","8","9"].includes(u.key)){const r=Number.parseInt(u.key,10)-1,a=Y.enumeration.values.filter(s=>s.isEnabledProperty.value);r<a.length&&en(a[r])}else u.key==="Escape"&&((n=Z.value)==null||n.onUserEscape())});We.keydownEmitter.addListener(u=>{u.key==="e"&&(gt.value=!0)});We.keyupEmitter.addListener(u=>{u.key==="e"&&(gt.value=!1)});let Ot=!1;We.keyDownStateChangedEmitter.addListener(()=>{const u=We.isEnglishKeyDown("space");u!==Ot&&(Ot=u,Ce.value=Ce.value===ae.PAN_ONLY?ae.DRAG_ONLY:ae.PAN_ONLY)});Z.lazyLink((u,o)=>{o&&o.dispose()});
